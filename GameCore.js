var Kn=Object.defineProperty;var Ei=(h,e,t)=>e in h?Kn(h,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[e]=t;var r=(h,e)=>Kn(h,"name",{value:e,configurable:!0});var l=(h,e,t)=>(Ei(h,typeof e!="symbol"?e+"":e,t),t);import{G as d,P as D,_ as at,C as B,w as Ci}from"./bundle/core.js";import{E as bi,i as vi,g as Ni,a as Hn,f as Oi}from"./bundle/vendor.js";import"./bundle/__commonjsHelpers__.js";r(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}r(t,"getFetchOpts");function s(a){if(a.ep)return;a.ep=!0;const n=t(a);fetch(a.href,n)}r(s,"processPreload")},"polyfill")();const{Valid:Z,Object:oe,String:zn}=d.Utils,dt="is invalid",V=class V{static addDefaultData(e){Z.isObject(e)||this.prototype.exception("default data",dt),Z.isObject(V.data[this.name])||(V.data[this.name]={}),V.data[this.name]=oe.merge(V.data[this.name],e),console.info(`${this.name} default data:`,V.data[this.name])}static addValidateFunction(e,t){Z.isString(e)||this.prototype.exception("validate key",dt),typeof t!="function"&&this.prototype.exception("validate function",dt);const s=`validate${zn.capitalize(e)}`;Object.assign(this.prototype,{[s]:t})}constructor(e){this.defaultData(),this.processData(e)}processData(e){this.validateStructure(e),this.validateData(e),this.setupData(e)}defaultData(){this.lazyDefaultData(V.data[this.constructor.name])}lazyDefaultData(e){Z.isObject(e)||this.exception("data",dt);for(const t in e)if(oe.hasOwn(e,t)){const s=e[t];Object.assign(this,{[t]:s})}}lazyValidateStructure(e){Z.isObject(e)||this.exception("structure","is not object"),this.getKeys().forEach(t=>{const s=this[t];s===void 0&&this.exception("structure",`has no key ${t}`),!oe.hasOwn(e,t)&&s!==void 0&&this.setDefaultData(t,e)})}setDefaultData(e,t){Z.isObject(t)||this.exception("data",dt);const s=this[e];s===void 0&&this.exception("default",`has no key ${e}`),console.warn(`${this.constructor.name}: the "${e}" key will be assigned by default:`,{value:s,type:typeof s}),Object.assign(t,{[e]:s})}lazyValidateData(e){this.getKeys().forEach(t=>{const s=e[t],a=`validate${zn.capitalize(t)}`,n=this[a];if(typeof n=="function")try{n.call(this,s)}catch(i){console.warn(i),this.setDefaultData(t,e)}else this.exception("validate",`has no function ${a}`)})}lazySetupData(e){this.getKeys().forEach(t=>{const s=e[t];Object.assign(this,{[t]:s})})}validate(){this.validateData(this.toObject())}exception(e,t){throw new Error(`${this.constructor.name}: ${e} ${t}`)}toObject(){return Object.fromEntries(Object.entries(this).filter(([e])=>e!=="toObject"))}getKeys(){return Object.keys(this).filter(e=>e!=="toObject")}};r(V,"BaseDtos"),l(V,"data",{});let b=V;d.Dtos={Base:b};const Ti={score:"score",settings:"settings",gameData:"gameData",remoteConfig:"remoteConfig",userGuideDisplays:"userGuideDisplays"},bt={ASID:"9999",playerId:"0000",name:"Guest",photo:"",locale:"en_US",isUserNew:!0,connectedPlayers:{},data:{score:0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:{coins:0,level:1},userGuideDisplays:1}},{Valid:vt}=d.Utils,{playerId:Li,name:Ri,photo:Mi,locale:Gi}=bt,Nt="is invalid",Ls=class Ls extends b{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validatePlayerId(e){(!vt.isString(e)||!e)&&this.exception("playerId",Nt)}validateName(e){(!vt.isString(e)||!e)&&this.exception("name",Nt)}validatePhoto(e){vt.isString(e)||this.exception("photo",Nt)}validateLocale(e){(!vt.isString(e)||!e)&&this.exception("locale",Nt)}toObject(){return super.toObject()}};r(Ls,"PlayerInfoDtos");let nt=Ls;nt.addDefaultData({playerId:Li,name:Ri,photo:Mi,locale:Gi});const H=new nt({playerId:"10",name:"Your Friend"}).toObject(),Rs=class Rs extends Error{constructor(t){super(t);l(this,"code");this.code="CREATE_MATCH_FAILED"}};r(Rs,"ACreateMatchFailed");let M=Rs;const Ms=class Ms extends M{constructor(e){super(e),this.name="PlayerIdNotValid",this.message=e??"Player id is not valid"}};r(Ms,"PlayerIdNotValid");let A=Ms;const{Dtos:re}=d,Gs=class Gs{constructor(e){l(this,"game");l(this,"initContext",r(()=>{const e={contextId:GameSDK.context.getID(),contextType:GameSDK.context.getType(),entryPointData:GameSDK.getEntryPointData()},t=new re.Context.Info(e),{contextId:s,contextType:a,entryPointData:n}=t.toObject();this.game.context.receiveContext(s,a,n)},"initContext"));l(this,"initPlayer",r(async()=>{const{player:e}=this.game,t=this.getPlayerInfo();console.info("playerInfo",d.Utils.Json.clone(t));const s=Object.values(Ti);console.info("dataKeys",s);const a=await GameSDK.player.getDataAsync(s);console.info("rawData",d.Utils.Json.clone(a));const n=new re.Player.Data(a).toObject();console.info("playerData",d.Utils.Json.clone(n)),e.receiveData(t,n),this.game.event.emit(d.Events.PLAYER_INFO_LOADED)},"initPlayer"));l(this,"getPlayerInfo",r(()=>{try{const e=GameSDK.player.getID();let t=GameSDK.player.getName();const s=GameSDK.player.getPhoto(),a=GameSDK.getLocale();if(!d.Utils.Valid.isString(e))throw new A;return d.Utils.Valid.isString(t)||(t="You"),new re.Player.Info({playerId:e,name:t,photo:s,locale:a}).toObject()}catch{return H}},"getPlayerInfo"));this.game=e}};r(Gs,"StateInitiator");let pe=Gs;const $s=class $s extends Error{constructor(t,s){super(t);l(this,"payload");this.name="BadRequest",this.message=t??"This request is bad",this.payload=s}};r($s,"BadRequest");let ft=$s;const Us=class Us extends Error{constructor(t,s){super(t);l(this,"payload");this.name="RequestTimeout",this.message=t??"This request is timeout",this.payload=s}};r(Us,"RequestTimeout");let yt=Us;const{Utils:$i,Configs:Ui}=d,{AppId:qn,Network:Ns}=Ui,_i=r(h=>{if(!h.ok)throw new ft(void 0,{response:h})},"validateResponse"),ci=r(()=>{const h=window.game.auth.getToken();return{token:h,timeout:Ns.Timeout,headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"}}},"defaultConfig"),li=r((h,e,t,s)=>async()=>{try{if(!qn)throw new ft("AppId is not defined");const a=`${h}/apps/${qn}/${e}`,n=new AbortController;t.signal=n.signal;const i=setTimeout(()=>{n.abort()},t.timeout);d.Utils.Valid.isObject(s)&&(t.body=JSON.stringify(s));const o=await fetch(a,t);return clearTimeout(i),_i(o),await o.json()||{}}catch(a){if(a instanceof ft)return null;throw a instanceof Object&&"name"in a&&a.name==="AbortError"?new yt:a}},"requester"),Os=r(async(h,e)=>{try{return h()}catch(t){if(t instanceof yt&&e>0)try{return await $i.Time.sleepAsync(600),await Os(h,e-1)}catch{return{}}return t instanceof yt?{}:(console.warn("Request error",t),{})}},"handleRequest"),it=r(async(h,e={},t,s=Ns.Retries)=>{try{const a={...ci(),...e,method:"GET"},n=li(t,h,a);return await Os(n,s)}catch(a){return console.warn("Get error",a),{}}},"get"),E=r(async(h,e,t={},s,a=Ns.Retries)=>{try{const n={...ci(),...t,method:"POST"},i=li(s,h,n,e);return await Os(i,a)}catch(n){return console.warn("Post error",n),{}}},"post"),{ApiUrl:Vi}=d.Configs.Notification,Fi=r(async h=>{if(!d.Utils.Object.hasOwn(h,"playerId"))throw new Error("Missing playerId");const{playerId:e}=h;await E(`players/${e}`,h,{},Vi,10)},"updatePlayerProfileNotificationAsync");var hi=(h=>(h.IDLE="idle",h.LOADING="loading",h.FILLED="filled",h.SHOWING="showing",h))(hi||{});const di=hi;var ui=(h=>(h.BANNER="banner",h.INTERSTITIAL="interstitial",h.REWARDED_VIDEO="rewarded_video",h))(ui||{});const j=ui;var Pt;let ut=(Pt=class extends Error{constructor(t,s){super(s);l(this,"code");this.code=t,this.message=s}},r(Pt,"AdError"),Pt);const _s=class _s{constructor(e,t){l(this,"type");l(this,"status");l(this,"placementId");this.type=e,this.status=di.IDLE,this.placementId=t}getStatus(){return this.status}exception(e){throw new ut("AD_INSTANCE_ERROR",e)}};r(_s,"BaseInstance");let fe=_s;var xt;let pi=(xt=class extends fe{loadAsync(){this.exception("This method is not implemented")}showAsync(){this.exception("This method is not implemented")}hideAsync(){this.exception("Unsupported method")}},r(xt,"AdInstance"),xt);d.Plugins.Ads={Types:j,Status:di,AdError:ut,AdInstance:pi};const Vs=class Vs extends D.Plugins.BasePlugin{constructor(){super(...arguments);l(this,"enabled");l(this,"config");l(this,"isAdShowed");l(this,"lastAdShownTime");l(this,"ads",{});l(this,"safeAreaBottom")}init(){this.isAdShowed=!1,this.lastAdShownTime=0,this.calculateSafeAreaBottom()}calculateSafeAreaBottom(){try{const t=getComputedStyle(document.documentElement).getPropertyValue("--sab");this.safeAreaBottom=parseInt(t,10),isNaN(this.safeAreaBottom)&&(this.safeAreaBottom=0)}catch{this.safeAreaBottom=0}}configure(t){this.config=t,this.enabled=this.config.Enabled}checkEnabled(){if(!this.enabled)throw new ut("ADS_NOT_ENABLED","Ads is't enabled")}isAdShowing(){return this.isAdShowed}setAdInstance(t,s,a){if(this.ads[s]){console.warn(`AdsPlugin: Ad instance with placementId ${s} already exists`);return}this.ads[s]={type:t,placementId:s,interval:null,instance:new a(t,s)}}async preloadInterstitialAdAsync(){await this.loadAdAsync(j.INTERSTITIAL)}async showInterstitialAdAsync(){if(!this.canbeShowInterstitialAd())throw new ut("INTERSTITIAL_AD_CAN_NOT_SHOW","Can't show interstitial ad");await this.showAdAsync(j.INTERSTITIAL)}async preloadRewardedVideoAsync(){await this.loadAdAsync(j.REWARDED_VIDEO)}async showRewardedVideoAsync(){await this.showAdAsync(j.REWARDED_VIDEO)}async loadAdAsync(t,s){this.checkEnabled(),await this.getAd(t,s).instance.loadAsync()}async showAdAsync(t,s){this.checkEnabled();const a=this.getAd(t,s);this.lastAdShownTime=window.performance.now()/1e3,this.isAdShowed=!0;try{await a.instance.showAsync()}finally{this.isAdShowed=!1}}getAdStatus(t,s){return this.checkEnabled(),this.getAd(t,s).instance.getStatus()}getAd(t,s){let a=null;if(s?a=this.getAdByPlacementId(s):a=this.getPriorityAdByType(t),!a)throw new ut("AD_INSTANCE_NOT_INITIATED","The instance ads not yet initiated");return a}getAdsByType(t){return Object.values(this.ads).filter(s=>s.type===t)}getAdByPlacementId(t){const s=this.ads[t];return s||null}getPriorityAdByType(t){const s=this.getAdsByType(t);if(!s.length)return null;const a=s.find(n=>n.type===t);return a||null}canbeShowInterstitialAd(t){return this.canbeShowInterstitialAdByTime(t)}canbeShowInterstitialAdByTime(t){try{const s=window.performance.now()/1e3;let a;if(t)a=this.getCommonAdConfig(t);else{const c=this.getPriorityAdByType(j.INTERSTITIAL);if(!c)return!1;a=this.getCommonAdConfig(c.placementId)}const{SecondsBetweenAds:n,SecondsFirstTime:i}=a,o=s-this.lastAdShownTime;return this.lastAdShownTime>0?o>n:o>i}catch(s){return console.warn("Error while checking canbeShowInterstitialAdByTime",s),!1}}canbeShowBannerAd(t){try{const s=this.getBannerConfig(t),{Platform:a}=s;if(a==="ALL")return!0;const n=GameSDK.getPlatform();return n?n===a:!1}catch(s){return console.warn("Error while checking canbeShowBannerAd",s),!1}}async showBannerAdAsync(t){this.checkEnabled();const s=this.getAd(j.BANNER,t);if(!this.canbeShowBannerAd(s.placementId))throw new Error("Banner ad can not be shown");this.cleanBannerReloadTimer(s.placementId),await s.instance.showAsync();const a=this.getBannerConfig(s.placementId),{SecondsReload:n}=a;n<=0||(s.interval=setTimeout(()=>{this.showBannerAdAsync(s.placementId)},n*1e3))}async hideBannerAdAsync(t){this.checkEnabled();const s=this.getAd(j.BANNER,t);this.cleanBannerReloadTimer(s.placementId),await s.instance.hideAsync()}cleanBannerReloadTimer(t){try{const s=this.getAd(j.BANNER,t),{interval:a}=s;if(!a)return;clearInterval(a)}catch(s){console.warn("Error while cleaning banner reload timer",s)}}getCommonAdConfig(t){const a=[...this.config.InterstitialAdOptions,...this.config.RewardedVideoAdOptions].find(n=>n.PlacementId===t);if(!a)throw new Error(`Ad config with placementId ${t} not found`);return a}getBannerConfig(t){const s=this.config.BannerDisplayAdOptions.find(a=>a.PlacementId===t);if(!s)throw new Error(`Banner config with placementId ${t} not found`);return s}getBannerHeight(t){this.checkEnabled();const s=this.safeAreaBottom,a=this.getBannerConfig(t),{BannerHeight:n}=a;return n+s}};r(Vs,"AdsPlugin");let ye=Vs;var fi=(h=>(h.BUTTON_CLICK="button_click",h.SCREEN_OPEN="screen_open",h.LOAD_START="load_start",h.LOAD_COMPLETE="load_complete",h.APP_READY="app_ready",h.TUTORIAL_BEGIN="tutorial_begin",h.TUTORIAL_STEP="tutorial_step",h.TUTORIAL_COMPLETE="tutorial_complete",h.MATCH_START="match_start",h.MATCH_RESCUE="match_rescue",h.MATCH_END="match_end",h.LEVEL_START="level_start",h.LEVEL_RESCUE="level_rescue",h.LEVEL_END="level_end",h.SHARE="share",h.MESSAGE="message",h.INVITE="invite",h.SHORTCUT_CREATE="shortcut_create",h.SHORTCUT_CREATE_POPUP="shortcut_create_popup",h.BOT_SUBSCRIBE="bot_subscribe",h.BOT_SUBSCRIBE_POPUP="bot_subscribe_popup",h.AD_SHOW="ad_show",h.AD_SHOW_FAILED="ad_show_failed",h.NEW_USER="new_user",h.AD_IMPRESSION="ad_impression",h.JOIN_GROUP="join_group",h.TOURNAMENT_SHARE="tournament_share",h.TOURNAMENT_CREATE="tournament_create",h.TOURNAMENT_POST_SCORE="tournament_post_score",h))(fi||{});const ji=fi;var Et;let Bi=(Et=class{constructor(e,t,s){l(this,"name");l(this,"color");l(this,"options");l(this,"selfLog");this.name=e,this.color=s||"#FFF",this.options=t,this.selfLog=!0,console.info(`%c${this.name}: init`,`color: ${this.color}`,this.options)}event(e,t,s){this.processEvent(e,t,s),this.selfLog&&console.info(`%c${this.name}: event`,`color: ${this.color}`,{name:e,value:s,payload:t})}pageview(e){const t=this.getPageByKey(e);this.processPageView(t),this.selfLog&&console.info(`%c${this.name}: pageview`,`color: ${this.color}`,{page:t})}levelStart(e,t,s){this.processLevelStart(e,t,s),this.selfLog&&console.info(`%c${this.name}: level start`,`color: ${this.color}`,{level:e,score:t,levelName:s})}levelFail(e,t,s){this.processLevelFail(e,t,s),this.selfLog&&console.info(`%c${this.name}: level fail`,`color: ${this.color}`,{level:e,score:t,levelName:s})}levelRescue(e,t,s){this.processLevelRescue(e,t,s),this.selfLog&&console.info(`%c${this.name}: level rescue`,`color: ${this.color}`,{level:e,score:t,levelName:s})}levelComplete(e,t,s){this.processLevelComplete(e,t,s),this.selfLog&&console.info(`%c${this.name}: level complete`,`color: ${this.color}`,{level:e,score:t,levelName:s})}showInterstitialAd(e){this.processShowInterstitialAd(e),this.selfLog&&console.info(`%c${this.name}: show interstitial ad`,`color: ${this.color}`,{placement:e})}showRewardedVideoAd(e){this.processShowRewardedVideoAd(e),this.selfLog&&console.info(`%c${this.name}: show rewarded video ad`,`color: ${this.color}`,{placement:e})}receiveVideoReward(e){this.processReceiveReward(e),this.selfLog&&console.info(`%c${this.name}: receive reward`,`color: ${this.color}`,{placement:e})}showAdFail(e,t,s){this.processShowAdFail(e,t,s),this.selfLog&&console.info(`%c${this.name}: show ad fail`,`color: ${this.color}`,{type:e,placement:t,reason:s})}getPageByKey(e){let t=e.replace(/_/g,"-");return t=t.toLowerCase(),t}processEvent(e,t,s){throw new Error("Method not implemented.")}processLevelStart(e,t,s){throw new Error("Method not implemented.")}processLevelFail(e,t,s){throw new Error("Method not implemented.")}processLevelRescue(e,t,s){throw new Error("Method not implemented.")}processLevelComplete(e,t,s){throw new Error("Method not implemented.")}processShowInterstitialAd(e){throw new Error("Method not implemented.")}processShowRewardedVideoAd(e){throw new Error("Method not implemented.")}processReceiveReward(e){throw new Error("Method not implemented.")}processShowAdFail(e,t,s){throw new Error("Method not implemented.")}processPageView(e){throw new Error("Method not implemented.")}},r(Et,"BaseAnalytics"),Et);d.Plugins.Analytics={Events:ji,BaseAnalytics:Bi};const Fs=class Fs extends D.Plugins.BasePlugin{constructor(){super(...arguments);l(this,"analytics",[]);l(this,"placement","unknown");l(this,"pageview",r(t=>{this.isActive()&&this.analytics.forEach(s=>{s.pageview(t)})},"pageview"))}add(t){this.analytics.push(t)}event(t,s,a){this.isActive()&&this.analytics.forEach(n=>{n.event(t,s,a)})}levelStart(t,s,a){this.isActive()&&this.analytics.forEach(n=>{n.levelStart(t,s,a)})}levelRescue(t,s,a){this.isActive()&&this.analytics.forEach(n=>{n.levelRescue(t,s,a)})}levelFail(t,s,a){this.isActive()&&this.analytics.forEach(n=>{n.levelFail(t,s,a)})}levelComplete(t,s,a){this.isActive()&&this.analytics.forEach(n=>{n.levelComplete(t,s,a)})}showInterstitialAd(){if(!this.isActive())return;const t=this.getCurrentPlacement();this.analytics.forEach(s=>{s.showInterstitialAd(t)})}showRewardedVideoAd(){if(!this.isActive())return;const t=this.getCurrentPlacement();this.analytics.forEach(s=>{s.showRewardedVideoAd(t)})}receiveVideoReward(){if(!this.isActive())return;const t=this.getCurrentPlacement();this.analytics.forEach(s=>{s.receiveVideoReward(t)})}showAdFail(t,s,a){this.isActive()&&this.analytics.forEach(n=>{n.showAdFail(t,s,a)})}isActive(){return this.analytics.length>=1}setPlacement(t){this.placement=t}getCurrentPlacement(){return this.placement}};r(Fs,"AnalyticsPlugin");let ge=Fs;const js=class js{constructor(e){l(this,"key");this.key=e}getKey(){return this.key}};r(js,"BaseAudioPlayer");let me=js;const Bs=class Bs{constructor(e){l(this,"id");l(this,"isMuteAll");l(this,"masterVolume");l(this,"audioClips");this.id=e,this.masterVolume=1,this.isMuteAll=!1,this.audioClips={}}getId(){return this.id}getAudioClip(e){return this.audioClips[e]?this.audioClips[e]:null}setAudioClip(e,t){this.audioClips[e]={...this.audioClips[e],...t}}play(e,t){const s=this.getAudioClip(e);if(s){const{audioPlayer:a}=s;this.playWithRealConfig(a,t)}else this.loadAndPlay(e,t)}async loadAndPlay(e,t){try{const s=await this.onLoadAudio(e,t),{volume:a=1}=t||{};this.setAudioClip(e,{volume:a,audioPlayer:s}),this.playWithRealConfig(s,t)}catch(s){console.warn("playAudio",s)}}playWithRealConfig(e,t){if(t){const{volume:s=1}=t;t.volume=this.masterVolume*s}e.play(t)}pause(e){const t=this.getAudioClip(e);if(!t)return!1;const{audioPlayer:s}=t;return s.pause(),!0}resume(e){const t=this.getAudioClip(e);if(!t)return!1;const{audioPlayer:s}=t;return s.resume(),!0}stop(e){const t=this.getAudioClip(e);if(!t)return!1;const{audioPlayer:s}=t;return s.stop(),!0}stopAll(){this.callAudioPlayers("stop")}muteAll(){this.isMuteAll||(this.isMuteAll=!0,this.callAudioPlayers("mute"))}unmuteAll(){this.isMuteAll&&(this.isMuteAll=!1,this.callAudioPlayers("unmute"))}setVolume(e){this.masterVolume=e,this.callAudioPlayers("setVolume")}getVolume(){return this.masterVolume}queueAudioPlayer(e,t){try{const{audioPlayer:s,volume:a=1}=e;switch(t){case"play":s.play();break;case"pause":s.pause();break;case"resume":s.resume();break;case"stop":s.stop();break;case"mute":s.setVolume(0);break;case"unmute":case"setVolume":s.setVolume(this.masterVolume*a);break;default:throw new Error(`Unsupported function: ${t}`)}}catch(s){console.warn("queueAudioPlayer",s)}}callAudioPlayers(e){Object.values(this.audioClips).forEach(s=>{this.queueAudioPlayer(s,e)})}};r(Bs,"BaseChannelManager");let we=Bs;d.Plugins.Audio={BaseAudioPlayer:me,BaseChannelManager:we};const ks=class ks extends D.Plugins.BasePlugin{constructor(){super(...arguments);l(this,"firstChannelId");l(this,"channels",{})}addChannel(t){const s=t.getId();this.channels[s]=t,this.firstChannelId||(this.firstChannelId=s)}getChannel(t){if(t===void 0)return this.channels[this.firstChannelId];const s=this.channels[t];if(!s)throw new Error(`Channel ${t} not found`);return s}play(t,s,a){try{this.getChannel(a).play(t,s)}catch(n){console.warn("playSound",n)}}pause(t,s){try{this.getChannel(s).pause(t)}catch(a){console.warn("pauseSound",a)}}resume(t,s){try{this.getChannel(s).resume(t)}catch(a){console.warn("resumeSound",a)}}stop(t,s){try{this.getChannel(s).stop(t)}catch(a){console.warn("stopSound",a)}}stopAll(t){try{this.getChannel(t).stopAll()}catch(s){console.warn("stopAllSounds",s)}}mute(t){try{this.getChannel(t).muteAll()}catch(s){console.warn("mute",s)}}unmute(t){try{this.getChannel(t).unmuteAll()}catch(s){console.warn("unmute",s)}}setVolume(t,s){try{this.getChannel(s).setVolume(t)}catch(a){console.warn("setSoundVolume",a)}}};r(ks,"AudioPlugin");let Ae=ks;const ki={token:"",isRequesting:!1},Ks=class Ks extends D.Plugins.BasePlugin{init(){const{storage:e}=this.game;e.addStorage("auth",ki)}async requestToken(){const{storage:e}=this.game;try{if(e.getStorageData("auth","isRequesting")||e.getStorageData("auth","token")!=="")return;e.setStorageData("auth","isRequesting",!0);const n=(await GameSDK.player.getSignedPlayerInfoAsync()).getSignature();e.setStorageData("auth","token",n)}catch(t){if(d.Utils.Object.hasOwn(t,"code")&&t.code==="PENDING_REQUEST")return;e.setStorageData("auth","token",""),console.error(t)}finally{e.setStorageData("auth","isRequesting",!1)}}getToken(){const{storage:e}=this.game;return e.getStorageData("auth","token")}};r(Ks,"AuthPlugin");let Ie=Ks;var yi=(h=>(h.SOLO="solo",h.TOURNAMENT="tournament",h.SHARE_INVITE="share_invite",h.MATCHING_GROUP="matching_group_match",h.CHALLENGE_FRIEND="challenge_friend_match",h))(yi||{});const z=yi;var gi=(h=>(h.SINGLE="single",h.ONLINE="online",h.TOURNAMENT="tournament",h.MATCHING_GROUP="matching-group",h.CHALLENGE_FRIEND="challenge-friend",h))(gi||{});const R=gi,Ki=R,Q=Ki,Hs=class Hs{constructor(e){l(this,"game");this.game=e}isValidContextType(e){return["THREAD","POST","SOLO","GROUP"].indexOf(e)>=0}isValidEntryPointData(e){return d.Utils.Valid.isObject(e)}receiveContext(e,t,s){const{storage:a}=this.game;a.setStorageData("context","contextId",e),this.isValidEntryPointData(s)?a.setStorageData("context","entryPointData",s):console.warn(`Invalid context type: ${t}`),this.isValidContextType(t)?a.setStorageData("context","contextType",t):console.warn(`Invalid context type: ${t}`)}async detectContextSessionType(){const{storage:e}=this.game,t=e.getStorageData("context","entryPointData"),{type:s}=t,{SOLO:a,TOURNAMENT:n,MATCHING_GROUP:i,SHARE_INVITE:o,CHALLENGE_FRIEND:c}=z;let u=a;if(s===n&&(u=n),s===i&&(u=i),(s===c||s===o)&&(u=c),u===a)try{if(!("getTournamentAsync"in GameSDK))throw new Error("Unavailable feature: tournament");await GameSDK.getTournamentAsync(),u=n}catch{}e.setStorageData("context","sessionContextType",u)}detectContextGameMode(){const{player:e,storage:t}=this.game,s=t.getStorageData("context","entryPointData"),a=t.getStorageData("context","sessionContextType"),n=e.getPlayerId(),{matchId:i,playerId:o,opponentId:c=H.playerId}=s,u=n===o,f=c===H.playerId||[c,o].indexOf(n)>=0,{TOURNAMENT:y,MATCHING_GROUP:g,SHARE_INVITE:C,CHALLENGE_FRIEND:N}=z;let x=Q.SINGLE;a===y&&(x=Q.TOURNAMENT),a===C&&!u&&(x=Q.CHALLENGE_FRIEND),a===N&&i&&f&&(x=Q.CHALLENGE_FRIEND),a===g&&(x=Q.MATCHING_GROUP),t.setStorageData("context","contextGameMode",x)}};r(Hs,"Context");let De=Hs;const zs=class zs extends Error{constructor(e){super(e),this.name="PlayerHasFinishedMatch",this.message=e||"Player has finished match"}};r(zs,"PlayerHasFinishedMatch");let Bt=zs;const qs=class qs extends Error{constructor(e){super(e),this.name="PlayerNotJoinInMatch",this.message=e||"Player is not join in match"}};r(qs,"PlayerNotJoinInMatch");let kt=qs;const{Events:ce,Plugins:Hi}=d,{Analytics:zi}=Hi,Ws=class Ws{constructor(e){l(this,"game");l(this,"processTournamentMode",r(async()=>{const{match:e,player:t}=this.game,s=t.getPlayerId(),a=GameSDK.context.getID();if(typeof a!="string")throw new Error("Cannot get contextId");await e.tournament.continue.processAsync({playerId:s,contextId:a}),this.switchToGameScene()},"processTournamentMode"));l(this,"switchToDashboardScene",r(()=>{const{event:e}=this.game;e.emit(ce.SWITCH_SCENE,{sceneName:"DashboardScene",sceneData:{isContextProcessing:!0}})},"switchToDashboardScene"));l(this,"switchToGameScene",r(()=>{const{event:e}=this.game;e.emit(ce.SWITCH_SCENE,{sceneName:"GameScene",sceneData:{isContextProcessing:!0}})},"switchToGameScene"));l(this,"switchToResultScene",r(()=>{const{event:e}=this.game;e.emit(ce.SWITCH_SCENE,{sceneName:"ResultScene",sceneData:{isContextProcessing:!0}})},"switchToResultScene"));this.game=e}async processContextData(){const{player:e,analytics:t,storage:s}=this.game,a=e.getPlayer(),n=s.getStorageData("context","contextId"),i=s.getStorageData("context","entryPointData"),o=s.getStorageData("context","sessionContextType"),{type:c,matchId:u,playerId:p,opponentId:f,playerScore:y}=i||{};a.isUserNew&&t.event(zi.Events.NEW_USER);const{TOURNAMENT:g,SHARE_INVITE:C,MATCHING_GROUP:N,CHALLENGE_FRIEND:x}=z;if(o===g){this.processTournamentMode();return}if(o===x){if(c===C&&typeof p=="string"){await this.processChallengeFromPost(p);return}if(c===x&&typeof u=="string"&&typeof p=="string"&&typeof f=="string"){await this.processChallengeFromMessage({contextId:n,matchId:u,playerId:p,opponentId:f});return}}if(o===N&&typeof p=="string"&&typeof y=="number"){await this.processMatchingGroupMode(p,y);return}this.switchToDashboardScene()}async processChallengeFromPost(e){const{match:t,player:s}=this.game,a=s.getPlayerId();if(a===e)throw new Error("Cannot play with yourself");await t.challenge.friend.processAsync({playerId:a,opponentId:e}),this.switchToGameScene()}async processChallengeFromMessage(e){try{await this.processContinueChallengeFromMessage(e);return}catch(t){if(t instanceof Bt){this.switchToResultScene();return}if(t instanceof kt){await this.processJoinChallengeFromMessage(e);return}}}async processContinueChallengeFromMessage(e){const{contextId:t,matchId:s,playerId:a,opponentId:n}=e,{match:i,player:o}=this.game,c=o.getPlayerId();if(a===c)await i.challenge.continue.processAsync({contextId:t,matchId:s,playerId:c,opponentId:n});else{const p=n===H.playerId;await i.challenge.continue.processAsync({contextId:t,matchId:s,playerId:c,opponentId:p?n:a})}this.switchToGameScene()}async processJoinChallengeFromMessage(e){const{contextId:t,matchId:s,playerId:a}=e,{match:n,player:i}=this.game,o=i.getPlayerId();await n.challenge.join.processAsync({contextId:t,matchId:s,playerId:o,opponentId:a}),this.switchToGameScene()}async processMatchingGroupMode(e,t){const{match:s,player:a}=this.game;await s.group.join.processAsync({playerId:a.getPlayerId(),opponentId:e,opponentScore:t}),this.switchToGameScene()}async processNewUserMode(){const{match:e,player:t}=this.game,s=t.getPlayerId();await e.single.start.processAsync({playerId:s}),this.switchToGameScene()}};r(Ws,"Loader");let Se=Ws;const mi={processed:!1,contextId:"",contextType:"SOLO",entryPointData:{},contextGameMode:"",sessionContextType:""},Qs=class Qs extends D.Plugins.BasePlugin{constructor(t){super(t);l(this,"context");l(this,"loader");this.loader=new Se(t),this.context=new De(t)}init(){const{storage:t}=this.game;t.addStorage("context",mi)}getSessionContextTypes(){return z}async processContextData(){try{await this.loader.processContextData()}catch(t){console.error("processContextData",t)}}async detectContextSessionType(){try{await this.context.detectContextSessionType()}catch(t){console.error("detectContextSessionType",t)}}detectContextGameMode(){this.context.detectContextGameMode()}receiveContext(t,s,a){this.context.receiveContext(t,s,a)}};r(Qs,"ContextPlugin");let Pe=Qs;const{Valid:le}=d.Utils,{contextId:qi,contextType:Wi,entryPointData:Qi}=mi,he="is invalid",Ys=class Ys extends b{constructor(){super(...arguments);l(this,"data")}setupData(t){this.lazySetupData(t)}validateStructure(t){this.lazyValidateStructure(t)}validateData(t){this.lazyValidateData(t)}validateContextId(t){le.isString(t)||this.exception("contextId",he)}validateContextType(t){(!le.isString(t)||!t)&&this.exception("contextType",he)}validateEntryPointData(t){le.isObject(t)||this.exception("entryPointData",he)}toObject(){return super.toObject()}};r(Ys,"ContextInfoDtos");let Kt=Ys;Kt.addDefaultData({contextId:qi,contextType:Wi,entryPointData:Qi});d.Dtos.Context={Info:Kt};const K=new bi,Yi={names:[],history:[]},Xs=class Xs extends D.Plugins.BasePlugin{constructor(){super(...arguments);l(this,"enableLog",!1)}init(){const{storage:t}=this.game;t.addStorage("event",Yi)}enableLogEvent(){this.enableLog=!0}on(t,s){this.validateCallback(s),this.addEventName(t),this.addHistory(t,"on","listening"),K.on(t,s)}once(t,s){this.validateCallback(s),this.addEventName(t),this.addHistory(t,"once","listening"),K.once(t,s)}off(t,s){this.validateCallback(s),K.off(t,s),this.addHistory(t,"on","removed")}clear(t){K.removeAllListeners(t),this.addHistory(t,"on","removed")}emit(t,s){let a=[];s&&(a=[s]),this.addHistory(t,"on","called",s),K.emit(t,...a)}validateCallback(t){if(typeof t!="function")throw new Error("Callback must be a function")}addEventName(t){const{storage:s}=this.game,a=s.getStorageData("event","names");a.includes(t)||a.push(t)}getEventListeners(){const t=K.eventNames();return Object.keys(t)}getEventEmitCount(t){const{storage:s}=this.game;return s.getStorageData("event","history").filter(n=>n.name===t&&n.status==="called").length}getHistory(){const{storage:t}=this.game;return t.getStorageData("event","history")}addHistory(t,s,a,n){var p,f;const i=this.getHistory(),o=(p=i.find(y=>y.name===t))==null?void 0:p.type,c=((f=i.find(y=>y.name===t))==null?void 0:f.called)??0,u=a==="called"?c+1:c;i.push({type:o??s,status:a,name:t,called:u,payload:n??{}}),this.logEventInfo(t,s,a,u)}logEventInfo(t,s,a,n){if(this.enableLog){if(a==="listening"){console.info(`Event (${s}) ${t}: ${a}`);const i=K.listenerCount(t);i>1&&console.warn(`Event ${t} has ${i} listener`)}else console.info(`Event (${s}) ${t}: ${a} (${n} times)`);a==="called"&&K.listenerCount(t)>1&&console.warn(`Event ${t} is called but not listening`)}}};r(Xs,"EventPlugin");let xe=Xs;const Xi='nunito,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif',Ji=r((h,e)=>{if(isNaN(h)||isNaN(e))throw new Error("width and height must be numbers");return{string:"+",style:"font-size: 1px; padding: "+Math.floor(e/2)+"px "+Math.floor(h/2)+"px;"}},"getBox"),Zi=r((h,e=1)=>{const t=new Image;t.onload=function(){const s=this,a=s.width*e,n=s.height*e,i=Ji(a,n);console.info(`%c ${i.string}`,`${i.style} background: transparent url(${h}) no-repeat center center; background-size: ${a}px ${n}px;`)},t.src=h},"logImage"),Js=class Js extends D.Plugins.BasePlugin{constructor(){super(...arguments);l(this,"width");l(this,"height");l(this,"canvas",null);l(this,"renderOptions");l(this,"caches",{})}preload(t){const s=Object.keys(t);s.length<1||s.forEach(a=>{const n=t[a];n&&this.loadImage(a,n)})}async capture(t){const{width:s,height:a,renderOptions:n}=t;return this.width=s,this.height=a,this.renderOptions=n,this.createCanvas(),await this.loadImages(),this.drawObjects(),this.snapshotFrame()}createCanvas(){this.canvas?this.canvas.remove():this.canvas=document.createElement("canvas",{is:"canvas"}),this.canvas.width=this.width,this.canvas.height=this.height}async loadImage(t,s){return new Promise((a,n)=>{if(this.caches[t]){a();return}const i=document.createElement("img");i.src=s,i.onload=()=>{this.caches[t]=i,a()},i.onerror=o=>{n(o)}})}async loadImages(){const t=[];for(const s in this.renderOptions){const{name:a,image:n}=this.renderOptions[s];if(!n||this.caches[a])continue;const o=this.loadImage(a,n);t.push(o)}await Promise.all(t)}drawObjects(){for(const t in this.renderOptions){const s=this.renderOptions[t];switch(s.type){case"text":this.drawText(s);break;case"image":this.drawImage(s);break}}}drawText(t){if(!this.canvas)return;const s=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!s)return;const{x:a,y:n,font:i,text:o,fillStyle:c,lineWidth:u,textAlign:p}=t;s.font=`${i} ${Xi}`,s.fillStyle=c||"#ffffff",u&&(s.lineWidth=u),p&&(s.textAlign=p),s.fillText(o,a,n)}drawImage(t){if(!this.canvas)return;const s=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!s)return;const{x:a,y:n,name:i,width:o,height:c,fallbackWithImage:u}=t;let p=this.caches[i];if(!p&&u)p=this.caches[u];else if(!p)throw new Error(`Image ${i} not found`);s.drawImage(p,a,n,o,c)}snapshotFrame(){if(!this.canvas)return"";const t=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!t)return"";const s=t.canvas.toDataURL("image/jpeg",.85);return d.Utils.Valid.isDebugger()&&Zi(s),s}};r(Js,"FrameCapturePlugin");let Ee=Js;const{Utils:Wn}=d,Zs=class Zs extends D.Plugins.BasePlugin{constructor(){super(...arguments);l(this,"locale");l(this,"data",{})}add(t,s){this.data[t]=s}choose(t){this.locale=t;const{event:s}=this.game;s.emit(d.Events.LANGUAGE_CHANGED,{locale:t})}getText(t,s,a){const{text:n}=this.getLocaleData(a);if(!Wn.Object.hasOwn(n,t)){const o=a??this.getCurrentLocale();return console.warn(`Text with key "${String(t)}" not found in locale "${o}"`),String(t)}const i=n[t];return this.replaceVariables(i,s??[])}getTexture(t){const{texture:s}=this.getLocaleData();return s[t]}getCurrentLocale(){return this.locale||"en"}getLocaleData(t){const s=t??this.getCurrentLocale();if(!Wn.Object.hasOwn(this.data,s))throw new Error(`Locale "${s}" not found`);return this.data[s]}replaceVariables(t,s){const a=s.length;if(a==0)return t;let n=t;for(let i=0;i<a;i++){const o=s[i],c=`%{${i}}`;n=n.replace(c,o)}return n}};r(Zs,"LanguagePlugin");let Ce=Zs;const{OtherHost:wi}=d.Configs,Qn=r(async(h,e)=>{const t=d.Utils.String.params(e),s=await it(`${h}?${t}`,{},wi);return d.Utils.Valid.isObject(s)?d.Utils.Object.hasOwn(s,"data")&&Array.isArray(s.data)?s.data:[]:[]},"getLeaderboardAsync"),to=r(async(h,e,t)=>{await E(`leaderboards/${h}/players/${e}`,{score:t},{},wi)},"setLeaderboardScoreAsync"),Yn={id:"",type:"",limit:0,offset:0,leaders:{},isRequesting:!1},eo={leaderboards:{}},ta=class ta extends D.Plugins.BasePlugin{constructor(){super(...arguments);l(this,"configs")}init(){const{storage:t}=this.game;t.addStorage("leaderboard",eo),this.configs={}}addLeaderboard(t,s,a,n){if(this.getLeaderboard(t))return;const{LeaderboardId:o}=n;let c=`leaderboards/${o}/`;a==="global"?c+="leaders":a==="friend"&&(c+="players"),this.configs[t]={id:t,type:a,host:c,mock:s},this.setLeaderboard(t,{...Yn})}async requestLeaderboard(t,s){try{this.validateLeaderboard(t),this.clearLeaderboard(t),this.setLeaderboard(t,{isRequesting:!0});const{type:a,host:n,playerIds:i}=this.configs[t],o={limit:s,offset:0,playerIds:i};if(a==="friend"&&!i){const{player:u}=this.game,p=u.getPlayerId(),f=u.getConnectedPlayerIds(s,0);o.playerIds=[p,...f]}const c=await Qn(n,o);await this.receiveLeaderboard(t,c),this.setLeaderboard(t,{limit:s,offset:0})}finally{this.setLeaderboard(t,{isRequesting:!1})}}async loadMoreLeaderboard(t,s){try{const a=this.getLeaderboard(t);if(!a)return;this.setLeaderboard(t,{isRequesting:!0});const{host:n}=this.configs[t],{offset:i}=a,o=i+s,c=await Qn(n,{limit:s,offset:o});this.receiveLeaderboard(t,c),this.setLeaderboard(t,{limit:s,offset:o})}finally{this.setLeaderboard(t,{isRequesting:!1})}}getLeaderboard(t){const{storage:s}=this.game,a=s.getStorageData("leaderboard","leaderboards");return a[t]?a[t]:null}clearLeaderboard(t){try{this.validateLeaderboard(t),this.setLeaderboard(t,{...Yn})}catch(s){console.warn(s)}}isLeaderboardEmpty(t){const s=this.getLeaderboard(t);if(!s)return!0;const{leaders:a}=s;return Object.keys(a).length===0}async setLeaderboardScore(t,s,a){try{this.validateLeaderboard(t),await to(t,s,a)}catch(n){console.warn(n)}}validateLeaderboard(t){const{storage:s}=this.game;if(!s.getStorageData("leaderboard","leaderboards")[t])throw new Error(`Leaderboard with id ${t} not found`)}setLeaderboard(t,s){const{storage:a}=this.game;a.setStorageData("leaderboard","leaderboards",{[t]:s})}async receiveLeaderboard(t,s){this.validateLeaderboard(t);const{profile:a}=this.game,n=s.map(y=>y.playerId);await a.requestProfiles(n);const i=a.getProfiles(),p=s.map(y=>{const g=i[y.playerId];return g?{...y,...g}:{...y,name:"Unknown",photo:""}}).filter(y=>y.name&&y.photo).toSorted((y,g)=>g.score-y.score).map((y,g)=>({...y,rank:g+1})),f=d.Utils.Object.keyBy(p,"playerId");this.setLeaderboard(t,{leaders:f})}};r(ta,"LeaderboardPlugin");let be=ta;const ea=class ea{constructor(){l(this,"APIHost")}setAPIHost(e){this.APIHost=e}getAPIHost(){return this.APIHost}};r(ea,"BaseAPI");let gt=ea;const{Utils:de}=d,sa=class sa extends gt{constructor(){super(...arguments);l(this,"appId")}setAppId(t){this.appId=t}async setLeaderboardScoreAsync(t){const{leaderboardId:s,playerId:a,score:n=0}=t,i=`leaderboards/${s}/players/${a}`;await E(i,{score:n},{},this.getAPIHost())}async createLeaderboardAsync(t){const s={_id:t._id,appId:this.appId,resetScore:t.resetScore||0,numberOfLeaders:t.numberOfLeaders||15,timezone:t.timezone||"utc+0",sortOrder:t.sortOrder||"desc",statistics:t.statistics||"max",resettable:t.resettable||"manually",description:t.description||"no description",createdBy:t.createdBy,name:t.name,expireTime:t.expireTime||6048e5};await E("leaderboards",s,{},this.getAPIHost())}async getLeaderboardAsync(t,s={}){let a=[];const n=de.String.params(s),i=`leaderboards/${t}/leaders`,o=await it(`${i}?${n}`,{},this.getAPIHost());return de.Valid.isObject(o)?de.Object.hasOwn(o,"data")?(a=o.data,a):[]:[]}};r(sa,"LeaderboardAPI");let ve=sa;const{Utils:Xn}=d,aa=class aa extends gt{async createSingleMatchAsync(e){const s=await E("single-matches",e,{},this.getAPIHost());return this.returnValidMatchData(s)}async getSingleMatchDetailAsync(){const t=await it("single-matches/active",{},this.getAPIHost());return this.returnValidMatchData(t)}async updateSingleMatchMoveAsync(e,t){const s=`single-matches/${e}/move`,a=await E(s,t,{},this.getAPIHost());return this.returnValidMatchData(a)}async finishSingleMatchAsync(e){const t=`single-matches/${e}/finish`,s=await E(t,{},{},this.getAPIHost());return this.returnValidMatchData(s)}async createMatchAsync(e){const s=await E("matches",{opponentPlayerId:e},{},this.getAPIHost());return this.returnValidMatchData(s)}async joinMatchAsync(e){const t=`matches/${e}/join`,s=await E(t,{},{},this.getAPIHost());return this.returnValidMatchData(s)}async getMatchDetailByIdAsync(e){const t=`matches/${e}`,s=await it(t,{},this.getAPIHost());return this.returnValidMatchData(s)}async finishMatchAsync(e){const{matchId:t="",score:s=0,level:a=0,extraData:n={}}=e,i=`matches/${t}/finish`,o=await E(i,{matchId:t,score:s,level:a,extraData:n},{},this.getAPIHost());return this.returnValidMatchData(o)}returnValidMatchData(e){let t={};return!Xn.Valid.isObject(e)||!Xn.Object.hasOwn(e,"data")||(t=e.data),t}};r(aa,"MatchAPI");let Ne=aa;const{Utils:Ot}=d,na=class na extends gt{async getPlayersAsync(e){const t=Ot.String.params(e),s=await it(`players?${t}`,{},this.getAPIHost());return!Ot.Valid.isObject(s)||!Ot.Object.hasOwn(s,"data")?null:s.data}async updatePlayerProfileAsync(e){const t=await E("players",e,{},this.getAPIHost(),10);return Ot.Object.hasOwn(t,"data")?t.data:null}async increaseUserGuideDisplays(e){await E(`players/${e}/user-guide-displays/inc`,{},{},this.getAPIHost())}};r(na,"PlayerAPI");let Oe=na;const ia=class ia{constructor(e){l(this,"matchAPI");l(this,"playerAPI");l(this,"leaderboardAPI");this.createAPI(),this.setAPIConfig(e)}createAPI(){this.matchAPI=new Ne,this.playerAPI=new Oe,this.leaderboardAPI=new ve}setAPIConfig(e){e.playerAPIHost&&this.playerAPI.setAPIHost(e.playerAPIHost),e.matchAPIHost&&this.matchAPI.setAPIHost(e.matchAPIHost),e.leaderboardAPIHost&&this.leaderboardAPI.setAPIHost(e.leaderboardAPIHost),e.appId&&this.leaderboardAPI.setAppId(e.appId)}setMatchAPIInstance(e){this.matchAPI=e}setPlayerAPIInstance(e){this.playerAPI=e}setLeaderboardAPIInstance(e){this.leaderboardAPI=e}getPlayerAPI(){return this.playerAPI}getMatchAPI(){return this.matchAPI}getLeaderboardAPI(){return this.leaderboardAPI}};r(ia,"APIHandler");let Te=ia;const oa=class oa extends M{constructor(e){super(e),this.name="LevelNotDefined",this.message=e??"Level is not defined"}};r(oa,"LevelNotDefined");let Ht=oa;const ra=class ra extends M{constructor(e){super(e),this.name="MatchModeNotDefined",this.message=e??"Match id is not defined"}};r(ra,"MatchModeNotDefined");let zt=ra;const{Utils:Jn}=d;var Ct;let m=(Ct=class{constructor(e){l(this,"game");l(this,"match");l(this,"nextHandler");this.game=e.game,this.match=e.match,this.nextHandler=null}setNext(e){return this.nextHandler=e,e}async processAsync(e){console.groupCollapsed(`🤖 ? ${this.constructor.name}`),this.logData("Before",e)}async nextAsync(e){this.logData("After",e),console.groupEnd(),this.nextHandler&&await this.nextHandler.processAsync(e)}logData(e,t){if(!Jn.Valid.isDebugger())return;console.groupCollapsed(`📦 MatchState: ${e}`);const{clone:s}=Jn.Object,{profiles:a,customData:n,...i}=t;console.info("💾 Base"),console.table(s(i)),console.info("💾 Profile"),console.table(s(a)),console.info("💾 Custom"),console.table(s(n)),console.groupEnd()}},r(Ct,"BaseHandler"),Ct);const{Utils:so}=d,{Analytics:ao}=d.Plugins,ca=class ca extends m{async processAsync(e){super.processAsync(e);const{customData:t,mode:s}=e;if(s===null)throw new zt;const{level:a}=t;if(typeof a!="number")throw new Ht;const{analytics:n}=this.game;n.event(ao.Events.MATCH_START,{game_mode:so.String.toUpperCamelCase(s),level:a,level_name:`level_${a}`}),await this.nextAsync(e)}};r(ca,"LogMatchStartHandler");let T=ca;const O={OPEN:"open",ACTIVE:"active",FINISHED:"finished"},la=class la extends m{async processAsync(e){super.processAsync(e);const{mode:t,status:s}=e;let a=t??Q.SINGLE;s===O.FINISHED&&(a=Q.SINGLE),this.contextGameModeDetected(a),await this.nextAsync(e)}contextGameModeDetected(e){const{storage:t}=this.game;t.setStorageData("context","contextGameMode",e)}};r(la,"ContextGameModeHandler");let P=la;const ha=class ha extends M{constructor(e){super(e),this.name="CreateContextFailed",this.message=e??"Create context failed"}};r(ha,"CreateContextFailed");let mt=ha;const{Utils:no}=d,da=class da extends m{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{opponentId:s}=this.payload,a=await this.createAsync(s);t.customData.contextId=a,await this.nextAsync(t)}async createAsync(t){try{await GameSDK.context.createAsync(t)}catch(a){if(!no.Object.hasOwn(a,"code")||a.code!=="SAME_CONTEXT")throw a}const s=GameSDK.context.getID();if(typeof s!="string")throw new mt;return s}};r(da,"CreateContextHandler");let Le=da;const ua=class ua extends M{constructor(e){super(e),this.name="MatchAreNotOpen",this.message=e??"Match are not open"}};r(ua,"MatchAreNotOpen");let ot=ua;const pa=class pa extends M{constructor(e){super(e),this.name="OpponentIdNotValid",this.message=e??"Opponent id is not valid"}};r(pa,"OpponentIdNotValid");let k=pa;const{Dtos:io}=d,fa=class fa extends m{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createMatchAsync(e),s=new io.Match.Data(t).toObject();this.updateMatchState(e,s),await this.nextAsync(e)}validateData(e){const{status:t,customData:s}=e,{opponentId:a}=s;if(typeof a!="string")throw new k;if(t!==O.OPEN)throw new ot}async createMatchAsync(e){const{opponentId:t}=e.customData;return t?this.match.api.getMatchAPI().createMatchAsync(t):{}}updateMatchState(e,t){const{customData:s}=e,{_id:a,whitePlayerId:n,blackPlayerId:i,whitePlayerFinish:o,blackPlayerFinish:c}=t,u=n===s.opponentId;e.id=a||null;const p=u?i:n,f=u?n:i;e.customData.playerId=p,e.customData.opponentId=f,e.profiles[p]||(e.profiles[p]={id:p,name:"",photo:"",finished:!1}),e.profiles[f]||(e.profiles[f]={id:f,name:"",photo:"",finished:!1});const y=u?c:o,g=u?o:c;e.profiles[p].finished=y,e.profiles[f].finished=g}};r(fa,"CreateMatchHandler");let qt=fa;const{LeaderboardId:oo}=d.Configs.LeadersBoard,Ai={level:1,rescued:0,contextId:null,playerId:null,opponentId:null,leaderboardId:oo},ya=class ya extends m{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.initializeMatch(t),await this.nextAsync(t)}initializeMatch(t){const{id:s,mode:a,customData:n}=this.payload;t.id=s??null,t.mode=a||null,t.status=O.OPEN,t.startAt=0,t.finishAt=0,t.profiles={},t.customData={...Ai,...t.customData,...n}}};r(ya,"PrepareMatchHandler");let v=ya;const ga=class ga extends m{async processAsync(e){if(super.processAsync(e),e.status!==O.OPEN)throw new ot;this.startMatch(e),await this.nextAsync(e)}startMatch(e){e.status=O.ACTIVE,e.startAt=Date.now()}};r(ga,"StartMatchHandler");let L=ga;const jt=z,ma=class ma extends Error{constructor(e){super(e),this.name="UnavailableFeature",this.message=`Unavailable feature: ${e}`}};r(ma,"UnavailableFeature");let S=ma;d.Plugins;const ro=r(async()=>{const{player:h,match:e,frameCapture:t}=window.game,s=e.getMatchState(),{profiles:a}=s,{playerId:n,photo:i}=h.getPlayer(),{score:o}=a[n]||{},c=co({playerId:n,playerPhoto:i,playerScore:o??0});if(!c){console.warn("getRenderOptionsCurrentScore");return}const u={name:"share-current-score",width:952,height:492,renderOptions:c};return await t.capture(u)},"renderWideframesCurrentScore"),co=r(h=>{const{playerId:e="10",playerPhoto:t="",playerScore:s=0}=h;return{avatar:{name:`${e}`,type:"image",x:634,y:118,image:t,width:240,height:240},wideFrame:{name:"wide-frame-message-win",type:"image",x:0,y:0,image:"./assets/wideframes/wide-frame-message-win.png",width:952,height:492},playerScoreShadow:{type:"text",x:760,y:454,font:"600 70px",fillStyle:"#c4683f",text:`${s}`,textAlign:"center"},playerScore:{type:"text",x:760,y:450,font:"600 70px",fillStyle:"#f2a62e",text:`${s}`,textAlign:"center"}}},"getRenderOptionsBestScore"),Ts=r(async()=>{const{match:h,frameCapture:e}=window.game,t=h.getMatchState(),{profiles:s,customData:a}=t,{playerId:n,opponentId:i}=a;if(!n||!i)return;const o=s[n],c=s[i],{photo:u,score:p,finished:f}=o,{photo:y,score:g=0,finished:C}=c,N={playerId:n,playerPhoto:u,playerScore:p,opponentId:i,opponentPhoto:y,opponentScore:g,isPlayerFinished:f,isOpponentFinished:C},x=lo(N);if(!x){console.warn("getRenderOptionsGameResult failed",N);return}const xi={name:"share-game-result",width:952,height:492,renderOptions:x};return await e.capture(xi)},"renderWideframesGameResult"),lo=r(h=>{const{playerId:e="10",playerPhoto:t="",playerScore:s=0,opponentId:a="20",opponentPhoto:n="",opponentScore:i=0,isPlayerFinished:o,isOpponentFinished:c}=h,u=s===i,p=s>i,f=o||c,y=o&&c,g={leftPhoto:{name:`${e}`,type:"image",x:56,y:140,image:t,width:220,height:220},rightPhoto:{name:`${a}`,type:"image",x:690,y:140,image:n,width:220,height:220},wideFrame:{name:"wide-frame-game-result",type:"image",x:0,y:0,image:"./assets/wideframes/wide-frame-game-result.png",width:952,height:492}};return f&&(g.leftScoreShadow={type:"text",x:162,y:444,font:"600 70px",fillStyle:"#c4683f",text:o?`${s}`:"???",textAlign:"center"},g.leftScore={type:"text",x:162,y:440,font:"600 70px",fillStyle:"#f2a62e",text:o?`${s}`:"???",textAlign:"center"},g.rightScoreShadow={type:"text",x:796,y:444,font:"600 70px",fillStyle:"#c4683f",text:c?`${i}`:"???",textAlign:"center"},g.rightScore={type:"text",x:796,y:440,font:"600 70px",fillStyle:"#f2a62e",text:c?`${i}`:"???",textAlign:"center"}),!u&&y&&(p?g.leftCrown={name:"crown-icon",type:"image",x:112,y:72,image:"./assets/images/others/crown-icon.png",width:106,height:78}:g.rightCrown={name:"crown-icon",type:"image",x:750,y:72,image:"./assets/images/others/crown-icon.png",width:106,height:78}),g},"getRenderOptionsGameResult"),wa=class wa extends M{constructor(e){super(e),this.name="ContextIdNotValid",this.message=e??"Context id is not valid"}};r(wa,"ContextIdNotValid");let q=wa;const Aa=class Aa extends M{constructor(e){super(e),this.name="MatchIdNotValid",this.message=e??"Match id is not valid"}};r(Aa,"MatchIdNotValid");let rt=Aa;const Ia=class Ia extends m{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesResultAsync().catch(()=>{});t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:a,opponentId:n}=s;if(!t||typeof t!="string")throw new rt;if(!a||typeof a!="string")throw new q;if(!n||typeof n!="string")throw new k}async createWideframesResultAsync(){return await Ts()}async sendMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:o}=n;if(!i||typeof i!="string")throw new A;const{name:c}=a[i],u={data:{type:jt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{en_US:"Play",vi_VN:"Chơi ngay"}},text:{default:`${c} challenges you`,localizations:{en_US:`${c} challenges you`,vi_VN:`${c} thử thách bạn trong trận đấu này. Chơi ngay!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK))throw new S("updateAsync");await GameSDK.updateAsync(u)}};r(Ia,"SendChallengeMessageHandler");let Wt=Ia;const Da=class Da extends m{async processAsync(e){await this.nextAsync(e)}async nextAsync(e){this.nextHandler&&await this.nextHandler.processAsync(e)}};r(Da,"NothingHandler");let I=Da;const Sa=class Sa extends M{constructor(e){super(e),this.name="ProfileNotFound",this.message=e??"Profile not found"}};r(Sa,"ProfileNotFound");let F=Sa;const{Dtos:ho}=d,Pa=class Pa extends m{async processAsync(e){super.processAsync(e),this.validateData(e);const{customData:t}=e,{playerId:s,opponentId:a}=t;let n=s;const i=await this.getProfile(n);if(!i)throw new F;if(this.updateMatchProfile(e,n,i),n=a,n!==H.playerId){const o=await this.getProfile(n);if(!o)throw new F;this.updateMatchProfile(e,n,o)}else this.updateMatchProfile(e,n);await this.nextAsync(e)}validateData(e){const{customData:t}=e,{playerId:s,opponentId:a}=t;if(!s||typeof s!="string")throw new A;if(!a||typeof a!="string")throw new k}async getProfile(e){const{profile:t}=this.game;return await t.requestProfiles([e]),t.getProfiles()[e]}updateMatchProfile(e,t,s){const{name:a,photo:n}=s??H,i=new ho.Match.Profile({id:t,name:a,photo:n}).toObject();e.profiles[t]?(e.profiles[t].name=i.name,e.profiles[t].photo=i.photo):e.profiles[t]=i}};r(Pa,"GetMatchProfilesHandler");let Y=Pa;const xa=class xa{constructor(e,t){l(this,"game");l(this,"match");this.game=e,this.match=t}startLog(e){this.match.useCPUProfile&&console.profile(this.constructor.name),console.group(`🚀 ? ${this.constructor.name}`),e&&console.log("📦 ? Payload:",e)}endLog(){console.groupEnd(),this.match.useCPUProfile&&console.profileEnd()}async processAsync(e){throw new Error("Not implemented")}};r(xa,"BaseConcrete");let w=xa;const Ea=class Ea extends w{async processAsync(e){try{this.startLog(e);const{playerId:t,opponentId:s}=e,a=new I(this),n=new Le(this,{opponentId:s});a.setNext(n);const i=new v(this,{mode:R.CHALLENGE_FRIEND,customData:{playerId:t,opponentId:s}});n.setNext(i);const o=new qt(this);i.setNext(o);const c=new Y(this);o.setNext(c);const u=new L(this);c.setNext(u);const p=new T(this);u.setNext(p);const f=new Wt(this);p.setNext(f);const y=new P(this);f.setNext(y);const g=this.match.getMatchState();await a.processAsync(g),console.profileEnd(),console.groupEnd()}finally{this.endLog()}}};r(Ea,"ChallengeFriendConcrete");let Re=Ea;const Ca=class Ca extends Error{constructor(e){super(e),this.name="SameContext",this.message=e??"Same context"}};r(Ca,"SameContext");let pt=Ca;const{Utils:uo}=d,ba=class ba extends m{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{contextId:s}=this.payload;await this.switchAsync(s),t.customData.contextId=s,await this.nextAsync(t)}checkSameContext(t){const s=t==="SOLO",a=GameSDK.context.getID();if(a===t)throw new pt;if(s&&a===null)throw new pt}async switchAsync(t){try{this.checkSameContext(t);const s=t==="SOLO";await GameSDK.context.switchAsync(t,s)}catch(s){if(s instanceof pt)return;if(!uo.Object.hasOwn(s,"code")||s.code!=="SAME_CONTEXT")throw s}}};r(ba,"SwitchContextHandler");let wt=ba;const va=class va extends Error{constructor(e){super(e),this.name="PlayerNotCurrentInMatch",this.message=e||"The player is not currently in this match"}};r(va,"PlayerNotCurrentInMatch");let Me=va;const Na=class Na extends Error{constructor(e){super(e),this.name="GetMatchDetailFailed",this.message=e??"Get match detail failed"}};r(Na,"GetMatchDetailFailed");let Ge=Na;const{Dtos:po}=d,Oa=class Oa extends m{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.getMatchAsync(e),s=new po.Match.Data(t).toObject();this.validateContinueMatchData(e,s),this.updateMatchData(e,s),this.validatePlayerTurn(e),await this.nextAsync(e)}validateMatchData(e){const{id:t,status:s}=e;if(typeof t!="string")throw new rt;if(s!==O.OPEN)throw new ot}validateContinueMatchData(e,t){const{id:s,customData:a}=e,{_id:n,whitePlayerId:i,blackPlayerId:o}=t;if(typeof n!="string"||n!==s)throw console.warn("🤖 ? respMatchDataValidated",t),new Ge;const{playerId:c}=a,u=i===c,p=o===c;if(!u&&o===H.playerId)throw new kt;if(!u&&!p)throw new Me}validatePlayerTurn(e){const{profiles:t,customData:s}=e,{playerId:a}=s;if(typeof a!="string")throw new A;const{finished:n}=t[a];if(n)throw new Bt}async getMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().getMatchDetailByIdAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:a,blackPlayerId:n,whitePlayerScore:i,blackPlayerScore:o,whitePlayerFinish:c,blackPlayerFinish:u}=t,p=a===s.playerId,f=p?a:n,y=p?n:a;e.customData.playerId=f,e.customData.opponentId=y,e.profiles[f]||(e.profiles[f]={id:f,name:"",photo:"",finished:!1}),e.profiles[y]||(e.profiles[y]={id:y,name:"",photo:"",finished:!1});const g=p?i:o,C=p?o:i;e.profiles[f].score=g,e.profiles[y].score=C;const N=p?c:u,x=p?u:c;e.profiles[f].finished=N,e.profiles[y].finished=x}};r(Oa,"ContinueMatchHandler");let $e=Oa;const Ta=class Ta extends w{async processAsync(e){try{this.startLog(e);const{contextId:t,matchId:s,playerId:a,opponentId:n}=e,i=new I(this),o=new wt(this,{contextId:t});i.setNext(o);const c=new v(this,{id:s,mode:R.CHALLENGE_FRIEND,customData:{playerId:a,opponentId:n}});o.setNext(c);const u=new $e(this);c.setNext(u);const p=new Y(this);u.setNext(p);const f=new L(this);p.setNext(f);const y=new T(this);f.setNext(y);const g=new P(this);y.setNext(g);const C=this.match.getMatchState();await i.processAsync(C)}finally{this.endLog()}}};r(Ta,"ContinueChallengeMatchConcrete");let Ue=Ta;const{Utils:fo}=d,{Analytics:yo}=d.Plugins,La=class La extends m{async processAsync(e){super.processAsync(e);const{customData:t,mode:s,startAt:a,finishAt:n}=e;if(s===null)throw new zt;const{level:i}=t;if(typeof i!="number")throw new Ht;const{analytics:o}=this.game,c=Math.floor((n-a)/1e3);o.event(yo.Events.MATCH_END,{game_mode:fo.String.toUpperCamelCase(s),level:i,level_name:`level_${i}`,time_played:c}),await this.nextAsync(e)}};r(La,"LogMatchFinishedHandler");let ct=La;const Ra=class Ra extends Error{constructor(e){super(e),this.name="LeaderboardIdNotValid",this.message=e??"Leaderboard id is not valid"}};r(Ra,"LeaderboardIdNotValid");let _e=Ra;const Ma=class Ma extends m{async processAsync(e){super.processAsync(e),await this.setLeaderboardScoreAsync(e),await this.nextAsync(e)}async setLeaderboardScoreAsync(e){try{const{profiles:t,customData:s}=e,{playerId:a,leaderboardId:n}=s;if(!a||!t[a])throw new F;if(!n)throw new _e;const{score:i}=t[a],o={leaderboardId:n,playerId:a,score:i};await this.match.api.getLeaderboardAPI().setLeaderboardScoreAsync(o)}catch(t){console.warn("setLeaderboardScoreAsync",t)}}};r(Ma,"SetLeaderboardScoreHandler");let X=Ma;const Ga=class Ga extends Error{constructor(e){super(e),this.name="MatchAreNotActive",this.message=e??"Match are not active"}};r(Ga,"MatchAreNotActive");let Ve=Ga;const{Dtos:go}=d,$a=class $a extends m{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){if(super.processAsync(t),t.status!==O.ACTIVE)throw new Ve;const{useAPI:s}=this.payload;if(s){const a=await this.finishMatchAsync(t),n=new go.Match.Data(a).toObject();this.updateMatchFromAPI(t,n)}else this.updateMatchData(t);this.updateMatchState(t),await this.nextAsync(t)}updateMatchData(t){const{playerId:s}=t.customData;if(typeof s!="string")throw new A;t.profiles[s].finished=!0}updateMatchState(t){t.status=O.FINISHED,t.finishAt=Date.now()}async finishMatchAsync(t){const{id:s,profiles:a,customData:n}=t,{level:i,playerId:o}=n;if(typeof o!="string")throw new A;const{score:c}=a[o],{extraData:u}=this.payload,p={matchId:s??"",score:c,level:i,extraData:u};return this.match.api.getMatchAPI().finishMatchAsync(p)}updateMatchFromAPI(t,s){const{playerId:a,opponentId:n}=t.customData;if(typeof a!="string")throw new A;if(typeof n!="string")throw new k;const{whitePlayerId:i,whitePlayerScore:o,blackPlayerScore:c,whitePlayerFinish:u,blackPlayerFinish:p}=s,f=a===i,y=f?o:c,g=f?c:o,C=f?u:p,N=f?p:u;t.profiles[a].score=y,t.profiles[n].score=g,t.profiles[a].finished=C,t.profiles[n].finished=N}};r($a,"FinishMatchHandler");let lt=$a;const Ua=class Ua extends m{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesResultAsync().catch(()=>{});t&&this.progressSendFinishedMessage(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:a,opponentId:n}=s;if(!t||typeof t!="string")throw new rt;if(!a||typeof a!="string")throw new q;if(!n||typeof n!="string")throw new k}async createWideframesResultAsync(){return await Ts()}progressSendFinishedMessage(e,t){const{profiles:s,customData:a}=e,{playerId:n,opponentId:i}=a;if(!n||typeof n!="string")throw new A;if(!i||typeof i!="string")throw new k;const{score:o=0,finished:c}=s[n],{score:u=0,finished:p}=s[i];c?this.sendFinishMessageAsync(e,t):p&&o>u?this.sendBestScoreMessageAsync(e,t):this.sendPlayTurnMessageAsync(e,t)}async sendFinishMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:o}=n;if(!i||typeof i!="string")throw new A;const{name:c}=a[i],u={data:{type:jt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o,status:O.FINISHED},action:"CUSTOM",template:"finished",cta:{default:"See result",localizations:{en_US:"See result",vi_VN:"Xem kết quả"}},text:{default:`${c} just finished. Check them now.`,localizations:{en_US:`${c} just finished. Check them now.`,vi_VN:`${c} vừa hoàn thành màn chơi. Nhấn để xem kết quả trận đấu.`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK))throw new S("updateAsync");await GameSDK.updateAsync(u)}async sendPlayTurnMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:o}=n;if(!i||typeof i!="string")throw new A;const{name:c,score:u}=a[i],p={data:{type:jt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o,status:O.ACTIVE},action:"CUSTOM",template:"finished",cta:{default:"Play",localizations:{en_US:"Play",vi_VN:"Chơi ngay"}},text:{default:`${c} got ${u} scores. So easy! Can you?`,localizations:{en_US:`${c} got ${u} scores. So easy! Can you?`,vi_VN:`${c} đã đạt ${u} điểm! Nhấn Chơi để so tài!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK))throw new S("updateAsync");await GameSDK.updateAsync(p)}async sendBestScoreMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:o}=n;if(!i||typeof i!="string")throw new A;const{name:c,score:u}=a[i],p={data:{type:jt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o,status:O.FINISHED},action:"CUSTOM",template:"pass_score",cta:{default:"See result",localizations:{en_US:"See result",vi_VN:"Xem kết quả"}},text:{default:`${c} beat your high score. Their score: ${u}`,localizations:{en_US:`${c} beat your high score. Their score: ${u}`,vi_VN:`${c} đã vượt qua điểm số của bạn, với ${u} điểm!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK))throw new S("updateAsync");await GameSDK.updateAsync(p)}};r(Ua,"SendFinishedMessageHandler");let Fe=Ua;const _a=class _a extends m{async processAsync(e){super.processAsync(e),this.setPlayerBestScore(e),await this.nextAsync(e)}setPlayerBestScore(e){const{profiles:t,customData:s}=e,{playerId:a}=s;if(!a||!t[a])throw new F;const{player:n}=this.game,i=n.getBestScore()||0,{score:o=0}=t[a];o<=i||(n.setBestScore(o),t[a].bestScore=o)}};r(_a,"SetPlayerBestScoreHandler");let ht=_a;const{Dtos:mo}=d,Va=class Va extends m{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.updateProfileMatchData(t),await this.nextAsync(t)}updateProfileMatchData(t){const{id:s}=this.payload,{profiles:a}=t;if(!a[s])throw new F;const n={...a[s],...this.payload},i=new mo.Match.Profile(n).toObject();a[i.id]=i}};r(Va,"SetProfileDataHandler");let Qt=Va;const Fa=class Fa extends w{async processAsync(e){try{this.startLog(e);const{extraData:t,playerScore:s,playerId:a}=e,n=new I(this),i=new Qt(this,{id:a,score:s});n.setNext(i);const o=new lt(this,{useAPI:!0,extraData:t});i.setNext(o);const c=new Fe(this);o.setNext(c);const u=new ct(this);c.setNext(u);const p=new ht(this);u.setNext(p);const f=new X(this);p.setNext(f);const y=new P(this);f.setNext(y);const g=this.match.getMatchState();await n.processAsync(g)}finally{this.endLog()}}};r(Fa,"FinishChallengeMatchConcrete");let je=Fa;const ja=class ja extends Error{constructor(e){super(e),this.name="ContextIsTournament",this.message=e??"Context is a tournament"}};r(ja,"ContextIsTournament");let At=ja;const{Utils:wo}=d,Ba=class Ba extends m{async processAsync(e){super.processAsync(e);const t=await this.chooseAsync();await this.checkContextTournament(),e.customData.contextId=t,await this.nextAsync(e)}async chooseAsync(){try{await GameSDK.context.chooseAsync({filters:["INCLUDE_EXISTING_CHALLENGES"],minSize:2,maxSize:2})}catch(t){if(!wo.Object.hasOwn(t,"code")||t.code!=="SAME_CONTEXT")throw t}const e=GameSDK.context.getID();if(typeof e!="string")throw new mt;return e}async checkContextTournament(){try{throw"getTournamentAsync"in GameSDK?(await GameSDK.getTournamentAsync(),new At):new S("getTournamentAsync")}catch(e){if(e instanceof At)throw e}}};r(Ba,"ChooseContextHandler");let Be=Ba;const ka=class ka extends Error{constructor(e){super(e),this.name="ContextNotChallenge",this.message=e??"Context is not a challenge"}};r(ka,"ContextNotChallenge");let Yt=ka;const Ka=class Ka extends Error{constructor(e){super(e),this.name="NetworkFailure",this.message=e??"Network failure"}};r(Ka,"NetworkFailure");let ke=Ka;const{Utils:Zn,Dtos:Ao}=d,Ha=class Ha extends m{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.checkCurrentContext();const s=await this.getOpponentIdFromContextAsync();t.customData.opponentId=s,await this.nextAsync(t)}checkCurrentContext(){const t=GameSDK.context.getID();if(typeof t!="string")throw new q;if(t==="SOLO")throw new Yt}async getOpponentIdFromContextAsync(){const{playerId:t}=this.payload,s=await this.getContextPlayers([t]);if(s.length>1)throw new Yt;let a=H;return s.length===1&&(a=s[0]),a.playerId}async getContextPlayers(t){try{const s=await GameSDK.context.getPlayersAsync(),a=[];return s.forEach(n=>{const i=n.getID();if(t.includes(i))return;const o=n.getName();if(!o)return;const c=n.getPhoto();a.push(new Ao.Player.Info({playerId:i,name:o,photo:c}).toObject())}),Zn.Array.unique(a)}catch(s){if(Zn.Object.hasOwn(s,"code")&&s.code==="NETWORK_FAILURE")throw new ke;return[]}}};r(Ha,"GetOpponentContextHandler");let Ke=Ha;const za=class za extends w{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new I(this),a=new Be(this);s.setNext(a);const n=new v(this,{mode:R.CHALLENGE_FRIEND,customData:{playerId:t}});a.setNext(n);const i=new Ke(this,{playerId:t});n.setNext(i);const o=new qt(this);i.setNext(o);const c=new Y(this);o.setNext(c);const u=new L(this);c.setNext(u);const p=new T(this);u.setNext(p);const f=new Wt(this);p.setNext(f);const y=new P(this);f.setNext(y);const g=this.match.getMatchState();await s.processAsync(g)}finally{this.endLog()}}};r(za,"InviteFriendsConcrete");let He=za;const qa=class qa extends Error{constructor(e){super(e),this.name="JoinMatchFailed",this.message=e??"Join match failed"}};r(qa,"JoinMatchFailed");let ze=qa;const Wa=class Wa extends Error{constructor(e){super(e),this.name="MatchAreFinished",this.message=e??"Match are finished"}};r(Wa,"MatchAreFinished");let qe=Wa;const Qa=class Qa extends Error{constructor(e){super(e),this.name="OtherPlayerHasJoinedMatch",this.message=e??"Other player has joined match"}};r(Qa,"OtherPlayerHasJoinedMatch");let We=Qa;const{Dtos:Io}=d,Ya=class Ya extends m{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.joinMatchAsync(e),s=new Io.Match.Data(t).toObject();this.validateJoinMatchData(e,s),this.updateMatchData(e,s),await this.nextAsync(e)}validateMatchData(e){const{status:t}=e;if(t!==O.OPEN)throw new ot}validateJoinMatchData(e,t){const{id:s,customData:a}=e,{_id:n,blackPlayerId:i,whitePlayerId:o,whitePlayerFinish:c,blackPlayerFinish:u}=t,p=o===a.playerId,f=i===a.opponentId;if(typeof n!="string"||n!==s||!p)throw console.warn("🤖 ? matchData",t),new ze;if(c&&u)throw new qe;if(!f)throw new We}async joinMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().joinMatchAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:a,blackPlayerId:n,whitePlayerScore:i,blackPlayerScore:o,whitePlayerFinish:c,blackPlayerFinish:u}=t,p=a===s.playerId,f=p?a:n,y=p?n:a;e.customData.playerId=f,e.customData.opponentId=y,e.profiles[f]||(e.profiles[f]={id:f,name:"",photo:"",finished:!1}),e.profiles[y]||(e.profiles[y]={id:y,name:"",photo:"",finished:!1});const g=p?i:o,C=p?o:i;e.profiles[f].score=g,e.profiles[y].score=C;const N=p?c:u,x=p?u:c;e.profiles[f].finished=N,e.profiles[y].finished=x}};r(Ya,"JoinMatchHandler");let Qe=Ya;const Xa=class Xa extends w{async processAsync(e){try{this.startLog(e);const{matchId:t,playerId:s,opponentId:a}=e,n=new I(this),i=new v(this,{id:t,mode:R.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:a}});n.setNext(i);const o=new Qe(this);i.setNext(o);const c=new Y(this);o.setNext(c);const u=new L(this);c.setNext(u);const p=new T(this);u.setNext(p);const f=new P(this);p.setNext(f);const y=this.match.getMatchState();await n.processAsync(y)}finally{this.endLog()}}};r(Xa,"JoinChallengeMatchConcrete");let Ye=Xa;const Ja=class Ja extends w{constructor(){super(...arguments);l(this,"fallbackSingleMode");l(this,"startFLowChallengeFriend",r(async t=>{try{return await this.match.challenge.invite.processAsync({playerId:t}),!0}catch(s){return s}},"startFLowChallengeFriend"));l(this,"startFlowTournament",r(async t=>{try{await this.match.tournament.start.processAsync({playerId:t})}catch{await this.startFlowSingle(t)}},"startFlowTournament"));l(this,"startFlowSingle",r(async t=>{if(!this.fallbackSingleMode)throw new Error("Fallback single mode is not enabled");await this.match.single.start.processAsync({playerId:t})},"startFlowSingle"))}async processAsync(t){try{this.startLog(t);const{playerId:s,fallbackSingleMode:a}=t;this.fallbackSingleMode=a;const n=await this.startFLowChallengeFriend(s);if(n===!0)return;n instanceof At?await this.startFlowTournament(s):await this.startFlowSingle(s)}finally{this.endLog()}}};r(Ja,"ChooseContextConcrete");let Xe=Ja;const Za=class Za extends m{async processAsync(e){super.processAsync(e),this.validateData(e),this.progressSendGroupMessage(e),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:a,opponentId:n}=s;if(!t||typeof t!="string")throw new rt;if(!a||typeof a!="string")throw new q;if(!n||typeof n!="string")throw new k}async createWideframesResultAsync(){return await Ts()}async createWideframesCurrentScoreAsync(){return await ro()}async progressSendGroupMessage(e){const{profiles:t,customData:s}=e,{playerId:a,opponentId:n}=s;if(n&&typeof n=="string"){if(!a||typeof a!="string")throw new A;const{score:o=0}=t[a]||{},{score:c=0}=t[n]||{};if(o>c){const u=await this.createWideframesResultAsync().catch(()=>{});if(!u)return;this.sendBestScoreMessageAsync(e,u);return}}const i=await this.createWideframesCurrentScoreAsync().catch(()=>{});i&&this.sendChallengeMessageAsync(e,i)}async sendBestScoreMessageAsync(e,t){const{profiles:s,customData:a}=e,{playerId:n}=a;if(!n||typeof n!="string")throw new A;const{name:i,score:o}=s[n],c={data:{type:z.MATCHING_GROUP,playerId:n,playerName:i,playerScore:o},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{en_US:"Play",vi_VN:"Chơi"}},text:{default:`${i} beats your high score. Their score: ${o}.`,localizations:{en_US:`${i} beats your high score. Their score: ${o}.`,vi_VN:`${i} vừa vượt điểm số cao nhất của bạn! Chơi lần nữa chứ?`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK))throw new S("updateAsync");await GameSDK.updateAsync(c)}async sendChallengeMessageAsync(e,t){const{profiles:s,customData:a}=e,{playerId:n}=a;if(!n||typeof n!="string")throw new A;const{name:i,score:o}=s[n],c={data:{type:z.MATCHING_GROUP,playerId:n,playerName:i,playerScore:o},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{en_US:"Play",vi_VN:"Chơi ngay"}},text:{default:`${i} got ${o} scores. So easy! Can you?`,localizations:{en_US:`${i} got ${o} scores. So easy! Can you?`,vi_VN:`${i} đã đạt ${o} điểm! Quá dễ luôn. Chơi lại nào!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK))throw new S("updateAsync");await GameSDK.updateAsync(c)}};r(Za,"SendGroupMessageHandler");let Je=Za;const tn=class tn extends w{async processAsync(){try{this.startLog();const e=new I(this),t=new lt(this,{useAPI:!1});e.setNext(t);const s=new Je(this);t.setNext(s);const a=new ct(this);s.setNext(a);const n=new ht(this);a.setNext(n);const i=new X(this);n.setNext(i);const o=new P(this);i.setNext(o);const c=this.match.getMatchState();await e.processAsync(c)}finally{this.endLog()}}};r(tn,"FinishGroupConcrete");let Ze=tn;const en=class en extends w{async processAsync(e){try{this.startLog(e);const{playerId:t,opponentId:s,opponentScore:a}=e,n=new I(this),i=new v(this,{id:"7749",mode:R.MATCHING_GROUP,customData:{playerId:t,opponentId:s}});n.setNext(i);const o=new Y(this);i.setNext(o);const c=new Qt(this,{id:t,score:a});o.setNext(c);const u=new L(this);c.setNext(u);const p=new T(this);u.setNext(p);const f=new P(this);p.setNext(f);const y=this.match.getMatchState();await n.processAsync(y)}finally{this.endLog()}}};r(en,"JoinGroupConcrete");let ts=en;const sn=class sn extends Error{constructor(e){super(e),this.name="MatchGroupNotSupported",this.message=e??"Match group is not supported"}};r(sn,"MatchGroupNotSupported");let Xt=sn;const{Utils:Do}=d,an=class an extends m{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),await this.checkMatchGroupSupported();const s=this.getMatchTag(),a=await this.matchingGroup(s);t.customData.contextId=a,await this.nextAsync(t)}async checkMatchGroupSupported(){if(!("getSupportedAPIs"in GameSDK))throw new S("getSupportedAPIs");if(!("checkCanPlayerMatchAsync"in GameSDK))throw new S("checkCanPlayerMatchAsync");if(!GameSDK.getSupportedAPIs().includes("checkCanPlayerMatchAsync"))throw new Xt;if(!await GameSDK.checkCanPlayerMatchAsync())throw new Xt}getMatchTag(){const{locale:t}=this.payload;let s="global";if(t){const a=Do.String.getLanguageCode(t);a==="en"?s="en":a==="in"&&(s="in")}return s}async matchingGroup(t){if(!("matchPlayerAsync"in GameSDK))throw new S("matchPlayerAsync");await GameSDK.matchPlayerAsync(t,!0,!0);const s=GameSDK.context.getID();if(typeof s!="string")throw new mt;return s}};r(an,"GroupContextHandler");let es=an;const nn=class nn extends Error{constructor(e){super(e),this.name="ProfileIdNotDefined",this.message=e??"Profile id is not defined"}};r(nn,"ProfileIdNotDefined");let ss=nn;const{Dtos:So}=d,on=class on extends m{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{profileId:s}=this.payload;if(!s)throw new ss;const{player:a}=this.game,n=a.getPlayerId();let i;if(s===n)i=this.getPlayerProfile();else if(i=await this.getProfileAsync(s),!i)throw new F;this.updateMatchData(i,t),await this.nextAsync(t)}getPlayerProfile(){const{player:t}=this.game,{playerId:s,name:a,photo:n,locale:i}=t.getPlayer();return{playerId:s,name:a,photo:n,locale:i}}async getProfileAsync(t){const{profile:s}=this.game;return await s.requestProfiles([t]),s.getProfiles()[t]}updateMatchData(t,s){const{playerId:a,name:n,photo:i}=t,o=new So.Match.Profile({id:a,name:n,photo:i}).toObject();s.profiles[a]=o}};r(on,"GetProfileHandler");let J=on;const rn=class rn extends w{async processAsync(e){try{this.startLog(e);const{locale:t,playerId:s}=e,a=new I(this),n=new es(this,{locale:t});a.setNext(n);const i=new v(this,{id:"7749",mode:R.MATCHING_GROUP,customData:{playerId:s}});n.setNext(i);const o=new L(this);i.setNext(o);const c=new J(this,{profileId:s});o.setNext(c);const u=new T(this);c.setNext(u);const p=new P(this);u.setNext(p);const f=this.match.getMatchState();await a.processAsync(f)}finally{this.endLog()}}};r(rn,"StartGroupConcrete");let as=rn;const{Analytics:ue}=d.Plugins,cn=class cn extends m{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.validateData(t),this.postScoreTournamentAsync(t),await this.nextAsync(t)}validateData(t){const{profiles:s,customData:a}=t,{playerId:n}=a;if(this.validatePlayerId(n),!s[n])throw new F}validatePlayerId(t){if(typeof t!="string")throw new A}getPlayerProfile(t){const{profiles:s,customData:a}=t,{playerId:n}=a;return this.validatePlayerId(n),s[n]}isNewBestScore(t){const s=this.getPlayerProfile(t),{score:a=0,bestScore:n=0}=s;return a>n}async postScoreTournamentAsync(t){const{analytics:s}=window.game,a=this.getPlayerProfile(t),{score:n=0}=a;let i=null,o=!1;const{checkBestScore:c}=this.payload,u=c&&this.isNewBestScore(t);try{if(!("getTournamentAsync"in GameSDK))throw new S("getTournamentAsync");await GameSDK.getTournamentAsync(),u?(i=ue.Events.TOURNAMENT_SHARE,await GameSDK.tournament.shareAsync({score:n})):(i=ue.Events.TOURNAMENT_POST_SCORE,await GameSDK.tournament.postScoreAsync(n)),o=!0}catch(p){if(u){i=ue.Events.TOURNAMENT_CREATE,await this.createTournamentAsync(n),o=!0;return}console.warn("Post Score Tournament Error",p)}finally{i&&s.event(i,{success:o})}}getTournamentTitle(){const t=GameSDK.player.getName();let s="Yours Tournament";return t&&(s=`${t}'s Tournament`),s}async createTournamentAsync(t,s){try{if(!("tournament"in GameSDK))throw new S("tournament");const a=this.getTournamentTitle();await GameSDK.tournament.createAsync({initialScore:t,config:{tournamentTitle:a},data:{...s,type:z.TOURNAMENT}})}catch(a){console.warn("Create Tournament Error",a)}}};r(cn,"PostScoreTournamentHandler");let Jt=cn;const ln=class ln extends w{async processAsync(){try{this.startLog();const e=new I(this),t=new lt(this,{useAPI:!1});e.setNext(t);const s=new Jt(this,{checkBestScore:!1});t.setNext(s);const a=new ct(this);s.setNext(a);const n=new ht(this);a.setNext(n);const i=new X(this);n.setNext(i);const o=new P(this);i.setNext(o);const c=this.match.getMatchState();await e.processAsync(c)}finally{this.endLog()}}};r(ln,"FinishSingleConcrete");let ns=ln;const hn=class hn extends w{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new I(this),a=new wt(this,{contextId:"SOLO"});s.setNext(a);const n=new v(this,{id:"123456",mode:R.SINGLE,customData:{playerId:t}});a.setNext(n);const i=new L(this);n.setNext(i);const o=new J(this,{profileId:t});i.setNext(o);const c=new T(this);o.setNext(c);const u=new P(this);c.setNext(u);const p=this.match.getMatchState();await s.processAsync(p)}finally{this.endLog()}}};r(hn,"StartSingleConcrete");let is=hn;const dn=class dn extends m{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{contextId:s}=this.payload;this.validateContextId(s),t.customData.contextId=s,await this.nextAsync(t)}validateContextId(t){if(typeof t!="string")throw new q}};r(dn,"ContinueTournamentHandler");let os=dn;const un=class un extends w{async processAsync(e){try{this.startLog(e);const{playerId:t,contextId:s}=e,a=new I(this),n=new os(this,{contextId:s});a.setNext(n);const i=new v(this,{id:"1997",mode:R.TOURNAMENT,customData:{playerId:t}});n.setNext(i);const o=new L(this);i.setNext(o);const c=new J(this,{profileId:t});o.setNext(c);const u=new T(this);c.setNext(u);const p=new P(this);u.setNext(p);const f=this.match.getMatchState();await a.processAsync(f)}finally{this.endLog()}}};r(un,"ContinueTournamentConcrete");let rs=un;const{Utils:Po}=d,pn=class pn extends m{constructor(){super(...arguments);l(this,"leaderboardPayload")}async processAsync(t){super.processAsync(t),await this.setupCreatePayload(t),console.log("Creating leaderboard"),await this.createLeaderboardAsync(),console.log("Leaderboard created"),this.updateMatchState(t),await this.nextAsync(t)}async setupCreatePayload(t){console.log("Setting up create payload");const{playerId:s}=t.customData;if(!s)throw console.log("Player ID not found"),new F;if(!("getTournamentAsync"in GameSDK))throw new S("getTournamentAsync");const n=(await GameSDK.getTournamentAsync()).getID(),i=Po.String.generateObjectId(),o=GameSDK.player.getName(),c=o?`${o}'s Tournament`:"Your Tournament";this.leaderboardPayload={_id:i,name:n,createdBy:s,description:c}}async createLeaderboardAsync(){await this.match.api.getLeaderboardAPI().createLeaderboardAsync(this.leaderboardPayload)}updateMatchState(t){const{_id:s}=this.leaderboardPayload;t.customData.leaderboardId=s}};r(pn,"CreateLeaderboardHandler");let cs=pn;const fn=class fn extends w{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new I(this),a=new v(this,{id:"1997",mode:R.TOURNAMENT,customData:{playerId:t}});s.setNext(a);const n=new cs(this);a.setNext(n);const i=new X(this);n.setNext(i);const o=this.match.getMatchState();await s.processAsync(o)}finally{this.endLog()}}};r(fn,"CreateTournamentConcrete");let ls=fn;const yn=class yn extends w{async processAsync(){try{this.startLog();const e=new I(this),t=new lt(this,{useAPI:!1});e.setNext(t);const s=new Jt(this,{checkBestScore:!0});t.setNext(s);const a=new ct(this);s.setNext(a);const n=new ht(this);a.setNext(n);const i=new X(this);n.setNext(i);const o=new P(this);i.setNext(o);const c=this.match.getMatchState();await e.processAsync(c)}finally{this.endLog()}}};r(yn,"FinishTournamentConcrete");let hs=yn;const gn=class gn extends Error{constructor(e){super(e),this.name="TournamentIdNotValid",this.message=e??"Tournament id is not valid"}};r(gn,"TournamentIdNotValid");let ds=gn;const{Utils:xo}=d,mn=class mn extends m{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{tournamentId:s}=this.payload;this.validateTournamentId(s),await this.joinTournamentAsync(s);const a=GameSDK.context.getID();this.validateContextId(a),t.customData.contextId=a,await this.nextAsync(t)}validateTournamentId(t){if(typeof t!="string")throw new ds}validateContextId(t){if(typeof t!="string")throw new q}async joinTournamentAsync(t){if(!("tournament"in GameSDK))throw new S("tournament");try{await GameSDK.tournament.joinAsync(t)}catch(s){if(!xo.Object.hasOwn(s,"code")||s.code!=="SAME_CONTEXT")throw s}}};r(mn,"JoinTournamentHandler");let us=mn;const wn=class wn extends w{async processAsync(e){try{this.startLog(e);const{playerId:t,tournamentId:s}=e,a=new I(this),n=new us(this,{tournamentId:s});a.setNext(n);const i=new v(this,{id:"1997",mode:R.TOURNAMENT,customData:{playerId:t}});n.setNext(i);const o=new L(this);i.setNext(o);const c=new J(this,{profileId:t});o.setNext(c);const u=new T(this);c.setNext(u);const p=new P(this);u.setNext(p);const f=this.match.getMatchState();await a.processAsync(f)}finally{this.endLog()}}};r(wn,"JoinTournamentConcrete");let ps=wn;const An=class An extends w{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new I(this),a=new wt(this,{contextId:"SOLO"});s.setNext(a);const n=new v(this,{id:"1997",mode:R.TOURNAMENT,customData:{playerId:t}});a.setNext(n);const i=new L(this);n.setNext(i);const o=new J(this,{profileId:t});i.setNext(o);const c=new T(this);o.setNext(c);const u=new P(this);c.setNext(u);const p=this.match.getMatchState();await s.processAsync(p)}finally{this.endLog()}}};r(An,"StartTournamentConcrete");let fs=An;const Eo={id:null,mode:null,status:null,startAt:0,finishAt:0,profiles:{},customData:{...Ai}},{Configs:Tt}=d,In=class In extends D.Plugins.BasePlugin{constructor(){super(...arguments);l(this,"group");l(this,"single");l(this,"context");l(this,"challenge");l(this,"tournament");l(this,"api");l(this,"useCPUProfile")}init(){this.createMatchData(),this.createAPIHandler(),this.createConcreteFlows()}setUseCPUProfile(t){this.useCPUProfile=t}createMatchData(){const{storage:t}=this.game;t.addStorage("match",Eo)}getMatchState(){const{storage:t}=this.game;return t.getStorage("match")}createConcreteFlows(){this.createGroupFlows(),this.createSingleFlows(),this.createContextFlows(),this.createChallengeFlows(),this.createTournamentFlows()}createAPIHandler(){const t={appId:Tt.AppId,matchAPIHost:Tt.ApiHost,playerAPIHost:Tt.ApiHost,leaderboardAPIHost:Tt.OtherHost};this.api=new Te(t)}createGroupFlows(){this.group={join:new ts(this.game,this),start:new as(this.game,this),finish:new Ze(this.game,this)}}createSingleFlows(){this.single={start:new is(this.game,this),finish:new ns(this.game,this)}}createContextFlows(){this.context={choose:new Xe(this.game,this)}}createChallengeFlows(){this.challenge={invite:new He(this.game,this),friend:new Re(this.game,this),join:new Ye(this.game,this),finish:new je(this.game,this),continue:new Ue(this.game,this)}}createTournamentFlows(){this.tournament={join:new ps(this.game,this),start:new fs(this.game,this),create:new ls(this.game,this),finish:new hs(this.game,this),continue:new rs(this.game,this)}}};r(In,"MatchPlugin");let ys=In;const{Valid:tt}=d.Utils,et="is invalid",Dn=class Dn extends b{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateId(e){(!tt.isString(e)||!e)&&this.exception("id",et)}validateName(e){(!tt.isString(e)||!e)&&this.exception("name",et)}validatePhoto(e){tt.isString(e)||this.exception("photo",et)}validateScore(e){(!tt.isNumber(e)||e<0)&&this.exception("score",et)}validateBestScore(e){(!tt.isNumber(e)||e<0)&&this.exception("bestScore",et)}validateFinished(e){tt.isBoolean(e)||this.exception("finished",et)}toObject(){return super.toObject()}};r(Dn,"MatchProfileDtos");let Zt=Dn;Zt.addDefaultData({id:"",name:"Your Friend",photo:"./assets/images/others/avatar.png",score:0,bestScore:0,finished:!1});const{Valid:G}=d.Utils,$="is invalid",Sn=class Sn extends b{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e),this.validateId(e._id)}validateId(e){(!G.isString(e)||!e)&&this.exception("_id",$)}validateMode(e){(!G.isString(e)||!e)&&this.exception("mode",$)}validateStatus(e){(!G.isString(e)||!e)&&this.exception("status",$)}validateWinnerId(e){(!G.isString(e)||!e)&&this.exception("winnerId",$)}validateWhitePlayerId(e){(!G.isString(e)||!e)&&this.exception("whitePlayerId",$)}validateBlackPlayerId(e){(!G.isString(e)||!e)&&this.exception("blackPlayerId",$)}validateWhitePlayerScore(e){G.isNumber(e)||this.exception("whitePlayerScore",$)}validateBlackPlayerScore(e){G.isNumber(e)||this.exception("blackPlayerScore",$)}validateWhitePlayerFinish(e){G.isBoolean(e)||this.exception("whitePlayerFinish",$)}validateBlackPlayerFinish(e){G.isBoolean(e)||this.exception("blackPlayerFinish",$)}toObject(){return super.toObject()}};r(Sn,"RespMatchDataDtos");let te=Sn;te.addDefaultData({_id:"",mode:"",status:"",winnerId:"",whitePlayerId:"",blackPlayerId:"",whitePlayerScore:0,blackPlayerScore:0,whitePlayerFinish:!1,blackPlayerFinish:!1});d.Dtos.Match={Data:te,Profile:Zt};const{Utils:Ii}=d,{ApiHost:Di}=d.Configs,Co=r(async h=>{const e=await E("players",h,{},Di,10);return Ii.Object.hasOwn(e,"data")?e.data||{}:{}},"updatePlayerProfileAsync"),bo=r(async h=>{const e=await E(`players/${h}/user-guide-displays/inc`,{},{},Di);return Ii.Object.hasOwn(e,"data")?(e==null?void 0:e.data)||{}:{}},"increaseUserGuideDisplays"),{Utils:vo,Configs:No}=d,{AppId:Oo}=No,Pn=class Pn extends D.Plugins.BasePlugin{init(){const{storage:e}=this.game;e.addStorage("player",bt)}async saveToCloud(){try{const e=this.getPlayerData();await GameSDK.player.setDataAsync(e)}catch(e){console.warn(e)}}receiveData(e,t){const{storage:s}=this.game,{playerId:a,name:n,photo:i,locale:o}=e;s.setStorageData("player","playerId",a),s.setStorageData("player","name",n),s.setStorageData("player","photo",i),s.setStorageData("player","locale",o),t&&this.setPlayerData(t)}async syncProfileToServer(){const e=this.getPlayer(),{ASID:t,playerId:s,name:a,photo:n,locale:i}=e;await Co({appId:Oo,ASID:t,playerId:s,name:a,photo:n,locale:i})}setPlayerDataByName(e,t){this.setPlayerData({[e]:t})}setPlayerData(e){const{storage:t}=this.game;t.setStorageData("player","data",e),this.saveToCloud()}setBestScore(e){this.setPlayerDataByName("score",e)}setSetting(e,t){this.setPlayerDataByName("settings",{[e]:t})}setGameData(e){const t=this.getGameData()??{},s=vo.Object.merge(t,e);this.setPlayerDataByName("gameData",s)}async incUserGuideDisplays(){const{storage:e}=this.game,{userGuideDisplays:t}=e.getStorageData("player","data");this.setPlayerDataByName("userGuideDisplays",t+1);const s=this.getPlayerId();await bo(s)}async requestConnectedPlayers(){const{storage:e}=this.game,s=(await GameSDK.player.getConnectedPlayersAsync()).map(i=>{const o=i.getID(),c=i.getName(),u=i.getPhoto();return!o||!c||!u?null:new nt({playerId:o,name:c,photo:u}).toObject()}),a=d.Utils.Array.unique(s);if(a.length<1)return;const n=d.Utils.Object.keyBy(a,"playerId");e.setStorageData("player","connectedPlayers",n)}getPlayer(){const{storage:e}=this.game;return e.getStorage("player")}getPlayerId(){const{storage:e}=this.game;return e.getStorageData("player","playerId")}getPlayerASID(){const{storage:e}=this.game;return e.getStorageData("player","ASID")}getPlayerData(){const{storage:e}=this.game;return e.getStorageData("player","data")}getPlayerDataByKey(e){const t=this.getPlayerData();return d.Utils.Object.hasOwn(t,e)?t[e]:null}getGameData(){return this.getPlayerDataByKey("gameData")}getPlayerSetting(e){const t=this.getPlayerSettings();return d.Utils.Object.hasOwn(t,e)?t[e]:null}getPlayerSettings(){const{settings:e}=this.getPlayerData();return e}getPlayerIsNew(){const{storage:e}=this.game;return e.getStorageData("player","isUserNew")}getBestScore(){const{score:e}=this.getPlayerData();return e}getConnectedPlayers(){const{storage:e}=this.game;return e.getStorageData("player","connectedPlayers")}getConnectedPlayerIds(e,t){const s=this.getConnectedPlayers();return Object.keys(s).slice(t,e)}};r(Pn,"PlayerPlugin");let gs=Pn;const{Dtos:ti,Utils:To}=d,{Valid:Lt}=To,{score:Lo,settings:Ro,gameData:Mo,userGuideDisplays:Go}=bt.data,Rt="is invalid",xn=class xn extends b{processData(e){this.validateStructure(e),e.settings=new ti.Player.Settings(e.settings).toObject(),e.gameData=new ti.Player.GameData(e.gameData).toObject(),this.validateData(e),this.setupData(e)}setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateScore(e){(!Lt.isNumber(e)||e<0)&&this.exception("score",Rt)}validateSettings(e){Lt.isObject(e)||this.exception("settings",Rt)}validateGameData(e){Lt.isObject(e)||this.exception("gameData",Rt)}validateUserGuideDisplays(e){(!Lt.isNumber(e)||e<0)&&this.exception("userGuideDisplays",Rt)}toObject(){return super.toObject()}};r(xn,"PlayerDataDtos");let ee=xn;ee.addDefaultData({score:Lo,settings:Ro,gameData:Mo,userGuideDisplays:Go});const{Valid:ei}=d.Utils,{level:$o,coins:Uo}=bt.data.gameData,En=class En extends b{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateLevel(e){(!ei.isNumber(e)||e<1)&&this.exception("level","is invalid")}validateCoins(e){(!ei.isNumber(e)||e<0)&&this.exception("coins","is invalid")}toObject(){return super.toObject()}};r(En,"PlayerGameDataDtos");let se=En;se.addDefaultData({level:$o,coins:Uo});const{Valid:Mt}=d.Utils,{sound:_o,music:Vo,vibrate:Fo,language:jo}=bt.data.settings,Gt="is invalid",Cn=class Cn extends b{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateSound(e){Mt.isBoolean(e)||this.exception("sound",Gt)}validateMusic(e){Mt.isBoolean(e)||this.exception("music",Gt)}validateVibrate(e){Mt.isBoolean(e)||this.exception("vibrate",Gt)}validateLanguage(e){(!Mt.isString(e)||!e)&&this.exception("language",Gt)}toObject(){return super.toObject()}};r(Cn,"PlayerSettingsDtos");let ae=Cn;ae.addDefaultData({sound:_o,music:Vo,vibrate:Fo,language:jo});d.Dtos.Player={Info:nt,Data:ee,Settings:ae,GameData:se};const{Utils:Bo}=d,{ApiHost:ko}=d.Configs,Ko=r(async h=>{const e=d.Utils.String.params(h),t=await it(`players?${e}`,{},ko);return Bo.Object.hasOwn(t,"data")?Array.isArray(t.data)?t.data:[]:[]},"getPlayersAsync"),Ho={profiles:{},profileIds:[]},{Utils:si,Dtos:zo}=d,bn=class bn extends D.Plugins.BasePlugin{init(){const{storage:e}=this.game;e.addStorage("profile",Ho)}async requestProfiles(e){const{storage:t}=this.game,s=t.getStorageData("profile","profileIds"),a=si.Array.difference(e,s);if(a.length<1)return;const n=await Ko({playerIds:a});if(!this.validateProfilesResponse(n))return;const i=this.convertToProfiles(n);t.setStorageData("profile","profiles",i),t.setStorageData("profile","profileIds",[...s,...a])}getProfile(e){return this.getProfiles()[e]??null}getProfiles(){const{storage:e}=this.game;return e.getStorageData("profile","profiles")}getProfileIds(){const{storage:e}=this.game;return e.getStorageData("profile","profileIds")}validateProfilesResponse(e){return!(!Array.isArray(e)||e.length<1)}convertToProfiles(e){const t={};return e.forEach(s=>{si.Object.hasOwn(s,"playerId")&&typeof s.playerId=="string"&&(t[s.playerId]=new zo.Player.Info(s).toObject())}),t}};r(bn,"ProfilePlugin");let ms=bn;const{Valid:$t,Object:ai}=d.Utils,{Ads:Si,Gameplay:Pi}=d.Configs,Ut="is invalid",vn=class vn extends b{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateAds(e){$t.isObject(e)||this.exception("ads",Ut),this.validateCommonData(e,Si)}validateGameplay(e){$t.isObject(e)||this.exception("gameplay",Ut),this.validateCommonData(e,Pi)}validateCommonData(e,t){Object.keys(e).forEach(s=>{if(!ai.hasOwn(e,s))return;ai.hasOwn(t,s)||this.exception(`the "${s}" key`,Ut);const a=e[s],n=t[s];typeof a!=typeof n&&this.exception("value",Ut),$t.isObject(a)&&$t.isObject(n)&&this.validateCommonData(a,n)})}toObject(){return super.toObject()}};r(vn,"GameCoreConfigDtos");let It=vn;It.addDefaultData({Ads:Si,Gameplay:Pi});const{Valid:_t,Object:qo}=d.Utils,Nn=class Nn extends b{setupData(e){this.lazySetupData(e)}validateStructure(e){}validateData(e){this.validateCommonData(e)}validateCommonData(e,t=!0){Object.keys(e).forEach(s=>{if(!qo.hasOwn(e,s))return;const a=e[s];!_t.isBoolean(a)&&!_t.isNumber(a)&&!_t.isString(a)&&this.exception("value","is invalid"),_t.isObject(a)&&this.validateCommonData(a,!1),t&&Object.assign(this,{[s]:a})})}toObject(){return super.toObject()}};r(Nn,"GamePlayConfigDtos");let Dt=Nn;Dt.addDefaultData({});const{Valid:st,Object:ni}=d.Utils,W="is invalid",On=class On extends b{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateId(e){(!st.isString(e)||!e)&&this.exception("id",W);const{remoteConfig:t}=window.game;return t.isRemoteConfigId(e)}validateType(e){(!st.isString(e)||!e)&&this.exception("type",W),["GameCore","Gameplay"].includes(e)||this.exception("type",W)}validateInfo(e){(!st.isObject(e)||!e)&&this.exception("info",W),(!ni.hasOwn(e,"version")||!st.isString(e.version)||!e.version)&&this.exception("info.version",W),(!ni.hasOwn(e,"createdAt")||!st.isString(e.createdAt)||!e.createdAt)&&this.exception("info.createdAt",W)}validateConfig(e){st.isObject(e)||this.exception("config",W)}toObject(){return super.toObject()}};r(On,"RemoteConfigDataDtos");let St=On;St.addDefaultData({id:"default",type:"GameCore",info:{version:"1.0.0",priority:100,createdAt:"unknown"},config:{}});const Tn=class Tn{constructor(e){l(this,"plugin");this.plugin=e}};r(Tn,"BaseHandler");let ne=Tn;const{FirebaseConfig:ii,Options:lr}=d.Configs.RemoteConfig,Ln=class Ln extends ne{constructor(t){super(t);l(this,"firebaseApp");l(this,"firebaseRemoteConfig");l(this,"data",null);this.plugin=t,this.initializeFirebase(),this.initializeRemoteConfig()}initializeFirebase(){if(!ii.Enabled)return;const{AppId:t,ApiKey:s,ProjectId:a,AuthDomain:n,DatabaseURL:i,StorageBucket:o,MeasurementId:c,MessagingSenderId:u}=ii,p={apiKey:s,authDomain:n,databaseURL:i,projectId:a,storageBucket:o,messagingSenderId:u,appId:t,measurementId:c};this.firebaseApp=vi(p)}initializeRemoteConfig(){this.firebaseRemoteConfig=Ni(this.firebaseApp)}getGameCoreDataFromRemote(){if(!this.firebaseRemoteConfig)return null;const t=Hn(this.firebaseRemoteConfig,"gamecore_configs");if(!t)return null;const s=JSON.parse(t);return s.data?s:null}getGamePlayDataFromRemote(){if(!this.firebaseRemoteConfig)return null;const t=Hn(this.firebaseRemoteConfig,"gameplay_configs");if(!t)return null;const s=JSON.parse(t);return s.data?s:null}getConfig(t){const{id:s,type:a,conditions:n}=t;let i=null;switch(this.data=null,a){case"GameCore":{i=this.getGameCoreDataFromRemote();break}case"Gameplay":{i=this.getGamePlayDataFromRemote();break}}if(console.log("Get config from remote",i),!i)return null;const{data:o}=i;if(!o||o.length===0)return null;if(this.data=o,s)return this.getConfigById(s);const{latest:c,version:u,priority:p}=n??{};return u?this.getConfigByVersion(u):p?this.getConfigByPriority(p):c?this.getConfigByLatestVersion():this.getConfigByLatestVersion()}fetchConfig(t){return new Promise((s,a)=>{if(!this.firebaseApp||!this.firebaseRemoteConfig){a(new Error("FirebaseHandler: Firebase Remote Config is not initialized"));return}try{Oi(this.firebaseRemoteConfig).then(()=>{const n=this.getConfig(t);n||a("FirebaseHandler: Parse data failed"),s(n)})}catch(n){a(n)}})}getConfigById(t){return this.data?this.data.filter(a=>a.id===t)[0]:null}getConfigByVersion(t){return this.data?this.data.filter(a=>a.info.version===t)[0]:null}getConfigByLatestVersion(){return this.data?this.data.toSorted((s,a)=>s.info.createdAt.localeCompare(a.info.createdAt))[0]:null}getConfigByPriority(t){return this.data?this.data.filter(a=>a.info.priority<=t)[0]:null}};r(Ln,"FirebaseHandler");let ws=Ln;const Rn=class Rn extends ne{constructor(){super(...arguments);l(this,"data")}async fetchConfig(t){const{id:s,type:a,conditions:n}=t;await d.Utils.Time.sleepAsync(800);let i=null;switch(a){case"GameCore":i=await this.requestGameCoreConfig(s,n);break;case"Gameplay":i=await this.requestGamePlayConfig(s,n);break;default:console.warn("fetchConfig: Invalid type",a);break}return i}async requestGameCoreConfig(t,s){if(this.data=(await at(()=>import("./bundle/mock-gamecore-configs.js"),[],import.meta.url)).default,t)return this.getConfigById(t);const{version:a}=s??{};return a?this.getConfigByVersion(a):this.getConfigByLatestVersion()}async requestGamePlayConfig(t,s){if(this.data=(await at(()=>import("./bundle/mock-gameplay-configs.js"),[],import.meta.url)).default,t)return this.getConfigById(t);const{latest:a,version:n,priority:i}=s??{};return n?this.getConfigByVersion(n):i?this.getConfigByPriority(i):a?this.getConfigByLatestVersion():this.getConfigByLatestVersion()}getConfigById(t){return this.data.filter(a=>a.id===t)[0]}getConfigByVersion(t){return this.data.filter(a=>a.info.version===t)[0]}getConfigByLatestVersion(){return this.data.toSorted((s,a)=>s.info.createdAt.localeCompare(a.info.createdAt))[0]}getConfigByPriority(t){return this.data.filter(a=>a.info.priority<=t)[0]}};r(Rn,"MockupHandler");let As=Rn;const Wo={fetchStatus:"idle",changes:[],remoteConfigs:{GameCore:{},Gameplay:{}}},Mn=class Mn extends D.Plugins.BasePlugin{constructor(){super(...arguments);l(this,"enabled");l(this,"config");l(this,"handler");l(this,"timer");l(this,"handleFetchConfig",r(()=>{!this.enabled||this.getFetchStatus()==="fetching"||(this.fetchLatestConfigAsync("GameCore").then(s=>{s&&this.processUpdateConfig(s,"GameCore")}),this.fetchLatestConfigAsync("Gameplay").then(s=>{s&&this.processUpdateConfig(s,"Gameplay")}))},"handleFetchConfig"));l(this,"handleRemoteConfigUpdated",r(async t=>{if(!this.enabled)return;const{id:s,type:a}=t??{};if(this.checkChange(s,"updated"))return;const n=this.getRemoteConfig(s,a);if(!n)return;const{event:i}=this.game;i.emit(B.REQUEST_SAVE_CONFIG,n),this.pushChange(s,"updated")},"handleRemoteConfigUpdated"))}init(){const{storage:t}=this.game;t.addStorage("remoteConfig",Wo)}configure(t){this.config=t,this.enabled=this.config.Enabled,this.listenEvents(),this.createHandler(),this.initAutoFetch()}isRemoteConfigId(t){/^[a-zA-Z0-9_-]+$/.test(`${t}`)||this.exception("id","is invalid")}isRemoteConfigStored(t,s){return!!this.getRemoteConfig(t,s)}listenEvents(){const{event:t}=this.game;t.on(B.REMOTE_CONFIG_UPDATED,this.handleRemoteConfigUpdated)}createHandler(){const{ServiceType:t}=this.config;switch(t){case"firebase":this.handler=new ws(this);break;case"selfHosted":break;case"mockup":this.handler=new As(this);break;default:console.warn("RemoteConfigPlugin: Invalid service type"),this.enabled=!1}}initAutoFetch(){if(!this.enabled)return;const{FetchIntervalInSeconds:t}=this.config.Options;if(t<=0)return;clearInterval(this.timer);const s=1e3;this.handleFetchConfig(),this.timer=setInterval(this.handleFetchConfig,t*s)}async fetchConfigAsync(t){if(!this.enabled)return!1;try{const{id:s,type:a}=t;this.config.SupportedDataTypes.indexOf(a)===-1&&this.exception(`"${a}" type`,"is unsupported"),s&&this.isRemoteConfigStored(s,a)&&this.exception(`"${s}" id`,"is stored"),this.setFetchStatus("fetching");const n=await this.handler.fetchConfig(t);console.info("[fetchConfigAsync]",n);const i=new St(n).toObject();let o;switch(i.type){case"GameCore":o=new It(i.config).toObject();break;case"Gameplay":o=new Dt(i.config).toObject();break}return i.config=o,this.setRemoteConfig(i),this.setFetchStatus("success"),i.id}catch(s){return console.warn("[fetchConfigAsync]",s),this.setFetchStatus("failure"),!1}}async fetchLatestConfigAsync(t){if(!this.enabled)return!1;try{return await this.fetchConfigAsync({type:t,conditions:{latest:!0}})}catch(s){return console.warn("[fetchLatestConfigAsync]",s),!1}}async fetchDefaultConfigAsync(t){if(!this.enabled)return!1;try{const{DefaultConfigId:s}=this.config;return this.isRemoteConfigId(s),this.fetchConfigAsync({id:s,type:t})}catch(s){return console.warn("[fetchDefaultConfigAsync]",s),!1}}processUpdateConfig(t,s){if(!this.enabled)return!1;try{const a=this.getRemoteConfig(t,s);return a||this.exception(`"${t}" id`,"is not stored"),this.checkChange(t,"updated")&&this.exception(`"${t}" id`,"is updated"),this.requestUpdateConfig(a),this.requestHotUpdate(t,a.type),this.pushChange(t,"requested"),!0}catch{return!1}}requestUpdateConfig(t){if(!this.enabled)return;const{event:s}=this.game;s.emit(B.REQUEST_UPDATE_CONFIG,t)}requestHotUpdate(t,s){if(!this.enabled)return;const{ForceReloadGame:a}=this.config.Options;if(!a)return;const{event:n}=this.game;n.emit(B.REQUEST_HOT_RELOAD,{id:t,type:s})}rollbackConfig(t,s){try{const a=this.getRemoteConfig(t,s);return a?(this.requestUpdateConfig(a),this.requestHotUpdate(t,a.type),this.pushChange(t,"rollback"),!0):!1}catch(a){return console.warn("[rollbackConfig]",a),!1}}setStorageData(t,s){const{storage:a}=this.game;a.setStorageData("remoteConfig",t,s)}getRemoteConfigs(){const{storage:t}=this.game;return t.getStorageData("remoteConfig","remoteConfigs")}getRemoteConfig(t,s){return this.getRemoteConfigs()[s][t]||null}setRemoteConfig(t){const{id:s,type:a}=t;this.setStorageData("remoteConfigs",{[a]:{[s]:t}})}setFetchStatus(t){this.setStorageData("fetchStatus",t)}getFetchStatus(){const{storage:t}=this.game;return t.getStorageData("remoteConfig","fetchStatus")}getChanges(){const{storage:t}=this.game;return t.getStorageData("remoteConfig","changes")}pushChange(t,s){const a={id:t,actionStatus:s},n=this.getChanges();n.push(a),this.setStorageData("changes",n)}checkChange(t,s){const n=this.getChanges().findLast(i=>i.id===t);return n?n.actionStatus===s:!1}exception(t,s){throw new Error(`RemoteConfigPlugin: ${t} ${s}`)}};r(Mn,"RemoteConfigPlugin");let Is=Mn;d.Dtos.RemoteConfig={Data:St,GameCore:It,Gameplay:Dt};d.Dtos.Player.Data.addDefaultData({remoteConfig:{GameCore:{},Gameplay:{}}});d.Dtos.Player.Data.addValidateFunction("remoteConfig",h=>{const{Valid:e}=d.Utils;if(!e.isObject(h))throw new Error("remoteConfig is invalid");if(!("GameCore"in h))throw new Error("remoteConfig.GameCore is invalid");if(!("Gameplay"in h))throw new Error("remoteConfig.Gameplay is invalid")});const{Utils:oi}=d,Gn=class Gn extends D.Plugins.BasePlugin{constructor(t){super(t);l(this,"storages");this.storages={}}addStorage(t,s){console.info("addStorage",t,s),this.storages[t]=s}setStorageData(t,s,a){let n;if(oi.Valid.isObject(a)){const i=this.getStorageData(t,s);n=oi.Object.merge(i,a)}else n=a;this.storages[t][s]=n}getStorageData(t,s){return this.getStorage(t)[s]}getStorage(t){return this.storages[t]}};r(Gn,"StoragePlugin");let Ds=Gn;const $n=class $n extends D.Plugins.BasePlugin{constructor(){super(...arguments);l(this,"isVisible",!0);l(this,"browserPrefixes",["moz","ms","o","","webkit"]);l(this,"handleVisibilityChange",r(t=>{if(typeof t=="boolean")return t?this.onVisibleEvent():this.onHiddenEvent();const s=this.getBrowserPrefix();return this.getHiddenPropertyName(s)in document?this.onHiddenEvent():this.onVisibleEvent()},"handleVisibilityChange"))}init(){const t=this.getBrowserPrefix();[this.getVisibilityEvent(t),"focus","blur"].forEach(n=>{window.addEventListener(n,()=>{let i;n==="focus"?i=!0:n==="blur"&&(i=!1),this.handleVisibilityChange(i)},!1)})}isGameVisible(){return this.isVisible}getHiddenPropertyName(t){return t?t+"Hidden":"hidden"}getVisibilityEvent(t){return(t||"")+"visibilitychange"}getBrowserPrefix(){for(const t of this.browserPrefixes)if(this.getHiddenPropertyName(t)in document)return t;return""}onVisibleEvent(){this.isVisible||(this.isVisible=!0,this.game.event.emit(d.Events.VISIBILITY_VISIBLE))}onHiddenEvent(){this.isVisible&&(this.isVisible=!1,this.game.event.emit(d.Events.VISIBILITY_HIDDEN))}};r($n,"VisibilityPlugin");let Ss=$n;const Un=class Un extends pi{async loadAsync(){this.exception("Unsupported method")}async showAsync(){this.exception("This method is not implemented")}async hideAsync(){this.exception("This method is not implemented")}};r(Un,"BannerInstance");let Ps=Un;const _n=class _n extends Ps{async showAsync(){await GameSDK.loadBannerAdAsync(this.placementId)}async hideAsync(){await GameSDK.hideBannerAdAsync(this.placementId)}};r(_n,"BannerAdInstance");let xs=_n;const{Status:U,Types:Vt,AdError:Ft,AdInstance:Qo}=d.Plugins.Ads,Vn=class Vn extends Qo{constructor(t,s){super(t,s);l(this,"instance");this.instance=null}async loadAsync(){if(console.info("AdInstance","loadAsync called",{type:this.type,status:this.status}),this.status!==U.IDLE)throw new Ft("AD_NOT_READY","Ad is not ready.");try{if(this.instance=await this.createInstanceByType(this.type),this.instance===null)throw new Ft("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");this.status=U.LOADING,await this.instance.loadAsync(),this.status=U.FILLED,console.info("AdInstance","loadAsync success",{type:this.type,status:this.status})}catch(t){throw console.warn("AdInstance","loadAsync failed",{type:this.type,status:this.status,error:t}),this.status=U.IDLE,t instanceof Object&&"code"in t&&t.code==="INVALID_PARAM"&&(this.instance=null),t}}async showAsync(){if(console.info("AdInstance","showAsync called",{type:this.type,status:this.status}),this.status!==U.FILLED)throw new Ft("AD_NOT_FILLED","Ad is not filled.");if(this.instance===null)throw new Ft("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");try{this.status=U.SHOWING,await this.instance.showAsync(),this.status=U.IDLE,this.instance=null,console.info("AdInstance","showAsync success",{type:this.type,status:this.status}),this.type===Vt.INTERSTITIAL&&self.game.analytics.showInterstitialAd(),this.type===Vt.REWARDED_VIDEO&&self.game.analytics.showRewardedVideoAd()}catch(t){throw console.warn("AdInstance","showAsync failed",{type:this.type,status:this.status,error:t}),this.status=U.FILLED,d.Utils.Object.hasOwn(t,"code")&&(["ADS_NOT_LOADED"].includes(`${t.code}`)&&(this.status=U.IDLE),["USER_INPUT","INVALID_PARAM","INVALID_OPERATION"].includes(`${t.code}`)&&(this.status=U.IDLE,this.instance=null)),self.game.analytics.showAdFail(this.type,t),t}}async createInstanceByType(t){switch(t){case Vt.REWARDED_VIDEO:return await GameSDK.getRewardedVideoAsync(this.placementId);case Vt.INTERSTITIAL:return await GameSDK.getInterstitialAdAsync(this.placementId);default:return null}}};r(Vn,"NormalAdInstance");let ie=Vn;const{BaseAnalytics:Yo,Events:_}=d.Plugins.Analytics,Xo=[_.BUTTON_CLICK,_.SCREEN_OPEN],Fn=class Fn extends Yo{constructor(e,t){super("FacebookAnalytics",{...t},"#0F52BA");const{consoleLog:s}=t;this.selfLog=!!s}processEvent(e,t,s){if(!("logEvent"in GameSDK)||!t||Xo.includes(e))return;const a=this.formatEventName(e),n={};Object.keys(t).forEach(i=>{typeof t[i]=="string"&&(n[i]=t[i])}),GameSDK.logEvent(a,s,n)}processPageView(e){this.processEvent(_.SCREEN_OPEN,{screen_name:e})}processLevelStart(e,t,s){this.processEvent(_.LEVEL_START,{level:e,score:t,level_name:s})}processLevelRescue(e,t,s){this.processEvent(_.LEVEL_RESCUE,{level:e,score:t,level_name:s})}processLevelFail(e,t,s){this.processEvent(_.LEVEL_END,{level:e,score:t,level_name:s,success:!1})}processLevelComplete(e,t,s){this.processEvent(_.LEVEL_END,{level:e,score:t,level_name:s,success:!0})}processShowInterstitialAd(e){this.processEvent(_.AD_SHOW,{ad_type:"interstitial",screen_name:`${e}`})}processShowRewardedVideoAd(e){this.processEvent(_.AD_SHOW,{ad_type:"rewarded_video",screen_name:`${e}`})}processShowAdFail(e,t){this.processEvent(_.AD_SHOW_FAILED,{ad_type:e,screen_name:`${t}`})}formatEventName(e){return e.toLowerCase().replace(/:/g,"_")}};r(Fn,"FacebookAnalytics");let Es=Fn;const{BaseAnalytics:hr,Events:Jo}=d.Plugins.Analytics;Jo.SCREEN_OPEN;const jn=class jn{constructor(e,t){l(this,"options");l(this,"performance");l(this,"isRunning",!1);l(this,"checkTimer");l(this,"fpsHistory");l(this,"actualFPS",0);l(this,"start",r(()=>{this.isRunning||(this.isRunning=!0,this.checkTimer=this.options.CheckInterval,this.fpsHistory=[])},"start"));l(this,"stop",r(()=>{this.isRunning&&(this.isRunning=!1,this.options.OnlyUpdateWhenSwitchScene&&this.checkFps())},"stop"));l(this,"postStep",r(e=>{this.isRunning&&(this.checkTimer-=e,!(this.checkTimer>0)&&(this.checkTimer+=this.options.CheckInterval,this.fpsHistory.push(this.actualFPS),this.options.OnlyUpdateWhenSwitchScene||this.fpsHistory.length>=5&&this.checkFps()))},"postStep"));this.options=t,this.performance=e}checkFps(){if(this.fpsHistory.length===0)return;let e=!1;this.isLowFps()?e=this.performance.downgradeGraphicsQuality():this.options.AutoUpgradeQuality&&this.isHighFps()&&(e=this.performance.upgradeGraphicsQuality()),e&&(this.fpsHistory=[])}getFpsMedian(){return this.getMedian(this.fpsHistory)}getMedian(e){if(e.length===0)return NaN;const t=Array.from(e).sort((a,n)=>a-n),s=Math.floor(t.length/2);return t.length%2===0?(t[s-1]+t[s])/2:t[s]}isLowFps(){return this.getFpsMedian()<this.options.FpsThreshold}isHighFps(){return this.getFpsMedian()>this.options.FpsThreshold*1.2}};r(jn,"FpsTracker");let Cs=jn;const Bn=class Bn extends D.Plugins.BasePlugin{constructor(){super(...arguments);l(this,"fpsTracker");l(this,"pixelRatio");l(this,"minQuality");l(this,"maxQuality");l(this,"qualityAdjustStep");l(this,"trackingSceneNames",[]);l(this,"trackingScene",r(t=>{this.trackingSceneNames.includes(t)||(this.stopFPSTracker(),this.startFPSTracker(),console.warn("📈 Adaptive performance is tracking scene:",t))},"trackingScene"));l(this,"startFPSTracker",r(()=>{this.fpsTracker.start()},"startFPSTracker"));l(this,"stopFPSTracker",r(()=>{this.fpsTracker.stop()},"stopFPSTracker"))}configure(t){const{MinQuality:s,MaxQuality:a,QualityAdjustStep:n,TrackingSceneNames:i,Options:o}=t;this.minQuality=s,this.maxQuality=a,this.qualityAdjustStep=n,this.trackingSceneNames=i,this.createFPSTracker(o)}activate(t,s){this.pixelRatio=s,this.trackingScene(t)}downgradeGraphicsQuality(){const t=this.pixelRatio;if(t<=this.minQuality)return!1;const s=+(t-this.qualityAdjustStep).toFixed(2);return s<this.minQuality?!1:(this.pixelRatio=s,this.resizeGameWorld(this.pixelRatio),console.warn(`💫 Graphics quality was downgraded! (${t} -> ${s})`),!0)}upgradeGraphicsQuality(){const t=this.pixelRatio;if(t>=this.maxQuality)return!1;const s=+(t+this.qualityAdjustStep).toFixed(2);return s>this.maxQuality?!1:(this.pixelRatio=s,this.resizeGameWorld(this.pixelRatio),console.warn(`🚀 Graphics quality was upgraded! (${t} -> ${s})`),!0)}createFPSTracker(t){this.fpsTracker=new Cs(this,t)}get event(){return this.game.event}resizeGameWorld(t){const s={forcePixelRatio:t};this.event.emit(B.REQUEST_RESIZE_GAME,s)}updatePostStepDeltaTime(t){this.fpsTracker.postStep(t)}updateActualFPS(t){this.fpsTracker.actualFPS=t}};r(Bn,"AdaptivePerformancePlugin");let bs=Bn;const Zo="production",tr="null",ri="0",{Dtos:er}=d,kn=class kn extends D.Game{constructor(){super(...arguments);l(this,"ads");l(this,"auth");l(this,"audio");l(this,"match");l(this,"event");l(this,"player");l(this,"profile");l(this,"context");l(this,"storage");l(this,"analytics");l(this,"visibility");l(this,"leaderboard");l(this,"frameCapture");l(this,"monitorError");l(this,"remoteConfig");l(this,"adaptivePerformance");l(this,"console");l(this,"profiler");l(this,"canvasRecorder");l(this,"initMonitorError",r(()=>{const{MonitorError:t}=d.Configs.Debugger;t.Enable&&(this.monitorError.configure({accessToken:tr,payload:{environment:Zo,client:{javascript:{code_version:`${ri}`}}}}),this.monitorError.setFilterError(t.FilterError))},"initMonitorError"));l(this,"handleSaveRemoteConfig",r(t=>{try{const s={[t.type]:t};this.player.setPlayerDataByName("remoteConfig",s)}catch(s){console.warn("handleSaveGameCoreConfig",s)}},"handleSaveRemoteConfig"));l(this,"handleUpdateGameCoreConfig",r(t=>{try{const{id:s,type:a}=t;if(a!=="GameCore")return;d.Configs=d.Utils.Object.merge(d.Configs,t.config);const{Ads:n}=d.Configs;this.ads.configure(n),this.event.emit(B.REMOTE_CONFIG_UPDATED,{id:s,type:a})}catch(s){console.warn("handleUpdateGameCoreConfig",s)}},"handleUpdateGameCoreConfig"));l(this,"handleStorageCurrentRemoteConfig",r(()=>{const t=this.player.getPlayerDataByKey("remoteConfig");if(console.info("playerRemoteConfig",d.Utils.Json.clone(t)),!!t){for(const s in t)if(d.Utils.Object.hasOwn(t,s)){const a=t[s],n=d.Utils.Json.clone(a);console.log("newRemoteConfig",n);const i=new er.RemoteConfig.Data(n).toObject();console.info("remoteConfigValid",i),this.remoteConfig.setRemoteConfig(i),this.remoteConfig.processUpdateConfig(i.id,i.type)}}},"handleStorageCurrentRemoteConfig"));l(this,"processAfterSyncProfile",r(()=>{const{Notification:t}=d.Configs;t.Enable&&(this.updatePlayerProfileToNotificationService(),this.sendFirstNotification())},"processAfterSyncProfile"))}getBuildVersion(){return ri}async boot(){super.boot(),this.addPlugins(),this.initEventPlugin(),this.initMatchPlugin(),this.initRemoteConfig(),this.initAdaptivePerformancePlugin(),this.event.emit(d.Events.CORE_BOOTING),this.addMonitorPlugin().then(this.initMonitorError),this.addDevPlugins().then(()=>{this.initConsole(),this.initProfilerPlugin(),this.initCanvasRecorderPlugin()}),await this.initAds()}async start(){super.start(),this.event.emit(d.Events.CORE_STARTING),await this.auth.requestToken(),await this.initState(),this.processPlayerProfile(),await this.context.detectContextSessionType(),this.context.detectContextGameMode(),this.initGoogleAnalytics(),this.initFacebookAnalytics(),this.event.emit(d.Events.CORE_READY)}addPlugins(){this.plugins.install("Storage",Ds,!0,"storage"),this.storage=this.plugins.get("Storage"),this.plugins.install("Ads",ye,!0,"ads"),this.plugins.install("Auth",Ie,!0,"auth"),this.plugins.install("Audio",Ae,!0,"audio"),this.plugins.install("Match",ys,!0,"match"),this.plugins.install("Event",xe,!0,"event"),this.plugins.install("Player",gs,!0,"player"),this.plugins.install("Profile",ms,!0,"profile"),this.plugins.install("Context",Pe,!0,"context"),this.plugins.install("Language",Ce,!0,"language"),this.plugins.install("Analytics",ge,!0,"analytics"),this.plugins.install("Visibility",Ss,!0,"visibility"),this.plugins.install("Leaderboard",be,!0,"leaderboard"),this.plugins.install("FrameCapture",Ee,!0,"frameCapture"),this.plugins.install("RemoteConfig",Is,!0,"remoteConfig"),this.plugins.install("AdaptivePerformance",bs,!0,"adaptivePerformance"),this.ads=this.plugins.get("Ads"),this.auth=this.plugins.get("Auth"),this.audio=this.plugins.get("Audio"),this.match=this.plugins.get("Match"),this.event=this.plugins.get("Event"),this.player=this.plugins.get("Player"),this.profile=this.plugins.get("Profile"),this.context=this.plugins.get("Context"),this.language=this.plugins.get("Language"),this.analytics=this.plugins.get("Analytics"),this.visibility=this.plugins.get("Visibility"),this.leaderboard=this.plugins.get("Leaderboard"),this.frameCapture=this.plugins.get("FrameCapture"),this.remoteConfig=this.plugins.get("RemoteConfig"),this.adaptivePerformance=this.plugins.get("AdaptivePerformance")}async addMonitorPlugin(){const{MonitorError:t}=d.Configs.Debugger;if(!t.Enable)return;const s=(await at(()=>import("./bundle/empty-script.js"),[],import.meta.url)).default;this.plugins.install("MonitorError",s,!0,"monitorError"),this.monitorError=this.plugins.get("MonitorError")}async addDevPlugins(){if(!d.Utils.Valid.isDebugger())return;const{ShowConsole:t,ShowProfiler:s,CanvasRecorder:a}=d.Configs.Debugger;if(t){const n=(await at(()=>import("./bundle/empty-script.js"),[],import.meta.url)).default;this.plugins.install("Console",n,!0,"console"),this.console=this.plugins.get("Console")}if(s){const n=(await at(()=>import("./bundle/empty-script.js"),[],import.meta.url)).default;this.plugins.install("Profiler",n,!0,"profiler"),this.profiler=this.plugins.get("Profiler")}if(a.Enable){const n=(await at(()=>import("./bundle/empty-script.js"),[],import.meta.url)).default;this.plugins.install("CanvasRecorder",n,!0,"canvasRecorder"),this.canvasRecorder=this.plugins.get("CanvasRecorder")}}initEventPlugin(){const{EventLogging:t}=d.Configs.Debugger;t&&this.event.enableLogEvent()}initMatchPlugin(){this.match.setUseCPUProfile(!1)}async initAds(){const{Configs:t,Plugins:s}=d,{Ads:a}=s;this.ads.configure(t.Ads),this.initAdInstance(a,t)}initAdInstance(t,s){const{InterstitialAdOptions:a,RewardedVideoAdOptions:n,BannerDisplayAdOptions:i}=s.Ads;a.forEach(o=>{this.ads.setAdInstance(t.Types.INTERSTITIAL,o.PlacementId,ie)}),n.forEach(o=>{this.ads.setAdInstance(t.Types.REWARDED_VIDEO,o.PlacementId,ie)}),i.forEach(o=>{this.ads.setAdInstance(t.Types.BANNER,o.PlacementId,xs)})}async initState(){try{const t=new pe(this);t.initContext(),await t.initPlayer()}catch(t){console.error("StateInitiator",t)}}initConsole(){if(!d.Utils.Valid.isDebugger())return;const{ShowConsole:t}=d.Configs.Debugger;t&&this.console.configure()}initProfilerPlugin(){if(!d.Utils.Valid.isDebugger())return;const{ShowProfiler:t}=d.Configs.Debugger;t&&this.profiler.configure()}initCanvasRecorderPlugin(){if(!d.Utils.Valid.isDebugger())return;const{CanvasRecorder:t}=d.Configs.Debugger;if(!t.Enable)return;const{Type:s,Quality:a,RecordFps:n,SyncFps:i}=t.Options;this.canvasRecorder.configure({type:s,quality:a,syncFps:i,recordFps:n});const o=document.querySelector("canvas");if(!o)return console.error("Canvas not found");this.canvasRecorder.setCanvas(o)}initRemoteConfig(){const{RemoteConfig:t}=d.Configs;if(!t.Enabled)return;const s=d.Utils.Json.clone(t);this.remoteConfig.configure(s),this.event.on(B.REQUEST_SAVE_CONFIG,this.handleSaveRemoteConfig),this.event.on(B.REQUEST_UPDATE_CONFIG,this.handleUpdateGameCoreConfig),this.event.once(B.PLAYER_INFO_LOADED,this.handleStorageCurrentRemoteConfig)}initAdaptivePerformancePlugin(){const{AdaptivePerformance:t}=d.Configs;if(!t.Enabled)return;const s=d.Utils.Json.clone(t);this.adaptivePerformance.configure(s)}async processPlayerProfile(){try{await this.player.syncProfileToServer(),this.processAfterSyncProfile()}catch(t){console.warn("processPlayerProfile fail",t)}}updatePlayerProfileToNotificationService(){const{AppId:t}=d.Configs,s=this.player.getPlayer(),{ASID:a,playerId:n,name:i,photo:o,locale:c}=s,u={appId:t,ASID:a,playerId:n,name:i,photo:o,locale:c};console.info("🚀 > profileData",u),Fi(u).catch(()=>{console.warn("updatePlayerProfileNotificationAsync failed")})}async sendFirstNotification(){try{if(!this.player.getPlayerIsNew())return;const s=this.player.getPlayerASID();if(!s)return;const a=await GameSDK.player.getDataAsync(["isNotificationFirstSent"])||{},{isNotificationFirstSent:n}=a;if(n===!0||!("sendNotificationAsync"in GameSDK.extra))return;await GameSDK.extra.sendNotificationAsync({message:`Hi @[${s}] your friends are waiting to play with you, play now!`,delayTime:3600}),GameSDK.player.setDataAsync({isNotificationFirstSent:!0})}catch(t){console.warn("sendNotificationForNewUser",t)}}initGoogleAnalytics(){{console.warn("Google Analytics is not configured");return}}initFacebookAnalytics(){const{Prefix:t,ConsoleLog:s}=d.Configs.Analytics.FacebookAnalytics??{};if(typeof t!="string"){console.warn("Facebook Analytics is not configured");return}this.analytics.add(new Es(this.game,{prefix:t,consoleLog:s}))}};r(kn,"MagicGame");let vs=kn;const sr=r(async()=>{try{const h=new vs;window.game=h,Ci(window,"game");const e=30;window.__sdkLoadingCount<e&&(window.__sdkLoadingCount=e),window.__gameCoreReady=!0,await h.boot(),h.event.once(d.Events.REQUEST_CORE_START,ar)}catch(h){console.error("initGame",h)}},"initGame"),ar=r(()=>{try{window.game.start(),d.Utils.Valid.isDebugger()||(window.game=Object.freeze(window.game));const h=35;window.__sdkLoadingCount<h&&(window.__sdkLoadingCount=h)}catch(h){console.error("startGame",h)}},"startGame"),nr=r(()=>{const e=setInterval(()=>{if(!window.__sdkInitiated)return;clearInterval(e);const t=20;window.__sdkLoadingCount<t&&(window.__sdkLoadingCount=t);try{gtag("event","app_initialize",{send_to:["GA"]})}catch(s){console.warn("gtag init",s)}sr()},100)},"waitGameSDK");console.warn("GameCore: wait SDK mode",!0);nr();
