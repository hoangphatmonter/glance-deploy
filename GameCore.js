var Ve=Object.defineProperty;var Ue=(o,e,t)=>e in o?Ve(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var l=(o,e,t)=>(Ue(o,typeof e!="symbol"?e+"":e,t),t);import{G as h,P as m,_ as X,C as U,w as He}from"./bundle/core.js";import{E as Be,i as $e,g as je,a as Wt,f as ke}from"./bundle/vendor.js";import"./bundle/__commonjsHelpers__.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(a){if(a.ep)return;a.ep=!0;const n=t(a);fetch(a.href,n)}})();const{Valid:W,Object:vt,String:Qt}=h.Utils,et="is invalid",V=class V{static addDefaultData(e){W.isObject(e)||this.prototype.exception("default data",et),W.isObject(V.data[this.name])||(V.data[this.name]={}),V.data[this.name]=vt.merge(V.data[this.name],e)}static getDefaultData(){return V.data[this.name]}static addValidateFunction(e,t){W.isString(e)||this.prototype.exception("validate key",et),typeof t!="function"&&this.prototype.exception("validate function",et);const s=`validate${Qt.capitalize(e)}`;Object.assign(this.prototype,{[s]:t})}constructor(e){this.defaultData(),this.processData(e)}processData(e){this.validateStructure(e),this.validateData(e),this.setupData(e)}defaultData(){this.lazyDefaultData(V.data[this.constructor.name])}lazyDefaultData(e){W.isObject(e)||this.exception("data",et);for(const t in e)if(vt.hasOwn(e,t)){const s=e[t];Object.assign(this,{[t]:s})}}lazyValidateStructure(e){W.isObject(e)||this.exception("structure","is not object"),this.getKeys().forEach(t=>{const s=this[t];s===void 0&&this.exception("structure",`has no key ${t}`),!vt.hasOwn(e,t)&&s!==void 0&&this.setDefaultData(t,e)})}setDefaultData(e,t){W.isObject(t)||this.exception("data",et);const s=this[e];s===void 0&&this.exception("default",`has no key ${e}`),Object.assign(t,{[e]:s})}lazyValidateData(e){this.getKeys().forEach(t=>{const s=e[t],a=`validate${Qt.capitalize(t)}`,n=this[a];if(typeof n=="function")try{n.call(this,s)}catch{this.setDefaultData(t,e)}else this.exception("validate",`has no function ${a}`)})}lazySetupData(e){this.getKeys().forEach(t=>{const s=e[t];Object.assign(this,{[t]:s})})}validate(){this.validateData(this.toObject())}exception(e,t){throw new Error(`${this.constructor.name}: ${e} ${t}`)}toObject(){return Object.fromEntries(Object.entries(this).filter(([e])=>e!=="toObject"))}getKeys(){return Object.keys(this).filter(e=>e!=="toObject")}};l(V,"data",{});let x=V;h.Dtos={Base:x};const Ke={score:"score",settings:"settings",gameData:"gameData",remoteConfig:"remoteConfig",isFirstLogin:"isFirstLogin"},at={ASID:"9999",playerId:"0000",name:"Guest",photo:"",locale:"en_US",connectedPlayers:{},data:{score:0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:{coins:0,level:1},isFirstLogin:!0}},{Valid:rt}=h.Utils,{playerId:ze,name:qe,photo:We,locale:Qe}=at,ct="is invalid";class Pt extends x{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validatePlayerId(e){(!rt.isString(e)||!e)&&this.exception("playerId",ct)}validateName(e){(!rt.isString(e)||!e)&&this.exception("name",ct)}validatePhoto(e){rt.isString(e)||this.exception("photo",ct)}validateLocale(e){(!rt.isString(e)||!e)&&this.exception("locale",ct)}toObject(){return super.toObject()}}Pt.addDefaultData({playerId:ze,name:qe,photo:We,locale:Qe});const j=new Pt({playerId:"10",name:"Your Friend"}).toObject();class B extends Error{constructor(t){super(t);l(this,"code");this.code="CREATE_MATCH_FAILED"}}class A extends B{constructor(e){super(e),this.name="PlayerIdNotValid",this.message=e??"Player id is not valid"}}const{Dtos:bt}=h;class Je{constructor(e){l(this,"game");l(this,"initContext",()=>{const e={contextId:GameSDK.context.getID(),contextType:GameSDK.context.getType(),entryPointData:GameSDK.getEntryPointData()},t=new bt.Context.Info(e),{contextId:s,contextType:a,entryPointData:n}=t.toObject();this.game.context.receiveContext(s,a,n)});l(this,"initPlayer",async()=>{const{player:e}=this.game,t=this.getPlayerInfo(),s=Object.values(Ke),a=await GameSDK.player.getDataAsync(s),n=new bt.Player.Data(a).toObject();e.receiveData(t,n),this.game.event.emit(h.Events.PLAYER_INFO_LOADED)});l(this,"getPlayerInfo",()=>{try{const e=GameSDK.player.getID();let t=GameSDK.player.getName();const s=GameSDK.player.getPhoto(),a=GameSDK.getLocale();if(!h.Utils.Valid.isString(e))throw new A;return h.Utils.Valid.isString(t)||(t="You"),new bt.Player.Info({playerId:e,name:t,photo:s,locale:a}).toObject()}catch{return j}});this.game=e}}class Rt extends Error{constructor(t,s){super(t);l(this,"payload");this.name="BadRequest",this.message=t??"This request is bad",this.payload=s}}class Gt extends Error{constructor(t,s){super(t);l(this,"payload");this.name="RequestTimeout",this.message=t??"This request is timeout",this.payload=s}}const{Utils:Ye,Configs:Xe}=h,{AppId:Jt,Network:Vt}=Xe,Ze=o=>{if(!o.ok)throw new Rt(void 0,{response:o})},pe=()=>{const o=window.game.auth.getToken();return{token:o,timeout:Vt.Timeout,headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"}}},ge=(o,e,t,s)=>async()=>{try{if(!Jt)throw new Rt("AppId is not defined");const a=`${o}/apps/${Jt}/${e}`,n=new AbortController;t.signal=n.signal;const i=setTimeout(()=>{n.abort()},t.timeout);h.Utils.Valid.isObject(s)&&(t.body=JSON.stringify(s));const r=await fetch(a,t);return clearTimeout(i),Ze(r),await r.json()||{}}catch(a){if(a instanceof Rt)return null;throw a instanceof Object&&"name"in a&&a.name==="AbortError"?new Gt:a}},Ut=async(o,e)=>{try{return o()}catch(t){if(t instanceof Gt&&e>0)try{return await Ye.Time.sleepAsync(600),await Ut(o,e-1)}catch{return{}}return t instanceof Gt?{}:{}}},Z=async(o,e={},t,s=Vt.Retries)=>{try{const a={...pe(),...e,method:"GET"},n=ge(t,o,a);return await Ut(n,s)}catch{return{}}},C=async(o,e,t={},s,a=Vt.Retries)=>{try{const n={...pe(),...t,method:"POST"},i=ge(s,o,n,e);return await Ut(i,a)}catch{return{}}},{ApiUrl:ts}=h.Configs.Notification,es=async o=>{if(!h.Utils.Object.hasOwn(o,"playerId"))throw new Error("Missing playerId");const{playerId:e}=o;await C(`players/${e}`,o,{},ts,10)};var Ht=(o=>(o.IDLE="idle",o.LOADING="loading",o.FILLED="filled",o.SHOWING="showing",o))(Ht||{}),_=(o=>(o.BANNER="banner",o.INTERSTITIAL="interstitial",o.REWARDED_VIDEO="rewarded_video",o))(_||{});let st=class extends Error{constructor(t,s){super(s);l(this,"code");this.code=t,this.message=s}};class ss{constructor(e,t){l(this,"type");l(this,"status");l(this,"placementId");this.type=e,this.status=Ht.IDLE,this.placementId=t}getStatus(){return this.status}exception(e){throw new st("AD_INSTANCE_ERROR",e)}}let ye=class extends ss{loadAsync(){this.exception("This method is not implemented")}showAsync(){this.exception("This method is not implemented")}hideAsync(){this.exception("Unsupported method")}};h.Plugins.Ads={Types:_,Status:Ht,AdError:st,AdInstance:ye};class as extends m.Plugins.BasePlugin{constructor(){super(...arguments);l(this,"enabled");l(this,"config");l(this,"isAdShowed");l(this,"lastAdShownTime");l(this,"ads",{});l(this,"safeAreaBottom")}init(){this.isAdShowed=!1,this.lastAdShownTime=0,this.calculateSafeAreaBottom()}calculateSafeAreaBottom(){try{const t=getComputedStyle(document.documentElement).getPropertyValue("--sab");this.safeAreaBottom=parseInt(t,10),isNaN(this.safeAreaBottom)&&(this.safeAreaBottom=0)}catch{this.safeAreaBottom=0}}configure(t){this.config=t,this.enabled=this.config.Enabled}checkEnabled(){if(!this.enabled)throw new st("ADS_NOT_ENABLED","Ads is't enabled")}isAdShowing(){return this.isAdShowed}setAdInstance(t,s,a){this.ads[s]||(this.ads[s]={type:t,placementId:s,interval:null,instance:new a(t,s)})}async preloadInterstitialAdAsync(){await this.loadAdAsync(_.INTERSTITIAL)}async showInterstitialAdAsync(){if(!this.canbeShowInterstitialAd())throw new st("INTERSTITIAL_AD_CAN_NOT_SHOW","Can't show interstitial ad");await this.showAdAsync(_.INTERSTITIAL)}async preloadRewardedVideoAsync(){await this.loadAdAsync(_.REWARDED_VIDEO)}async showRewardedVideoAsync(){await this.showAdAsync(_.REWARDED_VIDEO)}async loadAdAsync(t,s){this.checkEnabled(),await this.getAd(t,s).instance.loadAsync()}async showAdAsync(t,s){this.checkEnabled();const a=this.getAd(t,s);this.lastAdShownTime=window.performance.now()/1e3,this.isAdShowed=!0;try{await a.instance.showAsync()}finally{this.isAdShowed=!1}}getAdStatus(t,s){return this.checkEnabled(),this.getAd(t,s).instance.getStatus()}getAd(t,s){let a=null;if(s?a=this.getAdByPlacementId(s):a=this.getPriorityAdByType(t),!a)throw new st("AD_INSTANCE_NOT_INITIATED","The instance ads not yet initiated");return a}getAdsByType(t){return Object.values(this.ads).filter(s=>s.type===t)}getAdByPlacementId(t){const s=this.ads[t];return s||null}getPriorityAdByType(t){const s=this.getAdsByType(t);if(!s.length)return null;const a=s.find(n=>n.type===t);return a||null}canbeShowInterstitialAd(t){return this.canbeShowInterstitialAdByTime(t)}canbeShowInterstitialAdByTime(t){try{const s=window.performance.now()/1e3;let a;if(t)a=this.getCommonAdConfig(t);else{const c=this.getPriorityAdByType(_.INTERSTITIAL);if(!c)return!1;a=this.getCommonAdConfig(c.placementId)}const{SecondsBetweenAds:n,SecondsFirstTime:i}=a,r=s-this.lastAdShownTime;return this.lastAdShownTime>0?r>n:r>i}catch{return!1}}canbeShowBannerAd(t){try{const s=this.getBannerConfig(t),{Platform:a}=s;if(a==="ALL")return!0;const n=GameSDK.getPlatform();return n?n===a:!1}catch{return!1}}async showBannerAdAsync(t){this.checkEnabled();const s=this.getAd(_.BANNER,t);if(!this.canbeShowBannerAd(s.placementId))throw new Error("Banner ad can not be shown");this.cleanBannerReloadTimer(s.placementId),await s.instance.showAsync();const a=this.getBannerConfig(s.placementId),{SecondsReload:n}=a;n<=0||(s.interval=setTimeout(()=>{this.showBannerAdAsync(s.placementId)},n*1e3))}async hideBannerAdAsync(t){this.checkEnabled();const s=this.getAd(_.BANNER,t);this.cleanBannerReloadTimer(s.placementId),await s.instance.hideAsync()}cleanBannerReloadTimer(t){try{const s=this.getAd(_.BANNER,t),{interval:a}=s;if(!a)return;clearInterval(a)}catch{}}getCommonAdConfig(t){const a=[...this.config.InterstitialAdOptions,...this.config.RewardedVideoAdOptions].find(n=>n.PlacementId===t);if(!a)throw new Error(`Ad config with placementId ${t} not found`);return a}getBannerConfig(t){const s=this.config.BannerDisplayAdOptions.find(a=>a.PlacementId===t);if(!s)throw new Error(`Banner config with placementId ${t} not found`);return s}getBannerHeight(t){this.checkEnabled();const s=this.safeAreaBottom,a=this.getBannerConfig(t),{BannerHeight:n}=a;return n+s}}var fe=(o=>(o.BUTTON_CLICK="button_click",o.SCREEN_OPEN="screen_open",o.LOAD_START="load_start",o.LOAD_COMPLETE="load_complete",o.APP_READY="app_ready",o.TUTORIAL_BEGIN="tutorial_begin",o.TUTORIAL_STEP="tutorial_step",o.TUTORIAL_COMPLETE="tutorial_complete",o.MATCH_START="match_start",o.MATCH_RESCUE="match_rescue",o.MATCH_END="match_end",o.LEVEL_START="level_start",o.LEVEL_RESCUE="level_rescue",o.LEVEL_END="level_end",o.SHARE="share",o.MESSAGE="message",o.INVITE="invite",o.SHORTCUT_CREATE="shortcut_create",o.SHORTCUT_CREATE_POPUP="shortcut_create_popup",o.BOT_SUBSCRIBE="bot_subscribe",o.BOT_SUBSCRIBE_POPUP="bot_subscribe_popup",o.AD_SHOW="ad_show",o.AD_SHOW_FAILED="ad_show_failed",o.NEW_USER="new_user",o.AD_IMPRESSION="ad_impression",o.JOIN_GROUP="join_group",o.TOURNAMENT_SHARE="tournament_share",o.TOURNAMENT_CREATE="tournament_create",o.TOURNAMENT_POST_SCORE="tournament_post_score",o))(fe||{});let ns=class{constructor(e,t,s){l(this,"name");l(this,"color");l(this,"options");l(this,"selfLog");this.name=e,this.color=s||"#FFF",this.options=t,this.selfLog=!0}event(e,t,s){this.processEvent(e,t,s)}pageview(e){const t=this.getPageByKey(e);this.processPageView(t)}levelStart(e,t,s){this.processLevelStart(e,t,s)}levelFail(e,t,s){this.processLevelFail(e,t,s)}levelRescue(e,t,s){this.processLevelRescue(e,t,s)}levelComplete(e,t,s){this.processLevelComplete(e,t,s)}showInterstitialAd(e){this.processShowInterstitialAd(e)}showRewardedVideoAd(e){this.processShowRewardedVideoAd(e)}receiveVideoReward(e){this.processReceiveReward(e)}showAdFail(e,t,s){this.processShowAdFail(e,t,s)}getPageByKey(e){let t=e.replace(/_/g,"-");return t=t.toLowerCase(),t}processEvent(e,t,s){throw new Error("Method not implemented.")}processLevelStart(e,t,s){throw new Error("Method not implemented.")}processLevelFail(e,t,s){throw new Error("Method not implemented.")}processLevelRescue(e,t,s){throw new Error("Method not implemented.")}processLevelComplete(e,t,s){throw new Error("Method not implemented.")}processShowInterstitialAd(e){throw new Error("Method not implemented.")}processShowRewardedVideoAd(e){throw new Error("Method not implemented.")}processReceiveReward(e){throw new Error("Method not implemented.")}processShowAdFail(e,t,s){throw new Error("Method not implemented.")}processPageView(e){throw new Error("Method not implemented.")}};h.Plugins.Analytics={Events:fe,BaseAnalytics:ns};class is extends m.Plugins.BasePlugin{constructor(){super(...arguments);l(this,"analytics",[]);l(this,"placement","unknown");l(this,"pageview",t=>{this.isActive()&&this.analytics.forEach(s=>{s.pageview(t)})})}add(t){this.analytics.push(t)}event(t,s,a){this.isActive()&&this.analytics.forEach(n=>{n.event(t,s,a)})}levelStart(t,s,a){this.isActive()&&this.analytics.forEach(n=>{n.levelStart(t,s,a)})}levelRescue(t,s,a){this.isActive()&&this.analytics.forEach(n=>{n.levelRescue(t,s,a)})}levelFail(t,s,a){this.isActive()&&this.analytics.forEach(n=>{n.levelFail(t,s,a)})}levelComplete(t,s,a){this.isActive()&&this.analytics.forEach(n=>{n.levelComplete(t,s,a)})}showInterstitialAd(){if(!this.isActive())return;const t=this.getCurrentPlacement();this.analytics.forEach(s=>{s.showInterstitialAd(t)})}showRewardedVideoAd(){if(!this.isActive())return;const t=this.getCurrentPlacement();this.analytics.forEach(s=>{s.showRewardedVideoAd(t)})}receiveVideoReward(){if(!this.isActive())return;const t=this.getCurrentPlacement();this.analytics.forEach(s=>{s.receiveVideoReward(t)})}showAdFail(t,s,a){this.isActive()&&this.analytics.forEach(n=>{n.showAdFail(t,s,a)})}isActive(){return this.analytics.length>=1}setPlacement(t){this.placement=t}getCurrentPlacement(){return this.placement}}class os{constructor(e){l(this,"key");this.key=e}getKey(){return this.key}}class rs{constructor(e){l(this,"id");l(this,"isMuteAll");l(this,"masterVolume");l(this,"audioClips");this.id=e,this.masterVolume=1,this.isMuteAll=!1,this.audioClips={}}getId(){return this.id}getAudioClip(e){return this.audioClips[e]?this.audioClips[e]:null}setAudioClip(e,t){this.audioClips[e]={...this.audioClips[e],...t}}play(e,t){const s=this.getAudioClip(e);if(s){const{audioPlayer:a}=s;this.playWithRealConfig(a,t)}else this.loadAndPlay(e,t)}async loadAndPlay(e,t){try{const s=await this.onLoadAudio(e,t),{volume:a=1}=t||{};this.setAudioClip(e,{volume:a,audioPlayer:s}),this.playWithRealConfig(s,t)}catch{}}playWithRealConfig(e,t){if(t){const{volume:s=1}=t;t.volume=this.masterVolume*s}e.play(t)}pause(e){const t=this.getAudioClip(e);if(!t)return!1;const{audioPlayer:s}=t;return s.pause(),!0}resume(e){const t=this.getAudioClip(e);if(!t)return!1;const{audioPlayer:s}=t;return s.resume(),!0}stop(e){const t=this.getAudioClip(e);if(!t)return!1;const{audioPlayer:s}=t;return s.stop(),!0}stopAll(){this.callAudioPlayers("stop")}muteAll(){this.isMuteAll||(this.isMuteAll=!0,this.callAudioPlayers("mute"))}unmuteAll(){this.isMuteAll&&(this.isMuteAll=!1,this.callAudioPlayers("unmute"))}setVolume(e){this.masterVolume=e,this.callAudioPlayers("setVolume")}getVolume(){return this.masterVolume}queueAudioPlayer(e,t){try{const{audioPlayer:s,volume:a=1}=e;switch(t){case"play":s.play();break;case"pause":s.pause();break;case"resume":s.resume();break;case"stop":s.stop();break;case"mute":s.setVolume(0);break;case"unmute":case"setVolume":s.setVolume(this.masterVolume*a);break;default:throw new Error(`Unsupported function: ${t}`)}}catch{}}callAudioPlayers(e){Object.values(this.audioClips).forEach(s=>{this.queueAudioPlayer(s,e)})}}h.Plugins.Audio={BaseAudioPlayer:os,BaseChannelManager:rs};class cs extends m.Plugins.BasePlugin{constructor(){super(...arguments);l(this,"firstChannelId");l(this,"channels",{})}addChannel(t){const s=t.getId();this.channels[s]=t,this.firstChannelId||(this.firstChannelId=s)}getChannel(t){if(t===void 0)return this.channels[this.firstChannelId];const s=this.channels[t];if(!s)throw new Error(`Channel ${t} not found`);return s}play(t,s,a){try{this.getChannel(a).play(t,s)}catch{}}pause(t,s){try{this.getChannel(s).pause(t)}catch{}}resume(t,s){try{this.getChannel(s).resume(t)}catch{}}stop(t,s){try{this.getChannel(s).stop(t)}catch{}}stopAll(t){try{this.getChannel(t).stopAll()}catch{}}mute(t){try{this.getChannel(t).muteAll()}catch{}}unmute(t){try{this.getChannel(t).unmuteAll()}catch{}}setVolume(t,s){try{this.getChannel(s).setVolume(t)}catch{}}}const ls={token:"",isRequesting:!1};class hs extends m.Plugins.BasePlugin{init(){const{storage:e}=this.game;e.addStorage("auth",ls)}async requestToken(){const{storage:e}=this.game;try{if(e.getStorageData("auth","isRequesting")||e.getStorageData("auth","token")!=="")return;e.setStorageData("auth","isRequesting",!0);const n=(await GameSDK.player.getSignedPlayerInfoAsync()).getSignature();e.setStorageData("auth","token",n)}catch(t){if(h.Utils.Object.hasOwn(t,"code")&&t.code==="PENDING_REQUEST")return;e.setStorageData("auth","token","")}finally{e.setStorageData("auth","isRequesting",!1)}}getToken(){const{storage:e}=this.game;return e.getStorageData("auth","token")}}var H=(o=>(o.SOLO="solo",o.TOURNAMENT="tournament",o.SHARE_INVITE="share_invite",o.MATCHING_GROUP="matching_group_match",o.CHALLENGE_FRIEND="challenge_friend_match",o))(H||{}),E=(o=>(o.SINGLE="single",o.ONLINE="online",o.TOURNAMENT="tournament",o.MATCHING_GROUP="matching-group",o.CHALLENGE_FRIEND="challenge-friend",o))(E||{});const ds=E,z=ds;class us{constructor(e){l(this,"game");this.game=e}isValidContextType(e){return["THREAD","POST","SOLO","GROUP"].indexOf(e)>=0}isValidEntryPointData(e){return h.Utils.Valid.isObject(e)}receiveContext(e,t,s){const{storage:a}=this.game;a.setStorageData("context","contextId",e),this.isValidEntryPointData(s)&&a.setStorageData("context","entryPointData",s),this.isValidContextType(t)&&a.setStorageData("context","contextType",t)}async detectContextSessionType(){const{storage:e}=this.game,t=e.getStorageData("context","entryPointData"),{type:s}=t,{SOLO:a,TOURNAMENT:n,MATCHING_GROUP:i,SHARE_INVITE:r,CHALLENGE_FRIEND:c}=H;let d=a;if(s===n&&(d=n),s===i&&(d=i),(s===c||s===r)&&(d=c),d===a)try{if(!("getTournamentAsync"in GameSDK))throw new Error("Unavailable feature: tournament");await GameSDK.getTournamentAsync(),d=n}catch{}e.setStorageData("context","sessionContextType",d)}detectContextGameMode(){const{player:e,storage:t}=this.game,s=t.getStorageData("context","entryPointData"),a=t.getStorageData("context","sessionContextType"),n=e.getPlayerId(),{matchId:i,playerId:r,opponentId:c=j.playerId}=s,d=n===r,p=c===j.playerId||[c,r].indexOf(n)>=0,{TOURNAMENT:g,MATCHING_GROUP:y,SHARE_INVITE:S,CHALLENGE_FRIEND:N}=H;let v=z.SINGLE;a===g&&(v=z.TOURNAMENT),a===S&&!d&&(v=z.CHALLENGE_FRIEND),a===N&&i&&p&&(v=z.CHALLENGE_FRIEND),a===y&&(v=z.MATCHING_GROUP),t.setStorageData("context","contextGameMode",v)}}class me extends Error{constructor(e){super(e),this.name="PlayerHasFinishedMatch",this.message=e||"Player has finished match"}}class we extends Error{constructor(e){super(e),this.name="PlayerNotJoinInMatch",this.message=e||"Player is not join in match"}}const{Events:Nt,Plugins:ps}=h,{Analytics:gs}=ps;class ys{constructor(e){l(this,"game");l(this,"processTournamentMode",async()=>{const{match:e,player:t}=this.game,s=t.getPlayerId(),a=GameSDK.context.getID();if(typeof a!="string")throw new Error("Cannot get contextId");await e.tournament.continue.processAsync({playerId:s,contextId:a}),this.switchToGameScene()});l(this,"switchToDashboardScene",()=>{const{event:e}=this.game;e.emit(Nt.SWITCH_SCENE,{sceneName:"DashboardScene",sceneData:{isContextProcessing:!0}})});l(this,"switchToGameScene",()=>{const{event:e}=this.game;e.emit(Nt.SWITCH_SCENE,{sceneName:"GameScene",sceneData:{isContextProcessing:!0}})});l(this,"switchToResultScene",()=>{const{event:e}=this.game;e.emit(Nt.SWITCH_SCENE,{sceneName:"ResultScene",sceneData:{isContextProcessing:!0}})});this.game=e}async processContextData(){const{player:e,analytics:t,storage:s}=this.game,a=s.getStorageData("context","contextId"),n=s.getStorageData("context","entryPointData"),i=s.getStorageData("context","sessionContextType"),{type:r,matchId:c,playerId:d,opponentId:u,playerScore:p}=n||{};e.isFirstLogin()&&t.event(gs.Events.NEW_USER);const{TOURNAMENT:g,SHARE_INVITE:y,MATCHING_GROUP:S,CHALLENGE_FRIEND:N}=H;if(i===g){this.processTournamentMode();return}if(i===N){if(r===y&&typeof d=="string"){await this.processChallengeFromPost(d);return}if(r===N&&typeof c=="string"&&typeof d=="string"&&typeof u=="string"){await this.processChallengeFromMessage({contextId:a,matchId:c,playerId:d,opponentId:u});return}}if(i===S&&typeof d=="string"&&typeof p=="number"){await this.processMatchingGroupMode(d,p);return}if(e.isFirstLogin()){await this.processNewUserMode();return}this.switchToDashboardScene()}async processChallengeFromPost(e){const{match:t,player:s}=this.game,a=s.getPlayerId();if(a===e)throw new Error("Cannot play with yourself");await t.challenge.friend.processAsync({playerId:a,opponentId:e}),this.switchToGameScene()}async processChallengeFromMessage(e){try{await this.processContinueChallengeFromMessage(e);return}catch(t){if(t instanceof me){this.switchToResultScene();return}if(t instanceof we){await this.processJoinChallengeFromMessage(e);return}}}async processContinueChallengeFromMessage(e){const{contextId:t,matchId:s,playerId:a,opponentId:n}=e,{match:i,player:r}=this.game,c=r.getPlayerId();if(a===c)await i.challenge.continue.processAsync({contextId:t,matchId:s,playerId:c,opponentId:n});else{const u=n===j.playerId;await i.challenge.continue.processAsync({contextId:t,matchId:s,playerId:c,opponentId:u?n:a})}this.switchToGameScene()}async processJoinChallengeFromMessage(e){const{contextId:t,matchId:s,playerId:a}=e,{match:n,player:i}=this.game,r=i.getPlayerId();await n.challenge.join.processAsync({contextId:t,matchId:s,playerId:r,opponentId:a}),this.switchToGameScene()}async processMatchingGroupMode(e,t){const{match:s,player:a}=this.game;await s.group.join.processAsync({playerId:a.getPlayerId(),opponentId:e,opponentScore:t}),this.switchToGameScene()}async processNewUserMode(){const{match:e,player:t}=this.game,s=t.getPlayerId();await e.single.start.processAsync({playerId:s}),t.loggedIn(),this.switchToGameScene()}}const Ae={processed:!1,contextId:"",contextType:"SOLO",entryPointData:{},contextGameMode:"",sessionContextType:""};class fs extends m.Plugins.BasePlugin{constructor(t){super(t);l(this,"context");l(this,"loader");this.loader=new ys(t),this.context=new us(t)}init(){const{storage:t}=this.game;t.addStorage("context",Ae)}getSessionContextTypes(){return H}async processContextData(){try{await this.loader.processContextData()}catch{}}async detectContextSessionType(){try{await this.context.detectContextSessionType()}catch{}}detectContextGameMode(){this.context.detectContextGameMode()}receiveContext(t,s,a){this.context.receiveContext(t,s,a)}}const{Valid:Mt}=h.Utils,{contextId:ms,contextType:ws,entryPointData:As}=Ae,Tt="is invalid";class Ie extends x{constructor(){super(...arguments);l(this,"data")}setupData(t){this.lazySetupData(t)}validateStructure(t){this.lazyValidateStructure(t)}validateData(t){this.lazyValidateData(t)}validateContextId(t){Mt.isString(t)||this.exception("contextId",Tt)}validateContextType(t){(!Mt.isString(t)||!t)&&this.exception("contextType",Tt)}validateEntryPointData(t){Mt.isObject(t)||this.exception("entryPointData",Tt)}toObject(){return super.toObject()}}Ie.addDefaultData({contextId:ms,contextType:ws,entryPointData:As});h.Dtos.Context={Info:Ie};const $=new Be,Is={names:[],history:[]};class Ps extends m.Plugins.BasePlugin{constructor(){super(...arguments);l(this,"enableLog",!1)}init(){const{storage:t}=this.game;t.addStorage("event",Is)}enableLogEvent(){this.enableLog=!0}on(t,s){this.validateCallback(s),this.addEventName(t),this.addHistory(t,"on","listening"),$.on(t,s)}once(t,s){this.validateCallback(s),this.addEventName(t),this.addHistory(t,"once","listening"),$.once(t,s)}off(t,s){this.validateCallback(s),$.off(t,s),this.addHistory(t,"on","removed")}clear(t){$.removeAllListeners(t),this.addHistory(t,"on","removed")}emit(t,s){let a=[];s&&(a=[s]),this.addHistory(t,"on","called",s),$.emit(t,...a)}validateCallback(t){if(typeof t!="function")throw new Error("Callback must be a function")}addEventName(t){const{storage:s}=this.game,a=s.getStorageData("event","names");a.includes(t)||a.push(t)}getEventListeners(){const t=$.eventNames();return Object.keys(t)}getEventEmitCount(t){const{storage:s}=this.game;return s.getStorageData("event","history").filter(n=>n.name===t&&n.status==="called").length}getHistory(){const{storage:t}=this.game;return t.getStorageData("event","history")}addHistory(t,s,a,n){var u,p;const i=this.getHistory(),r=(u=i.find(g=>g.name===t))==null?void 0:u.type,c=((p=i.find(g=>g.name===t))==null?void 0:p.called)??0,d=a==="called"?c+1:c;i.push({type:r??s,status:a,name:t,called:d,payload:n??{}}),this.logEventInfo(t,s,a,d)}logEventInfo(t,s,a,n){this.enableLog&&(a==="listening"&&$.listenerCount(t),a==="called"&&$.listenerCount(t))}}const Ds='nunito,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif',Ss=(o,e)=>{if(isNaN(o)||isNaN(e))throw new Error("width and height must be numbers");return{string:"+",style:"font-size: 1px; padding: "+Math.floor(e/2)+"px "+Math.floor(o/2)+"px;"}},Cs=(o,e=1)=>{const t=new Image;t.onload=function(){const s=this,a=s.width*e,n=s.height*e;Ss(a,n)},t.src=o};class xs extends m.Plugins.BasePlugin{constructor(){super(...arguments);l(this,"width");l(this,"height");l(this,"canvas",null);l(this,"renderOptions");l(this,"caches",{})}preload(t){const s=Object.keys(t);s.length<1||s.forEach(a=>{const n=t[a];n&&this.loadImage(a,n)})}async capture(t){const{width:s,height:a,renderOptions:n}=t;return this.width=s,this.height=a,this.renderOptions=n,this.createCanvas(),await this.loadImages(),this.drawObjects(),this.snapshotFrame()}createCanvas(){this.canvas?this.canvas.remove():this.canvas=document.createElement("canvas",{is:"canvas"}),this.canvas.width=this.width,this.canvas.height=this.height}async loadImage(t,s){return new Promise((a,n)=>{if(this.caches[t]){a();return}const i=document.createElement("img");i.src=s,i.onload=()=>{this.caches[t]=i,a()},i.onerror=r=>{n(r)}})}async loadImages(){const t=[];for(const s in this.renderOptions){const{name:a,image:n}=this.renderOptions[s];if(!n||this.caches[a])continue;const r=this.loadImage(a,n);t.push(r)}await Promise.all(t)}drawObjects(){for(const t in this.renderOptions){const s=this.renderOptions[t];switch(s.type){case"text":this.drawText(s);break;case"image":this.drawImage(s);break}}}drawText(t){if(!this.canvas)return;const s=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!s)return;const{x:a,y:n,font:i,text:r,fillStyle:c,lineWidth:d,textAlign:u}=t;s.font=`${i} ${Ds}`,s.fillStyle=c||"#ffffff",d&&(s.lineWidth=d),u&&(s.textAlign=u),s.fillText(r,a,n)}drawImage(t){if(!this.canvas)return;const s=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!s)return;const{x:a,y:n,name:i,width:r,height:c,fallbackWithImage:d}=t;let u=this.caches[i];if(!u&&d)u=this.caches[d];else if(!u)throw new Error(`Image ${i} not found`);s.drawImage(u,a,n,r,c)}snapshotFrame(){if(!this.canvas)return"";const t=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!t)return"";const s=t.canvas.toDataURL("image/jpeg",.85);return h.Utils.Valid.isDebugger()&&Cs(s),s}}const{Utils:Yt}=h;class Es extends m.Plugins.BasePlugin{constructor(){super(...arguments);l(this,"locale");l(this,"data",{})}add(t,s){this.data[t]=s}choose(t){this.locale=t;const{event:s}=this.game;s.emit(h.Events.LANGUAGE_CHANGED,{locale:t})}getText(t,s,a){const{text:n}=this.getLocaleData(a);if(!Yt.Object.hasOwn(n,t))return a??this.getCurrentLocale(),String(t);const i=n[t];return this.replaceVariables(i,s??[])}getTexture(t){const{texture:s}=this.getLocaleData();return s[t]}getCurrentLocale(){return this.locale||"en"}getLocaleData(t){const s=t??this.getCurrentLocale();if(!Yt.Object.hasOwn(this.data,s))throw new Error(`Locale "${s}" not found`);return this.data[s]}replaceVariables(t,s){const a=s.length;if(a==0)return t;let n=t;for(let i=0;i<a;i++){const r=s[i],c=`%{${i}}`;n=n.replace(c,r)}return n}}const{OtherHost:Pe}=h.Configs,Xt=async(o,e)=>{const t=h.Utils.String.params(e),s=await Z(`${o}?${t}`,{},Pe);return h.Utils.Valid.isObject(s)?h.Utils.Object.hasOwn(s,"data")&&Array.isArray(s.data)?s.data:[]:[]},vs=async(o,e,t)=>{await C(`leaderboards/${o}/players/${e}`,{score:t},{},Pe)},Zt={id:"",type:"",limit:0,offset:0,leaders:{},isRequesting:!1},bs={leaderboards:{}};class Ns extends m.Plugins.BasePlugin{constructor(){super(...arguments);l(this,"configs")}init(){const{storage:t}=this.game;t.addStorage("leaderboard",bs),this.configs={}}addLeaderboard(t,s,a,n){if(this.getLeaderboard(t))return;const{LeaderboardId:r}=n;let c=`leaderboards/${r}/`;a==="global"?c+="leaders":a==="friend"&&(c+="players"),this.configs[t]={id:t,type:a,host:c,mock:s},this.setLeaderboard(t,{...Zt})}async requestLeaderboard(t,s){try{this.validateLeaderboard(t),this.clearLeaderboard(t),this.setLeaderboard(t,{isRequesting:!0});const{type:a,host:n,playerIds:i}=this.configs[t],r={limit:s,offset:0,playerIds:i};if(a==="friend"&&!i){const{player:d}=this.game,u=d.getPlayerId(),p=d.getConnectedPlayerIds(s,0);r.playerIds=[u,...p]}const c=await Xt(n,r);await this.receiveLeaderboard(t,c),this.setLeaderboard(t,{limit:s,offset:0})}finally{this.setLeaderboard(t,{isRequesting:!1})}}async loadMoreLeaderboard(t,s){try{const a=this.getLeaderboard(t);if(!a)return;this.setLeaderboard(t,{isRequesting:!0});const{host:n}=this.configs[t],{offset:i}=a,r=i+s,c=await Xt(n,{limit:s,offset:r});this.receiveLeaderboard(t,c),this.setLeaderboard(t,{limit:s,offset:r})}finally{this.setLeaderboard(t,{isRequesting:!1})}}getLeaderboard(t){const{storage:s}=this.game,a=s.getStorageData("leaderboard","leaderboards");return a[t]?a[t]:null}clearLeaderboard(t){try{this.validateLeaderboard(t),this.setLeaderboard(t,{...Zt})}catch{}}isLeaderboardEmpty(t){const s=this.getLeaderboard(t);if(!s)return!0;const{leaders:a}=s;return Object.keys(a).length===0}async setLeaderboardScore(t,s,a){try{this.validateLeaderboard(t),await vs(t,s,a)}catch{}}validateLeaderboard(t){const{storage:s}=this.game;if(!s.getStorageData("leaderboard","leaderboards")[t])throw new Error(`Leaderboard with id ${t} not found`)}setLeaderboard(t,s){const{storage:a}=this.game;a.setStorageData("leaderboard","leaderboards",{[t]:s})}async receiveLeaderboard(t,s){this.validateLeaderboard(t);const{profile:a}=this.game,n=s.map(g=>g.playerId);await a.requestProfiles(n);const i=a.getProfiles(),u=s.map(g=>{const y=i[g.playerId];return y?{...g,...y}:{...g,name:"Unknown",photo:""}}).filter(g=>g.name&&g.photo).toSorted((g,y)=>y.score-g.score).map((g,y)=>({...g,rank:y+1})),p=h.Utils.Object.keyBy(u,"playerId");this.setLeaderboard(t,{leaders:p})}}class Bt{constructor(){l(this,"APIHost")}setAPIHost(e){this.APIHost=e}getAPIHost(){return this.APIHost}}const{Utils:Ot}=h;class Ms extends Bt{constructor(){super(...arguments);l(this,"appId")}setAppId(t){this.appId=t}async setLeaderboardScoreAsync(t){const{leaderboardId:s,playerId:a,score:n=0}=t,i=`leaderboards/${s}/players/${a}`;await C(i,{score:n},{},this.getAPIHost())}async createLeaderboardAsync(t){const s={_id:t._id,appId:this.appId,resetScore:t.resetScore||0,numberOfLeaders:t.numberOfLeaders||15,timezone:t.timezone||"utc+0",sortOrder:t.sortOrder||"desc",statistics:t.statistics||"max",resettable:t.resettable||"manually",description:t.description||"no description",createdBy:t.createdBy,name:t.name,expireTime:t.expireTime||6048e5};await C("leaderboards",s,{},this.getAPIHost())}async getLeaderboardAsync(t,s={}){let a=[];const n=Ot.String.params(s),i=`leaderboards/${t}/leaders`,r=await Z(`${i}?${n}`,{},this.getAPIHost());return Ot.Valid.isObject(r)?Ot.Object.hasOwn(r,"data")?(a=r.data,a):[]:[]}}const{Utils:te}=h;class Ts extends Bt{async createSingleMatchAsync(e){const s=await C("single-matches",e,{},this.getAPIHost());return this.returnValidMatchData(s)}async getSingleMatchDetailAsync(){const t=await Z("single-matches/active",{},this.getAPIHost());return this.returnValidMatchData(t)}async updateSingleMatchMoveAsync(e,t){const s=`single-matches/${e}/move`,a=await C(s,t,{},this.getAPIHost());return this.returnValidMatchData(a)}async finishSingleMatchAsync(e){const t=`single-matches/${e}/finish`,s=await C(t,{},{},this.getAPIHost());return this.returnValidMatchData(s)}async createMatchAsync(e){const s=await C("matches",{opponentPlayerId:e},{},this.getAPIHost());return this.returnValidMatchData(s)}async joinMatchAsync(e){const t=`matches/${e}/join`,s=await C(t,{},{},this.getAPIHost());return this.returnValidMatchData(s)}async getMatchDetailByIdAsync(e){const t=`matches/${e}`,s=await Z(t,{},this.getAPIHost());return this.returnValidMatchData(s)}async finishMatchAsync(e){const{matchId:t="",score:s=0,level:a=0,extraData:n={}}=e,i=`matches/${t}/finish`,r=await C(i,{matchId:t,score:s,level:a,extraData:n},{},this.getAPIHost());return this.returnValidMatchData(r)}returnValidMatchData(e){let t={};return!te.Valid.isObject(e)||!te.Object.hasOwn(e,"data")||(t=e.data),t}}const{Utils:lt}=h;class Os extends Bt{async getPlayersAsync(e){const t=lt.String.params(e),s=await Z(`players?${t}`,{},this.getAPIHost());return!lt.Valid.isObject(s)||!lt.Object.hasOwn(s,"data")?null:s.data}async updatePlayerProfileAsync(e){const t=await C("players",e,{},this.getAPIHost(),10);return lt.Object.hasOwn(t,"data")?t.data:null}async increaseUserGuideDisplays(e){await C(`players/${e}/user-guide-displays/inc`,{},{},this.getAPIHost())}}class Ls{constructor(e){l(this,"matchAPI");l(this,"playerAPI");l(this,"leaderboardAPI");this.createAPI(),this.setAPIConfig(e)}createAPI(){this.matchAPI=new Ts,this.playerAPI=new Os,this.leaderboardAPI=new Ms}setAPIConfig(e){e.playerAPIHost&&this.playerAPI.setAPIHost(e.playerAPIHost),e.matchAPIHost&&this.matchAPI.setAPIHost(e.matchAPIHost),e.leaderboardAPIHost&&this.leaderboardAPI.setAPIHost(e.leaderboardAPIHost),e.appId&&this.leaderboardAPI.setAppId(e.appId)}setMatchAPIInstance(e){this.matchAPI=e}setPlayerAPIInstance(e){this.playerAPI=e}setLeaderboardAPIInstance(e){this.leaderboardAPI=e}getPlayerAPI(){return this.playerAPI}getMatchAPI(){return this.matchAPI}getLeaderboardAPI(){return this.leaderboardAPI}}class De extends B{constructor(e){super(e),this.name="LevelNotDefined",this.message=e??"Level is not defined"}}class Se extends B{constructor(e){super(e),this.name="MatchModeNotDefined",this.message=e??"Match id is not defined"}}const{Utils:_s}=h;let f=class{constructor(e){l(this,"game");l(this,"match");l(this,"nextHandler");this.game=e.game,this.match=e.match,this.nextHandler=null}setNext(e){return this.nextHandler=e,e}async processAsync(e){this.logData("Before",e)}async nextAsync(e){this.logData("After",e),this.nextHandler&&await this.nextHandler.processAsync(e)}logData(e,t){_s.Valid.isDebugger()}};const{Utils:Rs}=h,{Analytics:Gs}=h.Plugins;class G extends f{async processAsync(e){super.processAsync(e);const{customData:t,mode:s}=e;if(s===null)throw new Se;const{level:a}=t;if(typeof a!="number")throw new De;const{analytics:n}=this.game;n.event(Gs.Events.MATCH_START,{game_mode:Rs.String.toUpperCamelCase(s),level:a,level_name:`level_${a}`}),await this.nextAsync(e)}}const b={OPEN:"open",ACTIVE:"active",FINISHED:"finished"};class D extends f{async processAsync(e){super.processAsync(e);const{mode:t,status:s}=e;let a=t??z.SINGLE;s===b.FINISHED&&(a=z.SINGLE),this.contextGameModeDetected(a),await this.nextAsync(e)}contextGameModeDetected(e){const{storage:t}=this.game;t.setStorageData("context","contextGameMode",e)}}class $t extends B{constructor(e){super(e),this.name="CreateContextFailed",this.message=e??"Create context failed"}}const{Utils:Fs}=h;class Vs extends f{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{opponentId:s}=this.payload,a=await this.createAsync(s);t.customData.contextId=a,await this.nextAsync(t)}async createAsync(t){try{await GameSDK.context.createAsync(t)}catch(a){if(!Fs.Object.hasOwn(a,"code")||a.code!=="SAME_CONTEXT")throw a}const s=GameSDK.context.getID();if(typeof s!="string")throw new $t;return s}}class Dt extends B{constructor(e){super(e),this.name="MatchAreNotOpen",this.message=e??"Match are not open"}}class q extends B{constructor(e){super(e),this.name="OpponentIdNotValid",this.message=e??"Opponent id is not valid"}}const{Dtos:Us}=h;class Ce extends f{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createMatchAsync(e),s=new Us.Match.Data(t).toObject();this.updateMatchState(e,s),await this.nextAsync(e)}validateData(e){const{status:t,customData:s}=e,{opponentId:a}=s;if(typeof a!="string")throw new q;if(t!==b.OPEN)throw new Dt}async createMatchAsync(e){const{opponentId:t}=e.customData;return t?this.match.api.getMatchAPI().createMatchAsync(t):{}}updateMatchState(e,t){const{customData:s}=e,{_id:a,whitePlayerId:n,blackPlayerId:i,whitePlayerFinish:r,blackPlayerFinish:c}=t,d=n===s.opponentId;e.id=a||null;const u=d?i:n,p=d?n:i;e.customData.playerId=u,e.customData.opponentId=p,e.profiles[u]||(e.profiles[u]={id:u,name:"",photo:"",finished:!1}),e.profiles[p]||(e.profiles[p]={id:p,name:"",photo:"",finished:!1});const g=d?c:r,y=d?r:c;e.profiles[u].finished=g,e.profiles[p].finished=y}}const{LeaderboardId:Hs}=h.Configs.LeadersBoard,xe={level:1,rescued:0,contextId:null,playerId:null,opponentId:null,leaderboardId:Hs};class M extends f{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.initializeMatch(t),await this.nextAsync(t)}initializeMatch(t){const{id:s,mode:a,customData:n}=this.payload;t.id=s??null,t.mode=a||null,t.status=b.OPEN,t.startAt=0,t.finishAt=0,t.profiles={},t.customData={...xe,...t.customData,...n}}}class F extends f{async processAsync(e){if(super.processAsync(e),e.status!==b.OPEN)throw new Dt;this.startMatch(e),await this.nextAsync(e)}startMatch(e){e.status=b.ACTIVE,e.startAt=Date.now()}}const It=H;class P extends Error{constructor(e){super(e),this.name="UnavailableFeature",this.message=`Unavailable feature: ${e}`}}const Bs=async()=>{const{player:o,match:e,frameCapture:t}=window.game,s=e.getMatchState(),{profiles:a}=s,{playerId:n,photo:i}=o.getPlayer(),{score:r}=a[n]||{},c=$s({playerId:n,playerPhoto:i,playerScore:r??0});if(!c)return;const d={name:"share-current-score",width:952,height:492,renderOptions:c};return await t.capture(d)},$s=o=>{const{playerId:e="10",playerPhoto:t="",playerScore:s=0}=o;return{avatar:{name:`${e}`,type:"image",x:634,y:118,image:t,width:240,height:240},wideFrame:{name:"wide-frame-message-win",type:"image",x:0,y:0,image:"./assets/wideframes/wide-frame-message-win.png",width:952,height:492},playerScoreShadow:{type:"text",x:760,y:454,font:"600 70px",fillStyle:"#c4683f",text:`${s}`,textAlign:"center"},playerScore:{type:"text",x:760,y:450,font:"600 70px",fillStyle:"#f2a62e",text:`${s}`,textAlign:"center"}}},jt=async()=>{const{match:o,frameCapture:e}=window.game,t=o.getMatchState(),{profiles:s,customData:a}=t,{playerId:n,opponentId:i}=a;if(!n||!i)return;const r=s[n],c=s[i],{photo:d,score:u,finished:p}=r,{photo:g,score:y=0,finished:S}=c,v=js({playerId:n,playerPhoto:d,playerScore:u,opponentId:i,opponentPhoto:g,opponentScore:y,isPlayerFinished:p,isOpponentFinished:S});if(!v)return;const Fe={name:"share-game-result",width:952,height:492,renderOptions:v};return await e.capture(Fe)},js=o=>{const{playerId:e="10",playerPhoto:t="",playerScore:s=0,opponentId:a="20",opponentPhoto:n="",opponentScore:i=0,isPlayerFinished:r,isOpponentFinished:c}=o,d=s===i,u=s>i,p=r||c,g=r&&c,y={leftPhoto:{name:`${e}`,type:"image",x:56,y:140,image:t,width:220,height:220},rightPhoto:{name:`${a}`,type:"image",x:690,y:140,image:n,width:220,height:220},wideFrame:{name:"wide-frame-game-result",type:"image",x:0,y:0,image:"./assets/wideframes/wide-frame-game-result.png",width:952,height:492}};return p&&(y.leftScoreShadow={type:"text",x:162,y:444,font:"600 70px",fillStyle:"#c4683f",text:r?`${s}`:"???",textAlign:"center"},y.leftScore={type:"text",x:162,y:440,font:"600 70px",fillStyle:"#f2a62e",text:r?`${s}`:"???",textAlign:"center"},y.rightScoreShadow={type:"text",x:796,y:444,font:"600 70px",fillStyle:"#c4683f",text:c?`${i}`:"???",textAlign:"center"},y.rightScore={type:"text",x:796,y:440,font:"600 70px",fillStyle:"#f2a62e",text:c?`${i}`:"???",textAlign:"center"}),!d&&g&&(u?y.leftCrown={name:"crown-icon",type:"image",x:112,y:72,image:"./assets/images/others/crown-icon.png",width:106,height:78}:y.rightCrown={name:"crown-icon",type:"image",x:750,y:72,image:"./assets/images/others/crown-icon.png",width:106,height:78}),y};class tt extends B{constructor(e){super(e),this.name="ContextIdNotValid",this.message=e??"Context id is not valid"}}class St extends B{constructor(e){super(e),this.name="MatchIdNotValid",this.message=e??"Match id is not valid"}}class Ee extends f{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesResultAsync().catch(()=>{});t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:a,opponentId:n}=s;if(!t||typeof t!="string")throw new St;if(!a||typeof a!="string")throw new tt;if(!n||typeof n!="string")throw new q}async createWideframesResultAsync(){return await jt()}async sendMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:r}=n;if(!i||typeof i!="string")throw new A;const{name:c}=a[i],d={data:{type:It.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:r},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{en_US:"Play",vi_VN:"Chơi ngay"}},text:{default:`${c} challenges you`,localizations:{en_US:`${c} challenges you`,vi_VN:`${c} thử thách bạn trong trận đấu này. Chơi ngay!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK))throw new P("updateAsync");await GameSDK.updateAsync(d)}}class I extends f{async processAsync(e){await this.nextAsync(e)}async nextAsync(e){this.nextHandler&&await this.nextHandler.processAsync(e)}}class k extends B{constructor(e){super(e),this.name="ProfileNotFound",this.message=e??"Profile not found"}}const{Dtos:ks}=h;class nt extends f{async processAsync(e){super.processAsync(e),this.validateData(e);const{customData:t}=e,{playerId:s,opponentId:a}=t;let n=s;const i=await this.getProfile(n);if(!i)throw new k;if(this.updateMatchProfile(e,n,i),n=a,n!==j.playerId){const r=await this.getProfile(n);if(!r)throw new k;this.updateMatchProfile(e,n,r)}else this.updateMatchProfile(e,n);await this.nextAsync(e)}validateData(e){const{customData:t}=e,{playerId:s,opponentId:a}=t;if(!s||typeof s!="string")throw new A;if(!a||typeof a!="string")throw new q}async getProfile(e){const{profile:t}=this.game;return await t.requestProfiles([e]),t.getProfiles()[e]}updateMatchProfile(e,t,s){const{name:a,photo:n}=s??j,i=new ks.Match.Profile({id:t,name:a,photo:n}).toObject();e.profiles[t]?(e.profiles[t].name=i.name,e.profiles[t].photo=i.photo):e.profiles[t]=i}}class w{constructor(e,t){l(this,"game");l(this,"match");this.game=e,this.match=t}startLog(e){}endLog(){}async processAsync(e){throw new Error("Not implemented")}}class Ks extends w{async processAsync(e){try{this.startLog(e);const{playerId:t,opponentId:s}=e,a=new I(this),n=new Vs(this,{opponentId:s});a.setNext(n);const i=new M(this,{mode:E.CHALLENGE_FRIEND,customData:{playerId:t,opponentId:s}});n.setNext(i);const r=new Ce(this);i.setNext(r);const c=new nt(this);r.setNext(c);const d=new F(this);c.setNext(d);const u=new G(this);d.setNext(u);const p=new Ee(this);u.setNext(p);const g=new D(this);p.setNext(g);const y=this.match.getMatchState();await a.processAsync(y)}finally{this.endLog()}}}class Lt extends Error{constructor(e){super(e),this.name="SameContext",this.message=e??"Same context"}}const{Utils:zs}=h;class kt extends f{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{contextId:s}=this.payload;await this.switchAsync(s),t.customData.contextId=s,await this.nextAsync(t)}checkSameContext(t){const s=t==="SOLO",a=GameSDK.context.getID();if(a===t)throw new Lt;if(s&&a===null)throw new Lt}async switchAsync(t){try{this.checkSameContext(t);const s=t==="SOLO";await GameSDK.context.switchAsync(t,s)}catch(s){if(s instanceof Lt)return;if(!zs.Object.hasOwn(s,"code")||s.code!=="SAME_CONTEXT")throw s}}}class qs extends Error{constructor(e){super(e),this.name="PlayerNotCurrentInMatch",this.message=e||"The player is not currently in this match"}}class Ws extends Error{constructor(e){super(e),this.name="GetMatchDetailFailed",this.message=e??"Get match detail failed"}}const{Dtos:Qs}=h;class Js extends f{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.getMatchAsync(e),s=new Qs.Match.Data(t).toObject();this.validateContinueMatchData(e,s),this.updateMatchData(e,s),this.validatePlayerTurn(e),await this.nextAsync(e)}validateMatchData(e){const{id:t,status:s}=e;if(typeof t!="string")throw new St;if(s!==b.OPEN)throw new Dt}validateContinueMatchData(e,t){const{id:s,customData:a}=e,{_id:n,whitePlayerId:i,blackPlayerId:r}=t;if(typeof n!="string"||n!==s)throw new Ws;const{playerId:c}=a,d=i===c,u=r===c;if(!d&&r===j.playerId)throw new we;if(!d&&!u)throw new qs}validatePlayerTurn(e){const{profiles:t,customData:s}=e,{playerId:a}=s;if(typeof a!="string")throw new A;const{finished:n}=t[a];if(n)throw new me}async getMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().getMatchDetailByIdAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:a,blackPlayerId:n,whitePlayerScore:i,blackPlayerScore:r,whitePlayerFinish:c,blackPlayerFinish:d}=t,u=a===s.playerId,p=u?a:n,g=u?n:a;e.customData.playerId=p,e.customData.opponentId=g,e.profiles[p]||(e.profiles[p]={id:p,name:"",photo:"",finished:!1}),e.profiles[g]||(e.profiles[g]={id:g,name:"",photo:"",finished:!1});const y=u?i:r,S=u?r:i;e.profiles[p].score=y,e.profiles[g].score=S;const N=u?c:d,v=u?d:c;e.profiles[p].finished=N,e.profiles[g].finished=v}}class Ys extends w{async processAsync(e){try{this.startLog(e);const{contextId:t,matchId:s,playerId:a,opponentId:n}=e,i=new I(this),r=new kt(this,{contextId:t});i.setNext(r);const c=new M(this,{id:s,mode:E.CHALLENGE_FRIEND,customData:{playerId:a,opponentId:n}});r.setNext(c);const d=new Js(this);c.setNext(d);const u=new nt(this);d.setNext(u);const p=new F(this);u.setNext(p);const g=new G(this);p.setNext(g);const y=new D(this);g.setNext(y);const S=this.match.getMatchState();await i.processAsync(S)}finally{this.endLog()}}}const{Utils:Xs}=h,{Analytics:Zs}=h.Plugins;class Ct extends f{async processAsync(e){super.processAsync(e);const{customData:t,mode:s,startAt:a,finishAt:n}=e;if(s===null)throw new Se;const{level:i}=t;if(typeof i!="number")throw new De;const{analytics:r}=this.game,c=Math.floor((n-a)/1e3);r.event(Zs.Events.MATCH_END,{game_mode:Xs.String.toUpperCamelCase(s),level:i,level_name:`level_${i}`,time_played:c}),await this.nextAsync(e)}}class ta extends Error{constructor(e){super(e),this.name="LeaderboardIdNotValid",this.message=e??"Leaderboard id is not valid"}}class it extends f{async processAsync(e){super.processAsync(e),await this.setLeaderboardScoreAsync(e),await this.nextAsync(e)}async setLeaderboardScoreAsync(e){try{const{profiles:t,customData:s}=e,{playerId:a,leaderboardId:n}=s;if(!a||!t[a])throw new k;if(!n)throw new ta;const{score:i}=t[a],r={leaderboardId:n,playerId:a,score:i};await this.match.api.getLeaderboardAPI().setLeaderboardScoreAsync(r)}catch{}}}class ea extends Error{constructor(e){super(e),this.name="MatchAreNotActive",this.message=e??"Match are not active"}}const{Dtos:sa}=h;class xt extends f{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){if(super.processAsync(t),t.status!==b.ACTIVE)throw new ea;const{useAPI:s}=this.payload;if(s){const a=await this.finishMatchAsync(t),n=new sa.Match.Data(a).toObject();this.updateMatchFromAPI(t,n)}else this.updateMatchData(t);this.updateMatchState(t),await this.nextAsync(t)}updateMatchData(t){const{playerId:s}=t.customData;if(typeof s!="string")throw new A;t.profiles[s].finished=!0}updateMatchState(t){t.status=b.FINISHED,t.finishAt=Date.now()}async finishMatchAsync(t){const{id:s,profiles:a,customData:n}=t,{level:i,playerId:r}=n;if(typeof r!="string")throw new A;const{score:c}=a[r],{extraData:d}=this.payload,u={matchId:s??"",score:c,level:i,extraData:d};return this.match.api.getMatchAPI().finishMatchAsync(u)}updateMatchFromAPI(t,s){const{playerId:a,opponentId:n}=t.customData;if(typeof a!="string")throw new A;if(typeof n!="string")throw new q;const{whitePlayerId:i,whitePlayerScore:r,blackPlayerScore:c,whitePlayerFinish:d,blackPlayerFinish:u}=s,p=a===i,g=p?r:c,y=p?c:r,S=p?d:u,N=p?u:d;t.profiles[a].score=g,t.profiles[n].score=y,t.profiles[a].finished=S,t.profiles[n].finished=N}}class aa extends f{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesResultAsync().catch(()=>{});t&&this.progressSendFinishedMessage(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:a,opponentId:n}=s;if(!t||typeof t!="string")throw new St;if(!a||typeof a!="string")throw new tt;if(!n||typeof n!="string")throw new q}async createWideframesResultAsync(){return await jt()}progressSendFinishedMessage(e,t){const{profiles:s,customData:a}=e,{playerId:n,opponentId:i}=a;if(!n||typeof n!="string")throw new A;if(!i||typeof i!="string")throw new q;const{score:r=0,finished:c}=s[n],{score:d=0,finished:u}=s[i];c?this.sendFinishMessageAsync(e,t):u&&r>d?this.sendBestScoreMessageAsync(e,t):this.sendPlayTurnMessageAsync(e,t)}async sendFinishMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:r}=n;if(!i||typeof i!="string")throw new A;const{name:c}=a[i],d={data:{type:It.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:r,status:b.FINISHED},action:"CUSTOM",template:"finished",cta:{default:"See result",localizations:{en_US:"See result",vi_VN:"Xem kết quả"}},text:{default:`${c} just finished. Check them now.`,localizations:{en_US:`${c} just finished. Check them now.`,vi_VN:`${c} vừa hoàn thành màn chơi. Nhấn để xem kết quả trận đấu.`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK))throw new P("updateAsync");await GameSDK.updateAsync(d)}async sendPlayTurnMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:r}=n;if(!i||typeof i!="string")throw new A;const{name:c,score:d}=a[i],u={data:{type:It.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:r,status:b.ACTIVE},action:"CUSTOM",template:"finished",cta:{default:"Play",localizations:{en_US:"Play",vi_VN:"Chơi ngay"}},text:{default:`${c} got ${d} scores. So easy! Can you?`,localizations:{en_US:`${c} got ${d} scores. So easy! Can you?`,vi_VN:`${c} đã đạt ${d} điểm! Nhấn Chơi để so tài!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK))throw new P("updateAsync");await GameSDK.updateAsync(u)}async sendBestScoreMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:r}=n;if(!i||typeof i!="string")throw new A;const{name:c,score:d}=a[i],u={data:{type:It.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:r,status:b.FINISHED},action:"CUSTOM",template:"pass_score",cta:{default:"See result",localizations:{en_US:"See result",vi_VN:"Xem kết quả"}},text:{default:`${c} beat your high score. Their score: ${d}`,localizations:{en_US:`${c} beat your high score. Their score: ${d}`,vi_VN:`${c} đã vượt qua điểm số của bạn, với ${d} điểm!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK))throw new P("updateAsync");await GameSDK.updateAsync(u)}}class Et extends f{async processAsync(e){super.processAsync(e),this.setPlayerBestScore(e),await this.nextAsync(e)}setPlayerBestScore(e){const{profiles:t,customData:s}=e,{playerId:a}=s;if(!a||!t[a])throw new k;const{player:n}=this.game,i=n.getBestScore()||0,{score:r=0}=t[a];r<=i||(n.setBestScore(r),t[a].bestScore=r)}}const{Dtos:na}=h;class ve extends f{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.updateProfileMatchData(t),await this.nextAsync(t)}updateProfileMatchData(t){const{id:s}=this.payload,{profiles:a}=t;if(!a[s])throw new k;const n={...a[s],...this.payload},i=new na.Match.Profile(n).toObject();a[i.id]=i}}class ia extends w{async processAsync(e){try{this.startLog(e);const{extraData:t,playerScore:s,playerId:a}=e,n=new I(this),i=new ve(this,{id:a,score:s});n.setNext(i);const r=new xt(this,{useAPI:!0,extraData:t});i.setNext(r);const c=new aa(this);r.setNext(c);const d=new Ct(this);c.setNext(d);const u=new Et(this);d.setNext(u);const p=new it(this);u.setNext(p);const g=new D(this);p.setNext(g);const y=this.match.getMatchState();await n.processAsync(y)}finally{this.endLog()}}}class Ft extends Error{constructor(e){super(e),this.name="ContextIsTournament",this.message=e??"Context is a tournament"}}const{Utils:oa}=h;class ra extends f{async processAsync(e){super.processAsync(e);const t=await this.chooseAsync();await this.checkContextTournament(),e.customData.contextId=t,await this.nextAsync(e)}async chooseAsync(){try{await GameSDK.context.chooseAsync({filters:["INCLUDE_EXISTING_CHALLENGES"],minSize:2,maxSize:2})}catch(t){if(!oa.Object.hasOwn(t,"code")||t.code!=="SAME_CONTEXT")throw t}const e=GameSDK.context.getID();if(typeof e!="string")throw new $t;return e}async checkContextTournament(){try{throw"getTournamentAsync"in GameSDK?(await GameSDK.getTournamentAsync(),new Ft):new P("getTournamentAsync")}catch(e){if(e instanceof Ft)throw e}}}class ee extends Error{constructor(e){super(e),this.name="ContextNotChallenge",this.message=e??"Context is not a challenge"}}class ca extends Error{constructor(e){super(e),this.name="NetworkFailure",this.message=e??"Network failure"}}const{Utils:se,Dtos:la}=h;class ha extends f{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.checkCurrentContext();const s=await this.getOpponentIdFromContextAsync();t.customData.opponentId=s,await this.nextAsync(t)}checkCurrentContext(){const t=GameSDK.context.getID();if(typeof t!="string")throw new tt;if(t==="SOLO")throw new ee}async getOpponentIdFromContextAsync(){const{playerId:t}=this.payload,s=await this.getContextPlayers([t]);if(s.length>1)throw new ee;let a=j;return s.length===1&&(a=s[0]),a.playerId}async getContextPlayers(t){try{const s=await GameSDK.context.getPlayersAsync(),a=[];return s.forEach(n=>{const i=n.getID();if(t.includes(i))return;const r=n.getName();if(!r)return;const c=n.getPhoto();a.push(new la.Player.Info({playerId:i,name:r,photo:c}).toObject())}),se.Array.unique(a)}catch(s){if(se.Object.hasOwn(s,"code")&&s.code==="NETWORK_FAILURE")throw new ca;return[]}}}class da extends w{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new I(this),a=new ra(this);s.setNext(a);const n=new M(this,{mode:E.CHALLENGE_FRIEND,customData:{playerId:t}});a.setNext(n);const i=new ha(this,{playerId:t});n.setNext(i);const r=new Ce(this);i.setNext(r);const c=new nt(this);r.setNext(c);const d=new F(this);c.setNext(d);const u=new G(this);d.setNext(u);const p=new Ee(this);u.setNext(p);const g=new D(this);p.setNext(g);const y=this.match.getMatchState();await s.processAsync(y)}finally{this.endLog()}}}class ua extends Error{constructor(e){super(e),this.name="JoinMatchFailed",this.message=e??"Join match failed"}}class pa extends Error{constructor(e){super(e),this.name="MatchAreFinished",this.message=e??"Match are finished"}}class ga extends Error{constructor(e){super(e),this.name="OtherPlayerHasJoinedMatch",this.message=e??"Other player has joined match"}}const{Dtos:ya}=h;class fa extends f{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.joinMatchAsync(e),s=new ya.Match.Data(t).toObject();this.validateJoinMatchData(e,s),this.updateMatchData(e,s),await this.nextAsync(e)}validateMatchData(e){const{status:t}=e;if(t!==b.OPEN)throw new Dt}validateJoinMatchData(e,t){const{id:s,customData:a}=e,{_id:n,blackPlayerId:i,whitePlayerId:r,whitePlayerFinish:c,blackPlayerFinish:d}=t,u=r===a.playerId,p=i===a.opponentId;if(typeof n!="string"||n!==s||!u)throw new ua;if(c&&d)throw new pa;if(!p)throw new ga}async joinMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().joinMatchAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:a,blackPlayerId:n,whitePlayerScore:i,blackPlayerScore:r,whitePlayerFinish:c,blackPlayerFinish:d}=t,u=a===s.playerId,p=u?a:n,g=u?n:a;e.customData.playerId=p,e.customData.opponentId=g,e.profiles[p]||(e.profiles[p]={id:p,name:"",photo:"",finished:!1}),e.profiles[g]||(e.profiles[g]={id:g,name:"",photo:"",finished:!1});const y=u?i:r,S=u?r:i;e.profiles[p].score=y,e.profiles[g].score=S;const N=u?c:d,v=u?d:c;e.profiles[p].finished=N,e.profiles[g].finished=v}}class ma extends w{async processAsync(e){try{this.startLog(e);const{matchId:t,playerId:s,opponentId:a}=e,n=new I(this),i=new M(this,{id:t,mode:E.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:a}});n.setNext(i);const r=new fa(this);i.setNext(r);const c=new nt(this);r.setNext(c);const d=new F(this);c.setNext(d);const u=new G(this);d.setNext(u);const p=new D(this);u.setNext(p);const g=this.match.getMatchState();await n.processAsync(g)}finally{this.endLog()}}}class wa extends w{constructor(){super(...arguments);l(this,"fallbackSingleMode");l(this,"startFLowChallengeFriend",async t=>{try{return await this.match.challenge.invite.processAsync({playerId:t}),!0}catch(s){return s}});l(this,"startFlowTournament",async t=>{try{await this.match.tournament.start.processAsync({playerId:t})}catch{await this.startFlowSingle(t)}});l(this,"startFlowSingle",async t=>{if(!this.fallbackSingleMode)throw new Error("Fallback single mode is not enabled");await this.match.single.start.processAsync({playerId:t})})}async processAsync(t){try{this.startLog(t);const{playerId:s,fallbackSingleMode:a}=t;this.fallbackSingleMode=a;const n=await this.startFLowChallengeFriend(s);if(n===!0)return;n instanceof Ft?await this.startFlowTournament(s):await this.startFlowSingle(s)}finally{this.endLog()}}}class Aa extends f{async processAsync(e){super.processAsync(e),this.validateData(e),this.progressSendGroupMessage(e),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:a,opponentId:n}=s;if(!t||typeof t!="string")throw new St;if(!a||typeof a!="string")throw new tt;if(!n||typeof n!="string")throw new q}async createWideframesResultAsync(){return await jt()}async createWideframesCurrentScoreAsync(){return await Bs()}async progressSendGroupMessage(e){const{profiles:t,customData:s}=e,{playerId:a,opponentId:n}=s;if(n&&typeof n=="string"){if(!a||typeof a!="string")throw new A;const{score:r=0}=t[a]||{},{score:c=0}=t[n]||{};if(r>c){const d=await this.createWideframesResultAsync().catch(()=>{});if(!d)return;this.sendBestScoreMessageAsync(e,d);return}}const i=await this.createWideframesCurrentScoreAsync().catch(()=>{});i&&this.sendChallengeMessageAsync(e,i)}async sendBestScoreMessageAsync(e,t){const{profiles:s,customData:a}=e,{playerId:n}=a;if(!n||typeof n!="string")throw new A;const{name:i,score:r}=s[n],c={data:{type:H.MATCHING_GROUP,playerId:n,playerName:i,playerScore:r},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{en_US:"Play",vi_VN:"Chơi"}},text:{default:`${i} beats your high score. Their score: ${r}.`,localizations:{en_US:`${i} beats your high score. Their score: ${r}.`,vi_VN:`${i} vừa vượt điểm số cao nhất của bạn! Chơi lần nữa chứ?`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK))throw new P("updateAsync");await GameSDK.updateAsync(c)}async sendChallengeMessageAsync(e,t){const{profiles:s,customData:a}=e,{playerId:n}=a;if(!n||typeof n!="string")throw new A;const{name:i,score:r}=s[n],c={data:{type:H.MATCHING_GROUP,playerId:n,playerName:i,playerScore:r},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{en_US:"Play",vi_VN:"Chơi ngay"}},text:{default:`${i} got ${r} scores. So easy! Can you?`,localizations:{en_US:`${i} got ${r} scores. So easy! Can you?`,vi_VN:`${i} đã đạt ${r} điểm! Quá dễ luôn. Chơi lại nào!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK))throw new P("updateAsync");await GameSDK.updateAsync(c)}}class Ia extends w{async processAsync(){try{this.startLog();const e=new I(this),t=new xt(this,{useAPI:!1});e.setNext(t);const s=new Aa(this);t.setNext(s);const a=new Ct(this);s.setNext(a);const n=new Et(this);a.setNext(n);const i=new it(this);n.setNext(i);const r=new D(this);i.setNext(r);const c=this.match.getMatchState();await e.processAsync(c)}finally{this.endLog()}}}class Pa extends w{async processAsync(e){try{this.startLog(e);const{playerId:t,opponentId:s,opponentScore:a}=e,n=new I(this),i=new M(this,{id:"7749",mode:E.MATCHING_GROUP,customData:{playerId:t,opponentId:s}});n.setNext(i);const r=new nt(this);i.setNext(r);const c=new ve(this,{id:t,score:a});r.setNext(c);const d=new F(this);c.setNext(d);const u=new G(this);d.setNext(u);const p=new D(this);u.setNext(p);const g=this.match.getMatchState();await n.processAsync(g)}finally{this.endLog()}}}class ae extends Error{constructor(e){super(e),this.name="MatchGroupNotSupported",this.message=e??"Match group is not supported"}}const{Utils:Da}=h;class Sa extends f{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),await this.checkMatchGroupSupported();const s=this.getMatchTag(),a=await this.matchingGroup(s);t.customData.contextId=a,await this.nextAsync(t)}async checkMatchGroupSupported(){if(!("getSupportedAPIs"in GameSDK))throw new P("getSupportedAPIs");if(!("checkCanPlayerMatchAsync"in GameSDK))throw new P("checkCanPlayerMatchAsync");if(!GameSDK.getSupportedAPIs().includes("checkCanPlayerMatchAsync"))throw new ae;if(!await GameSDK.checkCanPlayerMatchAsync())throw new ae}getMatchTag(){const{locale:t}=this.payload;let s="global";if(t){const a=Da.String.getLanguageCode(t);a==="en"?s="en":a==="in"&&(s="in")}return s}async matchingGroup(t){if(!("matchPlayerAsync"in GameSDK))throw new P("matchPlayerAsync");await GameSDK.matchPlayerAsync(t,!0,!0);const s=GameSDK.context.getID();if(typeof s!="string")throw new $t;return s}}class Ca extends Error{constructor(e){super(e),this.name="ProfileIdNotDefined",this.message=e??"Profile id is not defined"}}const{Dtos:xa}=h;class ot extends f{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{profileId:s}=this.payload;if(!s)throw new Ca;const{player:a}=this.game,n=a.getPlayerId();let i;if(s===n)i=this.getPlayerProfile();else if(i=await this.getProfileAsync(s),!i)throw new k;this.updateMatchData(i,t),await this.nextAsync(t)}getPlayerProfile(){const{player:t}=this.game,{playerId:s,name:a,photo:n,locale:i}=t.getPlayer();return{playerId:s,name:a,photo:n,locale:i}}async getProfileAsync(t){const{profile:s}=this.game;return await s.requestProfiles([t]),s.getProfiles()[t]}updateMatchData(t,s){const{playerId:a,name:n,photo:i}=t,r=new xa.Match.Profile({id:a,name:n,photo:i}).toObject();s.profiles[a]=r}}class Ea extends w{async processAsync(e){try{this.startLog(e);const{locale:t,playerId:s}=e,a=new I(this),n=new Sa(this,{locale:t});a.setNext(n);const i=new M(this,{id:"7749",mode:E.MATCHING_GROUP,customData:{playerId:s}});n.setNext(i);const r=new F(this);i.setNext(r);const c=new ot(this,{profileId:s});r.setNext(c);const d=new G(this);c.setNext(d);const u=new D(this);d.setNext(u);const p=this.match.getMatchState();await a.processAsync(p)}finally{this.endLog()}}}const{Analytics:_t}=h.Plugins;class be extends f{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.validateData(t),this.postScoreTournamentAsync(t),await this.nextAsync(t)}validateData(t){const{profiles:s,customData:a}=t,{playerId:n}=a;if(this.validatePlayerId(n),!s[n])throw new k}validatePlayerId(t){if(typeof t!="string")throw new A}getPlayerProfile(t){const{profiles:s,customData:a}=t,{playerId:n}=a;return this.validatePlayerId(n),s[n]}isNewBestScore(t){const s=this.getPlayerProfile(t),{score:a=0,bestScore:n=0}=s;return a>n}async postScoreTournamentAsync(t){const{analytics:s}=window.game,a=this.getPlayerProfile(t),{score:n=0}=a;let i=null,r=!1;const{checkBestScore:c}=this.payload,d=c&&this.isNewBestScore(t);try{if(!("getTournamentAsync"in GameSDK))throw new P("getTournamentAsync");await GameSDK.getTournamentAsync(),d?(i=_t.Events.TOURNAMENT_SHARE,await GameSDK.tournament.shareAsync({score:n})):(i=_t.Events.TOURNAMENT_POST_SCORE,await GameSDK.tournament.postScoreAsync(n)),r=!0}catch{if(d){i=_t.Events.TOURNAMENT_CREATE,await this.createTournamentAsync(n),r=!0;return}}finally{i&&s.event(i,{success:r})}}getTournamentTitle(){const t=GameSDK.player.getName();let s="Yours Tournament";return t&&(s=`${t}'s Tournament`),s}async createTournamentAsync(t,s){try{if(!("tournament"in GameSDK))throw new P("tournament");const a=this.getTournamentTitle();await GameSDK.tournament.createAsync({initialScore:t,config:{tournamentTitle:a},data:{...s,type:H.TOURNAMENT}})}catch{}}}class va extends w{async processAsync(){try{this.startLog();const e=new I(this),t=new xt(this,{useAPI:!1});e.setNext(t);const s=new be(this,{checkBestScore:!1});t.setNext(s);const a=new Ct(this);s.setNext(a);const n=new Et(this);a.setNext(n);const i=new it(this);n.setNext(i);const r=new D(this);i.setNext(r);const c=this.match.getMatchState();await e.processAsync(c)}finally{this.endLog()}}}class ba extends w{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new I(this),a=new kt(this,{contextId:"SOLO"});s.setNext(a);const n=new M(this,{id:"123456",mode:E.SINGLE,customData:{playerId:t}});a.setNext(n);const i=new F(this);n.setNext(i);const r=new ot(this,{profileId:t});i.setNext(r);const c=new G(this);r.setNext(c);const d=new D(this);c.setNext(d);const u=this.match.getMatchState();await s.processAsync(u)}finally{this.endLog()}}}class Na extends f{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{contextId:s}=this.payload;this.validateContextId(s),t.customData.contextId=s,await this.nextAsync(t)}validateContextId(t){if(typeof t!="string")throw new tt}}class Ma extends w{async processAsync(e){try{this.startLog(e);const{playerId:t,contextId:s}=e,a=new I(this),n=new Na(this,{contextId:s});a.setNext(n);const i=new M(this,{id:"1997",mode:E.TOURNAMENT,customData:{playerId:t}});n.setNext(i);const r=new F(this);i.setNext(r);const c=new ot(this,{profileId:t});r.setNext(c);const d=new G(this);c.setNext(d);const u=new D(this);d.setNext(u);const p=this.match.getMatchState();await a.processAsync(p)}finally{this.endLog()}}}const{Utils:Ta}=h;class Oa extends f{constructor(){super(...arguments);l(this,"leaderboardPayload")}async processAsync(t){super.processAsync(t),await this.setupCreatePayload(t),await this.createLeaderboardAsync(),this.updateMatchState(t),await this.nextAsync(t)}async setupCreatePayload(t){const{playerId:s}=t.customData;if(!s)throw new k;if(!("getTournamentAsync"in GameSDK))throw new P("getTournamentAsync");const n=(await GameSDK.getTournamentAsync()).getID(),i=Ta.String.generateObjectId(),r=GameSDK.player.getName(),c=r?`${r}'s Tournament`:"Your Tournament";this.leaderboardPayload={_id:i,name:n,createdBy:s,description:c}}async createLeaderboardAsync(){await this.match.api.getLeaderboardAPI().createLeaderboardAsync(this.leaderboardPayload)}updateMatchState(t){const{_id:s}=this.leaderboardPayload;t.customData.leaderboardId=s}}class La extends w{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new I(this),a=new M(this,{id:"1997",mode:E.TOURNAMENT,customData:{playerId:t}});s.setNext(a);const n=new Oa(this);a.setNext(n);const i=new it(this);n.setNext(i);const r=this.match.getMatchState();await s.processAsync(r)}finally{this.endLog()}}}class _a extends w{async processAsync(){try{this.startLog();const e=new I(this),t=new xt(this,{useAPI:!1});e.setNext(t);const s=new be(this,{checkBestScore:!0});t.setNext(s);const a=new Ct(this);s.setNext(a);const n=new Et(this);a.setNext(n);const i=new it(this);n.setNext(i);const r=new D(this);i.setNext(r);const c=this.match.getMatchState();await e.processAsync(c)}finally{this.endLog()}}}class Ra extends Error{constructor(e){super(e),this.name="TournamentIdNotValid",this.message=e??"Tournament id is not valid"}}const{Utils:Ga}=h;class Fa extends f{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{tournamentId:s}=this.payload;this.validateTournamentId(s),await this.joinTournamentAsync(s);const a=GameSDK.context.getID();this.validateContextId(a),t.customData.contextId=a,await this.nextAsync(t)}validateTournamentId(t){if(typeof t!="string")throw new Ra}validateContextId(t){if(typeof t!="string")throw new tt}async joinTournamentAsync(t){if(!("tournament"in GameSDK))throw new P("tournament");try{await GameSDK.tournament.joinAsync(t)}catch(s){if(!Ga.Object.hasOwn(s,"code")||s.code!=="SAME_CONTEXT")throw s}}}class Va extends w{async processAsync(e){try{this.startLog(e);const{playerId:t,tournamentId:s}=e,a=new I(this),n=new Fa(this,{tournamentId:s});a.setNext(n);const i=new M(this,{id:"1997",mode:E.TOURNAMENT,customData:{playerId:t}});n.setNext(i);const r=new F(this);i.setNext(r);const c=new ot(this,{profileId:t});r.setNext(c);const d=new G(this);c.setNext(d);const u=new D(this);d.setNext(u);const p=this.match.getMatchState();await a.processAsync(p)}finally{this.endLog()}}}class Ua extends w{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new I(this),a=new kt(this,{contextId:"SOLO"});s.setNext(a);const n=new M(this,{id:"1997",mode:E.TOURNAMENT,customData:{playerId:t}});a.setNext(n);const i=new F(this);n.setNext(i);const r=new ot(this,{profileId:t});i.setNext(r);const c=new G(this);r.setNext(c);const d=new D(this);c.setNext(d);const u=this.match.getMatchState();await s.processAsync(u)}finally{this.endLog()}}}const Ha={id:null,mode:null,status:null,startAt:0,finishAt:0,profiles:{},customData:{...xe}},{Configs:ht}=h;class Ba extends m.Plugins.BasePlugin{constructor(){super(...arguments);l(this,"group");l(this,"single");l(this,"context");l(this,"challenge");l(this,"tournament");l(this,"api");l(this,"useCPUProfile")}init(){this.createMatchData(),this.createAPIHandler(),this.createConcreteFlows()}setUseCPUProfile(t){this.useCPUProfile=t}createMatchData(){const{storage:t}=this.game;t.addStorage("match",Ha)}getMatchState(){const{storage:t}=this.game;return t.getStorage("match")}createConcreteFlows(){this.createGroupFlows(),this.createSingleFlows(),this.createContextFlows(),this.createChallengeFlows(),this.createTournamentFlows()}createAPIHandler(){const t={appId:ht.AppId,matchAPIHost:ht.ApiHost,playerAPIHost:ht.ApiHost,leaderboardAPIHost:ht.OtherHost};this.api=new Ls(t)}createGroupFlows(){this.group={join:new Pa(this.game,this),start:new Ea(this.game,this),finish:new Ia(this.game,this)}}createSingleFlows(){this.single={start:new ba(this.game,this),finish:new va(this.game,this)}}createContextFlows(){this.context={choose:new wa(this.game,this)}}createChallengeFlows(){this.challenge={invite:new da(this.game,this),friend:new Ks(this.game,this),join:new ma(this.game,this),finish:new ia(this.game,this),continue:new Ys(this.game,this)}}createTournamentFlows(){this.tournament={join:new Va(this.game,this),start:new Ua(this.game,this),create:new La(this.game,this),finish:new _a(this.game,this),continue:new Ma(this.game,this)}}}const{Valid:Q}=h.Utils,J="is invalid";class Ne extends x{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateId(e){(!Q.isString(e)||!e)&&this.exception("id",J)}validateName(e){(!Q.isString(e)||!e)&&this.exception("name",J)}validatePhoto(e){Q.isString(e)||this.exception("photo",J)}validateScore(e){(!Q.isNumber(e)||e<0)&&this.exception("score",J)}validateBestScore(e){(!Q.isNumber(e)||e<0)&&this.exception("bestScore",J)}validateFinished(e){Q.isBoolean(e)||this.exception("finished",J)}toObject(){return super.toObject()}}Ne.addDefaultData({id:"",name:"Your Friend",photo:"./assets/images/others/avatar.png",score:0,bestScore:0,finished:!1});const{Valid:T}=h.Utils,O="is invalid";class Me extends x{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e),this.validateId(e._id)}validateId(e){(!T.isString(e)||!e)&&this.exception("_id",O)}validateMode(e){(!T.isString(e)||!e)&&this.exception("mode",O)}validateStatus(e){(!T.isString(e)||!e)&&this.exception("status",O)}validateWinnerId(e){(!T.isString(e)||!e)&&this.exception("winnerId",O)}validateWhitePlayerId(e){(!T.isString(e)||!e)&&this.exception("whitePlayerId",O)}validateBlackPlayerId(e){(!T.isString(e)||!e)&&this.exception("blackPlayerId",O)}validateWhitePlayerScore(e){T.isNumber(e)||this.exception("whitePlayerScore",O)}validateBlackPlayerScore(e){T.isNumber(e)||this.exception("blackPlayerScore",O)}validateWhitePlayerFinish(e){T.isBoolean(e)||this.exception("whitePlayerFinish",O)}validateBlackPlayerFinish(e){T.isBoolean(e)||this.exception("blackPlayerFinish",O)}toObject(){return super.toObject()}}Me.addDefaultData({_id:"",mode:"",status:"",winnerId:"",whitePlayerId:"",blackPlayerId:"",whitePlayerScore:0,blackPlayerScore:0,whitePlayerFinish:!1,blackPlayerFinish:!1});h.Dtos.Match={Data:Me,Profile:Ne};const{Utils:$a}=h,{ApiHost:ja}=h.Configs,ka=async o=>{const e=await C("players",o,{},ja,10);return $a.Object.hasOwn(e,"data")?e.data||{}:{}},{Utils:Ka,Configs:za}=h,{AppId:qa}=za;class Wa extends m.Plugins.BasePlugin{init(){const{storage:e}=this.game;e.addStorage("player",at)}async saveToCloud(){try{const e=this.getPlayerData();await GameSDK.player.setDataAsync(e)}catch{}}receiveData(e,t){const{storage:s}=this.game,{playerId:a,name:n,photo:i,locale:r}=e;s.setStorageData("player","playerId",a),s.setStorageData("player","name",n),s.setStorageData("player","photo",i),s.setStorageData("player","locale",r),t&&this.setPlayerData(t)}async syncProfileToServer(){const e=this.getPlayer(),{ASID:t,playerId:s,name:a,photo:n,locale:i}=e;await ka({appId:qa,ASID:t,playerId:s,name:a,photo:n,locale:i})}setPlayerDataByName(e,t){this.setPlayerData({[e]:t})}setPlayerData(e){const{storage:t}=this.game;t.setStorageData("player","data",e),this.saveToCloud()}setBestScore(e){this.setPlayerDataByName("score",e)}setSetting(e,t){this.setPlayerDataByName("settings",{[e]:t})}setGameData(e){const t=this.getGameData()??{},s=Ka.Object.merge(t,e);this.setPlayerDataByName("gameData",s)}async requestConnectedPlayers(){const{storage:e}=this.game,s=(await GameSDK.player.getConnectedPlayersAsync()).map(i=>{const r=i.getID(),c=i.getName(),d=i.getPhoto();return!r||!c||!d?null:new Pt({playerId:r,name:c,photo:d}).toObject()}),a=h.Utils.Array.unique(s);if(a.length<1)return;const n=h.Utils.Object.keyBy(a,"playerId");e.setStorageData("player","connectedPlayers",n)}getPlayer(){const{storage:e}=this.game;return e.getStorage("player")}getPlayerId(){const{storage:e}=this.game;return e.getStorageData("player","playerId")}getPlayerASID(){const{storage:e}=this.game;return e.getStorageData("player","ASID")}getPlayerData(){const{storage:e}=this.game;return e.getStorageData("player","data")}getPlayerDataByKey(e){const t=this.getPlayerData();return h.Utils.Object.hasOwn(t,e)?t[e]:null}getGameData(){return this.getPlayerDataByKey("gameData")}getPlayerSetting(e){const t=this.getPlayerSettings();return h.Utils.Object.hasOwn(t,e)?t[e]:null}getPlayerSettings(){const{settings:e}=this.getPlayerData();return e}isFirstLogin(){return this.getPlayerDataByKey("isFirstLogin")??!0}loggedIn(){this.setPlayerDataByName("isFirstLogin",!1)}getBestScore(){const{score:e}=this.getPlayerData();return e}getConnectedPlayers(){const{storage:e}=this.game;return e.getStorageData("player","connectedPlayers")}getConnectedPlayerIds(e,t){const s=this.getConnectedPlayers();return Object.keys(s).slice(t,e)}}const{Dtos:ne,Utils:Qa}=h,{Valid:dt}=Qa,{score:Ja,settings:Ya,gameData:Xa,isFirstLogin:Za}=at.data,ut="is invalid";class Te extends x{processData(e){this.validateStructure(e),e.settings=new ne.Player.Settings(e.settings).toObject(),e.gameData=new ne.Player.GameData(e.gameData).toObject(),this.validateData(e),this.setupData(e)}setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateScore(e){(!dt.isNumber(e)||e<0)&&this.exception("score",ut)}validateSettings(e){dt.isObject(e)||this.exception("settings",ut)}validateGameData(e){dt.isObject(e)||this.exception("gameData",ut)}validateIsFirstLogin(e){dt.isBoolean(e)||this.exception("isFirstLogin",ut)}toObject(){return super.toObject()}}Te.addDefaultData({score:Ja,settings:Ya,gameData:Xa,isFirstLogin:Za});const{Valid:ie}=h.Utils,{level:tn,coins:en}=at.data.gameData;class Oe extends x{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateLevel(e){(!ie.isNumber(e)||e<1)&&this.exception("level","is invalid")}validateCoins(e){(!ie.isNumber(e)||e<0)&&this.exception("coins","is invalid")}toObject(){return super.toObject()}}Oe.addDefaultData({level:tn,coins:en});const{Valid:pt}=h.Utils,{sound:sn,music:an,vibrate:nn,language:on}=at.data.settings,gt="is invalid";class Le extends x{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateSound(e){pt.isBoolean(e)||this.exception("sound",gt)}validateMusic(e){pt.isBoolean(e)||this.exception("music",gt)}validateVibrate(e){pt.isBoolean(e)||this.exception("vibrate",gt)}validateLanguage(e){(!pt.isString(e)||!e)&&this.exception("language",gt)}toObject(){return super.toObject()}}Le.addDefaultData({sound:sn,music:an,vibrate:nn,language:on});h.Dtos.Player={Info:Pt,Data:Te,Settings:Le,GameData:Oe};const{Utils:rn}=h,{ApiHost:cn}=h.Configs,ln=async o=>{const e=h.Utils.String.params(o),t=await Z(`players?${e}`,{},cn);return rn.Object.hasOwn(t,"data")?Array.isArray(t.data)?t.data:[]:[]},hn={profiles:{},profileIds:[]},{Utils:oe,Dtos:dn}=h;class un extends m.Plugins.BasePlugin{init(){const{storage:e}=this.game;e.addStorage("profile",hn)}async requestProfiles(e){const{storage:t}=this.game,s=t.getStorageData("profile","profileIds"),a=oe.Array.difference(e,s);if(a.length<1)return;const n=await ln({playerIds:a});if(!this.validateProfilesResponse(n))return;const i=this.convertToProfiles(n);t.setStorageData("profile","profiles",i),t.setStorageData("profile","profileIds",[...s,...a])}getProfile(e){return this.getProfiles()[e]??null}getProfiles(){const{storage:e}=this.game;return e.getStorageData("profile","profiles")}getProfileIds(){const{storage:e}=this.game;return e.getStorageData("profile","profileIds")}validateProfilesResponse(e){return!(!Array.isArray(e)||e.length<1)}convertToProfiles(e){const t={};return e.forEach(s=>{oe.Object.hasOwn(s,"playerId")&&typeof s.playerId=="string"&&(t[s.playerId]=new dn.Player.Info(s).toObject())}),t}}const{Valid:yt,Object:re}=h.Utils,{Ads:_e,Gameplay:Re}=h.Configs,ft="is invalid";class Kt extends x{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateAds(e){yt.isObject(e)||this.exception("ads",ft),this.validateCommonData(e,_e)}validateGameplay(e){yt.isObject(e)||this.exception("gameplay",ft),this.validateCommonData(e,Re)}validateCommonData(e,t){Object.keys(e).forEach(s=>{if(!re.hasOwn(e,s))return;re.hasOwn(t,s)||this.exception(`the "${s}" key`,ft);const a=e[s],n=t[s];typeof a!=typeof n&&this.exception("value",ft),yt.isObject(a)&&yt.isObject(n)&&this.validateCommonData(a,n)})}toObject(){return super.toObject()}}Kt.addDefaultData({Ads:_e,Gameplay:Re});const{Valid:mt,Object:pn}=h.Utils;class zt extends x{setupData(e){this.lazySetupData(e)}validateStructure(e){}validateData(e){this.validateCommonData(e)}validateCommonData(e,t=!0){Object.keys(e).forEach(s=>{if(!pn.hasOwn(e,s))return;const a=e[s];!mt.isBoolean(a)&&!mt.isNumber(a)&&!mt.isString(a)&&this.exception("value","is invalid"),mt.isObject(a)&&this.validateCommonData(a,!1),t&&Object.assign(this,{[s]:a})})}toObject(){return super.toObject()}}zt.addDefaultData({});const{Valid:Y,Object:ce}=h.Utils,K="is invalid";class qt extends x{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateId(e){(!Y.isString(e)||!e)&&this.exception("id",K);const{remoteConfig:t}=window.game;return t.isRemoteConfigId(e)}validateType(e){(!Y.isString(e)||!e)&&this.exception("type",K),["GameCore","Gameplay"].includes(e)||this.exception("type",K)}validateInfo(e){(!Y.isObject(e)||!e)&&this.exception("info",K),(!ce.hasOwn(e,"version")||!Y.isString(e.version)||!e.version)&&this.exception("info.version",K),(!ce.hasOwn(e,"createdAt")||!Y.isString(e.createdAt)||!e.createdAt)&&this.exception("info.createdAt",K)}validateConfig(e){Y.isObject(e)||this.exception("config",K)}toObject(){return super.toObject()}}qt.addDefaultData({id:"default",type:"GameCore",info:{version:"1.0.0",priority:100,createdAt:"unknown"},config:{}});class Ge{constructor(e){l(this,"plugin");this.plugin=e}}const{FirebaseConfig:le,Options:jn}=h.Configs.RemoteConfig;class gn extends Ge{constructor(t){super(t);l(this,"firebaseApp");l(this,"firebaseRemoteConfig");l(this,"data",null);this.plugin=t,this.initializeFirebase(),this.initializeRemoteConfig()}initializeFirebase(){if(!le.Enabled)return;const{AppId:t,ApiKey:s,ProjectId:a,AuthDomain:n,DatabaseURL:i,StorageBucket:r,MeasurementId:c,MessagingSenderId:d}=le,u={apiKey:s,authDomain:n,databaseURL:i,projectId:a,storageBucket:r,messagingSenderId:d,appId:t,measurementId:c};this.firebaseApp=$e(u)}initializeRemoteConfig(){this.firebaseRemoteConfig=je(this.firebaseApp)}getGameCoreDataFromRemote(){if(!this.firebaseRemoteConfig)return null;const t=Wt(this.firebaseRemoteConfig,"gamecore_configs");if(!t)return null;const s=JSON.parse(t);return s.data?s:null}getGamePlayDataFromRemote(){if(!this.firebaseRemoteConfig)return null;const t=Wt(this.firebaseRemoteConfig,"gameplay_configs");if(!t)return null;const s=JSON.parse(t);return s.data?s:null}getConfig(t){const{id:s,type:a,conditions:n}=t;let i=null;switch(this.data=null,a){case"GameCore":{i=this.getGameCoreDataFromRemote();break}case"Gameplay":{i=this.getGamePlayDataFromRemote();break}}if(!i)return null;const{data:r}=i;if(!r||r.length===0)return null;if(this.data=r,s)return this.getConfigById(s);const{latest:c,version:d,priority:u}=n??{};return d?this.getConfigByVersion(d):u?this.getConfigByPriority(u):c?this.getConfigByLatestVersion():this.getConfigByLatestVersion()}fetchConfig(t){return new Promise((s,a)=>{if(!this.firebaseApp||!this.firebaseRemoteConfig){a(new Error("FirebaseHandler: Firebase Remote Config is not initialized"));return}try{ke(this.firebaseRemoteConfig).then(()=>{const n=this.getConfig(t);n||a("FirebaseHandler: Parse data failed"),s(n)})}catch(n){a(n)}})}getConfigById(t){return this.data?this.data.filter(a=>a.id===t)[0]:null}getConfigByVersion(t){return this.data?this.data.filter(a=>a.info.version===t)[0]:null}getConfigByLatestVersion(){return this.data?this.data.toSorted((s,a)=>s.info.createdAt.localeCompare(a.info.createdAt))[0]:null}getConfigByPriority(t){return this.data?this.data.filter(a=>a.info.priority<=t)[0]:null}}class yn extends Ge{constructor(){super(...arguments);l(this,"data")}async fetchConfig(t){const{id:s,type:a,conditions:n}=t;await h.Utils.Time.sleepAsync(800);let i=null;switch(a){case"GameCore":i=await this.requestGameCoreConfig(s,n);break;case"Gameplay":i=await this.requestGamePlayConfig(s,n);break}return i}async requestGameCoreConfig(t,s){if(this.data=(await X(()=>import("./bundle/mock-gamecore-configs.js"),[],import.meta.url)).default,t)return this.getConfigById(t);const{version:a}=s??{};return a?this.getConfigByVersion(a):this.getConfigByLatestVersion()}async requestGamePlayConfig(t,s){if(this.data=(await X(()=>import("./bundle/mock-gameplay-configs.js"),[],import.meta.url)).default,t)return this.getConfigById(t);const{latest:a,version:n,priority:i}=s??{};return n?this.getConfigByVersion(n):i?this.getConfigByPriority(i):a?this.getConfigByLatestVersion():this.getConfigByLatestVersion()}getConfigById(t){return this.data.filter(a=>a.id===t)[0]}getConfigByVersion(t){return this.data.filter(a=>a.info.version===t)[0]}getConfigByLatestVersion(){return this.data.toSorted((s,a)=>s.info.createdAt.localeCompare(a.info.createdAt))[0]}getConfigByPriority(t){return this.data.filter(a=>a.info.priority<=t)[0]}}const fn={fetchStatus:"idle",changes:[],remoteConfigs:{GameCore:{},Gameplay:{}}};class mn extends m.Plugins.BasePlugin{constructor(){super(...arguments);l(this,"enabled");l(this,"config");l(this,"handler");l(this,"timer");l(this,"handleFetchConfig",()=>{!this.enabled||this.getFetchStatus()==="fetching"||(this.fetchLatestConfigAsync("GameCore").then(s=>{s&&this.processUpdateConfig(s,"GameCore")}),this.fetchLatestConfigAsync("Gameplay").then(s=>{s&&this.processUpdateConfig(s,"Gameplay")}))});l(this,"handleRemoteConfigUpdated",async t=>{if(!this.enabled)return;const{id:s,type:a}=t??{};if(this.checkChange(s,"updated"))return;const n=this.getRemoteConfig(s,a);if(!n)return;const{event:i}=this.game;i.emit(U.REQUEST_SAVE_CONFIG,n),this.pushChange(s,"updated")})}init(){const{storage:t}=this.game;t.addStorage("remoteConfig",fn)}configure(t){this.config=t,this.enabled=this.config.Enabled,this.listenEvents(),this.createHandler(),this.initAutoFetch()}isRemoteConfigId(t){/^[a-zA-Z0-9_-]+$/.test(`${t}`)||this.exception("id","is invalid")}isRemoteConfigStored(t,s){return!!this.getRemoteConfig(t,s)}listenEvents(){const{event:t}=this.game;t.on(U.REMOTE_CONFIG_UPDATED,this.handleRemoteConfigUpdated)}createHandler(){const{ServiceType:t}=this.config;switch(t){case"firebase":this.handler=new gn(this);break;case"selfHosted":break;case"mockup":this.handler=new yn(this);break;default:this.enabled=!1}}initAutoFetch(){if(!this.enabled)return;const{FetchIntervalInSeconds:t}=this.config.Options;if(t<=0)return;clearInterval(this.timer);const s=1e3;this.handleFetchConfig(),this.timer=setInterval(this.handleFetchConfig,t*s)}async fetchConfigAsync(t){if(!this.enabled)return!1;try{const{id:s,type:a}=t;this.config.SupportedDataTypes.indexOf(a)===-1&&this.exception(`"${a}" type`,"is unsupported"),s&&this.isRemoteConfigStored(s,a)&&this.exception(`"${s}" id`,"is stored"),this.setFetchStatus("fetching");const n=await this.handler.fetchConfig(t),i=new qt(n).toObject();let r;switch(i.type){case"GameCore":r=new Kt(i.config).toObject();break;case"Gameplay":r=new zt(i.config).toObject();break}return i.config=r,this.setRemoteConfig(i),this.setFetchStatus("success"),i.id}catch{return this.setFetchStatus("failure"),!1}}async fetchLatestConfigAsync(t){if(!this.enabled)return!1;try{return await this.fetchConfigAsync({type:t,conditions:{latest:!0}})}catch{return!1}}async fetchDefaultConfigAsync(t){if(!this.enabled)return!1;try{const{DefaultConfigId:s}=this.config;return this.isRemoteConfigId(s),this.fetchConfigAsync({id:s,type:t})}catch{return!1}}processUpdateConfig(t,s){if(!this.enabled)return!1;try{const a=this.getRemoteConfig(t,s);return a||this.exception(`"${t}" id`,"is not stored"),this.checkChange(t,"updated")&&this.exception(`"${t}" id`,"is updated"),this.requestUpdateConfig(a),this.requestHotUpdate(t,a.type),this.pushChange(t,"requested"),!0}catch{return!1}}requestUpdateConfig(t){if(!this.enabled)return;const{event:s}=this.game;s.emit(U.REQUEST_UPDATE_CONFIG,t)}requestHotUpdate(t,s){if(!this.enabled)return;const{ForceReloadGame:a}=this.config.Options;if(!a)return;const{event:n}=this.game;n.emit(U.REQUEST_HOT_RELOAD,{id:t,type:s})}rollbackConfig(t,s){try{const a=this.getRemoteConfig(t,s);return a?(this.requestUpdateConfig(a),this.requestHotUpdate(t,a.type),this.pushChange(t,"rollback"),!0):!1}catch{return!1}}setStorageData(t,s){const{storage:a}=this.game;a.setStorageData("remoteConfig",t,s)}getRemoteConfigs(){const{storage:t}=this.game;return t.getStorageData("remoteConfig","remoteConfigs")}getRemoteConfig(t,s){return this.getRemoteConfigs()[s][t]||null}setRemoteConfig(t){const{id:s,type:a}=t;this.setStorageData("remoteConfigs",{[a]:{[s]:t}})}setFetchStatus(t){this.setStorageData("fetchStatus",t)}getFetchStatus(){const{storage:t}=this.game;return t.getStorageData("remoteConfig","fetchStatus")}getChanges(){const{storage:t}=this.game;return t.getStorageData("remoteConfig","changes")}pushChange(t,s){const a={id:t,actionStatus:s},n=this.getChanges();n.push(a),this.setStorageData("changes",n)}checkChange(t,s){const n=this.getChanges().findLast(i=>i.id===t);return n?n.actionStatus===s:!1}exception(t,s){throw new Error(`RemoteConfigPlugin: ${t} ${s}`)}}h.Dtos.RemoteConfig={Data:qt,GameCore:Kt,Gameplay:zt};h.Dtos.Player.Data.addDefaultData({remoteConfig:{GameCore:{},Gameplay:{}}});h.Dtos.Player.Data.addValidateFunction("remoteConfig",o=>{const{Valid:e}=h.Utils;if(!e.isObject(o))throw new Error("remoteConfig is invalid");if(!("GameCore"in o))throw new Error("remoteConfig.GameCore is invalid");if(!("Gameplay"in o))throw new Error("remoteConfig.Gameplay is invalid")});const{Utils:he}=h;class wn extends m.Plugins.BasePlugin{constructor(t){super(t);l(this,"storages");this.storages={}}addStorage(t,s){this.storages[t]=s}setStorageData(t,s,a){let n;if(he.Valid.isObject(a)){const i=this.getStorageData(t,s);n=he.Object.merge(i,a)}else n=a;this.storages[t][s]=n}getStorageData(t,s){return this.getStorage(t)[s]}getStorage(t){return this.storages[t]}}class An extends m.Plugins.BasePlugin{constructor(){super(...arguments);l(this,"isVisible",!0);l(this,"browserPrefixes",["moz","ms","o","","webkit"]);l(this,"handleVisibilityChange",t=>{if(typeof t=="boolean")return t?this.onVisibleEvent():this.onHiddenEvent();const s=this.getBrowserPrefix();return this.getHiddenPropertyName(s)in document?this.onHiddenEvent():this.onVisibleEvent()})}init(){const t=this.getBrowserPrefix();[this.getVisibilityEvent(t),"focus","blur"].forEach(n=>{window.addEventListener(n,()=>{let i;n==="focus"?i=!0:n==="blur"&&(i=!1),this.handleVisibilityChange(i)},!1)})}isGameVisible(){return this.isVisible}getHiddenPropertyName(t){return t?t+"Hidden":"hidden"}getVisibilityEvent(t){return(t||"")+"visibilitychange"}getBrowserPrefix(){for(const t of this.browserPrefixes)if(this.getHiddenPropertyName(t)in document)return t;return""}onVisibleEvent(){this.isVisible||(this.isVisible=!0,this.game.event.emit(h.Events.VISIBILITY_VISIBLE))}onHiddenEvent(){this.isVisible&&(this.isVisible=!1,this.game.event.emit(h.Events.VISIBILITY_HIDDEN))}}class In extends ye{async loadAsync(){this.exception("Unsupported method")}async showAsync(){this.exception("This method is not implemented")}async hideAsync(){this.exception("This method is not implemented")}}class Pn extends In{async showAsync(){await GameSDK.loadBannerAdAsync(this.placementId)}async hideAsync(){await GameSDK.hideBannerAdAsync(this.placementId)}}const{Status:L,Types:wt,AdError:At,AdInstance:Dn}=h.Plugins.Ads;class de extends Dn{constructor(t,s){super(t,s);l(this,"instance");this.instance=null}async loadAsync(){if(this.status!==L.IDLE)throw new At("AD_NOT_READY","Ad is not ready.");try{if(this.instance=await this.createInstanceByType(this.type),this.instance===null)throw new At("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");this.status=L.LOADING,await this.instance.loadAsync(),this.status=L.FILLED}catch(t){throw this.status=L.IDLE,t instanceof Object&&"code"in t&&t.code==="INVALID_PARAM"&&(this.instance=null),t}}async showAsync(){if(this.status!==L.FILLED)throw new At("AD_NOT_FILLED","Ad is not filled.");if(this.instance===null)throw new At("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");try{this.status=L.SHOWING,await this.instance.showAsync(),this.status=L.IDLE,this.instance=null,this.type===wt.INTERSTITIAL&&self.game.analytics.showInterstitialAd(),this.type===wt.REWARDED_VIDEO&&self.game.analytics.showRewardedVideoAd()}catch(t){throw this.status=L.FILLED,h.Utils.Object.hasOwn(t,"code")&&(["ADS_NOT_LOADED"].includes(`${t.code}`)&&(this.status=L.IDLE),["USER_INPUT","INVALID_PARAM","INVALID_OPERATION"].includes(`${t.code}`)&&(this.status=L.IDLE,this.instance=null)),self.game.analytics.showAdFail(this.type,t),t}}async createInstanceByType(t){switch(t){case wt.REWARDED_VIDEO:return await GameSDK.getRewardedVideoAsync(this.placementId);case wt.INTERSTITIAL:return await GameSDK.getInterstitialAdAsync(this.placementId);default:return null}}}const{BaseAnalytics:Sn,Events:R}=h.Plugins.Analytics,Cn=[R.BUTTON_CLICK,R.SCREEN_OPEN];class xn extends Sn{constructor(e,t){super("FacebookAnalytics",{...t},"#0F52BA");const{consoleLog:s}=t;this.selfLog=!!s}processEvent(e,t,s){if(!("logEvent"in GameSDK)||!t||Cn.includes(e))return;const a=this.formatEventName(e),n={};Object.keys(t).forEach(i=>{typeof t[i]=="string"&&(n[i]=t[i])}),GameSDK.logEvent(a,s,n)}processPageView(e){this.processEvent(R.SCREEN_OPEN,{screen_name:e})}processLevelStart(e,t,s){this.processEvent(R.LEVEL_START,{level:e,score:t,level_name:s})}processLevelRescue(e,t,s){this.processEvent(R.LEVEL_RESCUE,{level:e,score:t,level_name:s})}processLevelFail(e,t,s){this.processEvent(R.LEVEL_END,{level:e,score:t,level_name:s,success:!1})}processLevelComplete(e,t,s){this.processEvent(R.LEVEL_END,{level:e,score:t,level_name:s,success:!0})}processShowInterstitialAd(e){this.processEvent(R.AD_SHOW,{ad_type:"interstitial",screen_name:`${e}`})}processShowRewardedVideoAd(e){this.processEvent(R.AD_SHOW,{ad_type:"rewarded_video",screen_name:`${e}`})}processShowAdFail(e,t){this.processEvent(R.AD_SHOW_FAILED,{ad_type:e,screen_name:`${t}`})}formatEventName(e){return e.toLowerCase().replace(/:/g,"_")}}class En{constructor(e,t){l(this,"options");l(this,"performance");l(this,"isRunning",!1);l(this,"checkTimer");l(this,"fpsHistory");l(this,"actualFPS",0);l(this,"start",()=>{this.isRunning||(this.isRunning=!0,this.checkTimer=this.options.CheckInterval,this.fpsHistory=[])});l(this,"stop",()=>{this.isRunning&&(this.isRunning=!1,this.options.OnlyUpdateWhenSwitchScene&&this.checkFps())});l(this,"postStep",e=>{this.isRunning&&(this.checkTimer-=e,!(this.checkTimer>0)&&(this.checkTimer+=this.options.CheckInterval,this.fpsHistory.push(this.actualFPS),this.options.OnlyUpdateWhenSwitchScene||this.fpsHistory.length>=5&&this.checkFps()))});this.options=t,this.performance=e}checkFps(){if(this.fpsHistory.length===0)return;let e=!1;this.isLowFps()?e=this.performance.downgradeGraphicsQuality():this.options.AutoUpgradeQuality&&this.isHighFps()&&(e=this.performance.upgradeGraphicsQuality()),e&&(this.fpsHistory=[])}getFpsMedian(){return this.getMedian(this.fpsHistory)}getMedian(e){if(e.length===0)return NaN;const t=Array.from(e).sort((a,n)=>a-n),s=Math.floor(t.length/2);return t.length%2===0?(t[s-1]+t[s])/2:t[s]}isLowFps(){return this.getFpsMedian()<this.options.FpsThreshold}isHighFps(){return this.getFpsMedian()>this.options.FpsThreshold*1.2}}class vn extends m.Plugins.BasePlugin{constructor(){super(...arguments);l(this,"fpsTracker");l(this,"pixelRatio");l(this,"minQuality");l(this,"maxQuality");l(this,"qualityAdjustStep");l(this,"trackingSceneNames",[]);l(this,"trackingScene",t=>{this.trackingSceneNames.includes(t)&&(this.stopFPSTracker(),this.startFPSTracker())});l(this,"startFPSTracker",()=>{this.fpsTracker.start()});l(this,"stopFPSTracker",()=>{this.fpsTracker.stop()})}configure(t){const{MinQuality:s,MaxQuality:a,QualityAdjustStep:n,TrackingSceneNames:i,Options:r}=t;this.minQuality=s,this.maxQuality=a,this.qualityAdjustStep=n,this.trackingSceneNames=i,this.createFPSTracker(r)}activate(t,s){this.pixelRatio=s,this.trackingScene(t)}downgradeGraphicsQuality(){const t=this.pixelRatio;if(t<=this.minQuality)return!1;const s=+(t-this.qualityAdjustStep).toFixed(2);return s<this.minQuality?!1:(this.pixelRatio=s,this.resizeGameWorld(this.pixelRatio),!0)}upgradeGraphicsQuality(){const t=this.pixelRatio;if(t>=this.maxQuality)return!1;const s=+(t+this.qualityAdjustStep).toFixed(2);return s>this.maxQuality?!1:(this.pixelRatio=s,this.resizeGameWorld(this.pixelRatio),!0)}createFPSTracker(t){this.fpsTracker=new En(this,t)}get event(){return this.game.event}resizeGameWorld(t){const s={forcePixelRatio:t};this.event.emit(U.REQUEST_RESIZE_GAME,s)}updatePostStepDeltaTime(t){this.fpsTracker.postStep(t)}updateActualFPS(t){this.fpsTracker.actualFPS=t}}const bn="production",Nn="null",ue="0",{Dtos:Mn}=h;class Tn extends m.Game{constructor(){super(...arguments);l(this,"ads");l(this,"auth");l(this,"audio");l(this,"match");l(this,"event");l(this,"player");l(this,"profile");l(this,"context");l(this,"storage");l(this,"analytics");l(this,"visibility");l(this,"leaderboard");l(this,"frameCapture");l(this,"monitorError");l(this,"remoteConfig");l(this,"adaptivePerformance");l(this,"console");l(this,"profiler");l(this,"canvasRecorder");l(this,"initMonitorError",()=>{const{MonitorError:t}=h.Configs.Debugger;t.Enable&&(this.monitorError.configure({accessToken:Nn,payload:{environment:bn,client:{javascript:{code_version:`${ue}`}}}}),this.monitorError.setFilterError(t.FilterError))});l(this,"handleSaveRemoteConfig",t=>{try{const s={[t.type]:t};this.player.setPlayerDataByName("remoteConfig",s)}catch{}});l(this,"handleUpdateGameCoreConfig",t=>{try{const{id:s,type:a}=t;if(a!=="GameCore")return;h.Configs=h.Utils.Object.merge(h.Configs,t.config);const{Ads:n}=h.Configs;this.ads.configure(n),this.event.emit(U.REMOTE_CONFIG_UPDATED,{id:s,type:a})}catch{}});l(this,"handleStorageCurrentRemoteConfig",()=>{const t=this.player.getPlayerDataByKey("remoteConfig");if(t){for(const s in t)if(h.Utils.Object.hasOwn(t,s)){const a=t[s],n=h.Utils.Json.clone(a),i=new Mn.RemoteConfig.Data(n).toObject();this.remoteConfig.setRemoteConfig(i),this.remoteConfig.processUpdateConfig(i.id,i.type)}}});l(this,"processAfterSyncProfile",()=>{const{Notification:t}=h.Configs;t.Enable&&(this.updatePlayerProfileToNotificationService(),this.sendFirstNotification())})}getBuildVersion(){return ue}async boot(){super.boot(),this.addPlugins(),this.initEventPlugin(),this.initMatchPlugin(),this.initRemoteConfig(),this.initAdaptivePerformancePlugin(),this.event.emit(h.Events.CORE_BOOTING),this.addMonitorPlugin().then(this.initMonitorError),this.addDevPlugins().then(()=>{this.initConsole(),this.initProfilerPlugin(),this.initCanvasRecorderPlugin()}),await this.initAds()}async start(){super.start(),this.event.emit(h.Events.CORE_STARTING),await this.auth.requestToken(),await this.initState(),this.processPlayerProfile(),await this.context.detectContextSessionType(),this.context.detectContextGameMode(),this.initGoogleAnalytics(),this.initFacebookAnalytics(),this.event.emit(h.Events.CORE_READY)}addPlugins(){this.plugins.install("Storage",wn,!0,"storage"),this.storage=this.plugins.get("Storage"),this.plugins.install("Ads",as,!0,"ads"),this.plugins.install("Auth",hs,!0,"auth"),this.plugins.install("Audio",cs,!0,"audio"),this.plugins.install("Match",Ba,!0,"match"),this.plugins.install("Event",Ps,!0,"event"),this.plugins.install("Player",Wa,!0,"player"),this.plugins.install("Profile",un,!0,"profile"),this.plugins.install("Context",fs,!0,"context"),this.plugins.install("Language",Es,!0,"language"),this.plugins.install("Analytics",is,!0,"analytics"),this.plugins.install("Visibility",An,!0,"visibility"),this.plugins.install("Leaderboard",Ns,!0,"leaderboard"),this.plugins.install("FrameCapture",xs,!0,"frameCapture"),this.plugins.install("RemoteConfig",mn,!0,"remoteConfig"),this.plugins.install("AdaptivePerformance",vn,!0,"adaptivePerformance"),this.ads=this.plugins.get("Ads"),this.auth=this.plugins.get("Auth"),this.audio=this.plugins.get("Audio"),this.match=this.plugins.get("Match"),this.event=this.plugins.get("Event"),this.player=this.plugins.get("Player"),this.profile=this.plugins.get("Profile"),this.context=this.plugins.get("Context"),this.language=this.plugins.get("Language"),this.analytics=this.plugins.get("Analytics"),this.visibility=this.plugins.get("Visibility"),this.leaderboard=this.plugins.get("Leaderboard"),this.frameCapture=this.plugins.get("FrameCapture"),this.remoteConfig=this.plugins.get("RemoteConfig"),this.adaptivePerformance=this.plugins.get("AdaptivePerformance")}async addMonitorPlugin(){const{MonitorError:t}=h.Configs.Debugger;if(!t.Enable)return;const s=(await X(()=>import("./bundle/empty-script.js"),[],import.meta.url)).default;this.plugins.install("MonitorError",s,!0,"monitorError"),this.monitorError=this.plugins.get("MonitorError")}async addDevPlugins(){if(!h.Utils.Valid.isDebugger())return;const{ShowConsole:t,ShowProfiler:s,CanvasRecorder:a}=h.Configs.Debugger;if(t){const n=(await X(()=>import("./bundle/empty-script.js"),[],import.meta.url)).default;this.plugins.install("Console",n,!0,"console"),this.console=this.plugins.get("Console")}if(s){const n=(await X(()=>import("./bundle/empty-script.js"),[],import.meta.url)).default;this.plugins.install("Profiler",n,!0,"profiler"),this.profiler=this.plugins.get("Profiler")}if(a.Enable){const n=(await X(()=>import("./bundle/empty-script.js"),[],import.meta.url)).default;this.plugins.install("CanvasRecorder",n,!0,"canvasRecorder"),this.canvasRecorder=this.plugins.get("CanvasRecorder")}}initEventPlugin(){const{EventLogging:t}=h.Configs.Debugger;t&&this.event.enableLogEvent()}initMatchPlugin(){this.match.setUseCPUProfile(!1)}async initAds(){const{Configs:t,Plugins:s}=h,{Ads:a}=s;this.ads.configure(t.Ads),this.initAdInstance(a,t)}initAdInstance(t,s){const{InterstitialAdOptions:a,RewardedVideoAdOptions:n,BannerDisplayAdOptions:i}=s.Ads;a.forEach(r=>{this.ads.setAdInstance(t.Types.INTERSTITIAL,r.PlacementId,de)}),n.forEach(r=>{this.ads.setAdInstance(t.Types.REWARDED_VIDEO,r.PlacementId,de)}),i.forEach(r=>{this.ads.setAdInstance(t.Types.BANNER,r.PlacementId,Pn)})}async initState(){try{const t=new Je(this);t.initContext(),await t.initPlayer()}catch{}}initConsole(){if(!h.Utils.Valid.isDebugger())return;const{ShowConsole:t}=h.Configs.Debugger;t&&this.console.configure()}initProfilerPlugin(){if(!h.Utils.Valid.isDebugger())return;const{ShowProfiler:t}=h.Configs.Debugger;t&&this.profiler.configure()}initCanvasRecorderPlugin(){if(!h.Utils.Valid.isDebugger())return;const{CanvasRecorder:t}=h.Configs.Debugger;if(!t.Enable)return;const{Type:s,Quality:a,RecordFps:n,SyncFps:i}=t.Options;this.canvasRecorder.configure({type:s,quality:a,syncFps:i,recordFps:n});const r=document.querySelector("canvas");r&&this.canvasRecorder.setCanvas(r)}initRemoteConfig(){const{RemoteConfig:t}=h.Configs;if(!t.Enabled)return;const s=h.Utils.Json.clone(t);this.remoteConfig.configure(s),this.event.on(U.REQUEST_SAVE_CONFIG,this.handleSaveRemoteConfig),this.event.on(U.REQUEST_UPDATE_CONFIG,this.handleUpdateGameCoreConfig),this.event.once(U.PLAYER_INFO_LOADED,this.handleStorageCurrentRemoteConfig)}initAdaptivePerformancePlugin(){const{AdaptivePerformance:t}=h.Configs;if(!t.Enabled)return;const s=h.Utils.Json.clone(t);this.adaptivePerformance.configure(s)}async processPlayerProfile(){try{await this.player.syncProfileToServer(),this.processAfterSyncProfile()}catch{}}updatePlayerProfileToNotificationService(){const{AppId:t}=h.Configs,s=this.player.getPlayer(),{ASID:a,playerId:n,name:i,photo:r,locale:c}=s;es({appId:t,ASID:a,playerId:n,name:i,photo:r,locale:c}).catch(()=>{})}async sendFirstNotification(){try{if(!this.player.isFirstLogin())return;const s=this.player.getPlayerASID();if(!s)return;const a=await GameSDK.player.getDataAsync(["isNotificationFirstSent"])||{},{isNotificationFirstSent:n}=a;if(n===!0||!("sendNotificationAsync"in GameSDK.extra))return;await GameSDK.extra.sendNotificationAsync({message:`Hi @[${s}] your friends are waiting to play with you, play now!`,delayTime:3600}),GameSDK.player.setDataAsync({isNotificationFirstSent:!0})}catch{}}initGoogleAnalytics(){}initFacebookAnalytics(){const{Prefix:t,ConsoleLog:s}=h.Configs.Analytics.FacebookAnalytics??{};typeof t=="string"&&this.analytics.add(new xn(this.game,{prefix:t,consoleLog:s}))}}const On=async()=>{try{const o=new Tn;window.game=o,He(window,"game");const e=30;window.__sdkLoadingCount<e&&(window.__sdkLoadingCount=e),window.__gameCoreReady=!0,await o.boot(),o.event.once(h.Events.REQUEST_CORE_START,Ln)}catch{}},Ln=()=>{try{window.game.start(),h.Utils.Valid.isDebugger()||(window.game=Object.freeze(window.game));const o=35;window.__sdkLoadingCount<o&&(window.__sdkLoadingCount=o)}catch{}},_n=()=>{const e=setInterval(()=>{if(!window.__sdkInitiated)return;clearInterval(e);const t=20;window.__sdkLoadingCount<t&&(window.__sdkLoadingCount=t);try{gtag("event","app_initialize",{send_to:["GA"]})}catch{}On()},100)};h.Utils.Device.isDesktop()&&window.devicePixelRatio<2&&(window.devicePixelRatio=2);_n();
