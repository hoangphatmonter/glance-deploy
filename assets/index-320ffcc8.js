import"../bundle/monitor.js";import"../bundle/game.js";import"../bundle/engine.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}})();const D=["INVALID_PARAM","SAME_CONTEXT","NETWORK_FAILURE","PENDING_REQUEST","CLIENT_UNSUPPORTED_OPERATION"];var B=window.location.href,T=B.split("?"),S=T[1].split("&"),O=S[0].split("="),K=S[1].split("="),M=S[2].split("="),z=S[3].split("="),H=O[1],Q=M[1],V=K[1],q=z[1],g=window.gameName,y=null,P=null,_=null,f=null,J=window.replayEvent;window.replayEvent=function(){if(window.leaderboard_callback){console.log("Leaderboard is open, close it and show replay ad after leaderboard is closed"),window.showGame();var e=window.leaderboard_callback;window.leaderboard_callback=null,e();return}console.log("Leaderboard is not open, show replay ad"),J()};function F(e){var n=window.replayObj.adUnitName,t=window.rewardObj.adUnitName;e.adInstance?.registerCallback("onAdLoadSucceed",r=>{if(console.log("onAdLoadSucceeded Rewarded CALLBACK",r),e.adUnitName===n){if(window.is_replay_noFill=!1,!_){console.warn("replay load resolve is null");return}setTimeout(()=>{_(),_=null},500)}if(e.adUnitName===t){if(window.is_rewarded_noFill=!1,!y){console.warn("reward load resolve is null");return}setTimeout(()=>{y(),y=null},500)}}),e.adInstance?.registerCallback("onAdLoadFailed",r=>{if(console.log("onAdLoadFailed Rewarded CALLBACK",r),e.adUnitName===n){if(window.is_replay_noFill=!0,window.replayInstance=null,!f){console.warn("replay load reject is null");return}setTimeout(()=>{f(),f=null},500)}if(e.adUnitName===t){if(window.is_rewarded_noFill=!0,window.rewardInstance=null,!P){console.warn("reward load reject is null");return}setTimeout(()=>{y(),y=null,P=null},500)}}),e.adInstance?.registerCallback("onAdDisplayed",r=>{console.log("onAdDisplayed Rewarded CALLBACK",r)}),e.adInstance?.registerCallback("onAdClosed",r=>{console.log("onAdClosed Rewarded CALLBACK",r),e.adUnitName==t&&(window.isRewardedAdClosedByUser=!0),A(),window.isRewardGranted=!1,window.isRewardedAdClosedByUser=!1}),e.adInstance?.registerCallback("onAdClicked",r=>{console.log("onAdClicked Rewarded CALLBACK",r)}),e.adInstance?.registerCallback("onRewardsUnlocked",r=>{console.log("onRewardsUnlocked Rewarded CALLBACK",r),e.adUnitName===t&&(window.isRewardGranted=!0)})}function A(){window._triggerReason==="replay"?(window.replayInstance=null,window.handleNextLevel()):window._triggerReason==="reward"&&(window._triggerReason="",window.rewardInstance=null,!window.isRewardGranted&&window.isRewardedAdClosedByUser?window.handleRewardedFail():window.handleRewardedSuccess())}function W(){$("#bannerOverlay").css("display","none")}function X(e,n){if(y=e,P=n,!window.GlanceGamingAdInterface){y();return}return window.rewardInstance=window.GlanceGamingAdInterface.loadRewardedAd(window.rewardObj,F),window.rewardInstance}function Y(){if(window._triggerReason="reward",!window.GlanceGamingAdInterface){A();return}window.is_rewarded_noFill?A():window.GlanceGamingAdInterface.showRewarededAd(window.rewardInstance)}function Z(e,n){if(_=e,f=n,!window.GlanceGamingAdInterface){f();return}return window.replayInstance=window.GlanceGamingAdInterface.loadRewardedAd(window.replayObj,F),window.replayInstance}function j(){if(window._triggerReason="replay",!window.GlanceGamingAdInterface){A();return}window.is_replay_noFill?A():window.GlanceGamingAdInterface.showRewarededAd(window.replayInstance)}function L(e){return Promise.resolve({isRewarded:e,loadAsync:function(){return new Promise((t,r)=>{this.isRewarded?(console.log("load rewarded ad"),X(t,r)):(console.log("load replay ad"),Z(t,r))})},showAsync:function(){return new Promise((t,r)=>{this.isRewarded?(window.handleRewardedFail=()=>{if(window.GameCore&&!window.isRewardGranted&&window.isRewardedAdClosedByUser){const o=new window.GameCore.Ads.AdError("USER_INPUT","User close rewarded ad");r(o);return}r()},window.handleRewardedSuccess=t,Y()):(window.handleNextLevel=t,j())})},getPlacementID:function(){return""}})}window.pauseEvent=function(){console.warn("pauseEvent: method is not implemented")};window.resumeEvent=function(){console.warn("resumeEvent: method is not implemented")};window.replayGameEvent=function(){console.warn("replayGameEvent: method is not implemented")};window.gotoHomeEvent=function(){console.warn("gotoHomeEvent: method is not implemented")};window.nextLevelEvent=function(){console.warn("nextLevelEvent: method is not implemented")};window.gotoLevel=function(n){console.warn("gotoLevel: method is not implemented")};window.handleNextLevel=function(){console.warn("handleNextLevel: method is not implemented")};window.handleRewardedFail=function(){console.warn("handleRewardedFail: method is not implemented")};window.handleRewardedSuccess=function(){console.warn("handleRewardedSuccess: method is not implemented")};window.gotoLevel=function(n){console.warn("gotoLevel: method is not implemented")};window.enableSound=function(n){console.warn("enableSound: method is not implemented")};window.getLoadingPerc=function(){console.warn("getLoadingPerc: method is not implemented")};let c=[],b=c.length,G="Default Name",m="1",ee="1",v="",E="1";var R="1",x="1",N="1",C="1";function U(){return D[Math.floor(D.length*Math.random())]}const a={log:function(){},getQueryString:function(){const n={};return location.search&&location.search.substr(1).split("&").forEach(t=>{const r=t.split("="),o=r[0],i=r[1]&&decodeURIComponent(r[1]);(n[o]=n[o]||[]).push(i)}),n},returnAndLog:function(n){return a.log(n),n},returnUserData:function(n){return s.__mockState.initialized?a.returnAndLog(n):(a.log("User Data is not available until startGameAsync has resolved"),null)},getFromLocalStorage:function(n,t){return new Promise(r=>{let o=localStorage.getItem(n);const i={};o&&(o=JSON.parse(o),t.forEach(d=>{o[d]!=="undefined"&&(i[d]=o[d])})),a.log(i),r(i)})},writeToLocalStorage:function(n,t){return new Promise(r=>{const i={...JSON.parse(localStorage.getItem(n)),...t};a.log(JSON.stringify(i)),localStorage.setItem(n,JSON.stringify(i)),r()})}},s={__mockState:{initialized:!1},leaderboardEntry:(e,n,t=!1)=>({getRank:function(){return e},getScore:function(){return n},getExtraData:function(){return JSON.stringify({})},getPlayer:function(){return s.leaderboardPlayer(e,t)},getFormattedScore:function(){return""},getTimestamp:function(){return 0}}),leaderboardPlayer:(e,n,t)=>({getID:function(){return t?s.player.getID():"Rank #"+e},getName:function(){return t?"You":"Rank #"+e},getPhoto:function(){return""}}),player:{getName:function(){return a.returnUserData(G)},getPhoto:function(){return a.returnUserData(v)},getID:function(){return a.returnUserData(m)},getGlanceImpId:function(){return a.returnUserData(R)},getGlanceApiKey:function(){return a.returnUserData(x)},getGlanceId:function(){return a.returnUserData(N)},getGlanceGpId:function(){return a.returnUserData(C)},getASIDAsync:function(){return a.returnUserData(ee)},getDataAsync:function(n){return a.log("player.getDataAsync"),a.getFromLocalStorage("sdkPlayerData."+g,n)},setDataAsync:function(n){return a.log("player.setDataAsync"),a.writeToLocalStorage("sdkPlayerData."+g,n)},getStatsAsync:function(n){return a.log("player.getStatsAsync"),n||(n=[]),a.getFromLocalStorage("sdkPlayerStats."+g,n)},setStatsAsync:function(n){return a.log("player.setStatsAsync"),a.writeToLocalStorage("sdkPlayerStats."+g,n)},incrementStatsAsync:function(n){return new Promise(t=>{a.getFromLocalStorage("sdkPlayerStats."+g,Object.keys(n)).finally(r=>{for(const o in r)r[o]+=n[o];a.writeToLocalStorage("sdkPlayerStats."+g,r).finally(()=>{t()})})})},flushDataAsync:function(){return new Promise(n=>{a.log("player.flushDataAsync"),a.writeToLocalStorage("sdkPlayerData."+g,{}).finally(()=>{n()})})},getConnectedPlayersAsync:function(){return new Promise(n=>{let t=[];if(s.__mockState.initialized)for(let o=0;o<b;o++){const i=c[o],d=i.playerId,l=i.name,u=i.photo;t.push({id:d,name:l,photo:u,getID(){return this.id},getName(){return this.name},getPhoto(){return this.photo}})}else a.log("getConnectedPlayersAsync","Connected players data is not available before startGameAsync resolves");a.log("getConnectedPlayersAsync","players: ",t),n(t)})},getSignedPlayerInfoAsync:function(){return new Promise(n=>{n({getSignature:function(){return E},getPlayerID:function(){return m}})})}},context:{id:a.getQueryString().context_source_id||"",type:a.getQueryString().context_type||"SOLO",getID:function(){return s.context.id},chooseAsync:function(){return new Promise((n,t)=>{const r=p('<div style="z-index: 1000000000; display: flex; align-items: center; height: 100%; width: 56vh;max-width:100vh; background-color: rgba(31, 120, 136, 0.48); position: absolute;margin:auto;left:0;right:0"></div'),o=p('<button style="width:100px;height:70px;cursor:pointer;position:absolute;right: 10px;top:10px">Close</button>');o.onclick=i=>{i.stopPropagation(),i.preventDefault(),t({code:"USER_INPUT",message:"User close popup!"}),r.remove()},r.appendChild(o),a.log("context.chooseAsync"),s.context.id="123456789",s.context.type="THREAD",setTimeout(()=>{if(Math.random()*100<window.GameCore.Configs.MatchMockFailRate){t({code:U(),message:"Random error"});return}document.body.append(r)},500)})},switchAsync:function(n){return new Promise(t=>{a.log("context.switchAsync"),s.context.id=n,s.context.type="THREAD",t(n)})},createAsync:function(){return new Promise((n,t)=>{const r=c.filter(l=>l.playerId!=m)[0],o=p(`<div style="height: 40vh;width: 53vh;max-width: 95vw;position:absolute;background-color: rgba(31, 120, 136, 0.48);border-radius: 2vh;margin: auto;right: 0;left: 0;top: 0;bottom: 0;display: flex;flex-direction:column;justify-content:space-evenly;"><div style="display:flex; justify-content:center; width: 100%"><div style="width: 100px;height: 100px;overflow: hidden;border-radius: 50%;"><img style="height:100%"src="${v}"/></div><div style="width: 100px;height: 100px;overflow: hidden;border-radius: 50%;"><img style="height:100%"src="${r.photo}"/></div></div><p style="color: white;font-size: 21px;text-align: center;margin: 10px 40px 10px 40px;">Send an invitation to play Game<br>through Messenger.</p></div>`),i=p('<button style="border: none;background-color: #1877f2;color: #fff;width: 90%;height: 50px;border-radius: 15px;margin-left: auto;margin-right: auto;font-size: 20px;cursor: pointer;">Play</button>');i.onclick=l=>{l.stopPropagation(),l.preventDefault(),a.log("context.chooseAsync"),s.context.id="123456789",s.context.type="THREAD",n(s.context.id),o.remove()};const d=p('<button style="border: none;background-color: #1877f2;color: #fff;width: 80px;height: 50px;font-size: 20px;cursor: pointer;position:absolute;top:10px;right:10px;border-radius: 10px;">Close</button>');d.onclick=l=>{l.stopPropagation(),l.preventDefault(),t({code:"USER_INPUT",message:"User close popup!"}),o.remove()},o.append(i),o.append(d),setTimeout(()=>{if(Math.random()*100<window.GameCore.Configs.MatchMockFailRate){t({code:U(),message:"Random error"});return}document.body.append(o)},500)})},getType:function(){return a.returnAndLog(s.context.type)},isSizeBetween:function(){return a.returnAndLog(!1)},getPlayersAsync:function(){return new Promise(n=>{const t=c.map(r=>({getID:function(){return r.playerId},getName:function(){return r.name},getPhoto:function(){return r.photo}}));a.log("context.getPlayersAsync","players: ",t),n(t)})}},getLocale:function(){var n=a.getQueryString();let t=window.__GAME_LANGUAGE||"en";return n.hl&&n.hl.length>0&&(t=n.hl[0]),console.log({langCode:t}),t+"_VN"},initializeAsync:function(){c=[{name:localStorage.getItem("randomUserName"),photo:"",playerId:H,signature:"1",impressionId:Q,apiKey:V,glanceId:q,gpID:window.gpID}],window.__glancePlayerData=c[0];var t=0;return b=c.length,G=c[t].name,m=c[t].playerId,v=c[t].photo,E=c[t].signature,R=c[t].impressionId,x=c[t].apiKey,N=c[t].glanceId,C=c[t].gpID,new Promise(function(r){const i=Date.now(),d=setInterval(function(){if(Date.now()-i<5e3){if(!window.isAdSDKLoaded||window.GlanceGamingAdInterface&&(!window.GlanceGamingAdInterface.isLibraryInitialized||!window.GlanceGamingAdInterface.isLibraryInitialized()||!window.GlanceGamingAdInterface.showStickyBannerAd||!window.GlanceGamingAdInterface.loadRewardedAd))return}else console.log("maximum time wait for the ad sdk loading");window.isAdSDKLoaded=!0,a.log("initializeAsync"),s.__mockState.initialized=!0,clearInterval(d),r()})})},setLoadingProgress:function(n){window.progressBar(n)},startGameAsync:function(){return new Promise(n=>{a.log("startGameAsync","Showing game start dialog"),s.__mockState.initialized=!0,n()})},quit:function(){a.log("QUIT was called. At this point the game will exit")},updateAsync:function(n){return te(n.data||{}),new Promise((t,r)=>{a.log("updateAsync"),n.image?t():r()})},getEntryPointData:function(){const n=a.getQueryString();return a.log("getEntryPointData","query string: ",n,"entry point data: ",n.entryPointData),n.entryPointData?JSON.parse(decodeURIComponent(n.entryPointData[0])):null},getEntryPointAsync:function(){return new Promise(n=>{n("admin_message")})},setSessionData:function(n){a.log("setSessionData","Object to be persisted",n,"(Please note, while using the mock SDK, setSessionData will have no effect.)")},getPlatform:function(){return"WEB"},getSDKVersion:function(){return"6.3"},getSupportedAPIs:function(){const n=[];for(let t in s)n.push(t);for(let t in s.player)n.push(`player.${t}`);for(let t in s.context)n.push(`context.${t}`);return n},shareAsync:function(){return!0},switchGameAsync:function(){return Promise.reject(new Error("sdkFakeFBInstant.switchAsync is not available in the Mocked SDK."))},logEvent:function(){return null},onPause:function(n){window.onblur=()=>{a.log("onPause","Interruption event triggered"),n()}},getLeaderboardAsync:function(){return new Promise((n,t)=>{if(!("getLeaderBoardData"in window)){t("getLeaderBoardData is not defined");return}window.getLeaderBoardData(r=>{if(typeof r!="object"){t();return}if(Array.isArray(r)){t();return}const o=Number(String(r.user_current_rank).split("/")[0]),i=Number(r.current_user_max_score.scores__max),d=Number(r.current_user_max_score.scores__max);n({getEntriesAsync:function(u=20,h=0){const I=[];for(let w=h;w<r.score_details.length;w++)I.push(s.leaderboardEntry(w+1,Number(r.score_details[w].scores),w<u+h&&w+1==o));return Promise.resolve(I)},getConnectedPlayerEntriesAsync:function(){return Promise.resolve([])},getPlayerEntryAsync:function(){return Promise.resolve(s.leaderboardEntry(o,i,!0))},setScoreAsync:function(u){return u<=d?Promise.resolve(s.leaderboardEntry(o,d,!0)):new Promise((h,I)=>{window.sendLeaderBoardData(u,w=>{w==="error"?I("error"):h(s.leaderboardEntry(o,u,!0))})})}})})})},postSessionScoreAsync:function(){return Promise.resolve()},loadBannerAdAsync:function(n){clearInterval(this.waitAdInterval),this.waitAdInterval=setInterval(()=>{if(window.GlanceGamingAdInterface&&window.GlanceGamingAdInterface?.isLibraryInitialized())return clearInterval(this.waitAdInterval),console.log("loadBannerAdAsync",window.StickyObj),window.refreshStickyBannerAd(),window.StickyBannerInstance&&window.StickyBannerInstance.destroyAd(),window.StickyBannerInstance=window.GlanceGamingAdInterface.showStickyBannerAd(window.StickyObj,window.bannerCallbacks),window.StickyBannerInstance},100)},hideBannerAdAsync:function(){return W(),!0},matchPlayerAsync:function(){return Promise.reject()},getRewardedVideoAsync:function(n){return L(!0)},getInterstitialAdAsync:function(n){return L(!1)}};window.FBInstant=s;const ne=e=>encodeURIComponent(JSON.stringify(e)),te=e=>{const n=c[0].playerId===m?c[1].playerId:c[0].playerId;console.log(`Link to receive message: 
${document.location.origin+document.location.pathname}?playerId=${n}&context_source_id=123456789&context_type=THREAD&entryPointData=${ne(e)}}`)};function p(e){var n=document.createElement("div");return n.innerHTML=e.trim(),n.firstChild}function re(){let e=1;window.FBInstant.initializeAsync().then(function(){if(window.focus(),window.__GA_CONFIG){const n=window.FBInstant.player.getID();window.FBInstant.getEntryPointAsync().then(function(t){k(n,t)}).catch(function(){k(n,"no_entry")})}else window.__analyticsInitiated=!0;window.__fbInstantInitiated=!0,window.__fbInstantLoadingTimer=setInterval(function(){window.FBInstant.setLoadingProgress(e++),e>=30&&clearInterval(window.__fbInstantLoadingTimer)},80)})}function k(e,n){const t=window.__GA_CONFIG.BUILD_VERSION,r=window.__GA_CONFIG.GA_MEASUREMENT_ID;if(r=="null"){window.__analyticsInitiated=!0;return}const o=window.FBInstant.getEntryPointData()||{},i=o.fbig_ad_id,d=o.fbig_adset_id,l=o.fbig_campaign_id,u=document.createElement("script");u.async=!0,u.src="https://www.googletagmanager.com/gtag/js?id="+r,document.head.appendChild(u),window.gtag("set","client_id",`100.${e}`),window.gtag("set","user_id",e),window.gtag("set","send_page_view",!1),window.gtag("js",new Date),window.gtag("config",r,{cookie_flags:"SameSite=None;Secure",build:t,medium:n,campaign:l,groups:"GA"}),window.gtag("set","user_properties",{user_id:e,traffic_source:n,campaign_id:l,adset_id:d,ad_id:i,glance_imp_id:window.FBInstant.player.getGlanceImpId(),glance_api_key:window.FBInstant.player.getGlanceApiKey(),glance_id:window.FBInstant.player.getGlanceId(),glance_gp_id:window.FBInstant.player.getGlanceGpId()}),window.gtag("event","app_launch",{send_to:"GA"}),window.__analyticsInitiated=!0}re();
