import"./engine.js";const fh=(i,e=1)=>Array.from({length:Math.ceil(i.length/e)},(t,s)=>i.slice(s*e,s*e+e)),yh=(i,e)=>i.filter(t=>!e.includes(t)),Eh=i=>{for(let e=i.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[i[e],i[t]]=[i[t],i[e]]}},Sh=(i,e,t)=>t.indexOf(i)===e&&i!==null&&i!==void 0,Ah=i=>i.filter(Sh),bh={chunk:fh,difference:yh,shuffle:Eh,unique:Ah};var Th={isEqual:!0,isMatchingKey:!0,isPromise:!0,maxSize:!0,onCacheAdd:!0,onCacheChange:!0,onCacheHit:!0,transformKey:!0},wh=Array.prototype.slice;function ui(i){var e=i.length;return e?e===1?[i[0]]:e===2?[i[0],i[1]]:e===3?[i[0],i[1],i[2]]:wh.call(i,0):[]}function Ch(i){var e={};for(var t in i)Th[t]||(e[t]=i[t]);return e}function Ih(i){return typeof i=="function"&&i.isMemoized}function Ph(i,e){return i===e||i!==i&&e!==e}function Oa(i,e){var t={};for(var s in i)t[s]=i[s];for(var s in e)t[s]=e[s];return t}var vh=function(){function i(e){this.keys=[],this.values=[],this.options=e;var t=typeof e.isMatchingKey=="function";t?this.getKeyIndex=this._getKeyIndexFromMatchingKey:e.maxSize>1?this.getKeyIndex=this._getKeyIndexForMany:this.getKeyIndex=this._getKeyIndexForSingle,this.canTransformKey=typeof e.transformKey=="function",this.shouldCloneArguments=this.canTransformKey||t,this.shouldUpdateOnAdd=typeof e.onCacheAdd=="function",this.shouldUpdateOnChange=typeof e.onCacheChange=="function",this.shouldUpdateOnHit=typeof e.onCacheHit=="function"}return Object.defineProperty(i.prototype,"size",{get:function(){return this.keys.length},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"snapshot",{get:function(){return{keys:ui(this.keys),size:this.size,values:ui(this.values)}},enumerable:!1,configurable:!0}),i.prototype._getKeyIndexFromMatchingKey=function(e){var t=this.options,s=t.isMatchingKey,n=t.maxSize,a=this.keys,r=a.length;if(!r)return-1;if(s(a[0],e))return 0;if(n>1){for(var c=1;c<r;c++)if(s(a[c],e))return c}return-1},i.prototype._getKeyIndexForMany=function(e){var t=this.options.isEqual,s=this.keys,n=s.length;if(!n)return-1;if(n===1)return this._getKeyIndexForSingle(e);var a=e.length,r,c;if(a>1){for(var o=0;o<n;o++)if(r=s[o],r.length===a){for(c=0;c<a&&t(r[c],e[c]);c++);if(c===a)return o}}else for(var o=0;o<n;o++)if(r=s[o],r.length===a&&t(r[0],e[0]))return o;return-1},i.prototype._getKeyIndexForSingle=function(e){var t=this.keys;if(!t.length)return-1;var s=t[0],n=s.length;if(e.length!==n)return-1;var a=this.options.isEqual;if(n>1){for(var r=0;r<n;r++)if(!a(s[r],e[r]))return-1;return 0}return a(s[0],e[0])?0:-1},i.prototype.orderByLru=function(e,t,s){for(var n=this.keys,a=this.values,r=n.length,c=s;c--;)n[c+1]=n[c],a[c+1]=a[c];n[0]=e,a[0]=t;var o=this.options.maxSize;r===o&&s===r?(n.pop(),a.pop()):s>=o&&(n.length=a.length=o)},i.prototype.updateAsyncCache=function(e){var t=this,s=this.options,n=s.onCacheChange,a=s.onCacheHit,r=this.keys[0],c=this.values[0];this.values[0]=c.then(function(o){return t.shouldUpdateOnHit&&a(t,t.options,e),t.shouldUpdateOnChange&&n(t,t.options,e),o},function(o){var l=t.getKeyIndex(r);throw l!==-1&&(t.keys.splice(l,1),t.values.splice(l,1)),o})},i}();function Ls(i,e){if(e===void 0&&(e={}),Ih(i))return Ls(i.fn,Oa(i.options,e));if(typeof i!="function")throw new TypeError("You must pass a function to `memoize`.");var t=e.isEqual,s=t===void 0?Ph:t,n=e.isMatchingKey,a=e.isPromise,r=a===void 0?!1:a,c=e.maxSize,o=c===void 0?1:c,l=e.onCacheAdd,h=e.onCacheChange,d=e.onCacheHit,u=e.transformKey,p=Oa({isEqual:s,isMatchingKey:n,isPromise:r,maxSize:o,onCacheAdd:l,onCacheChange:h,onCacheHit:d,transformKey:u},Ch(e)),g=new vh(p),m=g.keys,E=g.values,f=g.canTransformKey,y=g.shouldCloneArguments,S=g.shouldUpdateOnAdd,T=g.shouldUpdateOnChange,b=g.shouldUpdateOnHit,C=function(){var O=y?ui(arguments):arguments;f&&(O=u(O));var v=m.length?g.getKeyIndex(O):-1;if(v!==-1)b&&d(g,p,C),v&&(g.orderByLru(m[v],E[v],v),T&&h(g,p,C));else{var w=i.apply(this,arguments),P=y?O:ui(arguments);g.orderByLru(P,w,m.length),r&&g.updateAsyncCache(C),S&&l(g,p,C),T&&h(g,p,C)}return E[0]};return C.cache=g,C.fn=i,C.isMemoized=!0,C.options=p,C}const Oh=Ls((i,e)=>{if(typeof i=="string"){const t=e[i.toLowerCase()];if(typeof t=="string")return t}return"?"}),_h=Ls(i=>{let e=null;const t=[],s=/:([A-Z0-9?]+)/gm;for(;(e=s.exec(i))!==null;)t.push(e[1]);return t}),Rh=Ls(i=>{let e=null;const t=[],s=/([0-9]+[A-Z?]{1}|[A-Z?]{1})/gm;for(;(e=s.exec(i))!==null;){const n=e[0];if(n.length>=2){const{length:a}=n,r=n.slice(0,a-1),c=n[a-1],o=new Array(+r).fill(c);t.push(...o);continue}t.push(n)}return t}),xh=(i,e)=>{const t=i,s=GameCore.Utils.Object.invert(e),n={};let a=0,r=0;return _h(t).forEach(o=>{a=0,r++,n[r]||(n[r]={}),Rh(o).forEach(h=>{a++,n[r][a]=Oh(h,s)})}),n},Dh=Ls((i,e)=>{const t=e[i];return typeof t=="string"?`${t.toUpperCase()}`:"?"}),yo=(i,e,t=!1)=>{let s="";if(!GameCore.Utils.Valid.isObject(i))return s;let n="",a=1;for(const r in i){if(!GameCore.Utils.Object.hasOwn(i,r))continue;const c=i[r];if(GameCore.Utils.Valid.isObject(c)){s+=`:${yo(c,e,!0)}`;continue}if(!GameCore.Utils.Valid.isString(c))continue;const o=Dh(c,e);o===n?(a++,s=s.slice(0,-2)):a=1,s+=`${a}${o}`,n=o}return s=s.replace(/1([A-Z])/g,"$1"),s},Bh=i=>{try{return atob(i)}catch{return""}},kh=i=>{try{return btoa(i)}catch{return""}},Nh={decodeMap:xh,encodeMap:yo,hashToString:Bh,stringToHash:kh},Mh=(i,e)=>{const t=document.createElement("style"),s=Object.keys(e).map(n=>Lh(n,e[n])).join(";");return t.innerHTML=`${i} { ${s} }`,document.head.appendChild(t),t},Lh=(i,e)=>`${GameCore.Utils.String.toKebabCase(i)}: ${e}`,Gh={dynamicCSS:Mh},Eo=i=>{try{return JSON.parse(i)}catch{return null}},So=i=>{try{return JSON.stringify(i,null,0)}catch{return""}},Fh=i=>Eo(So(i)),Uh={clone:Fh,decode:Eo,encode:So},mn=i=>{const e=typeof i=="object"||typeof i=="function",t=Array.isArray(i);return i!==null&&e&&!t},Yh=i=>i==null,Ao=i=>{if(!mn(i))return i;for(const e in i){Yh(i[e])&&delete i[e];const t=i[e];mn(t)&&(i[e]=Ao(t))}return i},Bn=(i,e)=>Object.prototype.hasOwnProperty.call(i,e),Hh=i=>{const e={};return Object.keys(i).forEach(t=>{if(!Bn(i,t))return;const s=i[t];typeof s=="string"&&(e[s]=t)}),e},zh=(i,e)=>{if(!Array.isArray(i))return{};const t={};return i.forEach(s=>{if(!Bn(s,e))return;const n=s[e];typeof n=="string"&&(t[n]=s)}),t},Wh={clear:Ao,hasOwn:Bn,invert:Hh,keyBy:zh},Vh=i=>i&&i[0].toUpperCase()+i.slice(1),Kh=i=>{let e=0;if(i.length==0)return e;for(let t=0;t<i.length;t++){const s=i.charCodeAt(t);e=(e<<5)-e+s,e=e&e}return e},$h=i=>Object.keys(i).reduce((t,s)=>{const n=i[s];return n!==void 0&&t.push(`${s}=${n}`),t},[]).join("&"),jh="0123456789ABCDEF",Xh=(i="0x")=>{let e=i;for(let t=0;t<6;t++)e+=jh[Math.floor(Math.random()*16)];return e},qh=i=>{const e=i.replace(/[-_\s.]+(.)?/g,(t,s)=>s?s.toUpperCase():"");return e.substr(0,1).toUpperCase()+e.substr(1)},Zh=i=>{const e=i.replace(/[-_\s.]+(.)?/g,(t,s)=>s?s.toUpperCase():"");return e.substr(0,1).toLowerCase()+e.substr(1)},Jh=i=>i.replace(/([a-z0-9]|(?=[A-Z]))([A-Z])/g,"$1-$2").toLowerCase(),Qh=(i,e)=>{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789*#%&!";let s="",n=i;e!=null&&(n-=e.length,s+=e);for(let a=0;a<n;a++){const r=Math.floor(Math.random()*t.length);s+=t.charAt(r)}return s},eu=i=>i.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[Ä‘Ä]/g,t=>t==="Ä‘"?"d":"D"),tu=(i,e)=>{const t=i.split(" "),n=(t.length<=1?[...t]:[t[0],t.pop()]).join(" "),a=n.lastIndexOf(" ")||0,r=a>=0?a:e;return(n.length>e?n.substring(0,r):n).substring(0,e)},su=(i=16)=>{const e=s=>Math.floor(s).toString(i);return e(Date.now()/1e3)+" ".repeat(i).replace(/./g,()=>e(Math.random()*i))},iu={capitalize:Vh,hashCode:Kh,params:$h,toCamelCase:Zh,toKebabCase:Jh,toUpperCamelCase:qh,randomColor:Xh,random:Qh,removeDiacritics:eu,getShortName:tu,generateObjectId:su},nu=i=>typeof i=="boolean",bo="false";console.log("DEBUG",bo);const au=()=>bo==="true",ru=i=>typeof i=="function",ou=i=>typeof i=="number",cu=i=>["string","number","symbol"].indexOf(typeof i)>-1,lu=i=>typeof i=="string",hu=(i,e,t)=>{const{timeout:s=1e3,checkInterval:n=100}=t||{};return new Promise(a=>{const r=setInterval(()=>{const c=typeof i=="function"?i():i,o=typeof e=="function"?e():e;c===o&&(clearInterval(r),a(!0))},n);s>0&&setTimeout(()=>{clearInterval(r),a(!1)},s)})},uu={isBoolean:nu,isDebugger:au,isFunction:ru,isNumber:ou,isObject:mn,isPropertyKey:cu,isString:lu,isValueChangeAsync:hu},du=i=>{const{scene:e,key:t,newKey:s}=i,n=e.textures.get(t).getSourceImage();if(!n)return!1;const a=Math.min(n.width,n.height);s||e.textures.removeKey(t);const r=e.textures.createCanvas(s||t,a,a),c=r.context;return c.beginPath(),c.arc(a/2,a/2,a/2,0,Math.PI*2,!1),c.clip(),r.draw((n.width-a)/2,(n.height-a)/2,n),!0},pu=i=>{const{scene:e,key:t,newKey:s,radius:n}=i;let{width:a,height:r}=i;const c=e.textures.get(t).getSourceImage();if(!c)return!1;a||(a=c.width),r||(r=c.height),s||e.textures.removeKey(t);const o=e.textures.createCanvas(s||t,a,r),l=o.context,d=Math.min(a,r)/100*n/2,u=0,p=0;return l.beginPath(),l.moveTo(u+d,p),l.lineTo(u+a-d,p),l.quadraticCurveTo(u+a,p,u+a,p+d),l.lineTo(u+a,p+r-d),l.quadraticCurveTo(u+a,p+r,u+a-d,p+r),l.lineTo(u+d,p+r),l.quadraticCurveTo(u,p+r,u,p+r-d),l.lineTo(u,p+d),l.quadraticCurveTo(u,p,u+d,p),l.closePath(),l.clip(),o.draw(0,0,c),!0},gu=()=>GameCore.Configs.Game.ForcePixelRatio?GameCore.Configs.Game.ForcePixelRatio:GameCore.Utils.Device.isDesktop()||GameCore.Utils.Device.pixelRatio()>1?2:1,mu={drawCircle:du,drawBorder:pu,getImageScale:gu},fu=(i,e)=>{const{fractionalDigits:t=0,startAbbreviate:s=1e3,abbreviateStep:n=3,maxLength:a=-1,removeLastZero:r=!0,suffixes:c=["","k","m","b","t","q"]}=e||{},o=a===-1?99999999:a;if(i>=s){const u=Math.floor(i/10**n),p=Math.floor((u.toString().length-1)/n)+1,m=(i/(10**n)**p).toFixed(t),E=o-c[p].length,f=m.substring(0,E);return(r?_a(f):f)+c[p]}const l=i.toFixed(t),h=o-c[0].length,d=l.substring(0,h);return r?_a(d):d+c[0]},_a=i=>{if(i.indexOf(".")<0)return i;for(let e=i.length-1;e>=0;e--){if(i[e]==".")return i.substring(0,e);if(i[e]!="0")return i.substring(0,e+1)}return i},yu=(i,e,t="0")=>{let s=i.toString();const n=s.length;for(let a=0;a<e-n;a++)s=t+s;return s},Eu=(i,e,t="0")=>{let s=i.toString();const n=s.length;for(let a=0;a<e-n;a++)s=s+t;return s},Su={toAbbreviatedString:fu,padStart:yu,padEnd:Eu},Au=()=>{const i=navigator.userAgent;return/Windows|Mac OS/i.test(i)&&!/like Mac OS/.test(i)},bu=()=>{const i=navigator.userAgent;return/Android|iP[ao]d|iPhone/i.test(i)},Tu=()=>FBInstant.getPlatform()==="ANDROID",wu=()=>FBInstant.getPlatform()==="IOS",Cu=()=>FBInstant.getPlatform()==="MOBILE_WEB",Iu=()=>Math.round(window.devicePixelRatio)||1,Pu={isDesktop:Au,isMobile:bu,isAndroid:Tu,isIOS:wu,isMobileWeb:Cu,pixelRatio:Iu},To={Array:bh,Hash:Nh,Html:Gh,Json:Uh,Object:Wh,String:iu,Valid:uu,Image:mu,Number:Su,Device:Pu};function wo(i){return Object.prototype.toString.call(i).slice(8,-1)}function qs(i){if(wo(i)!=="Object")return!1;const e=Object.getPrototypeOf(i);return e.constructor===Object&&e===Object.prototype}function Ra(i){return wo(i)==="Symbol"}function xa(i,e,t,s){const n={}.propertyIsEnumerable.call(s,e)?"enumerable":"nonenumerable";n==="enumerable"&&(i[e]=t),n==="nonenumerable"&&Object.defineProperty(i,e,{value:t,enumerable:!1,writable:!0,configurable:!0})}function Co(i,e,t){if(!qs(e))return e;let s={};if(qs(i)){const c=Object.getOwnPropertyNames(i),o=Object.getOwnPropertySymbols(i);s=[...c,...o].reduce((l,h)=>{const d=i[h];return(!Ra(h)&&!Object.getOwnPropertyNames(e).includes(h)||Ra(h)&&!Object.getOwnPropertySymbols(e).includes(h))&&xa(l,h,d,i),l},{})}const n=Object.getOwnPropertyNames(e),a=Object.getOwnPropertySymbols(e);return[...n,...a].reduce((c,o)=>{let l=e[o];const h=qs(i)?i[o]:void 0;h!==void 0&&qs(l)&&(l=Co(h,l,t));const d=t?t(h,l,o):l;return xa(c,o,d,e),c},s)}function Ie(i,...e){return e.reduce((t,s)=>Co(t,s),i)}const vu={ENV:"development",AppId:"866232217659780",ApiHost:"",OtherHost:"",SyncProfileFromAPI:!0,Notification:{Enable:!0,DisableSendNotification:!0,ApiUrl:"https://nostra-notifications.suncs.io",GameTitle:"Dinosaur Eggs Pop",GameImage:"https://static-tt.citigo.site/fbig-singleplay-apps/dinosaur-eggs-pop.jpg"},PlayerMock:{id:"",signature:""},OpponentMock:{id:"",signature:""},MatchMockFailRate:5,Gameplay:{AwardCoins:3e3,MockScoreDifficult:1,MaxRescueCount:1,RescueGamePopupTimeout:15,ForceNewUser:!1,AlwayShowBestScore:!1,ItemConfig:{giftTime:3e3}},GameOver:{ShowClock:!1},PlayerDataStore:"PlayerData.EggShoot",Game:{AutoResize:!0,PortraitRatio:375/550,PortraitWidth:375,PortraitHeight:667,LandscapeRatio:375/550,LandscapeWidth:375,LandscapeHeight:667,ForcePixelRatio:0,DisableLandscape:!0,FullSizeOnLandscape:!1},Debugger:{ShowInspector:!1,ShowMonitoring:!1,ShowConsole:!1,Expanded:!0,AutoRefresh:!0,InspectorAutoUpdate:!0,Opacity:.8},Statistics:{Enable:!1,DisplayMode:0,FPS:!0,MS:!0,MB:!0,Opacity:.8,ShowFPSInGame:!0,ShowMemoryInGame:!1},ParticleEditor:{Enable:!1,Opacity:.8,Expanded:!0},ProfilerPlugin:{Enable:!1},Match:{ContinueSingleMatchEnabled:!1,SingleMatchStore:"singleMatch",LocalSingleMatchDefault:{_id:"12345678890",status:"open",playerId:"",score:0,level:1,startedAt:0,updateAt:0,finishAt:0,data:{}}},DailyRewards:{MaxDays:6,MockTime:0,CheckInterrupt:!0},DailyTasks:{Duration:86400},Tournament:{UseMock:!1,UseGlobalTournament:!1,RequestTournamentBeforeInterstitialAd:!1,GlobalTournaments:[],ForcePlay:!1,UseLeaderboard:!1,TournamentContextIds:[]},Tutorial:{ForceUseTutorial:!1},LeadersBoard:{Name:null,UseMock:!1,Prefix:"leaderboards",LeaderboardId:"",Limit:50},LanguageSupport:{en:"en"},EnableEffectSceneTransition:!1,DefaultTheme:"default",ThemeSupport:{default:"default"},Ads:{Enabled:!0,CalculateSafeAreaBottom:!0,EnableRewardVideoResetInterstitial:!1,Mockup:{Enable:!1,ErrorRate:5,GiphyApiKey:""},InterstitialAdOptions:{pID:"",showWhenStartGame:!1,secondsFirstTime:0,secondsBetweenAds:90},RewardAdOptions:{pID:"",secondsFirstTime:0,secondsBetweenAds:0},BannerAdOptions:[{placementId:"1",bannerHeight:50,platform:"MOBILE",secondsReload:0},{placementId:"2",bannerHeight:50,platform:"DESKTOP",secondsReload:0}]},Network:{MaximumRequest:6,Timeout:15e3,Retries:3},Analytics:{GoogleAnalytics:{consoleLog:!1},FacebookAnalytics:{prefix:"fba",consoleLog:!1}},Sentry:{errorCodes:{accepted:[],ignored:["USER_INPUT","NETWORK_FAILURE","TOURNAMENT_NOT_FOUND","INVALID_OPERATION","CLIENT_UNSUPPORTED_OPERATION"]},errorMessages:{accepted:[],ignored:["Load image failed","Invalid context ID","Failed to fetch"]}},Rollbar:{Enable:!1,UseMockup:!1,FilterError:{Codes:{accepted:[],ignored:["USER_INPUT","NETWORK_FAILURE"]},Messages:{accepted:[],ignored:["Load image failed","Request failed to be processed"]}},ListPlayerDevIds:[]},Performance:{Enable:!1,trackingSceneKeys:["DASHBOARD_SCENE","GAME_SCENE"],minQuality:1,maxQuality:2,fpsThreshold:48,checkInterval:2e3,qualityAdjustStep:.1,autoUpgradeQuality:!0,onlyUpdateWhenSwitchScene:!0},LazyTexture32Bit:!1},Ou={},_u={ENV:"development",Notification:{Enable:!1},Ads:{Enabled:!0,Mockup:{Enable:!1,ErrorRate:5,GiphyApiKey:"VmjHIRsfrwCAssDS4mDo9DoImxJm1lLM"},RewardAdOptions:{pID:"123"},InterstitialAdOptions:{pID:"456"},BannerAdOptions:[{placementId:"789",bannerHeight:50,platform:"MOBILE",secondsReload:0},{placementId:"012",bannerHeight:50,platform:"DESKTOP",secondsReload:0}]},Analytics:{GoogleAnalytics:null,FacebookAnalytics:null},Statistics:{ShowFPSInGame:!0},Tournament:{UseMock:!0}},Ru={},xu={ENV:"production",ApiHost:"",OtherHost:"",Notification:{Enable:!1},LeadersBoard:{Prefix:"leaderboards",LeaderboardId:""},Debugger:{ShowInspector:!1,ShowMonitoring:!1,ShowConsole:!1},Statistics:{Enable:!1,ShowFPSInGame:!1,ShowMemoryInGame:!1},Tournament:{RequestTournamentBeforeInterstitialAd:!1}};let ze=vu;const Du="production";switch(Du){case"development":ze=Ie({...ze},_u),ze=Ie({...ze},Ou);break;case"production":ze=Ie({...ze},xu),ze=Ie({...ze},Ru);break}window._forcePixelRatio!=null&&(ze.Game.ForcePixelRatio=window._forcePixelRatio);const Io=ze,Bu=i=>e=>{try{const{game:t}=window,{module:s}=e;if(t.scene.getScenes(!0)[0].scene.key!==i)return;const r=s.default;t.scene.remove(i),t.scene.add(i,r,!0),t.scene.bringToTop(t.globalScene),console.log("%c HotScene: ","font-size:12px;background-color: #465975;color:#fff;",i)}catch{}};function Os(i,e,t){var s,n,a;e===void 0&&(e=50),t===void 0&&(t={});var r=(s=t.isImmediate)!=null&&s,c=(n=t.callback)!=null&&n,o=t.maxWait,l=Date.now(),h=[];function d(){if(o!==void 0){var p=Date.now()-l;if(p+e>=o)return o-p}return e}var u=function(){var p=[].slice.call(arguments),g=this;return new Promise(function(m,E){var f=r&&a===void 0;if(a!==void 0&&clearTimeout(a),a=setTimeout(function(){if(a=void 0,l=Date.now(),!r){var S=i.apply(g,p);c&&c(S),h.forEach(function(T){return(0,T.resolve)(S)}),h=[]}},d()),f){var y=i.apply(g,p);return c&&c(y),m(y)}h.push({resolve:m,reject:E})})};return u.cancel=function(p){a!==void 0&&clearTimeout(a),h.forEach(function(g){return(0,g.reject)(p)}),h=[]},u}let Is=!1;const ku=(i,e=Is)=>t=>{try{const{game:s}=window,{module:n}=t;let r=s.scene.getScenes(!0)[0];if(r.scene.key!==i)return;Is=e;const c=n.default,o=`${i}-draft`;s.scene.remove(o);const l=s.scene.add(o,c);console.log("%c HotSceneObjects: ","font-size:12px;background-color: #465975;color:#fff;",i),r=s.scene.getScene(i),l.events.once(Phaser.Scenes.Events.RENDER,Os(()=>{const h=l.children.getAll();Po(r,h),s.scene.remove(o)}),50),s.scene.run(o),s.scene.bringToTop(r),s.scene.bringToTop(s.globalScene)}catch(s){console.warn(s)}},Po=(i,e,t)=>{e.forEach(s=>{if(!s.name)return;let n=null;if(t?n=t.getByName(s.name):n=i.children.getByName(s.name),Is&&console.log("%c Checking object: ","font-size:12px;background-color: #465975;color:#fff;",s.name,s.type),!n)return;if(s.type==="Container"){const o=s,l=n,h=o.getAll();if(Po(i,h,l),!l.hotContainer)return;console.log("%c Update container: ","font-size:12px;background-color: #33A5FF;color:#fff;",l.name)}const a=Reflect.ownKeys(s),r=["_events","_sysEvents","input","localTransform","list","displayList"],c=a.filter(o=>{if(typeof o!="string"||r.indexOf(o)>=0||!n)return!1;const l=Reflect.get(s,o);if(l instanceof Function||l instanceof Phaser.Scene||l instanceof Phaser.GameObjects.Group||l instanceof Phaser.GameObjects.GameObject)return!1;const h=Reflect.get(n,o);return l===h});c.length<1||(Is&&console.log("%c HotObject: ","font-size:12px;background-color: #2EAFB0;color:#fff;",s.name,c),c.forEach(o=>{if(!n)return;const l=Reflect.get(s,o),h=Reflect.get(n,o),d=Reflect.set(n,o,l);Is&&console.log("%c Update property: ","font-size:12px;background-color: #B03734;color:#fff;",d,o,{oldValue:h,newValue:l})}))})},Nu={Scene:Bu,SceneObjects:ku},Mu={Configs:Io,Utils:To,LiveUpdate:Nu};window.GameCore=Mu;const Lu="production";console.warn(Lu,{Configs:Io,isDebugger:To.Valid.isDebugger()});const Gu="null",Fu=Gu!=="null",Uu=()=>{const i=setInterval(()=>{window.Sentry&&(clearInterval(i),console.warn({isSentryEnabled:Fu}))},100)},wi=(i,e)=>{window.Sentry&&window.Sentry.addBreadcrumb({category:i,message:e})},Yu=i=>{window.Sentry&&window.Sentry.setUser(i)},vo=i=>{{console.error(i);return}},kn=(i,e)=>{i&&window.Sentry.withScope(t=>{t.setExtras(e),vo(i)})},K=i=>{if(!i){console.warn(i);return}vo(i)},Hu="modulepreload",zu=function(i,e){return new URL(i,e).href},Da={},pt=function(e,t,s){if(!t||t.length===0)return e();const n=document.getElementsByTagName("link");return Promise.all(t.map(a=>{if(a=zu(a,s),a in Da)return;Da[a]=!0;const r=a.endsWith(".css"),c=r?'[rel="stylesheet"]':"";if(!!s)for(let h=n.length-1;h>=0;h--){const d=n[h];if(d.href===a&&(!r||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${c}`))return;const l=document.createElement("link");if(l.rel=r?"stylesheet":Hu,r||(l.as="script",l.crossOrigin=""),l.href=a,document.head.appendChild(l),r)return new Promise((h,d)=>{l.addEventListener("load",h),l.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>e())},V={BUTTON_CLICK:"button_click",SCREEN_OPEN:"screen_open",LOAD_START:"load_start",LOAD_COMPLETE:"load_complete",APP_READY:"app_ready",TUTORIAL_BEGIN:"tutorial_begin",TUTORIAL_STEP:"tutorial_step",TUTORIAL_COMPLETE:"tutorial_complete",MATCH_START:"match_start",MATCH_RESCUE:"match_rescue",MATCH_END:"match_end",LEVEL_START:"level_start",LEVEL_RESCUE:"level_rescue",LEVEL_END:"level_end",SHARE:"share",INVITE:"invite",MESSAGE:"message",SHORTCUT_CREATE:"shortcut_create",SHORTCUT_CREATE_POPUP:"shortcut_create_popup",BOT_SUBSCRIBE:"bot_subscribe",BOT_SUBSCRIBE_POPUP:"bot_subscribe_popup",AD_SHOW:"ad_show",AD_SHOW_FAILED:"ad_show_failed",NEW_USER:"new_user",AD_IMPRESSION:"ad_impression",JOIN_GROUP:"join_group",TOURNAMENT_SHARE:"tournament_share",TOURNAMENT_CREATE:"tournament_create",TOURNAMENT_POST_SCORE:"tournament_post_score",GLANCE_GAME_LOAD:"game_load",GLANCE_GAME_START:"game_start",GLANCE_GAME_REPLAY:"game_replay",GLANCE_GAME_LEVEL:"game_level",GLANCE_GAME_END:"game_end",GLANCE_GAME_LEVEL_COMPLETED:"level_completed",GLANCE_REWARDED_AD:"rewarded_ad",GLANCE_GAME_MILESTONE:"game_milestone",GLANCE_GAME_LIFE_END:"game_life_end",GLANCE_INGAME_TRANSACTIONS:"ingame_transactions"},Yi=GameCore.Utils.Image.getImageScale(),$={AVATAR:{KEY:"avatar",FILE:"./assets/images/others/avatar.jpg",CONFIG:{}},ICON_EARTH:{KEY:"icon-earth",FILE:"./assets/images/others/icon-earth.png",CONFIG:{}},BACKGROUND:{KEY:"bg",FILE:`./assets/images/${Yi}x/bg.jpg`,CONFIG:{}},GAME_BACKGROUND:{KEY:"bg-game",FILE:`./assets/images/${Yi}x/bg-game.jpg`,CONFIG:{}},OTHER_BACKGROUND:{KEY:"bg-other",FILE:`./assets/images/${Yi}x/bg-other.jpg`,CONFIG:{}}};class Ht{playerId;name;photo;locale;constructor(e,t,s,n){this.playerId=e,this.name=t,this.photo=s||$.AVATAR.FILE,this.locale=n||"en_US"}toObject(){return{playerId:this.playerId,name:this.name,photo:this.photo,locale:this.locale}}}const Oo=i=>new Promise(e=>setTimeout(e,i)),fn=i=>{const e=new Date(i),t=new Date;return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()},di=(i,e=!0)=>{const t=new Date(i).toISOString();return e?t.slice(11,-5):t.slice(14,-5)},{Notification:Wu}=GameCore.Configs,{GameTitle:Vu,GameImage:Ku}=Wu;class $u{async createAsync(e){return await GameSDK.tournament.createAsync(e)}async shareAsync(e){await GameSDK.tournament.shareAsync(e)}async joinAsync(e){return await GameSDK.tournament.joinAsync(e)}async postScoreAsync(e){await FBInstant.tournament.postScoreAsync(e),window.game.analytics.event(V.TOURNAMENT_POST_SCORE,{score:!0})}async getTournamentsAsync(){return await GameSDK.tournament.getTournamentsAsync()}}class ju{facebook;isCalledSubscribeBot=!1;isCalledCreateShortcut=!1;constructor(e){this.facebook=e}async switchAsync(e){await GameCore.Utils.Valid.isValueChangeAsync(window.__fbGameReady,!0),await GameSDK.context.switchAsync(e)}async chooseAsync(){try{return await GameCore.Utils.Valid.isValueChangeAsync(window.__fbGameReady,!0),await GameSDK.context.chooseAsync({filters:["INCLUDE_EXISTING_CHALLENGES"],minSize:2,maxSize:2}),GameSDK.context.getID()}catch(e){if(e instanceof Object&&GameCore.Utils.Object.hasOwn(e,"code"))switch(e.code){case"USER_INPUT":return!1;case"SAME_CONTEXT":return GameSDK.context.getID()}return null}}async createAsync(e){try{return await GameCore.Utils.Valid.isValueChangeAsync(window.__fbGameReady,!0),await GameSDK.context.createAsync(`${e}`),GameSDK.context.getID()}catch(t){if(t instanceof Object&&GameCore.Utils.Object.hasOwn(t,"code"))switch(t.code){case"USER_INPUT":return!1;case"SAME_CONTEXT":return GameSDK.context.getID()}return null}}async getPlayerToken(){return(await GameSDK.player.getSignedPlayerInfoAsync()).getSignature()}async getContextPlayers(e){try{const t=await GameSDK.context.getPlayersAsync(),s=[];return t.forEach(n=>{const a=n.getID();if(a===e)return;const r=n.getName();if(!r)return;const c=n.getPhoto();s.push(new Ht(a,r,c).toObject())}),GameCore.Utils.Array.unique(s)}catch(t){return console.warn("getPlayersAsync",{error:t}),[]}}async shareAsync(e){await GameSDK.shareAsync(e)}async sendMessage(e){}async inviteAsync(e){}async postSessionScoreAsync(e){await GameSDK.postSessionScoreAsync(e)}async getRewardedVideoAsync(e){return await GameSDK.getRewardedVideoAsync(e)}async getInterstitialAdAsync(e){return await GameSDK.getInterstitialAdAsync(e)}getContextID(){return GameSDK.context.getID()}async attemptToAddShortcut(){if(this.isCalledCreateShortcut)return!1;try{if(GameSDK.getPlatform()==="ANDROID")return!1;const s=(await GameSDK.player.getDataAsync(["lastCallCreateShortcut"])||{}).lastCallCreateShortcut;if(s&&fn(+s))return!1;const n=Date.now();if(GameSDK.player.setDataAsync({lastCallCreateShortcut:n}),!GameSDK.getSupportedAPIs().includes("canCreateShortcutAsync"))return!1;if(await GameSDK.canCreateShortcutAsync()){const{SHORTCUT_CREATE:c,SHORTCUT_CREATE_POPUP:o}=V;this.isCalledCreateShortcut=!0,window.game.analytics.event(o);try{return await GameCore.Utils.Valid.isValueChangeAsync(window.__fbGameReady,!0),await GameSDK.createShortcutAsync(),window.game.analytics.event(c,{success:!0}),!0}catch{return window.game.analytics.event(c,{success:!1}),!1}}return!1}catch{return!1}}async attemptToSubscribeBot(){if(this.isCalledSubscribeBot)return!1;try{if(!GameSDK.getSupportedAPIs().includes("player.canSubscribeBotAsync"))return!1;if(await GameSDK.player.canSubscribeBotAsync()){const n=(await GameSDK.player.getDataAsync(["lastCallSubscribeBot"])||{}).lastCallSubscribeBot;if(n&&fn(+n))return!1;const a=Date.now();GameSDK.player.setDataAsync({lastCallSubscribeBot:a});const{BOT_SUBSCRIBE:r,BOT_SUBSCRIBE_POPUP:c}=V;this.isCalledSubscribeBot=!0,window.game.analytics.event(c);try{return await GameCore.Utils.Valid.isValueChangeAsync(window.__fbGameReady,!0),await GameSDK.player.subscribeBotAsync(),window.game.analytics.event(r,{success:!0}),!0}catch{return window.game.analytics.event(r,{success:!1}),!1}}return!1}catch{return!1}}async matchPlayerAsync(e,t,s){try{return!GameSDK.getSupportedAPIs().includes("checkCanPlayerMatchAsync")||!await GameSDK.checkCanPlayerMatchAsync()?!1:(await GameSDK.matchPlayerAsync(e,t,s),!0)}catch{return!1}}setLoadingProgress(e){GameSDK.setLoadingProgress(e)}getLocale(){return GameSDK.getLocale()||"en"}async injectTournament(){this.facebook.tournament=new $u,this.facebook.getTournamentAsync=this.getTournamentAsync,this.facebook.createTournamentAsync=this.createTournamentAsync}async getTournamentAsync(){return await GameSDK.getTournamentAsync()}createTournamentAsync=async(e,t)=>{const{analytics:s}=window.game,a=`${FBInstant.player.getName()||"Player"}'s Tournament`;try{await this.facebook.tournament.createAsync({initialScore:e,config:{tournamentTitle:a},data:t}),s.event(V.TOURNAMENT_CREATE,{success:!0})}catch{s.event(V.TOURNAMENT_CREATE,{success:!1})}};async sendNotificationAsync(e){try{const{message:t,delayTime:s}=e;await GameSDK.graphApi.requestAsync("/me/notifications","POST",{message:JSON.stringify({title:Vu,body:t,media_url:Ku}),schedule_interval:s})}catch(t){console.warn("ðŸ¤– ? sendNotificationAsync",t)}}}let Ba=0,Le=0;class Xu{game;progressFbTimeEvent;constructor(e){this.game=e}loadingProgressFbBootScene(){let n=100;Le=30;const a=()=>{if(n<=0){clearTimeout(this.progressFbTimeEvent);return}this.progressFbTimeEvent=setTimeout(()=>{this.game.facebook.setLoadingProgress(Math.round(Le)),Le+=30/n,n--,a()},50)};a()}finishLoadingProgressFbBootScene(){clearTimeout(this.progressFbTimeEvent)}loadingProgressFbLoadScene(){(!Le||Le<30)&&(Le=60),Ba=Le;const t=()=>{this.progressFbTimeEvent=setTimeout(()=>{this.game.facebook.setLoadingProgress(Math.round(Le)),Le+=.1,t()},50)};t()}onProgress(e){const t=100-Le,s=Math.round(e*t+Le);s>Ba&&clearTimeout(this.progressFbTimeEvent),this.game.facebook.setLoadingProgress(s)}}class qu{addKillRevive(){[Phaser.GameObjects.Container,Phaser.GameObjects.Image,Phaser.GameObjects.Sprite,Phaser.GameObjects.Graphics,Phaser.GameObjects.Text,Phaser.GameObjects.BitmapText,Phaser.GameObjects.Particles.ParticleEmitter,Phaser.GameObjects.Particles.ParticleEmitterManager].forEach(e=>{e.prototype.kill=this.kill,e.prototype.revive=this.revive})}addKillReviveGroup(){Phaser.GameObjects.Group.prototype.killGroup=this.killGroup,Phaser.GameObjects.Group.prototype.reviveGroup=this.reviveGroup}addSetWorldSize(){[Phaser.GameObjects.Image,Phaser.GameObjects.Sprite,Phaser.GameObjects.Rope].forEach(e=>{e.prototype.setWorldSize=this.setWorldSize})}addSetWorldSizeForContainer(){[Phaser.GameObjects.Container].forEach(e=>{e.prototype.setWorldSize=this.setWorldSizeForContainer})}addGetWorldPosition(){[Phaser.GameObjects.Container,Phaser.GameObjects.Image,Phaser.GameObjects.Sprite,Phaser.GameObjects.Graphics,Phaser.GameObjects.Text,Phaser.GameObjects.BitmapText].forEach(e=>{e.prototype.getWorldPosition=this.getWorldPosition})}addDrawDebugBox(){[Phaser.GameObjects.Container,Phaser.GameObjects.Image,Phaser.GameObjects.Sprite,Phaser.GameObjects.Graphics,Phaser.GameObjects.Text,Phaser.GameObjects.BitmapText,Phaser.GameObjects.Zone].forEach(e=>{e.prototype.drawDebugBox=this.drawDebugBox})}addHighQuality(){[Phaser.GameObjects.Text].forEach(e=>{e.prototype.setHighQuality=this.setHighQuality})}addSetLineHeightForBitmapText(){Phaser.GameObjects.BitmapText.prototype.setLineHeight=function(e){this.lineHeight=e,this.updateDisplayOrigin()}}kill(){this.setActive(!1),this.setVisible(!1)}revive(){this.setActive(!0),this.setVisible(!0)}killGroup(){this.getChildren().forEach(e=>{e.setActive(!1),e.setVisible(!1)})}reviveGroup(){this.getChildren().forEach(e=>{e.setActive(!0),e.setVisible(!0)})}setWorldSize(e,t){this.setSize(e,t),this.setDisplaySize(e,t)}setWorldSizeForContainer(e,t,s=2){this.setSize(e*s,t*s),this.setDisplaySize(e,t)}getWorldPosition(){const e=this.getWorldTransformMatrix(),{translateX:t,translateY:s}=e.decomposeMatrix();return{x:t,y:s}}drawDebugBox(e,t){const{x:s,y:n,width:a,height:r,depth:c,originX:o,originY:l}=this,h=this.scene.add.rectangle(s,n,a,r,e,t);h.setName("Debug Box"),h.setDepth(c);const{isNumber:d}=GameCore.Utils.Valid;return d(o)&&d(l)&&h.setOrigin(o,l),h}setHighQuality(){return this.renderer instanceof Phaser.Renderer.WebGL.WebGLRenderer?this.setResolution(this.scene.game.world.getZoomRatio()*2):this}}const yn={LOADED:"loaded",DISPLAYED:"displayed"};var _o=(i=>(i.IDLE="idle",i.LOADING="loading",i.FILLED="filled",i.SHOWING="showing",i))(_o||{});const Ro=_o;var xo=(i=>(i.REWARDED="rewarded",i.INTERSTITIAL="interstitial",i))(xo||{});const Fe=xo;class Tt extends Error{code;constructor(e,t){super(t),this.code=e,this.message=t}}class Zu{type;status;constructor(e){this.type=e,this.status=Ro.IDLE}}GameCore.Ads={Types:Fe,Status:Ro,Events:yn,AdError:Tt,AdInstance:Zu};class Ju extends Phaser.Plugins.BasePlugin{events;enabled;config;lastInterAdShownTime;lastRewardAdShownTime;interstitialAd;rewardedVideo;safeAreaBottom;showingBannerAd;reloadBannerAdIntervals;bannerAdConfig;isHaveBannerAdOptions;init(){this.events=new Phaser.Events.EventEmitter,this.safeAreaBottom=0,this.lastInterAdShownTime=0,this.lastRewardAdShownTime=0,this.showingBannerAd={},this.reloadBannerAdIntervals={},this.isHaveBannerAdOptions=!0}calculateSafeAreaBottom(){try{if(!this.config.calculateSafeAreaBottom)return;this.safeAreaBottom=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--sab")),isNaN(this.safeAreaBottom)&&(this.safeAreaBottom=0)}catch{this.safeAreaBottom=0}}configure(e,t){this.enabled=t.enabled,this.config=t;const{bannerAdOptions:s}=this.config;s.length===0&&(this.isHaveBannerAdOptions=!1),this.setAdInstance(e),this.calculateSafeAreaBottom()}setAdInstance(e){const{rewardAdOptions:t,interstitialAdOptions:s}=this.config;this.interstitialAd=new e(Fe.INTERSTITIAL,t.pID),this.rewardedVideo=new e(Fe.REWARDED,s.pID)}async preloadInterstitialAdAsync(){console.log("preloading Interstitial"),await this.preloadAdAsync(Fe.INTERSTITIAL)}async showInterstitialAdAsync(){if(!this.canbeShowInterstitialAd())throw new Tt("INTERSTITIAL_AD_CAN_NOT_SHOW","Can't show interstitial ad");await this.showAdAsync(Fe.INTERSTITIAL)}async preloadRewardedVideoAsync(){console.log("preloading RewardedVideo"),await this.preloadAdAsync(Fe.REWARDED)}async showRewardedVideoAsync(){if(!this.canbeShowRewardAd())throw new Tt("REWARDED_VIDEO_CAN_NOT_SHOW","Can't show rewarded video");await this.showAdAsync(Fe.REWARDED),this.lastRewardAdShownTime=window.performance.now()/1e3}getRemainingRewardTime(){const e=window.performance.now()/1e3,{secondsBetweenAds:t}=this.config.rewardAdOptions,s=e-this.lastRewardAdShownTime;return s<t?t-s:0}async preloadAdAsync(e){if(!this.enabled)throw new Tt("ADS_NOT_ENABLED","Ads is't enabled");const t=this.getAdInstanceByType(e);if(t===null)throw new Tt("AD_INSTANCE_NOT_INITIATED","The instance ads not yet initiated");await t.loadAsync(),this.events.emit(yn.LOADED,e)}async showAdAsync(e){if(!this.enabled)throw new Tt("ADS_NOT_ENABLED","Ads is't enabled");const t=this.getAdInstanceByType(e);if(t===null)throw new Tt("AD_INSTANCE_NOT_INITIATED","The instance ads not yet initiated");if(e===Fe.INTERSTITIAL&&(this.lastInterAdShownTime=window.performance.now()/1e3),e===Fe.REWARDED){this.lastRewardAdShownTime=window.performance.now()/1e3;const{enableRewardVideoResetInterstitial:s}=this.config;s&&(this.lastInterAdShownTime=this.lastRewardAdShownTime)}await t.showAsync(),this.events.emit(yn.DISPLAYED,e)}getAdStatus(e){const t=this.getAdInstanceByType(e);return t?t.getStatus():null}getAdInstanceByType(e){switch(e){case Fe.INTERSTITIAL:return this.interstitialAd;case Fe.REWARDED:return this.rewardedVideo;default:return null}}canbeShowInterstitialAd(){return this.canbeShowInterstitialAdByTime()}canbeShowInterstitialAdByTime(){const e=window.performance.now()/1e3,{secondsFirstTime:t,secondsBetweenAds:s}=this.config.interstitialAdOptions,n=Math.floor(e-this.lastInterAdShownTime);return this.lastInterAdShownTime>0?n>=s:n>=t}canbeShowRewardAd(){const e=window.performance.now()/1e3,{secondsFirstTime:t,secondsBetweenAds:s}=this.config.rewardAdOptions,n=Math.floor(e-this.lastRewardAdShownTime);return this.lastRewardAdShownTime>0?n>=s:n>=t}canShowBannerAd(){if(!this.isHaveBannerAdOptions)return!1;const{bannerAdOptions:e}=this.config,t=GameCore.Utils.Device.isDesktop();for(let s=0;s<e.length;s++){const n=e[s],a=n.platform;if(a=="ALL"||a=="DESKTOP"&&t||a=="MOBILE"&&!t)return this.bannerAdConfig=n,!0}return!1}async showBannerAdAsync(){if(!this.enabled||!this.canShowBannerAd())return;this.reloadBannerAdIntervals=this.reloadBannerAdIntervals||{};const{placementId:e,secondsReload:t}=this.bannerAdConfig;if(!(!e||e=="")){if(t>0){if(this.reloadBannerAdIntervals[e])return;this.loadBannerAdAsync(e),this.reloadBannerAdIntervals[e]=setInterval(()=>{this.loadBannerAdAsync(e)},t*1e3);return}this.loadBannerAdAsync(e)}}async loadBannerAdAsync(e){if(this.enabled)try{if(!this.enabled)return;await GameSDK.loadBannerAdAsync(e),this.showingBannerAd[e]=!0}catch(t){console.log(t)}}async hideBannerAdAsync(){if(this.enabled&&this.isHaveBannerAdOptions)try{if(!this.enabled)return;const{bannerAdOptions:e}=this.config;e.forEach(t=>{const{placementId:s}=t,n=this.reloadBannerAdIntervals[s];n&&(clearInterval(n),this.reloadBannerAdIntervals[s]=null),this.showingBannerAd[s]=!1}),await GameSDK.hideBannerAdAsync()}catch(e){console.log(e)}}getBannerHeight(){if(!this.enabled||!this.canShowBannerAd())return 0;const{bannerHeight:e=0}=this.bannerAdConfig||{},t=e+this.safeAreaBottom;if(this.game.world){const s=this.game.world,n=s.getPixelRatio(),a=s.getZoomRatio(),r=s.getScreenHeight()*.01;return this.game.world.getPhysicPixels(t+r,n/a)}return t}}class Qu{name;color;selfLog;options;constructor(e,t,s){this.name=e,this.color=s||"#FFF",this.options=t,this.selfLog=!0,console.info(`%c${this.name}: init`,`color: ${this.color}`,this.options)}event(e,t,s){this.processEvent(e,t,s),this.selfLog&&console.info(`%c${this.name}: event`,`color: ${this.color}`,{name:e,value:s,payload:t})}pageview(e){const t=this.getPageByKey(e);this.processPageView(t),this.selfLog&&console.info(`%c${this.name}: pageview`,`color: ${this.color}`,{page:t})}levelStart(e,t,s){this.processLevelStart(e,t,s),this.selfLog&&console.info(`%c${this.name}: level start`,`color: ${this.color}`,{level:e,score:t,levelName:s})}levelFail(e,t,s){this.processLevelFail(e,t,s),this.selfLog&&console.info(`%c${this.name}: level fail`,`color: ${this.color}`,{level:e,score:t,levelName:s})}levelRescue(e,t,s){this.processLevelRescue(e,t,s),this.selfLog&&console.info(`%c${this.name}: level rescue`,`color: ${this.color}`,{level:e,score:t,levelName:s})}levelComplete(e,t,s){this.processLevelComplete(e,t,s),this.selfLog&&console.info(`%c${this.name}: level complete`,`color: ${this.color}`,{level:e,score:t,levelName:s})}showInterstitialAd(e){this.processShowInterstitialAd(e),this.selfLog&&console.info(`%c${this.name}: show interstitial ad`,`color: ${this.color}`,{placement:e})}showRewardedVideoAd(e){this.processShowRewardedVideoAd(e),this.selfLog&&console.info(`%c${this.name}: show rewarded video ad`,`color: ${this.color}`,{placement:e})}receiveReward(e){this.processReceiveReward(e),this.selfLog&&console.info(`%c${this.name}: receive reward`,`color: ${this.color}`,{placement:e})}showAdFail(e,t,s){this.processShowAdFail(e,t,s),this.selfLog&&console.info(`%c${this.name}: show ad fail`,`color: ${this.color}`,{type:e,placement:t,reason:s})}gameMilestone(e,t,s,n){this.processGameMilestone(e,t,s,n),this.selfLog&&console.info(`%c${this.name}: game milestone`,`color: ${this.color}`,{type:e,meta:t,level:s,score:n})}gameLifeEnd(e,t,s){this.processGameLifeEnd(e,t,s),this.selfLog&&console.info(`%c${this.name}: game life end`,`color: ${this.color}`,{remainingLife:e,level:t,score:s})}gameIngameTransactions(e,t,s,n){this.gameIngameTransactions(e,t,s,n),this.selfLog&&console.info(`%c${this.name}: ingame transaction`,`color: ${this.color}`,{transactionType:e,meta:t,level:s,score:n})}getPageByKey(e){let t=e.replace(/_/g,"-");return t=t.toLowerCase(),t}processLevelStart(e,t,s){}processLevelFail(e,t,s){}processLevelRescue(e,t,s){}processLevelComplete(e,t,s){}processShowInterstitialAd(e){}processShowRewardedVideoAd(e){}processReceiveReward(e){}processShowAdFail(e,t,s){}processGameMilestone(e,t={},s=0,n=0){}processGameLifeEnd(e,t=0,s=0){}processIngameTransactions(e,t={},s=0,n=0){}}GameCore.Analytics={BaseAnalytics:Qu};class ed extends Phaser.Plugins.BasePlugin{analytics;init(){this.analytics=[]}add(e){this.analytics.push(e)}pageview=e=>{this.isActive()&&this.analytics.forEach(t=>{t.pageview(e)})};event(e,t,s){this.isActive()&&this.analytics.forEach(n=>{n.event(e,t,s)})}levelStart(e,t,s){this.isActive()&&this.analytics.forEach(n=>{n.levelStart(e,t,s)})}levelRescue(e,t,s){this.isActive()&&this.analytics.forEach(n=>{n.levelRescue(e,t,s)})}levelFail(e,t,s){this.isActive()&&this.analytics.forEach(n=>{n.levelFail(e,t,s)})}levelComplete(e,t,s){this.isActive()&&this.analytics.forEach(n=>{n.levelComplete(e,t,s)})}showInterstitialAd(e){this.isActive()&&this.analytics.forEach(t=>{t.showInterstitialAd(e)})}showRewardedVideoAd(e){this.isActive()&&this.analytics.forEach(t=>{t.showRewardedVideoAd(e)})}showRewardedInterstitial(e){this.isActive()&&this.analytics.forEach(t=>{t.showRewardedVideoAd(e)})}receiveReward(e){this.isActive()&&this.analytics.forEach(t=>{t.receiveReward(e)})}showAdFail(e,t,s){this.isActive()&&this.analytics.forEach(n=>{n.showAdFail(e,t,s)})}gameMilestone(e,t,s,n){this.isActive()&&this.analytics.forEach(a=>{a.gameMilestone(e,t,s,n)})}gameLifeEnd(e,t,s){this.isActive()&&this.analytics.forEach(n=>{n.gameLifeEnd(e,t,s)})}gameIngameTransactions(e,t,s,n){this.isActive()&&this.analytics.forEach(a=>{a.gameIngameTransactions(e,t,s,n)})}isActive(){return this.analytics.length>=1}}class td{name;game;audio;volume;constructor(e,t){this.name=t,this.game=e,this.audio=this.game.sound.add(this.name)}play(e,t){const s={volume:this.volume,...t||{}};if(s.volume!==this.volume&&(s.volume*=this.volume),this.audio?.seek>0){this.audio.resume();return}this.audio?.play(e,s)}pause(e){this.audio?.pause()}stop(e){this.audio?.stop()}setVolume(e){this.volume=e}isMusicEnabled=()=>{const{player:e}=this.game;return!!e.getPlayerSetting("music")};isSoundEnabled=()=>{const{player:e}=this.game;return!!e.getPlayerSetting("sound")}}class sd{game;markers;volume;constructor(e){this.game=e,this.markers={}}play(e,t){const s={volume:this.volume,...t||{}};s.volume!==this.volume&&(s.volume*=this.volume),this.createMaker(e),this.markers[e]?.play()}pause(e){this.markers[e]?.pause()}stop(e){this.markers[e]?.stop()}setVolume(e){this.volume=e}isMusicEnabled=()=>{const{player:e}=this.game;return!!e.getPlayerSetting("music")};isSoundEnabled=()=>{const{player:e}=this.game;return!!e.getPlayerSetting("sound")};createMaker(e){if(!this.markers[e])try{this.markers[e]=this.game.sound.add(e)}catch(t){console.warn("createMaker",t)}}}class id extends Phaser.Plugins.BasePlugin{soundManager;musicManager;isMuteAll;init(e){super.init(e),this.initSound()}initMusic=e=>{this.musicManager=new td(this.game,e),this.setMusicVolume(1)};initSound=()=>{this.soundManager=new sd(this.game),this.setSoundVolume(1)};playSound(e,t){try{if(!this.soundManager||this.isMuteAll||!this.game.visibility.isGameVisible()||!this.soundManager.isSoundEnabled())return;this.soundManager.play(e,t)}catch{}}stopSound(e){try{this.soundManager.stop(e)}catch{}}playMusic(e={}){try{if(!this.musicManager||this.isMuteAll||!this.game.visibility.isGameVisible()||!this.musicManager.isMusicEnabled())return;this.musicManager.play("",{loop:!0,volume:.2,...e})}catch{}}pauseMusic(){try{if(!this.musicManager)return;this.musicManager.pause("")}catch{}}stopMusic(){try{if(!this.musicManager)return;this.musicManager.stop("")}catch{}}setSoundVolume(e){try{if(!this.soundManager)return;this.soundManager.setVolume(e)}catch(t){console.warn("setSoundVolume",t)}}setMusicVolume(e){try{if(!this.musicManager)return;this.musicManager.setVolume(e)}catch(t){console.warn("setMusicVolume",t)}}muteAll(){this.isMuteAll=!0,this.game.sound.mute=!0}unmuteAll(){this.isMuteAll=!1,this.game.sound.mute=!1}}const Do="AUTH_TOKEN_REQUEST",Bo="AUTH_TOKEN_RECEIVED";class nd extends Error{payload;constructor(e,t){super(e),this.name="RequestTokenFail",this.message=e||"Request token fail",this.payload=t||{}}}var pi="NOT_FOUND";function ad(i){var e;return{get:function(s){return e&&i(e.key,s)?e.value:pi},put:function(s,n){e={key:s,value:n}},getEntries:function(){return e?[e]:[]},clear:function(){e=void 0}}}function rd(i,e){var t=[];function s(c){var o=t.findIndex(function(h){return e(c,h.key)});if(o>-1){var l=t[o];return o>0&&(t.splice(o,1),t.unshift(l)),l.value}return pi}function n(c,o){s(c)===pi&&(t.unshift({key:c,value:o}),t.length>i&&t.pop())}function a(){return t}function r(){t=[]}return{get:s,put:n,getEntries:a,clear:r}}var od=function(e,t){return e===t};function cd(i){return function(t,s){if(t===null||s===null||t.length!==s.length)return!1;for(var n=t.length,a=0;a<n;a++)if(!i(t[a],s[a]))return!1;return!0}}function ld(i,e){var t=typeof e=="object"?e:{equalityCheck:e},s=t.equalityCheck,n=s===void 0?od:s,a=t.maxSize,r=a===void 0?1:a,c=t.resultEqualityCheck,o=cd(n),l=r===1?ad(o):rd(r,o);function h(){var d=l.get(arguments);if(d===pi){if(d=i.apply(null,arguments),c){var u=l.getEntries(),p=u.find(function(g){return c(g.value,d)});p&&(d=p.value)}l.put(arguments,d)}return d}return h.clearCache=function(){return l.clear()},h}function hd(i){var e=Array.isArray(i[0])?i[0]:i;if(!e.every(function(s){return typeof s=="function"})){var t=e.map(function(s){return typeof s=="function"?"function "+(s.name||"unnamed")+"()":typeof s}).join(", ");throw new Error("createSelector expects all input-selectors to be functions, but received the following types: ["+t+"]")}return e}function ud(i){for(var e=arguments.length,t=new Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];var n=function(){for(var r=arguments.length,c=new Array(r),o=0;o<r;o++)c[o]=arguments[o];var l=0,h,d={memoizeOptions:void 0},u=c.pop();if(typeof u=="object"&&(d=u,u=c.pop()),typeof u!="function")throw new Error("createSelector expects an output function after the inputs, but received: ["+typeof u+"]");var p=d,g=p.memoizeOptions,m=g===void 0?t:g,E=Array.isArray(m)?m:[m],f=hd(c),y=i.apply(void 0,[function(){return l++,u.apply(null,arguments)}].concat(E)),S=i(function(){for(var b=[],C=f.length,O=0;O<C;O++)b.push(f[O].apply(null,arguments));return h=y.apply(null,b),h});return Object.assign(S,{resultFunc:u,memoizedResultFunc:y,dependencies:f,lastResult:function(){return h},recomputations:function(){return l},resetRecomputations:function(){return l=0}}),S};return n}var G=ud(ld);const Nn="auth",dd=i=>i[Nn].token,pd=i=>i[Nn].isRequesting,ko=G([dd],i=>i),gd=G([pd],i=>i),md=()=>async(i,e)=>{try{const{facebook:t}=window.game,s=e(),n=ko(s);if(gd(s)||n!=="")return;i({type:Do,payload:{}});const r=await t.getPlayerToken();i(ka(r))}catch(t){if(t instanceof Object&&GameCore.Utils.Object.hasOwn(t,"code")&&t.code==="PENDING_REQUEST")return;if(i(ka("")),t instanceof Object&&GameCore.Utils.Object.hasOwn(t,"message")&&typeof t.message=="string"){K(new Error(t.message||"Request token fail"));return}K(new nd)}},ka=i=>({type:Bo,payload:{token:i}});class fd extends Phaser.Plugins.BasePlugin{get state(){return this.game.storage.getState()}async requestToken(){const{storage:e}=this.game;await e.dispatch(md())}getToken(){return ko(this.state)}}const yd='nunito,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif',Ed=(i,e)=>({string:"+",style:"font-size: 1px; padding: "+Math.floor(e/2)+"px "+Math.floor(i/2)+"px;"}),Sd=(i,e=1)=>{const t=new Image;t.onload=function(){const s=Ed(this.width*e,this.height*e);console.info(`%c ${s.string}`,`${s.style} background: transparent url(${i}) no-repeat center center; background-size: ${this.width*e}px ${this.height*e}px;`)},t.src=i};class Ad extends Phaser.Plugins.ScenePlugin{width;height;renderOptions;canvas;preload(e){const t=Object.keys(e);t.length<1||(t.forEach(s=>{this.scene.load.image(s,e[s])}),this.scene.load.start())}async capture(e){const{width:t,height:s,renderOptions:n}=e;return this.width=t,this.height=s,this.renderOptions=n,this.createCanvas(),await this.loadImages(),this.drawObjects(),this.snapshotFrame()}createCanvas(){this.canvas||(this.canvas=this.game.textures.createCanvas("FrameCaptureCanvas")),this.canvas.clear(),this.canvas.setSize(this.width,this.height)}loadImages(){return new Promise((e,t)=>{for(const s in this.renderOptions){const{name:n,image:a}=this.renderOptions[s];!a||this.scene.textures.get(n).key===n||this.scene.load.image(n,a)}this.scene.load.on(Phaser.Loader.Events.COMPLETE,e),this.scene.load.on(Phaser.Loader.Events.FILE_LOAD_ERROR,()=>{const s=new Error("Load image failed");t(s)}),this.scene.load.start()})}drawObjects(){for(const e in this.renderOptions){const t=this.renderOptions[e];switch(t.type){case"text":this.drawText(t);break;case"image":this.drawImage(t);break}}}drawText(e){const{context:t}=this.canvas,{x:s,y:n,font:a,text:r,fillStyle:c,lineWidth:o,textAlign:l}=e;t.font=`${a} ${yd}`,t.fillStyle=c||"#ffffff",o&&(t.lineWidth=o),l&&(t.textAlign=l),t.fillText(r,s,n)}drawImage(e){const{context:t}=this.canvas,{x:s,y:n,name:a,frame:r,width:c,height:o,fallbackWithImage:l}=e;let h=this.scene.textures.get(a),d=h.getSourceImage(r);h.key==="__MISSING"&&l&&(h=this.scene.textures.get(l),d=h.getSourceImage()),t.drawImage(d,s,n,c,o)}snapshotFrame(){const e=this.canvas.getCanvas().toDataURL("image/jpeg",.85);return GameCore.Utils.Valid.isDebugger()&&Sd(e),e}}class bd extends Phaser.Events.EventEmitter{game;options;performance;isRunning=!1;checkTimer;fpsHistory;constructor(e,t,s){super(),this.game=e,this.options=s,this.performance=t}start=()=>{if(this.isRunning)return;this.isRunning=!0;const{checkInterval:e}=this.options;this.checkTimer=e,this.fpsHistory=[],this.game.events.on(Phaser.Core.Events.POST_STEP,this.onPostStep)};stop=()=>{if(!this.isRunning)return;this.isRunning=!1,this.game.events.off(Phaser.Core.Events.POST_STEP,this.onPostStep);const{onlyUpdateWhenSwitchScene:e}=this.options;e&&this.checkFps()};onPostStep=(e,t)=>{if(this.checkTimer-=t,this.checkTimer>0)return;const{checkInterval:s,onlyUpdateWhenSwitchScene:n}=this.options;this.checkTimer+=s,this.fpsHistory.push(this.game.loop.actualFps),n===!1&&this.fpsHistory.length>=5&&this.checkFps()};checkFps(){if(this.fpsHistory.length===0)return;const{autoUpgradeQuality:e}=this.options;let t=!1;this.isLowFps()?t=this.performance.downgradeGraphicsQuality():e&&this.isHighFps()&&(t=this.performance.upgradeGraphicsQuality()),t&&(this.fpsHistory=[])}getFpsMedian(){return Phaser.Math.Median(this.fpsHistory)}isLowFps(){return this.getFpsMedian()<this.options.fpsThreshold}isHighFps(){return this.getFpsMedian()>this.options.fpsThreshold*1.2}}class Td extends Phaser.Plugins.BasePlugin{fpsTracker;pixelRatio;minQuality;maxQuality;qualityAdjustStep;trackingSceneKeys=[];configure(e){const{pixelRatio:t,minQuality:s,maxQuality:n,qualityAdjustStep:a,trackingSceneKeys:r,...c}=e;this.pixelRatio=t,this.minQuality=s,this.maxQuality=n,this.qualityAdjustStep=a,this.trackingSceneKeys=r,this.fpsTracker=new bd(this.game,this,c)}active(){this.game.events.on(Phaser.Scenes.Events.WAKE,this.trackingScene),this.game.events.on(Phaser.Scenes.Events.START,this.trackingScene)}trackingScene=e=>{if(!this.trackingSceneKeys.includes(e))return;const t=this.game.scene.getScene(e);t.events.once(Phaser.Scenes.Events.UPDATE,this.fpsTracker.start),t.events.once(Phaser.Scenes.Events.SLEEP,this.fpsTracker.stop)};downgradeGraphicsQuality(){const e=this.pixelRatio;if(e<=this.minQuality)return!1;const t=+(e-this.qualityAdjustStep).toFixed(2);return t<this.minQuality?!1:(this.pixelRatio=t,this.game.world.resize(this.pixelRatio),console.warn(`ðŸ’« Graphics quality was downgraded! (${e} -> ${t})`),!0)}upgradeGraphicsQuality(){const e=this.pixelRatio;if(e>=this.maxQuality)return!1;const t=+(e+this.qualityAdjustStep).toFixed(2);return t>this.maxQuality?!1:(this.pixelRatio=t,this.game.world.resize(this.pixelRatio),console.warn(`ðŸš€ Graphics quality was upgraded! (${e} -> ${t})`),!0)}}const{DefaultTheme:wd}=GameCore.Configs,_s={sound:!0,music:!0,vibrate:!0,language:"en",theme:wd};class No extends Error{constructor(e,t){super(e,t),this.name="BadRequest",this.message=e||"This request is bad",this.payload=t}}class En extends Error{constructor(e,t){super(e,t),this.name="RequestTimeout",this.message=e||"This request is timeout",this.payload=t}}const{AppId:Cd,Network:Mn}=GameCore.Configs,Id=i=>{if(!i.ok)throw new No(null,{response:i})},Mo=()=>{const i=window.game.auth.getToken();return{token:i,timeout:Mn.Timeout,headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}}},Lo=(i,e,t,s)=>async()=>{try{const n=`${i}/apps/${Cd}/${e}`,a=new AbortController;t.signal=a.signal;const r=setTimeout(()=>{a.abort()},t.timeout);GameCore.Utils.Valid.isObject(s)&&(t.body=JSON.stringify(s));const c=await fetch(n,t);return clearTimeout(r),Id(c),await c.json()||{}}catch(n){if(n instanceof No)return null;throw n instanceof Object&&GameCore.Utils.Object.hasOwn(n,"name")&&n.name==="AbortError"?new En(null):n}},Ln=async(i,e)=>{try{return i()}catch(t){if(t instanceof En&&e>0)try{return await Oo(600),await Ln(i,e-1)}catch{return{}}return t instanceof En?{}:(console.warn(t),{})}},Gs=async(i,e={},t,s=Mn.Retries)=>{if(!t)return{};try{const n={...Mo(),...e,method:"GET"},a=Lo(t,i,n);return await Ln(a,s)}catch(n){return console.warn(n),{}}},Fs=async(i,e,t={},s,n=Mn.Retries)=>{if(!s)return{};try{const a={...Mo(),...t,method:"POST"},r=Lo(s,i,a,e);return await Ln(r,n)}catch(a){return console.warn(a),{}}},{ApiHost:T0}=GameCore.Configs,Us=async i=>null,Pd=async i=>null,Go="PLAYER_RECEIVED",Fo="PLAYER_DATA_UPDATE",Uo="PLAYER_SCORE_UPDATE",Yo="PLAYER_PROFILE_UPDATE",Ho="PLAYER_SETTING_UPDATE",zo="PLAYER_CONNECTED_PLAYERS_UPDATE";class Wo extends Error{payload;constructor(e,t){super(e),this.name="PlayerDataNameNotSupport",this.message=e||"The name of player data is not supported",this.payload=t||{}}}const Ys="player",vd=i=>i[Ys],Od=i=>i[Ys].data,_d=i=>i[Ys].connectedPlayers,Rd=i=>i[Ys].isConnectedPlayersLoaded,xd=(i,e)=>e.limit,Dd=(i,e)=>e.offset,Ci=G([vd],i=>i),Bd=G([Ci],i=>i.playerId),kd=G([Ci],i=>i.ASID),$t=G([Od],i=>i),Nd=G([$t],i=>i.settings),Gn=G([_d],i=>i),Md=G([Rd],i=>i),Ld=G([Gn,xd,Dd],(i,e,t)=>typeof e!="number"?[]:typeof t!="number"?[]:Object.keys(i).slice(t,e+t)||[]),Gd=G([$t],i=>i.score),Fd=G([$t],i=>i.customFields),Ii=i=>{try{const e=localStorage.getItem(i);return e===null?null:GameCore.Utils.Json.decode(e)}catch{return null}},jt=(i,e)=>{try{const t=Ii(i);let s={};GameCore.Utils.Valid.isObject(t)&&(s=t);const n=GameCore.Utils.Json.clone(e);if(!GameCore.Utils.Valid.isObject(n))return!1;const a=GameCore.Utils.Object.clear(n),r=Ie(s,a),c=GameCore.Utils.Json.encode(r);return localStorage.setItem(i,c),!0}catch{return!1}},{AppId:Ud,Tutorial:Yd,PlayerDataStore:Fn}=GameCore.Configs,Hd=(i,e)=>t=>{const{playerId:s,name:n,photo:a,locale:r}=i;t({type:Go,payload:{playerId:s,name:n,photo:a,locale:r,data:e||{}}})},zd=()=>async i=>{try{const{facebook:e}=window.game,t=await new Promise((a,r)=>{e.once("players",c=>{a(c)}),e.once("playersfail",()=>r([])),e.getPlayers()}),s=a=>!!a,n=t.map(a=>{const r=a.getID(),c=a.getName(),o=a.getPhoto();return!r||!c||!o?null:new Ht(r,c,o).toObject()}).filter(s);if(n.length<1)return;i(Vo(n))}catch(e){K(e)}},Vo=i=>({type:zo,payload:{connectedPlayers:i}}),Wd=(i,e)=>async(t,s)=>{try{await t({type:Ho,payload:{name:i,value:e}});const n=s(),r={settings:{...Nd(n),[i]:e}};jt(Fn,r),Us(r)}catch(n){K(n)}},Vd=()=>async(i,e)=>{try{const t=e(),s=Ci(t),{playerId:n,name:a,photo:r,locale:c}=s,o=await FBInstant.player.getASIDAsync(),l={appId:Ud,playerId:n,name:a,photo:r,locale:c,ASID:o};await i({type:Yo,payload:{profile:l}}),await Us(l)}catch(t){K(t)}},Kd=(i,e)=>async(t,s)=>{try{const n={customFields:{[i]:e}};await t(Un(n));const a=s(),c={...$t(a)};Us(c)}catch(n){if(n instanceof Wo)return;K(n)}},$d=i=>async(e,t)=>{try{await e(Un({customFields:i}));const n=t(),r={...$t(n)};Us(r)}catch(s){if(console.log("ðŸ¤– ? error",s),s instanceof Wo)return;K(s)}},Un=i=>e=>{try{e({type:Fo,payload:{data:i}}),jt(Fn,i)}catch(t){K(t)}},jd=()=>async(i,e)=>{try{if(Yd.ForceUseTutorial)return;const{facebook:t}=window.game;await i(Un({userGuideDisplays:1}));const s=e(),n=Bd(s);await Pd(n),t.data.set("userGuideDisplays",1)}catch(t){K(t)}},Na=i=>async(e,t)=>{try{await e({type:Uo,payload:{score:i}}),Us({score:i});const s=t(),a={...$t(s)};jt(Fn,a)}catch(s){K(s)}};class Xd extends Phaser.Plugins.BasePlugin{get state(){return this.game.storage.getState()}async incUserGuideDisplays(){const{storage:e}=this.game;await e.dispatch(jd())}async receiveData(e,t){const{storage:s}=this.game;await s.dispatch(Hd(e,t))}async updateData(){const{storage:e}=this.game;await e.dispatch(Vd())}async updateBestScore(e){const t=this.getBestScore();if(e<=t)return;const{storage:s}=this.game;await s.dispatch(Na(e))}async setBestScore(e){const{storage:t}=this.game;await t.dispatch(Na(e))}async setSetting(e,t){const{storage:s}=this.game;await s.dispatch(Wd(e,t))}async setCustomData(e,t){const{storage:s}=this.game;await s.dispatch(Kd(e,t))}async setMultiCustomData(e){const{storage:t}=this.game;await t.dispatch($d(e))}async requestConnectedPlayers(){const{storage:e}=this.game;await e.dispatch(zd())}async updateConnectedPlayers(e){const{storage:t}=this.game;await t.dispatch(Vo(e))}getPlayer(){return Ci(this.state)}getPlayerId(){return this.getPlayer().playerId}getPlayerASID(){return kd(this.state)}getPlayerData(){return this.getPlayer().data}getPlayerSetting(e){const t=this.getPlayerSettings();return typeof e!="string"?null:GameCore.Utils.Object.hasOwn(t,e)?t[e]:GameCore.Utils.Object.hasOwn(_s,e)?_s[e]:null}getPlayerSettings(){return this.getPlayerData().settings}getPlayerIsNew(){return this.getPlayer().isUserNew}getCoins(){const e=this.getCustomData("coin");return GameCore.Utils.Valid.isNumber(e)?e:0}getDiamond(){const e=this.getCustomData("diamond");return GameCore.Utils.Valid.isNumber(e)?e:0}getBestScore(){return Gd(this.state)}getCustomData(e){const t=Fd(this.state);return!GameCore.Utils.Valid.isObject(t)||!GameCore.Utils.Object.hasOwn(t,e)?null:t[e]}getConnectedPlayers(){return Gn(this.state)}isConnectedPlayersLoaded(){return Md(this.state)}getConnectedPlayerIds(e,t){return Ld(this.state,{limit:e,offset:t})}}const{ApiHost:qd}=GameCore.Configs,Zd=async i=>{const e=GameCore.Utils.String.params(i);return(await Gs(`players?${e}`,{},qd))?.data||[]},Ko="PROFILES_DATA_UPDATE",Yn="profile",Jd=i=>i[Yn].data,Qd=i=>i[Yn].profileIds,ep=G([Jd],i=>i),tp=G([Qd],i=>i),sp=i=>async(e,t)=>{try{const s=t(),n=tp(s),a=GameCore.Utils.Array.difference(i,n);if(a.length<1)return;const r=await Zd({playerIds:a});e({type:Ko,payload:{data:r}})}catch(s){K(s)}};class ip extends Phaser.Plugins.BasePlugin{get state(){return this.game.storage.getState()}async requestProfiles(e){const{storage:t}=this.game;await t.dispatch(sp(e))}getProfiles(){return ep(this.state)}}var $o=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function np(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Sn={},ap={get exports(){return Sn},set exports(i){Sn=i}};(function(i,e){(function(t,s){i.exports=s()})($o,function(){return function(t){var s={};function n(a){if(s[a])return s[a].exports;var r=s[a]={i:a,l:!1,exports:{}};return t[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=s,n.d=function(a,r,c){n.o(a,r)||Object.defineProperty(a,r,{enumerable:!0,get:c})},n.r=function(a){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},n.t=function(a,r){if(1&r&&(a=n(a)),8&r||4&r&&typeof a=="object"&&a&&a.__esModule)return a;var c=Object.create(null);if(n.r(c),Object.defineProperty(c,"default",{enumerable:!0,value:a}),2&r&&typeof a!="string")for(var o in a)n.d(c,o,function(l){return a[l]}.bind(null,o));return c},n.n=function(a){var r=a&&a.__esModule?function(){return a.default}:function(){return a};return n.d(r,"a",r),r},n.o=function(a,r){return Object.prototype.hasOwnProperty.call(a,r)},n.p="",n(n.s=6)}([function(t,s,n){var a=n(12),r={};function c(b,C){return C===o(b)}function o(b){var C=typeof b;return C!=="object"?C:b?b instanceof Error?"error":{}.toString.call(b).match(/\s([a-zA-Z]+)/)[1].toLowerCase():"null"}function l(b){return c(b,"function")}function h(b){var C=Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?"),O=RegExp("^"+C+"$");return d(b)&&O.test(b)}function d(b){var C=typeof b;return b!=null&&(C=="object"||C=="function")}function u(){var b=T();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(C){var O=(b+16*Math.random())%16|0;return b=Math.floor(b/16),(C==="x"?O:7&O|8).toString(16)})}var p={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};function g(b,C){var O,v;try{O=r.stringify(b)}catch(w){if(C&&l(C))try{O=C(b)}catch(P){v=P}else v=w}return{error:v,value:O}}function m(b,C){return function(O,v){try{C(O,v)}catch(w){b.error(w)}}}function E(b){return function C(O,v){var w,P,D,M={};try{for(P in O)(w=O[P])&&(c(w,"object")||c(w,"array"))?v.includes(w)?M[P]="Removed circular reference: "+o(w):((D=v.slice()).push(w),M[P]=C(w,D)):M[P]=w}catch(N){M="Failed cloning custom data: "+N.message}return M}(b,[b])}var f=["log","network","dom","navigation","error","manual"],y=["critical","error","warning","info","debug"];function S(b,C){for(var O=0;O<b.length;++O)if(b[O]===C)return!0;return!1}function T(){return Date.now?+Date.now():+new Date}t.exports={addParamsAndAccessTokenToPath:function(b,C,O){(O=O||{}).access_token=b;var v,w=[];for(v in O)Object.prototype.hasOwnProperty.call(O,v)&&w.push([v,O[v]].join("="));var P="?"+w.sort().join("&");(C=C||{}).path=C.path||"";var D,M=C.path.indexOf("?"),N=C.path.indexOf("#");M!==-1&&(N===-1||N>M)?(D=C.path,C.path=D.substring(0,M)+P+"&"+D.substring(M+1)):N!==-1?(D=C.path,C.path=D.substring(0,N)+P+D.substring(N)):C.path=C.path+P},createItem:function(b,C,O,v,w){for(var P,D,M,N,F,U,X=[],oe=[],ge=0,ie=b.length;ge<ie;++ge){var tt=o(U=b[ge]);switch(oe.push(tt),tt){case"undefined":break;case"string":P?X.push(U):P=U;break;case"function":N=m(C,U);break;case"date":X.push(U);break;case"error":case"domexception":case"exception":D?X.push(U):D=U;break;case"object":case"array":if(U instanceof Error||typeof DOMException<"u"&&U instanceof DOMException){D?X.push(U):D=U;break}if(v&&tt==="object"&&!F){for(var Oe=0,hs=v.length;Oe<hs;++Oe)if(U[v[Oe]]!==void 0){F=U;break}if(F)break}M?X.push(U):M=U;break;default:if(U instanceof Error||typeof DOMException<"u"&&U instanceof DOMException){D?X.push(U):D=U;break}X.push(U)}}M&&(M=E(M)),X.length>0&&(M||(M=E({})),M.extraArgs=E(X));var Ke={message:P,err:D,custom:M,timestamp:T(),callback:N,notifier:O,diagnostic:{},uuid:u()};return function(us,Ne){Ne&&Ne.level!==void 0&&(us.level=Ne.level,delete Ne.level),Ne&&Ne.skipFrames!==void 0&&(us.skipFrames=Ne.skipFrames,delete Ne.skipFrames)}(Ke,M),v&&F&&(Ke.request=F),w&&(Ke.lambdaContext=w),Ke._originalArgs=b,Ke.diagnostic.original_arg_types=oe,Ke},addErrorContext:function(b,C){var O=b.data.custom||{},v=!1;try{for(var w=0;w<C.length;++w)C[w].hasOwnProperty("rollbarContext")&&(O=a(O,E(C[w].rollbarContext)),v=!0);v&&(b.data.custom=O)}catch(P){b.diagnostic.error_context="Failed: "+P.message}},createTelemetryEvent:function(b){for(var C,O,v,w,P=0,D=b.length;P<D;++P)switch(o(w=b[P])){case"string":!C&&S(f,w)?C=w:!v&&S(y,w)&&(v=w);break;case"object":O=w}return{type:C||"manual",metadata:O||{},level:v}},filterIp:function(b,C){if(b&&b.user_ip&&C!==!0){var O=b.user_ip;if(C)try{var v;if(O.indexOf(".")!==-1)(v=O.split(".")).pop(),v.push("0"),O=v.join(".");else if(O.indexOf(":")!==-1){if((v=O.split(":")).length>2){var w=v.slice(0,3),P=w[2].indexOf("/");P!==-1&&(w[2]=w[2].substring(0,P)),O=w.concat("0000:0000:0000:0000:0000").join(":")}}else O=null}catch{O=null}else O=null;b.user_ip=O}},formatArgsAsString:function(b){var C,O,v,w=[];for(C=0,O=b.length;C<O;++C){switch(o(v=b[C])){case"object":(v=(v=g(v)).error||v.value).length>500&&(v=v.substr(0,497)+"...");break;case"null":v="null";break;case"undefined":v="undefined";break;case"symbol":v=v.toString()}w.push(v)}return w.join(" ")},formatUrl:function(b,C){if(!(C=C||b.protocol)&&b.port&&(b.port===80?C="http:":b.port===443&&(C="https:")),C=C||"https:",!b.hostname)return null;var O=C+"//"+b.hostname;return b.port&&(O=O+":"+b.port),b.path&&(O+=b.path),O},get:function(b,C){if(b){var O=C.split("."),v=b;try{for(var w=0,P=O.length;w<P;++w)v=v[O[w]]}catch{v=void 0}return v}},handleOptions:function(b,C,O,v){var w=a(b,C,O);return w=function(P,D){return P.hostWhiteList&&!P.hostSafeList&&(P.hostSafeList=P.hostWhiteList,P.hostWhiteList=void 0,D&&D.log("hostWhiteList is deprecated. Use hostSafeList.")),P.hostBlackList&&!P.hostBlockList&&(P.hostBlockList=P.hostBlackList,P.hostBlackList=void 0,D&&D.log("hostBlackList is deprecated. Use hostBlockList.")),P}(w,v),!C||C.overwriteScrubFields||C.scrubFields&&(w.scrubFields=(b.scrubFields||[]).concat(C.scrubFields)),w},isError:function(b){return c(b,"error")||c(b,"exception")},isFiniteNumber:function(b){return Number.isFinite(b)},isFunction:l,isIterable:function(b){var C=o(b);return C==="object"||C==="array"},isNativeFunction:h,isObject:d,isString:function(b){return typeof b=="string"||b instanceof String},isType:c,isPromise:function(b){return d(b)&&c(b.then,"function")},jsonParse:function(b){var C,O;try{C=r.parse(b)}catch(v){O=v}return{error:O,value:C}},LEVELS:{debug:0,info:1,warning:2,error:3,critical:4},makeUnhandledStackInfo:function(b,C,O,v,w,P,D,M){var N={url:C||"",line:O,column:v};N.func=M.guessFunctionName(N.url,N.line),N.context=M.gatherContext(N.url,N.line);var F=typeof document<"u"&&document&&document.location&&document.location.href,U=typeof window<"u"&&window&&window.navigator&&window.navigator.userAgent;return{mode:P,message:w?String(w):b||D,url:F,stack:[N],useragent:U}},merge:a,now:T,redact:function(){return"********"},RollbarJSON:r,sanitizeUrl:function(b){var C=function(O){if(c(O,"string")){for(var v=p,w=v.parser[v.strictMode?"strict":"loose"].exec(O),P={},D=0,M=v.key.length;D<M;++D)P[v.key[D]]=w[D]||"";return P[v.q.name]={},P[v.key[12]].replace(v.q.parser,function(N,F,U){F&&(P[v.q.name][F]=U)}),P}}(b);return C?(C.anchor===""&&(C.source=C.source.replace("#","")),b=C.source.replace("?"+C.query,"")):"(unknown)"},set:function(b,C,O){if(b){var v=C.split("."),w=v.length;if(!(w<1))if(w!==1)try{for(var P=b[v[0]]||{},D=P,M=1;M<w-1;++M)P[v[M]]=P[v[M]]||{},P=P[v[M]];P[v[w-1]]=O,b[v[0]]=D}catch{return}else b[v[0]]=O}},setupJSON:function(b){l(r.stringify)&&l(r.parse)||(c(JSON,"undefined")||(b?(h(JSON.stringify)&&(r.stringify=JSON.stringify),h(JSON.parse)&&(r.parse=JSON.parse)):(l(JSON.stringify)&&(r.stringify=JSON.stringify),l(JSON.parse)&&(r.parse=JSON.parse))),l(r.stringify)&&l(r.parse)||b&&b(r))},stringify:g,maxByteSize:function(b){for(var C=0,O=b.length,v=0;v<O;v++){var w=b.charCodeAt(v);w<128?C+=1:w<2048?C+=2:w<65536&&(C+=3)}return C},typeName:o,uuid4:u}},function(t,s,n){n(17);var a=n(18),r=n(0);t.exports={error:function(){var c=Array.prototype.slice.call(arguments,0);c.unshift("Rollbar:"),a.ieVersion()<=8?console.error(r.formatArgsAsString(c)):console.error.apply(console,c)},info:function(){var c=Array.prototype.slice.call(arguments,0);c.unshift("Rollbar:"),a.ieVersion()<=8?console.info(r.formatArgsAsString(c)):console.info.apply(console,c)},log:function(){var c=Array.prototype.slice.call(arguments,0);c.unshift("Rollbar:"),a.ieVersion()<=8?console.log(r.formatArgsAsString(c)):console.log.apply(console,c)}}},function(t,s,n){t.exports={parse:function(a){var r,c,o={protocol:null,auth:null,host:null,path:null,hash:null,href:a,hostname:null,port:null,pathname:null,search:null,query:null};if((r=a.indexOf("//"))!==-1?(o.protocol=a.substring(0,r),c=r+2):c=0,(r=a.indexOf("@",c))!==-1&&(o.auth=a.substring(c,r),c=r+1),(r=a.indexOf("/",c))===-1){if((r=a.indexOf("?",c))===-1)return(r=a.indexOf("#",c))===-1?o.host=a.substring(c):(o.host=a.substring(c,r),o.hash=a.substring(r)),o.hostname=o.host.split(":")[0],o.port=o.host.split(":")[1],o.port&&(o.port=parseInt(o.port,10)),o;o.host=a.substring(c,r),o.hostname=o.host.split(":")[0],o.port=o.host.split(":")[1],o.port&&(o.port=parseInt(o.port,10)),c=r}else o.host=a.substring(c,r),o.hostname=o.host.split(":")[0],o.port=o.host.split(":")[1],o.port&&(o.port=parseInt(o.port,10)),c=r;if((r=a.indexOf("#",c))===-1?o.path=a.substring(c):(o.path=a.substring(c,r),o.hash=a.substring(r)),o.path){var l=o.path.split("?");o.pathname=l[0],o.query=l[1],o.search=o.query?"?"+o.query:null}return o}}},function(t,s,n){var a=n(24),r=new RegExp("^(([a-zA-Z0-9-_$ ]*): *)?(Uncaught )?([a-zA-Z0-9-_$ ]*): ");function c(){return null}function o(d){var u={};return u._stackFrame=d,u.url=d.fileName,u.line=d.lineNumber,u.func=d.functionName,u.column=d.columnNumber,u.args=d.args,u.context=null,u}function l(d,u){return{stack:function(){var p=[];u=u||0;try{p=a.parse(d)}catch{p=[]}for(var g=[],m=u;m<p.length;m++)g.push(new o(p[m]));return g}(),message:d.message,name:h(d),rawStack:d.stack,rawException:d}}function h(d){var u=d.name&&d.name.length&&d.name,p=d.constructor.name&&d.constructor.name.length&&d.constructor.name;return u&&p?u==="Error"?p:u:u||p}t.exports={guessFunctionName:function(){return"?"},guessErrorClass:function(d){if(!d||!d.match)return["Unknown error. There was no error message to display.",""];var u=d.match(r),p="(unknown)";return u&&(p=u[u.length-1],d=(d=d.replace((u[u.length-2]||"")+p+":","")).replace(/(^[\s]+|[\s]+$)/g,"")),[p,d]},gatherContext:c,parse:function(d,u){var p=d;if(p.nested||p.cause){for(var g=[];p;)g.push(new l(p,u)),p=p.nested||p.cause,u=0;return g[0].traceChain=g,g[0]}return new l(p,u)},Stack:l,Frame:o}},function(t,s,n){var a=n(0),r=n(5);function c(o,l){var h=l.split("."),d=h.length-1;try{for(var u=0;u<=d;++u)u<d?o=o[h[u]]:o[h[u]]=a.redact()}catch{}}t.exports=function(o,l,h){if(l=l||[],h)for(var d=0;d<h.length;++d)c(o,h[d]);var u=function(m){for(var E,f=[],y=0;y<m.length;++y)E="^\\[?(%5[bB])?"+m[y]+"\\[?(%5[bB])?\\]?(%5[dD])?$",f.push(new RegExp(E,"i"));return f}(l),p=function(m){for(var E,f=[],y=0;y<m.length;++y)E="\\[?(%5[bB])?"+m[y]+"\\[?(%5[bB])?\\]?(%5[dD])?",f.push(new RegExp("("+E+"=)([^&\\n]+)","igm"));return f}(l);function g(m,E){return E+a.redact()}return r(o,function m(E,f,y){var S=function(T,b){var C;for(C=0;C<u.length;++C)if(u[C].test(T)){b=a.redact();break}return b}(E,f);return S===f?a.isType(f,"object")||a.isType(f,"array")?r(f,m,y):function(T){var b;if(a.isType(T,"string"))for(b=0;b<p.length;++b)T=T.replace(p[b],g);return T}(S):S})}},function(t,s,n){var a=n(0);t.exports=function(r,c,o){var l,h,d,u,p=a.isType(r,"object"),g=a.isType(r,"array"),m=[];if(o=o||{obj:[],mapped:[]},p){if(u=o.obj.indexOf(r),p&&u!==-1)return o.mapped[u]||o.obj[u];o.obj.push(r),u=o.obj.length-1}if(p)for(l in r)Object.prototype.hasOwnProperty.call(r,l)&&m.push(l);else if(g)for(d=0;d<r.length;++d)m.push(d);var E=p?{}:[],f=!0;for(d=0;d<m.length;++d)h=r[l=m[d]],E[l]=c(l,h,o),f=f&&E[l]===r[l];return p&&!f&&(o.mapped[u]=E),f?r:E}},function(t,s,n){t.exports=n(7)},function(t,s,n){var a=n(8),r=typeof window<"u"&&window._rollbarConfig,c=r&&r.globalAlias||"Rollbar",o=typeof window<"u"&&window[c]&&typeof window[c].shimId=="function"&&window[c].shimId()!==void 0;if(typeof window>"u"||window._rollbarStartTime||(window._rollbarStartTime=new Date().getTime()),!o&&r){var l=new a(r);window[c]=l}else typeof window<"u"?(window.rollbar=a,window._rollbarDidLoad=!0):typeof self<"u"&&(self.rollbar=a,self._rollbarDidLoad=!0);t.exports=a},function(t,s,n){var a=n(9),r=n(31),c=n(32),o=n(35),l=n(37),h=n(4),d=n(38);a.setComponents({telemeter:r,instrumenter:c,polyfillJSON:o,wrapGlobals:l,scrub:h,truncation:d}),t.exports=a},function(t,s,n){var a=n(10),r=n(0),c=n(15),o=n(1),l=n(19),h=n(20),d=n(2),u=n(23),p=n(26),g=n(27),m=n(28),E=n(3);function f(w,P){this.options=r.handleOptions(v,w,null,o),this.options._configuredOptions=w;var D=this.components.telemeter,M=this.components.instrumenter,N=this.components.polyfillJSON;this.wrapGlobals=this.components.wrapGlobals,this.scrub=this.components.scrub;var F=this.components.truncation,U=new h(F),X=new c(this.options,U,d,F);D&&(this.telemeter=new D(this.options)),this.client=P||new a(this.options,X,o,this.telemeter,"browser");var oe=b(),ge=typeof document<"u"&&document;this.isChrome=oe.chrome&&oe.chrome.runtime,this.anonymousErrorsPending=0,function(ie,tt,Oe){ie.addTransform(u.handleDomException).addTransform(u.handleItemWithError).addTransform(u.ensureItemHasSomethingToSay).addTransform(u.addBaseInfo).addTransform(u.addRequestInfo(Oe)).addTransform(u.addClientInfo(Oe)).addTransform(u.addPluginInfo(Oe)).addTransform(u.addBody).addTransform(p.addMessageWithError).addTransform(p.addTelemetryData).addTransform(p.addConfigToPayload).addTransform(u.addScrubber(tt.scrub)).addTransform(p.addPayloadOptions).addTransform(p.userTransform(o)).addTransform(p.addConfiguredOptions).addTransform(p.addDiagnosticKeys).addTransform(p.itemToPayload)}(this.client.notifier,this,oe),this.client.queue.addPredicate(m.checkLevel).addPredicate(g.checkIgnore).addPredicate(m.userCheckIgnore(o)).addPredicate(m.urlIsNotBlockListed(o)).addPredicate(m.urlIsSafeListed(o)).addPredicate(m.messageIsIgnored(o)),this.setupUnhandledCapture(),M&&(this.instrumenter=new M(this.options,this.client.telemeter,this,oe,ge),this.instrumenter.instrument()),r.setupJSON(N)}var y=null;function S(w){var P="Rollbar is not initialized";o.error(P),w&&w(new Error(P))}function T(w){for(var P=0,D=w.length;P<D;++P)if(r.isFunction(w[P]))return w[P]}function b(){return typeof window<"u"&&window||typeof self<"u"&&self}f.init=function(w,P){return y?y.global(w).configure(w):y=new f(w,P)},f.prototype.components={},f.setComponents=function(w){f.prototype.components=w},f.prototype.global=function(w){return this.client.global(w),this},f.global=function(w){if(y)return y.global(w);S()},f.prototype.configure=function(w,P){var D=this.options,M={};return P&&(M={payload:P}),this.options=r.handleOptions(D,w,M,o),this.options._configuredOptions=r.handleOptions(D._configuredOptions,w,M),this.client.configure(this.options,P),this.instrumenter&&this.instrumenter.configure(this.options),this.setupUnhandledCapture(),this},f.configure=function(w,P){if(y)return y.configure(w,P);S()},f.prototype.lastError=function(){return this.client.lastError},f.lastError=function(){if(y)return y.lastError();S()},f.prototype.log=function(){var w=this._createItem(arguments),P=w.uuid;return this.client.log(w),{uuid:P}},f.log=function(){if(y)return y.log.apply(y,arguments);var w=T(arguments);S(w)},f.prototype.debug=function(){var w=this._createItem(arguments),P=w.uuid;return this.client.debug(w),{uuid:P}},f.debug=function(){if(y)return y.debug.apply(y,arguments);var w=T(arguments);S(w)},f.prototype.info=function(){var w=this._createItem(arguments),P=w.uuid;return this.client.info(w),{uuid:P}},f.info=function(){if(y)return y.info.apply(y,arguments);var w=T(arguments);S(w)},f.prototype.warn=function(){var w=this._createItem(arguments),P=w.uuid;return this.client.warn(w),{uuid:P}},f.warn=function(){if(y)return y.warn.apply(y,arguments);var w=T(arguments);S(w)},f.prototype.warning=function(){var w=this._createItem(arguments),P=w.uuid;return this.client.warning(w),{uuid:P}},f.warning=function(){if(y)return y.warning.apply(y,arguments);var w=T(arguments);S(w)},f.prototype.error=function(){var w=this._createItem(arguments),P=w.uuid;return this.client.error(w),{uuid:P}},f.error=function(){if(y)return y.error.apply(y,arguments);var w=T(arguments);S(w)},f.prototype.critical=function(){var w=this._createItem(arguments),P=w.uuid;return this.client.critical(w),{uuid:P}},f.critical=function(){if(y)return y.critical.apply(y,arguments);var w=T(arguments);S(w)},f.prototype.buildJsonPayload=function(w){return this.client.buildJsonPayload(w)},f.buildJsonPayload=function(){if(y)return y.buildJsonPayload.apply(y,arguments);S()},f.prototype.sendJsonPayload=function(w){return this.client.sendJsonPayload(w)},f.sendJsonPayload=function(){if(y)return y.sendJsonPayload.apply(y,arguments);S()},f.prototype.setupUnhandledCapture=function(){var w=b();this.unhandledExceptionsInitialized||(this.options.captureUncaught||this.options.handleUncaughtExceptions)&&(l.captureUncaughtExceptions(w,this),this.wrapGlobals&&this.options.wrapGlobalEventHandlers&&this.wrapGlobals(w,this),this.unhandledExceptionsInitialized=!0),this.unhandledRejectionsInitialized||(this.options.captureUnhandledRejections||this.options.handleUnhandledRejections)&&(l.captureUnhandledRejections(w,this),this.unhandledRejectionsInitialized=!0)},f.prototype.handleUncaughtException=function(w,P,D,M,N,F){if(this.options.captureUncaught||this.options.handleUncaughtExceptions){if(this.options.inspectAnonymousErrors&&this.isChrome&&N===null&&P==="")return"anonymous";var U,X=r.makeUnhandledStackInfo(w,P,D,M,N,"onerror","uncaught exception",E);r.isError(N)?(U=this._createItem([w,N,F]))._unhandledStackInfo=X:r.isError(P)?(U=this._createItem([w,P,F]))._unhandledStackInfo=X:(U=this._createItem([w,F])).stackInfo=X,U.level=this.options.uncaughtErrorLevel,U._isUncaught=!0,this.client.log(U)}},f.prototype.handleAnonymousErrors=function(){if(this.options.inspectAnonymousErrors&&this.isChrome){var w=this;try{Error.prepareStackTrace=function(P,D){if(w.options.inspectAnonymousErrors&&w.anonymousErrorsPending){if(w.anonymousErrorsPending-=1,!P)return;P._isAnonymous=!0,w.handleUncaughtException(P.message,null,null,null,P)}return P.stack}}catch(P){this.options.inspectAnonymousErrors=!1,this.error("anonymous error handler failed",P)}}},f.prototype.handleUnhandledRejection=function(w,P){if(this.options.captureUnhandledRejections||this.options.handleUnhandledRejections){var D="unhandled rejection was null or undefined!";if(w)if(w.message)D=w.message;else{var M=r.stringify(w);M.value&&(D=M.value)}var N,F=w&&w._rollbarContext||P&&P._rollbarContext;r.isError(w)?N=this._createItem([D,w,F]):(N=this._createItem([D,w,F])).stackInfo=r.makeUnhandledStackInfo(D,"",0,0,null,"unhandledrejection","",E),N.level=this.options.uncaughtErrorLevel,N._isUncaught=!0,N._originalArgs=N._originalArgs||[],N._originalArgs.push(P),this.client.log(N)}},f.prototype.wrap=function(w,P,D){try{var M;if(M=r.isFunction(P)?P:function(){return P||{}},!r.isFunction(w)||w._isWrap)return w;if(!w._rollbar_wrapped&&(w._rollbar_wrapped=function(){D&&r.isFunction(D)&&D.apply(this,arguments);try{return w.apply(this,arguments)}catch(U){var F=U;throw F&&window._rollbarWrappedError!==F&&(r.isType(F,"string")&&(F=new String(F)),F._rollbarContext=M()||{},F._rollbarContext._wrappedSource=w.toString(),window._rollbarWrappedError=F),F}},w._rollbar_wrapped._isWrap=!0,w.hasOwnProperty))for(var N in w)w.hasOwnProperty(N)&&N!=="_rollbar_wrapped"&&(w._rollbar_wrapped[N]=w[N]);return w._rollbar_wrapped}catch{return w}},f.wrap=function(w,P){if(y)return y.wrap(w,P);S()},f.prototype.captureEvent=function(){var w=r.createTelemetryEvent(arguments);return this.client.captureEvent(w.type,w.metadata,w.level)},f.captureEvent=function(){if(y)return y.captureEvent.apply(y,arguments);S()},f.prototype.captureDomContentLoaded=function(w,P){return P||(P=new Date),this.client.captureDomContentLoaded(P)},f.prototype.captureLoad=function(w,P){return P||(P=new Date),this.client.captureLoad(P)},f.prototype.loadFull=function(){o.info("Unexpected Rollbar.loadFull() called on a Notifier instance. This can happen when Rollbar is loaded multiple times.")},f.prototype._createItem=function(w){return r.createItem(w,o,this)};var C=n(29),O=n(30),v={version:C.version,scrubFields:O.scrubFields,logLevel:C.logLevel,reportLevel:C.reportLevel,uncaughtErrorLevel:C.uncaughtErrorLevel,endpoint:C.endpoint,verbose:!1,enabled:!0,transmit:!0,sendConfig:!1,includeItemsInTelemetry:!0,captureIp:!0,inspectAnonymousErrors:!0,ignoreDuplicateErrors:!0,wrapGlobalEventHandlers:!1};t.exports=f},function(t,s,n){var a=n(11),r=n(13),c=n(14),o=n(0);function l(u,p,g,m,E){this.options=o.merge(u),this.logger=g,l.rateLimiter.configureGlobal(this.options),l.rateLimiter.setPlatformOptions(E,this.options),this.api=p,this.queue=new r(l.rateLimiter,p,g,this.options);var f=this.options.tracer||null;d(f)?(this.tracer=f,this.options.tracer="opentracing-tracer-enabled",this.options._configuredOptions.tracer="opentracing-tracer-enabled"):this.tracer=null,this.notifier=new c(this.queue,this.options),this.telemeter=m,h(u),this.lastError=null,this.lastErrorHash="none"}function h(u){u.stackTraceLimit&&(Error.stackTraceLimit=u.stackTraceLimit)}function d(u){if(!u||!u.scope||typeof u.scope!="function")return!1;var p=u.scope();return!(!p||!p.active||typeof p.active!="function")}l.rateLimiter=new a({maxItems:0,itemsPerMinute:60}),l.prototype.global=function(u){return l.rateLimiter.configureGlobal(u),this},l.prototype.configure=function(u,p){var g=this.options,m={};p&&(m={payload:p}),this.options=o.merge(g,u,m);var E=this.options.tracer||null;return d(E)?(this.tracer=E,this.options.tracer="opentracing-tracer-enabled",this.options._configuredOptions.tracer="opentracing-tracer-enabled"):this.tracer=null,this.notifier&&this.notifier.configure(this.options),this.telemeter&&this.telemeter.configure(this.options),h(u),this.global(this.options),d(u.tracer)&&(this.tracer=u.tracer),this},l.prototype.log=function(u){var p=this._defaultLogLevel();return this._log(p,u)},l.prototype.debug=function(u){this._log("debug",u)},l.prototype.info=function(u){this._log("info",u)},l.prototype.warn=function(u){this._log("warning",u)},l.prototype.warning=function(u){this._log("warning",u)},l.prototype.error=function(u){this._log("error",u)},l.prototype.critical=function(u){this._log("critical",u)},l.prototype.wait=function(u){this.queue.wait(u)},l.prototype.captureEvent=function(u,p,g){return this.telemeter&&this.telemeter.captureEvent(u,p,g)},l.prototype.captureDomContentLoaded=function(u){return this.telemeter&&this.telemeter.captureDomContentLoaded(u)},l.prototype.captureLoad=function(u){return this.telemeter&&this.telemeter.captureLoad(u)},l.prototype.buildJsonPayload=function(u){return this.api.buildJsonPayload(u)},l.prototype.sendJsonPayload=function(u){this.api.postJsonPayload(u)},l.prototype._log=function(u,p){var g;if(p.callback&&(g=p.callback,delete p.callback),this.options.ignoreDuplicateErrors&&this._sameAsLastError(p)){if(g){var m=new Error("ignored identical item");m.item=p,g(m)}}else try{this._addTracingInfo(p),p.level=p.level||u,this.telemeter&&this.telemeter._captureRollbarItem(p),p.telemetryEvents=this.telemeter&&this.telemeter.copyEvents()||[],this.notifier.log(p,g)}catch(E){g&&g(E),this.logger.error(E)}},l.prototype._defaultLogLevel=function(){return this.options.logLevel||"debug"},l.prototype._sameAsLastError=function(u){if(!u._isUncaught)return!1;var p=function(g){var m=g.message||"",E=(g.err||{}).stack||String(g.err);return m+"::"+E}(u);return this.lastErrorHash===p||(this.lastError=u.err,this.lastErrorHash=p,!1)},l.prototype._addTracingInfo=function(u){if(this.tracer){var p=this.tracer.scope().active();if(function(E){if(!E||!E.context||typeof E.context!="function")return!1;var f=E.context();return!(!f||!f.toSpanId||!f.toTraceId||typeof f.toSpanId!="function"||typeof f.toTraceId!="function")}(p)){p.setTag("rollbar.error_uuid",u.uuid),p.setTag("rollbar.has_error",!0),p.setTag("error",!0),p.setTag("rollbar.item_url","https://rollbar.com/item/uuid/?uuid="+u.uuid),p.setTag("rollbar.occurrence_url","https://rollbar.com/occurrence/uuid/?uuid="+u.uuid);var g=p.context().toSpanId(),m=p.context().toTraceId();u.custom?(u.custom.opentracing_span_id=g,u.custom.opentracing_trace_id=m):u.custom={opentracing_span_id:g,opentracing_trace_id:m}}}},t.exports=l},function(t,s,n){var a=n(0);function r(l){this.startTime=a.now(),this.counter=0,this.perMinCounter=0,this.platform=null,this.platformOptions={},this.configureGlobal(l)}function c(l,h,d){return!l.ignoreRateLimit&&h>=1&&d>h}function o(l,h,d,u,p,g,m){var E=null;return d&&(d=new Error(d)),d||u||(E=function(f,y,S,T,b){var C,O=y.environment||y.payload&&y.payload.environment;C=b?"item per minute limit reached, ignoring errors until timeout":"maxItems has been hit, ignoring errors until reset.";var v={body:{message:{body:C,extra:{maxItems:S,itemsPerMinute:T}}},language:"javascript",environment:O,notifier:{version:y.notifier&&y.notifier.version||y.version}};return f==="browser"?(v.platform="browser",v.framework="browser-js",v.notifier.name="rollbar-browser-js"):f==="server"?(v.framework=y.framework||"node-js",v.notifier.name=y.notifier.name):f==="react-native"&&(v.framework=y.framework||"react-native",v.notifier.name=y.notifier.name),v}(l,h,p,g,m)),{error:d,shouldSend:u,payload:E}}r.globalSettings={startTime:a.now(),maxItems:void 0,itemsPerMinute:void 0},r.prototype.configureGlobal=function(l){l.startTime!==void 0&&(r.globalSettings.startTime=l.startTime),l.maxItems!==void 0&&(r.globalSettings.maxItems=l.maxItems),l.itemsPerMinute!==void 0&&(r.globalSettings.itemsPerMinute=l.itemsPerMinute)},r.prototype.shouldSend=function(l,h){var d=(h=h||a.now())-this.startTime;(d<0||d>=6e4)&&(this.startTime=h,this.perMinCounter=0);var u=r.globalSettings.maxItems,p=r.globalSettings.itemsPerMinute;if(c(l,u,this.counter))return o(this.platform,this.platformOptions,u+" max items reached",!1);if(c(l,p,this.perMinCounter))return o(this.platform,this.platformOptions,p+" items per minute reached",!1);this.counter++,this.perMinCounter++;var g=!c(l,u,this.counter),m=g;return g=g&&!c(l,p,this.perMinCounter),o(this.platform,this.platformOptions,null,g,u,p,m)},r.prototype.setPlatformOptions=function(l,h){this.platform=l,this.platformOptions=h},t.exports=r},function(t,s,n){var a=Object.prototype.hasOwnProperty,r=Object.prototype.toString,c=function(o){if(!o||r.call(o)!=="[object Object]")return!1;var l,h=a.call(o,"constructor"),d=o.constructor&&o.constructor.prototype&&a.call(o.constructor.prototype,"isPrototypeOf");if(o.constructor&&!h&&!d)return!1;for(l in o);return l===void 0||a.call(o,l)};t.exports=function o(){var l,h,d,u,p,g={},m=null,E=arguments.length;for(l=0;l<E;l++)if((m=arguments[l])!=null)for(p in m)h=g[p],g!==(d=m[p])&&(d&&c(d)?(u=h&&c(h)?h:{},g[p]=o(u,d)):d!==void 0&&(g[p]=d));return g}},function(t,s,n){var a=n(0);function r(o,l,h,d){this.rateLimiter=o,this.api=l,this.logger=h,this.options=d,this.predicates=[],this.pendingItems=[],this.pendingRequests=[],this.retryQueue=[],this.retryHandle=null,this.waitCallback=null,this.waitIntervalID=null}r.prototype.configure=function(o){this.api&&this.api.configure(o);var l=this.options;return this.options=a.merge(l,o),this},r.prototype.addPredicate=function(o){return a.isFunction(o)&&this.predicates.push(o),this},r.prototype.addPendingItem=function(o){this.pendingItems.push(o)},r.prototype.removePendingItem=function(o){var l=this.pendingItems.indexOf(o);l!==-1&&this.pendingItems.splice(l,1)},r.prototype.addItem=function(o,l,h,d){l&&a.isFunction(l)||(l=function(){});var u=this._applyPredicates(o);if(u.stop)return this.removePendingItem(d),void l(u.err);if(this._maybeLog(o,h),this.removePendingItem(d),this.options.transmit){this.pendingRequests.push(o);try{this._makeApiRequest(o,function(p,g){this._dequeuePendingRequest(o),l(p,g)}.bind(this))}catch(p){this._dequeuePendingRequest(o),l(p)}}else l(new Error("Transmit disabled"))},r.prototype.wait=function(o){a.isFunction(o)&&(this.waitCallback=o,this._maybeCallWait()||(this.waitIntervalID&&(this.waitIntervalID=clearInterval(this.waitIntervalID)),this.waitIntervalID=setInterval(function(){this._maybeCallWait()}.bind(this),500)))},r.prototype._applyPredicates=function(o){for(var l=null,h=0,d=this.predicates.length;h<d;h++)if(!(l=this.predicates[h](o,this.options))||l.err!==void 0)return{stop:!0,err:l.err};return{stop:!1,err:null}},r.prototype._makeApiRequest=function(o,l){var h=this.rateLimiter.shouldSend(o);h.shouldSend?this.api.postItem(o,function(d,u){d?this._maybeRetry(d,o,l):l(d,u)}.bind(this)):h.error?l(h.error):this.api.postItem(h.payload,l)};var c=["ECONNRESET","ENOTFOUND","ESOCKETTIMEDOUT","ETIMEDOUT","ECONNREFUSED","EHOSTUNREACH","EPIPE","EAI_AGAIN"];r.prototype._maybeRetry=function(o,l,h){var d=!1;if(this.options.retryInterval){for(var u=0,p=c.length;u<p;u++)if(o.code===c[u]){d=!0;break}d&&a.isFiniteNumber(this.options.maxRetries)&&(l.retries=l.retries?l.retries+1:1,l.retries>this.options.maxRetries&&(d=!1))}d?this._retryApiRequest(l,h):h(o)},r.prototype._retryApiRequest=function(o,l){this.retryQueue.push({item:o,callback:l}),this.retryHandle||(this.retryHandle=setInterval(function(){for(;this.retryQueue.length;){var h=this.retryQueue.shift();this._makeApiRequest(h.item,h.callback)}}.bind(this),this.options.retryInterval))},r.prototype._dequeuePendingRequest=function(o){var l=this.pendingRequests.indexOf(o);l!==-1&&(this.pendingRequests.splice(l,1),this._maybeCallWait())},r.prototype._maybeLog=function(o,l){if(this.logger&&this.options.verbose){var h=l;if(h=(h=h||a.get(o,"body.trace.exception.message"))||a.get(o,"body.trace_chain.0.exception.message"))return void this.logger.error(h);(h=a.get(o,"body.message.body"))&&this.logger.log(h)}},r.prototype._maybeCallWait=function(){return!(!a.isFunction(this.waitCallback)||this.pendingItems.length!==0||this.pendingRequests.length!==0)&&(this.waitIntervalID&&(this.waitIntervalID=clearInterval(this.waitIntervalID)),this.waitCallback(),!0)},t.exports=r},function(t,s,n){var a=n(0);function r(c,o){this.queue=c,this.options=o,this.transforms=[],this.diagnostic={}}r.prototype.configure=function(c){this.queue&&this.queue.configure(c);var o=this.options;return this.options=a.merge(o,c),this},r.prototype.addTransform=function(c){return a.isFunction(c)&&this.transforms.push(c),this},r.prototype.log=function(c,o){if(o&&a.isFunction(o)||(o=function(){}),!this.options.enabled)return o(new Error("Rollbar is not enabled"));this.queue.addPendingItem(c);var l=c.err;this._applyTransforms(c,function(h,d){if(h)return this.queue.removePendingItem(c),o(h,null);this.queue.addItem(d,o,l,c)}.bind(this))},r.prototype._applyTransforms=function(c,o){var l=-1,h=this.transforms.length,d=this.transforms,u=this.options,p=function(g,m){g?o(g,null):++l!==h?d[l](m,u,p):o(null,m)};p(null,c)},t.exports=r},function(t,s,n){var a=n(0),r=n(16),c={hostname:"api.rollbar.com",path:"/api/1/item/",search:null,version:"1",protocol:"https:",port:443};function o(h,d,u,p,g){this.options=h,this.transport=d,this.url=u,this.truncation=p,this.jsonBackup=g,this.accessToken=h.accessToken,this.transportOptions=l(h,u)}function l(h,d){return r.getTransportFromOptions(h,c,d)}o.prototype.postItem=function(h,d){var u=r.transportOptions(this.transportOptions,"POST"),p=r.buildPayload(this.accessToken,h,this.jsonBackup),g=this;setTimeout(function(){g.transport.post(g.accessToken,u,p,d)},0)},o.prototype.buildJsonPayload=function(h,d){var u,p=r.buildPayload(this.accessToken,h,this.jsonBackup);return(u=this.truncation?this.truncation.truncate(p):a.stringify(p)).error?(d&&d(u.error),null):u.value},o.prototype.postJsonPayload=function(h,d){var u=r.transportOptions(this.transportOptions,"POST");this.transport.postJsonPayload(this.accessToken,u,h,d)},o.prototype.configure=function(h){var d=this.oldOptions;return this.options=a.merge(d,h),this.transportOptions=l(this.options,this.url),this.options.accessToken!==void 0&&(this.accessToken=this.options.accessToken),this},t.exports=o},function(t,s,n){var a=n(0);t.exports={buildPayload:function(r,c,o){if(!a.isType(c.context,"string")){var l=a.stringify(c.context,o);l.error?c.context="Error: could not serialize 'context'":c.context=l.value||"",c.context.length>255&&(c.context=c.context.substr(0,255))}return{access_token:r,data:c}},getTransportFromOptions:function(r,c,o){var l=c.hostname,h=c.protocol,d=c.port,u=c.path,p=c.search,g=r.timeout,m=function(y){var S=typeof window<"u"&&window||typeof self<"u"&&self,T=y.defaultTransport||"xhr";return S.fetch===void 0&&(T="xhr"),S.XMLHttpRequest===void 0&&(T="fetch"),T}(r),E=r.proxy;if(r.endpoint){var f=o.parse(r.endpoint);l=f.hostname,h=f.protocol,d=f.port,u=f.pathname,p=f.search}return{timeout:g,hostname:l,protocol:h,port:d,path:u,search:p,proxy:E,transport:m}},transportOptions:function(r,c){var o=r.protocol||"https:",l=r.port||(o==="http:"?80:o==="https:"?443:void 0),h=r.hostname,d=r.path,u=r.timeout,p=r.transport;return r.search&&(d+=r.search),r.proxy&&(d=o+"//"+h+d,h=r.proxy.host||r.proxy.hostname,l=r.proxy.port,o=r.proxy.protocol||o),{timeout:u,protocol:o,hostname:h,path:d,port:l,method:c,transport:p}},appendPathToPath:function(r,c){var o=/\/$/.test(r),l=/^\//.test(c);return o&&l?c=c.substring(1):o||l||(c="/"+c),r+c}}},function(t,s){(function(n){n.console||(n.console={});for(var a,r,c=n.console,o=function(){},l=["memory"],h="assert,clear,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profiles,profileEnd,show,table,time,timeEnd,timeline,timelineEnd,timeStamp,trace,warn".split(",");a=l.pop();)c[a]||(c[a]={});for(;r=h.pop();)c[r]||(c[r]=o)})(typeof window>"u"?this:window)},function(t,s,n){var a={ieVersion:function(){if(typeof document<"u"){for(var r=3,c=document.createElement("div"),o=c.getElementsByTagName("i");c.innerHTML="<!--[if gt IE "+ ++r+"]><i></i><![endif]-->",o[0];);return r>4?r:void 0}}};t.exports=a},function(t,s,n){function a(r,c,o,l){r._rollbarWrappedError&&(l[4]||(l[4]=r._rollbarWrappedError),l[5]||(l[5]=r._rollbarWrappedError._rollbarContext),r._rollbarWrappedError=null);var h=c.handleUncaughtException.apply(c,l);o&&o.apply(r,l),h==="anonymous"&&(c.anonymousErrorsPending+=1)}t.exports={captureUncaughtExceptions:function(r,c,o){if(r){var l;if(typeof c._rollbarOldOnError=="function")l=c._rollbarOldOnError;else if(r.onerror){for(l=r.onerror;l._rollbarOldOnError;)l=l._rollbarOldOnError;c._rollbarOldOnError=l}c.handleAnonymousErrors();var h=function(){var d=Array.prototype.slice.call(arguments,0);a(r,c,l,d)};o&&(h._rollbarOldOnError=l),r.onerror=h}},captureUnhandledRejections:function(r,c,o){if(r){typeof r._rollbarURH=="function"&&r._rollbarURH.belongsToShim&&r.removeEventListener("unhandledrejection",r._rollbarURH);var l=function(h){var d,u,p;try{d=h.reason}catch{d=void 0}try{u=h.promise}catch{u="[unhandledrejection] error getting `promise` from event"}try{p=h.detail,!d&&p&&(d=p.reason,u=p.promise)}catch{}d||(d="[unhandledrejection] error getting `reason` from event"),c&&c.handleUnhandledRejection&&c.handleUnhandledRejection(d,u)};l.belongsToShim=o,r._rollbarURH=l,r.addEventListener("unhandledrejection",l)}}}},function(t,s,n){var a=n(0),r=n(21),c=n(22);function o(l){this.truncation=l}o.prototype.get=function(l,h,d,u,p){u&&a.isFunction(u)||(u=function(){}),a.addParamsAndAccessTokenToPath(l,h,d);var g=a.formatUrl(h);this._makeZoneRequest(l,g,"GET",null,u,p,h.timeout,h.transport)},o.prototype.post=function(l,h,d,u,p){if(u&&a.isFunction(u)||(u=function(){}),!d)return u(new Error("Cannot send empty request"));var g;if((g=this.truncation?this.truncation.truncate(d):a.stringify(d)).error)return u(g.error);var m=g.value,E=a.formatUrl(h);this._makeZoneRequest(l,E,"POST",m,u,p,h.timeout,h.transport)},o.prototype.postJsonPayload=function(l,h,d,u,p){u&&a.isFunction(u)||(u=function(){});var g=a.formatUrl(h);this._makeZoneRequest(l,g,"POST",d,u,p,h.timeout,h.transport)},o.prototype._makeZoneRequest=function(){var l=typeof window<"u"&&window||p!==void 0&&p,h=l&&l.Zone&&l.Zone.current,d=Array.prototype.slice.call(arguments);if(h&&h._name==="angular"){var u=h._parent,p=this;u.run(function(){p._makeRequest.apply(void 0,d)})}else this._makeRequest.apply(void 0,d)},o.prototype._makeRequest=function(l,h,d,u,p,g,m,E){if(typeof RollbarProxy<"u")return function(f,y){new RollbarProxy().sendJsonPayload(f,function(S){},function(S){y(new Error(S))})}(u,p);E==="fetch"?r(l,h,d,u,p,m):c(l,h,d,u,p,g,m)},t.exports=o},function(t,s,n){var a=n(1),r=n(0);t.exports=function(c,o,l,h,d,u){var p,g;r.isFiniteNumber(u)&&(p=new AbortController,g=setTimeout(function(){p.abort()},u)),fetch(o,{method:l,headers:{"Content-Type":"application/json","X-Rollbar-Access-Token":c,signal:p&&p.signal},body:h}).then(function(m){return g&&clearTimeout(g),m.json()}).then(function(m){d(null,m)}).catch(function(m){a.error(m.message),d(m)})}},function(t,s,n){var a=n(0),r=n(1);function c(o,l){var h=new Error(o);return h.code=l||"ENOTFOUND",h}t.exports=function(o,l,h,d,u,p,g){var m;if(!(m=p?p():function(){var y,S,T=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],b=T.length;for(S=0;S<b;S++)try{y=T[S]();break}catch{}return y}()))return u(new Error("No way to send a request"));try{try{var E=function(){try{if(E&&m.readyState===4){E=void 0;var y=a.jsonParse(m.responseText);if((b=m)&&b.status&&b.status===200)return void u(y.error,y.value);if(function(C){return C&&a.isType(C.status,"number")&&C.status>=400&&C.status<600}(m)){if(m.status===403){var S=y.value&&y.value.message;r.error(S)}u(new Error(String(m.status)))}else u(c("XHR response had no status code (likely connection failure)"))}}catch(C){var T;T=C&&C.stack?C:new Error(C),u(T)}var b};m.open(h,l,!0),m.setRequestHeader&&(m.setRequestHeader("Content-Type","application/json"),m.setRequestHeader("X-Rollbar-Access-Token",o)),a.isFiniteNumber(g)&&(m.timeout=g),m.onreadystatechange=E,m.send(d)}catch{if(typeof XDomainRequest<"u"){if(!window||!window.location)return u(new Error("No window available during request, unknown environment"));window.location.href.substring(0,5)==="http:"&&l.substring(0,5)==="https"&&(l="http"+l.substring(5));var f=new XDomainRequest;f.onprogress=function(){},f.ontimeout=function(){u(c("Request timed out","ETIMEDOUT"))},f.onerror=function(){u(new Error("Error during request"))},f.onload=function(){var S=a.jsonParse(f.responseText);u(S.error,S.value)},f.open(h,l,!0),f.send(d)}else u(new Error("Cannot find a method to transport a request"))}}catch(y){u(y)}}},function(t,s,n){var a=n(0),r=n(3),c=n(1);function o(u,p,g){var m=u.message,E=u.custom;m||(m="Item sent with null or missing arguments.");var f={body:m};E&&(f.extra=a.merge(E)),a.set(u,"data.body",{message:f}),g(null,u)}function l(u){var p=u.stackInfo.stack;return p&&p.length===0&&u._unhandledStackInfo&&u._unhandledStackInfo.stack&&(p=u._unhandledStackInfo.stack),p}function h(u,p,g){var m=u&&u.data.description,E=u&&u.custom,f=l(u),y=r.guessErrorClass(p.message),S={exception:{class:d(p,y[0],g),message:y[1]}};if(m&&(S.exception.description=m),f){var T,b,C,O,v,w,P,D;for(f.length===0&&(S.exception.stack=p.rawStack,S.exception.raw=String(p.rawException)),S.frames=[],P=0;P<f.length;++P)b={filename:(T=f[P]).url?a.sanitizeUrl(T.url):"(unknown)",lineno:T.line||null,method:T.func&&T.func!=="?"?T.func:"[anonymous]",colno:T.column},g.sendFrameUrl&&(b.url=T.url),b.method&&b.method.endsWith&&b.method.endsWith("_rollbar_wrapped")||(C=O=v=null,(w=T.context?T.context.length:0)&&(D=Math.floor(w/2),O=T.context.slice(0,D),C=T.context[D],v=T.context.slice(D)),C&&(b.code=C),(O||v)&&(b.context={},O&&O.length&&(b.context.pre=O),v&&v.length&&(b.context.post=v)),T.args&&(b.args=T.args),S.frames.push(b));S.frames.reverse(),E&&(S.extra=a.merge(E))}return S}function d(u,p,g){return u.name?u.name:g.guessErrorClass?p:"(unknown)"}t.exports={handleDomException:function(u,p,g){if(u.err&&r.Stack(u.err).name==="DOMException"){var m=new Error;m.name=u.err.name,m.message=u.err.message,m.stack=u.err.stack,m.nested=u.err,u.err=m}g(null,u)},handleItemWithError:function(u,p,g){if(u.data=u.data||{},u.err)try{u.stackInfo=u.err._savedStackTrace||r.parse(u.err,u.skipFrames),p.addErrorContext&&function(m){var E=[],f=m.err;for(E.push(f);f.nested||f.cause;)f=f.nested||f.cause,E.push(f);a.addErrorContext(m,E)}(u)}catch(m){c.error("Error while parsing the error object.",m);try{u.message=u.err.message||u.err.description||u.message||String(u.err)}catch(E){u.message=String(u.err)||String(E)}delete u.err}g(null,u)},ensureItemHasSomethingToSay:function(u,p,g){u.message||u.stackInfo||u.custom||g(new Error("No message, stack info, or custom data"),null),g(null,u)},addBaseInfo:function(u,p,g){var m=p.payload&&p.payload.environment||p.environment;u.data=a.merge(u.data,{environment:m,level:u.level,endpoint:p.endpoint,platform:"browser",framework:"browser-js",language:"javascript",server:{},uuid:u.uuid,notifier:{name:"rollbar-browser-js",version:p.version},custom:u.custom}),g(null,u)},addRequestInfo:function(u){return function(p,g,m){var E={};u&&u.location&&(E.url=u.location.href,E.query_string=u.location.search);var f="$remote_ip";g.captureIp?g.captureIp!==!0&&(f+="_anonymize"):f=null,f&&(E.user_ip=f),Object.keys(E).length>0&&a.set(p,"data.request",E),m(null,p)}},addClientInfo:function(u){return function(p,g,m){if(!u)return m(null,p);var E=u.navigator||{},f=u.screen||{};a.set(p,"data.client",{runtime_ms:p.timestamp-u._rollbarStartTime,timestamp:Math.round(p.timestamp/1e3),javascript:{browser:E.userAgent,language:E.language,cookie_enabled:E.cookieEnabled,screen:{width:f.width,height:f.height}}}),m(null,p)}},addPluginInfo:function(u){return function(p,g,m){if(!u||!u.navigator)return m(null,p);for(var E,f=[],y=u.navigator.plugins||[],S=0,T=y.length;S<T;++S)E=y[S],f.push({name:E.name,description:E.description});a.set(p,"data.client.javascript.plugins",f),m(null,p)}},addBody:function(u,p,g){u.stackInfo?u.stackInfo.traceChain?function(m,E,f){for(var y=m.stackInfo.traceChain,S=[],T=y.length,b=0;b<T;b++){var C=h(m,y[b],E);S.push(C)}a.set(m,"data.body",{trace_chain:S}),f(null,m)}(u,p,g):function(m,E,f){if(l(m)){var y=h(m,m.stackInfo,E);a.set(m,"data.body",{trace:y}),f(null,m)}else{var S=m.stackInfo,T=r.guessErrorClass(S.message),b=d(S,T[0],E),C=T[1];m.message=b+": "+C,o(m,E,f)}}(u,p,g):o(u,p,g)},addScrubber:function(u){return function(p,g,m){if(u){var E=g.scrubFields||[],f=g.scrubPaths||[];p.data=u(p.data,E,f)}m(null,p)}}}},function(t,s,n){var a,r,c;(function(o,l){r=[n(25)],(c=typeof(a=function(h){var d=/(^|@)\S+:\d+/,u=/^\s*at .*(\S+:\d+|\(native\))/m,p=/^(eval@)?(\[native code])?$/;return{parse:function(g){if(g.stacktrace!==void 0||g["opera#sourceloc"]!==void 0)return this.parseOpera(g);if(g.stack&&g.stack.match(u))return this.parseV8OrIE(g);if(g.stack)return this.parseFFOrSafari(g);throw new Error("Cannot parse given Error object")},extractLocation:function(g){if(g.indexOf(":")===-1)return[g];var m=/(.+?)(?::(\d+))?(?::(\d+))?$/.exec(g.replace(/[()]/g,""));return[m[1],m[2]||void 0,m[3]||void 0]},parseV8OrIE:function(g){return g.stack.split(`
`).filter(function(m){return!!m.match(u)},this).map(function(m){m.indexOf("(eval ")>-1&&(m=m.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var E=m.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),f=E.match(/ (\(.+\)$)/);E=f?E.replace(f[0],""):E;var y=this.extractLocation(f?f[1]:E),S=f&&E||void 0,T=["eval","<anonymous>"].indexOf(y[0])>-1?void 0:y[0];return new h({functionName:S,fileName:T,lineNumber:y[1],columnNumber:y[2],source:m})},this)},parseFFOrSafari:function(g){return g.stack.split(`
`).filter(function(m){return!m.match(p)},this).map(function(m){if(m.indexOf(" > eval")>-1&&(m=m.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),m.indexOf("@")===-1&&m.indexOf(":")===-1)return new h({functionName:m});var E=/((.*".+"[^@]*)?[^@]*)(?:@)/,f=m.match(E),y=f&&f[1]?f[1]:void 0,S=this.extractLocation(m.replace(E,""));return new h({functionName:y,fileName:S[0],lineNumber:S[1],columnNumber:S[2],source:m})},this)},parseOpera:function(g){return!g.stacktrace||g.message.indexOf(`
`)>-1&&g.message.split(`
`).length>g.stacktrace.split(`
`).length?this.parseOpera9(g):g.stack?this.parseOpera11(g):this.parseOpera10(g)},parseOpera9:function(g){for(var m=/Line (\d+).*script (?:in )?(\S+)/i,E=g.message.split(`
`),f=[],y=2,S=E.length;y<S;y+=2){var T=m.exec(E[y]);T&&f.push(new h({fileName:T[2],lineNumber:T[1],source:E[y]}))}return f},parseOpera10:function(g){for(var m=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,E=g.stacktrace.split(`
`),f=[],y=0,S=E.length;y<S;y+=2){var T=m.exec(E[y]);T&&f.push(new h({functionName:T[3]||void 0,fileName:T[2],lineNumber:T[1],source:E[y]}))}return f},parseOpera11:function(g){return g.stack.split(`
`).filter(function(m){return!!m.match(d)&&!m.match(/^Error created at/)},this).map(function(m){var E,f=m.split("@"),y=this.extractLocation(f.pop()),S=f.shift()||"",T=S.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0;S.match(/\(([^)]*)\)/)&&(E=S.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var b=E===void 0||E==="[arguments not available]"?void 0:E.split(",");return new h({functionName:T,args:b,fileName:y[0],lineNumber:y[1],columnNumber:y[2],source:m})},this)}}})=="function"?a.apply(s,r):a)===void 0||(t.exports=c)})()},function(t,s,n){var a,r,c;(function(o,l){r=[],(c=typeof(a=function(){function h(T){return T.charAt(0).toUpperCase()+T.substring(1)}function d(T){return function(){return this[T]}}var u=["isConstructor","isEval","isNative","isToplevel"],p=["columnNumber","lineNumber"],g=["fileName","functionName","source"],m=u.concat(p,g,["args"],["evalOrigin"]);function E(T){if(T)for(var b=0;b<m.length;b++)T[m[b]]!==void 0&&this["set"+h(m[b])](T[m[b]])}E.prototype={getArgs:function(){return this.args},setArgs:function(T){if(Object.prototype.toString.call(T)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=T},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(T){if(T instanceof E)this.evalOrigin=T;else{if(!(T instanceof Object))throw new TypeError("Eval Origin must be an Object or StackFrame");this.evalOrigin=new E(T)}},toString:function(){var T=this.getFileName()||"",b=this.getLineNumber()||"",C=this.getColumnNumber()||"",O=this.getFunctionName()||"";return this.getIsEval()?T?"[eval] ("+T+":"+b+":"+C+")":"[eval]:"+b+":"+C:O?O+" ("+T+":"+b+":"+C+")":T+":"+b+":"+C}},E.fromString=function(T){var b=T.indexOf("("),C=T.lastIndexOf(")"),O=T.substring(0,b),v=T.substring(b+1,C).split(","),w=T.substring(C+1);if(w.indexOf("@")===0)var P=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(w,""),D=P[1],M=P[2],N=P[3];return new E({functionName:O,args:v||void 0,fileName:D,lineNumber:M||void 0,columnNumber:N||void 0})};for(var f=0;f<u.length;f++)E.prototype["get"+h(u[f])]=d(u[f]),E.prototype["set"+h(u[f])]=function(T){return function(b){this[T]=Boolean(b)}}(u[f]);for(var y=0;y<p.length;y++)E.prototype["get"+h(p[y])]=d(p[y]),E.prototype["set"+h(p[y])]=function(T){return function(b){if(C=b,isNaN(parseFloat(C))||!isFinite(C))throw new TypeError(T+" must be a Number");var C;this[T]=Number(b)}}(p[y]);for(var S=0;S<g.length;S++)E.prototype["get"+h(g[S])]=d(g[S]),E.prototype["set"+h(g[S])]=function(T){return function(b){this[T]=String(b)}}(g[S]);return E})=="function"?a.apply(s,r):a)===void 0||(t.exports=c)})()},function(t,s,n){var a=n(0);function r(c,o){a.isFunction(c[o])&&(c[o]=c[o].toString())}t.exports={itemToPayload:function(c,o,l){var h=c.data;c._isUncaught&&(h._isUncaught=!0),c._originalArgs&&(h._originalArgs=c._originalArgs),l(null,h)},addPayloadOptions:function(c,o,l){var h=o.payload||{};h.body&&delete h.body,c.data=a.merge(c.data,h),l(null,c)},addTelemetryData:function(c,o,l){c.telemetryEvents&&a.set(c,"data.body.telemetry",c.telemetryEvents),l(null,c)},addMessageWithError:function(c,o,l){if(c.message){var h="data.body.trace_chain.0",d=a.get(c,h);if(d||(h="data.body.trace",d=a.get(c,h)),d){if(!d.exception||!d.exception.description)return a.set(c,h+".exception.description",c.message),void l(null,c);var u=a.get(c,h+".extra")||{},p=a.merge(u,{message:c.message});a.set(c,h+".extra",p)}l(null,c)}else l(null,c)},userTransform:function(c){return function(o,l,h){var d=a.merge(o),u=null;try{a.isFunction(l.transform)&&(u=l.transform(d.data,o))}catch(p){return l.transform=null,c.error("Error while calling custom transform() function. Removing custom transform().",p),void h(null,o)}a.isPromise(u)?u.then(function(p){p&&(d.data=p),h(null,d)},function(p){h(p,o)}):h(null,d)}},addConfigToPayload:function(c,o,l){if(!o.sendConfig)return l(null,c);var h=a.get(c,"data.custom")||{};h._rollbarConfig=o,c.data.custom=h,l(null,c)},addConfiguredOptions:function(c,o,l){var h=o._configuredOptions;r(h,"transform"),r(h,"checkIgnore"),r(h,"onSendCallback"),delete h.accessToken,c.data.notifier.configured_options=h,l(null,c)},addDiagnosticKeys:function(c,o,l){var h=a.merge(c.notifier.client.notifier.diagnostic,c.diagnostic);if(a.get(c,"err._isAnonymous")&&(h.is_anonymous=!0),c._isUncaught&&(h.is_uncaught=c._isUncaught),c.err)try{h.raw_error={message:c.err.message,name:c.err.name,constructor_name:c.err.constructor&&c.err.constructor.name,filename:c.err.fileName,line:c.err.lineNumber,column:c.err.columnNumber,stack:c.err.stack}}catch(d){h.raw_error={failed:String(d)}}c.data.notifier.diagnostic=a.merge(c.data.notifier.diagnostic,h),l(null,c)}}},function(t,s,n){var a=n(0);t.exports={checkIgnore:function(r,c){return!a.get(c,"plugins.jquery.ignoreAjaxErrors")||!a.get(r,"body.message.extra.isAjax")}}},function(t,s,n){var a=n(0);function r(o,l,h){if(!o)return!h;var d,u,p=o.frames;if(!p||p.length===0)return!h;for(var g=l.length,m=p.length,E=0;E<m;E++){if(d=p[E].filename,!a.isType(d,"string"))return!h;for(var f=0;f<g;f++)if(u=l[f],new RegExp(u).test(d))return!0}return!1}function c(o,l,h,d){var u,p,g=!1;h==="blocklist"&&(g=!0);try{if(u=g?l.hostBlockList:l.hostSafeList,p=a.get(o,"body.trace_chain")||[a.get(o,"body.trace")],!u||u.length===0||p.length===0||!p[0])return!g;for(var m=p.length,E=0;E<m;E++)if(r(p[E],u,g))return!0}catch(y){g?l.hostBlockList=null:l.hostSafeList=null;var f=g?"hostBlockList":"hostSafeList";return d.error("Error while reading your configuration's "+f+" option. Removing custom "+f+".",y),!g}return!1}t.exports={checkLevel:function(o,l){var h=o.level,d=a.LEVELS[h]||0,u=l.reportLevel;return!(d<(a.LEVELS[u]||0))},userCheckIgnore:function(o){return function(l,h){var d=!!l._isUncaught;delete l._isUncaught;var u=l._originalArgs;delete l._originalArgs;try{a.isFunction(h.onSendCallback)&&h.onSendCallback(d,u,l)}catch(p){h.onSendCallback=null,o.error("Error while calling onSendCallback, removing",p)}try{if(a.isFunction(h.checkIgnore)&&h.checkIgnore(d,u,l))return!1}catch(p){h.checkIgnore=null,o.error("Error while calling custom checkIgnore(), removing",p)}return!0}},urlIsNotBlockListed:function(o){return function(l,h){return!c(l,h,"blocklist",o)}},urlIsSafeListed:function(o){return function(l,h){return c(l,h,"safelist",o)}},messageIsIgnored:function(o){return function(l,h){var d,u,p,g,m,E;try{if(!(p=h.ignoredMessages)||p.length===0||(E=function(f){var y=f.body,S=[];if(y.trace_chain)for(var T=y.trace_chain,b=0;b<T.length;b++){var C=T[b];S.push(a.get(C,"exception.message"))}return y.trace&&S.push(a.get(y,"trace.exception.message")),y.message&&S.push(a.get(y,"message.body")),S}(l)).length===0)return!0;for(g=p.length,d=0;d<g;d++)for(m=new RegExp(p[d],"gi"),u=0;u<E.length;u++)if(m.test(E[u]))return!1}catch{h.ignoredMessages=null,o.error("Error while reading your configuration's ignoredMessages option. Removing custom ignoredMessages.")}return!0}}}},function(t,s,n){t.exports={version:"2.26.1",endpoint:"api.rollbar.com/api/1/item/",logLevel:"debug",reportLevel:"debug",uncaughtErrorLevel:"error",maxItems:0,itemsPerMin:60}},function(t,s,n){t.exports={scrubFields:["pw","pass","passwd","password","secret","confirm_password","confirmPassword","password_confirmation","passwordConfirmation","access_token","accessToken","X-Rollbar-Access-Token","secret_key","secretKey","secretToken","cc-number","card number","cardnumber","cardnum","ccnum","ccnumber","cc num","creditcardnumber","credit card number","newcreditcardnumber","new credit card","creditcardno","credit card no","card#","card #","cc-csc","cvc","cvc2","cvv2","ccv2","security code","card verification","name on credit card","name on card","nameoncard","cardholder","card holder","name des karteninhabers","ccname","card type","cardtype","cc type","cctype","payment type","expiration date","expirationdate","expdate","cc-exp","ccmonth","ccyear"]}},function(t,s,n){var a=n(0);function r(o){this.queue=[],this.options=a.merge(o);var l=this.options.maxTelemetryEvents||100;this.maxQueueSize=Math.max(0,Math.min(l,100))}function c(o,l){return l||{error:"error",manual:"info"}[o]||"info"}r.prototype.configure=function(o){var l=this.options;this.options=a.merge(l,o);var h=this.options.maxTelemetryEvents||100,d=Math.max(0,Math.min(h,100)),u=0;this.maxQueueSize>d&&(u=this.maxQueueSize-d),this.maxQueueSize=d,this.queue.splice(0,u)},r.prototype.copyEvents=function(){var o=Array.prototype.slice.call(this.queue,0);if(a.isFunction(this.options.filterTelemetry))try{for(var l=o.length;l--;)this.options.filterTelemetry(o[l])&&o.splice(l,1)}catch{this.options.filterTelemetry=null}return o},r.prototype.capture=function(o,l,h,d,u){var p={level:c(o,h),type:o,timestamp_ms:u||a.now(),body:l,source:"client"};d&&(p.uuid=d);try{if(a.isFunction(this.options.filterTelemetry)&&this.options.filterTelemetry(p))return!1}catch{this.options.filterTelemetry=null}return this.push(p),p},r.prototype.captureEvent=function(o,l,h,d){return this.capture(o,l,h,d)},r.prototype.captureError=function(o,l,h,d){var u={message:o.message||String(o)};return o.stack&&(u.stack=o.stack),this.capture("error",u,l,h,d)},r.prototype.captureLog=function(o,l,h,d){return this.capture("log",{message:o},l,h,d)},r.prototype.captureNetwork=function(o,l,h,d){l=l||"xhr",o.subtype=o.subtype||l,d&&(o.request=d);var u=this.levelFromStatus(o.status_code);return this.capture("network",o,u,h)},r.prototype.levelFromStatus=function(o){return o>=200&&o<400?"info":o===0||o>=400?"error":"info"},r.prototype.captureDom=function(o,l,h,d,u){var p={subtype:o,element:l};return h!==void 0&&(p.value=h),d!==void 0&&(p.checked=d),this.capture("dom",p,"info",u)},r.prototype.captureNavigation=function(o,l,h){return this.capture("navigation",{from:o,to:l},"info",h)},r.prototype.captureDomContentLoaded=function(o){return this.capture("navigation",{subtype:"DOMContentLoaded"},"info",void 0,o&&o.getTime())},r.prototype.captureLoad=function(o){return this.capture("navigation",{subtype:"load"},"info",void 0,o&&o.getTime())},r.prototype.captureConnectivityChange=function(o,l){return this.captureNetwork({change:o},"connectivity",l)},r.prototype._captureRollbarItem=function(o){if(this.options.includeItemsInTelemetry)return o.err?this.captureError(o.err,o.level,o.uuid,o.timestamp):o.message?this.captureLog(o.message,o.level,o.uuid,o.timestamp):o.custom?this.capture("log",o.custom,o.level,o.uuid,o.timestamp):void 0},r.prototype.push=function(o){this.queue.push(o),this.queue.length>this.maxQueueSize&&this.queue.shift()},t.exports=r},function(t,s,n){var a=n(0),r=n(33),c=n(4),o=n(2),l=n(34),h={network:!0,networkResponseHeaders:!1,networkResponseBody:!1,networkRequestHeaders:!1,networkRequestBody:!1,networkErrorOnHttp5xx:!1,networkErrorOnHttp4xx:!1,networkErrorOnHttp0:!1,log:!0,dom:!0,navigation:!0,connectivity:!0,contentSecurityPolicy:!0,errorOnContentSecurityPolicy:!1};function d(g,m,E,f,y){var S=g[m];g[m]=E(S),f&&f[y].push([g,m,S])}function u(g,m){for(var E;g[m].length;)(E=g[m].shift())[0][E[1]]=E[2]}function p(g,m,E,f,y){this.options=g;var S=g.autoInstrument;g.enabled===!1||S===!1?this.autoInstrument={}:(a.isType(S,"object")||(S=h),this.autoInstrument=a.merge(h,S)),this.scrubTelemetryInputs=!!g.scrubTelemetryInputs,this.telemetryScrubber=g.telemetryScrubber,this.defaultValueScrubber=function(T){for(var b=[],C=0;C<T.length;++C)b.push(new RegExp(T[C],"i"));return function(O){var v=function(P){if(!P||!P.attributes)return null;for(var D=P.attributes,M=0;M<D.length;++M)if(D[M].key==="name")return D[M].value;return null}(O);if(!v)return!1;for(var w=0;w<b.length;++w)if(b[w].test(v))return!0;return!1}}(g.scrubFields),this.telemeter=m,this.rollbar=E,this.diagnostic=E.client.notifier.diagnostic,this._window=f||{},this._document=y||{},this.replacements={network:[],log:[],navigation:[],connectivity:[]},this.eventRemovers={dom:[],connectivity:[],contentsecuritypolicy:[]},this._location=this._window.location,this._lastHref=this._location&&this._location.href}p.prototype.configure=function(g){this.options=a.merge(this.options,g);var m=g.autoInstrument,E=a.merge(this.autoInstrument);g.enabled===!1||m===!1?this.autoInstrument={}:(a.isType(m,"object")||(m=h),this.autoInstrument=a.merge(h,m)),this.instrument(E),g.scrubTelemetryInputs!==void 0&&(this.scrubTelemetryInputs=!!g.scrubTelemetryInputs),g.telemetryScrubber!==void 0&&(this.telemetryScrubber=g.telemetryScrubber)},p.prototype.instrument=function(g){!this.autoInstrument.network||g&&g.network?!this.autoInstrument.network&&g&&g.network&&this.deinstrumentNetwork():this.instrumentNetwork(),!this.autoInstrument.log||g&&g.log?!this.autoInstrument.log&&g&&g.log&&this.deinstrumentConsole():this.instrumentConsole(),!this.autoInstrument.dom||g&&g.dom?!this.autoInstrument.dom&&g&&g.dom&&this.deinstrumentDom():this.instrumentDom(),!this.autoInstrument.navigation||g&&g.navigation?!this.autoInstrument.navigation&&g&&g.navigation&&this.deinstrumentNavigation():this.instrumentNavigation(),!this.autoInstrument.connectivity||g&&g.connectivity?!this.autoInstrument.connectivity&&g&&g.connectivity&&this.deinstrumentConnectivity():this.instrumentConnectivity(),!this.autoInstrument.contentSecurityPolicy||g&&g.contentSecurityPolicy?!this.autoInstrument.contentSecurityPolicy&&g&&g.contentSecurityPolicy&&this.deinstrumentContentSecurityPolicy():this.instrumentContentSecurityPolicy()},p.prototype.deinstrumentNetwork=function(){u(this.replacements,"network")},p.prototype.instrumentNetwork=function(){var g=this;function m(f,y){f in y&&a.isFunction(y[f])&&d(y,f,function(S){return g.rollbar.wrap(S)})}if("XMLHttpRequest"in this._window){var E=this._window.XMLHttpRequest.prototype;d(E,"open",function(f){return function(y,S){return a.isType(S,"string")&&(this.__rollbar_xhr?(this.__rollbar_xhr.method=y,this.__rollbar_xhr.url=S,this.__rollbar_xhr.status_code=null,this.__rollbar_xhr.start_time_ms=a.now(),this.__rollbar_xhr.end_time_ms=null):this.__rollbar_xhr={method:y,url:S,status_code:null,start_time_ms:a.now(),end_time_ms:null}),f.apply(this,arguments)}},this.replacements,"network"),d(E,"setRequestHeader",function(f){return function(y,S){return this.__rollbar_xhr||(this.__rollbar_xhr={}),a.isType(y,"string")&&a.isType(S,"string")&&(g.autoInstrument.networkRequestHeaders&&(this.__rollbar_xhr.request_headers||(this.__rollbar_xhr.request_headers={}),this.__rollbar_xhr.request_headers[y]=S),y.toLowerCase()==="content-type"&&(this.__rollbar_xhr.request_content_type=S)),f.apply(this,arguments)}},this.replacements,"network"),d(E,"send",function(f){return function(y){var S=this;function T(){if(S.__rollbar_xhr&&(S.__rollbar_xhr.status_code===null&&(S.__rollbar_xhr.status_code=0,g.autoInstrument.networkRequestBody&&(S.__rollbar_xhr.request=y),S.__rollbar_event=g.captureNetwork(S.__rollbar_xhr,"xhr",void 0)),S.readyState<2&&(S.__rollbar_xhr.start_time_ms=a.now()),S.readyState>3)){S.__rollbar_xhr.end_time_ms=a.now();var b=null;if(S.__rollbar_xhr.response_content_type=S.getResponseHeader("Content-Type"),g.autoInstrument.networkResponseHeaders){var C=g.autoInstrument.networkResponseHeaders;b={};try{var O,v;if(C===!0){var w=S.getAllResponseHeaders();if(w){var P,D,M=w.trim().split(/[\r\n]+/);for(v=0;v<M.length;v++)O=(P=M[v].split(": ")).shift(),D=P.join(": "),b[O]=D}}else for(v=0;v<C.length;v++)b[O=C[v]]=S.getResponseHeader(O)}catch{}}var N=null;if(g.autoInstrument.networkResponseBody)try{N=S.responseText}catch{}var F=null;(N||b)&&(F={},N&&(g.isJsonContentType(S.__rollbar_xhr.response_content_type)?F.body=g.scrubJson(N):F.body=N),b&&(F.headers=b)),F&&(S.__rollbar_xhr.response=F);try{var U=S.status;U=U===1223?204:U,S.__rollbar_xhr.status_code=U,S.__rollbar_event.level=g.telemeter.levelFromStatus(U),g.errorOnHttpStatus(S.__rollbar_xhr)}catch{}}}return m("onload",S),m("onerror",S),m("onprogress",S),"onreadystatechange"in S&&a.isFunction(S.onreadystatechange)?d(S,"onreadystatechange",function(b){return g.rollbar.wrap(b,void 0,T)}):S.onreadystatechange=T,S.__rollbar_xhr&&g.trackHttpErrors()&&(S.__rollbar_xhr.stack=new Error().stack),f.apply(this,arguments)}},this.replacements,"network")}"fetch"in this._window&&d(this._window,"fetch",function(f){return function(y,S){for(var T=new Array(arguments.length),b=0,C=T.length;b<C;b++)T[b]=arguments[b];var O,v=T[0],w="GET";a.isType(v,"string")?O=v:v&&(O=v.url,v.method&&(w=v.method)),T[1]&&T[1].method&&(w=T[1].method);var P={method:w,url:O,status_code:null,start_time_ms:a.now(),end_time_ms:null};if(T[1]&&T[1].headers){var D=r(T[1].headers);P.request_content_type=D.get("Content-Type"),g.autoInstrument.networkRequestHeaders&&(P.request_headers=g.fetchHeaders(D,g.autoInstrument.networkRequestHeaders))}return g.autoInstrument.networkRequestBody&&(T[1]&&T[1].body?P.request=T[1].body:T[0]&&!a.isType(T[0],"string")&&T[0].body&&(P.request=T[0].body)),g.captureNetwork(P,"fetch",void 0),g.trackHttpErrors()&&(P.stack=new Error().stack),f.apply(this,T).then(function(M){P.end_time_ms=a.now(),P.status_code=M.status,P.response_content_type=M.headers.get("Content-Type");var N=null;g.autoInstrument.networkResponseHeaders&&(N=g.fetchHeaders(M.headers,g.autoInstrument.networkResponseHeaders));var F=null;return g.autoInstrument.networkResponseBody&&typeof M.text=="function"&&(F=M.clone().text()),(N||F)&&(P.response={},F&&(typeof F.then=="function"?F.then(function(U){U&&g.isJsonContentType(P.response_content_type)?P.response.body=g.scrubJson(U):P.response.body=U}):P.response.body=F),N&&(P.response.headers=N)),g.errorOnHttpStatus(P),M})}},this.replacements,"network")},p.prototype.captureNetwork=function(g,m,E){return g.request&&this.isJsonContentType(g.request_content_type)&&(g.request=this.scrubJson(g.request)),this.telemeter.captureNetwork(g,m,E)},p.prototype.isJsonContentType=function(g){return!!(g&&a.isType(g,"string")&&g.toLowerCase().includes("json"))},p.prototype.scrubJson=function(g){return JSON.stringify(c(JSON.parse(g),this.options.scrubFields))},p.prototype.fetchHeaders=function(g,m){var E={};try{var f;if(m===!0){if(typeof g.entries=="function")for(var y=g.entries(),S=y.next();!S.done;)E[S.value[0]]=S.value[1],S=y.next()}else for(f=0;f<m.length;f++){var T=m[f];E[T]=g.get(T)}}catch{}return E},p.prototype.trackHttpErrors=function(){return this.autoInstrument.networkErrorOnHttp5xx||this.autoInstrument.networkErrorOnHttp4xx||this.autoInstrument.networkErrorOnHttp0},p.prototype.errorOnHttpStatus=function(g){var m=g.status_code;if(m>=500&&this.autoInstrument.networkErrorOnHttp5xx||m>=400&&this.autoInstrument.networkErrorOnHttp4xx||m===0&&this.autoInstrument.networkErrorOnHttp0){var E=new Error("HTTP request failed with Status "+m);E.stack=g.stack,this.rollbar.error(E,{skipFrames:1})}},p.prototype.deinstrumentConsole=function(){if("console"in this._window&&this._window.console.log)for(var g;this.replacements.log.length;)g=this.replacements.log.shift(),this._window.console[g[0]]=g[1]},p.prototype.instrumentConsole=function(){if("console"in this._window&&this._window.console.log){var g=this,m=this._window.console,E=["debug","info","warn","error","log"];try{for(var f=0,y=E.length;f<y;f++)S(E[f])}catch(T){this.diagnostic.instrumentConsole={error:T.message}}}function S(T){var b=m[T],C=m,O=T==="warn"?"warning":T;m[T]=function(){var v=Array.prototype.slice.call(arguments),w=a.formatArgsAsString(v);g.telemeter.captureLog(w,O),b&&Function.prototype.apply.call(b,C,v)},g.replacements.log.push([T,b])}},p.prototype.deinstrumentDom=function(){("addEventListener"in this._window||"attachEvent"in this._window)&&this.removeListeners("dom")},p.prototype.instrumentDom=function(){if("addEventListener"in this._window||"attachEvent"in this._window){var g=this.handleClick.bind(this),m=this.handleBlur.bind(this);this.addListener("dom",this._window,"click","onclick",g,!0),this.addListener("dom",this._window,"blur","onfocusout",m,!0)}},p.prototype.handleClick=function(g){try{var m=l.getElementFromEvent(g,this._document),E=m&&m.tagName,f=l.isDescribedElement(m,"a")||l.isDescribedElement(m,"button");E&&(f||l.isDescribedElement(m,"input",["button","submit"]))?this.captureDomEvent("click",m):l.isDescribedElement(m,"input",["checkbox","radio"])&&this.captureDomEvent("input",m,m.value,m.checked)}catch{}},p.prototype.handleBlur=function(g){try{var m=l.getElementFromEvent(g,this._document);m&&m.tagName&&(l.isDescribedElement(m,"textarea")?this.captureDomEvent("input",m,m.value):l.isDescribedElement(m,"select")&&m.options&&m.options.length?this.handleSelectInputChanged(m):l.isDescribedElement(m,"input")&&!l.isDescribedElement(m,"input",["button","submit","hidden","checkbox","radio"])&&this.captureDomEvent("input",m,m.value))}catch{}},p.prototype.handleSelectInputChanged=function(g){if(g.multiple)for(var m=0;m<g.options.length;m++)g.options[m].selected&&this.captureDomEvent("input",g,g.options[m].value);else g.selectedIndex>=0&&g.options[g.selectedIndex]&&this.captureDomEvent("input",g,g.options[g.selectedIndex].value)},p.prototype.captureDomEvent=function(g,m,E,f){if(E!==void 0)if(this.scrubTelemetryInputs||l.getElementType(m)==="password")E="[scrubbed]";else{var y=l.describeElement(m);this.telemetryScrubber?this.telemetryScrubber(y)&&(E="[scrubbed]"):this.defaultValueScrubber(y)&&(E="[scrubbed]")}var S=l.elementArrayToString(l.treeToArray(m));this.telemeter.captureDom(g,S,E,f)},p.prototype.deinstrumentNavigation=function(){var g=this._window.chrome;!(g&&g.app&&g.app.runtime)&&this._window.history&&this._window.history.pushState&&u(this.replacements,"navigation")},p.prototype.instrumentNavigation=function(){var g=this._window.chrome;if(!(g&&g.app&&g.app.runtime)&&this._window.history&&this._window.history.pushState){var m=this;d(this._window,"onpopstate",function(E){return function(){var f=m._location.href;m.handleUrlChange(m._lastHref,f),E&&E.apply(this,arguments)}},this.replacements,"navigation"),d(this._window.history,"pushState",function(E){return function(){var f=arguments.length>2?arguments[2]:void 0;return f&&m.handleUrlChange(m._lastHref,f+""),E.apply(this,arguments)}},this.replacements,"navigation")}},p.prototype.handleUrlChange=function(g,m){var E=o.parse(this._location.href),f=o.parse(m),y=o.parse(g);this._lastHref=m,E.protocol===f.protocol&&E.host===f.host&&(m=f.path+(f.hash||"")),E.protocol===y.protocol&&E.host===y.host&&(g=y.path+(y.hash||"")),this.telemeter.captureNavigation(g,m)},p.prototype.deinstrumentConnectivity=function(){("addEventListener"in this._window||"body"in this._document)&&(this._window.addEventListener?this.removeListeners("connectivity"):u(this.replacements,"connectivity"))},p.prototype.instrumentConnectivity=function(){if("addEventListener"in this._window||"body"in this._document)if(this._window.addEventListener)this.addListener("connectivity",this._window,"online",void 0,function(){this.telemeter.captureConnectivityChange("online")}.bind(this),!0),this.addListener("connectivity",this._window,"offline",void 0,function(){this.telemeter.captureConnectivityChange("offline")}.bind(this),!0);else{var g=this;d(this._document.body,"ononline",function(m){return function(){g.telemeter.captureConnectivityChange("online"),m&&m.apply(this,arguments)}},this.replacements,"connectivity"),d(this._document.body,"onoffline",function(m){return function(){g.telemeter.captureConnectivityChange("offline"),m&&m.apply(this,arguments)}},this.replacements,"connectivity")}},p.prototype.handleCspEvent=function(g){var m="Security Policy Violation: blockedURI: "+g.blockedURI+", violatedDirective: "+g.violatedDirective+", effectiveDirective: "+g.effectiveDirective+", ";g.sourceFile&&(m+="location: "+g.sourceFile+", line: "+g.lineNumber+", col: "+g.columnNumber+", "),m+="originalPolicy: "+g.originalPolicy,this.telemeter.captureLog(m,"error"),this.handleCspError(m)},p.prototype.handleCspError=function(g){this.autoInstrument.errorOnContentSecurityPolicy&&this.rollbar.error(g)},p.prototype.deinstrumentContentSecurityPolicy=function(){"addEventListener"in this._document&&this.removeListeners("contentsecuritypolicy")},p.prototype.instrumentContentSecurityPolicy=function(){if("addEventListener"in this._document){var g=this.handleCspEvent.bind(this);this.addListener("contentsecuritypolicy",this._document,"securitypolicyviolation",null,g,!1)}},p.prototype.addListener=function(g,m,E,f,y,S){m.addEventListener?(m.addEventListener(E,y,S),this.eventRemovers[g].push(function(){m.removeEventListener(E,y,S)})):f&&(m.attachEvent(f,y),this.eventRemovers[g].push(function(){m.detachEvent(f,y)}))},p.prototype.removeListeners=function(g){for(;this.eventRemovers[g].length;)this.eventRemovers[g].shift()()},t.exports=p},function(t,s,n){function a(c){return typeof c!="string"&&(c=String(c)),c.toLowerCase()}function r(c){this.map={},c instanceof r?c.forEach(function(o,l){this.append(l,o)},this):Array.isArray(c)?c.forEach(function(o){this.append(o[0],o[1])},this):c&&Object.getOwnPropertyNames(c).forEach(function(o){this.append(o,c[o])},this)}r.prototype.append=function(c,o){c=a(c),o=function(h){return typeof h!="string"&&(h=String(h)),h}(o);var l=this.map[c];this.map[c]=l?l+", "+o:o},r.prototype.get=function(c){return c=a(c),this.has(c)?this.map[c]:null},r.prototype.has=function(c){return this.map.hasOwnProperty(a(c))},r.prototype.forEach=function(c,o){for(var l in this.map)this.map.hasOwnProperty(l)&&c.call(o,this.map[l],l,this)},r.prototype.entries=function(){var c=[];return this.forEach(function(o,l){c.push([l,o])}),function(o){return{next:function(){var l=o.shift();return{done:l===void 0,value:l}}}}(c)},t.exports=function(c){return typeof Headers>"u"?new r(c):new Headers(c)}},function(t,s,n){function a(o){return(o.getAttribute("type")||"").toLowerCase()}function r(o){if(!o||!o.tagName)return"";var l=[o.tagName];o.id&&l.push("#"+o.id),o.classes&&l.push("."+o.classes.join("."));for(var h=0;h<o.attributes.length;h++)l.push("["+o.attributes[h].key+'="'+o.attributes[h].value+'"]');return l.join("")}function c(o){if(!o||!o.tagName)return null;var l,h,d,u,p={};p.tagName=o.tagName.toLowerCase(),o.id&&(p.id=o.id),(l=o.className)&&typeof l=="string"&&(p.classes=l.split(/\s+/));var g=["type","name","title","alt"];for(p.attributes=[],u=0;u<g.length;u++)h=g[u],(d=o.getAttribute(h))&&p.attributes.push({key:h,value:d});return p}t.exports={describeElement:c,descriptionToString:r,elementArrayToString:function(o){for(var l,h,d=3,u=[],p=0,g=o.length-1;g>=0;g--){if(l=r(o[g]),h=p+u.length*d+l.length,g<o.length-1&&h>=83){u.unshift("...");break}u.unshift(l),p+=l.length}return u.join(" > ")},treeToArray:function(o){for(var l,h=[],d=0;o&&d<5&&(l=c(o)).tagName!=="html";d++)h.unshift(l),o=o.parentNode;return h},getElementFromEvent:function(o,l){return o.target?o.target:l&&l.elementFromPoint?l.elementFromPoint(o.clientX,o.clientY):void 0},isDescribedElement:function(o,l,h){if(o.tagName.toLowerCase()!==l.toLowerCase())return!1;if(!h)return!0;o=a(o);for(var d=0;d<h.length;d++)if(h[d]===o)return!0;return!1},getElementType:a}},function(t,s,n){var a=n(36);t.exports=a},function(t,s){t.exports=function(n){var a,r,c,o,l,h,d,u,p,g,m,E,f,y=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;function S(C){return C<10?"0"+C:C}function T(){return this.valueOf()}function b(C){return y.lastIndex=0,y.test(C)?'"'+C.replace(y,function(O){var v=c[O];return typeof v=="string"?v:"\\u"+("0000"+O.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+C+'"'}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+S(this.getUTCMonth()+1)+"-"+S(this.getUTCDate())+"T"+S(this.getUTCHours())+":"+S(this.getUTCMinutes())+":"+S(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=T,Number.prototype.toJSON=T,String.prototype.toJSON=T),typeof n.stringify!="function"&&(c={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},n.stringify=function(C,O,v){var w;if(a="",r="",typeof v=="number")for(w=0;w<v;w+=1)r+=" ";else typeof v=="string"&&(r=v);if(o=O,O&&typeof O!="function"&&(typeof O!="object"||typeof O.length!="number"))throw new Error("JSON.stringify");return function P(D,M){var N,F,U,X,oe,ge=a,ie=M[D];switch(ie&&typeof ie=="object"&&typeof ie.toJSON=="function"&&(ie=ie.toJSON(D)),typeof o=="function"&&(ie=o.call(M,D,ie)),typeof ie){case"string":return b(ie);case"number":return isFinite(ie)?String(ie):"null";case"boolean":case"null":return String(ie);case"object":if(!ie)return"null";if(a+=r,oe=[],Object.prototype.toString.apply(ie)==="[object Array]"){for(X=ie.length,N=0;N<X;N+=1)oe[N]=P(N,ie)||"null";return U=oe.length===0?"[]":a?`[
`+a+oe.join(`,
`+a)+`
`+ge+"]":"["+oe.join(",")+"]",a=ge,U}if(o&&typeof o=="object")for(X=o.length,N=0;N<X;N+=1)typeof o[N]=="string"&&(U=P(F=o[N],ie))&&oe.push(b(F)+(a?": ":":")+U);else for(F in ie)Object.prototype.hasOwnProperty.call(ie,F)&&(U=P(F,ie))&&oe.push(b(F)+(a?": ":":")+U);return U=oe.length===0?"{}":a?`{
`+a+oe.join(`,
`+a)+`
`+ge+"}":"{"+oe.join(",")+"}",a=ge,U}}("",{"":C})}),typeof n.parse!="function"&&(n.parse=(g={"\\":"\\",'"':'"',"/":"/",t:"	",n:`
`,r:"\r",f:"\f",b:"\b"},m={go:function(){l="ok"},firstokey:function(){u=p,l="colon"},okey:function(){u=p,l="colon"},ovalue:function(){l="ocomma"},firstavalue:function(){l="acomma"},avalue:function(){l="acomma"}},E={go:function(){l="ok"},ovalue:function(){l="ocomma"},firstavalue:function(){l="acomma"},avalue:function(){l="acomma"}},f={"{":{go:function(){h.push({state:"ok"}),d={},l="firstokey"},ovalue:function(){h.push({container:d,state:"ocomma",key:u}),d={},l="firstokey"},firstavalue:function(){h.push({container:d,state:"acomma"}),d={},l="firstokey"},avalue:function(){h.push({container:d,state:"acomma"}),d={},l="firstokey"}},"}":{firstokey:function(){var C=h.pop();p=d,d=C.container,u=C.key,l=C.state},ocomma:function(){var C=h.pop();d[u]=p,p=d,d=C.container,u=C.key,l=C.state}},"[":{go:function(){h.push({state:"ok"}),d=[],l="firstavalue"},ovalue:function(){h.push({container:d,state:"ocomma",key:u}),d=[],l="firstavalue"},firstavalue:function(){h.push({container:d,state:"acomma"}),d=[],l="firstavalue"},avalue:function(){h.push({container:d,state:"acomma"}),d=[],l="firstavalue"}},"]":{firstavalue:function(){var C=h.pop();p=d,d=C.container,u=C.key,l=C.state},acomma:function(){var C=h.pop();d.push(p),p=d,d=C.container,u=C.key,l=C.state}},":":{colon:function(){if(Object.hasOwnProperty.call(d,u))throw new SyntaxError("Duplicate key '"+u+'"');l="ovalue"}},",":{ocomma:function(){d[u]=p,l="okey"},acomma:function(){d.push(p),l="avalue"}},true:{go:function(){p=!0,l="ok"},ovalue:function(){p=!0,l="ocomma"},firstavalue:function(){p=!0,l="acomma"},avalue:function(){p=!0,l="acomma"}},false:{go:function(){p=!1,l="ok"},ovalue:function(){p=!1,l="ocomma"},firstavalue:function(){p=!1,l="acomma"},avalue:function(){p=!1,l="acomma"}},null:{go:function(){p=null,l="ok"},ovalue:function(){p=null,l="ocomma"},firstavalue:function(){p=null,l="acomma"},avalue:function(){p=null,l="acomma"}}},function(C,O){var v,w,P=/^[\u0020\t\n\r]*(?:([,:\[\]{}]|true|false|null)|(-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)|"((?:[^\r\n\t\\\"]|\\(?:["\\\/trnfb]|u[0-9a-fA-F]{4}))*)")/;l="go",h=[];try{for(;v=P.exec(C);)v[1]?f[v[1]][l]():v[2]?(p=+v[2],E[l]()):(w=v[3],p=w.replace(/\\(?:u(.{4})|([^u]))/g,function(D,M,N){return M?String.fromCharCode(parseInt(M,16)):g[N]}),m[l]()),C=C.slice(v[0].length)}catch(D){l=D}if(l!=="ok"||/[^\u0020\t\n\r]/.test(C))throw l instanceof SyntaxError?l:new SyntaxError("JSON");return typeof O=="function"?function D(M,N){var F,U,X=M[N];if(X&&typeof X=="object")for(F in p)Object.prototype.hasOwnProperty.call(X,F)&&((U=D(X,F))!==void 0?X[F]=U:delete X[F]);return O.call(M,N,X)}({"":p},""):p}))}},function(t,s,n){function a(r,c,o){if(c.hasOwnProperty&&c.hasOwnProperty("addEventListener")){for(var l=c.addEventListener;l._rollbarOldAdd&&l.belongsToShim;)l=l._rollbarOldAdd;var h=function(p,g,m){l.call(this,p,r.wrap(g),m)};h._rollbarOldAdd=l,h.belongsToShim=o,c.addEventListener=h;for(var d=c.removeEventListener;d._rollbarOldRemove&&d.belongsToShim;)d=d._rollbarOldRemove;var u=function(p,g,m){d.call(this,p,g&&g._rollbar_wrapped||g,m)};u._rollbarOldRemove=d,u.belongsToShim=o,c.removeEventListener=u}}t.exports=function(r,c,o){if(r){var l,h,d="EventTarget,Window,Node,ApplicationCache,AudioTrackList,ChannelMergerNode,CryptoOperation,EventSource,FileReader,HTMLUnknownElement,IDBDatabase,IDBRequest,IDBTransaction,KeyOperation,MediaController,MessagePort,ModalWindow,Notification,SVGElementInstance,Screen,TextTrack,TextTrackCue,TextTrackList,WebSocket,WebSocketWorker,Worker,XMLHttpRequest,XMLHttpRequestEventTarget,XMLHttpRequestUpload".split(",");for(l=0;l<d.length;++l)r[h=d[l]]&&r[h].prototype&&a(c,r[h].prototype,o)}}},function(t,s,n){var a=n(0),r=n(5);function c(m,E){return[m,a.stringify(m,E)]}function o(m,E){var f=m.length;return f>2*E?m.slice(0,E).concat(m.slice(f-E)):m}function l(m,E,f){f=f===void 0?30:f;var y,S=m.data.body;if(S.trace_chain)for(var T=S.trace_chain,b=0;b<T.length;b++)y=o(y=T[b].frames,f),T[b].frames=y;else S.trace&&(y=o(y=S.trace.frames,f),S.trace.frames=y);return[m,a.stringify(m,E)]}function h(m,E){return E&&E.length>m?E.slice(0,m-3).concat("..."):E}function d(m,E,f){return[E=r(E,function y(S,T,b){switch(a.typeName(T)){case"string":return h(m,T);case"object":case"array":return r(T,y,b);default:return T}}),a.stringify(E,f)]}function u(m){return m.exception&&(delete m.exception.description,m.exception.message=h(255,m.exception.message)),m.frames=o(m.frames,1),m}function p(m,E){var f=m.data.body;if(f.trace_chain)for(var y=f.trace_chain,S=0;S<y.length;S++)y[S]=u(y[S]);else f.trace&&(f.trace=u(f.trace));return[m,a.stringify(m,E)]}function g(m,E){return a.maxByteSize(m)>E}t.exports={truncate:function(m,E,f){f=f===void 0?524288:f;for(var y,S,T,b=[c,l,d.bind(null,1024),d.bind(null,512),d.bind(null,256),p];y=b.shift();)if(m=(S=y(m,E))[0],(T=S[1]).error||!g(T.value,f))return T;return T},raw:c,truncateFrames:l,truncateStrings:d,maybeTruncateValue:h}}])})})(ap);const rp=np(Sn),op="production",cp="null",lp="0",hp="webpack:///./",up="master",{UseMockup:dp,FilterError:Hi,ListPlayerDevIds:pp}=GameCore.Configs.Rollbar;class gp extends Phaser.Plugins.BasePlugin{enable;rollbar;events=[];setup(){this.rollbar=new rp({accessToken:cp,checkIgnore:this.checkIgnore,onSendCallback:this.beforeSend,captureUncaught:!0,scrubTelemetryInputs:!0,captureUnhandledRejections:!0,autoInstrument:{dom:!1,navigation:!1},payload:{environment:op,client:{javascript:{code_version:lp}},server:{root:hp,branch:up}}}),this.enable=!0,this.sendTestException()}configure(e){this.rollbar&&this.rollbar.configure(e)}sendTestException(){const e=this.game.facebook.getPlayerID();pp.includes(e)&&this.rollbar.debug(new Error("Test rollbar"),{playerID:e})}beforeSend=(e,t,s)=>{dp&&this.showPopupError(s)};checkIgnore=(e,t,s)=>{try{return this.isErrorIgnore(t)?(console.warn(t),!0):!1}catch{return!1}};showPopupError=e=>{const t=e?.body?.trace?.exception;t&&this.events.push(t);const s=e?.body?.trace?.frames||[];this.events.push(...s);let n=document.getElementById("popup-error");n||(n=document.createElement("div"),n.id="popup-error",document.body.appendChild(n)),n.innerHTML=`<div style="color: #fff; display: flex; flex-flow: column; align-items: center; ">
      <pre id="json" style="overflow: auto; background-color: rgb(195 112 97 / 80%); padding: 10px; max-height: 80vh; max-width: 90vw; border: 5px solid #545454;">${JSON.stringify(this.events,null,2)}</pre>
      <button id="close" style="cursor: pointer; padding: 10px 20px; border-radius: 100px;">Close</button>
      </div>`,n.style="top: 0px; z-index: 10000; width: 100vw; max-height: 100vh; position: absolute; display: flex; align-items: center; justify-content: center;";const a=document.getElementById("close");a&&(a.onclick=this.closePopup)};closePopup=()=>{this.events=[{}],document.getElementById("popup-error")?.remove()};isErrorIgnore=e=>{if(!e||e.length===0)return!1;let t=!1;const s=e[0];return s instanceof Object&&(t=this.isIgnoreByCode(s)||this.isIgnoreByMessage(s)),t};isIgnoreByCode=e=>{if(GameCore.Utils.Object.hasOwn(e,"code")){const{code:t}=e,{accepted:s,ignored:n}=Hi.Codes;if(typeof t=="string"){if(s.indexOf(t)>=0)return!1;if(n.indexOf(t)>=0)return!0}}else if(GameCore.Utils.Object.hasOwn(e,"name")){const{name:t}=e,{accepted:s,ignored:n}=Hi.Codes;if(typeof t=="string"){if(s.indexOf(t)>=0)return!1;if(n.indexOf(t)>=0)return!0}}return!1};isIgnoreByMessage=e=>{if(GameCore.Utils.Object.hasOwn(e,"message")){const{message:t}=e,{accepted:s,ignored:n}=Hi.Messages;if(typeof t=="string"){if(s.indexOf(t)>=0)return!1;if(n.indexOf(t)>=0)return!0}}return!1};addExtraState=()=>{try{if(!GameCore.Utils.Object.hasOwn(window,"game")||!GameCore.Utils.Object.hasOwn(window.game,"storage")||!GameCore.Utils.Object.hasOwn(window.game.storage,"getState"))return;const{getState:e}=window.game.storage,t=e(),{player:s,match:n,...a}=t||{};this.rollbar.configure({payload:{player:s,match:n,other:a}})}catch(e){console.warn("%c addExtraState: ","font-size:12px;background-color: #42b983;color:#fff;",e)}};sendException(e,t){if(e){if(!this.enable){console.error(e);return}this.rollbar&&(this.addExtraState(),this.rollbar.error(e,t))}}}class mp extends Phaser.Events.EventEmitter{emit(e,t){return super.emit(e,t)}}class fp extends Phaser.GameObjects.Container{zone;background;constructor(e,t,s,n){super(e),this.setName(t),this.setVisible(!1);const{width:a,height:r}=this.scene.world.getWorldSize();this.setSize(s||a,n||r),this.addZone(),this.addBackground()}open(e){GameCore.Utils.Valid.isObject(e)&&(this.setDataEnabled(),this.setData(e)),this.setBlockInputOutsideEnabled(!0),this.scene.screen.bringToTop(this.name),!this.visible&&(this.setVisible(!0),this.logPageviewOnOpen(),this.logEventOpen())}close(){this.setBlockInputOutsideEnabled(!1),this.visible&&(this.setVisible(!1),this.logPageviewOnClose())}incY(e){this.y+=e,this.background.y-=e}incX(e){this.x+=e,this.background.x-=e}incScale(e){this.scale+=e,this.background.scale-=e^e*(100/e)}setBlockInputOutsideEnabled(e){this.scene.input.setTopOnly(e)}addZone(){this.zone=this.scene.add.zone(0,0,this.width,this.height),this.zone.setInteractive({}),this.add(this.zone)}addBackground(){const e="screen-background";if(!this.scene.textures.exists(e)){const t=this.width+2,s=this.height+2,n=this.scene.add.graphics();n.fillStyle(0,1),n.fillRect(0,0,t,s),n.generateTexture(e,t,s),n.destroy()}this.background=this.scene.add.image(0,0,e),this.add(this.background)}logPageviewOnOpen(){this.scene.analytics.pageview(this.name)}logPageviewOnClose(){this.scene.analytics.pageview(this.scene.scene.key)}logEventOpen(){this.scene.analytics.event(V.SCREEN_OPEN,{screen_name:this.getScreenName()})}getScreenName(){return GameCore.Utils.String.toUpperCamelCase(this.name.toLowerCase())}}const yp={OPEN:"open",CLOSE:"close",CREATED:"created"};GameCore.Screen=fp;GameCore.Screens={Events:yp};class Ep extends Phaser.Plugins.ScenePlugin{events;boot(){this.events=new mp,this.registryScreenFactory()}get(e){const t=this.scene.children.getByName(e);return t===null?null:t}add(e,t,s,n){let a=this.get(e);return a||(a=this.scene.add.screen(e,t,s,n),this.events.emit(GameCore.Screens.Events.CREATED,a),a)}open(e,t){const s=this.get(e);return s?(s.open(t),s.emit(GameCore.Screens.Events.OPEN,s),this.events.emit(GameCore.Screens.Events.OPEN,s),console.log("Screen open",e,t),!0):!1}close(e){const t=this.get(e);return t?(t.close(),t.emit(GameCore.Screens.Events.CLOSE,t),this.events.emit(GameCore.Screens.Events.CLOSE,t),console.log("Screen close",e),!0):!1}bringToTop(e){const t=this.scene.children.getByName(e);t&&this.scene.children.bringToTop(t)}registryScreenFactory(){Phaser.GameObjects.GameObjectFactory.register("screen",this.createScreen)}createScreen(e,t,s,n){const a=new t(this.scene,e,s,n);return Phaser.Display.Align.In.Center(a,this.scene.gameZone),this.existing(a),a}}var An={},Sp={get exports(){return An},set exports(i){An=i}};(function(i){(function(e,t){i.exports=t()})($o,function(){var e=Object.prototype.toString;function t(d,u){return d==null?!1:Object.prototype.hasOwnProperty.call(d,u)}function s(d){if(!d||r(d)&&d.length===0)return!0;if(typeof d!="string"){for(var u in d)if(t(d,u))return!1;return!0}return!1}function n(d){return e.call(d)}function a(d){return typeof d=="object"&&n(d)==="[object Object]"}var r=Array.isArray||function(d){return e.call(d)==="[object Array]"};function c(d){return typeof d=="boolean"||n(d)==="[object Boolean]"}function o(d){var u=parseInt(d);return u.toString()===d?u:d}function l(d){d=d||{};var u=function(f){return Object.keys(u).reduce(function(y,S){return S==="create"||typeof u[S]=="function"&&(y[S]=u[S].bind(u,f)),y},{})},p;d.includeInheritedProps?p=function(){return!0}:p=function(f,y){return typeof y=="number"&&Array.isArray(f)||t(f,y)};function g(f,y){if(p(f,y))return f[y]}var m;d.includeInheritedProps?m=function(f,y){typeof y!="string"&&typeof y!="number"&&(y=String(y));var S=g(f,y);if(y==="__proto__"||y==="prototype"||y==="constructor"&&typeof S=="function")throw new Error("For security reasons, object's magic properties cannot be set");return S}:m=function(f,y){return g(f,y)};function E(f,y,S,T){if(typeof y=="number"&&(y=[y]),!y||y.length===0)return f;if(typeof y=="string")return E(f,y.split(".").map(o),S,T);var b=y[0],C=m(f,b);return y.length===1?((C===void 0||!T)&&(f[b]=S),C):(C===void 0&&(typeof y[1]=="number"?f[b]=[]:f[b]={}),E(f[b],y.slice(1),S,T))}return u.has=function(f,y){if(typeof y=="number"?y=[y]:typeof y=="string"&&(y=y.split(".")),!y||y.length===0)return!!f;for(var S=0;S<y.length;S++){var T=o(y[S]);if(typeof T=="number"&&r(f)&&T<f.length||(d.includeInheritedProps?T in Object(f):t(f,T)))f=f[T];else return!1}return!0},u.ensureExists=function(f,y,S){return E(f,y,S,!0)},u.set=function(f,y,S,T){return E(f,y,S,T)},u.insert=function(f,y,S,T){var b=u.get(f,y);T=~~T,r(b)||(b=[],u.set(f,y,b)),b.splice(T,0,S)},u.empty=function(f,y){if(!s(y)&&f!=null){var S,T;if(S=u.get(f,y)){if(typeof S=="string")return u.set(f,y,"");if(c(S))return u.set(f,y,!1);if(typeof S=="number")return u.set(f,y,0);if(r(S))S.length=0;else if(a(S))for(T in S)p(S,T)&&delete S[T];else return u.set(f,y,null)}}},u.push=function(f,y){var S=u.get(f,y);r(S)||(S=[],u.set(f,y,S)),S.push.apply(S,Array.prototype.slice.call(arguments,2))},u.coalesce=function(f,y,S){for(var T,b=0,C=y.length;b<C;b++)if((T=u.get(f,y[b]))!==void 0)return T;return S},u.get=function(f,y,S){if(typeof y=="number"&&(y=[y]),!y||y.length===0)return f;if(f==null)return S;if(typeof y=="string")return u.get(f,y.split("."),S);var T=o(y[0]),b=m(f,T);return b===void 0?S:y.length===1?b:u.get(f[T],y.slice(1),S)},u.del=function(y,S){if(typeof S=="number"&&(S=[S]),y==null||s(S))return y;if(typeof S=="string")return u.del(y,S.split("."));var T=o(S[0]);if(m(y,T),!p(y,T))return y;if(S.length===1)r(y)?y.splice(T,1):delete y[T];else return u.del(y[T],S.slice(1));return y},u}var h=l();return h.create=l,h.withInheritedProps=l({includeInheritedProps:!0}),h})})(Sp);var Ma=An.get;function Ap(i,e){return i===e}function bp(i,e,t){t=t||Ap;var s=Ma(i(),e);return function(a){return function(){var r=Ma(i(),e);if(!t(s,r)){var c=s;s=r,a(r,c,e)}}}}var Tp=bp;const wp=Tp;function Rs(i){return Rs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Rs(i)}function Cp(i,e){if(Rs(i)!=="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(Rs(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function Ip(i){var e=Cp(i,"string");return Rs(e)==="symbol"?e:String(e)}function Pp(i,e,t){return e=Ip(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function La(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),t.push.apply(t,s)}return t}function Ga(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?La(Object(t),!0).forEach(function(s){Pp(i,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):La(Object(t)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(t,s))})}return i}function de(i){return"Minified Redux error #"+i+"; visit https://redux.js.org/Errors?code="+i+" for the full message or use the non-minified dev environment for full errors. "}var Fa=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),zi=function(){return Math.random().toString(36).substring(7).split("").join(".")},gi={INIT:"@@redux/INIT"+zi(),REPLACE:"@@redux/REPLACE"+zi(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+zi()}};function vp(i){if(typeof i!="object"||i===null)return!1;for(var e=i;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(i)===e}function jo(i,e,t){var s;if(typeof e=="function"&&typeof t=="function"||typeof t=="function"&&typeof arguments[3]=="function")throw new Error(de(0));if(typeof e=="function"&&typeof t>"u"&&(t=e,e=void 0),typeof t<"u"){if(typeof t!="function")throw new Error(de(1));return t(jo)(i,e)}if(typeof i!="function")throw new Error(de(2));var n=i,a=e,r=[],c=r,o=!1;function l(){c===r&&(c=r.slice())}function h(){if(o)throw new Error(de(3));return a}function d(m){if(typeof m!="function")throw new Error(de(4));if(o)throw new Error(de(5));var E=!0;return l(),c.push(m),function(){if(E){if(o)throw new Error(de(6));E=!1,l();var y=c.indexOf(m);c.splice(y,1),r=null}}}function u(m){if(!vp(m))throw new Error(de(7));if(typeof m.type>"u")throw new Error(de(8));if(o)throw new Error(de(9));try{o=!0,a=n(a,m)}finally{o=!1}for(var E=r=c,f=0;f<E.length;f++){var y=E[f];y()}return m}function p(m){if(typeof m!="function")throw new Error(de(10));n=m,u({type:gi.REPLACE})}function g(){var m,E=d;return m={subscribe:function(y){if(typeof y!="object"||y===null)throw new Error(de(11));function S(){y.next&&y.next(h())}S();var T=E(S);return{unsubscribe:T}}},m[Fa]=function(){return this},m}return u({type:gi.INIT}),s={dispatch:u,subscribe:d,getState:h,replaceReducer:p},s[Fa]=g,s}function Op(i){Object.keys(i).forEach(function(e){var t=i[e],s=t(void 0,{type:gi.INIT});if(typeof s>"u")throw new Error(de(12));if(typeof t(void 0,{type:gi.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(de(13))})}function Xo(i){for(var e=Object.keys(i),t={},s=0;s<e.length;s++){var n=e[s];typeof i[n]=="function"&&(t[n]=i[n])}var a=Object.keys(t),r;try{Op(t)}catch(c){r=c}return function(o,l){if(o===void 0&&(o={}),r)throw r;for(var h=!1,d={},u=0;u<a.length;u++){var p=a[u],g=t[p],m=o[p],E=g(m,l);if(typeof E>"u")throw l&&l.type,new Error(de(14));d[p]=E,h=h||E!==m}return h=h||a.length!==Object.keys(o).length,h?d:o}}function qo(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];return e.length===0?function(s){return s}:e.length===1?e[0]:e.reduce(function(s,n){return function(){return s(n.apply(void 0,arguments))}})}function _p(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];return function(s){return function(){var n=s.apply(void 0,arguments),a=function(){throw new Error(de(15))},r={getState:n.getState,dispatch:function(){return a.apply(void 0,arguments)}},c=e.map(function(o){return o(r)});return a=qo.apply(void 0,c)(n.dispatch),Ga(Ga({},n),{},{dispatch:a})}}}function Zo(i){var e=function(s){var n=s.dispatch,a=s.getState;return function(r){return function(c){return typeof c=="function"?c(n,a,i):r(c)}}};return e}var Jo=Zo();Jo.withExtraArgument=Zo;const Rp=Jo,Qo="CONTEXT_RECEIVED",ec="CONTEXT_PROCESSED",tc="CONTEXT_GAME_MODE_DETECTED",sc="MESSAGES_SENT_UPDATE",ic="MESSAGES_SENT_REMOVE",nc="SCENE_KEY_UPDATE",xp="CHALLENGE_RANDOM_FRIEND";function Ue(i){for(var e=arguments.length,t=Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];throw Error("[Immer] minified error nr: "+i+(t.length?" "+t.map(function(n){return"'"+n+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function Ct(i){return!!i&&!!i[re]}function It(i){var e;return!!i&&(function(t){if(!t||typeof t!="object")return!1;var s=Object.getPrototypeOf(t);if(s===null)return!0;var n=Object.hasOwnProperty.call(s,"constructor")&&s.constructor;return n===Object||typeof n=="function"&&Function.toString.call(n)===Up}(i)||Array.isArray(i)||!!i[Ka]||!!(!((e=i.constructor)===null||e===void 0)&&e[Ka])||Hn(i)||zn(i))}function Pt(i,e,t){t===void 0&&(t=!1),Xt(i)===0?(t?Object.keys:Ut)(i).forEach(function(s){t&&typeof s=="symbol"||e(s,i[s],i)}):i.forEach(function(s,n){return e(n,s,i)})}function Xt(i){var e=i[re];return e?e.i>3?e.i-4:e.i:Array.isArray(i)?1:Hn(i)?2:zn(i)?3:0}function Ft(i,e){return Xt(i)===2?i.has(e):Object.prototype.hasOwnProperty.call(i,e)}function Dp(i,e){return Xt(i)===2?i.get(e):i[e]}function ac(i,e,t){var s=Xt(i);s===2?i.set(e,t):s===3?i.add(t):i[e]=t}function rc(i,e){return i===e?i!==0||1/i==1/e:i!=i&&e!=e}function Hn(i){return Gp&&i instanceof Map}function zn(i){return Fp&&i instanceof Set}function wt(i){return i.o||i.t}function Wn(i){if(Array.isArray(i))return Array.prototype.slice.call(i);var e=cc(i);delete e[re];for(var t=Ut(e),s=0;s<t.length;s++){var n=t[s],a=e[n];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(e[n]={configurable:!0,writable:!0,enumerable:a.enumerable,value:i[n]})}return Object.create(Object.getPrototypeOf(i),e)}function Vn(i,e){return e===void 0&&(e=!1),Kn(i)||Ct(i)||!It(i)||(Xt(i)>1&&(i.set=i.add=i.clear=i.delete=Bp),Object.freeze(i),e&&Pt(i,function(t,s){return Vn(s,!0)},!0)),i}function Bp(){Ue(2)}function Kn(i){return i==null||typeof i!="object"||Object.isFrozen(i)}function We(i){var e=Cn[i];return e||Ue(18,i),e}function kp(i,e){Cn[i]||(Cn[i]=e)}function bn(){return xs}function Wi(i,e){e&&(We("Patches"),i.u=[],i.s=[],i.v=e)}function mi(i){Tn(i),i.p.forEach(Np),i.p=null}function Tn(i){i===xs&&(xs=i.l)}function Ua(i){return xs={p:[],l:xs,h:i,m:!0,_:0}}function Np(i){var e=i[re];e.i===0||e.i===1?e.j():e.O=!0}function Vi(i,e){e._=e.p.length;var t=e.p[0],s=i!==void 0&&i!==t;return e.h.g||We("ES5").S(e,i,s),s?(t[re].P&&(mi(e),Ue(4)),It(i)&&(i=fi(e,i),e.l||yi(e,i)),e.u&&We("Patches").M(t[re].t,i,e.u,e.s)):i=fi(e,t,[]),mi(e),e.u&&e.v(e.u,e.s),i!==oc?i:void 0}function fi(i,e,t){if(Kn(e))return e;var s=e[re];if(!s)return Pt(e,function(c,o){return Ya(i,s,e,c,o,t)},!0),e;if(s.A!==i)return e;if(!s.P)return yi(i,s.t,!0),s.t;if(!s.I){s.I=!0,s.A._--;var n=s.i===4||s.i===5?s.o=Wn(s.k):s.o,a=n,r=!1;s.i===3&&(a=new Set(n),n.clear(),r=!0),Pt(a,function(c,o){return Ya(i,s,n,c,o,t,r)}),yi(i,n,!1),t&&i.u&&We("Patches").N(s,t,i.u,i.s)}return s.o}function Ya(i,e,t,s,n,a,r){if(Ct(n)){var c=fi(i,n,a&&e&&e.i!==3&&!Ft(e.R,s)?a.concat(s):void 0);if(ac(t,s,c),!Ct(c))return;i.m=!1}else r&&t.add(n);if(It(n)&&!Kn(n)){if(!i.h.D&&i._<1)return;fi(i,n),e&&e.A.l||yi(i,n)}}function yi(i,e,t){t===void 0&&(t=!1),!i.l&&i.h.D&&i.m&&Vn(e,t)}function Ki(i,e){var t=i[re];return(t?wt(t):i)[e]}function Ha(i,e){if(e in i)for(var t=Object.getPrototypeOf(i);t;){var s=Object.getOwnPropertyDescriptor(t,e);if(s)return s;t=Object.getPrototypeOf(t)}}function ct(i){i.P||(i.P=!0,i.l&&ct(i.l))}function $i(i){i.o||(i.o=Wn(i.t))}function wn(i,e,t){var s=Hn(e)?We("MapSet").F(e,t):zn(e)?We("MapSet").T(e,t):i.g?function(n,a){var r=Array.isArray(n),c={i:r?1:0,A:a?a.A:bn(),P:!1,I:!1,R:{},l:a,t:n,k:null,o:null,j:null,C:!1},o=c,l=Ds;r&&(o=[c],l=ws);var h=Proxy.revocable(o,l),d=h.revoke,u=h.proxy;return c.k=u,c.j=d,u}(e,t):We("ES5").J(e,t);return(t?t.A:bn()).p.push(s),s}function Mp(i){return Ct(i)||Ue(22,i),function e(t){if(!It(t))return t;var s,n=t[re],a=Xt(t);if(n){if(!n.P&&(n.i<4||!We("ES5").K(n)))return n.t;n.I=!0,s=za(t,a),n.I=!1}else s=za(t,a);return Pt(s,function(r,c){n&&Dp(n.t,r)===c||ac(s,r,e(c))}),a===3?new Set(s):s}(i)}function za(i,e){switch(e){case 2:return new Map(i);case 3:return Array.from(i)}return Wn(i)}function Lp(){function i(a,r){var c=n[a];return c?c.enumerable=r:n[a]=c={configurable:!0,enumerable:r,get:function(){var o=this[re];return Ds.get(o,a)},set:function(o){var l=this[re];Ds.set(l,a,o)}},c}function e(a){for(var r=a.length-1;r>=0;r--){var c=a[r][re];if(!c.P)switch(c.i){case 5:s(c)&&ct(c);break;case 4:t(c)&&ct(c)}}}function t(a){for(var r=a.t,c=a.k,o=Ut(c),l=o.length-1;l>=0;l--){var h=o[l];if(h!==re){var d=r[h];if(d===void 0&&!Ft(r,h))return!0;var u=c[h],p=u&&u[re];if(p?p.t!==d:!rc(u,d))return!0}}var g=!!r[re];return o.length!==Ut(r).length+(g?0:1)}function s(a){var r=a.k;if(r.length!==a.t.length)return!0;var c=Object.getOwnPropertyDescriptor(r,r.length-1);if(c&&!c.get)return!0;for(var o=0;o<r.length;o++)if(!r.hasOwnProperty(o))return!0;return!1}var n={};kp("ES5",{J:function(a,r){var c=Array.isArray(a),o=function(h,d){if(h){for(var u=Array(d.length),p=0;p<d.length;p++)Object.defineProperty(u,""+p,i(p,!0));return u}var g=cc(d);delete g[re];for(var m=Ut(g),E=0;E<m.length;E++){var f=m[E];g[f]=i(f,h||!!g[f].enumerable)}return Object.create(Object.getPrototypeOf(d),g)}(c,a),l={i:c?5:4,A:r?r.A:bn(),P:!1,I:!1,R:{},l:r,t:a,k:o,o:null,O:!1,C:!1};return Object.defineProperty(o,re,{value:l,writable:!0}),o},S:function(a,r,c){c?Ct(r)&&r[re].A===a&&e(a.p):(a.u&&function o(l){if(l&&typeof l=="object"){var h=l[re];if(h){var d=h.t,u=h.k,p=h.R,g=h.i;if(g===4)Pt(u,function(S){S!==re&&(d[S]!==void 0||Ft(d,S)?p[S]||o(u[S]):(p[S]=!0,ct(h)))}),Pt(d,function(S){u[S]!==void 0||Ft(u,S)||(p[S]=!1,ct(h))});else if(g===5){if(s(h)&&(ct(h),p.length=!0),u.length<d.length)for(var m=u.length;m<d.length;m++)p[m]=!1;else for(var E=d.length;E<u.length;E++)p[E]=!0;for(var f=Math.min(u.length,d.length),y=0;y<f;y++)u.hasOwnProperty(y)||(p[y]=!0),p[y]===void 0&&o(u[y])}}}}(a.p[0]),e(a.p))},K:function(a){return a.i===4?t(a):s(a)}})}var Wa,xs,$n=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",Gp=typeof Map<"u",Fp=typeof Set<"u",Va=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",oc=$n?Symbol.for("immer-nothing"):((Wa={})["immer-nothing"]=!0,Wa),Ka=$n?Symbol.for("immer-draftable"):"__$immer_draftable",re=$n?Symbol.for("immer-state"):"__$immer_state";var Up=""+Object.prototype.constructor,Ut=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(i){return Object.getOwnPropertyNames(i).concat(Object.getOwnPropertySymbols(i))}:Object.getOwnPropertyNames,cc=Object.getOwnPropertyDescriptors||function(i){var e={};return Ut(i).forEach(function(t){e[t]=Object.getOwnPropertyDescriptor(i,t)}),e},Cn={},Ds={get:function(i,e){if(e===re)return i;var t=wt(i);if(!Ft(t,e))return function(n,a,r){var c,o=Ha(a,r);return o?"value"in o?o.value:(c=o.get)===null||c===void 0?void 0:c.call(n.k):void 0}(i,t,e);var s=t[e];return i.I||!It(s)?s:s===Ki(i.t,e)?($i(i),i.o[e]=wn(i.A.h,s,i)):s},has:function(i,e){return e in wt(i)},ownKeys:function(i){return Reflect.ownKeys(wt(i))},set:function(i,e,t){var s=Ha(wt(i),e);if(s?.set)return s.set.call(i.k,t),!0;if(!i.P){var n=Ki(wt(i),e),a=n?.[re];if(a&&a.t===t)return i.o[e]=t,i.R[e]=!1,!0;if(rc(t,n)&&(t!==void 0||Ft(i.t,e)))return!0;$i(i),ct(i)}return i.o[e]===t&&(t!==void 0||e in i.o)||Number.isNaN(t)&&Number.isNaN(i.o[e])||(i.o[e]=t,i.R[e]=!0),!0},deleteProperty:function(i,e){return Ki(i.t,e)!==void 0||e in i.t?(i.R[e]=!1,$i(i),ct(i)):delete i.R[e],i.o&&delete i.o[e],!0},getOwnPropertyDescriptor:function(i,e){var t=wt(i),s=Reflect.getOwnPropertyDescriptor(t,e);return s&&{writable:!0,configurable:i.i!==1||e!=="length",enumerable:s.enumerable,value:t[e]}},defineProperty:function(){Ue(11)},getPrototypeOf:function(i){return Object.getPrototypeOf(i.t)},setPrototypeOf:function(){Ue(12)}},ws={};Pt(Ds,function(i,e){ws[i]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}}),ws.deleteProperty=function(i,e){return ws.set.call(this,i,e,void 0)},ws.set=function(i,e,t){return Ds.set.call(this,i[0],e,t,i[0])};var Yp=function(){function i(t){var s=this;this.g=Va,this.D=!0,this.produce=function(n,a,r){if(typeof n=="function"&&typeof a!="function"){var c=a;a=n;var o=s;return function(m){var E=this;m===void 0&&(m=c);for(var f=arguments.length,y=Array(f>1?f-1:0),S=1;S<f;S++)y[S-1]=arguments[S];return o.produce(m,function(T){var b;return(b=a).call.apply(b,[E,T].concat(y))})}}var l;if(typeof a!="function"&&Ue(6),r!==void 0&&typeof r!="function"&&Ue(7),It(n)){var h=Ua(s),d=wn(s,n,void 0),u=!0;try{l=a(d),u=!1}finally{u?mi(h):Tn(h)}return typeof Promise<"u"&&l instanceof Promise?l.then(function(m){return Wi(h,r),Vi(m,h)},function(m){throw mi(h),m}):(Wi(h,r),Vi(l,h))}if(!n||typeof n!="object"){if((l=a(n))===void 0&&(l=n),l===oc&&(l=void 0),s.D&&Vn(l,!0),r){var p=[],g=[];We("Patches").M(n,l,p,g),r(p,g)}return l}Ue(21,n)},this.produceWithPatches=function(n,a){if(typeof n=="function")return function(l){for(var h=arguments.length,d=Array(h>1?h-1:0),u=1;u<h;u++)d[u-1]=arguments[u];return s.produceWithPatches(l,function(p){return n.apply(void 0,[p].concat(d))})};var r,c,o=s.produce(n,a,function(l,h){r=l,c=h});return typeof Promise<"u"&&o instanceof Promise?o.then(function(l){return[l,r,c]}):[o,r,c]},typeof t?.useProxies=="boolean"&&this.setUseProxies(t.useProxies),typeof t?.autoFreeze=="boolean"&&this.setAutoFreeze(t.autoFreeze)}var e=i.prototype;return e.createDraft=function(t){It(t)||Ue(8),Ct(t)&&(t=Mp(t));var s=Ua(this),n=wn(this,t,void 0);return n[re].C=!0,Tn(s),n},e.finishDraft=function(t,s){var n=t&&t[re],a=n.A;return Wi(a,s),Vi(void 0,a)},e.setAutoFreeze=function(t){this.D=t},e.setUseProxies=function(t){t&&!Va&&Ue(20),this.g=t},e.applyPatches=function(t,s){var n;for(n=s.length-1;n>=0;n--){var a=s[n];if(a.path.length===0&&a.op==="replace"){t=a.value;break}}n>-1&&(s=s.slice(n+1));var r=We("Patches").$;return Ct(t)?r(t,s):this.produce(t,function(c){return r(c,s)})},i}(),Pe=new Yp,Hp=Pe.produce;Pe.produceWithPatches.bind(Pe);Pe.setAutoFreeze.bind(Pe);Pe.setUseProxies.bind(Pe);Pe.applyPatches.bind(Pe);Pe.createDraft.bind(Pe);Pe.finishDraft.bind(Pe);const ye=Hp,zp={currentSceneKey:"",prevSceneKey:""},Wp=(i=zp,e)=>ye(i,t=>{const{payload:s}=e;if(!s)return;const{sceneKey:n}=s;switch(e.type){case nc:t.currentSceneKey=n,t.prevSceneKey=i.currentSceneKey;break}});Lp();const lc={processed:!1,contextId:"",contextType:"SOLO",entryPointData:{},currentGameMode:""},ji=lc,Vp=(i=lc,e)=>ye(i,t=>{const{payload:s}=e;if(!s)return;const{gameMode:n,contextId:a,contextType:r,entryPointData:c}=s;switch(e.type){case Qo:t.contextId=a,t.contextType=r,t.entryPointData=c;break;case ec:t.contextId=a,t.contextType=r,t.processed=!0;break;case tc:t.currentGameMode=n;break}}),Kp={data:{}},$p=(i=Kp,e)=>ye(i,t=>{const{payload:s}=e;if(!s)return;const{opponentId:n}=s;if(typeof n=="string")switch(e.type){case sc:i.data[n]?t.data[n].sent=!0:t.data[n]={sent:!0};break;case ic:i.data[n]?t.data[n].sent=!1:t.data[n]={sent:!1};break}}),jp={friendListChallenged:[]},Xp=(i=jp,e)=>ye(i,t=>{const{payload:s}=e;if(!s)return;const{opponentId:n=""}=s;switch(e.type){case xp:if(!n||t.friendListChallenged.indexOf(n)>=0)break;t.friendListChallenged.push(n);break}}),qp={token:"",isRequesting:!1},Zp=(i=qp,e)=>ye(i,t=>{const{payload:s}=e;if(!s)return;const{token:n}=s;switch(e.type){case Do:t.isRequesting=!0;break;case Bo:t.token=n,t.isRequesting=!1;break}}),Jp={[Nn]:Zp},Qp={ASID:"",playerId:"",name:"",photo:"",locale:"",data:{score:0,settings:_s,userGuideDisplays:0,customFields:{}},connectedPlayers:{},isConnectedPlayersLoaded:!1,isUserNew:!0},eg=(i=Qp,e)=>ye(i,t=>{const{payload:s}=e;if(!s)return;const{name:n,value:a,data:r={},score:c,connectedPlayers:o=[],profile:l}=s;switch(e.type){case Go:{const{playerId:h,name:d,photo:u,locale:p,data:g}=s;if(t.playerId=h,t.name=d,t.photo=u,t.locale=p,GameCore.Utils.Valid.isObject(g)){const m=g;t.data=Ie(i.data,m)}g.userGuideDisplays>0&&(t.isUserNew=!1)}break;case Yo:{const{playerId:h,name:d,photo:u,locale:p,ASID:g}=l;t.ASID=g,t.playerId=h,t.name=d,t.photo=u,t.locale=p}break;case Uo:t.data.score=c;break;case Ho:if(!GameCore.Utils.Object.hasOwn(t.data.settings,n))break;t.data.settings[n]=a;break;case Fo:t.data=Ie(i.data,r),r.userGuideDisplays>0&&(t.isUserNew=!1);break;case zo:{if(t.isConnectedPlayersLoaded=!0,o.length<=0)break;const h=GameCore.Utils.Object.keyBy(o,"playerId");t.connectedPlayers=Ie(i.connectedPlayers,h)}break}}),tg={[Ys]:eg},sg={data:{},profileIds:[]},ig=(i=sg,e)=>ye(i,t=>{const{payload:s}=e;if(!s)return;const{data:n=[]}=s;switch(e.type){case Ko:{const a=GameCore.Utils.Object.keyBy(n,"playerId"),r=Object.keys(a);t.data=Ie({...i.data},a),t.profileIds=[...new Set([...i.profileIds,...r])]}break}}),ng={[Yn]:ig},hc="match",uc="MATCH_GAMEPLAY_INITIALIZE",dc="MATCH_GAMEPLAY_START",pc="MATCH_GAMEPLAY_FINISH",gc="MATCH_GAMEPLAY_UPDATE",mc="MATCH_GAMEPLAY_RESCUE",fc="MATCH_GAMEPLAY_TYPE_UPDATE",yc="MATCH_STATS_DATA_CLEAR",Ec="MATCH_STATS_DATA_UPDATE",Sc="MATCH_STATS_CURRENT_UPDATE",ag="MATCH_STATS_CONTEXT_REQUEST",rg="MATCH_STATS_CONTEXT_RECEIVED",Ac="MATCH_SINGLE_CREATE_REQUEST",bc="MATCH_SINGLE_DETAIL_REQUEST",og="MATCH_SINGLE_FINISH_REQUEST",cg="MATCH_SINGLE_MOVE_UPDATED",Tc="MATCH_SINGLE_DATA_RECEIVED",wc="MATCH_SINGLE_DATA_CLEAR",Cc="MATCH_CHALLENGE_JOIN_REQUEST",Ic="MATCH_CHALLENGE_CREATE_REQUEST",Pc="MATCH_CHALLENGE_FINISH_REQUEST",vc="MATCH_CHALLENGE_CONTINUE_REQUEST",jn="MATCH_CHALLENGE_DATA_RECEIVED",Oc="MATCH_CHALLENGE_DATA_CLEAR",_c="MATCH_GROUP_CREATE_REQUEST",Rc="MATCH_GROUP_FINISH_REQUEST",xc="MATCH_ONLINE_CREATE_REQUEST",Xn="MATCH_ONLINE_DATA_RECEIVED",Dc="MATCH_ONLINE_STATS_UPDATE",Bc="MATCH_ONLINE_FINISH_REQUEST",lg="MATCH_ONLINE_DATA_CLEAR",hg="MATCH_AUTO_PLAY_SINGLE",Gt="open",zt="active",Bs="finished",it={mode:"",status:Gt,rescued:0,startAt:0,finishAt:0,type:"endless"},ug=(i=it,e)=>ye(i,t=>{const{payload:s}=e;if(!s)return;const{mode:n,status:a,type:r}=s;switch(e.type){case uc:t.status=Gt,t.mode=it.mode,t.rescued=it.rescued,t.startAt=it.startAt,t.finishAt=it.finishAt,t.opponentInfo=it.opponentInfo,t.type=it.type;break;case dc:t.mode=n,t.status=zt,t.rescued=it.rescued,t.startAt=Date.now();break;case gc:t.mode=typeof n=="string"?n:i.mode,t.status=a||i.status;break;case pc:t.status=Bs,t.finishAt=Date.now();break;case mc:t.rescued+=1;break;case fc:t.type=r;break}}),gt={single:{_id:"",data:{fen:""},playerId:"",status:Gt},group:{status:Gt,opponentInfo:{playerId:"",name:"",photo:""}},challenge:{_id:"",status:Gt,whitePlayerId:"",blackPlayerId:"",opponentInfo:{playerId:"",name:"",photo:""}},online:{_id:"",status:Gt,players:{}},updateAt:0,isRequesting:!1,isAutoStartSingleMode:!1},dg=(i=gt,e)=>ye(i,t=>{const{payload:s}=e;if(!s)return;const{match:n,opponentInfo:a,players:r,enable:c}=s;switch(e.type){case Ac:case bc:case Cc:case Pc:case xc:t.isRequesting=!0;break;case cg:t.single={...i.single,...n},t.updateAt=Date.now();break;case Tc:t.isRequesting=!1,t.single=n||gt.single;break;case wc:t.isRequesting=!1,t.single=gt.single;break;case Ic:case vc:t.isRequesting=!0,t.challenge.opponentInfo=a;break;case jn:t.isRequesting=!1,t.challenge={...n||gt.challenge},t.challenge.opponentInfo=i.challenge.opponentInfo;break;case Oc:t.isRequesting=!1,t.challenge=gt.challenge;break;case _c:t.group.status=zt,a&&(t.group.opponentInfo=a);break;case Rc:t.group.status=Bs;break;case lg:t.online.status=gt.online.status,t.online.players=gt.online.players;break;case Xn:t.online.status=zt,t.online.players=r;break;case Bc:t.online.status=Bs;break;case hg:t.isAutoStartSingleMode=c;break}}),Xi={current:{updateAt:0},data:{updateAt:0},isRequesting:!1},pg=(i=Xi,e)=>ye(i,t=>{const{payload:s}=e;if(!s)return;const{playerId:n,stats:a,match:r,current:c,players:o,leaders:l}=s;switch(e.type){case yc:delete t.data[n],t.current=Xi.current;break;case ag:t.data=Xi.data,t.isRequesting=!0;break;case rg:t.data=a,t.isRequesting=!1;break;case Ec:t.data[n]=a;break;case Sc:t.current=Ie({...i.current},a);break;case Xn:Object.keys(o).forEach(h=>{t.data[h]={score:0}});break;case Dc:l.forEach(h=>{const{playerId:d,score:u,rank:p}=h;t.data[d]={score:u,rank:p}});break;case jn:{const{blackPlayerId:h,blackPlayerScore:d,whitePlayerId:u,whitePlayerScore:p,whitePlayerLevel:g,blackPlayerLevel:m}=r||{};if(!h||!u)break;c&&(t.current=c),t.data[h]={score:d,level:m},t.data[u]={score:p,level:g}}break}}),gg={[hc]:Xo({gameplay:ug,match:dg,stats:pg})},mg="tournament",kc="TOURNAMENT_ACTIVE",fg="TOURNAMENT_REQUEST",yg="TOURNAMENT_RECEIVED",Eg={active:!1,tournamentId:null,bestSessionScore:0,isRequesting:!1},Sg=(i=Eg,e)=>ye(i,t=>{const{payload:s}=e;if(!s)return;const{score:n=0,tournamentId:a}=s;switch(e.type){case kc:t.active=!0,t.tournamentId=a;break;case fg:t.isRequesting=!0;break;case yg:t.isRequesting=!1,n>i.bestSessionScore&&(t.bestSessionScore=n);break}}),Ag={[mg]:Sg},Nc="leaderboards",Mc="LEADERBOARD_DATA_REQUEST",Lc="LEADERBOARD_DATA_UPDATE",Gc="LEADERBOARD_DATA_CLEAR",mt={leaderboardId:"",type:"",limit:0,offset:0,leaders:{},isRequesting:!1},bg=(i=mt,e)=>ye(i,t=>{const{payload:s}=e;if(!s)return;const{leaderboardId:n,type:a,limit:r,offset:c,leaders:o}=s;switch(e.type){case Mc:i.type!==a&&c===0&&(t.leaders=mt.leaders),t.isRequesting=!0,t.leaderboardId=n,t.type=a,t.limit=r,t.offset=c;break;case Lc:{if(t.isRequesting=!1,i.type!==a)break;const l=GameCore.Utils.Json.clone({...i.leaders,...o}),d=Object.values(l).filter(u=>!!u.name);d.sort((u,p)=>+p.score-+u.score),d.forEach((u,p)=>{u.rank=p+1,t.leaders[u.playerId]=u})}break;case Gc:t.isRequesting=!1,t.type=mt.type,t.limit=mt.limit,t.offset=mt.offset,t.leaders=mt.leaders,t.leaderboardId=mt.leaderboardId;break}}),Tg={[Nc]:bg},Pi="missions",Fc="MISSIONS_DATA_REQUEST",Uc="MISSIONS_DATA_RECEIVE",wg="MISSION_START",Yc="MISSION_UPDATE",Hc="MISSION_COMPLETED",Cg={mission:null,missions:null,isRequesting:!1},Ig=(i=Cg,e)=>ye(i,t=>{const{payload:s}=e;if(!s)return;const{name:n,type:a,value:r,missions:c}=s;switch(e.type){case Fc:t.isRequesting=!0;break;case Uc:if(t.isRequesting=!1,c.length<1)return;t.missions={},c.forEach(o=>{t.missions[o.name]=o});break;case wg:{if(i.missions===null)break;const o=i.missions[n];t.mission={name:n,process:{},require:o.require,reward:o.reward},Object.keys(o.require).forEach(l=>{t.mission.process[l]=0});break}case Yc:if(i.mission?.name!==n)break;t.mission.process[a]+=r;break;case Hc:if(i.mission?.name!==n)break;t.mission=null;break}}),Pg={[Pi]:Ig},Hs="dailyTasks",zc="DAILY_TASKS_DATA_REQUEST",Wc="DAILY_TASKS_DATA_RECEIVE",Vc="DAILY_TASKS_PROCESS_UPDATE",Kc="DAILY_TASK_VALUE_ADD",$c="DAILY_TASK_REWARDED",jc="DAILY_TASKS_SEEN",Xc="DAILY_TASK_FINISHED",vg={tasks:[],process:[],isRequesting:!1,isNotice:!1},Og=(i=vg,e)=>ye(i,t=>{const{payload:s}=e;if(!s)return;const{id:n,type:a,value:r,tasks:c,process:o}=s;switch(e.type){case zc:t.isRequesting=!0;break;case Wc:t.isRequesting=!1,t.tasks=c;break;case Vc:t.process=o;break;case Kc:if(!i.process[n])break;t.process[n][a]+=r;break;case $c:if(!i.process[n])break;t.process[n].rewarded=!0;break;case jc:t.isNotice=!1;break;case Xc:t.isNotice=!0;break}}),_g={[Hs]:Og},qn="dailyRewards",qc="DAILY_REWARDS_REQUEST",Zc="DAILY_REWARDS_RECEIVE",Rg={rewards:[],isRequesting:!1},xg=(i=Rg,e)=>ye(i,t=>{const{payload:s}=e;if(!s)return;const{rewards:n}=s;switch(e.type){case qc:t.isRequesting=!0;break;case Zc:t.isRequesting=!1,t.rewards=n;break}}),Dg={[qn]:xg},Bg=Xo({scene:Wp,context:Vp,messages:$p,friendChallenge:Xp,...Jp,...tg,...ng,...gg,...Ag,...Tg,...Pg,..._g,...Dg}),{__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:w0}=window;let kg=qo;const Ng=i=>{const e=kg(_p(Rp));return jo(Bg,i,e)};class Mg extends Phaser.Plugins.BasePlugin{store;initiator;init(){this.store=Ng({})}setInitiator(e){this.initiator=e}async syncStore(){this.initiator.initContext(),await this.initiator.initPlayer()}dispatch=e=>this.store.dispatch(e);getState=()=>this.store.getState();subscribe=e=>this.store.subscribe(e);watch=(e,t)=>{const s=wp(()=>{const n=this.getState();return e(n)});return this.subscribe(s(n=>{t(n)}))}}var In={},Lg={get exports(){return In},set exports(i){In=i}};(function(i){(function(){function e(A,I,x){return A.call.apply(A.bind,arguments)}function t(A,I,x){if(!A)throw Error();if(2<arguments.length){var R=Array.prototype.slice.call(arguments,2);return function(){var k=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(k,R),A.apply(I,k)}}return function(){return A.apply(I,arguments)}}function s(A,I,x){return s=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?e:t,s.apply(null,arguments)}var n=Date.now||function(){return+new Date};function a(A,I){this.a=A,this.o=I||A,this.c=this.o.document}var r=!!window.FontFace;function c(A,I,x,R){if(I=A.c.createElement(I),x)for(var k in x)x.hasOwnProperty(k)&&(k=="style"?I.style.cssText=x[k]:I.setAttribute(k,x[k]));return R&&I.appendChild(A.c.createTextNode(R)),I}function o(A,I,x){A=A.c.getElementsByTagName(I)[0],A||(A=document.documentElement),A.insertBefore(x,A.lastChild)}function l(A){A.parentNode&&A.parentNode.removeChild(A)}function h(A,I,x){I=I||[],x=x||[];for(var R=A.className.split(/\s+/),k=0;k<I.length;k+=1){for(var Y=!1,W=0;W<R.length;W+=1)if(I[k]===R[W]){Y=!0;break}Y||R.push(I[k])}for(I=[],k=0;k<R.length;k+=1){for(Y=!1,W=0;W<x.length;W+=1)if(R[k]===x[W]){Y=!0;break}Y||I.push(R[k])}A.className=I.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function d(A,I){for(var x=A.className.split(/\s+/),R=0,k=x.length;R<k;R++)if(x[R]==I)return!0;return!1}function u(A){return A.o.location.hostname||A.a.location.hostname}function p(A,I,x){function R(){J&&k&&Y&&(J(W),J=null)}I=c(A,"link",{rel:"stylesheet",href:I,media:"all"});var k=!1,Y=!0,W=null,J=x||null;r?(I.onload=function(){k=!0,R()},I.onerror=function(){k=!0,W=Error("Stylesheet failed to load"),R()}):setTimeout(function(){k=!0,R()},0),o(A,"head",I)}function g(A,I,x,R){var k=A.c.getElementsByTagName("head")[0];if(k){var Y=c(A,"script",{src:I}),W=!1;return Y.onload=Y.onreadystatechange=function(){W||this.readyState&&this.readyState!="loaded"&&this.readyState!="complete"||(W=!0,x&&x(null),Y.onload=Y.onreadystatechange=null,Y.parentNode.tagName=="HEAD"&&k.removeChild(Y))},k.appendChild(Y),setTimeout(function(){W||(W=!0,x&&x(Error("Script load timeout")))},R||5e3),Y}return null}function m(){this.a=0,this.c=null}function E(A){return A.a++,function(){A.a--,y(A)}}function f(A,I){A.c=I,y(A)}function y(A){A.a==0&&A.c&&(A.c(),A.c=null)}function S(A){this.a=A||"-"}S.prototype.c=function(A){for(var I=[],x=0;x<arguments.length;x++)I.push(arguments[x].replace(/[\W_]+/g,"").toLowerCase());return I.join(this.a)};function T(A,I){this.c=A,this.f=4,this.a="n";var x=(I||"n4").match(/^([nio])([1-9])$/i);x&&(this.a=x[1],this.f=parseInt(x[2],10))}function b(A){return v(A)+" "+(A.f+"00")+" 300px "+C(A.c)}function C(A){var I=[];A=A.split(/,\s*/);for(var x=0;x<A.length;x++){var R=A[x].replace(/['"]/g,"");R.indexOf(" ")!=-1||/^\d/.test(R)?I.push("'"+R+"'"):I.push(R)}return I.join(",")}function O(A){return A.a+A.f}function v(A){var I="normal";return A.a==="o"?I="oblique":A.a==="i"&&(I="italic"),I}function w(A){var I=4,x="n",R=null;return A&&((R=A.match(/(normal|oblique|italic)/i))&&R[1]&&(x=R[1].substr(0,1).toLowerCase()),(R=A.match(/([1-9]00|normal|bold)/i))&&R[1]&&(/bold/i.test(R[1])?I=7:/[1-9]00/.test(R[1])&&(I=parseInt(R[1].substr(0,1),10)))),x+I}function P(A,I){this.c=A,this.f=A.o.document.documentElement,this.h=I,this.a=new S("-"),this.j=I.events!==!1,this.g=I.classes!==!1}function D(A){A.g&&h(A.f,[A.a.c("wf","loading")]),N(A,"loading")}function M(A){if(A.g){var I=d(A.f,A.a.c("wf","active")),x=[],R=[A.a.c("wf","loading")];I||x.push(A.a.c("wf","inactive")),h(A.f,x,R)}N(A,"inactive")}function N(A,I,x){A.j&&A.h[I]&&(x?A.h[I](x.c,O(x)):A.h[I]())}function F(){this.c={}}function U(A,I,x){var R=[],k;for(k in I)if(I.hasOwnProperty(k)){var Y=A.c[k];Y&&R.push(Y(I[k],x))}return R}function X(A,I){this.c=A,this.f=I,this.a=c(this.c,"span",{"aria-hidden":"true"},this.f)}function oe(A){o(A.c,"body",A.a)}function ge(A){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+C(A.c)+";"+("font-style:"+v(A)+";font-weight:"+(A.f+"00")+";")}function ie(A,I,x,R,k,Y){this.g=A,this.j=I,this.a=R,this.c=x,this.f=k||3e3,this.h=Y||void 0}ie.prototype.start=function(){var A=this.c.o.document,I=this,x=n(),R=new Promise(function(W,J){function te(){n()-x>=I.f?J():A.fonts.load(b(I.a),I.h).then(function(ce){1<=ce.length?W():setTimeout(te,25)},function(){J()})}te()}),k=null,Y=new Promise(function(W,J){k=setTimeout(J,I.f)});Promise.race([Y,R]).then(function(){k&&(clearTimeout(k),k=null),I.g(I.a)},function(){I.j(I.a)})};function tt(A,I,x,R,k,Y,W){this.v=A,this.B=I,this.c=x,this.a=R,this.s=W||"BESbswy",this.f={},this.w=k||3e3,this.u=Y||null,this.m=this.j=this.h=this.g=null,this.g=new X(this.c,this.s),this.h=new X(this.c,this.s),this.j=new X(this.c,this.s),this.m=new X(this.c,this.s),A=new T(this.a.c+",serif",O(this.a)),A=ge(A),this.g.a.style.cssText=A,A=new T(this.a.c+",sans-serif",O(this.a)),A=ge(A),this.h.a.style.cssText=A,A=new T("serif",O(this.a)),A=ge(A),this.j.a.style.cssText=A,A=new T("sans-serif",O(this.a)),A=ge(A),this.m.a.style.cssText=A,oe(this.g),oe(this.h),oe(this.j),oe(this.m)}var Oe={D:"serif",C:"sans-serif"},hs=null;function Ke(){if(hs===null){var A=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);hs=!!A&&(536>parseInt(A[1],10)||parseInt(A[1],10)===536&&11>=parseInt(A[2],10))}return hs}tt.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=n(),Ne(this)};function us(A,I,x){for(var R in Oe)if(Oe.hasOwnProperty(R)&&I===A.f[Oe[R]]&&x===A.f[Oe[R]])return!0;return!1}function Ne(A){var I=A.g.a.offsetWidth,x=A.h.a.offsetWidth,R;(R=I===A.f.serif&&x===A.f["sans-serif"])||(R=Ke()&&us(A,I,x)),R?n()-A.A>=A.w?Ke()&&us(A,I,x)&&(A.u===null||A.u.hasOwnProperty(A.a.c))?Fi(A,A.v):Fi(A,A.B):sh(A):Fi(A,A.v)}function sh(A){setTimeout(s(function(){Ne(this)},A),50)}function Fi(A,I){setTimeout(s(function(){l(this.g.a),l(this.h.a),l(this.j.a),l(this.m.a),I(this.a)},A),0)}function Ui(A,I,x){this.c=A,this.a=I,this.f=0,this.m=this.j=!1,this.s=x}var Xs=null;Ui.prototype.g=function(A){var I=this.a;I.g&&h(I.f,[I.a.c("wf",A.c,O(A).toString(),"active")],[I.a.c("wf",A.c,O(A).toString(),"loading"),I.a.c("wf",A.c,O(A).toString(),"inactive")]),N(I,"fontactive",A),this.m=!0,Sa(this)},Ui.prototype.h=function(A){var I=this.a;if(I.g){var x=d(I.f,I.a.c("wf",A.c,O(A).toString(),"active")),R=[],k=[I.a.c("wf",A.c,O(A).toString(),"loading")];x||R.push(I.a.c("wf",A.c,O(A).toString(),"inactive")),h(I.f,R,k)}N(I,"fontinactive",A),Sa(this)};function Sa(A){--A.f==0&&A.j&&(A.m?(A=A.a,A.g&&h(A.f,[A.a.c("wf","active")],[A.a.c("wf","loading"),A.a.c("wf","inactive")]),N(A,"active")):M(A.a))}function Aa(A){this.j=A,this.a=new F,this.h=0,this.f=this.g=!0}Aa.prototype.load=function(A){this.c=new a(this.j,A.context||this.j),this.g=A.events!==!1,this.f=A.classes!==!1,nh(this,new P(this.c,A),A)};function ih(A,I,x,R,k){var Y=--A.h==0;(A.f||A.g)&&setTimeout(function(){var W=k||null,J=R||null||{};if(x.length===0&&Y)M(I.a);else{I.f+=x.length,Y&&(I.j=Y);var te,ce=[];for(te=0;te<x.length;te++){var le=x[te],me=J[le.c],Me=I.a,Dt=le;if(Me.g&&h(Me.f,[Me.a.c("wf",Dt.c,O(Dt).toString(),"loading")]),N(Me,"fontloading",Dt),Me=null,Xs===null)if(window.FontFace){var Dt=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),mh=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);Xs=Dt?42<parseInt(Dt[1],10):!mh}else Xs=!1;Xs?Me=new ie(s(I.g,I),s(I.h,I),I.c,le,I.s,me):Me=new tt(s(I.g,I),s(I.h,I),I.c,le,I.s,W,me),ce.push(Me)}for(te=0;te<ce.length;te++)ce[te].start()}},0)}function nh(A,I,x){var k=[],R=x.timeout;D(I);var k=U(A.a,x,A.c),Y=new Ui(A.c,I,R);for(A.h=k.length,I=0,x=k.length;I<x;I++)k[I].load(function(W,J,te){ih(A,Y,W,J,te)})}function ba(A,I){this.c=A,this.a=I}ba.prototype.load=function(A){function I(){if(Y["__mti_fntLst"+R]){var W=Y["__mti_fntLst"+R](),J=[],te;if(W)for(var ce=0;ce<W.length;ce++){var le=W[ce].fontfamily;W[ce].fontStyle!=null&&W[ce].fontWeight!=null?(te=W[ce].fontStyle+W[ce].fontWeight,J.push(new T(le,te))):J.push(new T(le))}A(J)}else setTimeout(function(){I()},50)}var x=this,R=x.a.projectId,k=x.a.version;if(R){var Y=x.c.o;g(this.c,(x.a.api||"https://fast.fonts.net/jsapi")+"/"+R+".js"+(k?"?v="+k:""),function(W){W?A([]):(Y["__MonotypeConfiguration__"+R]=function(){return x.a},I())}).id="__MonotypeAPIScript__"+R}else A([])};function Ta(A,I){this.c=A,this.a=I}Ta.prototype.load=function(A){var I,x,R=this.a.urls||[],k=this.a.families||[],Y=this.a.testStrings||{},W=new m;for(I=0,x=R.length;I<x;I++)p(this.c,R[I],E(W));var J=[];for(I=0,x=k.length;I<x;I++)if(R=k[I].split(":"),R[1])for(var te=R[1].split(","),ce=0;ce<te.length;ce+=1)J.push(new T(R[0],te[ce]));else J.push(new T(R[0]));f(W,function(){A(J,Y)})};function ah(A,I){A?this.c=A:this.c=rh,this.a=[],this.f=[],this.g=I||""}var rh="https://fonts.googleapis.com/css";function oh(A,I){for(var x=I.length,R=0;R<x;R++){var k=I[R].split(":");k.length==3&&A.f.push(k.pop());var Y="";k.length==2&&k[1]!=""&&(Y=":"),A.a.push(k.join(Y))}}function ch(A){if(A.a.length==0)throw Error("No fonts to load!");if(A.c.indexOf("kit=")!=-1)return A.c;for(var I=A.a.length,x=[],R=0;R<I;R++)x.push(A.a[R].replace(/ /g,"+"));return I=A.c+"?family="+x.join("%7C"),0<A.f.length&&(I+="&subset="+A.f.join(",")),0<A.g.length&&(I+="&text="+encodeURIComponent(A.g)),I}function lh(A){this.f=A,this.a=[],this.c={}}var wa={latin:"BESbswy","latin-ext":"Ã§Ã¶Ã¼ÄŸÅŸ",cyrillic:"Ð¹ÑÐ–",greek:"Î±Î²Î£",khmer:"áž€ážáž‚",Hanuman:"áž€ážáž‚"},hh={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},uh={i:"i",italic:"i",n:"n",normal:"n"},dh=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function ph(A){for(var I=A.f.length,x=0;x<I;x++){var R=A.f[x].split(":"),k=R[0].replace(/\+/g," "),Y=["n4"];if(2<=R.length){var W,J=R[1];if(W=[],J)for(var J=J.split(","),te=J.length,ce=0;ce<te;ce++){var le;if(le=J[ce],le.match(/^[\w-]+$/)){var me=dh.exec(le.toLowerCase());if(me==null)le="";else{if(le=me[2],le=le==null||le==""?"n":uh[le],me=me[1],me==null||me=="")me="4";else var Me=hh[me],me=Me||(isNaN(me)?"4":me.substr(0,1));le=[le,me].join("")}}else le="";le&&W.push(le)}0<W.length&&(Y=W),R.length==3&&(R=R[2],W=[],R=R?R.split(","):W,0<R.length&&(R=wa[R[0]])&&(A.c[k]=R))}for(A.c[k]||(R=wa[k])&&(A.c[k]=R),R=0;R<Y.length;R+=1)A.a.push(new T(k,Y[R]))}}function Ca(A,I){this.c=A,this.a=I}var gh={Arimo:!0,Cousine:!0,Tinos:!0};Ca.prototype.load=function(A){var I=new m,x=this.c,R=new ah(this.a.api,this.a.text),k=this.a.families;oh(R,k);var Y=new lh(k);ph(Y),p(x,ch(R),E(I)),f(I,function(){A(Y.a,Y.c,gh)})};function Ia(A,I){this.c=A,this.a=I}Ia.prototype.load=function(A){var I=this.a.id,x=this.c.o;I?g(this.c,(this.a.api||"https://use.typekit.net")+"/"+I+".js",function(R){if(R)A([]);else if(x.Typekit&&x.Typekit.config&&x.Typekit.config.fn){R=x.Typekit.config.fn;for(var k=[],Y=0;Y<R.length;Y+=2)for(var W=R[Y],J=R[Y+1],te=0;te<J.length;te++)k.push(new T(W,J[te]));try{x.Typekit.load({events:!1,classes:!1,async:!0})}catch{}A(k)}},2e3):A([])};function Pa(A,I){this.c=A,this.f=I,this.a=[]}Pa.prototype.load=function(A){var I=this.f.id,x=this.c.o,R=this;I?(x.__webfontfontdeckmodule__||(x.__webfontfontdeckmodule__={}),x.__webfontfontdeckmodule__[I]=function(k,Y){for(var W=0,J=Y.fonts.length;W<J;++W){var te=Y.fonts[W];R.a.push(new T(te.name,w("font-weight:"+te.weight+";font-style:"+te.style)))}A(R.a)},g(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+u(this.c)+"/"+I+".js",function(k){k&&A([])})):A([])};var st=new Aa(window);st.a.c.custom=function(A,I){return new Ta(I,A)},st.a.c.fontdeck=function(A,I){return new Pa(I,A)},st.a.c.monotype=function(A,I){return new ba(I,A)},st.a.c.typekit=function(A,I){return new Ia(I,A)},st.a.c.google=function(A,I){return new Ca(I,A)};var va={load:s(st.load,st)};i.exports?i.exports=va:(window.WebFont=va,window.WebFontConfig&&st.load(window.WebFontConfig))})()})(Lg);const Gg=In;class Fg extends Phaser.Loader.File{payload;constructor(e,t){super(e,{type:"webfont",key:t.type}),this.payload=t}load(){const{type:e}=this.payload;let t;switch(e){case"google":t=this.getGoogleFontConfig(this.payload);break;case"local":t=this.getLocalFontConfig(this.payload);break}Gg.load(t)}getGoogleFontConfig(e){const{character:t,fontName:s,fontWeight:n=400}=e;return{google:{families:[`${s}:${n}`],text:t},active:()=>{this.loader.nextFile(this,!0)},timeout:15e3}}getLocalFontConfig(e){const{fontName:t,fontType:s}=e,n=document.createElement("style");document.head.appendChild(n);const a=n.sheet;if(a){const c=`@font-face { font-family: "${t}"; src: url("assets/fonts/${t}${s==="opentype"?".otf":".ttf"}") format("${s}"); }`;a.insertRule(c,0)}return{custom:{families:[t]},active:()=>{this.loader.nextFile(this,!0)},timeout:15e3}}}class Ug extends Phaser.Plugins.ScenePlugin{addFont(e){const t=new Fg(this.scene.load,e);this.scene.load.addFile(t)}}class Yg extends Phaser.Plugins.BasePlugin{portraitRatio;portraitWidth;portraitHeight;landscapeRatio;landscapeWidth;landscapeHeight;worldWidth;worldHeight;worldRatio;autoResize;disableLandscape;fullSizeOnLandscape;forcePixelRatio;configure(e){const{autoResize:t,portraitRatio:s,portraitWidth:n,portraitHeight:a,landscapeWidth:r,landscapeHeight:c,landscapeRatio:o,disableLandscape:l,fullSizeOnLandscape:h}=e;this.autoResize=t,this.disableLandscape=l,this.fullSizeOnLandscape=h,this.portraitRatio=s,this.portraitWidth=n,this.portraitHeight=a,this.landscapeRatio=o,this.landscapeWidth=r,this.landscapeHeight=c,this.initWorldSize(),this.addEventResize()}resize(e){e&&e>0&&(this.forcePixelRatio=e);const{width:t,height:s}=this.getCanvasSizeFixedRatio(this.worldRatio);this.resizeCanvas(t,s),this.game.scene.scenes.forEach(n=>{const a=n.cameras.main;if(!a)return;const r=this.getZoomRatio(),{width:c,height:o}=this.getWorldSize();a.setZoom(r),a.centerOn(c/2,o/2)})}resizeCanvas(e,t){this.game.canvas.width=e,this.game.canvas.height=t,this.game.scale.resize(e,t)}getWorldSize(){return{width:this.worldWidth,height:this.worldHeight}}initWorldSize(){if(this.worldWidth=this.portraitWidth,this.worldHeight=this.portraitHeight,this.isScreenSmallerRatio(this.portraitRatio))this.worldHeight=this.worldWidth/this.getScreenRatio();else if(!this.disableLandscape&&(this.worldWidth=this.landscapeWidth,this.worldHeight=this.landscapeHeight,this.fullSizeOnLandscape)){this.worldRatio=this.worldWidth/this.worldHeight,this.landscapeRatio=this.getScreenRatio();const{width:e,height:t}=this.getCanvasSizeFixedRatio(this.landscapeRatio),s=this.getZoomRatio();this.worldWidth=e/s,this.worldHeight=t/s}this.worldRatio=this.worldWidth/this.worldHeight,console.info("ðŸš€ > this.worldRatio",this.worldRatio)}getZoomRatio(){const{width:e}=this.getWorldSize(),{width:t}=this.getCanvasSizeFixedRatio(this.worldRatio);return t/e}getPixelRatio(){if(this.forcePixelRatio>0)return this.forcePixelRatio;if(GameCore.Utils.Device.isDesktop())return 2;let e=GameCore.Utils.Device.pixelRatio();return e>2&&(e=2),e}getPhysicPixels(e,t){return e*t}getCanvasSizeFixedRatio(e){const t=this.getPixelRatio();let s=this.getScreenWidth()*t,n=this.getScreenHeight()*t;return this.isScreenSmallerRatio(e)?n=s/e:s=n*e,{width:s,height:n}}getScreenRatio(){return this.getScreenWidth()/this.getScreenHeight()}getScreenHeight(){const{body:e,documentElement:t}=document,{clientHeight:s}=e,{clientHeight:n}=t;return Math.max(n,s)||0}getScreenWidth(){const{body:e,documentElement:t}=document,{clientWidth:s}=e,{clientWidth:n}=t;return Math.max(n,s)||0}isScreenSmallerRatio(e){return this.getScreenRatio()<e}addEventResize(){this.autoResize&&window.addEventListener("resize",this.handleResize)}handleResize=Os(()=>{this.resize()},300);isLandscape(){return this.disableLandscape?!1:this.worldRatio>this.portraitRatio}}class Hg{contextId;contextType;entryPointData;constructor(e,t,s){this.contextId=e||ji.contextId,this.contextType=t||ji.contextType,this.entryPointData=s||ji.entryPointData}toObject(){return{contextId:this.contextId,contextType:this.contextType,entryPointData:this.entryPointData}}}class Zn extends Error{constructor(e,t){super(e,t),this.name="InvalidPlayerId",this.message=e||"The playerId is not valid",this.payload=t}}const Jc={score:0,settings:{..._s},userGuideDisplays:0,customFields:{diamond:300,lastReceiveGift:0}},{sound:zg,music:Wg,theme:Vg,vibrate:Kg,language:$g}=_s,{Object:ds,Valid:Bt}=GameCore.Utils;class Qc{sound;music;vibrate;theme;language;constructor(e){this.initDefaultData(),Bt.isObject(e)&&(ds.hasOwn(e,"sound")&&Bt.isBoolean(e.sound)&&(this.sound=e.sound),ds.hasOwn(e,"music")&&Bt.isBoolean(e.music)&&(this.music=e.music),ds.hasOwn(e,"vibrate")&&Bt.isBoolean(e.vibrate)&&(this.vibrate=e.vibrate),ds.hasOwn(e,"theme")&&Bt.isString(e.theme)&&(this.theme=e.theme),ds.hasOwn(e,"language")&&Bt.isString(e.language)&&(this.language=e.language))}initDefaultData(){this.sound=zg,this.music=Wg,this.theme=Vg,this.vibrate=Kg,this.language=$g}toObject(){return{sound:this.sound,music:this.music,theme:this.theme,vibrate:this.vibrate,language:this.language}}}const{userGuideDisplays:jg,customFields:Xg,settings:qg}=Jc;class Zg{data;constructor(e){const{settings:t,score:s,customFields:n,userGuideDisplays:a}=e,r=GameCore.Utils.Valid.isNumber(s)&&s>0?s:0,c=GameCore.Utils.Valid.isNumber(a)?a:jg,o=GameCore.Utils.Valid.isObject(n)?n:Xg;let l=qg;GameCore.Utils.Valid.isObject(t)&&(l=new Qc(t).toObject()),this.data={score:r,userGuideDisplays:c,settings:l,customFields:o}}toObject(){return this.data}}const Jn="share_invite",$a="tournament",qt="challenge_friend_match",Qn="matching_group_match",xe=new Ht("10","Your Friend",$.AVATAR.FILE).toObject(),ht="single",Ce="challenge-friends",Ot="matching-group",De="tournaments",Wt="online",Jg=i=>i.context,Qg=i=>i.context.currentGameMode,Zt=G([Jg],i=>i),el=G([Qg],i=>i),em=(i,e,t)=>({type:Qo,payload:{contextId:i,contextType:e,entryPointData:t}}),Pn=(i,e)=>({type:ec,payload:{contextId:i,contextType:e}}),tm=()=>(i,e)=>{const t=e(),s=Zt(t),{player:n}=window.game,a=n.getPlayerId(),{contextId:r,entryPointData:c}=s,{type:o,matchId:l,playerId:h,opponentId:d=xe.playerId,tournamentContextId:u}=c||{},p=a===h,m=d===xe.playerId||[d,h].includes(a);let E=ht;r&&(o===void 0||o===$a)&&(E=De),o===$a&&u&&(E=De),r&&o===Jn&&!p&&(E=Ce),l&&r&&m&&o===qt&&(E=Ce),r&&o===Qn&&(E=Ot),i(tl(E))},tl=i=>e=>{e({type:tc,payload:{gameMode:i}}),wi("game-mode",i)},{PlayerDataStore:sm}=GameCore.Configs;class im{game;constructor(e){this.game=e}initContext=()=>{const e=window.GameSDK.context.getID(),t=window.GameSDK.context.getType(),s=window.GameSDK.getEntryPointData(),n=new Hg(e,t,s),{contextId:a,contextType:r,entryPointData:c}=n.toObject();this.game.storage.dispatch(em(a,r,c))};initPlayer=async()=>{const e=this.getPlayerInfo(),t=this.getPlayerDataLocal(),{player:s}=this.game;s.receiveData(e,t)};getPlayerInfo=()=>{try{const e=window.GameSDK.player.getID();let t=window.GameSDK.player.getName();const s=window.GameSDK.player.getPhoto(),n=window.GameSDK.getLocale();if(!GameCore.Utils.Valid.isString(e))throw new Zn(null,{playerId:e});return GameCore.Utils.Valid.isString(t)||(t="You"),new Ht(e,t,s,n).toObject()}catch{return new Ht("123","You").toObject()}};getPlayerDataLocal=()=>{try{const e=Ii(sm);return GameCore.Utils.Valid.isObject(e)?new Zg(e).toObject():null}catch(e){return console.warn(e),null}}}const j={BOOT_SCENE:"BOOT_SCENE",LOAD_SCENE:"LOAD_SCENE",GAME_SCENE:"GAME_SCENE",GLOBAL_SCENE:"GLOBAL_SCENE",DASHBOARD_SCENE:"DASHBOARD_SCENE",GAME_OVER_SCENE:"GAME_OVER_SCENE",LEADERBOARD_SCENE:"LEADERBOARD_SCENE",TOURNAMENT_SCENE:"TOURNAMENT_SCENE",RESULT_MATCH_SCENE:"RESULT_MATCH_SCENE",RESULT_ONLINE_SCENE:"RESULT_ONLINE_SCENE",TEST_SCENE:"TEST_SCENE",ANIMATIONS_SCENE:"ANIMATIONS_SCENE"},we={SWITCH:Symbol("SWITCH")};class nm extends Phaser.Plugins.BasePlugin{Text;Texture;currentLocale;supportedLanguages;data;configure(e){this.applyOptions(e)}getCurrentLanguage(){return this.currentLocale}switchLanguage(e="en"){const t=this.getCorrectLocale(e);this.currentLocale=t,this.Text=this.data[t].Text,this.Texture=this.data[t].Texture}getText(e){if(typeof e=="object"){const{key:t,variables:s=[],locale:n=this.currentLocale}=e,a=this.getCorrectLocale(n),r=this.data[a].Text[t];return this.replaceVariables(r,s)}return this.Text[e]}getTexture(e){if(typeof e=="object"){const{key:t,variables:s=[],locale:n=this.currentLocale}=e,a=this.getCorrectLocale(n),r=this.data[a].Texture[t];return this.replaceVariables(r,s)}return this.Texture[e]}isSupportLanguage(e){return this.supportedLanguages.indexOf(e)>=0}applyOptions(e){const{data:t,locale:s="en",upperCaseText:n=!1}=e;this.data=t,this.supportedLanguages=Object.keys(t);const a=this.getCorrectLocale(s);if(this.currentLocale=a,this.Text=t[a].Text,this.Texture=t[a].Texture,n)for(const r in this.Text)this.Text[r]=this.Text[r].toUpperCase()}makeText(e,t){const{maxWidth:s=Phaser.Math.MAX_SAFE_INTEGER,maxHeight:n=Phaser.Math.MAX_SAFE_INTEGER,align:a="center",drawMaxBoxDebug:r=!1}=t,c=e.make.bitmapText(t);for(a==="center"?c.setCenterAlign():a==="left"?c.setLeftAlign():a==="right"&&c.setRightAlign(),(t.text||"").indexOf(" ")>=0&&c.setMaxWidth(s);c.width>s||c.height>=n;)c.setFontSize(c.fontSize*.95),console.log({t:t.text,w:c.width,h:c.height});if(r&&GameCore.Utils.Valid.isDebugger()){const o=e.game.globalScene.add.graphics({lineStyle:{width:2,color:16711680}});o.setDepth(Phaser.Math.MAX_SAFE_INTEGER),e.game.globalScene.events.on(Phaser.Scenes.Events.UPDATE,()=>{if(o.clear(),c&&c.visible&&c.active){const{x:l,y:h}=c.getWorldPosition();o.strokeRect(l-.5*s+(.5-c.originX)*c.width,h-.5*n+(.5-c.originY)*c.height,s,n)}})}return c}setFontSize(e,t,s){const n=t||Phaser.Math.MAX_SAFE_INTEGER,a=s||Phaser.Math.MAX_SAFE_INTEGER;for((e.text||"").indexOf(" ")>=0&&e.setMaxWidth(n);e.width>n||e.height>=a;)e.setFontSize(e.fontSize*.95)}replaceVariables(e,t){const s=t.length;if(s==0)return e;let n=0;return e.replace(/{.*}/,function(){return String(t[Math.min(n++,s-1)])})}getCorrectLocale(e){let t=e;return this.isSupportLanguage(e)||(t="en"),t}}const am={DAILY_REWARDS:"Daily Rewards",OWNED:"Owned",SKIPPED:"Skipped",DAY_X:"DAY {X}",CLAIM:"CLAIM",CLAIM_X2:"Claim X2",LEADERBOARDS:"Leaderboards",PLAY:"Play",PLAY_NOW:`Play
Now`,MISSIONS:"Missions",SETTINGS:"SETTINGS",WATCH_A_VIDEO_X:`WATCH A VIDEO TO GET
{X} COINS`,GET_NOW:"GET NOW!",DAILY_MISSIONS:"Daily Missions",COLLECT_300_EGGS:"COLLECT 300 EGGS",REACH_10000_POINTS:"REACH 10,000 POINTS",GET_1_DINOMITE:"GET 1 DINOMITE COMBO",USE_SECOND_CHANCE_2:"USE SECOND CHANCE 2 TIMES",SHOOT_5_FLYING:"SHOOT 5 FLYING DINOSAURS",COMPLETE_GAME_5:"COMPLETE GAME 5 TIMES",MUSIC:"Music",SOUND:"Sound",ON:"On",OFF:"Off",REPLAY:"Replay",HOME:"HOME","INVITE FRIEND":"INVITE FRIEND",YOUR_SCORE:"YOUR SCORE",YOUR_SCORE_:"Your Score!",CONTINUE:"CONTINUE",SECOND_CHANCE:`SECOND
CHANCE?`,GAME_OVER:"GAME OVER",HIGH_SCORE:"HIGH SCORE",PLAY_n_WITH:"PlaynWith",PLAY_WITH:"PLAY WITH",WORLD:"WORLD",FRIENDS:"FRIENDS",CHALLENGE:"Challenge",MATCHING:"Matching...",LOADING_ADS:"Loading ads...",LOADING:"Loading...",NO_ADS:"No ads to display!",SORRY_NO_REWARDS:`Sorry, No Rewards!
You have cancelled the ad!`,LEADERBOARD_IS_EMPTY:"Leaderboard is empty!",INVITE:"INVITE",VIBRATE:"Vibrate",RANDOM:"Random",SHARE:"Share",VS:"VS",OK:"OK",YOUR_RANK:"Your rank",RESULT:"Result",CURRENT_TOURNAMENT:"Current Tournament",CREATE_YOUR_TOURNAMENT:"Create your tournament",CREATE:"Create",COLLECT:"Collect",YOU_ARE_THE_TOP_OF_THE_TOP:"You are the top of the top!",READY:"Ready!",MULTIPLY:"Multiply?",COLOR_POP:`COLOR POP REMOVES ANY EGG
THAT MATCH THE COLOR IT HIT`,TOUCH_ANYWHERE:`Touch anywhere
to continue`},rm={NO_THANKS:"texts/no-thanks"},om={Text:am,Texture:rm},cm={DAILY_REWARDS:"Ð•Ð–Ð•Ð”ÐÐ•Ð’ÐÐ«Ð• ÐÐÐ“Ð ÐÐ”Ð«",OWNED:"ÐŸÐžÐ›Ð£Ð§Ð•ÐÐž",SKIPPED:"ÐŸÐ ÐžÐŸÐ£Ð©Ð•ÐÐž",DAY_X:"Ð”Ð•ÐÐ¬ {X}",CLAIM:"ÐŸÐžÐ›Ð£Ð§Ð˜Ð¢Ð¬",CLAIM_X2:"ÐŸÐžÐ›Ð£Ð§Ð˜Ð¢Ð¬ X2",LEADERBOARDS:"Ð¢ÐÐ‘Ð›Ð˜Ð¦Ð Ð›Ð˜Ð”Ð•Ð ÐžÐ’",PLAY:"Ð˜Ð“Ð ÐÐ¢Ð¬",PLAY_NOW:`Ð˜Ð“Ð ÐÐ¢Ð¬
Ð¡Ð•Ð™Ð§ÐÐ¡`,MISSIONS:"ÐœÐ˜Ð¡Ð¡Ð˜Ð¯",SETTINGS:"ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ˜",WATCH_A_VIDEO_X:`ÐŸÐžÐ¡ÐœÐžÐ¢Ð Ð˜ Ð’Ð˜Ð”Ð•Ðž, Ð§Ð¢ÐžÐ‘Ð«
ÐŸÐžÐ›Ð£Ð§Ð˜Ð¢Ð¬ {X} ÐœÐžÐÐ•Ð¢`,GET_NOW:`ÐŸÐžÐ›Ð£Ð§Ð˜
Ð¡Ð•Ð™Ð§ÐÐ¡!`,DAILY_MISSIONS:"Ð•Ð–Ð•Ð”ÐÐ•Ð’ÐÐ«Ð• ÐœÐ˜Ð¡Ð¡Ð˜Ð˜",COLLECT_300_EGGS:"Ð¡ÐžÐ‘Ð ÐÐ¢Ð¬ 300 Ð¯Ð˜Ð¦",REACH_10000_POINTS:"ÐÐÐ‘Ð ÐÐ¢Ð¬ 10,000 ÐžÐ§ÐšÐžÐ’",GET_1_DINOMITE:"ÐŸÐžÐ›Ð£Ð§Ð˜Ð¢Ð¬ 1 ÐšÐžÐœÐ‘Ðž Ð¡ DINOMITE",USE_SECOND_CHANCE_2:"Ð˜Ð¡ÐŸÐžÐ›Ð¬Ð—ÐžÐ’ÐÐ¢Ð¬ Ð’Ð¢ÐžÐ ÐžÐ™ Ð¨ÐÐÐ¡ 2 Ð ÐÐ—Ð",SHOOT_5_FLYING:"Ð¡Ð‘Ð˜Ð¢Ð¬ 5 Ð›Ð•Ð¢Ð£Ð§Ð˜Ð¥ Ð”Ð˜ÐÐžÐ—ÐÐ’Ð ÐžÐ’",COMPLETE_GAME_5:"Ð—ÐÐ’Ð•Ð Ð¨Ð˜Ð¢Ð¬ Ð˜Ð“Ð Ð£ 5 Ð ÐÐ—",MUSIC:"ÐœÐ£Ð—Ð«ÐšÐ",SOUND:"Ð—Ð’Ð£ÐšÐžÐ’Ð«Ð•",ON:"Ð’ÐšÐ›",OFF:"Ð’Ð«ÐšÐ›",REPLAY:`Ð˜Ð“Ð ÐÐ¢Ð¬
Ð—ÐÐÐžÐ’Ðž`,HOME:"Ð”ÐžÐœÐžÐ™","INVITE FRIEND":"ÐŸÐ Ð˜Ð“Ð›ÐÐ¡Ð˜ Ð”Ð Ð£Ð—Ð•Ð™",YOUR_SCORE:"Ð¢Ð’ÐžÐ™ Ð Ð•Ð—Ð£Ð›Ð¬Ð¢ÐÐ¢",YOUR_SCORE_:"Ð¢Ð’ÐžÐ™ Ð Ð•Ð—Ð£Ð›Ð¬Ð¢ÐÐ¢!",CONTINUE:"ÐŸÐ ÐžÐ”ÐžÐ›Ð–Ð˜Ð¢Ð¬",SECOND_CHANCE:`Ð’Ð¢ÐžÐ ÐžÐ™
Ð¨ÐÐÐ¡?`,GAME_OVER:"ÐšÐžÐÐ•Ð¦ Ð˜Ð“Ð Ð«",HIGH_SCORE:"Ð’Ð«Ð¡ÐžÐšÐ˜Ð™ Ð‘ÐÐ›Ð›",PLAY_n_WITH:`Ð˜Ð“Ð ÐÐ¢Ð¬
Ð¡`,PLAY_WITH:"Ð˜Ð“Ð ÐÐ¢Ð¬ Ð¡",WORLD:"Ð’Ð•Ð¡Ð¬ ÐœÐ˜Ð ",FRIENDS:"Ð”Ð Ð£Ð—Ð¬Ð¯",CHALLENGE:"Ð’Ð«Ð—ÐžÐ’",MATCHING:"ÐŸÐžÐ˜Ð¡Ðš...",LOADING_ADS:"Ð—ÐÐ“Ð Ð£Ð—ÐšÐ Ð Ð•ÐšÐ›ÐÐœÐ«...",LOADING:"Ð—ÐÐ“Ð Ð£Ð—ÐšÐ...",NO_ADS:`ÐÐ•Ð¢ Ð Ð•ÐšÐ›ÐÐœÐ«
Ð”Ð›Ð¯ ÐžÐ¢ÐžÐ‘Ð ÐÐ–Ð•ÐÐ˜Ð¯!`,SORRY_NO_REWARDS:`Ð˜Ð—Ð’Ð˜ÐÐ˜, ÐÐÐ“Ð ÐÐ” ÐÐ•Ð¢!
Ð¢Ð« ÐžÐ¢ÐšÐÐ—ÐÐ›Ð¡Ð¯ ÐžÐ¢
ÐŸÐ ÐžÐ¡ÐœÐžÐ¢Ð Ð Ð Ð•ÐšÐ›ÐÐœÐ«!`,LEADERBOARD_IS_EMPTY:"Ð¢ÐÐ‘Ð›Ð˜Ð¦Ð Ð›Ð˜Ð”Ð•Ð ÐžÐ’ ÐŸÐ£Ð¡Ð¢Ð!",INVITE:"ÐŸÐ Ð˜Ð“Ð›ÐÐ¡Ð˜",VIBRATE:"Ð’Ð˜Ð‘Ð ÐÐ¦Ð˜Ð¯",RANDOM:"Ð¡Ð›Ð£Ð§ÐÐ™ÐÐ«Ð™",SHARE:"ÐŸÐžÐ”Ð•Ð›Ð˜Ð¢Ð¬Ð¡Ð¯",VS:"ÐŸÐ ÐžÐ¢Ð˜Ð’",OK:"Ð›ÐÐ”ÐÐž",YOUR_RANK:"Ð’ÐÐ¨ Ð ÐÐÐ“",RESULT:"Ð Ð•Ð—Ð£Ð›Ð¬Ð¢ÐÐ¢",CURRENT_TOURNAMENT:"Ð¢Ð•ÐšÐ£Ð©Ð˜Ð™ Ð¢Ð£Ð ÐÐ˜Ð ",CREATE_YOUR_TOURNAMENT:"Ð¡ÐžÐ—Ð”ÐÐ¢Ð¬ Ð¡Ð’ÐžÐ™ Ð¢Ð£Ð ÐÐ˜Ð ",CREATE:"Ð¡ÐžÐ‘Ð•Ð Ð˜",COLLECT:"Ð¡ÐžÐ‘Ð ÐÐ¢Ð¬",YOU_ARE_THE_TOP_OF_THE_TOP:"Ð’Ð« Ð¢ÐžÐŸ-1",READY:"Ð“ÐžÐ¢ÐžÐ’Ðž!",MULTIPLY:"Ð£ÐœÐÐžÐ–Ð˜Ð¢Ð¬?",COLOR_POP:`ÐœÐ¯Ð§Ð˜Ðš ÐžÐŸÐ Ð•Ð”Ð•Ð›Ð•ÐÐÐžÐ“Ðž Ð¦Ð’Ð•Ð¢Ð
Ð£Ð”ÐÐ›Ð¯Ð•Ð¢ Ð’Ð¡Ð• Ð¯Ð™Ð¦Ð,
Ð¡ÐžÐžÐ¢Ð’Ð•Ð¢Ð¡Ð¢Ð’Ð£Ð®Ð©Ð˜Ð• Ð•ÐœÐ£ ÐŸÐž Ð¦Ð’Ð•Ð¢Ð£`,TOUCH_ANYWHERE:`ÐÐÐ–ÐœÐ˜Ð¢Ð• Ð’ Ð›Ð®Ð‘ÐžÐœ ÐœÐ•Ð¡Ð¢Ð•,
Ð§Ð¢ÐžÐ‘Ð« ÐŸÐ ÐžÐ”ÐžÐ›Ð–Ð˜Ð¢Ð¬`},lm={NO_THANKS:"texts/no-thanks-ru"},hm={Text:cm,Texture:lm},um={en:om,ru:hm};class dm extends nm{configure(e){super.configure({data:um,locale:"en",upperCaseText:!1,...e})}}const ne=i=>i[hc],pm=i=>ne(i).gameplay.mode,gm=i=>ne(i).gameplay.status,mm=i=>ne(i).gameplay.rescued,fm=i=>ne(i).gameplay.startAt,ym=i=>ne(i).gameplay.finishAt,Em=i=>ne(i).gameplay.type,dt=G([pm],i=>i);G([gm],i=>i);G([mm],i=>i);const Sm=G([fm],i=>i),Am=G([ym],i=>i),sl=G([Em],i=>i);class bm extends GameCore.Analytics.BaseAnalytics{isGamePlaying=!1;isGameStartLog=!1;constructor(e,t){super("GLanceAnalytics",{...t},"#E35360"),this.selfLog=!1}processEvent(e,t,s){if(e==V.LOAD_COMPLETE){window.sendCustomAnalyticsEvent(V.GLANCE_GAME_LOAD,{});return}}processGameEnd(e,t,s=-1e5){let n;const a=this.getCurrentGameType(),r={score:e,highScore:t};s!==-1e5&&a==="level"?n={...r,level:s}:n=r,Object.keys(n).forEach(c=>{n[c]==null&&delete n[c]}),e!=null&&t!=null&&a!="level"&&(window.game.audio.pauseMusic(),window.game.audio.muteAll()),window.sendCustomAnalyticsEvent(V.GLANCE_GAME_END,n)}processGameStart(e,t=-1e5){if(!this.isGameStartLog){this.isGameStartLog=!0,window.sendCustomAnalyticsEvent(V.GLANCE_GAME_START,{});return}let s;const n=this.getCurrentGameType(),a={score:0,highScore:e};t!==-1e5&&n==="level"?s={...a,level:t}:s=a,window.sendCustomAnalyticsEvent(V.GLANCE_GAME_REPLAY,s)}processGameLevel(e){window.sendCustomAnalyticsEvent(V.GLANCE_GAME_LEVEL,{level:e})}processPageView(e){}processLevelStart(e){if(!this.isGamePlaying){const t=window.game.player.getBestScore();this.processGameStart(t,e),this.isGamePlaying=!0}this.isGamePlaying&&this.getCurrentGameType()==="level"&&this.processGameLevel(e)}processLevelFail(e,t){if(this.isGamePlaying){if(t!=null){const s=t||0,n=window.game.player.getBestScore(),a=Math.max(n,s);this.processGameEnd(s,a,e)}else this.processGameEnd(void 0,void 0,e);this.isGamePlaying=!1}}processLevelComplete(e,t){if(this.getCurrentGameType()!=="level")return;const n=t||0;window.sendCustomAnalyticsEvent(V.GLANCE_GAME_LEVEL_COMPLETED,{level:e,score:n})}processShowRewardedVideoAd(e){}processGameMilestone(e,t={},s=0,n=0){const a=window.game.player.getBestScore();sendCustomAnalyticsEvent(V.GLANCE_GAME_MILESTONE,{type:e,meta:t,level:s,score:n,highScore:Math.max(a,n)})}processGameLifeEnd(e,t=0,s=0){const n=window.game.player.getBestScore();sendCustomAnalyticsEvent(V.GLANCE_GAME_LIFE_END,{remainingLife:e,level:t,score:s,highScore:Math.max(n,s)})}processIngameTransactions(e,t={},s=0,n=0){const a=window.game.player.getBestScore();sendCustomAnalyticsEvent(V.GLANCE_INGAME_TRANSACTIONS,{transactionType:e,meta:t,level:s,score:n,highScore:Math.max(a,n)})}getCurrentGameType(){const{storage:e}=window.game,t=e.getState();let s=sl(t);if(s!=="endless"&&s!=="level"){//! INVALID GAME TYPE
console.warn("Invalid game type detected. Game type must be either endless or level!"),s="level"}return s}}class Tm extends Phaser.Scene{create(){this.facebook.progressLoading.loadingProgressFbBootScene(),this.startGame()}startGame=async()=>{try{await this.auth.requestToken(),await this.storage.syncStore(),this.configureSentry(),this.configureRollbar(),this.detectGameMode(),this.initGoogleAnalytics(),this.scene.launch(j.GLOBAL_SCENE),this.scene.switch(j.LOAD_SCENE),this.analytics.pageview("load-scene")}catch(e){K(e)}finally{this.facebook.progressLoading.finishLoadingProgressFbBootScene(),this.scene.sleep(j.BOOT_SCENE)}};configureSentry(){const e=this.player.getPlayer();Yu({id:e.playerId,username:e.name})}configureRollbar(){if(!this.rollbar)return;const e=this.player.getPlayer();this.rollbar.configure({payload:{person:{id:e.playerId,name:e.name}}})}detectGameMode(){this.storage.dispatch(tm())}initGoogleAnalytics(){this.analytics.add(new bm(this.game,{}))}}const z={BACKGROUND:1,SPRITES:2,BALL_AND_TAIL:3,SHOOTER:4,BULLET:5,FIREWORKS:5,ITEM:10,LOGO:15,BUTTON:20,FLYING_EGG:22,TILE:25,TEXT:30,ENCOURAGING:31,EFFECT:32,MESSAGE:33,UI:35,LEADERBOARD:36,POPUP:40,PRIORITY:80,DEBUG:90,ON_TOP:1e4},L={READY_SCREEN:"READY_SCREEN",GUIDE_SCREEN:"GUIDE_SCREEN",PAUSE_SCREEN:"PAUSE_SCREEN",RESCUE_SCREEN:"RESCUE_SCREEN",NOT_ENOUGH_COINS_SCREEN:"NOT_ENOUGH_COINS_SCREEN",GAME_OVER_SCREEN:"GAME_OVER_SCREEN",NOTIFY_SCREEN:"NOTIFY_SCREEN",REWARD_SCREEN:"REWARD_SCREEN",SETTINGS_SCREEN:"SETTINGS_SCREEN",BEST_SCORE_SCREEN:"BEST_SCORE_SCREEN",DAILY_REWARD_SCREEN:"DAILY_REWARD_SCREEN",DAILY_MISSIONS_SCREEN:"DAILY_MISSIONS_SCREEN",LUCKY_REWARD_SCREEN:"LUCKY_REWARD_SCREEN"},Be={SCREEN:200,POPUP:300,PRIORITY:999};class pe{scene;config;isStarted;tween;constructor(e,t){if(t.targets.length<1)return;this.buildConfig(e,t);const{scene:s}=this.config.targets[0];s&&(this.scene=s,this.isStarted=!1,this.tween=s.tweens.create(this.config))}buildConfig(e,t){this.config=Ie(e,t)}play(){if(this.tween){if(this.isStarted&&this.tween.hasStarted){this.restart();return}this.tween.play(),this.isStarted=!0}}restart(){this.tween?.restart()}stop(){this.tween?.stop()}remove(){this.tween?.remove()}next(e){return this.tween?(this.tween.off(Phaser.Tweens.Events.TWEEN_COMPLETE,e),this.tween.once(Phaser.Tweens.Events.TWEEN_COMPLETE,e),this.tween):null}}var wm=4,Cm=.001,Im=1e-7,Pm=10,Cs=11,Zs=1/(Cs-1),vm=typeof Float32Array=="function";function il(i,e){return 1-3*e+3*i}function nl(i,e){return 3*e-6*i}function al(i){return 3*i}function Ei(i,e,t){return((il(e,t)*i+nl(e,t))*i+al(e))*i}function rl(i,e,t){return 3*il(e,t)*i*i+2*nl(e,t)*i+al(e)}function Om(i,e,t,s,n){var a,r,c=0;do r=e+(t-e)/2,a=Ei(r,s,n)-i,a>0?t=r:e=r;while(Math.abs(a)>Im&&++c<Pm);return r}function _m(i,e,t,s){for(var n=0;n<wm;++n){var a=rl(e,t,s);if(a===0)return e;var r=Ei(e,t,s)-i;e-=r/a}return e}function Rm(i){return i}var xm=function(e,t,s,n){if(!(0<=e&&e<=1&&0<=s&&s<=1))throw new Error("bezier x values must be in [0, 1] range");if(e===t&&s===n)return Rm;for(var a=vm?new Float32Array(Cs):new Array(Cs),r=0;r<Cs;++r)a[r]=Ei(r*Zs,e,s);function c(o){for(var l=0,h=1,d=Cs-1;h!==d&&a[h]<=o;++h)l+=Zs;--h;var u=(o-a[h])/(a[h+1]-a[h]),p=l+u*Zs,g=rl(p,e,s);return g>=Cm?_m(o,p,e,s):g===0?p:Om(o,l,l+Zs,e,s)}return function(l){return l===0?0:l===1?1:Ei(c(l),t,n)}};const ol=xm,Dm=ol(.55,.47,.43,.91),Bm={targets:[],yoyo:!0,repeat:-1,duration:600,repeatDelay:50,ease:Dm,easeParams:[0,.9],props:{scale:{from:1,to:1.2}}};class Jt extends pe{constructor(e){super(Bm,e)}}const km={targets:[],repeat:-1,yoyo:!0,duration:33,ease:Phaser.Math.Easing.Sine.InOut,props:{x:5}};class ea extends pe{posX;constructor(e){super(km,e),this.config?.props&&(this.posX=this.config.props.x,this.tween?.on(Phaser.Tweens.Events.TWEEN_REPEAT,this.handleSwitchPosition))}handleSwitchPosition=()=>{this.posX=-this.posX,this.tween?.updateTo("x",-this.posX)}}const ta=ol(.48,1.57,.6,.83),Nm={targets:[],duration:400,ease:ta,props:{scale:"-=0.1"}};class vn extends pe{constructor(e){super(Nm,e)}}const Mm={targets:[],duration:600,ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:{start:0,from:0,to:1}}};class Ve extends pe{constructor(e){super(Mm,e)}}const Lm={targets:[],duration:600,ease:Phaser.Math.Easing.Quadratic.Out,props:{alpha:{start:1,from:1,to:0}}};class ke extends pe{constructor(e){super(Lm,e)}}const Gm={targets:[],duration:300,ease:ta,props:{scale:{from:1.2,to:1}}};class zs extends pe{constructor(e){super(Gm,e)}}const Fm={targets:[],duration:1e3,ease:Phaser.Math.Easing.Quadratic.InOut,props:{scale:.2}};class Um extends pe{spline;constructor(e){super(Fm,e);const{curve:t}=this.config;t&&(this.spline=new Phaser.Curves.Spline(t),this.tween?.on(Phaser.Tweens.Events.TWEEN_START,this.createCounter))}createCounter=(e,t)=>{const{onCurveUpdate:s}=this.config,n=typeof s=="function"?s:null;t.forEach((a,r)=>{if(!this.scene)return;const{duration:c,delay:o}=e.data[r],l=new Phaser.Math.Vector2;this.scene.tweens.addCounter({delay:o,duration:c,ease:Phaser.Math.Easing.Quadratic.InOut,onUpdate:h=>{this.spline.getPoint(h.getValue(),l),a.x=l.x,a.y=l.y,n&&n(a)}})})}}const H={BUTTON_CLICK:"button_click",CONGRATULATION:"congratulation",DAILY_REWARD:"daily_reward",DIAMONDS_EAT:"diamonds_eat",GAME_OVER_SCENE:"game_over_scene",GIFT_CHARGE:"gift_charge",GIFT_EXPLODE:"gift_explode",GIFT_REVEAL:"gift_reveal",POPUP_OFF:"popup_off",POPUP_SHOW:"popup_show",SCORE_COUNTER:"score_counter",IMPACT:"gameplay_impact",SHOOT_BALL:"gameplay_shoot_ball",DROP_FLOOR:"gameplay_drop_floor",EGG_EXPLODE:"gameplay_break_egg",BOMB_EXPLODE:"gameplay_bomb_explode",WARNING:"gameplay_warning",COMBO:"gameplay_combo",SUPER_COMBO:"gameplay_super_combo",CAMBRIAN_COMBO:"gameplay_cambrian_combo",TRIASSIC_COMBO:"gameplay_triassic_combo",JURASSIC_COMBO:"gameplay_jurassic_combo",CRETACEOUS_COMBO:"gameplay_cretaceous_combo",DYNOMITE_COMBO:"gameplay_dynamite_combo",WHIRLEY_HIT:"gameplay_whirley_hit",WHIRLEYSIREN:"gameplay_whirleysiren",SHOWING_BOMB:"gameplay_showing_bomb",DESTROYED_LOTS_EGG:"gameplay_destroyed_lots_egg",START_GAME:"gameplay_start_game",GAMEOVER:"gameplay_gameover",TICKTOCK:"gameplay_ticktock",AOOGA:"gameplay_aooga"};class Q extends Phaser.GameObjects.Container{useSound=!0;isClicked=!1;scaleUp=-1;scaleDown=-1;button;upAnimation;downAnimation;isUsePixelPerfect=!1;hitArea;hitZone;scaleDownPress;parentName;constructor(e,t,s,n,a,r=!1){super(e),this.isUsePixelPerfect=r,this.setDepth(z.BUTTON),this.createButton(t,s,n,a),this.updateSize(),this.listenEvents(),this.scene.add.existing(this)}listenEvents(){this.scene.events.on(Phaser.Scenes.Events.SLEEP,this.handleSceneSleep),this.once(Phaser.GameObjects.Events.DESTROY,this.handelObjectDestroy)}handelObjectDestroy=()=>{this.scene&&this.scene.events.off(Phaser.Scenes.Events.SLEEP,this.handleSceneSleep)};handleSceneSleep=()=>{this.scene&&this.scene.tweens.killTweensOf(this)};set onClick(e){this.isUsePixelPerfect?(this.hitArea=this.button,this.hitArea.setInteractive({useHandCursor:!0,pixelPerfect:!0})):(this.hitArea=this.hitZone,this.updateSize(),this.hitArea.setInteractive({useHandCursor:!0})),this.hitArea.off(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.handlePointerDown),this.hitArea.off(Phaser.Input.Events.GAMEOBJECT_POINTER_UP),this.hitArea.off(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,this.handlePointerOut),this.hitArea.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.handlePointerDown),this.hitArea.on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,this.handleOnClick(e)),this.hitArea.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,this.handlePointerOut)}get isUsePixelPerFect(){return this.isUsePixelPerfect}handlePointerDown=()=>{this.isClicked||this.upAnimation?.tween?.isPlaying()||(this.isClicked=!0,this.runDownAnimation())};handleOnClick=e=>()=>{this.isClicked&&(this.upAnimation?.tween?.isPlaying()||(this.isClicked=!1,this.runUpAnimation(),this.upAnimation?.tween?.once(Phaser.Tweens.Events.TWEEN_COMPLETE,()=>{this.logButtonEvent(),this.addDebugData(),this.processCallback(e)})))};handlePointerOut=()=>{this.isClicked&&(this.upAnimation?.tween?.isPlaying()||(this.isClicked=!1,this.runUpAnimation()))};processCallback(e){this.upAnimation?.stop(),this.downAnimation?.stop(),this.scene?.tweens.killTweensOf(this),this.scaleUp!==-1&&this.setScale(this.scaleUp),e()}setDisabled(e){e?(this.setAlpha(.5),this.hitArea?.disableInteractive()):(this.setAlpha(1),this.hitArea?.setInteractive())}createButton(e,t,s,n){this.button=this.scene.add.image(0,0,e,t),s&&n&&this.button.setWorldSize(s,n),this.scaleDownPress=this.scale-.1;const{displayWidth:a,displayHeight:r}=this.button;this.hitZone=this.scene.make.zone({displayWidth:a,displayHeight:r}),this.add([this.button,this.hitZone])}updateSize(){const{width:e,height:t}=this.button,s=10,n=e/100*10,a=t/100*10,r=n<s?n:s,c=a<s?a:s;this.setSize(e+r,t+c),this.hitZone.setSize(e+r,t+c)}runDownAnimation=()=>{this.scaleDown===-1&&(this.scaleUp=this.scale,this.scaleDown=this.scaleDownPress),this.useSound&&this.scene.audio.playSound(H.BUTTON_CLICK),this.downAnimation?.remove(),this.downAnimation=new vn({targets:[this],duration:150,props:{scale:this.scaleDown},onUpdate:()=>{this.hitZone.scale=1/this.scale}}),this.downAnimation.play()};runUpAnimation=()=>{this.scaleUp!==-1&&(this.upAnimation?.remove(),this.upAnimation=new vn({targets:[this],duration:150,props:{scale:this.scaleUp},onUpdate:()=>{this.hitZone.scale=1/this.scale}}),this.upAnimation.play())};addDebugData(){const e=this.getParentName(),t=this.name;wi("ui-click",`${e}:${t}`)}logButtonEvent(){const e=this.getParentName(),t=this.name;this.scene.analytics.event(V.BUTTON_CLICK,{button_name:t,screen_name:e})}getParentName(){if(this.parentName)return this.parentName;let e=this.parentContainer;for(;e;){if(e instanceof GameCore.Screen){const t=e;return this.parentName=t.getScreenName(),this.parentName}e=e.parentContainer}return this.parentName=this.scene.getSceneName(),this.parentName}}const Ee=GameCore.Utils.Image.getImageScale(),_={DEFAULT_32BIT:{KEY:"default-resources-32bit",TEXTURE:`./assets/textures/${Ee}x/default-resources-32bit.png`,JSON:`./assets/textures/${Ee}x/default-resources-32bit.json`},DEFAULT:{KEY:"default-resources",TEXTURE:`./assets/textures/${Ee}x/default-resources.png`,JSON:`./assets/textures/${Ee}x/default-resources.json`,FRAME:{BLANK:"blank",LINE_HOR:"other/line-hor",LINE_VER:"other/line-ver",TOP_PANEL:"other/top-panel",PRELOADER:"preloader/dual-ring",DASHBOARD_FOOTER_BLOCK:"dashboard/footer-block",LEADERBOARD_TAB_ON:"leaderboards/tab-on",LEADERBOARD_TAB_OFF:"leaderboards/tab-off",LEADERBOARD_BG_DARK:"leaderboards/bg-dark",LEADERBOARD_BG_LIGHT:"leaderboards/bg-light",MISSION_BLOCK_BG:"daily-mission/bg-block",DAILY_DAY_BG_WAIT:"daily-rewards/bg-wait",DAILY_DAY_BG_OPEN:"daily-rewards/bg-open",DAILY_DAY_BG_REWARD:"daily-rewards/bg-reward",DAILY_DAY_COIN_DAY_1:"daily-rewards/coin-day1",DAILY_DAY_COIN_DAY_2:"daily-rewards/coin-day2",DAILY_DAY_COIN_DAY_3:"daily-rewards/coin-day3",DAILY_DAY_COIN_DAY_4:"daily-rewards/coin-day4",DAILY_DAY_COIN_DAY_5:"daily-rewards/coin-day5",DAILY_DAY_COIN_DAY_6:"daily-rewards/coin-day6",RIBBON_RED:"ribbon/red",RIBBON_PINK:"ribbon/pink",RIBBON_ORANGE:"ribbon/orange",RIBBON_VIOLET:"ribbon/violet",AVATAR_BG:"avatar/bg",AVATAR_BG_BIG:"avatar/bg-big",AVATAR_FRAME_BLUE_BIG:"avatar/blue-frame-big",AVATAR_FRAME_PURPLE:"avatar/purple-frame",AVATAR_FRAME_PURPLE_BIG:"avatar/purple-frame-big",DINO:"logo/dino",DINO_SAD:"logo/dino-sad",EGGS:"logo/eggs",LEAVES:"logo/leaves",TRUMPET:"logo/trumpet",LOGO_GIFT:"logo/gift",LOGO_GIFT_ADS:"logo/gift-ad",LOGO_GIFT_GLOW:"logo/gift-glow",POPUP_TOP_LEFT:"popup/top-left",POPUP_TOP_MID:"popup/top-middle",POPUP_TOP_RIGHT:"popup/top-right",POPUP_MID_LEFT:"popup/middle-left",POPUP_MID_MID:"popup/middle-middle",POPUP_MID_RIGHT:"popup/middle-right",POPUP_BOTTOM_LEFT:"popup/bottom-left",POPUP_BOTTOM_MID:"popup/bottom-middle",POPUP_BOTTOM_RIGHT:"popup/bottom-right",POPUP_BOARD_BOTTOM:"popup/board-bottom",PROGRESS_BG_LEFT:"progress/bg-left",PROGRESS_BG_MID:"progress/bg-mid",PROGRESS_BG_RIGHT:"progress/bg-right",PROGRESS_BAR_LEFT:"progress/bar-left",PROGRESS_BAR_MID:"progress/bar-mid",PROGRESS_BAR_RIGHT:"progress/bar-right",ICON_HAND:"icons/hand",ICON_DOT:"icons/dot",ICON_BEST_SCORE_CUP:"icons/bestscore-cup",ICON_MEDAL:"icons/medal",ICON_GIFT:"icons/gift",ICON_RANKING:"icons/ranking",ICON_MISSION:"icons/mission",ICON_CLOCK:"icons/clock",ICON_ADS_VIDEO:"icons/ads-video",ICON_CANCEL:"icons/cancel",ICON_SETTING:"icons/setting",ICON_VIB:"icons/vibrate",ICON_MUSIC:"icons/music",ICON_SOUND:"icons/sound",ICON_HOME:"icons/home",ICON_SHARE:"icons/share",ICON_CROWN:"icons/crown",ICON_GOLD:"icons/gold",ICON_SILVER:"icons/silver",ICON_BRONZE:"icons/bronze",ICON_QUESTION:"icons/question",ICON_RANK_NUMBER_BG:"icons/rank-number-bg",ICON_RANK_BLUE_BG:"icons/blue-rank-number-bg",ICON_DIAMOND:"icons/diamond",ICON_COIN:"icons/coin",ICON_COIN_SMALL:"icons/coin-small",ICON_COIN_SMALL_GREY:"icons/coin-small-grey",ICON_EGGS:"icons/egg",ICON_BIRD:"icons/icon-bird",ICON_DYNAMITE:"icons/icon-dynamite",ICON_10K:"icons/icon-10k",ICON_2ND:"icons/icon-2nd",ICON_INVITE:"icons/invite",ICON_ARROW_BIG:"icons/arrow-big",ICON_FRIENDS:"icons/friends",ICON_PLAY:"icons/play",ICON_REPLAY:"icons/replay",ICON_PLAY_WITH:"icons/play-with",ICON_CONTINUE:"icons/continue",SWITCH_ON:"switch/on",SWITCH_OFF:"switch/off",SWITCH_PANEL:"switch/panel",BUTTON_CLOSE:"buttons/close",BUTTON_ADD:"buttons/add",BUTTON_YELLOW:"buttons/yellow",BUTTON_BLUE:"buttons/blue",BUTTON_BLUE_BIG:"buttons/blue-big",BUTTON_BLUE_SHORT:"buttons/blue-short",BUTTON_BLUE_MINOR:"buttons/blue-minor",BUTTON_GREEN:"buttons/green",BUTTON_GREEN_BIG:"buttons/green-big",BUTTON_GREEN_SHORT:"buttons/green-short",BUTTON_GREEN_MINOR:"buttons/green-minor",NO_THANKS_TEXT:"texts/no-thanks",TOURNAMENT_TITLE_LOGO:"tournament/title-logo",TOURNAMENT_GREEN_BUTTON:"tournament/green-button",HORIZONTAL_LUCKY_BAR:"lucky-bar/horizontal-lucky-bar",HORIZONTAL_ARROW:"lucky-bar/horizontal-arrow",ARC_LUCKY_BAR:"lucky-bar/arc-lucky-bar",ARC_ARROW:"lucky-bar/arc-arrow"}},EFFECTS:{KEY:"effects-resources",TEXTURE:`./assets/textures/${Ee}x/effects-resources.png`,JSON:`./assets/textures/${Ee}x/effects-resources.json`,FRAME:{BLANK:"blank",COIN:"coin",FX_COMET:"comet",FX_SPARK:"spark",FX_CIRCLE:"circle",FX_GLOW_LIGHT:"glow-light",FX_STAR_WHITE:"star-white",FX_STAR_YELLOW:"star-yellow",FX_CONFETTI_SMALL_1:"confetti/small-1",FX_CONFETTI_SMALL_2:"confetti/small-2",FX_CONFETTI_SMALL_3:"confetti/small-3",FX_CONFETTI_SMALL_4:"confetti/small-4",FX_CONFETTI_HEXAGON:"confetti/hexagon-",ANIMATION_STAR_X:"star-x/star-",ANIMATION_STAR_Y:"star-y/star-",FX_CONFETTI_RIBBON:"ribbon/ribbon",PREFIX_ANIMATION_RIBBON_CONFETTI_A:"ribbon/falling-confetti/confetti-a/confetti-a-",PREFIX_ANIMATION_RIBBON_CONFETTI_B:"ribbon/falling-confetti/confetti-b/confetti-b-",PREFIX_ANIMATION_RIBBON_CONFETTI_C:"ribbon/falling-confetti/confetti-c/confetti-c-",PREFIX_ANIMATION_RIBBON_CONFETTI_D:"ribbon/falling-confetti/confetti-d/confetti-d-"}},ANIMATION_SCENE:{KEY:"effects-resources",PATH:`./assets/textures/${Ee}x/`,JSON:`./assets/textures/${Ee}x/animation-scene-resources.json`,FRAME:{BLANK:"blank",FX_CIRCLE_LIGHT:"circle-light",ANIMATION_STAR_X:"star-x/star-",ANIMATION_STAR_Y:"star-y/star-",FX_SPARK_YELLOW:"yellow-spark",FX_CONFETTI_RIBBON:"ribbon/ribbon",PREFIX_ANIMATION_RIBBON_CONFETTI_A:"ribbon/falling-confetti/confetti-a/confetti-a-",PREFIX_ANIMATION_RIBBON_CONFETTI_B:"ribbon/falling-confetti/confetti-b/confetti-b-",PREFIX_ANIMATION_RIBBON_CONFETTI_C:"ribbon/falling-confetti/confetti-c/confetti-c-",PREFIX_ANIMATION_RIBBON_CONFETTI_D:"ribbon/falling-confetti/confetti-d/confetti-d-"}},GAMEPLAY:{GAMEPLAY_TEXTURES_32BIT:{KEY:"gameplay-textures-32bit",TEXTURE:`./assets/textures/${Ee}x/gameplay-textures-32bit.png`,JSON:`./assets/textures/${Ee}x/gameplay-textures-32bit.json`},GAMEPLAY_TEXTURES:{KEY:"gameplay-texture",TEXTURE:`./assets/textures/${Ee}x/gameplay-textures.png`,JSON:`./assets/textures/${Ee}x/gameplay-textures.json`,FRAME:{BLANK:"blank",BUTTON_PAUSE:"buttons/pause",PROGRESS_BG:"progress/progress-bg",PROGRESS_TOP:"progress/progress-top",PROGRESS_MIDDLE:"progress/progress-middle",PROGRESS_BOTTOM:"progress/progress-bottom",RANK_VIOLET:"rank/rank-violet",RANK_YELLOW:"rank/rank-yellow",TAB_SCORE:"others/tab-score",TOP_LINE:"others/top-line",ROPE:"others/rope",HAND:"others/hand",AVATAR_BG:"avatar/bg",AVATAR_FRAME:"avatar/frame",ICON_GOLD:"icons/gold",ICON_SILVER:"icons/silver",ICON_BRONZE:"icons/bronze",EGG_EXPLOSIVE:"animations/egg/egg-explosive-",DINO_FLY:"animations/fly-dino/body/body-",DINO_LEG:"animations/fly-dino/leg/leg-",SHOWING_BOMB:"animations/bomb/showing-bomb-",OWL:"animations/owl/owl",OWL_CLOSE:"animations/owl/owl-close",DINO:"animations/dino/dino-",PARTICLE_CIRCLE_1:"particles/others/circle-1",PARTICLE_CIRCLE_2:"particles/others/circle-2",PARTICLE_STAR:"particles/others/star",BOMB_FRAGMENT:"particles/bomb/bomb-fragment-",EGG_SHELL:"particles/egg/egg-shell-",ITEM_GIFT_BOMB:"items/gift-bomb",ITEM_GIF_CLOSE:"items/gift-close",ITEM_GLOW_EFFECT:"items/glow",HIGHLIGHT_CIRCLE:"others/highlight-circle",FIRE_CIRCLE:"others/fire-circle",TAIL:"others/tail",WARNING_SIGNAL:"others/warning-signal",FOOTER_BG:"others/footer-bg"}},GAME_OBJECTS:{KEY:"gameplay-main-objects",TEXTURE:`./assets/textures/${Ee}x/gameplay-main-objects.png`,JSON:`./assets/textures/${Ee}x/gameplay-main-objects.json`,FRAME:{BLANK:"blank",SHOOTER:"shooter",SHOT_GUIDE:"shot-guide",BALL_BLACK:"eggs/bubble-black",BALL_BLUE:"eggs/bubble-blue",BALL_CYAN:"eggs/bubble-cyan",BALL_GRAY:"eggs/bubble-gray",BALL_GREEN:"eggs/bubble-green",BALL_PINK:"eggs/bubble-pink",BALL_RED:"eggs/bubble-red",BALL_VIOLET:"eggs/bubble-violet",BALL_YELLOW:"eggs/bubble-yellow",BOMB:"bombs/bomb",BONUS_STAMP_2X:"stamps/stamp-2x",BONUS_STAMP_3X:"stamps/stamp-3x",BONUS_STAMP_4X:"stamps/stamp-4x",BONUS_STAMP_05:"stamps/stamp-05",BONUS_STAMP_10:"stamps/stamp-10",BONUS_STAMP_15:"stamps/stamp-15",BONUS_STAMP_UP:"stamps/stamp-up",SHOT_GUIDE_BLACK:"shot-guide/black",SHOT_GUIDE_BLUE:"shot-guide/blue",SHOT_GUIDE_CYAN:"shot-guide/cyan",SHOT_GUIDE_GREEN:"shot-guide/green",SHOT_GUIDE_GRAY:"shot-guide/gray",SHOT_GUIDE_PINK:"shot-guide/pink",SHOT_GUIDE_RED:"shot-guide/red",SHOT_GUIDE_VIOLET:"shot-guide/violet",SHOT_GUIDE_YELLOW:"shot-guide/yellow",SHOT_GUIDE_ORANGE:"shot-guide/orange"}}},DEMO_SPINE:{KEY:"demo-spine",jsonPATH:"./assets/spines/demo/demo.json",atlasPATH:"./assets/spines/demo/demo.atlas"}};GameCore.Utils.Valid.isDebugger()&&(_.EFFECTS.FRAME={..._.ANIMATION_SCENE.FRAME,..._.EFFECTS.FRAME});const{KEY:Ym,FRAME:Hm}=_.DEFAULT;class zm extends Phaser.GameObjects.Container{hand;constructor(e){super(e),this.name="TapTutorialHand",this.addHand(),this.scene.add.existing(this)}addHand(){this.hand=this.scene.make.image({key:Ym,frame:Hm.ICON_HAND,origin:{x:.5,y:.5}}),this.hand.setWorldSize(65.5,55.5),this.add(this.hand)}playAnimation(e=0,t=800){const s=1/GameCore.Utils.Image.getImageScale();this.hand.angle=30,this.scene?.tweens.add({delay:e,targets:[this.hand],ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:{start:0,value:1,duration:200},scale:{duration:400,start:s*1.6,to:s*1.2},angle:{from:30,value:0,duration:400}},onComplete:()=>{this.scene?.tweens.add({targets:[this.hand],delay:200,duration:200,ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:0},onComplete:()=>{this.hand.x=0,this.hand.y=0,this.hand.scale=s,this.playAnimation(t)}})}})}stopAnimation(){this.scene.tweens.killTweensOf(this.hand)}preDestroy(){this.scene.tweens.killTweensOf(this.hand)}}const B={PRIMARY:{KEY:"troika",TEXTURE:{en:"./assets/fonts/troika.png",ru:"./assets/fonts/troika-ru.png"},DATA:{en:"./assets/fonts/troika.xml",ru:"./assets/fonts/troika-ru.xml"}},FONT_FAMILY:"Troika-en-ru"},{KEY:Wm,FRAME:ja}=_.EFFECTS;class Vm extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitZone;emitter;constructor(e){super(e,Wm,ja.FX_STAR_YELLOW),this.createEmitZone(),this.scene.add.existing(this)}createEmitZone(){this.emitZone=new Phaser.Geom.Rectangle}createEmitters(){const e=1/GameCore.Utils.Image.getImageScale();this.emitter=this.createEmitter({on:!1,frame:ja.FX_COMET,emitZone:{source:this.emitZone,type:"random"},speed:20,timeScale:1,frequency:100,alpha:{start:1,end:0,ease:Phaser.Math.Easing.Expo.Out},scale:{start:e*2,end:e*.1,ease:Phaser.Math.Easing.Expo.Out},lifespan:2666})}run(e,t,s,n,a){this.stop(),this.reset(),this.emitZone.setSize(n,a),this.emitZone.setPosition(t-n/2,s-a/2),this.emitter.setQuantity(e),this.emitter.start()}explode(e,t,s){this.emitter||this.reset(),this.emitter.explode(e,t,s)}stop(){this.emitter?.killAll(),this.emitter?.stop()}reset(){this.createEmitters()}}const{KEY:Km,FRAME:Xa}=_.EFFECTS;class $m extends Phaser.GameObjects.Particles.ParticleEmitterManager{deathZone;emitter;constructor(e){super(e,Km,Xa.FX_SPARK),this.createDeathZone(),this.createEmitters(),this.setActive(!1),this.setVisible(!1),this.scene.add.existing(this)}createDeathZone(){this.deathZone=new Phaser.Geom.Circle}createEmitters(){const e=1/GameCore.Utils.Image.getImageScale();this.emitter=this.createEmitter({on:!1,frame:Xa.FX_SPARK,speed:{min:10,max:1200},scale:{start:e*1.33,end:0},alpha:{start:1,end:0,ease:Phaser.Math.Easing.Expo.Out},deathZone:{source:this.deathZone,type:"onLeave"},lifespan:3e3})}explode(e,t,s,n){this.setActive(!0),this.setVisible(!0),this.deathZone.radius=n,this.deathZone.setPosition(t,s),this.emitter.explode(e,t,s)}}const{KEY:jm,FRAME:qa}=_.EFFECTS;class cl extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitZone;emitter;constructor(e){super(e,jm,qa.FX_COMET),this.createEmitZone(),this.createEmitters(),this.scene.add.existing(this)}createEmitZone(){this.emitZone=new Phaser.Geom.Rectangle}createEmitters(){const e=1/GameCore.Utils.Image.getImageScale();this.emitter=this.createEmitter({on:!1,frame:qa.FX_COMET,emitZone:{source:this.emitZone,type:"random"},deathZone:{source:this.emitZone,type:"onLeave"},timeScale:1,frequency:150,speedY:{min:-20,max:-60},alpha:{start:1,end:0,ease:Phaser.Math.Easing.Cubic.Out},scale:{start:e*1,end:0,ease:Phaser.Math.Easing.Cubic.Out},lifespan:{min:1500,max:2500}})}run(e,t,s,n,a){this.stop(),this.emitZone.setSize(n,a),this.emitZone.setPosition(t-n/2,s-a/2),this.emitter.setQuantity(e),this.emitter.start()}stop(){this.emitter?.killAll(),this.emitter?.stop()}}class Qt extends Q{paddingZone;showDebugZone;debugZone;constructor(e,t){const{key:s,frame:n,width:a,height:r,usePixelPerfect:c}=t;super(e,s,n,a,r,c);const{paddingZone:o=0,showDebugZone:l=!1}=t;this.paddingZone=o,this.showDebugZone=l}updateSize(){super.updateSize();const{width:e,height:t}=this,s=e+this.paddingZone,n=t+this.paddingZone;this.setSize(s,n),this.hitZone.setSize(s,n),this.showDebugZone&&(this.debugZone?.destroy(),this.debugZone=this.hitZone.drawDebugBox(10699282,.5),this.add(this.debugZone))}}const{KEY:Xm,FRAME:qm}=_.EFFECTS,{KEY:ft,FRAME:kt}=_.DEFAULT;class Zm extends GameCore.Screen{rewardValue;onReward;hand;viewAdButton;skipButton;closeButton;giftIcon;giftIconWhite;giftAdsIcon;glowFx;currencyText;popupContents;cometTwinkle;starTwinkleUp;sparksExplosive;popupFadeOutAnimation;backgroundFadeInAnimation;contentShowUpAnimation;giftEntrancesAnimation;iconAttentionAnimation;giftShakeAnimation;giftOpenAnimation;adsTimer;constructor(e,t,s,n){super(e,t,s,n),this.setDepth(Be.POPUP),this.background.setAlpha(.8),this.createCloseButton(),this.createViewAdsButton(),this.createSkipButton(),this.createGiftGlow(),this.createGiftAdsIcon(),this.createCurrencyText(),this.createEffects(),this.createGiftIcon(),this.createHand(),this.createContentsGroup()}open=e=>{super.open(e);const t=this.getData("awardCoins");this.setRewardValue(t),this.runOpenAnimation()};handleClosePopup=()=>{this.runCloseAnimation()};updateCoinData=()=>{const{player:e}=window.game,s=e.getCoins()+this.rewardValue;e.setCustomData("coin",s)};handleShowRewardedAd=async()=>{const{audio:e,game:t}=this.scene;try{this.viewAdButton.setDisabled(!0),t.globalScene.screen.open(L.NOTIFY_SCREEN,{message:this.scene.lang.Text.LOADING_ADS,duration:0,loading:!0}),e.pauseMusic(),e.muteAll(),await this.scene.ads.showRewardedVideoAsync(),t.globalScene.screen.close(L.NOTIFY_SCREEN),this.starTwinkleUp.stop(),this.scene.audio.playSound(H.DAILY_REWARD),this.popupContents.killGroup(),this.runTheGiftEntrancesAnimation(0,1500)}catch(s){if(s instanceof Object&&GameCore.Utils.Object.hasOwn(s,"code")&&s.code==="USER_INPUT"){this.showNotifySkipAd();return}this.showNotifyNoAd()}finally{this.scene.ads.preloadRewardedVideoAsync().catch(s=>{}),this.adsTimer?.destroy(),e.unmuteAll(),e.playMusic(),this.viewAdButton.setDisabled(!1)}};setTheGiftClickable(e){e?this.giftIcon.setInteractive():this.giftIcon.disableInteractive()}handleTheGiftClick=()=>{this.setTheGiftClickable(!1),this.logButtonEvent("OpenGift"),this.hand.kill(),this.giftIconWhite.revive(),this.scene.tweens.killTweensOf(this.giftIcon),Phaser.Display.Align.In.Center(this.giftIconWhite,this.giftIcon),this.scene.audio.playSound(H.GIFT_CHARGE),this.runShakeTheGift(),this.runOpenTheGift()};logButtonEvent(e){const t=this.getScreenName();this.scene.analytics.event(V.BUTTON_CLICK,{button_name:e,screen_name:t})}showNotifyNoAd=()=>{const{globalScene:e}=this.scene.game;e.screen.open(L.NOTIFY_SCREEN,{message:this.scene.lang.Text.NO_ADS,duration:1200,loading:!1})};showNotifySkipAd(){const{globalScene:e}=this.scene.game;e.screen.open(L.NOTIFY_SCREEN,{message:this.scene.lang.Text.SORRY_NO_REWARDS,duration:1500,loading:!1})}runOpenAnimation(){this.revive(),this.hand.kill(),this.popupContents.reviveGroup(),this.starTwinkleUp.stop(),this.runBackgroundEntrancesAnimation(0,200),this.runPopupContentEntrancesAnimation(100,400),this.runLogoAttentionAnimation(500)}runCloseAnimation=()=>{this.runExitsAnimation(0,200)};runBackgroundEntrancesAnimation(e,t){this.backgroundFadeInAnimation||(this.backgroundFadeInAnimation=new Ve({targets:[this.background],delay:e,duration:t,props:{alpha:{start:0,to:.8}}})),this.backgroundFadeInAnimation.play()}runPopupContentEntrancesAnimation(e,t){this.contentShowUpAnimation?.remove(),this.contentShowUpAnimation=new zs({targets:this.popupContents.getChildren(),duration:t,delay:this.scene.tweens.stagger(100,{start:e}),props:{scale:{getStart:s=>s.scale-.3,getEnd:s=>s.scale},alpha:{start:0,from:0,to:1}}}),this.contentShowUpAnimation.play()}runLogoAttentionAnimation(e){const{x:t,y:s,width:n,height:a}=this.giftAdsIcon;this.starTwinkleUp.run(1,t,s,n,a),this.iconAttentionAnimation||(this.iconAttentionAnimation=new Jt({targets:[this.giftAdsIcon],delay:e,props:{scale:"+=0.05"}})),this.iconAttentionAnimation.play()}runTheGiftEntrancesAnimation(e,t){this.giftIcon.revive(),this.giftIcon.setAlpha(1),Phaser.Display.Align.In.TopRight(this.giftIcon,this.zone),this.giftEntrancesAnimation?.remove();const{x:s,y:n}=this.giftIcon,{x:a,y:r}=this.giftIconWhite,c={x:s,y:n},o={x:a,y:r},l=1/GameCore.Utils.Image.getImageScale();this.giftEntrancesAnimation=new Um({targets:[this.giftIcon],delay:e,duration:t,curve:[[c.x,c.y],[c.x-80,c.y+80],[o.x,o.y]],props:{scale:{start:l*.5,to:l},angle:{start:20,to:0}},onCurveUpdate:h=>{const u=h.x+Phaser.Math.RND.between(-40,40),p=h.y+Phaser.Math.RND.between(-40,40);this.cometTwinkle.explode(1,u,p)},onComplete:()=>{this.scene.audio.playSound(H.GIFT_REVEAL);const h=1.5;this.starTwinkleUp.setScale(h);const{x:d,y:u,width:p,height:g}=this.giftIcon;this.starTwinkleUp.run(1,d,u,p/h,g/h),this.moveTo(this.starTwinkleUp,this.length-1),this.handleTheGiftClick()}}),this.giftEntrancesAnimation.play()}runShakeTheGift(){this.giftShakeAnimation||(this.giftShakeAnimation=new ea({targets:[this.giftIcon,this.giftIconWhite],duration:22})),this.giftShakeAnimation.play()}runOpenTheGift(){if(!this.giftOpenAnimation){const e=1/GameCore.Utils.Image.getImageScale();this.giftOpenAnimation=new vn({targets:[this.giftIcon,this.giftIconWhite],duration:1500,props:{alpha:0,scale:e},onStart:this.updateCoinData,onUpdate:()=>{this.giftIconWhite.setAlpha(1)},onComplete:()=>{this.giftShakeAnimation.stop(),this.giftIcon.kill(),this.giftIconWhite.kill(),this.sparksExplosive.explode(100,this.giftIcon.x,this.giftIcon.y,230),this.scene.audio.playSound(H.GIFT_EXPLODE),this.onReward(this.rewardValue),this.scene.time.delayedCall(500,this.runCloseAnimation)}})}this.giftOpenAnimation.play()}runExitsAnimation(e,t){this.popupFadeOutAnimation||(this.popupFadeOutAnimation=new ke({targets:this.getAll(),delay:e,duration:t,props:{alpha:{start:.8,to:0}},onComplete:()=>{this.scene.screen.close(this.name)}})),this.popupFadeOutAnimation.play()}createHand(){this.hand=new zm(this.scene),this.add(this.hand)}createContentsGroup(){this.popupContents=this.scene.make.group({}),this.popupContents.addMultiple([this.glowFx,this.giftAdsIcon,this.currencyText,this.viewAdButton,this.skipButton,this.closeButton])}createGiftAdsIcon(){this.giftAdsIcon=this.scene.add.image(0,0,ft,kt.LOGO_GIFT_ADS),this.giftAdsIcon.setWorldSize(110,135.5),Phaser.Display.Align.In.Center(this.giftAdsIcon,this.zone,0,-80),this.add(this.giftAdsIcon)}createGiftGlow(){this.glowFx=this.scene.add.image(0,0,Xm,qm.FX_GLOW_LIGHT),this.glowFx.setWorldSize(206,199.5),Phaser.Display.Align.In.Center(this.glowFx,this.zone,0,-80),this.add(this.glowFx),this.scene.tweens.add({targets:[this.glowFx],duration:6e3,repeat:-1,props:{angle:360,scale:{value:"+=0.01",yoyo:!0,duration:800,ease:Phaser.Math.Easing.Sine.InOut}}})}createCurrencyText(){this.currencyText=this.scene.make.bitmapText({size:this.scene.fontSize(28),font:B.PRIMARY.KEY,origin:{x:.5,y:.5}}),this.currencyText.setCenterAlign(),this.setRewardValue(0),this.add(this.currencyText)}setRewardValue(e){this.rewardValue=e,this.currencyText.setText(this.scene.lang.getText({key:"WATCH_A_VIDEO_X",variables:[e]})),Phaser.Display.Align.In.BottomCenter(this.currencyText,this.giftAdsIcon,0,90)}createViewAdsButton(){this.viewAdButton=new Q(this.scene,ft,kt.BUTTON_BLUE,134,68),this.viewAdButton.setName("ViewAd"),this.viewAdButton.onClick=this.handleShowRewardedAd;const e=this.scene.make.bitmapText({size:this.scene.fontSize(16),text:this.scene.lang.Text.GET_NOW,font:B.PRIMARY.KEY}),t=this.scene.make.image({key:ft,frame:kt.ICON_ADS_VIDEO});t.setWorldSize(36,28),this.viewAdButton.add([e,t]),this.add(this.viewAdButton),Phaser.Display.Align.In.Center(e,this.viewAdButton,16),Phaser.Display.Align.In.Center(t,this.viewAdButton,-36),Phaser.Display.Align.In.Center(this.viewAdButton,this.zone,0,130)}createCloseButton(){this.closeButton=new Qt(this.scene,{key:ft,frame:kt.BUTTON_CLOSE,width:48.5,height:43,paddingZone:20}),this.closeButton.setName("Close"),this.closeButton.onClick=this.handleClosePopup,Phaser.Display.Align.In.TopRight(this.closeButton,this.zone,-15,-15),this.add(this.closeButton)}createSkipButton(){const e=this.scene.lang.getCurrentLanguage(),t=e==="ru"?130.5:97.5,s=e==="ru"?20.5:21.5;this.skipButton=new Q(this.scene,ft,this.scene.lang.Texture.NO_THANKS,t,s),this.skipButton.setName("NoThanks"),this.skipButton.onClick=this.handleClosePopup,Phaser.Display.Align.In.BottomCenter(this.skipButton,this.viewAdButton,0,35),this.add(this.skipButton)}createGiftIcon(){this.giftIconWhite=this.scene.make.image({key:ft,frame:kt.LOGO_GIFT_GLOW,visible:!1}),this.giftIconWhite.setWorldSize(114,146.5),this.giftIconWhite.setDepth(z.PRIORITY),this.add(this.giftIconWhite),this.giftIcon=this.scene.make.image({key:ft,frame:kt.LOGO_GIFT,visible:!1}),this.giftIcon.setInteractive({useHandCursor:!0}),this.giftIcon.setWorldSize(114,146.5),this.giftIcon.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.handleTheGiftClick),this.setTheGiftClickable(!1),this.add(this.giftIcon)}createEffects(){this.cometTwinkle=new Vm(this.scene),this.starTwinkleUp=new cl(this.scene),this.sparksExplosive=new $m(this.scene),this.add([this.cometTwinkle,this.starTwinkleUp,this.sparksExplosive])}}const se={COLLECT_EGGS:{ID:"collect-eggs",EVENTS:{COLLECT_EGGS:"collect-eggs"}},SHOOT_FLYING_EGG:{ID:"shoot-flying-eggs",EVENTS:{SHOOT_FLYING_EGG:"shoot-flying-eggs"}},REACH_TARGET_POINTS:{ID:"reach-target-points",EVENTS:{REACH_TARGET_POINTS:"reach-target-points"}},GET_DINOMITE_COMBO:{ID:"get-dinomite-combo",EVENTS:{GET_DINOMITE_COMBO:"get-dinomite-combo"}},USE_RESCUE:{ID:"use-rescue",EVENTS:{USE_RESCUE:"use-rescue"}},INVITE_FRIENDS:{ID:"invite-friends",EVENTS:{INVITED_FRIEND:"INVITED_FRIEND"}},COMPLETE_GAMES:{ID:"complete-games",EVENTS:{COMPLETE_GAME:"complete-game"}},EVENTS:{TASKS_RESET:"tasks-reset",NOTICE_UPDATE:"notice-update"}},{UseMock:C0,Limit:Jm}=GameCore.Configs.LeadersBoard,{PlayerDataStore:Qm}=GameCore.Configs,hi=(i,e,t=Jm,s=0)=>async n=>{try{const{player:a}=window.game,r=a.getPlayerId();n(ll()),n({type:Mc,payload:{leaderboardId:i,type:e,limit:t,offset:s}});const c=Qm+".lbMock",o=Ii(c);if(o&&o.date&&o.data&&Date.now()-o.date<1e3*60*60*24*7){n(qi(o.data,e));return}//! always not have player in leaderboard, manual at in show screen
const l=-1,h=new Array(t).fill(null).map((d,u)=>{const p=(u+1)*(s+1);let g="Unknown";try{g=window.faker.name.findName()}catch{}return{playerId:u===l?r:`0${p}`,name:u===l?"You":g,photo:"./assets/images/others/avatar.png",rank:p,score:Math.floor(1e6*(Math.random()*17)/p)}});n(qi(h,e)),jt(c,{date:Date.now(),data:h});return}catch(a){n(qi([],e)),K(a)}},qi=(i,e)=>({type:Lc,payload:{leaders:i,type:e}}),ll=()=>({type:Gc,payload:{}}),Yt="global",sa="friend",ia=i=>i[Nc],ef=i=>ia(i).leaderboardId,tf=i=>ia(i).leaders,sf=i=>ia(i).isRequesting;G([ef],i=>i);const hl=G([tf],i=>i),ul=G([sf],i=>i);class es extends Error{constructor(e,t){super(e,t),this.name="InvalidContextId",this.message=e||"This contextId is not valid",this.payload=t}}class nf extends Error{constructor(e,t){super(e,t),this.name="NewScoreIsBad",this.message=e||"The new score is bad",this.payload=t}}let af=class extends Error{constructor(e,t){super(e,t),this.name="InvalidOpponentId",this.message=e||"This opponentId is not valid",this.payload=t}};class dl extends Error{constructor(e,t){super(e,t),this.name="WideFrameRenderFail",this.message=e||"Wide frame render fail",this.payload=t}}const na=(i,e)=>e.playerId,rf=(i,e)=>e.opponentId,of=i=>ne(i).match.isRequesting,cf=i=>ne(i).match.single,lf=i=>ne(i).match.single._id,hf=i=>ne(i).match.single.score,uf=i=>ne(i).match.single.level,df=i=>ne(i).match.single.data?.fen,pf=i=>ne(i).match.single.data?.diamond,gf=i=>ne(i).match.single.status,mf=i=>ne(i).match.single.playerId,ff=i=>ne(i).match.challenge,yf=i=>ne(i).match.challenge._id,Ef=i=>ne(i).match.challenge.status,Sf=i=>ne(i).match.challenge.opponentInfo,Af=i=>ne(i).match.challenge.whitePlayerId,bf=i=>ne(i).match.challenge.blackPlayerId,Tf=i=>ne(i).match.group.opponentInfo,wf=i=>ne(i).match.online.players,Cf=i=>ne(i).match.isAutoStartSingleMode;G([Cf],i=>i);G([of],i=>i);const If=G([cf],i=>i),Si=G([lf],i=>i),Pf=G([hf],i=>i||0);G([uf],i=>i||0);G([pf],i=>i||0);G([df],i=>i||null);G([gf],i=>i);G([mf],i=>i);const ts=G([ff],i=>i),aa=G([yf],i=>i),vf=G([Ef],i=>i),vt=G([Sf],i=>i);G([Af],i=>i);G([bf],i=>i);G([ts,na],(i,e)=>{const{whitePlayerId:t,blackPlayerId:s}=i;return t!==e&&s===e?t:s!==e&&t===e?s:""});const Za=G([ts,na],(i,e)=>{const{whitePlayerId:t,blackPlayerId:s}=i;return t===e?t:s===e?s:xe.playerId}),ra=G([ts,na],(i,e)=>{const{whitePlayerId:t,blackPlayerId:s,whitePlayerFinish:n,blackPlayerFinish:a}=i;return e&&t===e?n:e&&s===e?a:!1}),pl=G([ts,rf],(i,e)=>{const{whitePlayerId:t,blackPlayerId:s,whitePlayerFinish:n,blackPlayerFinish:a}=i;return e&&t===e?n:e&&s===e?a:!1}),gl=G([Tf],i=>i),Of=G([wf],i=>i),_f=i=>ne(i).stats.data,Rf=i=>ne(i).stats.current,xf=i=>ne(i).stats.isRequesting,_t=G([_f],i=>i),et=G([Rf],i=>i);G([xf],i=>i);const Df=i=>i.messages.data,Bf=(i,e)=>e.opponentId,ml=G([Df],i=>i),kf=G([ml,Bf],(i,e)=>!GameCore.Utils.Valid.isString(e)||!GameCore.Utils.Object.hasOwn(i,e)?!1:i[e].sent);var On={},Nf={get exports(){return On},set exports(i){On=i}};(function(i){var e=Object.prototype.hasOwnProperty,t="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function n(o,l,h){this.fn=o,this.context=l,this.once=h||!1}function a(o,l,h,d,u){if(typeof h!="function")throw new TypeError("The listener must be a function");var p=new n(h,d||o,u),g=t?t+l:l;return o._events[g]?o._events[g].fn?o._events[g]=[o._events[g],p]:o._events[g].push(p):(o._events[g]=p,o._eventsCount++),o}function r(o,l){--o._eventsCount===0?o._events=new s:delete o._events[l]}function c(){this._events=new s,this._eventsCount=0}c.prototype.eventNames=function(){var l=[],h,d;if(this._eventsCount===0)return l;for(d in h=this._events)e.call(h,d)&&l.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(h)):l},c.prototype.listeners=function(l){var h=t?t+l:l,d=this._events[h];if(!d)return[];if(d.fn)return[d.fn];for(var u=0,p=d.length,g=new Array(p);u<p;u++)g[u]=d[u].fn;return g},c.prototype.listenerCount=function(l){var h=t?t+l:l,d=this._events[h];return d?d.fn?1:d.length:0},c.prototype.emit=function(l,h,d,u,p,g){var m=t?t+l:l;if(!this._events[m])return!1;var E=this._events[m],f=arguments.length,y,S;if(E.fn){switch(E.once&&this.removeListener(l,E.fn,void 0,!0),f){case 1:return E.fn.call(E.context),!0;case 2:return E.fn.call(E.context,h),!0;case 3:return E.fn.call(E.context,h,d),!0;case 4:return E.fn.call(E.context,h,d,u),!0;case 5:return E.fn.call(E.context,h,d,u,p),!0;case 6:return E.fn.call(E.context,h,d,u,p,g),!0}for(S=1,y=new Array(f-1);S<f;S++)y[S-1]=arguments[S];E.fn.apply(E.context,y)}else{var T=E.length,b;for(S=0;S<T;S++)switch(E[S].once&&this.removeListener(l,E[S].fn,void 0,!0),f){case 1:E[S].fn.call(E[S].context);break;case 2:E[S].fn.call(E[S].context,h);break;case 3:E[S].fn.call(E[S].context,h,d);break;case 4:E[S].fn.call(E[S].context,h,d,u);break;default:if(!y)for(b=1,y=new Array(f-1);b<f;b++)y[b-1]=arguments[b];E[S].fn.apply(E[S].context,y)}}return!0},c.prototype.on=function(l,h,d){return a(this,l,h,d,!1)},c.prototype.once=function(l,h,d){return a(this,l,h,d,!0)},c.prototype.removeListener=function(l,h,d,u){var p=t?t+l:l;if(!this._events[p])return this;if(!h)return r(this,p),this;var g=this._events[p];if(g.fn)g.fn===h&&(!u||g.once)&&(!d||g.context===d)&&r(this,p);else{for(var m=0,E=[],f=g.length;m<f;m++)(g[m].fn!==h||u&&!g[m].once||d&&g[m].context!==d)&&E.push(g[m]);E.length?this._events[p]=E.length===1?E[0]:E:r(this,p)}return this},c.prototype.removeAllListeners=function(l){var h;return l?(h=t?t+l:l,this._events[h]&&r(this,h)):(this._events=new s,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=t,c.EventEmitter=c,i.exports=c})(Nf);const Mf=On,q=new Mf,{ApiHost:Lf,OtherHost:fl,LeadersBoard:Gf}=GameCore.Configs,{Prefix:yl,LeaderboardId:ss,Name:El}=Gf,Ff=`${yl}/${ss}/leaders`,Uf=`${yl}/${ss}/players`,Yf=i=>{let e="";return ss&&(i===Yt?e=Ff:i===sa&&(e=Uf)),e},Hf=async i=>{const e=i.map(r=>r.playerId),t=GameCore.Utils.Object.keyBy(i,"playerId"),s=GameCore.Utils.String.params({playerIds:e});return(await Gs(`players?${s}`,{},Lf)).data.map(r=>{const c=t[r.playerId];return{...r,score:c.score,rank:c.rank,getScore:()=>c.score,getFormattedScore:()=>"",getTimestamp:()=>new Date().valueOf(),getRank:()=>c.rank,getExtraData:()=>c.extraData,getPlayer:()=>({getName:()=>r.name,getPhoto:()=>r.photo,getID:()=>r.playerId})}})},zf=async i=>ss!=""?Wf(i):Vf(),Wf=async i=>{let e=null;if(!i)return e;const t=Yf(sa);if(!t)return e;const s=GameCore.Utils.String.params({playerIds:i}),a=(await Gs(`${t}?${s}`,{},fl))?.data||[];return a.length<1||(e=(await Hf(a))[0]),e},Vf=async()=>await(await window.GameSDK.getLeaderboardAsync(El)).getPlayerEntryAsync(),Kf=async(i,e)=>ss!=""?$f(i,e):jf(e),$f=async(i,e)=>(await Fs(`leaderboards/${ss}/players/${i}`,{score:e},{},fl))?.data||{},jf=async i=>await(await window.GameSDK.getLeaderboardAsync(El)).setScoreAsync(i),Xf=i=>{if(typeof i!="string"||!i)throw new dl(null,{imageShare:i})},qf=()=>async()=>{const{player:i,analytics:e,facebook:t,globalScene:s}=window.game;try{s.screen.open(L.NOTIFY_SCREEN,{message:window.game.lang.Text.LOADING,loading:!0});const n=await Zf();Xf(n);const{playerId:a,name:r,photo:c}=i.getPlayer();await t.shareAsync({text:"Great! I have a best score!",intent:"SHARE",image:n||"",data:{playerId:a,playerName:r,playerPhoto:c,type:Jn}}),e.event(V.SHARE,{share_content_type:"BestScore",success:!0})}catch(n){e.event(V.SHARE,{share_content_type:"BestScore",success:!1}),K(n)}finally{s.screen.close(L.NOTIFY_SCREEN)}},Zf=async()=>{const{player:i,globalScene:e}=window.game,{playerId:t,photo:s,data:n}=i.getPlayer(),{score:a}=n||{},r=Sl({playerId:t,playerPhoto:s,playerScore:a});if(!r){console.warn("getRenderOptionsBestScore");return}const c={name:"share-best-score",width:952,height:492,renderOptions:r};return await e.frameCapture.capture(c)},Ja=async i=>{const{player:e,globalScene:t}=window.game,s=_t(i),{playerId:n,photo:a}=e.getPlayer(),{score:r}=s[n]||{},c=Sl({playerId:n,playerPhoto:a,playerScore:r});if(!c){console.warn("getRenderOptionsCurrentScore");return}const o={name:"share-current-score",width:952,height:492,renderOptions:c};return await t.frameCapture.capture(o)},Sl=i=>{const{playerId:e="10",playerPhoto:t="",playerScore:s=0}=i;return typeof e!="string"||typeof t!="string"||typeof s!="number"?null:{avatar:{name:`${e}`,type:"image",x:666,y:115,image:t,width:185,height:185,fallbackWithImage:$.AVATAR.KEY},wideFrame:{name:"wide-frame-message-win",type:"image",x:0,y:0,image:"./assets/wideframes/wide-frame-message-win.png",width:952,height:492},playerScoreShadow:{type:"text",x:760,y:454,font:"600 70px",fillStyle:"#c4683f",text:`${s}`,textAlign:"center"},playerScore:{type:"text",x:760,y:450,font:"600 70px",fillStyle:"#f2a62e",text:`${s}`,textAlign:"center"}}},vi=async i=>{const{player:e,globalScene:t}=window.game,s=_t(i),{photo:n,playerId:a}=e.getPlayer(),{playerId:r,photo:c}=vt(i),o=ra(i,{playerId:a}),l=pl(i,{opponentId:r}),{score:h}=s[a]||{},{score:d}=s[r]||{},u=ey({playerId:a,playerPhoto:n,playerScore:h,opponentId:r,opponentPhoto:c,opponentScore:d,isPlayerFinished:o,isOpponentFinished:l});if(!u){console.warn("getRenderOptionsLeaderboard");return}const p={name:"share-game-result",width:952,height:492,renderOptions:u};return await t.frameCapture.capture(p)},Jf=async i=>{const{player:e,globalScene:t}=window.game,s=_t(i),{photo:n,playerId:a}=e.getPlayer(),{playerId:r,photo:c,score:o}=gl(i),{score:l}=s[a]||{},h=Qf({playerId:a,playerPhoto:n,playerScore:l,opponentId:r,opponentPhoto:c,opponentScore:o});if(!h){console.warn("getRenderOptionsGroupResult");return}const d={name:"share-group-match-result",width:952,height:492,renderOptions:h};return await t.frameCapture.capture(d)},Qf=i=>{const{playerId:e="10",playerPhoto:t="",playerScore:s=0,opponentId:n="20",opponentPhoto:a="",opponentScore:r=0}=i;if(typeof e!="string"||typeof t!="string"||typeof s!="number"||typeof n!="string"||typeof a!="string"||typeof r!="number")return null;const c={leftPhoto:{name:`${e}`,type:"image",x:74,y:149,image:t,width:151,height:151,fallbackWithImage:$.AVATAR.KEY},rightPhoto:{name:`${n}`,type:"image",x:728,y:152,image:a,width:151,height:151,fallbackWithImage:$.AVATAR.KEY},wideFrame:{name:"wide-frame-game-result",type:"image",x:0,y:0,image:"./assets/wideframes/wide-frame-game-result.png",width:952,height:492}};return c.crown={name:"crown-icon",type:"image",x:18,y:72,image:"./assets/images/others/crown-icon.png",width:114,height:115},c.leftPhoto={name:`${e}`,type:"image",x:74,y:149,image:t,width:151,height:151,fallbackWithImage:$.AVATAR.KEY},c.rightPhoto={name:`${n}`,type:"image",x:728,y:153,image:a,width:151,height:151,fallbackWithImage:$.AVATAR.KEY},c.leftScoreShadow={type:"text",x:153,y:444,font:`600 ${70}px`,fillStyle:"#c4683f",text:`${s}`,textAlign:"center"},c.leftScore={type:"text",x:153,y:440,font:`600 ${70}px`,fillStyle:"#f2a62e",text:`${s}`,textAlign:"center"},c.rightScoreShadow={type:"text",x:803,y:444,font:`600 ${70}px`,fillStyle:"#c4683f",text:`${r}`,textAlign:"center"},c.rightScore={type:"text",x:803,y:440,font:`600 ${70}px`,fillStyle:"#f2a62e",text:`${r}`,textAlign:"center"},c},ey=i=>{const{playerId:e="10",playerPhoto:t="",playerScore:s=0,opponentId:n="20",opponentPhoto:a="",opponentScore:r=0,isPlayerFinished:c,isOpponentFinished:o}=i;if(typeof e!="string"||typeof t!="string"||typeof s!="number"||typeof n!="string"||typeof a!="string"||typeof r!="number"||typeof c!="boolean"||typeof o!="boolean")return null;const l=s===r,h=s>r?e:n,d=s>r?t:a,u=s>r?n:e,p=s>r?a:t,g=c||o,m=c&&o,E={leftPhoto:{name:`${e}`,type:"image",x:74,y:149,image:t,width:151,height:151,fallbackWithImage:$.AVATAR.KEY},rightPhoto:{name:`${n}`,type:"image",x:728,y:152,image:a,width:151,height:151,fallbackWithImage:$.AVATAR.KEY},wideFrame:{name:"wide-frame-game-result",type:"image",x:0,y:0,image:"./assets/wideframes/wide-frame-game-result.png",width:952,height:492}};return g&&(E.leftScoreShadow={type:"text",x:153,y:444,font:`600 ${70}px`,fillStyle:"#c4683f",text:c?`${s}`:"???",textAlign:"center"},E.leftScore={type:"text",x:153,y:440,font:`600 ${70}px`,fillStyle:"#f2a62e",text:c?`${s}`:"???",textAlign:"center"},E.rightScoreShadow={type:"text",x:803,y:444,font:`600 ${70}px`,fillStyle:"#c4683f",text:o?`${r}`:"???",textAlign:"center"},E.rightScore={type:"text",x:803,y:440,font:`600 ${70}px`,fillStyle:"#f2a62e",text:o?`${r}`:"???",textAlign:"center"}),m&&(l||(E.crown={name:"crown-icon",type:"image",x:18,y:72,image:"./assets/images/others/crown-icon.png",width:114,height:115}),E.leftPhoto={name:`${h}`,type:"image",x:74,y:149,image:d,width:151,height:151,fallbackWithImage:$.AVATAR.KEY},E.rightPhoto={name:`${u}`,type:"image",x:728,y:155,image:p,width:151,height:151,fallbackWithImage:$.AVATAR.KEY},E.leftScoreShadow={type:"text",x:155,y:444,font:`600 ${70}px`,fillStyle:"#c4683f",text:`${s>r?s:r}`,textAlign:"center"},E.leftScore={type:"text",x:153,y:440,font:`600 ${70}px`,fillStyle:"#f2a62e",text:`${s>r?s:r}`,textAlign:"center"},E.rightScoreShadow={type:"text",x:803,y:444,font:`600 ${70}px`,fillStyle:"#c4683f",text:`${s>r?r:s}`,textAlign:"center"},E.rightScore={type:"text",x:803,y:440,font:`600 ${70}px`,fillStyle:"#f2a62e",text:`${s>r?r:s}`,textAlign:"center"}),E},Ws=i=>{const{contextId:e}=i;if(e===""||typeof e!="string")throw new es(null,{contextId:e})},ty=i=>{const{opponentId:e,contextId:t}=i;if(e===""||typeof e!="string")throw new af(null,{opponentId:e});if(t===""||typeof t!="string")throw new es(null,{contextId:t})},Vs=i=>{const{imageShare:e}=i;if(e===null)throw new dl},Oi=(i,e=!0)=>(t,s)=>{const n=s(),a=ml(n);if(e){if(a[i]?.sent)return;t(sy(i))}a[i]?.sent&&t(iy(i))},sy=i=>({type:sc,payload:{opponentId:i}}),iy=i=>({type:ic,payload:{opponentId:i}}),_i=async(i,e)=>{try{const{facebook:t}=window.game;ty({opponentId:i,contextId:e});const s=FBInstant.context.getID();if(s===e&&e!=="")return s;if(i==="10"&&e!=="")return e;if(e)return await t.switchAsync(e),FBInstant.context.getID()}catch(t){K(t)}return""},ny=(i,e)=>async(t,s)=>{const{player:n,analytics:a,facebook:r}=window.game;try{const{matchId:c,contextId:o}=e,l=await _i(i,o);Ws({contextId:l});const h=s(),d=await vi(h);Vs({imageShare:d});const{name:u,playerId:p}=n.getPlayer();await r.sendMessage({cta:{default:"Play",localizations:{en_US:"Play",vi_VN:"ChÆ¡i ngay"}},text:{default:`${u} challenges you`,localizations:{en_US:`${u} challenges you`,vi_VN:`${u} thá»­ thÃ¡ch báº¡n trong tráº­n Ä‘áº¥u nÃ y. ChÆ¡i ngay!`}},image:d||"",template:"challenge",data:{type:qt,matchId:c,playerId:p,opponentId:i,status:zt}}),t(Oi(i)),a.event(V.MESSAGE,{message_content_type:"Invite",success:!0}),q.emit(se.INVITE_FRIENDS.EVENTS.INVITED_FRIEND,{type:"friend",value:1,opponentId:i})}catch(c){a.event(V.MESSAGE,{message_content_type:"Invite",success:!1}),K(c)}},ay=(i,e)=>async(t,s)=>{const{player:n,analytics:a,facebook:r}=window.game;try{const{matchId:c,contextId:o}=e,l=await _i(i,o);Ws({contextId:l});const h=s(),d=await vi(h);Vs({imageShare:d});const{name:u,playerId:p}=n.getPlayer();await r.sendMessage({cta:{default:"See result",localizations:{en_US:"See result",vi_VN:"Xem káº¿t quáº£"}},text:{default:`${u} just finished. Check them now.`,localizations:{en_US:`${u} just finished. Check them now.`,vi_VN:`${u} vá»«a hoÃ n thÃ nh mÃ n chÆ¡i. Nháº¥n Ä‘á»ƒ xem káº¿t quáº£ tráº­n Ä‘áº¥u.`}},image:d||"",template:"finished",data:{type:qt,matchId:c,playerId:p,opponentId:i,status:Bs}}),t(Oi(i)),a.event(V.MESSAGE,{message_content_type:"FinishMatch",success:!0})}catch(c){a.event(V.MESSAGE,{message_content_type:"FinishMatch",success:!1}),K(c)}},ry=(i,e)=>async(t,s)=>{const{player:n,analytics:a,facebook:r}=window.game;try{const{matchId:c,contextId:o}=e,l=await _i(i,o);Ws({contextId:l});const h=s(),d=await vi(h);Vs({imageShare:d});const{name:u,playerId:p}=n.getPlayer(),g=_t(h),{score:m=0}=g[p]||{};await r.sendMessage({cta:{default:"See result",localizations:{en_US:"See result",vi_VN:"Xem káº¿t quáº£"}},text:{default:`${u} beat your high score. Their score: ${m}`,localizations:{en_US:`${u} beat your high score. Their score: ${m}`,vi_VN:`${u} Ä‘Ã£ vÆ°á»£t qua Ä‘iá»ƒm sá»‘ cá»§a báº¡n, vá»›i ${m} Ä‘iá»ƒm!`}},image:d||"",template:"pass_score",data:{type:qt,matchId:c,playerId:p,opponentId:i,status:Bs}}),t(Oi(i)),a.event(V.MESSAGE,{message_content_type:"BestScore",success:!0})}catch(c){a.event(V.MESSAGE,{message_content_type:"BestScore",success:!1}),K(c)}},oy=(i,e)=>async(t,s)=>{const{player:n,analytics:a,facebook:r}=window.game;try{const{matchId:c,contextId:o,score:l}=e,h=await _i(i,o);Ws({contextId:h});const d=s(),u=await vi(d);Vs({imageShare:u});const{name:p,playerId:g}=n.getPlayer();await r.sendMessage({cta:{default:"Play",localizations:{en_US:"Play",vi_VN:"ChÆ¡i ngay"}},text:{default:`${p} got ${l} scores. So easy! Can you?`,localizations:{en_US:`${p} got ${l} scores. So easy! Can you?`,vi_VN:`${p} Ä‘Ã£ Ä‘áº¡t ${l} Ä‘iá»ƒm! Nháº¥n ChÆ¡i Ä‘á»ƒ so tÃ i!`}},image:u||"",template:"play_turn",data:{type:qt,matchId:c,playerId:g,opponentId:i,status:zt}}),t(Oi(i)),a.event(V.MESSAGE,{message_content_type:"FinishTurn",success:!0})}catch(c){if(a.event(V.MESSAGE,{message_content_type:"FinishTurn",success:!1}),c instanceof es)return;K(c)}},cy=()=>async(i,e)=>{const{analytics:t}=window.game;try{const s=FBInstant.context.getID();Ws({contextId:s});const n=e(),a=gl(n),{playerId:r,score:c}=a,{score:o}=et(n);let l;r&&r!==xe.playerId?o>c?(l=await Jf(n),await ly(l,n)):(l=await Ja(n),await Qa(l,n)):(l=await Ja(n),await Qa(l,n)),Vs({imageShare:l}),t.event(V.MESSAGE,{message_content_type:"InviteGroup",success:!0})}catch(s){t.event(V.MESSAGE,{message_content_type:"InviteGroup",success:!0}),K(s)}},ly=async(i,e)=>{try{const{player:t,facebook:s}=window.game,{playerId:n,name:a,photo:r}=t.getPlayer(),{score:c}=et(e),o={type:Qn,playerId:n,playerName:a,playerPhoto:r,playerScore:c};await s.sendMessage({cta:{default:"Play",localizations:{en_US:"Play",vi_VN:"ChÆ¡i"}},text:{default:`${a} beats your high score. Their score: ${c}.`,localizations:{en_US:`${a} beats your high score. Their score: ${c}.`,vi_VN:`${a} vá»«a vÆ°á»£t Ä‘iá»ƒm sá»‘ cao nháº¥t cá»§a báº¡n! ChÆ¡i láº§n ná»¯a chá»©?`}},image:i||"",template:"play_turn",data:o})}catch(t){K(t)}},Qa=async(i,e)=>{const{player:t,facebook:s}=window.game;try{const{playerId:n,name:a,photo:r}=t.getPlayer(),{score:c}=et(e),o={type:Qn,playerId:n,playerName:a,playerPhoto:r,playerScore:c};await s.sendMessage({cta:{default:"Play",localizations:{en_US:"Play",vi_VN:"ChÆ¡i ngay"}},text:{default:`${a} got ${c} scores. So easy! Can you?`,localizations:{en_US:`${a} got ${c} scores. So easy! Can you?`,vi_VN:`${a} Ä‘Ã£ Ä‘áº¡t ${c} Ä‘iá»ƒm! QuÃ¡ dá»… luÃ´n. ChÆ¡i láº¡i nÃ o!`}},image:i||"",template:"play_turn",data:o})}catch(n){K(n)}};class ve extends Error{constructor(e,t){super(e,t),this.name="InvalidMatchId",this.message=e||"Invalid match id",this.payload=t}}const _n=[{playerId:"38",gender:"female",name:"Loretta Cooper",difficult:1.5},{playerId:"10",gender:"female",name:"Alice Wilson",difficult:1.1},{playerId:"42",gender:"female",name:"Myrtie Mathis",difficult:1.2},{playerId:"15",gender:"female",name:"Rosa Estrada",difficult:1.3},{playerId:"9",gender:"male",name:"Dylan Riley",difficult:.8},{playerId:"29",gender:"male",name:"Joe Robinson",difficult:1.4},{playerId:"5",gender:"male",name:"Roger McBride",difficult:.7},{playerId:"22",gender:"male",name:"Lester Reeves",difficult:.3},{playerId:"21",gender:"female",name:"Eva Guzman",difficult:1.2},{playerId:"6",gender:"female",name:"Lelia Erickson",difficult:1.3},{playerId:"47",gender:"male",name:"Dean Holloway",difficult:.8},{playerId:"4",gender:"female",name:"Amelia Freeman",difficult:1.1},{playerId:"11",gender:"female",name:"Viola Ferguson",difficult:1},{playerId:"72",gender:"male",name:"Todd Garner",difficult:.7},{playerId:"28",gender:"female",name:"Matilda Harris",difficult:.6},{playerId:"14",gender:"male",name:"Alex Hart",difficult:.3},{playerId:"64",gender:"male",name:"Ethan Gilbert",difficult:1.3},{playerId:"67",gender:"male",name:"Gordon Craig",difficult:1.2},{playerId:"25",gender:"female",name:"Nora Munoz",difficult:1.1},{playerId:"36",gender:"female",name:"Dora Herrera",difficult:.6},{playerId:"43",gender:"female",name:"Lida Roberts",difficult:.6},{playerId:"71",gender:"male",name:"Kenneth Holland",difficult:.3},{playerId:"38",gender:"male",name:"Russell McGee",difficult:.7},{playerId:"27",gender:"female",name:"Etta Miller",difficult:.6},{playerId:"45",gender:"female",name:"Abbie Weber",difficult:1.5},{playerId:"47",gender:"female",name:"Etta Ryan",difficult:.9},{playerId:"69",gender:"male",name:"Christian Tran",difficult:.5},{playerId:"20",gender:"female",name:"Victoria Rivera",difficult:.6},{playerId:"48",gender:"female",name:"Blanche Bowen",difficult:.9},{playerId:"50",gender:"female",name:"Stella Montgomery",difficult:.5},{playerId:"46",gender:"male",name:"James Buchanan",difficult:1.3},{playerId:"26",gender:"female",name:"Lola Massey",difficult:1.4},{playerId:"28",gender:"male",name:"Fred Sutton",difficult:.7},{playerId:"60",gender:"female",name:"Victoria Munoz",difficult:.7},{playerId:"13",gender:"female",name:"Lois Powell",difficult:1.6},{playerId:"10",gender:"male",name:"Oscar Houston",difficult:1.6},{playerId:"61",gender:"male",name:"Alfred Ramos",difficult:1.3},{playerId:"55",gender:"female",name:"Jean Johnson",difficult:1.1},{playerId:"4",gender:"male",name:"Alejandro Hernandez",difficult:.6},{playerId:"44",gender:"male",name:"Tony Powers",difficult:1.5},{playerId:"21",gender:"male",name:"Jesus Norton",difficult:.7},{playerId:"70",gender:"male",name:"Clyde Wagner",difficult:1.2},{playerId:"8",gender:"male",name:"Connor Santiago",difficult:1},{playerId:"17",gender:"male",name:"Douglas Miller",difficult:1.5},{playerId:"46",gender:"female",name:"Bernice Pearson",difficult:1.3},{playerId:"23",gender:"male",name:"Christopher Ortiz",difficult:1.3},{playerId:"50",gender:"male",name:"Travis Buchanan",difficult:.5},{playerId:"20",gender:"male",name:"Fred Cannon",difficult:.3},{playerId:"16",gender:"male",name:"Charles Perry",difficult:.9},{playerId:"23",gender:"female",name:"Etta Herrera",difficult:1.5},{playerId:"40",gender:"male",name:"Sean Salazar",difficult:1.3},{playerId:"57",gender:"female",name:"Lura Hammond",difficult:1.3},{playerId:"39",gender:"female",name:"Adelaide Douglas",difficult:.4},{playerId:"5",gender:"female",name:"Alma Stephens",difficult:1.2},{playerId:"37",gender:"male",name:"Luke Thornton",difficult:.7},{playerId:"6",gender:"male",name:"Isaac Hansen",difficult:1.2},{playerId:"24",gender:"male",name:"Antonio Massey",difficult:.5},{playerId:"29",gender:"female",name:"Caroline McKinney",difficult:1.3},{playerId:"34",gender:"male",name:"Bobby Stevenson",difficult:.9},{playerId:"16",gender:"female",name:"Mildred King",difficult:.5},{playerId:"7",gender:"male",name:"Bradley Malone",difficult:.5},{playerId:"2",gender:"male",name:"Calvin Patton",difficult:1.5},{playerId:"45",gender:"male",name:"Edgar Vargas",difficult:1.5},{playerId:"42",gender:"male",name:"Alfred Wheeler",difficult:1.7},{playerId:"48",gender:"male",name:"Anthony Watson",difficult:.4},{playerId:"27",gender:"male",name:"Harry Reese",difficult:1.6},{playerId:"33",gender:"female",name:"Rosetta Reyes",difficult:1},{playerId:"63",gender:"male",name:"Russell Murphy",difficult:.7},{playerId:"59",gender:"female",name:"Louisa Hall",difficult:.8},{playerId:"56",gender:"female",name:"Christina Hawkins",difficult:1.4},{playerId:"52",gender:"male",name:"Jeremy Wilkins",difficult:1.3},{playerId:"41",gender:"male",name:"Tyler Owens",difficult:.6},{playerId:"39",gender:"male",name:"Christopher Baldwin",difficult:.6},{playerId:"18",gender:"male",name:"Clayton Sanchez",difficult:.5},{playerId:"13",gender:"male",name:"Thomas Strickland",difficult:1.2},{playerId:"68",gender:"male",name:"Herbert Hayes",difficult:.5},{playerId:"24",gender:"female",name:"Christine Beck",difficult:1.5},{playerId:"31",gender:"male",name:"Alan McCarthy",difficult:.6},{playerId:"19",gender:"female",name:"Georgie Logan",difficult:.6},{playerId:"62",gender:"male",name:"Herbert Bass",difficult:.9},{playerId:"56",gender:"male",name:"Danny Drake",difficult:1.4},{playerId:"12",gender:"male",name:"Mike Burton",difficult:1.5},{playerId:"60",gender:"male",name:"Lester Thomas",difficult:.4},{playerId:"44",gender:"female",name:"Lina Matthews",difficult:1.1},{playerId:"31",gender:"female",name:"Myrtie Holloway",difficult:1.8},{playerId:"49",gender:"female",name:"Nell Burns",difficult:1},{playerId:"33",gender:"male",name:"Trevor Gonzalez",difficult:.6},{playerId:"58",gender:"male",name:"Harvey Munoz",difficult:1.7},{playerId:"37",gender:"female",name:"Eula Griffin",difficult:1.2},{playerId:"8",gender:"female",name:"Hattie Becker",difficult:1.5},{playerId:"54",gender:"female",name:"Alma Howard",difficult:1.2},{playerId:"19",gender:"male",name:"Mitchell Bishop",difficult:1.1},{playerId:"58",gender:"female",name:"Maude Burgess",difficult:1.4},{playerId:"34",gender:"female",name:"Eula Copeland",difficult:1.3},{playerId:"32",gender:"male",name:"Carl Wolfe",difficult:1},{playerId:"35",gender:"male",name:"Kenneth McKinney",difficult:.9},{playerId:"41",gender:"female",name:"Caroline Morris",difficult:1},{playerId:"1",gender:"male",name:"Bill Silva",difficult:1.3},{playerId:"57",gender:"male",name:"Lawrence Hanson",difficult:.4},{playerId:"17",gender:"female",name:"Sallie Stevens",difficult:.9},{playerId:"74",gender:"male",name:"Christopher Bishop",difficult:.4},{playerId:"35",gender:"female",name:"Julia Gibbs",difficult:.5},{playerId:"2",gender:"female",name:"Frances Boyd",difficult:.4},{playerId:"65",gender:"male",name:"Eric Howell",difficult:.7},{playerId:"54",gender:"male",name:"Jeremiah Ruiz",difficult:1.6},{playerId:"1",gender:"female",name:"Essie Tate",difficult:.3},{playerId:"53",gender:"female",name:"Jeanette Williamson",difficult:.5},{playerId:"55",gender:"male",name:"Thomas Holmes",difficult:.6},{playerId:"49",gender:"male",name:"Erik Barber",difficult:.8},{playerId:"14",gender:"female",name:"Myrtie Valdez",difficult:1.5},{playerId:"3",gender:"female",name:"Madge Bates",difficult:1.7},{playerId:"7",gender:"female",name:"Marion Conner",difficult:1.8},{playerId:"25",gender:"male",name:"Chester Johnson",difficult:1.2},{playerId:"59",gender:"male",name:"Jerry Ray",difficult:.3},{playerId:"32",gender:"female",name:"Ophelia Hardy",difficult:.9},{playerId:"52",gender:"female",name:"Jessie Morris",difficult:1.4},{playerId:"51",gender:"male",name:"Nathan Hopkins",difficult:1.7},{playerId:"51",gender:"female",name:"Nell Higgins",difficult:.9},{playerId:"66",gender:"male",name:"Lester Strickland",difficult:1.2},{playerId:"73",gender:"male",name:"Blake Park",difficult:.7},{playerId:"75",gender:"male",name:"Wesley Colon",difficult:1.5},{playerId:"22",gender:"female",name:"Augusta Barker",difficult:1.4},{playerId:"36",gender:"male",name:"Ivan Lamb",difficult:1.3},{playerId:"40",gender:"female",name:"Sylvia Neal",difficult:.9},{playerId:"11",gender:"male",name:"Ethan Herrera",difficult:.6},{playerId:"15",gender:"male",name:"Jeffrey Jackson",difficult:.3},{playerId:"26",gender:"male",name:"Cory Tucker",difficult:1.2},{playerId:"12",gender:"female",name:"Sophia Rios",difficult:.3},{playerId:"18",gender:"female",name:"Verna Cooper",difficult:.9},{playerId:"9",gender:"female",name:"Lily Copeland",difficult:1.7},{playerId:"30",gender:"female",name:"Lillian Murray",difficult:.3},{playerId:"43",gender:"male",name:"Gordon Manning",difficult:.9},{playerId:"53",gender:"male",name:"Julian Simmons",difficult:1.1},{playerId:"30",gender:"male",name:"Johnny Fernandez",difficult:.3},{playerId:"3",gender:"male",name:"Daniel Reed",difficult:.9}],{ApiHost:Ri}=GameCore.Configs,hy=async i=>(await Fs("matches",{opponentPlayerId:i},{},Ri))?.data||{},uy=async i=>{const e=`matches/${i}/join`;return(await Fs(e,{},{},Ri))?.data||{}},dy=async i=>{const e=`matches/${i}`;return(await Gs(e,{},Ri))?.data||{}},py=async(i,e,t,s)=>{const n=`matches/${i}/finish`;return(await Fs(n,{matchId:i,score:e,level:t,extraData:s},{},Ri))?.data||{}};class xi extends Error{constructor(e,t){super(e,t),this.name="InvalidMatchStatus",this.message=e||"The match status is not valid",this.payload=t}}class Al extends Error{constructor(e,t){super(e,t),this.name="InvalidOpponentId",this.message=e||"Invalid opponent id",this.payload=t}}class gy extends Error{constructor(e,t){super(e,t),this.name="InvalidBlackPlayerId",this.message=e||"Invalid black player id",this.payload=t}}class my extends Error{constructor(e,t){super(e,t),this.name="InvalidRequestedMatchId",this.message=e||"The matchId in match data not matched with requested matchId",this.payload=t}}class fy extends Error{constructor(e,t){super(e,t),this.name="InvalidWhitePlayerId",this.message=e||"Invalid white player id",this.payload=t}}const yy=i=>{const{matchId:e,currentMatchId:t}=i;if(e===""||typeof e!="string")throw new ve(null,{matchId:e});if(t===""||typeof t!="string")throw new ve(null,{currentMatchId:t});if(e!==t)throw new my(null,{matchId:e,currentMatchId:t})},oa=i=>{const{playerId:e,match:t}=i,{_id:s,playerId:n,status:a}=t;if(s===""||typeof s!="string")throw new ve(null,{matchId:s});if(a==="finished"||typeof a!="string")throw new xi("This match is finished",{status:a});if(n!==e)throw new Zn(null,{playerId:n,currentPlayerId:e})},Ey=i=>{const{opponentId:e}=i;if(e===""||typeof e!="string")throw new Al(null,{opponentId:e})},Di=i=>{const{matchId:e}=i;if(e===""||typeof e!="string")throw new ve(null,{matchId:e})},Bi=i=>{const{match:e}=i,{_id:t,whitePlayerId:s,blackPlayerId:n}=e;if(t===""||typeof t!="string")throw new ve(null,{matchId:t});if(s===""||typeof s!="string")throw new fy(null,{whitePlayerId:s});if(n===""||typeof n!="string")throw new gy(null,{blackPlayerId:n})},{Match:ks}=GameCore.Configs,Sy=i=>{try{return GameCore.Utils.Hash.stringToHash(JSON.stringify(i))}catch{return""}},Ay=i=>{try{return JSON.parse(GameCore.Utils.Hash.hashToString(i))}catch{return""}},bl=()=>async i=>{try{const{player:e}=window.game;i({type:Ac,payload:{}});const t=e.getPlayerId(),s={...ks.LocalSingleMatchDefault,status:"active",playerId:t,startedAt:Date.now()};oa({playerId:t,match:s}),i(Vt(s)),jt(ks.SingleMatchStore,s)}catch(e){if(i(Vt(null)),e instanceof ve||e instanceof xi)return;K(e)}},by=()=>i=>{try{const{player:e}=window.game;i({type:bc,payload:{}});const t=e.getPlayerId(),s=Ii(ks.SingleMatchStore)||{},{data:n}=s;s.data=Ay(n),oa({playerId:t,match:s}),i(Vt(s))}catch(e){if(i(Vt(null)),e instanceof ve||e instanceof Zn||e instanceof xi)return;K(e)}},Ty=i=>async(e,t)=>{try{const{player:s}=window.game;Di({matchId:i});const n=t(),a=Si(n),r=s.getPlayerId();yy({matchId:i,currentMatchId:a}),e({type:og,payload:{matchId:i}});const c=If(n);oa({playerId:r,match:c});const o={...ks.LocalSingleMatchDefault,...c,_id:i,status:"finished",playerId:r,finishAt:Date.now()};e(Vt(o));const{data:l}=o,h={...o};h.data=Sy(l),jt(ks.SingleMatchStore,h)}catch(s){if(e(Vt(null)),s instanceof ve||s instanceof xi)return;K(s)}},Vt=i=>({type:Tc,payload:{match:i}}),ki=()=>({type:wc,payload:{}}),wy=i=>async e=>{try{const{profile:t,globalScene:s}=window.game;s.screen.open(L.NOTIFY_SCREEN,{message:window.game.lang.Text.LOADING,loading:!0});const{playerId:n}=i;Ey({opponentId:n}),e({type:Ic,payload:{opponentInfo:i}});const a=await hy(n);Bi({match:a}),await t.requestProfiles([n]),e(ut(a))}catch(t){if(e(ut(null)),t instanceof ve||t instanceof Al)return;K(t)}},Cy=i=>async e=>{try{const{player:t,profile:s,globalScene:n}=window.game;n.screen.open(L.NOTIFY_SCREEN,{message:window.game.lang.Text.LOADING,loading:!0}),Di({matchId:i}),e({type:Cc,payload:{matchId:i}});const a=await uy(i);Bi({match:a});const{status:r,whitePlayerId:c,blackPlayerId:o}=a;if(r===zt){const d=t.getPlayerId()===c?o:c;await s.requestProfiles([d])}e(ut(a))}catch(t){if(e(ut(null)),t instanceof ve)return;K(t)}},Iy=(i,e,t=!0)=>async s=>{try{const{player:n,globalScene:a}=window.game;t&&a.screen.open(L.NOTIFY_SCREEN,{message:window.game.lang.Text.LOADING,loading:!0}),Di({matchId:i}),s({type:vc,payload:{matchId:i,opponentInfo:e}});const r=await dy(i);Bi({match:r});const{whitePlayerId:c,whitePlayerScore:o,blackPlayerScore:l}=r,h=n.getPlayerId(),{score:d}=n.getPlayerData();s(ut(r,{score:h===c?o:l,bestScore:d}))}catch(n){if(s(ut(null)),n instanceof ve)return;K(n)}},Py=(i,e,t)=>async s=>{try{const{globalScene:n}=window.game;n.screen.open(L.NOTIFY_SCREEN,{message:window.game.lang.Text.LOADING,loading:!0}),Di({matchId:i}),s({type:Pc,payload:{matchId:i,score:e,extraData:t}});const{level:a}=t,r=await py(i,e,a,t);Bi({match:r}),await s(ut(r))}catch(n){if(s(ut(null)),n instanceof ve)return;K(n)}},ut=(i,e,t=null)=>({type:jn,payload:{match:i,opponentInfo:e,current:t}}),vy=()=>({type:Oc,payload:{}}),Oy=i=>({type:_c,payload:{opponentInfo:i}}),_y=()=>({type:Rc,payload:{}}),Ry=()=>async i=>{const{player:e}=window.game,{playerId:t,name:s,photo:n}=e.getPlayer();i({type:xc,payload:{playerId:t}});const a={};GameCore.Utils.Array.shuffle(_n),new Array(20).fill(null).map((r,c)=>{const{playerId:o,name:l,gender:h}=_n[c],d=+o;a[o]={playerId:o,name:l,photo:`./assets/images/people/${h}/${h}-${d<10?`0${d}`:d}.jpg`}}),a[t]={playerId:t,name:s,photo:n},i(xy("mock",a))},xy=(i,e)=>({type:Xn,payload:{matchId:i,players:e}}),Dy=()=>({type:Bc,payload:{}}),Tl=i=>({type:yc,payload:{playerId:i}}),Ni=(i,e)=>({type:Ec,payload:{playerId:i,stats:e}}),Ks=i=>({type:Sc,payload:{stats:i}}),By=i=>({type:Dc,payload:{leaders:i}});class ky extends Phaser.GameObjects.BitmapText{constructor(e,t,s){super(e,t,s,B.PRIMARY.KEY),this.setText("").setOrigin(.5).setFontSize(this.scene.fontSize(20)).setDepth(z.EFFECT)}setDefault(){this.setActive(!0).setVisible(!0).setScale(0).setAlpha(1).setNormalFloating()}playAnimation(){const t=this.scene.tweens.timeline();return t.add({targets:this,scale:1,duration:83,delay:0}),t.add({targets:this,alpha:0,scale:.8,y:"-=10",duration:400,onComplete:()=>{this.setInactiveAndHide()}}),t.play(),this}setBigFloating(){return this.setFontSize(this.scene.fontSize(24)),this}setNormalFloating(){return this.setFontSize(this.scene.fontSize(20)),this}setInactiveAndHide(){this.kill(),this.setPosition()}}class Ny extends Phaser.GameObjects.Group{constructor(e){super(e,{classType:ky,frame:[],maxSize:-1}),this.init()}init(){Array(50).fill(null).map(()=>this.get(0,0)).forEach(t=>{t.setVisible(!1),t.setActive(!1)})}spawn(e,t,s,n){const a=this.get(e,t);return a.setDefault(),a.setText(`${n}`),a}despawn(e){this.killAndHide(e)}reset(){this.getChildren().forEach(e=>{e.active&&e.kill()})}getChildren(){return super.getChildren()}}var wl=(i=>(i.INITIALIZED="initialized",i.SHOOT_BALL="shoot-ball",i.GAME_OVER="game-over",i.TIMER_CREATED="timer-created",i.SCORE_CHANGED="scoreChanged",i))(wl||{});const ee=wl,{KEY:My,FRAME:Ly}=_.GAMEPLAY.GAMEPLAY_TEXTURES;class Gy extends Phaser.GameObjects.Sprite{constructor(e){super(e,0,0,My,Ly.OWL),this.setOrigin(.5,1),this.setWorldSize(46.5,76.5),this.scene.add.existing(this)}blink(){const e=this.scene.time.addEvent({delay:5e3,callback:()=>{this.play("owl-blinking")},repeat:-1});this.scene.events.emit(ee.TIMER_CREATED,e);const t=1/this.scene.world.getPixelRatio();return this.scene.tweens.add({targets:this,scaleY:{from:t,to:t*.98},scaleX:{from:t,to:t*1.05},yoyo:!0,repeat:-1,duration:800,ease:Phaser.Math.Easing.Sine.In}),this}}const{KEY:Fy,FRAME:er}=_.GAMEPLAY.GAMEPLAY_TEXTURES;class Uy extends Phaser.GameObjects.Sprite{constructor(e){super(e,0,0,Fy,er.DINO+"1"),this.setOrigin(.5,1),this.setWorldSize(104,122.5),this.scene.add.existing(this)}blink(){const e=this.scene.time.addEvent({delay:4e3,callback:()=>{this.play("dino-blinking",!0),this.once(Phaser.Animations.Events.ANIMATION_COMPLETE,()=>{this.setFrame(er.DINO+"1")})},repeat:-1});this.scene.events.emit(ee.TIMER_CREATED,e);const t=1/this.scene.world.getPixelRatio();this.scene.tweens.add({targets:this,scaleY:{from:t,to:t*1.03},yoyo:!0,repeat:-1,duration:1e3,ease:Phaser.Math.Easing.Sine.Out})}happy(){this.play("dino-happy")}}let Yy=class extends Phaser.GameObjects.Container{theOwl;theDino;constructor(e){super(e);const t=e.gameZone.width;this.setSize(t,160),this.createObjects(),this.setDepth(z.BUTTON),e.add.existing(this)}createObjects(){this.theOwl=new Gy(this.scene),this.theOwl.setPosition(100,72),this.theDino=new Uy(this.scene),this.theDino.setPosition(-120,93),this.add([this.theOwl,this.theDino])}playCharacterAnimation(){this.theOwl.blink(),this.theDino.blink()}makeTheDinoHappy(){this.theDino.happy()}};class Hy{scene;constructor(e){this.scene=e,this.initGlobalData()}initGlobalData(){const e=this.scene.registry,t=this.scene.data,{height:s}=this.scene.gameZone,n=this.scene.ads.getBannerHeight(),a=s-n,r=a-150;e.set("flyingDinoSpeed",{x:134,y:-100}),e.set("level",0),e.set("levelUpSetting",{levelUpMethodByTime:!0,timeInterval:60*1e3,shotsCount:40,speed:-4.5/60,levelUpSpeedRate:1.15,duration:20*1e3}),e.set("bullet",{speed:1200}),e.set("zones",{speed:{fast:15,medium:10,slow:5,stand:0},zones:{zone1:{topY:0,bottomY:.3*r},zone2:{topY:.3*r,bottomY:.55*r},zone3:{topY:.55*r,bottomY:.8*r},zone4:{topY:.8*r,bottomY:1*r},zone5:{topY:r,bottomY:a}}}),e.set("bombForce",{distance:100,duration:300}),e.set("dangerTimer",8e3),e.set("timerForNextRandomHeavingBall",7e3),e.set("heavingBallTimer",1e4),e.set("stampTimer",2e4),e.set("maxCombos",9),e.set("rescueCoins",1e3),e.set("gameData",{baseScore:10,levelScores:[10,20,30,50,80,130,210],score:0,combosCount:0,multiplier:1}),e.set("bonusRate",[25,20,15,20,15,10,15]),t.set("ball",{width:33,height:34}),t.set("bomb",{width:35,height:37}),t.set("grid",{width:33.75,height:35,rowSize:11});const c=this.scene.world.getPixelRatio();t.set("physicsWorld",{bound:8,worldBoundWidth:375-16,bulletCollisionRadius:9*c,gridBallCollisionRadius:16*c}),t.set("numEggDestroyedToEmitParticle",15),t.set("shootingAngle",5)}resetData(){const e=this.scene.registry;e.get("gameData").score=0,e.get("gameData").combosCount=0,e.get("gameData").multiplier=1,e.set("level",1),this.scene.events.emit(ee.SCORE_CHANGED)}}var Z=(i=>(i[i.Red=16596787]="Red",i[i.Blue=673791]="Blue",i[i.Green=1353513]="Green",i[i.Yellow=15445546]="Yellow",i[i.Gray=11250603]="Gray",i[i.Black=4802889]="Black",i[i.Pink=13125041]="Pink",i[i.Violet=8995523]="Violet",i[i.Cyan=834032]="Cyan",i[i.Light=13159901]="Light",i[i.Bomb=16090639]="Bomb",i[i.Any=-1]="Any",i))(Z||{});const zy=(i,e)=>i===-1||e===-1?!0:i===e,{KEY:Wy,FRAME:_e}=_.GAMEPLAY.GAME_OBJECTS;class v0 extends Phaser.Physics.Arcade.Image{index}class Vy{scene;shotGuideGroup;movingProcess=0;movingSpeed=200;ballGrid;maxSize=32;guides=[];hideGuideTween;constructor(e){this.scene=e,this.shotGuideGroup=e.add.group(),this.createGuideObjects()}setBallGrid(e){this.ballGrid=e}createGuideObjects(){for(let e=0;e<this.maxSize;e++){const t=this.scene.physics.add.image(0,0,Wy,_e.SHOT_GUIDE);t.kill(),this.shotGuideGroup.add(t)}}overlap(e,t){for(let n=0;n<t.length;n++)if(t[n]&&Phaser.Math.Distance.BetweenPointsSquared(e,t[n])<=625)return!0;return!1}updateGuides(){let e=0;for(e=0;e<this.guides.length;e++){const t=this.guides[e],s=this.ballGrid.getBallsAt(t.x,t.y);if(this.overlap(t,s)){for(let n=e;n<this.guides.length;n++)this.guides[n].setVisible(!1);return}t.setVisible(!0)}}destroy(){this.guides.forEach(e=>e.setVisible(!1))}createGuides(e){const s=this.scene.data.get("physicsWorld").bulletCollisionRadius,n=this.scene.world.getPixelRatio();for(let a=0;a<e;++a){const r=this.shotGuideGroup.get().setAlpha(1);r.setWorldSize(10,10),r.setDepth(z.SPRITES),r.index=a,r.setActive(!0),this.scene.physics.add.existing(r),r.body.setCircle(s,5*n-s,5*n-s),this.guides.push(r)}}showFrom(e,t,s,n,a){const r=this.scene.world.getPixelRatio(),c=this.scene.gameZone.width,o=this.scene.data.get("physicsWorld"),l=o.bulletCollisionRadius/r,h=(c-o.worldBoundWidth)*.5;this.movingProcess+=this.movingSpeed*a/1e3,this.movingProcess>=100&&(this.movingProcess-=100);const d=32;this.guides.length<=0&&this.createGuides(d),this.hideGuideTween?.remove(),this.hideGuideTween=void 0;const u=24;let p=s.x;const g=s.y;e+=p*l*.1+p*u*this.movingProcess/100,t+=g*l*.1+g*u*this.movingProcess/100;for(let m=0;m<d;++m){let E=e+p*u;const f=t+g*u;E<=l+h?(p*=-1,E=2*(l+h)-E):E>=c-l-h&&(p*=-1,E=2*c-2*(l+h)-E),e=E,t=f;const y=this.guides[m];y.x=e,y.y=t,y.setDepth(z.BALL_AND_TAIL),y.setAlpha(1),this.setGuideColor(y,n)}this.updateGuides()}setGuideColor(e,t){switch(t){case Z.Red:e.setFrame(_e.SHOT_GUIDE_RED);break;case Z.Green:e.setFrame(_e.SHOT_GUIDE_GREEN);break;case Z.Blue:e.setFrame(_e.SHOT_GUIDE_BLUE);break;case Z.Yellow:e.setFrame(_e.SHOT_GUIDE_YELLOW);break;case Z.Gray:e.setFrame(_e.SHOT_GUIDE_GRAY);break;case Z.Black:e.setFrame(_e.SHOT_GUIDE_BLACK);break;case Z.Pink:e.setFrame(_e.SHOT_GUIDE_PINK);break;case Z.Violet:e.setFrame(_e.SHOT_GUIDE_VIOLET);break;case Z.Cyan:e.setFrame(_e.SHOT_GUIDE_CYAN);break;case Z.Bomb:e.setFrame(_e.SHOT_GUIDE_ORANGE);break;default:e.setFrame(_e.SHOT_GUIDE_BLACK)}}hide(){this.hideGuideTween||(this.hideGuideTween=this.scene.tweens.add({targets:this.guides,alpha:0,duration:200}))}getGuides(){return this.guides}}const ca={STATUS:{READY:"ready",RUNNING:"running",STOPPED:"stopped"}},{STATUS:Nt}=ca;class $s{state;scene;constructor(e){this.scene=e}init(){this.setState(Nt.READY)}start(){this.isRunning()||this.setState(Nt.RUNNING)}stop(){this.isRunning()&&this.setState(Nt.STOPPED)}setState(e){this.state=e}isReady(){return this.state===Nt.READY}isRunning(){return this.state===Nt.RUNNING}isStopped(){return this.state===Nt.STOPPED}}class Cl extends Error{constructor(e,t){super(e,t),this.name="LeaderboardNotFound",this.message=e||"Leaderboard not found",this.payload=t}}const{AppId:O0,OtherHost:Ky,LeadersBoard:$y}=GameCore.Configs,jy=async(i,e={})=>{let t=[];if($y.UseMock){await Oo(1e3);const{limit:c=10,offset:o=0}=e;return new Array(c).fill(null).map((l,h)=>{const d=(h+1)*(o+1);return{playerId:`player-0${d}`,name:`Player ${d}`,photo:"https://picsum.photos/80",rank:d,score:Math.floor(1e5/d+Math.random()*1e4)}})}const s=GameCore.Utils.String.params(e),n=`leaderboards/${i}/leaders`,a=await Gs(`${n}?${s}`,{},Ky);if(!a||a?.error)throw new Cl;const r=a?.data||[];return r.length<1||(t=r),t},{STATUS:tr}=ca;class Xy extends $s{scene;gameMode;constructor(e){super(e),this.scene=e}init(){this.scene.handleGameModeChange(),super.init()}start(){if(!this.isRunning()){switch(this.gameMode){case ht:this.startSingleMode();break;case Wt:this.startOnlineMode();break;case De:this.startTournamentMode();break;case Ce:this.startChallengeMode();break;default:this.stopOnlineMode(),this.stopChallengeMode(),this.stopTournamentMode()}this.setState(tr.RUNNING)}}stop(){switch(this.gameMode){case ht:this.stopSingleMode();break;case Wt:this.stopOnlineMode();break;case De:this.stopTournamentMode();break;case Ce:this.stopChallengeMode();break}this.setState(tr.STOPPED)}setGameMode(e){this.isRunning()||(this.gameMode=e)}startSingleMode(){this.scene.events.on(ee.SCORE_CHANGED,this.logLevelByScore)}stopSingleMode(){this.scene.events.off(ee.SCORE_CHANGED,this.logLevelByScore)}startOnlineMode(){const{leaders:e}=this.scene.header;e.revive(),e.reset(),this.scene.events.once(ee.SHOOT_BALL,this.runLeaderUpdate),this.scene.events.once(ee.GAME_OVER,this.runLeaderUpdate),this.scene.events.on(ee.SHOOT_BALL,this.updateLeaderScores)}runLeaderUpdate=()=>{this.scene.header.leaders.run()};updateLeaderScores=()=>{const{header:e,scoreCounter:t}=this.scene,s=t.getScore();e.leaders.updatePlayer(s)};stopOnlineMode(){const{leaders:e}=this.scene.header;e.kill(),e.reset(),this.scene.events.off(ee.SHOOT_BALL,this.runLeaderUpdate),this.scene.events.off(ee.GAME_OVER,this.runLeaderUpdate),this.scene.events.off(ee.SHOOT_BALL,this.updateLeaderScores)}async startTournamentMode(){const{tournamentPlayers:e}=this.scene.header;try{e.kill();const t=await this.scene.facebook.getTournamentAsync();if(!t)return;const s=t.getPayload();if(!s)return;const n=JSON.parse(s);if(!n.leaderboardId)return;const a=await jy(n.leaderboardId,{limit:5});if(a.length<1)return;const r=a.map(h=>h.playerId);await this.scene.profile.requestProfiles(r);const c=this.scene.profile.getProfiles(),l=a.map(h=>{const{playerId:d,score:u,rank:p}=h,g=c[d];if(!g)return null;const{name:m,photo:E}=g;return{playerId:d,photo:E,score:u,rank:p,name:m}}).filter(h=>h!==null).sort((h,d)=>d.score-h.score);if(l.length<1)return;e.revive(),e.updateData(l)}catch(t){if(t instanceof Cl)return;K(t)}}stopTournamentMode(){const{tournamentPlayers:e}=this.scene.header;e.kill()}startChallengeMode(){const{challengeBlock:e}=this.scene.header;e.revive();const t=this.scene.storage.getState(),s=this.scene.player.getPlayer(),{playerId:n,photo:a}=s;e.leftPlayer.loadPhoto(n,a);const r=vt(t),{playerId:c,photo:o}=r;e.rightPlayer.loadPhoto(c,o);const l=ts(t),{whitePlayerId:h,whitePlayerScore:d,blackPlayerScore:u}=l,p=n===h;e.leftPlayer.setScore(p?d:u),e.rightPlayer.setScore(p?u:d),this.scene.events.on(ee.SCORE_CHANGED,this.updatePlayerScore),this.scene.events.on(ee.SCORE_CHANGED,this.logLevelByScore)}updatePlayerScore=()=>{const{challengeBlock:e}=this.scene.header,{score:t}=this.scene.registry.get("gameData");e.leftPlayer.setScore(t)};logLevelByScore=()=>{const{score:e=0}=this.scene.registry.get("gameData"),t=this.scene.registry.get("log_level");if(e>=1e4*t){this.scene.analytics.levelComplete(t,e,`level_${t}`);const n=t+1;this.scene.analytics.levelStart(n,e,`level_${n}`),this.scene.registry.set("log_level",n)}};stopChallengeMode(){const{challengeBlock:e}=this.scene.header;e.kill(),this.scene.events.off(ee.SCORE_CHANGED,this.updatePlayerScore),this.scene.events.off(ee.SCORE_CHANGED,this.logLevelByScore)}}const sr=35,Js=90,qy=100,{KEY:Zy,FRAME:Jy}=_.GAMEPLAY.GAMEPLAY_TEXTURES;class Il extends Phaser.GameObjects.Container{images;segments;group;color;constructor(e){super(e),this.images=[],this.segments=[],this.group=e.add.group({classType:Phaser.GameObjects.Image,defaultKey:Zy,defaultFrame:Jy.TAIL}),this.createDefault(),e.add.existing(this)}createDefault(){const e=this.createDefaultImage();this.images.push(e)}createDefaultImage(){const e=this.group.get(0,0);return e.revive(),e.setWorldSize(sr,Js),e.setAngle(0),e.setOrigin(1,0),e.setAlpha(.8),e.setTint(this.color),this.add(e),e}move(e,t){if(this.x===e&&this.y===t)return;const s=e-this.x,n=t-this.y,a=new Phaser.Math.Vector2(s,n);if(a.lengthSq()<qy)return;const r={x:0,y:0,head:0,length:a.length(),angle:a.angle()/Math.PI*180+90};this.setPosition(e,t);let c=r;this.segments.forEach(o=>{o.x-=s,o.y-=n,o.head=c.head+c.length,o.angle.toFixed(1)===c.angle.toFixed(1)&&(c.length+=o.length,o.head+=o.length,o.length=0),c=o}),this.segments.unshift(r),this.alignSegments()}resetTail(e,t){this.setPosition(e,t),this.images.forEach(s=>s.kill()),this.images=[],this.createDefault(),this.segments=[{x:0,y:0,head:0,length:0,angle:0}],this.alignSegments()}setColor(e){this.color=e,this.group.setTint(e)}alignSegments(){this.images.forEach(e=>e.kill()),this.images=[],this.segments=this.segments.filter(e=>e.head>=Js||e.length===0?!1:(e.head+e.length>128&&(e.length=Js-e.head),!0)),this.segments.forEach(e=>{const t=this.createDefaultImage();t.setPosition(e.x,e.y),this.alignSegment(t,e.head,e.head+e.length,e.angle),this.images.push(t)})}alignSegment(e,t,s,n){const a=this.scene.world.getPixelRatio(),r=sr,c=s-t;e.setCrop(0,t*a,r*a,c*a),e.setOrigin(.5*a,t/Js*a),e.setAngle(n)}}const{KEY:Qy,FRAME:$e}=_.GAMEPLAY.GAME_OBJECTS;class Pl extends Phaser.Physics.Arcade.Image{color;stamp;ballSize;constructor(e,t,s,n="",a=""){super(e,t,s,n,a)}getColor(){return this.color}setColor(e){switch(this.setTexture(Qy),e){case Z.Red:this.setFrame($e.BALL_RED);break;case Z.Green:this.setFrame($e.BALL_GREEN);break;case Z.Blue:this.setFrame($e.BALL_BLUE);break;case Z.Yellow:this.setFrame($e.BALL_YELLOW);break;case Z.Gray:this.setFrame($e.BALL_GRAY);break;case Z.Black:this.setFrame($e.BALL_BLACK);break;case Z.Pink:this.setFrame($e.BALL_PINK);break;case Z.Violet:this.setFrame($e.BALL_VIOLET);break;case Z.Cyan:this.setFrame($e.BALL_CYAN);break;default:console.warn(`Can't set ball color with value: ${this.color}`)}this.color=e}setStamp(e){this.stamp=e}getStamp(){return this.stamp}takeStamp(){const e=this.stamp;return this.stamp=void 0,e}postUpdate(){this.stamp?.followBall(this)}initDefault(){this.setAlpha(1),this.setAngle(0),this.setDefaultSize()}setDefaultSize(){if(!this.ballSize)return;const{width:e,height:t}=this.ballSize;this.setWorldSize(e,t)}setWorldSize(e,t,s=!1){super.setWorldSize(e,t),s&&this.ballSize&&this.ballSize.setSize(e,t),this.ballSize||(this.ballSize=new Phaser.Structs.Size(e,t))}}class vl{speed;constructor(e){this.speed=e}fly(e,t){e.body.enable=!0,e.setVelocity(t.x*this.speed,t.y*this.speed)}}class Ai extends Pl{scene;tail;emitter;flyingBehavior;launching=!1;timerEvents=[];radius=0;constructor(e,t,s,n,a){super(e,t,s,n,a),this.scene=e,e.physics.add.existing(this),this.initSprite(),this.scene.add.existing(this)}initSprite(){const e=this.scene.registry.get("bullet").speed;this.flyingBehavior=new vl(e),this.tail=new Il(this.scene),this.tail.kill(),this.tail.setAlpha(.7)}initDefault(){return super.initDefault(),this.setRotation(0),this.launching=!1,this}updatePhysicsRadius(e){const t=this.width*.5-e,s=this.height*.5-e;this.setCircle(e,t,s)}setPhysicsRadius(e){this.radius=e}launch(e){this.flyingBehavior.fly(this,e),this.launching=!0;const t=this.getColor();this.tail.setColor(t),this.tail.resetTail(this.x,this.y),this.tail.revive(),this.emitter?.setTint(t),this.emitter?.startFollow(this),this.emitter?.start()}update(){}postUpdate(){const e=1/this.scene.world.getPixelRatio(),{x:t,y:s}=this;this.tail.move(t,s),this.launching&&(this.setRotation(this.body.velocity.angle()+Math.PI/2),this.setScale(e/1.1,e),this.updatePhysicsRadius(this.radius*1.1),this.scene.stateManager.isGameOver()&&this.kill()),super.postUpdate(),this.y<-30&&this.kill()}preKill(){this.setVisible(!1),this.launching=!1,this.body.enable=!1,this.emitter?.stop(),this.tail.kill();const e=this.scene.time.delayedCall(150,()=>{this.kill()});this.timerEvents.push(e)}kill(){this.launching=!1,this.takeStamp()?.kill(),this.body?.world.disableBody(this.body),this.tail.kill(),this.emitter?.stop(),this.timerEvents.forEach(e=>e.remove()),this.timerEvents.length=0,super.kill()}setEmitter(e){this.emitter=e}}class eE extends Phaser.Physics.Arcade.Group{scene;physicsRadius;tailParticles;ballSize;constructor(e,t){const s={};super(e,t,s),this.scene=t,this.setActive(!0),this.scene.add.existing(this),this.physicsRadius=this.scene.data.get("physicsWorld").bulletCollisionRadius;const{width:n,height:a}=this.scene.data.get("ball");this.ballSize=new Phaser.Structs.Size(n,a),this.tailParticles=t.tailParticles,this.scene.events.off("postupdate",this.postUpdate,this),this.scene.events.on("postupdate",this.postUpdate,this),e.off("worldbounds",this.worldBounds),e.on("worldbounds",this.worldBounds)}worldBounds=e=>{const t=e.gameObject;if(t instanceof Ai){const s=e.deltaX(),n=e.deltaY();if(e.velocity.x>0){const a=t.x-18,r=n+a/s*n;t.y-=r<0?r:r-n*Math.floor(r/n)}else{const a=375-t.x-18,r=n-a/s*n;t.y-=r<0?r:r-n*Math.floor(r/n)}}};postUpdate(){this.getChildren().forEach(e=>{e.active&&e.postUpdate()})}initObjects(e){for(let t=0;t<e;t++)this.createBulletBall().kill()}createBulletBall(){const{KEY:e}=_.GAMEPLAY.GAME_OBJECTS,t=new Ai(this.scene,0,0,e);this.add(t),t.setPhysicsRadius(this.physicsRadius);const{width:s,height:n}=this.ballSize;t.setWorldSize(s,n),t.body instanceof Phaser.Physics.Arcade.Body&&(t.body.onWorldBounds=!0),t.setDepth(z.BULLET);const a=this.tailParticles.createTailEmitter();return t.setEmitter(a),t}spawn(e,t,s){let n=this.getFirstDead();return n||(n=this.createBulletBall()),(s||s===0)&&n.setColor(s),this.world.enableBody(n),n.initDefault(),n.revive(),n.setPosition(e,t),n.updatePhysicsRadius(this.physicsRadius),n.setCollideWorldBounds(!0,1,1),n.body.enable=!1,n}reset(){this.getChildren().forEach(e=>{e.active&&e.kill()})}getChildren(){return super.getChildren()}}class bi extends Pl{row=-1;col=-1;isProcess=!1;heavingBehavior;isHeaving(){return this.heavingBehavior!=null}setHeavingBehavior(e){this.heavingBehavior=e}heave(){this.heavingBehavior?.heave(this)?.on(Phaser.Tweens.Events.TWEEN_COMPLETE,()=>{this.heavingBehavior=void 0})}constructor(e,t,s,n,a){super(e,t,s,n,a),this.scene.add.existing(this)}setProcessed(e=!0){this.isProcess=e}initDefault(){return super.initDefault(),this.row=-1,this.col=-1,this.isProcess=!1,this.heavingBehavior=void 0,this}updatePhysicsRadius(e=33){const t=this.width*.5-e,s=this.height*.5-e;this.setCircle(e,t,s)}jiggle(e,t,s){this.scene.tweens.addCounter({from:0,to:t,yoyo:!0,duration:150,loop:1,delay:s,onUpdate:n=>{if(!this.active){n.complete();return}const a=n.data[0].previous||0,r=n.getValue()-a;n.loopCounter===1?(this.x+=r*e.x,this.y+=r*e.y):(this.x-=r/4*e.x,this.y-=r/4*e.y)},ease:"Sine.easeOut"})}moveTo(e,t,s){const n=e-this.x,a=t-this.y,r=250,o=Math.sqrt(n*n+a*a)/r*1e3;this.scene.tweens.addCounter({duration:o,onUpdate:l=>{if(!this.active){l.complete();return}const h=l.data[0].previous||0,d=l.getValue()-h,u=d*n,p=d*a;this.x+=u,this.y+=p,s?.setPosition(this.x,this.y)},ease:"Sine.easeOut"})}postUpdate(){this.y<-20&&this.visible?this.setVisible(!1):this.y>-20&&!this.visible&&this.setVisible(!0),super.postUpdate()}preKill(){this.body?.world.disableBody(this.body),this.scene.tweens.add({targets:this,duration:200,alpha:{from:1,to:.3},onComplete:this.kill,onCompleteScope:this})}kill(){this.takeStamp()?.kill(),this.body?.world.disableBody(this.body),super.kill()}}class tE extends Phaser.Physics.Arcade.Group{physicsRadius;ballSize;constructor(e,t,s){super(e,t,{immovable:!0}),this.scene.add.existing(this),this.setActive(!0),this.physicsRadius=this.scene.data.get("physicsWorld").gridBallCollisionRadius;const{width:n,height:a}=this.scene.data.get("ball");this.ballSize=new Phaser.Structs.Size(n,a),this.listenEvents()}listenEvents(){this.scene.events.off("postupdate",this.postUpdate,this),this.scene.events.on("postupdate",this.postUpdate,this)}postUpdate(){this.getChildren().forEach(e=>{e.active&&e.postUpdate()})}spawn(e,t,s){let n=this.getFirstDead();return n||(n=this.createGridBall()),(s||s===0)&&n.setColor(s),this.world.enableBody(n),n.initDefault(),n.setPosition(e,t),n.revive(),n.updatePhysicsRadius(this.physicsRadius),n}reset(){this.getChildren().forEach(e=>{e.active&&e.kill()})}initObjects(e){for(let t=0;t<e;t++)this.createGridBall().kill()}createGridBall(){const{KEY:e}=_.GAMEPLAY.GAME_OBJECTS,{width:t,height:s}=this.ballSize,n=new bi(this.scene,0,0,e);return this.add(n),n.setWorldSize(t,s),n.setDepth(z.BALL_AND_TAIL),n}getChildren(){return super.getChildren()}}const la=()=>{const i=GameCore.Utils.Device,{vibrate:e}=window.navigator;return i.isAndroid()&&typeof e=="function"||i.isMobileWeb()&&typeof e=="function"||i.isIOS()},He=i=>{try{if(!la())return!1;const e=GameCore.Utils.Device;return(e.isAndroid()||e.isMobileWeb())&&sE(i),!0}catch{return!1}},sE=i=>{window.navigator.vibrate(0),window.navigator.vibrate(i)};class iE{scene;vibrateSupport;constructor(e){this.scene=e,this.vibrateSupport=la()}handleCombosIncreased(e){if(this.isVibrateEnable())switch(e){case 3:He(50);break;case 4:He(100);break;case 5:He(150);break;case 6:He(200);break;case 7:He(250);break;case 8:He(300);break;case 9:He(350);break}}handleBombCreated(){this.isVibrateEnable()&&He(350)}handleBombexploding(){this.isVibrateEnable()&&He(450)}handleAlertAboutFlyingDino(e){this.isVibrateEnable()&&He(e)}isVibrateEnable(){const{player:e}=this.scene,t=e.getPlayerSettings();return this.vibrateSupport&&t.vibrate}}class Ol extends Phaser.Physics.Arcade.Image{scene;tail;tailEmitter;launching=!1;flyingBehavior;size;radius=0;fromGift;constructor(e,t,s,n,a){super(e,t,s,n,a),this.scene=e,this.scene.add.existing(this),this.initSprite()}initSprite(){this.tail=new Il(this.scene),this.tail.kill(),this.tail.setAlpha(.7)}initDefault(){this.setAlpha(1),this.setAngle(0),this.setDefaultSize()}setDefaultSize(){if(!this.size)return;const{width:e,height:t}=this.size;this.setWorldSize(e,t)}setWorldSize(e,t,s=!1){super.setWorldSize(e,t),s&&(this.size?this.size.setSize(e,t):this.size=new Phaser.Structs.Size(e,t))}updatePhysicsRadius(e){const t=this.width*.5-e,s=this.height*.5-e;this.setCircle(e,t,s)}setPhysicsRadius(e){this.radius=e}setFlyingBehavior(){const e=this.scene.registry.get("bullet").speed;return this.flyingBehavior=new vl(e),this}launch(e){this.flyingBehavior.fly(this,e),this.launching=!0;const t=16090639;this.tail.setColor(t),this.tail.resetTail(this.x,this.y),this.tail.revive(),this.tailEmitter?.setTint(t),this.tailEmitter?.startFollow(this),this.tailEmitter?.start()}postUpdate(){const e=1/this.scene.world.getPixelRatio(),{x:t,y:s}=this;if(this.tail.move(t,s),this.launching){const n=(this.body.velocity.angle()||-Math.PI/2)+Math.PI/2;this.setRotation(n),this.setScale(e*.9,e*1.15),this.updatePhysicsRadius(this.radius/.9)}this.y<-30&&this.kill()}makeExplosion(){const e=1/this.scene.world.getPixelRatio();this.scene.tweens.add({targets:this,duration:100,scaleX:{from:e*.9,to:e*1.15},scaleY:{from:e*1.15,to:e*.9},alpha:{from:1,to:.3}}),this.preKill()}preKill(){this.launching=!1,this.body.enable=!1,this.tailEmitter?.stop(),this.tail.kill(),this.scene.time.delayedCall(150,()=>{this.kill()})}kill(){this.launching=!1,this.body?.world.disableBody(this.body),this.tail.kill(),this.tailEmitter?.stop(),super.kill()}setTailEmitter(e){this.tailEmitter=e}}class nE extends Phaser.Physics.Arcade.Group{scene;tailParticles;physicsRadius;bombSize;constructor(e,t){super(e,t),this.scene=t,this.setActive(!0),this.scene.add.existing(this),this.physicsRadius=this.scene.data.get("physicsWorld").bulletCollisionRadius;const{width:s,height:n}=this.scene.data.get("bomb");this.bombSize=new Phaser.Structs.Size(s,n),this.tailParticles=t.tailParticles,this.listenEvents()}setPhysicsRadius(e){return this.physicsRadius=e,this}setDepth(e,t){return super.setDepth(e,t),this}listenEvents(){this.scene.events.off("postupdate",this.postUpdate,this),this.scene.events.on("postupdate",this.postUpdate,this)}postUpdate(){this.getChildren().forEach(e=>{e.active&&e.postUpdate()})}spawn(e=0,t=0){let s=this.getFirstDead();return s||(s=this.addBomb()),this.world.enableBody(s),s.initDefault(),s.revive(),s.setPosition(e,t),s.setCollideWorldBounds(!0,1,1),s.updatePhysicsRadius(this.physicsRadius),s.body.enable=!1,s}reset(){this.getChildren().forEach(e=>{e.active&&e.kill()})}initObjects(e){for(let t=0;t<e;t++)this.addBomb().kill()}getChildren(){return super.getChildren()}addBomb(){const{KEY:e,FRAME:t}=_.GAMEPLAY.GAME_OBJECTS,s=new Ol(this.scene,0,0,e,t.BOMB);s.setDepth(z.BULLET);const n=this.tailParticles.createTailEmitter();s.setTailEmitter(n),this.add(s),s.setPhysicsRadius(this.physicsRadius);const{width:a,height:r}=this.bombSize;return s.setWorldSize(a,r),s}}var _l=(i=>(i[i.Stamp5=0]="Stamp5",i[i.Stamp10=1]="Stamp10",i[i.Stamp15=2]="Stamp15",i[i.Stamp2x=3]="Stamp2x",i[i.Stamp3x=4]="Stamp3x",i[i.Stamp4x=5]="Stamp4x",i[i.StampUp=6]="StampUp",i[i.None=-1]="None",i))(_l||{});const he=_l,{FRAME:nt}=_.GAMEPLAY.GAME_OBJECTS;class aE extends Phaser.GameObjects.Image{stampType;getStampType(){return this.stampType}constructor(e,t,s,n){super(e,t,s,n),this.stampType=he.None,this.setDepth(z.BULLET+1),this.setOrigin(.51,.49),this.scene.children.add(this)}setStamp(e){switch(e){case he.Stamp5:{this.setFrame(nt.BONUS_STAMP_05);break}case he.Stamp10:{this.setFrame(nt.BONUS_STAMP_10);break}case he.Stamp15:{this.setFrame(nt.BONUS_STAMP_15);break}case he.Stamp2x:{this.setFrame(nt.BONUS_STAMP_2X);break}case he.Stamp3x:{this.setFrame(nt.BONUS_STAMP_3X);break}case he.Stamp4x:{this.setFrame(nt.BONUS_STAMP_4X);break}case he.StampUp:{this.setFrame(nt.BONUS_STAMP_UP);break}default:this.setFrame(nt.BLANK);break}this.stampType=e}followBall(e){this.setPosition(e.x,e.y),this.setScale(e.scale*1.2,e.scale*1.12),this.alpha=e.alpha,this.visible=e.visible}}class rE extends Phaser.GameObjects.Group{constructor(e){super(e,{}),this.setActive(!0),this.initObjects(),this.scene.add.existing(this)}spawn(e=0,t=0){let s=this.getFirstDead();return s?s.revive():s=this.createStamp(),s.setPosition(e,t),s}reset(){this.getChildren().forEach(e=>{e.active&&e.kill()})}initObjects(){for(let e=0;e<5;e++){const t=this.createStamp();t.kill(),this.add(t)}}createStamp(){const{KEY:e}=_.GAMEPLAY.GAME_OBJECTS;return new aE(this.scene,0,0,e)}getChildren(){return super.getChildren()}}class oE extends Phaser.GameObjects.Zone{constructor(e,t,s){super(e,0,0,t,s),this.setOrigin(0,0)}}class is extends Phaser.Scene{unsubscribeList;gameZone;background;handleOpenScene=()=>{this.logPageviewOnOpen(),this.logEventOpen()};constructor(){super({visible:!1})}create(){this.events.on("wake",this.handleOpenScene),this.events.on("resume",this.handleOpenScene),this.events.on("create",this.handleOpenScene),this.scaleGame(),this.createGameZone()}scaleGame(){const e=this.getCamera("main"),t=this.world.getZoomRatio(),{width:s,height:n}=this.world.getWorldSize();e.setZoom(t),e.centerOn(s/2,n/2)}createGameZone(){const{width:e,height:t}=this.world.getWorldSize();this.gameZone=new oE(this,e,t)}getCamera(e){return e==="main"?this.cameras.main:this.cameras.getCamera(e)}createMask(e=1){this.getCamera("main").setBackgroundColor(`rgba(0, 0, 0, ${e})`)}fontSize(e){return e/1}createBackground(e,t,s,n){this.background?(this.background.setTexture(e),t&&this.background.setFrame(t)):this.background=this.make.image({key:e,frame:t}),this.background.setName(e);const{displayWidth:a,displayHeight:r}=this.gameZone;this.background.setDisplaySize(a,r),GameCore.Utils.Valid.isNumber(s)&&this.background.setAlpha(s),GameCore.Utils.Valid.isNumber(n)&&this.background.setTint(n),Phaser.Display.Align.In.Center(this.background,this.gameZone)}handleStateChange(e){this.unsubscribeList=[],e.forEach(t=>{const{selector:s,callback:n}=t,a=this.storage.watch(s,n);this.unsubscribeList.push(a)}),this.events.once("sleep",this.removeStateChange),this.events.once("destroy",this.removeStateChange),this.events.once("shutdown",this.removeStateChange)}removeStateChange=()=>{this.unsubscribeList.forEach(e=>e())};logPageviewOnOpen(){this.analytics.pageview(this.scene.key)}logEventOpen(){this.analytics.event(V.SCREEN_OPEN,{screen_name:this.getSceneName()})}getSceneName(){return GameCore.Utils.String.toUpperCamelCase(this.scene.key.toLowerCase())}}const cE={targets:[],duration:600,ease:Phaser.Math.Easing.Linear,props:{angle:{from:0,to:360}}};class Mi extends pe{constructor(e){super(cE,e)}}const{KEY:lE,FRAME:hE}=_.DEFAULT;class Rt extends Phaser.GameObjects.Image{anim;constructor(e){super(e,0,0,lE,hE.PRELOADER),this.runAnimation(),this.setWorldSize(50,50),this.scene.add.existing(this)}runAnimation(){this.anim?.remove(),this.anim=new Mi({targets:[this],repeat:-1,duration:1200}),this.anim.play()}setVisible(e){return super.setVisible(e),e?this.runAnimation():this.anim.stop(),this}}class ns extends Phaser.GameObjects.Container{payload;loading;photo;avtFrame;background;loadPhotoTimer;constructor(e,t){super(e),this.scene.add.existing(this),this.payload=t,this.setSize(t.width,t.height),this.createBackground(),this.createLoading(),this.createPhoto(),this.createFrame();const{id:s,url:n,radius:a}=this.payload;s&&n&&this.loadPhoto(s,n,a),this.addDefaultListeners()}setFrame(e){this.avtFrame.setFrame(e),this.avtFrame.setVisible(!0)}setBackground(e){this.background.setFrame(e)}loadPhoto(e,t,s=0){if(this.payload.id=e,this.payload.url=t,this.payload.radius=s,this.loadPhotoTimer?.remove(),!e||!t){this.setPhoto($.AVATAR.KEY);return}const n=this.scene.textures.get(e);if(n&&n.key===e){this.handleLoadComplete(e);return}this.showLoading(!0);const a=this.payload.loadDelay||0;this.loadPhotoTimer=this.scene.time.delayedCall(a,this.handleLoadPhotoAfterDelay(e,t))}handleLoadPhotoAfterDelay=(e,t)=>()=>{const s=this.scene.textures.get(e);if(s&&s.key===e){this.handleLoadComplete(e);return}this.scene.load.once(`filecomplete-image-${e}`,this.handleLoadComplete),this.scene.load.image(e,t),this.scene.load.start()};addDefaultListeners(){this.scene.load.on(Phaser.Loader.Events.FILE_LOAD_ERROR,this.handleLoadPhotoFailed),this.on(Phaser.GameObjects.Events.DESTROY,()=>{this.loadPhotoTimer?.remove(),this.scene.load.off(Phaser.Loader.Events.FILE_LOAD_ERROR,this.handleLoadPhotoFailed)})}handleLoadComplete=e=>{if(!this.scene)return;const{id:t,radius:s=0}=this.payload;if(!t||t!==e)return;const n=`${t}_bordered_${s}`,a=s>0?n:t,r=this.scene.textures.get(a);if(r&&r.key===a){this.setPhoto(r.key);return}if(s!=0&&s<100){if(!GameCore.Utils.Image.drawBorder({scene:this.scene,key:t,newKey:n,radius:s})){this.showLoading(!1);return}this.setPhoto(n)}else if(s==100){if(!GameCore.Utils.Image.drawCircle({scene:this.scene,key:t,newKey:n})){this.showLoading(!1);return}this.setPhoto(n)}else this.setPhoto(t)};handleLoadPhotoFailed=e=>{e.key===this.payload.id&&this.setDefaultAvatar(e.key)};setDefaultAvatar(e){this.loadPhoto(e,$.AVATAR.FILE,this.payload.radius)}createBackground(){const{key:e,background:t}=this.payload;this.background=this.scene.make.image({key:e,frame:t}),this.background.setWorldSize(this.width,this.height),this.add(this.background)}createLoading(){this.loading=new Rt(this.scene),this.loading.setWorldSize(this.width*.75,this.height*.75),this.loading.setVisible(!1),this.add(this.loading)}createPhoto(){this.photo=this.scene.make.image({x:0,y:0,origin:{x:.5,y:.5},visible:!1}),this.add(this.photo)}createFrame(){const{key:e,frame:t,width:s,height:n}=this.payload;t?(this.avtFrame=this.scene.make.image({key:e,frame:t}),this.avtFrame.setWorldSize(s,n)):this.avtFrame=this.scene.make.image({x:0,y:0,origin:{x:.5,y:.5},visible:!1}),this.add(this.avtFrame)}showLoading(e){this.photo.setVisible(!e),this.loading.setVisible(e)}setPhoto(e){this.showLoading(!1),this.photo.setTexture(e),this.photo.setFrame(0);const{width:t,height:s}=this.payload,n=Math.min(t,s)-10;this.photo.setWorldSize(n,n),Phaser.Display.Align.In.Center(this.photo,this.background)}}const{KEY:uE,FRAME:ir}=_.GAMEPLAY.GAMEPLAY_TEXTURES;let Ps=class extends ns{constructor(e,t=37,s=37){super(e,{key:uE,frame:ir.AVATAR_FRAME,background:ir.AVATAR_BG,width:t,height:s,loadDelay:100}),this.scene.add.existing(this)}loadPhoto(e,t,s=0){t&&(e===this.payload.id&&t===this.payload.url||super.loadPhoto(e,t,s))}};const{KEY:dE,FRAME:Zi}=_.GAMEPLAY.GAMEPLAY_TEXTURES;let pE=class extends Phaser.GameObjects.Container{scene;currentPlayer;slideDuration;floatInBlock;floatOutBlock;deltaX=5;avatar;rankFlag;rankNumber;constructor(e){super(e),this.scene=e,this.setSize(50,50),this.setDurationAnimation(2e3),this.setDataEnabled(),this.createAvatar(),this.createRank(),this.listenEvents(),this.setDepth(z.UI),this.scene.add.existing(this)}isCurrentPlayer(){return this.currentPlayer}setCurrentPlayer(e){this.currentPlayer=e,this.updateRankFlag()}listenEvents(){this.on(Phaser.Data.Events.SET_DATA,this.updateLeader),this.on(Phaser.Data.Events.CHANGE_DATA,this.updateLeader)}updateLeader=(e,t)=>{t==="photo"&&this.updateAvatar(),t==="rank"&&this.updateRankNumber()};show=()=>{this.setVisible(!0)};hide=()=>{this.setVisible(!1)};setDurationAnimation(e){this.slideDuration=e}runFloatInAnimation(e,t,s){const n=this.deltaX;this.floatOutBlock?.tween?.complete();const a=t?e-n:e+n;this.floatInBlock=new Ve({targets:[this],delay:s*25,duration:this.slideDuration,props:{x:{start:a,from:a,to:e}}}),this.setVisible(!0),this.floatInBlock?.play()}runFloatOutAnimation(e,t,s){const n=this.deltaX;this.floatInBlock?.tween?.complete();const a=t?e+n:e-n;this.floatOutBlock=new ke({targets:[this],delay:s*50,duration:this.slideDuration,props:{x:{start:e,from:e,to:a}},onComplete:()=>{this.setVisible(!1),this.x=e}}),this.floatOutBlock?.play()}stopFloatAnimation(){this.floatInBlock?.tween?.stop(1),this.floatInBlock?.remove(),this.floatOutBlock?.tween?.stop(1),this.floatOutBlock?.remove()}createAvatar(){this.avatar=new Ps(this.scene),Phaser.Display.Align.In.Center(this.avatar,this),this.add(this.avatar)}createRank(){this.rankFlag=this.scene.make.image({key:dE,frame:Zi.RANK_YELLOW}),this.rankFlag.setWorldSize(25,20),this.rankNumber=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(16),origin:{x:.5,y:.5},text:"1"}),Phaser.Display.Align.In.TopCenter(this.rankFlag,this,0,4),Phaser.Display.Align.In.Center(this.rankNumber,this.rankFlag,-2,-1),this.add([this.rankFlag,this.rankNumber])}updateAvatar(){const e=this.getData("playerId"),t=this.getData("photo");this.avatar.loadPhoto(e,t)}updateRankFlag(){this.isCurrentPlayer()?this.rankFlag.setFrame(Zi.RANK_YELLOW):this.rankFlag.setFrame(Zi.RANK_VIOLET)}updateRankNumber(){const e=this.getData("rank");this.rankNumber.setText(`${e}`)}};const{MockScoreDifficult:gE}=GameCore.Configs.Gameplay;let mE=class extends Phaser.GameObjects.Container{playerId;currentScore;maxBlocks=5;xArray;lastUpdate=0;durationAnimation=400;timer;lastScore;playersScore;playersDifficult;leaders;constructor(e){super(e);const t=this.scene.player;this.playerId=t.getPlayerId(),this.initMockData(),this.createPosition(),this.createLeaders(),this.alignLeaders(),this.run(),this.setDepth(z.LEADERBOARD),this.scene.add.existing(this)}run(){if(this.revive(),this.timer){this.timer.remove();const e=this.getLeadersData();if(e.length<1)return;const t=this.mockupLeaderScores(this.currentScore,e);this.updateScores(t),this.updateLeaders(t)}this.timer=this.scene.time.addEvent({delay:5e3,repeat:-1,callback:()=>{const e=this.getLeadersData();if(e.length<1)return;const t=this.mockupLeaderScores(this.currentScore,e);this.updateScores(t),this.updateLeaders(t)}})}reset(){this.lastScore=0,this.currentScore=0,this.playersScore={},this.kill(),this.timer?.destroy(),this.leaders.getChildren().forEach((t,s)=>{t.setData("rank",s+1),t.stopFloatAnimation(),t.setAlpha(1)}),this.alignLeaders()}alignLeaders(){this.leaders.setVisible(!1),this.leaders.getChildren().forEach((t,s)=>{const n=t,a=this.xArray[s];n.setX(a),n.setVisible(!0)})}getPosX(e){const t=this.getCurrentPlayer();if(!t)return 0;const s=10,n=t.getData("rank")||0;let a=e.getData("rank");n>this.maxBlocks?a-=this.maxBlocks:a-=n;const r=a/Math.abs(a),c=t.displayWidth*.5-e.displayWidth*.5;return t.x+(s+e.displayWidth)*a+c*r}getLeadersData(){const e=this.scene.storage.getState(),t=Of(e);return Object.values(t)}updatePlayer(e){const t=this.getLeadersData();if(t.length<1||!t.find(a=>a.playerId===this.playerId))return;const n=this.mockupLeaderScores(e,t);this.updateLeaders(n),this.currentScore=e}initMockData(){this.playersScore={},this.playersDifficult={},_n.forEach(e=>{const{playerId:t,difficult:s}=e;this.playersDifficult[t]=s})}mockupLeaderScores(e,t){let s=e-this.lastScore;s=s<=0?Phaser.Math.RND.between(0,200):s,this.lastScore=e;const n=2500,r=t.map(c=>{const o={...c,rank:0,score:e};if(o.playerId===this.playerId)return o;let l=0;const h=Phaser.Math.RND.between(0,100);h<=20?l=s*.5:h<=60?l=s*1:h<90?l=s*1.4:l=s*2.5,l=l>n?n:l,l=Phaser.Math.RND.between(0,l);const d=this.playersDifficult[o.playerId],u=l*d,p=Math.round(u*gE/10)*10;return GameCore.Utils.Object.hasOwn(this.playersScore,o.playerId)||(this.playersScore||(this.playersScore={[o.playerId]:0}),this.playersScore[o.playerId]=0),this.playersScore[o.playerId]+=p,o.score=this.playersScore[o.playerId],o}).sort((c,o)=>o.score-c.score);return r.forEach((c,o)=>{c.rank=o+1}),r}updateLeaders(e){const t=Date.now();if(t-this.lastUpdate<this.durationAnimation+1e3)return;this.lastUpdate=t;const s=e.findIndex(o=>o.playerId===this.playerId);if(s<0)return;const n=Math.floor(this.maxBlocks/2);let a=s-n,r=s+n;a<0&&(a=0),r>=e.length&&(r=e.length);const c=e.slice(a,r+1);this.processLogicUpdateOrder(c,s-a)}updateScores(e){this.scene.storage.dispatch(By(e))}processLogicUpdateOrder(e,t){const s=this.leaders.getChildren(),a=this.getCurrentPlayer()?.getData("rank"),{rank:r}=e[t],c=Math.floor(this.maxBlocks/2),o=a!=r,l=a>r;if(!o){e.forEach((h,d)=>{s[d+c-t].setData(h)});return}s.forEach((h,d)=>{if(h.isCurrentPlayer())return;const u=this.xArray[d];h.setDurationAnimation(this.durationAnimation),h.runFloatOutAnimation(u,l,d)}),this.scene.time.delayedCall(this.durationAnimation,()=>{e.forEach((h,d)=>{const u=s[d+c-t],p=this.playerId===h.playerId,g=this.xArray[d+c-t];if(u.setData(h),p){u.setCurrentPlayer(!0);return}u.runFloatInAnimation(g,l,d)})})}createPosition(){const a=Math.floor(this.maxBlocks/2),r=[];for(let c=0;c<this.maxBlocks;c++){const o=c-a;let l=(40+10)*o;o<0?l-=5:o>0&&(l+=5),r.push(l)}this.xArray=r}createLeaders(){this.leaders=this.scene.make.group({maxSize:this.maxBlocks});const e=Math.floor(this.maxBlocks/2);for(let s=0;s<this.maxBlocks;s++){const n=new pE(this.scene);n.setData({playerId:`${s}`,score:0,photo:"",rank:s+1}),s===e?(n.setDisplaySize(50,50),n.setCurrentPlayer(!0),n.setData("playerId",this.playerId)):(n.setPosition(0,5),n.setDisplaySize(40,40),n.setCurrentPlayer(!1)),this.leaders.add(n)}const t=this.leaders.getChildren();this.add(t),this.bringToTop(t[0])}getCurrentPlayer(){return this.leaders.getChildren().find(s=>s.isCurrentPlayer())}};class nr extends Phaser.GameObjects.Container{avatar;scoreText;constructor(e){super(e),this.createAvatar(),this.createScore(),this.setScore(0)}setScore(e){const t=GameCore.Utils.Number.toAbbreviatedString(e||0,{fractionalDigits:1,startAbbreviate:1e5});this.scoreText.setText(t)}loadPhoto(e,t){this.avatar.loadPhoto(e,t)}createAvatar(){this.avatar=new Ps(this.scene,40,40),this.add(this.avatar)}createScore(){this.scoreText=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(13)}),this.scoreText.setOrigin(.5,.5),Phaser.Display.Align.In.BottomCenter(this.scoreText,this.avatar),this.add(this.scoreText)}}class fE extends Phaser.GameObjects.Container{vsText;leftPlayer;rightPlayer;constructor(e){super(e),this.createVsText(),this.createLeftAvatar(),this.createRightAvatar(),this.scene.add.existing(this)}createVsText(){this.vsText=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(25),text:this.scene.lang.Text.VS,origin:{x:.5,y:.5}}),this.vsText.setPosition(4.5,2),this.add(this.vsText)}createLeftAvatar(){this.leftPlayer=new nr(this.scene),this.leftPlayer.setX(-46),this.add(this.leftPlayer)}createRightAvatar(){this.rightPlayer=new nr(this.scene),this.rightPlayer.setX(56),this.add(this.rightPlayer)}}const{KEY:Ji,FRAME:Qi}=_.GAMEPLAY.GAMEPLAY_TEXTURES;class yE extends Phaser.GameObjects.Container{topOnePlayer;topTwoPlayer;topThreePlayer;topOneScore;topTwoScore;topThreeScore;constructor(e){super(e),this.createTopOnePlayer(),this.createTopTwoPlayer(),this.createThreeTwoPlayer(),this.scene.add.existing(this)}updateData(e){const{KEY:t,FILE:s}=$.AVATAR,n=e[0],a=e[1],r=e[2];if(n){const c=GameCore.Utils.Number.toAbbreviatedString(+n.score,{startAbbreviate:1e5});this.topOneScore.setText(c),this.topOnePlayer.loadPhoto(n.playerId,n.photo)}else this.topOneScore.setText("???"),this.topOnePlayer.loadPhoto(t,s);if(a){const c=GameCore.Utils.Number.toAbbreviatedString(+a.score,{startAbbreviate:1e5});this.topTwoScore.setText(c),this.topTwoPlayer.loadPhoto(a.playerId,a.photo)}else this.topTwoScore.setText("???"),this.topTwoPlayer.loadPhoto(t,s);if(r){const c=GameCore.Utils.Number.toAbbreviatedString(+r.score,{startAbbreviate:1e5});this.topThreeScore.setText(c),this.topThreePlayer.loadPhoto(r.playerId,r.photo)}else this.topThreeScore.setText("???"),this.topThreePlayer.loadPhoto(t,s)}createTopOnePlayer(){this.topOnePlayer=new Ps(this.scene);const e=this.scene.make.image({key:Ji,frame:Qi.ICON_GOLD});e.setPosition(-18,-9),e.setWorldSize(28,27),this.topOneScore=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(14),text:"99999",origin:{x:.5,y:0}}),this.topOneScore.setY(12),this.topOnePlayer.add([this.topOneScore,e]),this.topOnePlayer.setX(-68),this.add(this.topOnePlayer)}createTopTwoPlayer(){this.topTwoPlayer=new Ps(this.scene);const e=this.scene.make.image({key:Ji,frame:Qi.ICON_SILVER});e.setPosition(-18,-9),e.setWorldSize(28,27),this.topTwoScore=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(13),text:"99999",origin:{x:.5,y:0}}),this.topTwoScore.setY(12),this.topTwoPlayer.add([this.topTwoScore,e]),Phaser.Display.Align.In.Center(this.topTwoPlayer,this.topOnePlayer,68),this.add(this.topTwoPlayer)}createThreeTwoPlayer(){this.topThreePlayer=new Ps(this.scene);const e=this.scene.make.image({key:Ji,frame:Qi.ICON_BRONZE});e.setPosition(-18,-9),e.setWorldSize(28,27),this.topThreeScore=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(13),text:"99999",origin:{x:.5,y:0}}),this.topThreeScore.setY(12),this.topThreePlayer.add([this.topThreeScore,e]),Phaser.Display.Align.In.Center(this.topThreePlayer,this.topTwoPlayer,68),this.add(this.topThreePlayer)}}const{KEY:ar,FRAME:rr}=_.GAMEPLAY.GAMEPLAY_TEXTURES;let EE=class extends Phaser.GameObjects.Container{scene;scoreText;leaders;challengeBlock;tournamentPlayers;scoreBlock;updateScoreTimer;constructor(e){super(e),this.scene=e;const{width:t}=this.scene.gameZone;this.setSize(t,55),this.createBackground(),this.createLine(),this.createLeaders(),this.createTournamentPlayers(),this.createChallengeBlock(),this.createScoreBar(),this.listenEvents(),e.add.existing(this)}createBackground(){const e=this.scene.world.getPixelRatio(),t=this.scene.add.image(0,-this.height/2,$.GAME_BACKGROUND.KEY);t.setOrigin(.5,0),t.setTint(11184810),t.setWorldSize(375,667),t.setCrop(0,0,this.width*e,this.height*e),t.setAlpha(.7),this.add(t)}createLine(){const e=this.scene.make.image({key:ar,frame:rr.TOP_LINE,y:this.height/2+3});e.setWorldSize(375,16),this.add(e)}createLeaders(){this.leaders=new mE(this.scene),this.leaders.setY(-2),this.leaders.kill(),this.add(this.leaders)}createTournamentPlayers(){this.tournamentPlayers=new yE(this.scene),this.tournamentPlayers.setPosition(20,-4),this.tournamentPlayers.kill(),this.add(this.tournamentPlayers)}createChallengeBlock(){this.challengeBlock=new fE(this.scene),this.challengeBlock.kill(),this.challengeBlock.setY(-3),this.add(this.challengeBlock)}createScoreBar(){this.scoreBlock=this.scene.add.container();const e=this.scene.make.image({key:ar,frame:rr.TAB_SCORE,origin:{x:0,y:.5}});e.setWorldSize(77,33),this.scoreText=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(18),origin:{x:.5,y:.5}}),Phaser.Display.Align.In.Center(this.scoreText,e,0,1),this.scoreBlock.add([e,this.scoreText]),this.add(this.scoreBlock),Phaser.Display.Align.In.LeftCenter(this.scoreBlock,this,-23)}listenEvents(){this.scene.events.on(ee.SCORE_CHANGED,this.updateScore)}updateScore=()=>{const{score:e}=this.scene.registry.get("gameData"),t=GameCore.Utils.Number.toAbbreviatedString(+e,{startAbbreviate:1e8});this.scoreText.setText(t),this.updateScoreTimer?.remove(),this.updateScoreTimer=this.scene.time.delayedCall(500,()=>{this.scene.storage.dispatch(Ks({score:e}))})}};const{KEY:je,FRAME:Xe}=_.DEFAULT;class Ye extends Phaser.GameObjects.Container{barTopLeft;barTopMid;barTopRight;barMidLeft;barMidBg;barMidRight;barBottomLeft;barBottomMid;barBottomRight;constructor(e,t,s,n,a){super(e,t,s),this.setSize(n,a),this.setDepth(z.POPUP),this.createPopup(),this.scene.add.existing(this)}set onClose(e){this.setInteractive({useHandCursor:!0}),this.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,e)}createPopup(){this.createPopupImages(),this.updatePopupSize(),this.alignPopupImages()}createPopupImages(){this.barTopLeft=this.scene.add.image(0,0,je,Xe.POPUP_TOP_LEFT),this.barTopMid=this.scene.add.image(0,0,je,Xe.POPUP_TOP_MID),this.barTopRight=this.scene.add.image(0,0,je,Xe.POPUP_TOP_RIGHT),this.barMidLeft=this.scene.add.image(0,0,je,Xe.POPUP_MID_LEFT),this.barMidBg=this.scene.add.image(0,0,je,Xe.POPUP_MID_MID),this.barMidRight=this.scene.add.image(0,0,je,Xe.POPUP_MID_RIGHT),this.barBottomLeft=this.scene.add.image(0,0,je,Xe.POPUP_BOTTOM_LEFT),this.barBottomMid=this.scene.add.image(0,0,je,Xe.POPUP_BOTTOM_MID),this.barBottomRight=this.scene.add.image(0,0,je,Xe.POPUP_BOTTOM_RIGHT),this.barTopLeft.setWorldSize(65,48),this.barTopMid.setWorldSize(65,48),this.barTopRight.setWorldSize(65,48),this.barMidLeft.setWorldSize(65,48),this.barMidBg.setWorldSize(65,48),this.barMidRight.setWorldSize(65,48),this.barBottomLeft.setWorldSize(65,48),this.barBottomMid.setWorldSize(65,48),this.barBottomRight.setWorldSize(65,48),this.add([this.barTopRight,this.barTopMid,this.barBottomLeft,this.barBottomRight,this.barMidLeft,this.barMidRight,this.barTopLeft,this.barBottomMid,this.barMidBg])}updatePopupSize(){this.barTopMid.setWorldSize(this.width-129,this.barTopMid.height),this.barMidLeft.setWorldSize(this.barMidLeft.width,this.height-95),this.barMidBg.setWorldSize(this.width-129,this.height-95),this.barMidRight.setWorldSize(this.barMidRight.width,this.height-95),this.barBottomMid.setWorldSize(this.width-129,this.barBottomMid.height)}alignPopupImages(){Phaser.Display.Align.In.TopLeft(this.barTopLeft,this),Phaser.Display.Align.In.TopCenter(this.barTopMid,this),Phaser.Display.Align.In.TopRight(this.barTopRight,this),Phaser.Display.Align.In.LeftCenter(this.barMidLeft,this),Phaser.Display.Align.In.Center(this.barMidBg,this),Phaser.Display.Align.In.RightCenter(this.barMidRight,this),Phaser.Display.Align.In.BottomLeft(this.barBottomLeft,this),Phaser.Display.Align.In.BottomCenter(this.barBottomMid,this),Phaser.Display.Align.In.BottomRight(this.barBottomRight,this)}}const{KEY:Qs,FRAME:Mt}=_.DEFAULT;class as extends Phaser.GameObjects.Container{options;leaves;dino;title;ribbon;background;dinoAnimation;constructor(e,t){super(e),this.options=t,this.createBackground(),this.createLeaves(),this.createDino(),this.createRibbon(),this.createTitle(),this.setDepth(z.LOGO),this.runAnimations(),this.scene.add.existing(this)}isDinoSad(e){this.dino.setFrame(e?Mt.DINO_SAD:Mt.DINO)}setTitle(e){this.title.setText(e)}changeRibbon(e,t,s){this.ribbon.setFrame(e),this.ribbon.setWorldSize(t,s)}changeBackground(e,t,s){this.background.setFrame(e),this.background.setWorldSize(t,s)}createBackground(){this.background=this.scene.make.image({key:Qs,frame:Mt.EGGS}),this.background.setY(-20),this.background.setWorldSize(278.5,82),this.add(this.background)}createLeaves(){this.leaves=this.scene.make.image({key:Qs,frame:Mt.LEAVES}),this.leaves.setY(30),this.leaves.setWorldSize(272,60),this.add(this.leaves)}createDino(){this.dino=this.scene.make.image({key:Qs,frame:Mt.DINO}),this.dino.setY(5),this.dino.setWorldSize(98,94.5),this.add(this.dino)}createRibbon(){this.ribbon=this.scene.make.image({key:Qs,frame:Mt.RIBBON_RED}),this.ribbon.setY(70),this.ribbon.setWorldSize(276.5,68.5),this.add(this.ribbon)}createTitle(){const{title:e,titleSize:t}=this.options,s=t||28;this.title=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(s),text:e,origin:{x:.5,y:.5}}),this.add(this.title),Phaser.Display.Align.In.Center(this.title,this.ribbon,0,-6)}runAnimations(){this.runBackgroundAnimation()}runBackgroundAnimation(){this.dinoAnimation||(this.dinoAnimation=new Jt({targets:[this.background],duration:1400,repeatDelay:200,props:{scale:"+=0.02"}})),this.dinoAnimation.play()}}const{KEY:SE,FRAME:or}=_.DEFAULT;class AE extends GameCore.Screen{popup;dinoTitle;gameOverText;rankingIcon;popupShowUpAnimation;popupFadeOutAnimation;constructor(e,t,s,n){super(e,t,s,n),this.createPopup(),this.createDinoTitle(),this.createPopupContent(),this.setDepth(Be.POPUP),this.setY(-50),this.background.setAlpha(.5)}open=()=>{super.open(),this.updateScore(),this.runOpenAnimation()};closePopup=()=>{this.scene.audio.playSound(H.POPUP_OFF,{volume:.6}),this.runCloseAnimation(),this.popupFadeOutAnimation.next(()=>{this.scene.screen.close(this.name)})};createPopup(){this.popup=new Ye(this.scene,0,0,395,110),this.add(this.popup),Phaser.Display.Align.In.Center(this.popup,this.zone)}createDinoTitle(){this.dinoTitle=new as(this.scene,{title:this.scene.lang.Text.GAME_OVER,titleSize:25}),this.dinoTitle.background.kill(),this.dinoTitle.changeRibbon(or.RIBBON_RED,276.5,68.5),Phaser.Display.Align.In.TopCenter(this.dinoTitle,this.popup,0,78),this.popup.add(this.dinoTitle)}createPopupContent(){this.createGameOverText()}createGameOverText(){this.gameOverText=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(30),text:"0",origin:{x:0,y:.5}}),this.rankingIcon=this.scene.add.image(-15,0,SE,or.ICON_RANKING),this.rankingIcon.setWorldSize(36,36),this.popup.add([this.gameOverText,this.rankingIcon])}updateScore(){const{score:e}=this.scene.registry.get("gameData");this.gameOverText.setText(`${e}`),Phaser.Display.Align.In.Center(this.gameOverText,this.popup,15),Phaser.Display.Align.In.LeftCenter(this.rankingIcon,this.gameOverText,45)}runOpenAnimation(){this.scene.audio.playSound(H.POPUP_SHOW),this.runPopupEntrancesAnimation(0,500)}runCloseAnimation(){this.runPopupExitsAnimation(0,500)}runPopupEntrancesAnimation(e,t){if(!this.popupShowUpAnimation){const{y:s}=this.popup;this.popupShowUpAnimation=new Ve({targets:[this.popup],delay:e,duration:t,props:{y:{start:350,from:350,to:s},alpha:{start:1,from:1,to:1}}})}this.popupShowUpAnimation.play()}runPopupExitsAnimation(e,t){this.popupFadeOutAnimation||(this.popupFadeOutAnimation=new ke({targets:[this.popup],delay:e,duration:t,completeDelay:1e3})),this.popupFadeOutAnimation?.play()}logPageviewOnOpen(){}logPageviewOnClose(){}}const{FRAME:bE}=_.DEFAULT;class TE extends GameCore.Screen{popup;dinoTitle;tutorialText;popupShowUpAnimation;popupFadeOutAnimation;constructor(e,t,s,n){super(e,t,s,n),this.createBackground(),this.createFooterBackground(),this.createPopup(),this.createDinoTitle(),this.createPopupContent(),this.setDepth(Be.POPUP),this.setY(-50),this.background.setAlpha(1)}open=()=>{super.open(),this.runOpenAnimation()};closePopup=()=>{this.scene.audio.playSound(H.POPUP_OFF,{volume:.6}),this.runCloseAnimation(),this.popupFadeOutAnimation.next(()=>{this.scene.screen.close(this.name)})};createBackground(){const e=this.scene.make.image({key:$.GAME_BACKGROUND.KEY,origin:{x:.5,y:.5}});e.setWorldSize(this.zone.width,this.zone.height),this.add(e),Phaser.Display.Align.In.Center(e,this.zone)}createFooterBackground(){const e=this.scene,{KEY:t,FRAME:s}=_.GAMEPLAY.GAMEPLAY_TEXTURES,n=e.registry.get("zones").zones,a=e.world.getPixelRatio(),r=e.add.image(0,0,t,s.FOOTER_BG);r.setWorldSize(375,231),r.setOrigin(.5*a,1*a),this.add(r),r.setY(n.zone5.bottomY-this.scene.gameZone.height/2+70)}createPopup(){this.popup=new Ye(this.scene,0,0,395,120),this.add(this.popup),Phaser.Display.Align.In.Center(this.popup,this.zone)}createDinoTitle(){this.dinoTitle=new as(this.scene,{title:"Dinosaur Eggs Pop",titleSize:20}),this.dinoTitle.background.kill(),this.dinoTitle.changeRibbon(bE.RIBBON_RED,276.5,68.5),Phaser.Display.Align.In.TopCenter(this.dinoTitle,this.popup,0,78),this.popup.add(this.dinoTitle)}createPopupContent(){this.createTutorialText()}createTutorialText(){this.tutorialText=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(34),text:this.scene.lang.Text.READY,origin:{x:.5,y:.5}}),Phaser.Display.Align.In.Center(this.tutorialText,this.popup,0,0),this.popup.add(this.tutorialText)}runOpenAnimation(){this.scene.audio.playSound(H.POPUP_SHOW),this.runPopupEntrancesAnimation(0,400)}runCloseAnimation(){this.runPopupExitsAnimation(0,400)}runPopupEntrancesAnimation(e,t){this.background.setAlpha(1),this.popupShowUpAnimation||(this.popupShowUpAnimation=new Ve({targets:[this.popup],delay:e,duration:t,props:{alpha:{from:0,to:1}},onComplete:()=>{this.background.setAlpha(0)}})),this.popupShowUpAnimation.play()}runPopupExitsAnimation(e,t){this.popupFadeOutAnimation||(this.popupFadeOutAnimation=new ke({targets:[this.popup],delay:e,duration:t,props:{alpha:0}})),this.popupFadeOutAnimation?.play()}logPageviewOnOpen(){}logPageviewOnClose(){}}const wE={targets:[],duration:600,ease:Phaser.Math.Easing.Back.Out,props:{y:{from:250,to:0},scale:{from:.9,to:1},alpha:{start:0,from:0,to:1}}};class rs extends pe{constructor(e){super(wE,e)}}const{KEY:cr}=_.DEFAULT;class vs extends Q{options;icon;label;constructor(e,t){super(e,cr,t.framePanel),this.options=t,this.createIcon(),this.createLabel();const{enable:s}=this.options;this.updateStatus(s)}processCallback(e){const{enable:t}=this.options;this.updateStatus(!t),e(!t)}updateStatus(e){this.options.enable=e;const t=this.getFrameByStatus();this.icon.setFrame(t);const s=this.scene.lang;this.label.setText(e?s.Text.ON:s.Text.OFF),this.alignSwitch()}getFrameByStatus=()=>{const{enable:e,frameOn:t,frameOff:s}=this.options;return e?t:s};createIcon(){const e=this.getFrameByStatus();this.icon=this.scene.make.image({key:cr,frame:e}),this.add(this.icon),Phaser.Display.Align.In.Center(this.icon,this.button)}createLabel(){const e=this.scene.lang.getCurrentLanguage();this.label=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(e==="ru"?12:14)}),this.add(this.label)}alignSwitch(){const{enable:e}=this.options,t=this.scene.lang.getCurrentLanguage();if(e){const s=t==="ru"?-13:-10;this.icon.setOrigin(1,.5),Phaser.Display.Align.In.RightCenter(this.icon,this.button),Phaser.Display.Align.In.LeftCenter(this.label,this.button,s,1)}else{const s=t==="ru"?-7:-13;this.icon.setOrigin(0,.5),Phaser.Display.Align.In.LeftCenter(this.icon,this.button),Phaser.Display.Align.In.RightCenter(this.label,this.button,s,1)}}logButtonEvent(){const e=this.getParentName(),t=this.name,s=!this.options.enable;this.scene.analytics.event(V.BUTTON_CLICK,{button_name:t,screen_name:e,enable:s})}}const{KEY:qe,FRAME:fe}=_.DEFAULT;class CE extends GameCore.Screen{scene;popup;line;title;continueButton;homeButton;settingMusic;settingSound;contents;popupShowUpAnimation;popupFadeOutAnimation;contentShowUpAnimation;isButtonReleased=!1;constructor(e,t,s,n){super(e,t,s,n),this.scene=e,this.createPopup(),this.createCloseButton(),this.createPopupContent(),this.createInput(),this.setDepth(Be.POPUP),this.background.setAlpha(.6)}open=()=>{super.open();const{player:e}=this.scene,t=e.getPlayerSettings(),{music:s,sound:n}=t;this.settingMusic.updateStatus(s),this.settingSound.updateStatus(n),this.runOpenAnimation()};createInput(){this.continueButton.onClick=this.handleClosePopup,this.homeButton.onClick=this.handleGotoDashboard,this.settingMusic.onClick=this.handleMusicSetting,this.settingSound.onClick=this.handleSoundSetting}handleClosePopup=()=>{this.scene.audio.playSound(H.POPUP_OFF,{volume:.6}),this.runCloseAnimation(),this.popupFadeOutAnimation.next(()=>{this.scene.screen.close(this.name),this.scene.stateManager.play()})};handleGotoDashboard=()=>{this.isButtonReleased||(this.isButtonReleased=!0,this.runCloseAnimation(),this.popupFadeOutAnimation.next(()=>{if(this.scene instanceof da){const e=this.scene.registry.get("log_level"),{score:t}=this.scene.registry.get("gameData");this.scene.player.updateBestScore(t),this.scene.analytics.levelFail(e)}this.scene.tweens.getTweensOf(this.homeButton).forEach(e=>e.complete()),this.isButtonReleased=!1,this.scene.screen.close(this.name),this.scene.scene.switch(j.DASHBOARD_SCENE)}))};handleMusicSetting=e=>{this.scene.player.setSetting("music",e),e?this.scene.audio.playMusic():this.scene.audio.pauseMusic()};handleSoundSetting=e=>{this.scene.player.setSetting("sound",e)};createCloseButton(){const e=new Qt(this.scene,{key:qe,frame:fe.BUTTON_CLOSE,width:48.5,height:43,paddingZone:20});this.popup.add(e),e.setName("Close"),e.useSound=!1,e.onClick=this.handleClosePopup,Phaser.Display.Align.In.TopRight(e,this.popup,25,25)}createPopup(){this.popup=new Ye(this.scene,0,0,310,340),this.add(this.popup),Phaser.Display.Align.In.Center(this.popup,this.zone)}createPopupContent(){this.createTitle(),this.createMenuButtons(),this.createLine(),this.createFooterButtons(),this.popup.add([this.line,this.title,this.continueButton,this.homeButton]),this.contents=this.scene.make.group({}),this.contents.addMultiple([this.continueButton,this.homeButton])}createTitle(){this.title=this.scene.add.container();const e=this.scene.make.image({key:qe,frame:fe.RIBBON_VIOLET});e.setWorldSize(225,65.5);const t=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(24),text:this.scene.lang.Text.SETTINGS,origin:{x:.5,y:.5}});Phaser.Display.Align.In.Center(t,e,0,-2),this.title.add([e,t]),Phaser.Display.Align.In.TopCenter(this.title,this.popup)}createMenuButtons(){this.createContinueButton(),this.createHomeButton()}createContinueButton(){this.continueButton=new Q(this.scene,qe,fe.BUTTON_GREEN,134,68);const e=this.scene.lang.getCurrentLanguage(),t=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(e==="ru"?13:18),text:this.scene.lang.Text.CONTINUE}),s=this.scene.make.image({key:qe,frame:fe.ICON_CONTINUE});s.setWorldSize(21,25),this.continueButton.setName("Continue"),this.continueButton.add([t,s]);const n=s.width+4+t.width+4;Phaser.Display.Align.In.Center(s,this.continueButton,(-n+s.width)/2,-3),Phaser.Display.Align.To.RightCenter(t,s,4,1),Phaser.Display.Align.In.Center(this.continueButton,this.popup,0,-90)}createHomeButton(){this.homeButton=new Q(this.scene,qe,fe.BUTTON_YELLOW,134,68);const e=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(20),text:this.scene.lang.Text.HOME}),t=this.scene.make.image({key:qe,frame:fe.ICON_HOME});t.setWorldSize(31,26),this.homeButton.setName("Home"),this.homeButton.add([e,t]);const s=t.width+4+e.width+4;Phaser.Display.Align.In.Center(t,this.homeButton,(-s+t.width)/2,-2),Phaser.Display.Align.To.RightCenter(e,t,4,2),Phaser.Display.Align.To.BottomCenter(this.homeButton,this.continueButton,0,-2)}createLine(){this.line=this.scene.make.image({key:qe,frame:fe.LINE_HOR}),this.line.setWorldSize(198.5,3),Phaser.Display.Align.In.Center(this.line,this.homeButton,0,50)}createFooterButtons(){const e=this.scene.player.getPlayerSettings(),{sound:t,music:s}=e;this.createMusicButton(s),this.createSoundButton(t)}createMusicButton(e){const t=this.scene.make.container({});this.settingMusic=new vs(this.scene,{enable:e,frameOn:fe.SWITCH_ON,frameOff:fe.SWITCH_OFF,framePanel:fe.SWITCH_PANEL}),this.settingMusic.setName("Music"),this.settingMusic.setPosition(60,0),this.settingMusic.icon.setWorldSize(25.5,24),this.settingMusic.button.setWorldSize(67.5,26);const s=this.scene.make.image({key:qe,frame:fe.ICON_MUSIC});s.setPosition(-85,0),s.setWorldSize(34,37.5);const n=this.scene.lang.getCurrentLanguage(),a=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(n==="ru"?15:20),text:this.scene.lang.Text.MUSIC,alpha:.8});a.setPosition(-50,-8),t.add([s,a,this.settingMusic]),this.popup.add(t),t.setPosition(0,65)}createSoundButton(e){const t=this.scene.make.container({});this.settingSound=new vs(this.scene,{enable:e,frameOn:fe.SWITCH_ON,frameOff:fe.SWITCH_OFF,framePanel:fe.SWITCH_PANEL}),this.settingSound.setName("Sound"),this.settingSound.setPosition(60,0),this.settingSound.icon.setWorldSize(25.5,24),this.settingSound.button.setWorldSize(67.5,26);const s=this.scene.make.image({key:qe,frame:fe.ICON_SOUND});s.setPosition(-85,0),s.setWorldSize(30.5,37.5);const n=this.scene.lang.getCurrentLanguage(),a=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(n==="ru"?15:20),text:this.scene.lang.Text.SOUND,alpha:.8});a.setPosition(-50,-8),t.add([s,a,this.settingSound]),this.popup.add(t),t.setPosition(0,125)}runOpenAnimation(){this.scene.audio.playSound(H.POPUP_SHOW),this.runPopupEntrancesAnimation(0,300),this.runPopupContentEntrancesAnimation(200,300)}runCloseAnimation(){this.runPopupExitsAnimation(0,200)}runPopupEntrancesAnimation(e,t){if(!this.popupShowUpAnimation){const{y:s,scale:n}=this.popup;this.popupShowUpAnimation=new rs({targets:[this.popup],delay:e,duration:t,props:{y:{from:350,to:s},alpha:{start:1,from:1,to:1},scale:{start:0,from:0,to:n}}})}this.popupShowUpAnimation.play()}runPopupContentEntrancesAnimation(e,t){this.contentShowUpAnimation||(this.contentShowUpAnimation=new zs({targets:this.contents.getChildren(),duration:t,delay:this.scene.tweens.stagger(80,{start:e}),props:{alpha:{start:0,from:0,to:1}}})),this.contentShowUpAnimation.play()}runPopupExitsAnimation(e,t){this.popupFadeOutAnimation||(this.popupFadeOutAnimation=new ke({targets:[this.popup],delay:e,duration:t,props:{y:250,scale:0},onComplete:()=>{this.popup.setY(0)}})),this.popupFadeOutAnimation?.play()}}const IE={targets:[],duration:400,ease:ta,props:{scale:"+=0.1"}};class Ns extends pe{constructor(e){super(IE,e)}}const PE={targets:[],duration:600,ease:Phaser.Math.Easing.Back.Out,props:{}};class vE extends pe{constructor(e){super(PE,e)}}const{KEY:OE,FRAME:_E}=_.DEFAULT;class RE extends GameCore.Screen{coinsText;contentHolder;popupShowUpAnimation;popupFadeOutAnimation;constructor(e,t,s,n){super(e,t,s,n),this.createTexts(),this.setDepth(Be.PRIORITY),this.setY(-50),this.updateBackground(),this.setInteractiveZone()}setInteractiveZone(){this.zone.setInteractive({useHandCursor:!0}),this.zone.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.handleClose)}updateBackground(){this.background.setAlpha(.7)}createTexts(){this.contentHolder=new Phaser.GameObjects.Container(this.scene,0,0);const e=this.scene.make.bitmapText({size:this.scene.fontSize(26),text:`you don't have 
 enough coins`,font:B.PRIMARY.KEY,origin:{x:.5,y:.5}}),t=this.scene.make.bitmapText({size:this.scene.fontSize(26),text:"you have:",font:B.PRIMARY.KEY,origin:{x:.5,y:.5}});t.setTint(13467442);const s=this.scene.make.image({key:OE,frame:_E.ICON_COIN});s.setWorldSize(26,26),this.coinsText=this.scene.make.bitmapText({size:this.scene.fontSize(26),text:"0",font:B.PRIMARY.KEY,origin:{x:0,y:.5}}),this.coinsText.setTint(16766720),this.contentHolder.add([t,s,this.coinsText,e]),this.add(this.contentHolder),Phaser.Display.Align.In.Center(t,this.zone,-40,40),Phaser.Display.Align.In.Center(s,t,77),Phaser.Display.Align.In.Center(this.coinsText,s,20),Phaser.Display.Align.In.Center(e,this,0,-40)}runCloseAnimation(){this.popupFadeOutAnimation?.tween?.isPlaying()||(this.scene.audio.playSound(H.POPUP_OFF,{volume:.6}),this.runPopupExitsAnimation(0,200))}runOpenAnimation(){this.popupShowUpAnimation?.tween?.isPlaying()||(this.scene.audio.playSound(H.POPUP_SHOW),this.runPopupEntrancesAnimation(0,400))}open=e=>{super.open(),this.updateInteractive(e.isWatchAdsButtonClicked),this.updateCoinsNumber(e),this.runOpenAnimation()};updateInteractive(e){this.zone.disableInteractive(),!e&&this.scene.time.delayedCall(500,()=>{this.zone.setInteractive()})}updateCoinsNumber(e){const{coins:t}=e;typeof t=="number"&&t!==null?this.coinsText.setText(`${t}`):this.coinsText.setText("0")}handleClose=()=>{this.runCloseAnimation()};runPopupEntrancesAnimation(e,t){if(!this.popupShowUpAnimation){const{scale:s}=this;this.popupShowUpAnimation=new rs({targets:[this.contentHolder],delay:e,duration:t,props:{y:{from:350,to:this.contentHolder.y},scale:{start:0,from:0,to:s}}})}this.popupShowUpAnimation.play()}runPopupExitsAnimation(e,t){this.popupFadeOutAnimation||(this.popupFadeOutAnimation=new ke({targets:[this.contentHolder],delay:e,duration:t,props:{y:250,scale:0},onComplete:()=>{this.scene.screen.close(this.name)}})),this.popupFadeOutAnimation.play()}}class Rl extends GameCore.Screen{loadingIcon;messageText;closeTimerEvent;constructor(e,t,s,n){super(e,t,s,n),this.addLoadingIcon(),this.addMessageText(),this.setDepth(Be.PRIORITY),this.background.setAlpha(.8)}open(e){super.open(e);const[t="",s=0,n=!1]=this.getData(["message","duration","loading"]);this.setMessage(t),this.showLoading(n),this.closeTimerEvent?.remove(),s>0&&(this.closeTimerEvent=this.scene.time.addEvent({delay:s,callback:()=>{this.visible&&this.scene.screen.close(this.name)}}))}addLoadingIcon(){this.loadingIcon=new Rt(this.scene),this.add(this.loadingIcon),Phaser.Display.Align.In.Center(this.loadingIcon,this.zone)}addMessageText(){this.messageText=this.scene.make.bitmapText({size:this.scene.fontSize(28),font:B.PRIMARY.KEY,origin:{x:.5,y:.5}}),this.messageText.setCenterAlign(),this.add(this.messageText)}setMessage(e){this.messageText.setText(e)}showLoading(e){e?this.loadingIcon.revive():this.loadingIcon.kill();const t=e===!1?20:80;Phaser.Display.Align.In.Center(this.messageText,this.zone,-5,t)}logPageviewOnOpen(){}logPageviewOnClose(){}}const{KEY:Lt,FRAME:ps}=_.DEFAULT,{Gameplay:lr}=GameCore.Configs;class xE extends GameCore.Screen{scene;isSuccessfulRescue;isFailedRescue=!1;isClosed=!0;currentScoreText;currentScoreLabel;rescueTimeBar;rescueTimeBarBg;countdownCount;countdownTimer;skipButton;watchAdsButton;useCoinButton;coinsNeeded;isWatchAdsButtonClicked=!1;isUseCoinButtonClicked=!1;buttonsPulsateAnimation;buttonFadeOutAnimation;buttonSlideToAnimation;skipButtonFadeInAnimation;scaleUpAnimation;notifyScreen;notEnoughCoinScreen;constructor(e,t,s,n){super(e,t,s,n),this.scene=e,this.countdownCount=lr.MaxRescueCount,this.coinsNeeded=this.scene.registry.get("rescueCoins"),this.setDepth(Be.POPUP),this.background.setAlpha(.8),this.createContent()}open=()=>{super.open(),this.scene.storage.dispatch(FA()),this.getNotifyScreen(),this.isClosed=!1,this.isSuccessfulRescue=!1,this.isFailedRescue=!1,this.countdownCount=lr.RescueGamePopupTimeout,this.rescueTimeBar.revive(),this.rescueTimeBarBg.revive(),this.updateButtonsState(),this.updateScoreTexts(),this.runCountdown(),this.runButtonsPulsateAnimation(),this.runSkipButtonFadeInAnimation(),this.scene.audio.playSound(H.POPUP_SHOW)};getNotifyScreen(){const{globalScene:e}=this.scene.game;if(!this.notifyScreen){const t=e.screen.get(L.NOTIFY_SCREEN);t instanceof Rl&&(this.notifyScreen=t)}}updateButtonsState(){this.watchAdsButton.revive(),this.watchAdsButton.setAlpha(1),this.watchAdsButton.setDisabled(!1),this.isWatchAdsButtonClicked=!1;const{player:e}=this.scene;e.getCustomData("coin")>=this.coinsNeeded?(this.useCoinButton.revive(),this.useCoinButton.setAlpha(1),this.useCoinButton.setDisabled(!1),this.isUseCoinButtonClicked=!1,Phaser.Display.Align.In.LeftCenter(this.watchAdsButton,this.zone,-45,120),Phaser.Display.Align.In.RightCenter(this.useCoinButton,this.zone,-45,120)):(this.useCoinButton.kill(),Phaser.Display.Align.In.Center(this.watchAdsButton,this.zone,0,120)),Phaser.Display.Align.In.BottomCenter(this.skipButton,this.zone,0,-100)}handleShowRewardedAd=async()=>{if(this.isWatchAdsButtonClicked||this.isFailedRescue)return;this.isWatchAdsButtonClicked=!0,this.watchAdsButton.setDisabled(!0),this.useCoinButton.setDisabled(!0);const{globalScene:e}=this.scene.game;try{this.countdownTimer.pause(),this.scene.audio.pauseMusic(),this.scene.audio.muteAll(),e.screen.open(L.NOTIFY_SCREEN,{message:this.scene.lang.Text.LOADING_ADS,duration:0,loading:!0}),await this.scene.ads.showRewardedVideoAsync(),e.screen.close(L.NOTIFY_SCREEN),this.handleSuccessfulRescue()}catch(t){if(t instanceof Object&&GameCore.Utils.Object.hasOwn(t,"code")&&t.code==="USER_INPUT"){this.showNotifySkipAd();return}this.showNotifyNoAd()}finally{this.scene.audio.unmuteAll(),this.scene.audio.playMusic(),this.scene.ads.preloadRewardedVideoAsync().catch(t=>console.log(t))}};showNotifyNoAd=e=>{if(e&&e.name!==L.NOTIFY_SCREEN)return;const{globalScene:t}=this.scene.game;t.screen.open(L.NOTIFY_SCREEN,{message:this.scene.lang.Text.NO_ADS,duration:2e3,loading:!1}),this.handleFailedAd()};handleFailedAd=()=>{const{player:e}=window.game,t=e.getCustomData("coin");this.isUseCoinButtonClicked||t<this.coinsNeeded?(this.notifyScreen.once(GameCore.Screens.Events.CLOSE,this.handleFailedRescue),this.isClosed=!0,this.scene.screen.close(this.name)):this.notifyScreen.once(GameCore.Screens.Events.CLOSE,()=>{this.countdownTimer?.resume(),this.runButtonEntranceAnimation(this.watchAdsButton,this.useCoinButton,!0),this.scaleUpAnimation?.tween?.on(Phaser.Tweens.Events.TWEEN_COMPLETE,()=>{this.useCoinButton.setDisabled(!1)})})};showNotifyInsufficientCoins=e=>{this.countdownTimer?.pause(),this.isWatchAdsButtonClicked?(this.notEnoughCoinScreen.once(GameCore.Screens.Events.CLOSE,this.handleFailedRescue),this.scene.screen.open(L.NOT_ENOUGH_COINS_SCREEN,{coins:e,isWatchAdsButtonClicked:this.isWatchAdsButtonClicked}),this.scene.time.delayedCall(2e3,()=>{this.scene.screen.close(L.NOT_ENOUGH_COINS_SCREEN)}),this.isClosed=!0,this.scene.screen.close(this.name)):(this.notEnoughCoinScreen.once(GameCore.Screens.Events.CLOSE,this.handleCloseNotifyInsufficientCoins),this.scene.screen.open(L.NOT_ENOUGH_COINS_SCREEN,{coins:e,isWatchAdsButtonClicked:this.isWatchAdsButtonClicked}))};handleCloseNotifyInsufficientCoins=()=>{this.countdownTimer?.resume(),this.runButtonEntranceAnimation(this.useCoinButton,this.watchAdsButton,!1),this.scaleUpAnimation?.tween?.on(Phaser.Tweens.Events.TWEEN_COMPLETE,()=>{this.watchAdsButton.setDisabled(!1)})};showNotifySkipAd=()=>{const{globalScene:e}=this.scene.game;e.screen.open(L.NOTIFY_SCREEN,{message:this.scene.lang.Text.SORRY_NO_REWARDS,duration:2e3,loading:!1}),this.handleFailedAd()};handleFailedRescue=()=>{this.isFailedRescue||(this.isFailedRescue=!0,this.skipButton.kill(),this.countdownTimer.remove(),this.isClosed||(this.isClosed=!0,this.scene.screen.close(this.name)),this.scene.stateManager.gameOver())};closePopupSafely=()=>{this.isFailedRescue=!0,this.skipButton.kill(),this.countdownTimer.remove(),this.isClosed||(this.isClosed=!0,this.scene.screen.close(this.name))};handleSuccessfulRescue=()=>{this.isSuccessfulRescue||(this.countdownTimer?.remove(),this.isSuccessfulRescue=!0,this.scene.audio.playSound(H.DAILY_REWARD),this.scene.screen.close(this.name),this.scene.stateManager.play())};createContent(){this.createCloseButton(),this.createViewText(),this.createScoreTexts(),this.createCountdown(),this.createWatchAdsButton(),this.createUseCoinButton(),this.createNotEnoughCoinsScreen(),this.createSkipButton()}createRescueTimeBar(){this.rescueTimeBar=this.scene.add.graphics(),this.rescueTimeBarBg=this.scene.add.graphics(),this.add(this.rescueTimeBarBg),this.add(this.rescueTimeBar),this.rescueTimeBar.lineStyle(8,124248),this.rescueTimeBarBg.lineStyle(8,0),this.rescueTimeBarBg.arc(1,-15,65,0,2*Math.PI,!0),this.rescueTimeBarBg.strokePath()}createCountdown(){this.createRescueTimeBar()}runCountdown(){this.countdownTimer?.remove(),this.rescueTimeBar.beginPath(),this.countdownTimer=this.scene.tweens.addCounter({from:0,to:this.countdownCount,duration:this.countdownCount*1e3,onUpdate:e=>{if(this.rescueTimeBar.clear(),this.rescueTimeBar.lineStyle(8,124248),e.progress===1)return;const t=e.progress*2*Math.PI-Math.PI/2;this.rescueTimeBar.arc(1,-15,65,-Math.PI/2,t,!0),this.rescueTimeBar.strokePath()},onComplete:()=>{this.rescueTimeBar.clear(),this.rescueTimeBar.kill(),this.rescueTimeout()}})}createCloseButton(){const e=new Qt(this.scene,{key:Lt,frame:ps.BUTTON_CLOSE,width:48.5,height:43,paddingZone:20});this.add(e),e.setName("Close"),e.useSound=!1,e.onClick=this.handleFailedRescue,e.kill(),Phaser.Display.Align.In.TopRight(e,this.zone,-15,-15)}createNotEnoughCoinsScreen(){this.notEnoughCoinScreen=this.scene.screen.add(L.NOT_ENOUGH_COINS_SCREEN,RE)}handleRescueUsingCoin=()=>{if(this.isUseCoinButtonClicked||this.isFailedRescue)return;this.isUseCoinButtonClicked=!0,this.useCoinButton.setDisabled(!0),this.watchAdsButton.setDisabled(!0);const{player:e}=this.scene,t=e.getCustomData("coin"),s=t-this.coinsNeeded;if(t<this.coinsNeeded){this.showNotifyInsufficientCoins(t);return}this.countdownTimer.remove(),this.scene.time.delayedCall(500,()=>{e.setCustomData("coin",s),this.handleSuccessfulRescue()})};createUseCoinButton(){this.useCoinButton=new Q(this.scene,Lt,ps.BUTTON_BLUE,126,65),this.useCoinButton.setName("UseCoin");const e=this.scene.make.image({key:Lt,frame:ps.ICON_COIN});e.setWorldSize(30,30);const t=this.scene.make.bitmapText({size:this.scene.fontSize(21),text:`${this.coinsNeeded}`,font:B.PRIMARY.KEY,origin:{x:.5,y:.5}});this.add(this.useCoinButton),this.useCoinButton.add([t,e]),Phaser.Display.Align.In.Center(t,this.useCoinButton,15,-2),Phaser.Display.Align.In.Center(e,this.useCoinButton,-28,-3),this.useCoinButton.onClick=this.handleRescueUsingCoin}createWatchAdsButton(){this.watchAdsButton=new Q(this.scene,Lt,ps.BUTTON_GREEN,145,75),this.watchAdsButton.setName("ViewAd");const e=this.scene.lang.getCurrentLanguage(),t=this.scene.make.bitmapText({size:this.scene.fontSize(e==="ru"?12:15),text:this.scene.lang.Text.CONTINUE,font:B.PRIMARY.KEY,origin:{x:.5,y:.5}});t.setCenterAlign();const s=this.scene.make.image({key:Lt,frame:ps.ICON_ADS_VIDEO});s.setWorldSize(36,28),this.watchAdsButton.add([t,s]),this.add(this.watchAdsButton),Phaser.Display.Align.In.Center(t,this.watchAdsButton,19,-2),Phaser.Display.Align.In.Center(s,this.watchAdsButton,-38,-1),this.watchAdsButton.onClick=this.handleShowRewardedAd}createSkipButton(){const e=this.scene.lang.getCurrentLanguage(),t=e==="ru"?130.5:97.5,s=e==="ru"?20.5:21.5;this.skipButton=new Q(this.scene,Lt,this.scene.lang.Texture.NO_THANKS,t,s),this.skipButton.setName("NoThanks"),this.skipButton.kill(),this.add(this.skipButton),this.skipButton.onClick=this.handleFailedRescue,Phaser.Display.Align.In.Center(this.skipButton,this.useCoinButton,-80,70)}createScoreTexts(){this.currentScoreLabel=this.scene.make.bitmapText({size:this.scene.fontSize(30),text:this.scene.lang.Text.YOUR_SCORE,font:B.PRIMARY.KEY}),this.currentScoreText=this.scene.make.bitmapText({size:this.scene.fontSize(48),text:"0",font:B.PRIMARY.KEY,origin:{x:.55,y:.5}}),this.currentScoreText.setTint(16766720),this.add([this.currentScoreLabel,this.currentScoreText]),Phaser.Display.Align.In.TopCenter(this.currentScoreLabel,this,-4,-130),Phaser.Display.Align.In.TopCenter(this.currentScoreText,this.zone,-5,-165)}updateScoreTexts(){const{storage:e,player:t}=window.game,s=e.getState(),n=el(s);n===Wt?this.updateOnlineModeScoreText(t,s):n===Ce?this.updateChallengeFriendModeScoreText(t,s):n===De?this.updateSingleModeScoreTexts(t,s):this.updateSingleModeScoreTexts(t,s)}updateSingleModeScoreTexts(e,t){this.currentScoreLabel.setText(this.scene.lang.Text.YOUR_SCORE);const{score:s}=et(t);this.currentScoreText.setText(`${s}`),Phaser.Display.Align.In.TopCenter(this.currentScoreText,this.zone,-5,-165)}updateOnlineModeScoreText(e,t){const s=_t(t);this.currentScoreLabel.setText(this.scene.lang.Text.YOUR_RANK);const n=e.getPlayerId();if(!GameCore.Utils.Object.hasOwn(s,n))return;const{rank:a}=s[n];this.currentScoreText.setText(`${a}`),Phaser.Display.Align.In.TopCenter(this.currentScoreText,this.zone,0,-165)}updateChallengeFriendModeScoreText(e,t){this.currentScoreLabel.setText(this.scene.lang.Text.YOUR_SCORE);const{score:s}=et(t);this.currentScoreText.setText(`${s}`),Phaser.Display.Align.In.TopCenter(this.currentScoreText,this.zone,-5,-165)}createViewText(){const e=this.scene.make.bitmapText({size:this.scene.fontSize(23),text:this.scene.lang.Text.SECOND_CHANCE,font:B.PRIMARY.KEY});e.setCenterAlign(),this.add(e),Phaser.Display.Align.In.Center(e,this.zone,0,-15)}rescueTimeout(){this.watchAdsButton.setDisabled(!0),this.useCoinButton.setDisabled(!0),this.handleFailedRescue()}runButtonEntranceAnimation=(e,t,s)=>{this.scaleUpAnimation?.remove(),this.buttonFadeOutAnimation?.remove(),this.buttonSlideToAnimation?.remove(),this.scaleUpAnimation=new Ns({targets:[t],onComplete:()=>{s?this.scene.game.globalScene.screen.events.off(GameCore.Screens.Events.CLOSE,this.runButtonEntranceAnimation):this.scene.screen.events.off(GameCore.Screens.Events.CLOSE,this.runButtonEntranceAnimation)}}),this.buttonFadeOutAnimation=new ke({targets:[e],props:{alpha:{start:1,from:1,to:0}},onComplete:()=>e.kill()}),this.buttonSlideToAnimation=new vE({targets:[t],props:{x:{from:t.x,to:this.zone.x}},onComplete:()=>this.scaleUpAnimation?.play()}),this.buttonFadeOutAnimation?.play(),this.buttonSlideToAnimation?.play()};runButtonsPulsateAnimation(){this.buttonsPulsateAnimation||(this.buttonsPulsateAnimation=new Jt({targets:[this.watchAdsButton,this.useCoinButton],props:{scale:"-=0.02"}})),this.buttonsPulsateAnimation?.play()}runSkipButtonFadeInAnimation(){this.skipButtonFadeInAnimation||(this.skipButtonFadeInAnimation=new Ve({targets:[this.skipButton],delay:2e3,props:{alpha:{start:0,from:0,to:1}}})),this.skipButton.revive(),this.skipButtonFadeInAnimation?.play()}getTotalUseRescue(){return+this.isSuccessfulRescue}}const{KEY:hr,FRAME:DE}=_.GAMEPLAY.GAMEPLAY_TEXTURES;class BE extends Phaser.Animations.Animation{constructor(e){const t={frameRate:12,repeat:1,frames:e.generateFrameNames(hr,{prefix:DE.DINO,start:0,end:1})};super(e,hr,t)}}const{KEY:ur,FRAME:kE}=_.GAMEPLAY.GAMEPLAY_TEXTURES;class NE extends Phaser.Animations.Animation{constructor(e){const t={frameRate:6,frames:e.generateFrameNames(ur,{prefix:kE.DINO,start:1,end:3}),repeat:1};super(e,ur,t)}}const{KEY:dr,FRAME:ME}=_.GAMEPLAY.GAMEPLAY_TEXTURES;class LE extends Phaser.Animations.Animation{constructor(e){const t={frameRate:12,frames:e.generateFrameNames(dr,{prefix:ME.EGG_EXPLOSIVE,end:8,zeroPad:2}),showOnStart:!0,hideOnComplete:!0};super(e,dr,t)}}const{KEY:en,FRAME:pr}=_.GAMEPLAY.GAMEPLAY_TEXTURES;class GE extends Phaser.Animations.Animation{constructor(e){const t={repeat:1,frameRate:8,frames:[{key:en,frame:pr.OWL_CLOSE},{key:en,frame:pr.OWL}]};super(e,en,t)}}const{KEY:gr,FRAME:FE}=_.GAMEPLAY.GAMEPLAY_TEXTURES;class UE extends Phaser.Animations.Animation{constructor(e){const t={frameRate:6,frames:e.generateFrameNames(gr,{prefix:FE.SHOWING_BOMB,start:1,end:4}),showOnStart:!0,hideOnComplete:!0};super(e,gr,t)}}class YE{scene;constructor(e){this.scene=e,this.addGlobalAnims()}addGlobalAnims(){const e=this.scene.anims,t=new LE(e);e.add("egg-explosive",t);const s=new BE(e);e.add("dino-blinking",s);const n=new NE(e);e.add("dino-happy",n);const a=new GE(e);e.add("owl-blinking",a);const r=new UE(e);e.add("showing-bomb-effect",r)}}const{KEY:HE,FRAME:zE}=_.DEFAULT;class WE extends Phaser.GameObjects.Container{hand;handScaleDefault=1;constructor(e){super(e),this.name="TutorialHand",this.addHand(),this.hand.scale,this.scene.add.existing(this)}addHand(){this.hand=this.scene.make.image({key:HE,frame:zE.ICON_HAND,origin:{x:.5,y:.5}}),this.hand.setWorldSize(65.5,55.5),this.handScaleDefault=this.hand.scale,this.hand.setPosition(20,20),this.add(this.hand)}tap(e,t,s){this.scene.tweens.add({delay:e,targets:[this.hand],ease:Phaser.Math.Easing.Cubic.Out,props:{scale:{duration:150,from:this.handScaleDefault,to:this.handScaleDefault*.8},angle:{from:0,value:-10,duration:150}},yoyo:!0,onComplete:()=>{t&&this.hide(),s&&s()}})}doubleTap(e,t,s){this.scene.tweens.add({delay:e,targets:[this.hand],ease:Phaser.Math.Easing.Cubic.In,props:{scale:{duration:100,from:this.handScaleDefault,to:this.handScaleDefault*.8},angle:{from:0,value:-10,duration:100}},loop:1,yoyo:!0,onComplete:()=>{t&&this.hide(),s&&s()}})}move(e,t,s,n,a){this.scene.tweens.add({delay:s,targets:[this.hand],ease:Phaser.Math.Easing.Cubic.Out,props:{x:{duration:n,from:this.x,to:e},y:{duration:n,from:this.y,to:t}},onComplete:a})}tapAndHold(e,t){this.scene.tweens.add({delay:e,targets:[this.hand],ease:Phaser.Math.Easing.Cubic.Out,props:{scale:{duration:200,from:this.handScaleDefault,to:this.handScaleDefault*.8},angle:{from:0,value:-10,duration:200}},onComplete:t})}unHold(e,t,s){this.scene.tweens.add({delay:e,targets:[this.hand],ease:Phaser.Math.Easing.Cubic.Out,props:{scale:{duration:200,from:this.handScaleDefault*.8,to:this.handScaleDefault},angle:{from:-10,value:0,duration:200}},onComplete:()=>{t&&this.hide(),s&&s()}})}show(){this.hand.setVisible(!0)}hide(){this.hand.setVisible(!1)}preDestroy(){this.scene.tweens.killTweensOf(this.hand)}}const{KEY:gs,FRAME:Ze}=_.GAMEPLAY.GAME_OBJECTS;class VE extends GameCore.Screen{popup;redEggGroup;blueEggGroup;shotGuideGroup;middleShotGuide;lastShotGuide;shooter;bullet;nextBullet;nextNextBullet;tutorialHand;shooterPosition;bulletPosition;nextBulletPosition;shotGuideDirect;guideSpace;understoodButton;tutorialText;popupShowUpAnimation;popupFadeOutAnimation;nextBulletScale=.75;constructor(e,t,s,n){super(e,t,s,n),this.createPopup(),this.createPopupContent(),this.createUnderstoodButton(),this.setDepth(Be.POPUP),this.setY(-50),this.background.setAlpha(.4)}open=()=>{super.open(),this.runOpenAnimation(),this.animateShotGuideToShootBlueEggs(),this.scene.analytics.event(V.TUTORIAL_STEP,{step:"UseShooter"})};closePopup=()=>{this.scene.audio.playSound(H.POPUP_OFF,{volume:.6}),this.runCloseAnimation(),this.popupFadeOutAnimation.next(()=>{this.scene.screen.close(this.name)})};createPopup(){this.popup=new Ye(this.scene,0,0,300,400),this.add(this.popup),Phaser.Display.Align.In.Center(this.popup,this.zone)}createPopupContent(){this.createTutorialText(),this.configGuide(),this.createGrid(),this.createShotGuide(),this.createShooter(),this.createBullet(),this.createHandGuide()}createTutorialText(){const e=this.scene.lang.getCurrentLanguage();this.tutorialText=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(e==="ru"?17:20),text:this.scene.lang.Text.COLOR_POP,origin:{x:.5,y:.5}}),this.tutorialText.setCenterAlign(),Phaser.Display.Align.In.TopCenter(this.tutorialText,this.popup,0,-20),this.popup.add(this.tutorialText)}configGuide(){this.shotGuideDirect=new Phaser.Math.Vector2(0,-1),this.shotGuideDirect.setAngle((270+20)*Math.PI/180),this.guideSpace=21,this.shooterPosition=new Phaser.Geom.Point(0,80),this.bulletPosition=new Phaser.Geom.Point(this.shooterPosition.x,this.shooterPosition.y-32),this.nextBulletPosition=new Phaser.Geom.Point(this.shooterPosition.x+22.5,this.shooterPosition.y+22.5)}createGrid(){const{KEY:e,FRAME:t}=_.GAMEPLAY.GAME_OBJECTS;this.redEggGroup=this.scene.add.group({defaultKey:e,defaultFrame:t.BALL_RED});const s=-80;for(let n=0;n<4;n++)this.redEggGroup.get().setWorldSize(31,32);this.redEggGroup.setXY(-48,-28+s,32),this.popup.add(this.redEggGroup.getChildren()),this.blueEggGroup=this.scene.add.group({defaultKey:e,defaultFrame:t.BALL_BLUE});for(let n=0;n<3;n++)this.blueEggGroup.get().setWorldSize(31,32);this.blueEggGroup.setXY(-32,s,32),this.popup.add(this.blueEggGroup.getChildren())}createShotGuide(){this.shotGuideGroup=this.scene.add.group({defaultKey:gs,defaultFrame:Ze.SHOT_GUIDE});for(let e=0;e<6;e++)e===4?(this.middleShotGuide=this.shotGuideGroup.get(),this.middleShotGuide.setWorldSize(10,10)):this.shotGuideGroup.get().setWorldSize(10,10);this.lastShotGuide=this.shotGuideGroup.get(),this.lastShotGuide.setVisible(!1).setWorldSize(10,10),this.shotGuideGroup.setXY(0,84,this.shotGuideDirect.x*this.guideSpace,this.shotGuideDirect.y*this.guideSpace),this.popup.add(this.shotGuideGroup.getChildren())}createShooter(){const{x:e,y:t}=this.shooterPosition;this.shooter=this.scene.add.image(e,t,gs,Ze.SHOOTER),this.shooter.setWorldSize(100,100),this.popup.add(this.shooter)}createBullet(){const{x:e,y:t}=this.bulletPosition;this.bullet=this.scene.add.image(e,t,gs,Ze.BALL_BLUE),this.bullet.setWorldSize(31,32),this.popup.add(this.bullet);const{x:s,y:n}=this.nextBulletPosition;this.nextBullet=this.scene.add.image(s,n,gs,Ze.BALL_BLUE),this.nextBullet.setWorldSize(31,32),this.popup.add(this.nextBullet),this.nextNextBullet=this.scene.add.image(s,n,gs,Ze.BALL_BLUE),this.nextNextBullet.setWorldSize(31,32),this.nextNextBullet.setVisible(!1),this.popup.add(this.nextNextBullet)}createHandGuide(){this.tutorialHand=new WE(this.scene),this.add(this.tutorialHand)}createUnderstoodButton(){const{KEY:e,FRAME:t}=_.DEFAULT;this.understoodButton=new Q(this.scene,e,t.BUTTON_GREEN_SHORT,90,52),this.understoodButton.setName("Ok"),this.understoodButton.onClick=this.closePopup;const s=this.scene.lang.getCurrentLanguage(),n=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(s==="ru"?20:24),text:this.scene.lang.Text.OK,origin:{x:.5,y:.5}});Phaser.Display.Align.In.Center(n,this.understoodButton),this.understoodButton.add(n),this.popup.add(this.understoodButton),Phaser.Display.Align.In.BottomCenter(this.understoodButton,this.popup,0,-20)}setDefaultObjects(){const e=1/this.scene.world.getPixelRatio(),{x:t,y:s}=this.bulletPosition,{x:n,y:a}=this.nextBulletPosition;this.blueEggGroup.setAlpha(1),this.redEggGroup.setAlpha(1),this.bullet.setAlpha(1),this.bullet.setPosition(t,s),this.bullet.setFrame(Ze.BALL_BLUE),this.bullet.setScale(e),this.nextBullet.setFrame(Ze.BALL_BLUE),this.nextBullet.setScale(e*this.nextBulletScale),this.nextNextBullet.setPosition(n,a),this.nextNextBullet.setVisible(!1),this.shotGuideDirect.setAngle((270+20)*Math.PI/180);const{x:r,y:c}=this.shotGuideDirect;this.shotGuideGroup.setXY(t,s,r*this.guideSpace,c*this.guideSpace),this.shotGuideGroup.setTint(Z.Blue),this.shotGuideGroup.setVisible(!0),this.lastShotGuide.setVisible(!1),this.tutorialHand.show(),this.tutorialHand.setPosition(this.middleShotGuide.x,this.middleShotGuide.y);const o=[this.redEggGroup.getChildren(),this.blueEggGroup.getChildren(),this.shooter,this.tutorialHand];this.blueEggGroup.setAlpha(0),this.redEggGroup.setAlpha(0),this.shooter.setAlpha(0),this.nextBullet.setAlpha(0),this.bullet.setAlpha(0),this.shotGuideGroup.setAlpha(0),this.tutorialHand.setAlpha(0),o.forEach((l,h)=>{this.scene.tweens.add({targets:l,delay:300+h*200,alpha:{from:0,to:1}})})}setShotGuideTo(e){this.shotGuideDirect.setAngle((270+e)*Math.PI/180);const{x:t,y:s}=this.shotGuideDirect,{x:n,y:a}=this.bulletPosition;this.shotGuideGroup.setXY(n,a,t*this.guideSpace,s*this.guideSpace)}animateShotGuideToShootBlueEggs=()=>{this.setDefaultObjects();const e=this.shotGuideDirect,t=this.guideSpace,s=(270+20)*Math.PI/180,n=(270-9)*Math.PI/180;this.tutorialHand.tapAndHold(1300),this.scene.tweens.addCounter({from:s,to:n,duration:300,onStart:()=>{this.nextBullet.setAlpha(1),this.bullet.setAlpha(1),this.shotGuideGroup.setAlpha(1)},onUpdate:a=>{const{x:r,y:c}=this.bulletPosition;e.setAngle(a.getValue()),this.shotGuideGroup.setXY(r,c,e.x*t,e.y*t),this.tutorialHand.setPosition(this.middleShotGuide.x,this.middleShotGuide.y)},onComplete:this.animateHitBlueEggs,delay:1500})};animateNextBulletToBullet(){const e=1/this.scene.world.getPixelRatio(),t=this.nextBulletPosition.x-this.shooterPosition.x,s=this.nextBulletPosition.y-this.shooterPosition.y,n=new Phaser.Math.Vector2(t,s),a=this.bulletPosition.x-this.shooterPosition.x,r=this.bulletPosition.y-this.shooterPosition.y,c=new Phaser.Math.Vector2(a,r),o=c.length(),{x:l,y:h}=this.nextBulletPosition;this.nextNextBullet.setVisible(!0),this.nextNextBullet.setPosition(l,h),this.nextNextBullet.setScale(e*this.nextBulletScale),this.scene.tweens.add({targets:this.nextNextBullet,scale:{from:e*this.nextBulletScale,to:e},duration:300}),this.scene.tweens.addCounter({from:n.angle()+2*Math.PI,to:c.angle(),duration:300,onUpdate:d=>{const u=d.getValue();this.nextNextBullet.x=this.shooterPosition.x+Math.cos(u)*o,this.nextNextBullet.y=this.shooterPosition.y+Math.sin(u)*o}}),this.nextBullet.setFrame(Ze.BALL_RED),this.scene.tweens.add({targets:this.nextBullet,scale:{from:0,to:e*this.nextBulletScale},duration:300})}animateHitBlueEggs=()=>{this.tutorialHand.unHold(200,!0);const e=this.shotGuideDirect,t=this.guideSpace,{x:s,y:n}=this.bulletPosition;this.setShotGuideTo(-9);const a=s+e.x*(t*5-3),r=n+e.y*(t*5-3);this.scene.tweens.add({targets:this.bullet,x:a,y:r,duration:300,onStart:()=>{this.shotGuideGroup.setVisible(!1),this.tutorialHand.hide(),this.animateNextBulletToBullet()},onComplete:()=>{this.scene.tweens.add({targets:this.blueEggGroup.getChildren().concat(this.bullet),alpha:0,duration:300,onComplete:this.showTapTapToSwitchEgg})},delay:500})};showTapTapToSwitchEgg=()=>{const{x:e,y:t}=this.bulletPosition;this.bullet.setAlpha(1),this.bullet.setPosition(e,t),this.nextBullet.setFrame(Ze.BALL_RED),this.shotGuideGroup.setVisible(!0),this.tutorialHand.setPosition(this.shooter.x,this.shooter.y),this.tutorialHand.show(),this.tutorialHand.doubleTap(100,!0,this.animateSwapBall)};animateSwapBall=()=>{const e=this.bullet;this.bullet=this.nextBullet,this.nextBullet=e,this.nextNextBullet.setVisible(!1);const t=this.nextBulletPosition.x-this.shooterPosition.x,s=this.nextBulletPosition.y-this.shooterPosition.y,n=new Phaser.Math.Vector2(t,s),a=this.bulletPosition.x-this.shooterPosition.x,r=this.bulletPosition.y-this.shooterPosition.y,c=new Phaser.Math.Vector2(a,r),o=1/this.scene.world.getPixelRatio(),l=c.length();this.scene.tweens.add({targets:this.nextBullet,scale:o*this.nextBulletScale,duration:300}),this.scene.tweens.addCounter({from:c.angle(),to:n.angle(),duration:300,onUpdate:h=>{const d=h.getValue();this.nextBullet.x=this.shooterPosition.x+Math.cos(d)*l,this.nextBullet.y=this.shooterPosition.y+Math.sin(d)*l}}),this.scene.tweens.add({targets:this.bullet,scale:o,duration:300}),this.scene.tweens.addCounter({from:n.angle()+2*Math.PI,to:c.angle(),duration:300,onUpdate:h=>{const d=h.getValue();this.bullet.x=this.shooterPosition.x+Math.cos(d)*l,this.bullet.y=this.shooterPosition.y+Math.sin(d)*l},onComplete:()=>{this.shotGuideGroup.setVisible(!0),this.shotGuideGroup.setTint(Z.Red),this.scene.time.delayedCall(200,this.animateShotGuideToShootRedEggs)}})};animateShotGuideToShootRedEggs=()=>{this.shotGuideGroup.setVisible(!0),this.tutorialHand.show(),this.tutorialHand.setPosition(this.middleShotGuide.x,this.middleShotGuide.y);const e=this.shotGuideDirect,t=this.guideSpace,s=(270-9)*Math.PI/180,n=(270+14)*Math.PI/180;this.tutorialHand.tapAndHold(300),this.scene.tweens.addCounter({from:s,to:n,duration:300,onUpdate:a=>{const{x:r,y:c}=this.bulletPosition;e.setAngle(a.getValue()),this.shotGuideGroup.setXY(r,c,e.x*t,e.y*t),this.tutorialHand.setPosition(this.middleShotGuide.x,this.middleShotGuide.y)},onComplete:this.animateHitRedEggs,delay:600})};animateHitRedEggs=()=>{this.tutorialHand.unHold(200,!0);const e=this.shotGuideDirect,t=this.guideSpace,{x:s,y:n}=this.bulletPosition;this.setShotGuideTo(14);const a=s+e.x*(t*6+6),r=n+e.y*(t*6+6);this.scene.tweens.add({targets:this.bullet,x:a,y:r,duration:300,onStart:()=>{this.shotGuideGroup.setVisible(!1),this.animateNextBulletToBullet()},onComplete:()=>{this.scene.tweens.add({targets:this.redEggGroup.getChildren().concat(this.bullet),alpha:0,duration:300,completeDelay:600,onComplete:this.animateShotGuideToShootBlueEggs})},delay:500})};runOpenAnimation(){this.scene.audio.playSound(H.POPUP_SHOW),this.runPopupEntrancesAnimation(0,400)}runCloseAnimation(){this.runPopupExitsAnimation(0,400)}runPopupEntrancesAnimation(e,t){this.popupShowUpAnimation||(this.popupShowUpAnimation=new Ve({targets:[this.popup],delay:e,duration:t,props:{alpha:{from:0,to:1},scale:{from:0,to:1}}})),this.popupShowUpAnimation.play()}runPopupExitsAnimation(e,t){this.popupFadeOutAnimation||(this.popupFadeOutAnimation=new ke({targets:[this.popup],delay:e,duration:t,props:{alpha:0,scale:0}})),this.popupFadeOutAnimation?.play()}}const{KEY:KE,FRAME:$E}=_.GAMEPLAY.GAMEPLAY_TEXTURES;class jE extends Phaser.GameObjects.Image{tween;constructor(e,t,s){super(e,t,s,KE,$E.HAND),this.x-=50,this.setWorldSize(65.5,55.5),e.add.existing(this)}show(){this.setVisible(!0),this.tween=this.scene.tweens.add({targets:this,x:{from:this.x,to:this.x+100},duration:750,yoyo:!0,loop:-1,ease:Phaser.Math.Easing.Sine})}hide(){this.tween.complete(),this.setVisible(!1)}}var xl=(i=>(i[i.Carrying=0]="Carrying",i[i.Escaping=1]="Escaping",i[i.Dead=2]="Dead",i))(xl||{});const ms=xl,{KEY:Kt,FRAME:Ti}=_.GAMEPLAY.GAMEPLAY_TEXTURES;class XE extends Phaser.Animations.Animation{constructor(e){const t={frameRate:10,frames:e.generateFrameNames(Kt,{prefix:Ti.DINO_FLY,start:1,end:8})};super(e,Kt,t)}}class qE extends Phaser.Animations.Animation{constructor(e){const t={frameRate:10,frames:e.generateFrameNames(Kt,{prefix:Ti.DINO_LEG,start:1,end:8})};super(e,Kt,t)}}class Rn extends Phaser.GameObjects.Container{scene;egg;dino;leg;flyingDinoSpeed;mainBody;flyTween;constructor(e,t,s){super(e,t,s),this.scene=e,this.flyingDinoSpeed=e.registry.get("flyingDinoSpeed"),this.createFlyingDino(),this.createFlyingDinoBodies(),this.createFlyAnimation()}getPhysicsObjects(){return[this.dino,this.egg]}createFlyingDino(){const{width:e,height:t}=this.scene.data.get("ball"),{KEY:s,FRAME:n}=_.GAMEPLAY.GAME_OBJECTS;this.egg=new bi(this.scene,0,0,s,n.BALL_RED),this.scene.physics.add.existing(this.egg),this.egg.setScale(.5),this.egg.setPosition(0,0),this.egg.setWorldSize(e,t),this.dino=this.scene.physics.add.sprite(-2,-35,Kt,Ti.DINO_FLY+"1"),this.leg=this.scene.add.sprite(8,-14,Kt,Ti.DINO_LEG+"1"),this.dino.setOrigin(.5,.5),this.dino.setWorldSize(87,63.5),this.leg.setOrigin(.5,.5),this.leg.setWorldSize(21,26),this.add([this.dino,this.egg,this.leg]),this.state=ms.Dead,this.scene.add.existing(this)}createFlyingDinoBodies(){const e=this.scene.world.getPixelRatio();this.scene.physics.add.existing(this),this.mainBody=this.body,this.mainBody.setSize(80,80),this.mainBody.setOffset(-40,-40),this.mainBody.setCollideWorldBounds(!0,1,1),this.mainBody.debugBodyColor=4584770,this.dino.body.setSize(50*e,32*e),this.dino.body.setOffset(12*e,16*e),this.egg.updatePhysicsRadius(16*e)}enableBody(){this.dino.body.enable=!0,this.egg.body.enable=!0,this.mainBody.enable=!0}disableBody(){this.dino.body.enable=!1,this.egg.body.enable=!1,this.mainBody.enable=!1}takeOff(e){this.revive(),this.state=ms.Carrying,this.playFlying(),this.egg.setVisible(!0),this.egg.setColor(e),this.enableBody();const{x:t,y:s}=this.flyingDinoSpeed;this.mainBody.setVelocity(t,s*this.scene.descentController.getSpeedRate())}fly=()=>{this.state=ms.Escaping,this.egg.setVisible(!1),this.mainBody.setVelocity(0),this.disableBody();const e=this.y/this.scene.gameZone.height*1200;this.scene.tweens.add({targets:this,y:-10,duration:e,onComplete:()=>{this.flyTween.complete(),this.kill()}})};createFlyAnimation(){if(this.scene.anims.exists("flyingDino-fly"))return;const e=new XE(this.scene.anims),t=new qE(this.scene.anims);this.scene.anims.add("flyingDino-fly",e),this.scene.anims.add("flyingDino-leg",t)}playFlying(){this.dino.play("flyingDino-fly"),this.leg.play("flyingDino-leg"),this.flyTween?.complete(),this.flyTween=this.scene.tweens.addCounter({from:0,to:5,yoyo:!0,onUpdate:e=>{const t=e.getValue()-(e.data[0].previous||0);this.y+=t},repeat:-1,duration:350,onRepeat:()=>{this.dino?.play("flyingDino-fly"),this.leg?.play("flyingDino-leg")},ease:Phaser.Math.Easing.Cubic.Out})}update(){this.state===ms.Carrying&&(this.y<=20&&this.handleLevelUp(),this.flipDino())}handleLevelUp(){this.state=ms.Dead,this.scene.levelUpController.levelUp(),this.scene.descentController.resetSpeedRate(),this.scene.ballLayoutData.levelUp(),this.scene.grid.randomTopColor(),this.kill()}getCurrentColor(){return this.egg.getColor()}flipDino(){const e=this.mainBody.velocity.x;this.scaleX*e>0&&(e>0?this.flipDinoRight():this.flipDinoLeft())}flipDinoRight(){const e=this.scene.world.getPixelRatio();this.setScale(-Math.abs(this.scaleX),this.scaleY),this.dino.body.setOffset(24*e,16*e),this.mainBody.setOffset(40,-40)}flipDinoLeft(){const e=this.scene.world.getPixelRatio();this.setScale(Math.abs(this.scaleX),this.scaleY),this.dino.body.setOffset(12*e,16*e),this.mainBody.setOffset(-40,-40)}kill(){this.flyTween?.complete(),this.disableBody(),super.kill()}}class ZE extends Phaser.GameObjects.Group{scene;physicsObjects;constructor(e){super(e,{runChildUpdate:!0}),this.scene=e,this.physicsObjects=e.physics.add.group(),this.setActive(!0),this.scene.add.existing(this),this.initObjects(1)}getPhysicsObjects(){return this.physicsObjects}spawn(e=0,t=0){let s=this.getFirstDead();return s||(s=this.addFlyingDino()),s.setPosition(e,t),s.enableBody(),s.revive(),s}reset(){this.getChildren().forEach(e=>{e.active&&e.kill()})}initObjects(e){for(let t=0;t<e;t++)this.addFlyingDino().kill()}getChildren(){return super.getChildren()}addFlyingDino(){const e=new Rn(this.scene,216.5,646);return e.setDepth(z.FLYING_EGG),this.add(e),this.physicsObjects.addMultiple(e.getPhysicsObjects()),e}}const JE=i=>i[Hs]?.tasks,QE=i=>i[Hs]?.process,eS=i=>i[Hs]?.isRequesting,tS=i=>i[Hs]?.isNotice,ha=G([JE],i=>i),Dl=G([QE],i=>i),sS=G([eS],i=>i),iS=G([tS],i=>i);class os{scene;constructor(e){this.scene=e}}class nS{heave(e){const t=e.scene,s=t.registry.get("heavingBallTimer"),n=100,a=Math.floor(s/n/2),r=1/e.scene.world.getPixelRatio();return t.tweens.add({targets:e,duration:n,scale:{from:r*.9,to:r*1.1},yoyo:!0,repeat:a,onUpdate:o=>{e.active||o.complete()},onComplete:()=>{e.scale=r}})}}const aS=Math.sqrt(3)/2,mr=[[[-1,-1],[-1,0],[0,-1],[0,1],[1,-1],[1,0]],[[-1,0],[-1,1],[0,-1],[0,1],[1,0],[1,1]]];class fr extends Array{index=0;staggered=!1;size=0;count=0;firstX=0}class rS{scene;pool;layoutData;size;grid=[];ballsWillBeDestroyed=[];orphanBallsWillBeDestroyed=[];rowSize=0;ballsCount=0;firstY=0;eventAddHavingBall;get height(){return(this.grid.length-1)*this.ballInterval+this.size.height}get ballInterval(){return Math.round(this.size.height*aS)}get topY(){return this.grid.length===0?0:this.firstY-this.size.height*.5}get bottomY(){return this.topY+this.height}get firstRow(){return this.grid[0]}get getDangerRows(){const e=this.scene.registry.get("zones").zones,t=[];if(this.bottomY>e.zone5.topY){const s=Math.ceil((this.bottomY-e.zone5.topY)/this.ballInterval);t.push(...this.grid.slice(this.grid.length-s))}return t}get totalBalls(){return this.ballsCount}constructor(e,t){this.scene=e,this.pool=t;const s=this.scene.data.get("grid"),{width:n,height:a,rowSize:r}=s;this.rowSize=r,this.size=new Phaser.Structs.Size(n,a)}getBallsAt(e,t){if(this.grid.length===0)return[];if(this.bottomY+40<t)return[];const{row:s,col:n}=this.getRowColByXY(e,t),a=this.getNeighbors(s,n),r=this.grid[s];if(r){const c=r[n];c&&a.push(c)}return a}getPool(){return this.pool}getVisiblesBall(){const e=this.getIndexOfHighestFullEggRow();return this.grid.slice(e,this.grid.length)}getIndexOfHighestFullEggRow(){return this.grid.findIndex(t=>t.size!==t.count)-1}start(){this.addEventToRandomHeavingBall()}addEventToRandomHeavingBall(){this.eventAddHavingBall=this.scene.time.addEvent({delay:this.scene.registry.get("timerForNextRandomHeavingBall"),repeat:-1,startAt:3e3,callback:()=>{this.randomHeavingBall()}}),this.scene.events.emit(ee.TIMER_CREATED,this.eventAddHavingBall)}resetAlphaForAllBalls(){this.grid.map(e=>e.map(t=>{t&&t.setAlpha(1)}))}destroy(){this.scene&&(this.clearGrid(),this.eventAddHavingBall?.remove())}setLayoutData(e){return this.layoutData=e,this}rowColToXY(e,t){const s=this.size.width,n=s*.5,a=this.ballInterval,r=this.grid[0],c=this.isRowStaggered(e);let o=r.firstX+t*s;r.staggered!=c&&(c?o+=n:o-=n);const l=this.firstY+e*a;return[o,l]}findNearestEmptyPositionByXY(e,t,s,n=0){const a=this.getNeighborsPositionAt(s.row,s.col);a.sort((h,d)=>{const[u,p]=h,[g,m]=d,[E,f]=this.rowColToXY(u,p),[y,S]=this.rowColToXY(g,m),T=Phaser.Math.Distance.Between(e,t,E,f),b=Phaser.Math.Distance.Between(e,t,y,S);return T<b?-1:1});const r=a[0];for(;a.length>0;){const[h,d]=a[0];if(this.grid[h]&&this.grid[h][d]){a.shift();continue}return a[0]}if(n===2)return[];const[c,o]=r,l=this.grid[c][o];return l?this.findNearestEmptyPositionByXY(e,t,l,n+1):[]}animateDestroyedBall(e,t){let a=0;this.orphanBallsWillBeDestroyed.push(t),this.makeBallsBlur(t),e.forEach((r,c)=>{this.ballsWillBeDestroyed.push(r),a+=r.length;const o=this.scene.time.addEvent({delay:83*c+33,callback:()=>{if(this.scene.animationsManager.handleBallsWillBeDestroyed(r),this.scene.scoreCounter.processBallDestroyed(r),r.forEach(l=>{if(l.isHeaving()){const h=this.layoutData.getRandomStamp();this.spawnStamp(h,l.x,l.y)}l.preKill()}),r.length=0,c===e.length-1){t.length>0&&this.animateOrphans(t),t.length=0,this.scene.scoreCounter.updateCombosMultiplier();const l=this.scene.data.get("numEggDestroyedToEmitParticle");a>=l&&this.scene.animationsManager.handleDestroyedLotsEgg()}}});this.scene.events.emit(ee.TIMER_CREATED,o)})}attachBall(e,t){const s=e.x,n=e.y,a=this.findNearestEmptyPositionByXY(s,n,t);if(a.length===0)return;const[r,c]=a,[o,l]=this.rowColToXY(r,c);if(r===this.grid.length){const f=new fr(this.rowSize);f.fill(void 0);const y=this.grid[r-1];f.staggered=!y.staggered,f.firstX=y.firstX+this.size.width/2,f.size=y.size+1,y.staggered?f.firstX-=this.size.width:f.size-=2,this.grid.push(f)}else if(r>this.grid.length){const f=new Error("Invalid position when attach ball"),y={pos:{row:r,col:c},ballsCount:this.ballsCount,gridLen:this.grid.length,firstY:this.firstY,bottomY:this.bottomY};kn(f,y)}const h=this.grid[r];if(!h)return;const d=this.pool.spawn(o,l,e.getColor());d.setStamp(e.takeStamp()),d.row=r,d.col=c,h[c]=d,h.count+=1,this.jiggleNeighborsBall(d),this.resetProcessed();const[u,p]=this.findMatchesByLevelAt(d),g=p>=3;if(this.scene.scoreCounter.processCombos(g),this.scene.audio.playSound(H.IMPACT),!g){this.ballsCount+=1,this.scene.scoreCounter.updateCombosMultiplier();const y=this.scene.registry.get("zones").zones.zone5.topY;d.y-this.ballInterval/2>y&&(this.removeFromGrid([d]),this.scene.animationsManager.handleBallsWillBeDestroyed([d]),d.preKill());return}u.forEach(f=>{this.removeFromGrid(f)});const m=this.findOrphanedBalls();this.removeFromGrid(m);const E=p+m.length-1;this.ballsCount-=E,this.animateDestroyedBall(u,m),this.cleanUpEmptyRows()}generate(e=6){if(!this.layoutData)return this;for(let t=0;t<e;++t)this.spawnRow();return this}moveBy(e,t){return this.pool.countActive()===0?this:(this.firstY+=e+t,this.grid.forEach(s=>{s.forEach(n=>{n&&(n.y+=e+t)})}),this.ballsWillBeDestroyed=this.ballsWillBeDestroyed.filter(s=>s.length),this.ballsWillBeDestroyed.forEach(s=>{s.forEach(n=>{n&&(n.y+=e)})}),this.orphanBallsWillBeDestroyed=this.orphanBallsWillBeDestroyed.filter(s=>s.length),this.orphanBallsWillBeDestroyed.forEach(s=>{s.forEach(n=>{n&&(n.y+=e)})}),this)}dropAllBalls(){const e=[];this.grid.forEach(t=>{t.forEach(s=>{s&&e.push(s)})}),this.removeFromGrid(e),this.animateOrphans(e)}spawnRow(){const e=this.grid[0];let t=this.rowSize;e&&!e.staggered&&(t=this.rowSize-1);const s=this.layoutData.getNextRow(t);this.addRowToFront(s)}clearGrid(){this.grid.forEach(e=>{const t=e.filter(s=>s);this.removeFromGrid(t),t.forEach(s=>{s.preKill()})}),this.cleanUpEmptyRows()}updateCoordinate(){this.grid.forEach((e,t)=>{e.forEach((s,n)=>{s&&(s.row=t,s.col=n)}),e.index=t})}addRowToFront(e){const t=this.scene.gameZone.width*.5,s=this.size.width,n=s*.5,a=this.ballInterval,r=new fr;this.grid.unshift(r);let c=0;if(this.grid.length<=1)r.staggered=!1,r.size=this.rowSize,this.firstY=0;else{const h=this.grid[1];r.staggered=!h.staggered,r.size=this.rowSize-+r.staggered,this.firstY-=a,c=this.firstY}const o=r.size*.5;let l=t-o*s+n;r.firstX=l,e.forEach(h=>{if(h!==-1){const d=this.pool.spawn(l,c,h);r.push(d),r.count+=1}else r.push(void 0);l+=s}),this.ballsCount+=r.count,r.staggered&&r.push(void 0),this.updateCoordinate()}removeFromGrid(e){e.forEach(t=>{const s=t.row,n=t.col;this.grid[s][n]=void 0,this.grid[s].count-=1,this.scene.physics.world.disableBody(t.body)})}animateOrphans(e){const t=this.scene.tweens.timeline(),n=this.scene.registry.get("zones").zones.zone5.topY;e.map(a=>{const r=a.y,c=a.x,o=Phaser.Math.Between(-10,20),l=n-r+o+90,h=l*2;t.add({targets:a,y:{value:r+l,duration:h,ease:Phaser.Math.Easing.Sine.In},x:{value:c+o,duration:h,ease:Phaser.Math.Easing.Linear},offset:0,duration:h,delay:30,onComplete:()=>{this.scene.animationsManager.handleOrphanBallWillBeDestroyed(a),a.preKill()}})}),t.play()}findOrphanedBalls(){this.resetProcessed();const e=this.getIndexOfHighestFullEggRow(),s=(this.grid[e+1]||[])?.filter(a=>a);if(!s)return[];this.resetProcessed(),this.grid.slice(0,e+1).forEach(a=>{a.forEach(r=>{r?.setProcessed(!0)})}),s.forEach(a=>{this.findMatchesByLevelAt(a,Z.Any)});const n=[];return this.grid.slice(e+1,this.grid.length).forEach(a=>{a.forEach(r=>{r&&!r.isProcess&&n.push(r)})}),n}resetProcessed(){this.grid.forEach(e=>{e.forEach(t=>{t?.setProcessed(!1)})})}destroyNeighBors(e,t,s){const n=this.findNearestEmptyPositionByXY(e,t,s);if(n.length===0)return;const[a,r]=n,c=this.getNeighborsByLevelAt(3,a,r);let o=0;c.forEach(d=>{o+=d.length,this.removeFromGrid(d)});const l=this.findOrphanedBalls();this.removeFromGrid(l);const h=o+l.length;this.scene.time.delayedCall(60,()=>{this.animateDestroyedBall(c,l)}),this.cleanUpEmptyRows(),this.ballsCount-=h}isRowStaggered(e){const t=this.grid[0];return e%2==0?t.staggered:!t.staggered}getNeighborsPositionAt(e,t){const s=this.isRowStaggered(e);return mr[+s].map(c=>[e+c[0],t+c[1]]).filter(c=>{const[o,l]=c,h=this.rowSize-+this.isRowStaggered(o);return l>=0&&l<h})}getNeighbors(e,t){const s=this.isRowStaggered(e);return mr[+s].map(r=>{const c=e+r[0],o=t+r[1],l=this.grid[c];if(l&&l[o])return l[o]}).filter(r=>r)}filterBallsByPositions(e){const t=[];return e.forEach(s=>{const[n,a]=s,r=this.grid[n];if(r){const c=r[a];c&&t.push(c)}}),t}getNeighborsByLevelAt(e,t,s){this.resetProcessed();const n=[];if(this.grid[t]){const r=this.grid[t][s];r&&(r.isProcess=!0)}const a=this.filterBallsByPositions(this.getNeighborsPositionAt(t,s));n.push(a),a.forEach(r=>{r.isProcess=!0});for(let r=0;r<e-1;r++){const c=n[n.length-1];if(c.length==0){n.pop();break}const o=[];c.forEach(l=>{this.filterBallsByPositions(this.getNeighborsPositionAt(l.row,l.col)).forEach(d=>{d.isProcess||(d.isProcess=!0,o.push(d))})}),n.push(o)}return n}findMatchesByLevelAt(e,t){const s=[],n=t||e.getColor();e.isProcess=!0,s.push([e]);let a=1;for(let r=0;r<s.length;r++){const c=s[s.length-1];if(c.length==0){s.pop();break}const o=[];c.forEach(l=>{this.filterBallsByPositions(this.getNeighborsPositionAt(l.row,l.col)).forEach(d=>{d.isProcess||(zy(n,d.getColor())&&(o.push(d),a+=1),d.isProcess=!0)})}),s.push(o)}return[s,a]}jiggleNeighborsBall(e){const t=this.getNeighborsByLevelAt(3,e.row,e.col),s=[6,4,2,1],n=33;t.forEach((a,r)=>{const c=s[r];a.forEach(o=>{const l=o.x-e.x,h=o.y-e.y,d=new Phaser.Math.Vector2(l,h);d.normalize(),o.jiggle(d,c,n*r)})})}cleanUpEmptyRows(){const e=this.grid.length;for(let t=e-1;t>=0;--t){if(this.grid[t].count>0)return;this.grid.pop()}}randomHeavingBall(){const e=[];this.grid.forEach(a=>{const r=a.filter(c=>c&&!c.isHeaving());e.push(...r)});const t=e.length;if(t<2)return;const s=Phaser.Math.Between(Math.floor(t/2),t-1),n=e[s];n&&(n.setHeavingBehavior(new nS),n.heave())}spawnStamp(e,t,s){const n=1/this.scene.world.getPixelRatio();e.setScale(n*1.25),e.setPosition(t,s);const c=this.scene.registry.get("zones").zones.zone5.topY-s+90,o=500/1e3;this.scene.tweens.add({targets:e,y:s+c,offset:0,duration:c/o,onComplete:()=>{e.setScale(n),e.setVisible(!1),this.scene.shooter.collectStamp(e)},ease:Phaser.Math.Easing.Quadratic.In})}randomTopColor(){this.scene.time.delayedCall(50,()=>{const e=this.layoutData.getTopColor(),t=this.layoutData.getLevel();this.grid.slice(0,2).forEach(s=>{s.forEach(n=>{const a=Phaser.Math.Between(0,t+2);n&&a===1&&n.setColor(e)})})})}getRowColByXY(e,t){const s=(t-this.topY+this.size.height*.5)/this.ballInterval,n=Math.round(s)-1;let a;if(n%2===0)a=this.firstRow.firstX;else{const o=n%2===0?this.firstRow.staggered:!this.firstRow.staggered;a=this.firstRow.firstX-this.size.width/2,o&&(a+=this.size.width)}const r=(e-a)/this.size.width,c=Math.round(r);return{row:n,col:c}}makeBallsBlur(e){this.scene.tweens.add({targets:e,duration:83,alpha:{from:1,to:.65}})}}const oS=[he.Stamp5,he.Stamp10,he.Stamp15,he.Stamp2x,he.Stamp3x,he.Stamp4x,he.StampUp],fs=[Z.Red,Z.Blue,Z.Green,Z.Yellow,Z.Violet,Z.Pink,Z.Cyan,Z.Gray,Z.Black];class cS{scene;currentColors=[];currentBulletColors=[];countBulletColors;stampPool;bombPool;ballGrid;constructor(e){this.scene=e,this.initBeginColors()}setStampPool(e){this.stampPool=e}setBombPool(e){this.bombPool=e}setBallGrid(e){this.ballGrid=e}initBeginColors(){const e=this.scene.registry.get("level")+2;this.currentColors=fs.slice(0,e),this.currentBulletColors=fs.slice(0,e),this.countBulletColors=Array(e).fill(0)}levelUp(){const e=this.scene.registry.get("level")+2;this.currentColors=fs.slice(0,e);const t=this.ballGrid.firstRow||[];this.scene.tweens.addCounter({duration:1e5,onUpdate:s=>{t.count<t.size&&(this.currentBulletColors=fs.slice(0,e),s.complete())}})}getLevel(){return this.currentColors.length}getNextLevelColor(e){return fs[e+1]}destroy(){}getNextRow(e){const t=[];for(let s=0;s<e;++s)t.push(this.getRandomColor());return t}getTopColor(){const e=this.currentColors.length-1;return this.currentColors[e]}getRandomColor(){const e=Math.floor(Math.random()*this.currentColors.length);return this.currentColors[e]}getRandomBulletColor(){const e=this.currentColors.length;let t=Math.floor(Math.random()*e);if(this.countBulletColors[t]>=4){const s=Math.floor(Math.random()*(e-1));s===t?t=s+1:t=s}return this.countBulletColors[t]===0&&(this.countBulletColors=Array(e).fill(0)),this.countBulletColors[t]+=1,this.currentBulletColors[t]}getRandomStamp(){const e=this.scene.registry.get("bonusRate"),t=[...oS],s=[...e],n=this.scene.gameZone.height*.5;this.ballGrid.bottomY<n&&(s[6]=0);const a=this.getRandomStampType(t,s),r=this.stampPool.spawn();return r.setStamp(a),r}getRandomStampType(e,t){const s=t.reduce((c,o)=>c+o,0);let n=Math.ceil(Math.random()*s);const a=t.findIndex(c=>(n-=c,n<=0));return e[a]}getBomb(){return this.bombPool.spawn()}}var Bl=(i=>(i[i.LOADING=0]="LOADING",i[i.SWAPPING=1]="SWAPPING",i[i.READY=2]="READY",i[i.SHOOTING=3]="SHOOTING",i))(Bl||{});const Se=Bl,{KEY:yr,FRAME:Er}=_.GAMEPLAY.GAMEPLAY_TEXTURES,{KEY:lS,FRAME:hS}=_.GAMEPLAY.GAME_OBJECTS,{GAMEOBJECT_POINTER_DOWN:tn,GAMEOBJECT_POINTER_MOVE:Sr,GAMEOBJECT_POINTER_UP:Ar}=Phaser.Input.Events;class uS extends Phaser.GameObjects.Container{highlightCircle;fireCircle;launcher;switchingArea;shootingArea;isPointerDownInShootingArea=!1;isPointerMoveInShootingArea=!0;shootingAngle;timeToReloadBullet=150;shotGuide;multiplierText;currentBullet;bomb;nextBullet;isBombAttached=!1;bulletBallPool;layoutData;stampQueue=[];shooterState;isDisabledShooting=!0;isDisabledShotGuide=!0;isDisabledSwitching=!0;nextBulletScale=.75;shootingPosition;nextShootingPosition;isDesktop;constructor(e,t,s){super(e,t,s),this.setDepth(z.SHOOTER),this.shooterState=Se.LOADING,this.initBulletPosition(),this.createObjects(),this.createAnimation(),this.initEvents(),this.initController(),this.isDesktop=GameCore.Utils.Device.isDesktop(),e.add.existing(this)}initBulletPosition(){this.shootingPosition={x:this.x,y:this.y-60*.5},this.nextShootingPosition={x:this.x+60*.5*Math.cos(Math.PI/4.4),y:this.y+60*.5*Math.sin(Math.PI/3.4)}}createObjects(){const{width:e,height:t}=this.scene.data.get("ball");this.launcher=this.scene.add.image(0,0,lS,hS.SHOOTER),this.launcher.setWorldSize(93,93),this.highlightCircle=this.scene.add.image(0,0,yr,Er.HIGHLIGHT_CIRCLE),this.highlightCircle.setVisible(!1).setPosition(this.shootingPosition.x-this.x,this.shootingPosition.y-this.y).setWorldSize(e*1.5,t*1.5),this.fireCircle=this.scene.add.image(0,0,yr,Er.FIRE_CIRCLE),this.fireCircle.setVisible(!1).setPosition(this.shootingPosition.x-this.x,this.shootingPosition.y-this.y).setWorldSize(55,61),this.multiplierText=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(23),text:"x1",origin:{x:.5,y:.4}}),this.add([this.launcher,this.highlightCircle,this.multiplierText,this.fireCircle])}createAnimation(){this.scene.tweens.add({targets:this.fireCircle,alpha:.85,duration:300,yoyo:!0,loop:-1}),this.scene.tweens.add({targets:this.fireCircle,angle:"-=0.2",duration:500,yoyo:!0,loop:-1})}initController(){const e=this.scene.add.rectangle(0,55,this.scene.gameZone.width,this.scene.gameZone.height),t=90,s=this.scene.add.rectangle(0,0,t,t);e.setOrigin(0,0),e.setInteractive(),e.on(tn,()=>{this.isPointerDownInShootingArea=!0}),this.scene.input.on(tn,this.onPointerDown),this.scene.input.on(Sr,this.onPointerMove),this.scene.input.on(Ar,this.onPointerUp);let n=!1;s.setInteractive({useHandCursor:!0}),s.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,()=>{n=!0}),s.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,()=>{n=!1}),s.on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,()=>{n&&this.swapBalls()}),this.shootingAngle=new Phaser.Math.Vector2(0,-1),this.add([s]),this.switchingArea=s,this.shootingArea=e}onPointerDown=(e,t)=>{t[0]!==this.shootingArea?this.isPointerMoveInShootingArea=!1:(this.isPointerMoveInShootingArea=!0,this.updateAngle(e))};onPointerMove=(e,t)=>{if(!(!this.isDesktop&&!this.isPointerMoveInShootingArea)){if(t[0]!==this.shootingArea){this.isPointerMoveInShootingArea=!1;return}if(t[0]===this.switchingArea){this.isPointerMoveInShootingArea=!1;return}this.isPointerMoveInShootingArea=!0,this.updateAngle(e)}};onPointerUp=(e,t)=>{if(e.rightButtonReleased()){this.swapBalls(),this.isPointerMoveInShootingArea=!0;return}t[0]!==this.switchingArea&&(this.isPointerDownInShootingArea&&this.isPointerMoveInShootingArea?(this.shoot(e),this.isPointerMoveInShootingArea=!0):this.isPointerMoveInShootingArea=!1,this.isPointerDownInShootingArea=!1)};initEvents(){this.scene.screen.events.off(GameCore.Screens.Events.CLOSE,this.handleCloseScreen),this.scene.screen.events.on(GameCore.Screens.Events.CLOSE,this.handleCloseScreen)}collectStamp(e){this.stampQueue.push(e)}pause(){this.setDisabledShooting(),this.setDisabledShotGuide(),this.setDisabledSwitching()}resume(){this.setDisabledShooting(!1),this.setDisabledShotGuide(!1),this.setDisabledSwitching(!1)}setBallPool(e){return this.bulletBallPool=e,this}setLayoutData(e){return this.layoutData=e,this}initBullet(){const e=1/this.scene.world.getPixelRatio(),t=this.bulletBallPool.spawn(this.shootingPosition.x,this.shootingPosition.y,this.layoutData.getRandomBulletColor());this.currentBullet?.kill(),this.currentBullet=t;const s=this.bulletBallPool.spawn(this.nextShootingPosition.x,this.nextShootingPosition.y,this.layoutData.getRandomBulletColor());s.scale=e*this.nextBulletScale,this.nextBullet=s,this.shooterState=Se.READY}setGuide(e){this.shotGuide=e}attachBomb(e=!1){if(this.bomb)return;if(this.shooterState=Se.LOADING,this.currentBullet){const n=this.currentBullet.takeStamp();n&&(n.setVisible(!1),this.stampQueue.push(n)),this.currentBullet.kill()}const t=this.layoutData.getBomb().setFlyingBehavior();t.scale=0,t.setPosition(this.shootingPosition.x,this.shootingPosition.y),t.fromGift=e,this.bomb=t,this.isBombAttached=!0;const s=1/this.scene.world.getPixelRatio();this.scene.add.tween({targets:t,scale:s,ease:Phaser.Math.Easing.Bounce.Out,duration:300,onComplete:()=>{this.shooterState=Se.READY}}),this.scene.add.sprite(t.x+10,t.y,"").play("showing-bomb-effect").setWorldSize(120,123),this.scene.audio.playSound(H.SHOWING_BOMB)}genNextBullet(){const e=1/this.scene.world.getPixelRatio(),t=this.bulletBallPool.spawn(this.nextShootingPosition.x,this.nextShootingPosition.y,this.layoutData.getRandomBulletColor());t.scale=0,this.stampQueue.length&&(t.setStamp(this.stampQueue[0]),this.stampQueue.splice(0,1)),this.nextBullet=t,this.scene.tweens.add({targets:t,scale:e*this.nextBulletScale,duration:300})}swapBalls(){if(this.isDisabledSwitching||this.shooterState!=Se.READY||this.isBombAttached)return;this.shooterState=Se.SWAPPING;const e=this.currentBullet;if(this.currentBullet=this.nextBullet,this.nextBullet=e,!this.currentBullet)return;const t=this.currentBullet.x-this.x,s=this.currentBullet.y-this.y,n=new Phaser.Math.Vector2(t,s),a=this.shootingPosition.x-this.x,r=this.shootingPosition.y-this.y,c=new Phaser.Math.Vector2(a,r),o=1/this.scene.world.getPixelRatio(),l=c.length();this.scene.tweens.add({targets:this.nextBullet,scale:o*this.nextBulletScale,duration:300}),this.scene.tweens.addCounter({from:c.angle(),to:n.angle(),duration:300,onUpdate:h=>{const d=h.getValue();this.nextBullet&&(this.nextBullet.x=this.x+Math.cos(d)*l,this.nextBullet.y=this.y+Math.sin(d)*l)}}),this.scene.tweens.add({targets:this.currentBullet,scale:o,duration:300}),this.scene.tweens.addCounter({from:n.angle()+2*Math.PI,to:c.angle(),duration:300,onUpdate:h=>{const d=h.getValue();this.currentBullet&&(this.currentBullet.x=this.x+Math.cos(d)*l,this.currentBullet.y=this.y+Math.sin(d)*l)},onComplete:()=>{this.shooterState=Se.READY}})}attachBullet(){if(!this.scene||this.shooterState==Se.LOADING||(this.currentBullet=this.nextBullet,this.genNextBullet(),!this.currentBullet))return;this.shooterState=Se.LOADING;const e=this.currentBullet.x-this.x,t=this.currentBullet.y-this.y,s=new Phaser.Math.Vector2(e,t),n=this.shootingPosition.x-this.x,a=this.shootingPosition.y-this.y,r=new Phaser.Math.Vector2(n,a),c=r.length(),o=1/this.scene.world.getPixelRatio();this.scene.tweens.add({targets:this.currentBullet,scale:o,duration:300}),this.scene.tweens.addCounter({from:s.angle()+2*Math.PI,to:r.angle(),duration:300,onUpdate:l=>{if(!this.currentBullet?.active){l.stop();return}const h=l.getValue();this.currentBullet.x=this.x+Math.cos(h)*c,this.currentBullet.y=this.y+Math.sin(h)*c},onComplete:()=>{this.shooterState=Se.READY}})}updateAngle=e=>{const t=e.worldX-this.shootingPosition.x,s=e.worldY-this.shootingPosition.y,n=new Phaser.Math.Vector2(t,s);n.normalize(),this.shootingAngle.copy(n)};update(e){this.shooterState===Se.READY?this.updateHighLightCircle(e,!1):this.updateHighLightCircle(e,!0);let t=this.isDisabledShotGuide||this.shooterState!=Se.READY;if(GameCore.Utils.Device.isDesktop()?this.isPointerMoveInShootingArea||(t=!0):this.isPointerMoveInShootingArea||(t=!0),this.shootingAngle.angle()<this.constraintAngle(this.shootingAngle).angle()&&(t=!0),t){this.shotGuide?.hide(),this.setDisabledShooting(!0);return}this.setDisabledShooting(!1),this.updateShootingAngle(e)}updateShootingAngle(e){if(this.isBombAttached){if(!this.bomb)return;this.shotGuide?.showFrom(this.bomb.x,this.bomb.y,this.constraintAngle(this.shootingAngle),Z.Bomb,e)}else{if(!this.currentBullet)return;this.shotGuide?.showFrom(this.currentBullet.x,this.currentBullet.y,this.constraintAngle(this.shootingAngle),this.currentBullet.getColor(),e)}}updateHighLightCircle(e,t){t?(this.highlightCircle.setVisible(!1),this.fireCircle.setVisible(!1)):(this.isBombAttached?(this.fireCircle.setVisible(!0),this.highlightCircle.setVisible(!1)):(this.highlightCircle.setVisible(!0),this.fireCircle.setVisible(!1)),this.highlightCircle.rotation+=3*e/1e3)}shoot(e){if(this.isDisabledShooting||this.shooterState!=Se.READY)return;const t=e.worldX-this.shootingPosition.x,s=e.worldY-this.shootingPosition.y,n=new Phaser.Math.Vector2(t,s);if(n.normalize(),this.scene.audio.playSound(H.SHOOT_BALL),this.isBombAttached){if(!this.bomb)return;this.bomb.launch(this.constraintAngle(n)),this.bomb=void 0,this.scene.events.emit(ee.SHOOT_BALL,this.currentBullet),this.isBombAttached=!1}else{if(!this.currentBullet)return;this.currentBullet.launch(this.constraintAngle(n)),this.scene.events.emit(ee.SHOOT_BALL,this.currentBullet),this.currentBullet=void 0}this.scene.time.addEvent({delay:this.timeToReloadBullet,callback:()=>{this.attachBullet()}}),this.shotGuide?.hide(),this.shooterState=Se.SHOOTING}setDisabledShooting(e=!0){this.isDisabledShooting=e}setDisabledSwitching(e=!0){this.isDisabledSwitching=e}setDisabledShotGuide(e=!0){this.isDisabledShotGuide=e}hideShotGuide(){this.shotGuide?.hide()}destroy(){this.scene&&(this.bomb?.kill(),this.isBombAttached=!1,this.currentBullet&&(this.currentBullet.kill(),this.currentBullet=void 0),this.nextBullet&&(this.nextBullet.kill(),this.nextBullet=void 0),this.shotGuide.destroy(),this.scene.events.off("multiplierChanged"),this.scene.screen.events.off(GameCore.Screens.Events.CLOSE,this.handleCloseScreen),this.scene.input.off(tn,this.onPointerDown),this.scene.input.off(Sr,this.onPointerMove),this.scene.input.off(Ar,this.onPointerUp),this.layoutData.destroy(),this.stampQueue.forEach(e=>e.kill()),super.destroy())}updateMultiplier(){const e=this.scene.registry.get("gameData").multiplier;this.multiplierText.setText(`x${e}`)}constraintAngle(e){const t=this.scene.data.get("shootingAngle")*Math.PI/180,s=e.clone();return s.rotate(-Math.PI/2),s.angle()<Math.PI/2+t&&s.setAngle(Math.PI/2+t),s.angle()>3*Math.PI/2-t&&s.setAngle(3*Math.PI/2-t),s.rotate(Math.PI/2),s}handleCloseScreen=()=>{this.scene.input.setTopOnly(!0);const e=this.scene.input.activePointer;if(!e.active||e.worldY<80)return;const t=e.worldX-this.shootingPosition.x,s=e.worldY-this.shootingPosition.y,n=new Phaser.Math.Vector2(t,s);n.normalize(),this.shootingAngle.copy(n)}}class cs extends os{constructor(e){super(e),this.scene.pauseButton.kill(),e.destroyGamePlay()}ready(){const e=new Ms(this.scene);this.scene.stateManager.transitionTo(e)}play(){}pause(){}rescue(){}gameOver(){}quit(){}update(e){}}class kl extends os{constructor(e){super(e),e.pauseGame()}ready(){this.scene.resumeGame();const e=new Ms(this.scene);this.scene.stateManager.transitionTo(e)}play(){this.scene.resumeGame();const e=new Li(this.scene);this.scene.stateManager.transitionTo(e)}pause(){}rescue(){}gameOver(){}quit(){this.scene.resumeGame();const e=new cs(this.scene);this.scene.stateManager.transitionTo(e)}update(e){}}class Nl extends os{constructor(e){super(e),e.pauseGame();const t=e.scoreCounter.getScore(),s=e.registry.get("log_level");if(e.storage.dispatch(Ks({score:t,level:s})),e.data.values.life<1){e.time.delayedCall(0,e.stateManager.gameOver);return}e.analytics.gameLifeEnd(1,0,t),e.data.values.life-=1,e.screen.open(L.RESCUE_SCREEN),e.analytics.levelRescue(s,t,`level_${s}`)}ready(){}play(){const e=this.scene;e.resumeGame(),e.descentController.handleRescue(),e.grid.resetAlphaForAllBalls();const t=new Li(this.scene);this.scene.stateManager.transitionTo(t)}pause(){}rescue(){}gameOver(){this.scene.resumeGame();const e=new Ll(this.scene);this.scene.stateManager.transitionTo(e)}quit(){const e=new cs(this.scene);this.scene.stateManager.transitionTo(e)}update(e){}}class dS extends os{constructor(e){super(e),e.isNeedShowGuide&&(e.isNeedShowGuide=!1,e.screen.open(L.GUIDE_SCREEN),e.analytics.event(V.TUTORIAL_BEGIN),this.scene.player.incUserGuideDisplays()),e.shooter.resume()}ready(){}play(){}pause(){this.scene.pauseGame();const e=new kl(this.scene);this.scene.stateManager.transitionTo(e)}rescue(){const e=new Nl(this.scene);this.scene.stateManager.transitionTo(e)}gameOver(){}quit(){const e=new cs(this.scene);this.scene.stateManager.transitionTo(e)}update(e){this.scene.shooter.update(e),this.scene.descentController.update(e)}}const Li=dS;var Ml=(i=>(i[i.Beginning=0]="Beginning",i[i.Descending=1]="Descending",i[i.Reversing=2]="Reversing",i[i.Holding=3]="Holding",i))(Ml||{});const ue=Ml;class pS{scene;ballGrid;speed;speedFactor=1;speedRate=1;distanceWillBeMove=0;moveRatio=.5;state=ue.Holding;zone;movingConfigs;levelUpSetting;bombForce;dangerTimer;setSpeedTween;toSpeed=0;isReversing;reversingTween;constructor(e,t,s=0){this.scene=e,this.ballGrid=t,this.speed=s,this.zone=this.scene.registry.get("zones").zones,this.movingConfigs=this.scene.registry.get("zones").speed,this.levelUpSetting=this.scene.registry.get("levelUpSetting"),this.bombForce=this.scene.registry.get("bombForce"),this.dangerTimer=this.scene.registry.get("dangerTimer")}getSpeedRate(){return this.speedRate}handleUseStampUp(){const{distance:e,duration:t}=this.bombForce;this.revert(e,t*2)}resetSpeedRate(){this.speedRate=1}handleRescue(){this.revert(300,2500),this.speedRate=(this.speedRate-1)*.5+1}setSpeedScale(e){this.speedFactor=e}handleFlyingDinoExploded(){this.speedRate*=this.levelUpSetting.levelUpSpeedRate}handleBombExplode(){const{distance:e,duration:t}=this.bombForce;this.revert(e,t)}initialize(){this.ballGrid.generate(4),this.scene.tweens.addCounter({from:0,to:200,duration:1500,onUpdate:e=>{const t=(e.getValue()||0)-(e.data[0].previous||0);this.moveGrid(t)},onComplete:this.scene.stateManager.play})}begin(){this.changeState(ue.Beginning,this.movingConfigs.slow);const e=this.scene.time.delayedCall(5e3,()=>{this.changeState(ue.Descending,this.movingConfigs.slow)});this.scene.events.emit(ee.TIMER_CREATED,e)}endanger(){const e=this.speed;this.changeState(ue.Holding);const{dangerTimer:t}=this;this.scene.audio.playSound(H.AOOGA),this.scene.tweens.addCounter({from:1,to:.3,yoyo:!0,duration:100,repeat:Math.floor(t/100/2),onUpdate:s=>{const n=this.ballGrid.getDangerRows;if(n.length<=0){if(s.remove(),this.ballGrid.resetAlphaForAllBalls(),this.state===ue.Descending)return;this.changeState(ue.Descending,e);return}n.forEach(a=>{a.forEach(r=>{r?.setAlpha(s.getValue()||0)})})},onComplete:this.scene.stateManager.rescue})}revert=(e,t)=>{if(e===0)return;const s=-e*1e3/t,n=this.speed;this.changeState(ue.Reversing,s),this.isReversing=!0,this.reversingTween=this.scene.tweens.addCounter({from:0,to:e,duration:t,onUpdate:a=>{const r=(a.getValue()||0)-(a.data[0].previous||0);this.moveGrid(-r)},onComplete:()=>{this.changeState(ue.Descending,n)},completeDelay:150})};checkGridToSpawnRow(){const e=this.ballGrid.firstRow;e&&e.count<e.size&&this.ballGrid.spawnRow(),this.ballGrid.topY>-40&&this.ballGrid.spawnRow(),this.ballGrid.totalBalls<=11&&this.ballGrid.spawnRow()}moveGrid(e,t=0){this.distanceWillBeMove+=e;const s=this.moveRatio;if(Math.abs(this.distanceWillBeMove+t)<s)return;const n=Math.round(this.distanceWillBeMove/s)*s;this.ballGrid.moveBy(n,t),this.distanceWillBeMove-=n,this.checkGridToSpawnRow()}getSpeed(){return this.speed}setSpeed(e,t=!1){if(t){this.setSpeedTween?.complete(),this.speed=e,this.toSpeed=e;return}if(e==this.toSpeed||this.setSpeedTween?.isPlaying())return;const s=e>this.toSpeed?1e3:0;this.setSpeedTween=this.scene.tweens.addCounter({from:this.toSpeed,to:e,duration:1e3,delay:s,onUpdate:n=>{this.speed=n.getValue()}}),this.toSpeed=e}changeState=(e,t=0)=>{switch(this.state){case ue.Reversing:{this.setSpeed(t*.8,!0),this.isReversing=!1;break}case ue.Holding:{this.setSpeed(t*.8,!0),this.isReversing=!1;break}}switch(e){case ue.Beginning:{this.setSpeed(t,!0),this.isReversing=!1;break}case ue.Descending:{this.setSpeed(t),this.isReversing=!1;break}case ue.Reversing:{this.setSpeed(t,!0),this.isReversing=!0;break}case ue.Holding:{this.setSpeed(0,!0);break}}this.state=e};update(e){if(this.isReversing)return;const t=this.ballGrid.bottomY,s=(t<100,0);switch(this.state){case ue.Beginning:{this.moveGrid(Phaser.Math.GetSpeed(this.speed,1)*e*this.speedFactor,s);break}case ue.Descending:{if(t>this.zone.zone5.topY)this.endanger();else if(t>this.zone.zone4.topY)this.setSpeed(this.movingConfigs.slow*this.speedRate);else if(t>this.zone.zone3.topY)this.setSpeed(this.movingConfigs.medium*this.speedRate);else if(t>this.zone.zone2.topY)this.setSpeed(this.movingConfigs.fast*this.speedRate);else{const n=(this.zone.zone2.topY-t)/this.zone.zone2.topY+1;this.setSpeed(this.movingConfigs.fast*this.speedRate*n)}this.moveGrid(Phaser.Math.GetSpeed(this.speed,1)*e*this.speedFactor,s);break}}}}const{KEY:ei,FRAME:ti}=_.GAMEPLAY.GAMEPLAY_TEXTURES;class gS extends Phaser.GameObjects.Container{progressBg;progressTop;progressMiddle;progressBottom;bottomY=39;fullBarHeight=79;fullMiddleHeight=53;progressFragmentHeight=13;progressFragmentWidth=18;constructor(e,t,s){super(e,t,s),this.setDepth(z.ITEM),this.createProgressBar(),this.scene.add.existing(this)}createProgressBar(){this.progressBg=this.scene.add.image(0,0,ei,ti.PROGRESS_BG),this.progressBg.setWorldSize(18,90),this.progressTop=this.scene.add.image(0,this.bottomY-this.progressFragmentHeight-this.fullMiddleHeight,ei,ti.PROGRESS_TOP),this.progressTop.setOrigin(.5,1).setWorldSize(this.progressFragmentWidth,this.progressFragmentHeight),this.progressMiddle=this.scene.add.image(0,this.bottomY-this.progressFragmentHeight,ei,ti.PROGRESS_MIDDLE),this.progressMiddle.setOrigin(.5,1).setWorldSize(this.progressFragmentWidth,this.fullMiddleHeight),this.progressBottom=this.scene.add.image(0,this.bottomY,ei,ti.PROGRESS_BOTTOM),this.progressBottom.setOrigin(.5,1).setWorldSize(this.progressFragmentWidth,this.progressFragmentHeight),this.updateProgress(0),this.add([this.progressBg,this.progressTop,this.progressMiddle,this.progressBottom])}updateProgress(e){e>100&&(e=100);const t=Math.floor(e/100*this.fullBarHeight);if(t<=this.progressFragmentHeight)this.progressBottom.setVisible(!0).setDisplaySize(this.progressFragmentWidth,t),this.progressMiddle.setVisible(!1),this.progressTop.setVisible(!1);else if(t<=this.progressFragmentHeight+this.fullMiddleHeight){const s=t-this.progressFragmentHeight;this.progressBottom.setVisible(!0).setCrop(),this.progressMiddle.setVisible(!0).setWorldSize(this.progressFragmentWidth,s),this.progressTop.setVisible(!1)}else{const s=t-this.progressFragmentHeight-this.fullMiddleHeight;this.progressBottom.setVisible(!0).setCrop(),this.progressMiddle.setVisible(!0),this.progressTop.setVisible(!0).setDisplaySize(this.progressFragmentWidth,s)}}}const{KEY:mS,FRAME:fS}=_.GAMEPLAY.GAMEPLAY_TEXTURES;class yS{scene;level=1;flyingDinoPool;layoutData;nextLevelColor;warningSignal;progressBar;currentTime=0;totalTime=0;timeScale=1;alertMoment=0;alertDuration=1200;alerting=!1;isRunning=!1;isTakeOff=!1;isTicktock=!1;constructor(e){this.scene=e,this.createProgressBar(),this.createWarningSignal()}setFlyingDinoPool(e){this.flyingDinoPool=e}pause(){this.isRunning=!1}resume(){this.isRunning=!0,this.isTakeOff&&(this.isRunning=!1)}reset(){this.currentTime=0,this.alerting=!1,this.level=1,this.nextLevelColor=this.layoutData.getNextLevelColor(this.level+1),this.updateProgressBar(),this.warningSignal.kill()}setTimeScale(e){this.timeScale=e}start(){this.levelUpByTime(),this.initEvents(),this.level=1}startNextLevel(){this.levelUpByTime()}initEvents(){this.scene.events.off("update",this.update,this),this.scene.events.on("update",this.update,this)}levelUpByTime(){this.isRunning=!0,this.isTakeOff=!1;const e=this.scene.registry.get("levelUpSetting");this.totalTime=e.timeInterval,this.alertMoment=this.totalTime-this.alertDuration,this.alerting=!1,this.currentTime=0,this.isTicktock=!1}update(e,t){this.isRunning&&(this.currentTime+=t*this.timeScale,this.currentTime>this.totalTime&&(this.currentTime=this.totalTime),!this.isTicktock&&this.currentTime>this.totalTime-3500&&(this.scene.audio.playSound(H.TICKTOCK),this.scene.audio.playSound(H.WHIRLEYSIREN,{delay:1.5}),this.isTicktock=!0),this.updateProgressBar(),this.currentTime===this.totalTime&&(this.isRunning=!1,this.alerting=!1,this.level<7&&(this.spawnFlyingDino(),this.startNextLevel())))}createWarningSignal(){const e=this.scene.gameZone.height;this.warningSignal=this.scene.add.image(270,e-132,mS,fS.WARNING_SIGNAL),this.warningSignal.setOrigin(.5,.5),this.warningSignal.setWorldSize(60,60),this.warningSignal.setVisible(!1),this.warningSignal.setDepth(z.EFFECT)}raiseWarningSignal(){this.scene.audio.playSound(H.WARNING),this.warningSignal.revive();const e=this.scene.add.tween({targets:this.warningSignal,duration:this.alertDuration,props:{alpha:{duration:this.alertDuration/6,repeat:2,value:{from:0,to:1},yoyo:!0}},onComplete:()=>{this.warningSignal.kill(),e.remove()}})}createProgressBar(){const e=this.scene.gameZone.width,t=this.scene.registry.get("zones").zones;this.progressBar=new gS(this.scene,e-25,t.zone5.topY+70)}updateProgressBar(){const e=this.totalTime===0?0:this.currentTime/this.totalTime;this.currentTime>this.alertMoment&&this.alerting===!1&&(this.alerting=!0,this.raiseWarningSignal(),this.scene.vibrateController.handleAlertAboutFlyingDino(this.alertDuration)),this.progressBar.updateProgress(e*100)}spawnFlyingDino(){this.isTakeOff=!0,this.nextLevelColor=this.layoutData.getNextLevelColor(this.level+1);const e=this.flyingDinoPool.spawn(),t=this.scene.registry.get("zones").zones;e.setPosition(216.5,t.zone5.bottomY+20),e.takeOff(this.nextLevelColor)}levelUp(){this.level+=1,this.nextLevelColor=this.layoutData.getNextLevelColor(this.level+1),this.scene.registry.set("level",this.level),this.scene.events.emit("level-up")}setLayoutData(e){this.layoutData=e,this.nextLevelColor=this.layoutData.getNextLevelColor(this.level+1)}destroy(){this.scene&&(this.scene.events.off("update",this.update),this.scene.events.off("level-up"),this.progressBar.destroy(),this.isRunning=!1,this.warningSignal.destroy())}}class ES{scene;floatingScorePool;gameData;baseScore;multiplierCombo;multiplierBonus;bonusMultiplierTimerEvent;countCollectBalls;totalDynamiteCombos=0;isReachNewBestScore=!1;levelText;constructor(e){this.multiplierCombo=1,this.multiplierBonus=1,this.countCollectBalls=0,this.scene=e,this.gameData=this.scene.registry.get("gameData"),this.baseScore=this.gameData.baseScore,this.listenEvents(),GameCore.Utils.Valid.isDebugger()&&(this.levelText||(this.levelText=this.scene.add.text(20,400,""),this.levelText.setDepth(z.ON_TOP)),this.levelText.setText(""))}listenEvents(){this.scene.events.on("level-up",this.updateBaseScore)}updateBaseScore=()=>{const{levelScores:e}=this.gameData,t=this.scene.registry.get("level"),s=e[t-2]||0;this.baseScore+=s,GameCore.Utils.Valid.isDebugger()&&this.levelText.setText(`level: ${t}. BaseScore: ${this.baseScore}`)};setFloatingScorePool(e){this.floatingScorePool=e}addMultiplierBonusTimerEvent(e){this.multiplierBonus>1&&this.removeMultiplierBonusTimerEvent(),this.multiplierBonus=e;const t=this.scene.registry.get("stampTimer");this.bonusMultiplierTimerEvent=this.scene.time.addEvent({delay:t,callback:()=>{this.removeMultiplierBonusTimerEvent()}}),this.scene.events.emit(ee.TIMER_CREATED,this.bonusMultiplierTimerEvent)}removeMultiplierBonusTimerEvent(){this.bonusMultiplierTimerEvent?.remove(),this.bonusMultiplierTimerEvent=void 0,this.multiplierBonus=1,this.updateMultiplier()}updateMultiplier(){this.gameData.multiplier=this.multiplierCombo*this.multiplierBonus,this.scene.shooter.updateMultiplier()}increaseScore(e,t){const{multiplierBonus:s}=this,n=t?this.gameData.baseScore:this.baseScore,a=t?1:this.multiplierCombo,r=n*e*a*s;this.gameData.score+=r;const c=this.scene.player.getPlayerData(),{score:o=0}=c;this.gameData.score>o&&this.pushScoreAsync(this.gameData.score)}pushScoreAsync=Os(e=>{const t=this.scene.player.getPlayerId();Kf(t,e).catch(r=>{K(r)});const{player:s}=this.scene,n=s.getPlayerData(),{score:a=0}=n;if(a<e){this.isReachNewBestScore=!0,s.setBestScore(e);const r={score:e};this.scene.storage.dispatch(Ni(t,r))}},2e3);updateCombosMultiplier(){const e=this.scene.registry.get("maxCombos");this.gameData.combosCount>1&&this.gameData.combosCount<e?this.multiplierCombo=this.gameData.combosCount:this.multiplierCombo=1,this.updateMultiplier()}processCombos(e){const t=this.scene.registry.get("maxCombos");e?this.gameData.combosCount<t?(this.gameData.combosCount+=1,this.handleCombosIncreased(this.gameData.combosCount)):this.gameData.combosCount=0:(this.gameData.combosCount=0,this.handleCombosIncreased(this.gameData.combosCount))}handleCombosIncreased(e){const t=this.scene.audio;switch(this.scene.vibrateController.handleCombosIncreased(e),e){case 3:t.playSound(H.COMBO);break;case 4:t.playSound(H.SUPER_COMBO);break;case 5:t.playSound(H.CAMBRIAN_COMBO);break;case 6:t.playSound(H.TRIASSIC_COMBO);break;case 7:t.playSound(H.JURASSIC_COMBO);break;case 8:t.playSound(H.CRETACEOUS_COMBO);break;case 9:t.playSound(H.DYNOMITE_COMBO),this.totalDynamiteCombos+=1,this.scene.shooter.attachBomb(),this.scene.vibrateController.handleBombCreated();break}}processStamp(e,t,s,n){switch(s.getStampType()){case he.Stamp5:{this.increaseScore(5,!0),this.floatingScorePool.spawn(e,t-15,n,5*this.gameData.baseScore*this.multiplierBonus).setBigFloating().playAnimation();break}case he.Stamp10:{this.increaseScore(10,!0),this.floatingScorePool.spawn(e,t-15,n,10*this.gameData.baseScore*this.multiplierBonus).setBigFloating().playAnimation();break}case he.Stamp15:{this.increaseScore(15,!0),this.floatingScorePool.spawn(e,t-15,n,15*this.gameData.baseScore*this.multiplierBonus).setBigFloating().playAnimation();break}case he.Stamp2x:{this.addMultiplierBonusTimerEvent(2);break}case he.Stamp3x:{this.addMultiplierBonusTimerEvent(3);break}case he.Stamp4x:{this.addMultiplierBonusTimerEvent(4);break}case he.StampUp:{this.scene.descentController.handleUseStampUp();break}}s.kill(),this.updateMultiplier()}processBallDestroyed(e){e.forEach(t=>{const s=t.takeStamp();s&&this.processStamp(t.x,t.y,s,t.getColor()),this.floatingScorePool.spawn(t.x,t.y,t.getColor(),this.baseScore*this.gameData.multiplier).playAnimation(),this.increaseScore(1)}),this.countCollectBalls+=e.length,this.scene.events.emit(ee.SCORE_CHANGED)}reset(){this.multiplierCombo=1,this.multiplierBonus=1,this.bonusMultiplierTimerEvent?.destroy(),this.bonusMultiplierTimerEvent=void 0}getScore(){return this.gameData.score}getTotalBallsCollected(){return this.countCollectBalls}getTotalDynamiteCombos(){return this.totalDynamiteCombos}getIsReachNewBestScore(){return this.isReachNewBestScore}}class SS extends os{constructor(e){super(e),this.createNewGame(),e.time.delayedCall(400,()=>this.startGame()),e.ads.preloadRewardedVideoAsync().catch(t=>{}),e.ads.preloadInterstitialAdAsync().catch(()=>{})}createNewGame(){const e=this.scene;e.data.set("Mission",{totalFlyingDinos:0}),e.gameSettings.resetData(),e.data.set("life",GameCore.Configs.Gameplay.MaxRescueCount);const t=e.registry.get("zones").zones,{width:s}=e.gameZone;e.shooter=new uS(e,s*.5,t.zone5.topY+95);const n=new cS(e);n.setStampPool(e.stampPool),n.setBombPool(e.bombPool),e.ballLayoutData=n,e.shooter.setLayoutData(n),e.shooter.setBallPool(e.bulletBallPool),e.grid=new rS(e,e.gridBallPool),e.grid.setLayoutData(n),n.setBallGrid(e.grid),e.shotGuide.setBallGrid(e.grid),e.shooter.setGuide(e.shotGuide),e.descentController=new pS(e,e.grid),e.levelUpController=new yS(e),e.levelUpController.setLayoutData(n),e.levelUpController.setFlyingDinoPool(e.flyingDinoPool),e.scoreCounter=new ES(e),e.scoreCounter.setFloatingScorePool(e.floatingScorePool),this.listenEvents(),e.footer.playCharacterAnimation()}listenEvents(){this.scene.events.off(ee.TIMER_CREATED),this.scene.events.on(ee.TIMER_CREATED,e=>{this.scene.timerEvents.push(e)})}startGame=()=>{const e=this.scene;e.audio.playSound(H.START_GAME),e.registry.set("log_level",1);const t=e.storage.getState(),s=dt(t);e.gameModeManager.stop(),e.gameModeManager.setGameMode(s),e.startManager(),e.descentController.initialize(),e.shooter.initBullet(),e.events.once(ee.SHOOT_BALL,()=>{e.levelUpController.start(),e.grid.start(),e.descentController.begin(),this.scene.itemManager.start()})};ready(){}play(){this.scene.pauseButton.revive();const e=new Li(this.scene);this.scene.stateManager.transitionTo(e)}pause(){}rescue(){}gameOver(){}quit(){const e=new cs(this.scene);this.scene.stateManager.transitionTo(e)}update(e){}}const Ms=SS,xn=async(i,e)=>new Promise(t=>{i.time.delayedCall(e,t)});class AS extends os{constructor(e){super(e),this.scene.itemManager.stop(),this.handleGameOver()}async handleGameOver(){const e=this.scene;e.input.enabled=!1,e.grid?.dropAllBalls(),e.shooter.hideShotGuide(),e.levelUpController.pause(),e.events.emit(ee.GAME_OVER),await xn(e,1500),e.audio.playSound(H.GAMEOVER),e.screen.open(L.GAME_OVER_SCREEN),await xn(e,1500),this.handleShowInterstitialAd()}handleShowInterstitialAd=async()=>{const e=this.scene;e.gameOverScreen.once(GameCore.Screens.Events.CLOSE,this.handleFinishGame),e.gameOverScreen.closePopup()};handleFinishGame=()=>{const e=this.scene,t=e.registry.get("log_level"),{score:s}=e.registry.get("gameData");e.analytics.levelFail(t,s,`level_${t}`),this.scene.scoreCounter.getIsReachNewBestScore()&&e.analytics.gameMilestone("score",void 0,t,s),e.storage.dispatch(NA()),e.input.enabled=!0,this.updateDailyMission()};updateDailyMission(){this.emitTaskCompleteGame(),this.emitTaskCollectEggs(),this.emitTaskGetDynamiteCombo(),this.emitTaskUseRescue(),this.emitTaskHitFlyingDino(),this.emitTaskReachTargetPoints()}emitTaskCompleteGame(){q.emit(se.COMPLETE_GAMES.EVENTS.COMPLETE_GAME,{type:"complete-game",value:1})}emitTaskCollectEggs(){const e=this.scene.scoreCounter.getTotalBallsCollected();e>0&&q.emit(se.COLLECT_EGGS.EVENTS.COLLECT_EGGS,{type:"egg",value:e})}emitTaskGetDynamiteCombo(){const e=this.scene.scoreCounter.getTotalDynamiteCombos();e>0&&q.emit(se.GET_DINOMITE_COMBO.EVENTS.GET_DINOMITE_COMBO,{type:"dinomite-combo",value:e})}emitTaskUseRescue(){const e=this.scene.rescueScreen.getTotalUseRescue();e>0&&q.emit(se.USE_RESCUE.EVENTS.USE_RESCUE,{type:"use-rescue",value:e})}emitTaskHitFlyingDino(){const e=this.scene.data.get("Mission").totalFlyingDinos;e>0&&q.emit(se.SHOOT_FLYING_EGG.EVENTS.SHOOT_FLYING_EGG,{type:"flying-eggs",value:e})}emitTaskReachTargetPoints(){const e=this.scene.game.storage.getState(),t=ha(e);if(!t||t?.length<1)return;const s=t.find(o=>o.id===se.REACH_TARGET_POINTS.ID);if(!s)return;const{require:n}=s;if(Object.keys(s.require).indexOf("score")===-1)return;const{score:r}=n,{score:c}=this.scene.registry.get("gameData");!r||r>=c||q.emit(se.REACH_TARGET_POINTS.EVENTS.REACH_TARGET_POINTS,{type:"score",value:r})}ready(){const e=new Ms(this.scene);this.scene.stateManager.transitionTo(e)}play(){}pause(){}rescue(){}gameOver(){}quit(){const e=new cs(this.scene);this.scene.stateManager.transitionTo(e)}update(e){}}const Ll=AS;class bS extends $s{scene;gameState;constructor(e){super(e),this.scene=e}transitionTo(e){console.log("State transition: ",this.gameState,e),this.gameState=e}init(){if(!this.gameState){const e=new Ms(this.scene);this.transitionTo(e)}this.gameState.ready()}ready=()=>{this.gameState.ready()};play=()=>{this.gameState.play()};pause=()=>{this.gameState.pause()};rescue=()=>{this.gameState.rescue()};gameOver=()=>{this.gameState.gameOver()};quit=()=>{this.gameState.quit()};update=e=>{this.gameState.update(e)};isPlaying(){return this.gameState instanceof Li}isGameOver=()=>this.gameState instanceof Ll;isReady=()=>this.gameState instanceof Ms;isPaused=()=>this.gameState instanceof kl;isQuit=()=>this.gameState instanceof cs;isRescue=()=>this.gameState instanceof Nl}const TS=i=>{if(!GameCore.Utils.Valid.isDebugger())return;const{KEY:e,FRAME:t}=_.DEFAULT,s=new Q(i,e,t.BUTTON_CLOSE,48.5,43);s.setAlpha(.3),s.onClick=i.stateManager.rescue,Phaser.Display.Align.In.RightCenter(s,i.header,-10,0);const n=new Q(i,e,t.BUTTON_BLUE,40,40);let a=!1;n.setAlpha(.6),n.onClick=()=>{a?(i.descentController.setSpeedScale(1),a=!1,n.setAlpha(.6)):(i.descentController.setSpeedScale(10),a=!0,n.setAlpha(1))},Phaser.Display.Align.In.BottomRight(n,i.header,-10,60);const r=new Q(i,e,t.BUTTON_GREEN,40,40);let c=!1;r.setAlpha(.6),r.onClick=()=>{c?(i.levelUpController.setTimeScale(1),c=!1,r.setAlpha(.6)):(i.levelUpController.setTimeScale(4),c=!0,r.setAlpha(1))},Phaser.Display.Align.In.BottomRight(r,i.header,-10,100);const o=i.make.bitmapText({font:B.PRIMARY.KEY,size:i.fontSize(15),text:"speed: 0",origin:{x:0,y:.5}});o.setDepth(z.BUTTON),Phaser.Display.Align.In.LeftCenter(o,i.gameZone,-5,-5),i.events.on("update",()=>{const p=Math.round(i.descentController?.getSpeed()*10||0)/10;o.setText(`speed: ${p}`)});const l=i.make.bitmapText({font:B.PRIMARY.KEY,size:i.fontSize(15),text:"speed: 0",origin:{x:0,y:.5}});l.setDepth(z.BUTTON),Phaser.Display.Align.In.LeftCenter(l,i.gameZone,-5,-20),i.events.on("update",()=>{const p=Math.round(i.grid.bottomY||0);l.setText(`bottom Y: ${p}`)});const h=i.make.bitmapText({font:B.PRIMARY.KEY,size:i.fontSize(10),text:'Message: ""',origin:{x:0,y:0},alpha:.7});h.setDepth(z.BUTTON),Phaser.Display.Align.In.LeftCenter(h,i.gameZone,-5,10);const d=i.add.container(0,0);d.add([s,n,r,o,l,h]),d.setVisible(!1),d.setDepth(z.BUTTON);const u=new Q(i,e,t.BLANK,40,40);u.onClick=()=>{d.setVisible(!d.visible)},u.setAlpha(.005),Phaser.Display.Align.In.BottomLeft(u,i.gameZone,0,-50)},{KEY:wS,FRAME:sn}=_.GAMEPLAY.GAMEPLAY_TEXTURES;class CS extends Phaser.GameObjects.Particles.ParticleEmitterManager{constructor(e){super(e,wS),this.setDepth(z.SPRITES),this.scene.add.existing(this)}createTailEmitter(){const e=1/this.scene.world.getPixelRatio(),t={x:200,y:200,frame:[sn.PARTICLE_STAR,sn.PARTICLE_CIRCLE_1,sn.PARTICLE_CIRCLE_2],angle:{min:45,max:135},scale:{start:e,end:0},alpha:{start:.7,end:0},speed:{min:50,max:100},frequency:20,quantity:5,tint:16777215,lifespan:{min:500,max:1500},on:!1};return this.createEmitter(t)}}class IS extends $s{scene;constructor(e){super(e),this.scene=e}init(){this.addCollision()}addCollision(){const e=this.scene,t=e.physics;t.add.collider(e.bulletBallPool,e.gridBallPool,this.handleBallHitGrid),t.add.collider(e.bombPool,e.gridBallPool,this.handleBombHitGrid),t.add.overlap(e.flyingDinoPool.getPhysicsObjects(),e.bulletBallPool,this.handleBallHitFlyingDino),t.add.overlap(e.flyingDinoPool.getPhysicsObjects(),e.bombPool,this.handleBombHitFlyingDino,void 0,e)}handleBallHitGrid=(e,t)=>{if(!(e instanceof Ai)||!(t instanceof bi))return!1;if(!(!e.body.enable||!t.body.enable))return e.body.enable=!1,e.setVisible(!1),this.scene.time.delayedCall(0,()=>{this.scene.grid.attachBall(e,t),e.preKill()}),!0};handleBombHitGrid=(e,t)=>{if(!(e instanceof Ol)||!(t instanceof bi))return!1;const s=this.scene;return this.scene.time.delayedCall(0,()=>{e.body.enable&&(s.animationsManager.handleBombWillBeDestroyed(e),this.scene.vibrateController.handleBombexploding(),e.makeExplosion(),s.audio.playSound(H.BOMB_EXPLODE),s.time.delayedCall(130,()=>{s.descentController.handleBombExplode()})),e.body.enable=!1,e.fromGift||this.scene.scoreCounter.processCombos(!0),s.grid.destroyNeighBors(e.x,e.y,t)}),!0};handleBallHitFlyingDino=(e,t)=>{const s=this.scene;if(!(t instanceof Ai))return!1;const n=e.parentContainer;if(!n||!(n instanceof Rn)||!t.body.enable)return!1;s.data.get("Mission").totalFlyingDinos+=1;const a=s.gridBallPool.spawn(n.x,n.y,n.getCurrentColor());return s.animationsManager.handleBallsWillBeDestroyed([t,a]),t.preKill(),a.kill(),s.descentController.handleFlyingDinoExploded(),s.audio.playSound(H.WHIRLEY_HIT),n.fly(),!0};handleBombHitFlyingDino=(e,t)=>{const s=this.scene,n=e.body;if(n instanceof Phaser.Physics.Arcade.Body&&!n.enable)return;const a=e.parentContainer;if(!a||!(a instanceof Rn))return!1;const r=s.gridBallPool.spawn(a.x,a.y,a.getCurrentColor());return this.scene.animationsManager.handleBallsWillBeDestroyed([r]),r.kill(),s.descentController.handleFlyingDinoExploded(),s.audio.playSound(H.WHIRLEY_HIT),a.fly(),!0}}const{KEY:yt,FRAME:PS}=_.EFFECTS,Et=PS,ae={CONFETTI_HEXAGON:{KEY:"confetti-hexagon-animation",TEXTURE:yt,PREFIX:Et.FX_CONFETTI_HEXAGON,FRAME_RATE:8,END:5,ZERO_PAD:0},CONFETTI_STAR_X:{KEY:"confetti-star-x",TEXTURE:yt,PREFIX:Et.ANIMATION_STAR_X,FRAME_RATE:4,END:4,ZERO_PAD:0},CONFETTI_STAR_Y:{KEY:"confetti-star-y",TEXTURE:yt,PREFIX:Et.ANIMATION_STAR_Y,FRAME_RATE:4,END:4,ZERO_PAD:0},RIBBON_A:{KEY:"animation-ribbon-a",TEXTURE:yt,PREFIX:Et.PREFIX_ANIMATION_RIBBON_CONFETTI_A,FRAME_RATE:16,END:3,ZERO_PAD:0},RIBBON_B:{KEY:"animation-ribbon-b",TEXTURE:yt,PREFIX:Et.PREFIX_ANIMATION_RIBBON_CONFETTI_B,FRAME_RATE:16,END:4,ZERO_PAD:0},RIBBON_C:{KEY:"animation-ribbon-c",TEXTURE:yt,PREFIX:Et.PREFIX_ANIMATION_RIBBON_CONFETTI_C,FRAME_RATE:16,END:4,ZERO_PAD:0},RIBBON_D:{KEY:"animation-ribbon-d",TEXTURE:yt,PREFIX:Et.PREFIX_ANIMATION_RIBBON_CONFETTI_D,FRAME_RATE:16,END:4,ZERO_PAD:0}},{KEY:vS,TEXTURE:OS,FRAME_RATE:_S,END:RS,PREFIX:xS,ZERO_PAD:DS}=ae.RIBBON_A;class BS extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:_S,frames:e.generateFrameNames(OS,{prefix:xS,end:RS,zeroPad:DS,start:1}),yoyo:!0,showOnStart:!0};super(e,vS,t)}}const{KEY:kS,TEXTURE:NS,FRAME_RATE:MS,END:LS,PREFIX:GS,ZERO_PAD:FS}=ae.RIBBON_B;class US extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:MS,frames:e.generateFrameNames(NS,{prefix:GS,end:LS,zeroPad:FS,start:1}),yoyo:!0,showOnStart:!0};super(e,kS,t)}}const{KEY:YS,TEXTURE:HS,FRAME_RATE:zS,END:WS,PREFIX:VS,ZERO_PAD:KS}=ae.RIBBON_C;class $S extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:zS,frames:e.generateFrameNames(HS,{prefix:VS,end:WS,zeroPad:KS,start:1}),yoyo:!0,showOnStart:!0};super(e,YS,t)}}const{KEY:jS,TEXTURE:XS,FRAME_RATE:qS,END:ZS,PREFIX:JS,ZERO_PAD:QS}=ae.RIBBON_D;class eA extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:qS,frames:e.generateFrameNames(XS,{prefix:JS,end:ZS,zeroPad:QS,start:1}),yoyo:!0,showOnStart:!0};super(e,jS,t)}}const{KEY:tA,TEXTURE:sA,FRAME_RATE:iA,END:nA,PREFIX:aA,ZERO_PAD:rA}=ae.CONFETTI_STAR_X;class oA extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:iA,frames:e.generateFrameNames(sA,{prefix:aA,end:nA,zeroPad:rA,start:1}),yoyo:!0,showOnStart:!0};super(e,tA,t)}}const{KEY:cA,TEXTURE:lA,FRAME_RATE:hA,END:uA,PREFIX:dA,ZERO_PAD:pA}=ae.CONFETTI_STAR_Y;class gA extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:hA,frames:e.generateFrameNames(lA,{prefix:dA,end:uA,zeroPad:pA,start:1}),showOnStart:!0};super(e,cA,t)}}class br extends Phaser.GameObjects.Particles.Particle{scene;ribbon;graphics;colorUse;lastChange;currentFrame;isYoyo;isGravityChanged;dtCount;points;constructor(e){super(e),this.scene=e.manager.scene,this.points=new Array(10).fill(null).map(()=>({x:0,y:0})),this.isYoyo=!1,this.isGravityChanged=!1,this.lastChange=0,this.currentFrame=-1,this.dtCount=0,this.createGraphics(),this.randomRibbonUsedWhenFall()}randomRibbonUsedWhenFall(){switch(Phaser.Math.Between(0,3)){case 0:this.ribbon=this.scene.anims.get(ae.RIBBON_A.KEY);break;case 1:this.ribbon=this.scene.anims.get(ae.RIBBON_B.KEY);break;case 2:this.ribbon=this.scene.anims.get(ae.RIBBON_C.KEY);break;case 3:this.ribbon=this.scene.anims.get(ae.RIBBON_D.KEY);break;default:this.ribbon=this.scene.anims.get(ae.RIBBON_A.KEY);break}}setRibbonPosition(e,t){this.points.map(s=>{s.x=e,s.y=t})}createGraphics(){const e=[8443204,2928867,12013036,16376097,15285798];this.colorUse=e[Phaser.Math.Between(0,e.length-1)],this.graphics=this.scene.add.graphics({lineStyle:{width:3,color:this.colorUse}});const{x:t,y:s,depth:n}=this.emitter.manager;this.graphics.setDepth(n),this.graphics.setPosition(t,s)}update(e,t,s){const n=super.update(e,t,s);return this.updateColor(),this.updateFrames(e),this.dtCount+=e,this.dtCount<1e3/40||(this.dtCount-=1e3/40,this.graphics.setAlpha(this.lifeCurrent/this.life),this.alpha=this.lifeCurrent/this.life,this.updatePoints(),this.updateGraphics(),this.updateGravity(),this.updateVelocity()),n}updateFrames(e){this.lastChange+=e,this.lastChange>=this.ribbon.msPerFrame&&(this.isYoyo?this.currentFrame--:this.currentFrame++,this.currentFrame<0&&(this.isYoyo=!1,this.currentFrame=1),this.currentFrame>=this.ribbon.frames.length&&(this.isYoyo=!0,this.currentFrame-=1),this.frame=this.ribbon.frames[this.currentFrame].frame,this.lastChange-=this.ribbon.msPerFrame)}updatePoints(){this.graphics.visible&&(this.points.shift(),this.points.push({x:this.x,y:this.y}))}updateGraphics(){if(this.graphics.visible){for(const e of this.points)if(e.y===0)return;this.graphics.clear(),this.graphics.strokePoints(this.points)}}updateGravity(){this.lifeCurrent>this.life-2100||this.isGravityChanged||(this.isGravityChanged=!0,this.graphics.destroy(),this.emitter.setVisible(!0),this.emitter.setGravityY(45))}updateVelocity(){if(this.graphics.visible){if(this.velocityX>this.maxVelocityX&&(this.velocityX=this.maxVelocityX),this.velocityX<-this.maxVelocityX&&(this.velocityX=-this.maxVelocityX),this.lifeCurrent>this.life-1800){this.velocityX+=Phaser.Math.Between(-10,10);return}this.velocityX>0?this.velocityX+=Phaser.Math.Between(-8,6):this.velocityX+=Phaser.Math.Between(-6,8)}}updateColor(){this.graphics.visible||(this.tint=this.colorUse)}kill(){this.graphics.destroy()}}class mA extends Phaser.GameObjects.Particles.Particle{scene;isYoyo;isGravityChanged;lastChange;currentFrame;star;starX;starY;dtCount;constructor(e){super(e),this.isYoyo=!1,this.isGravityChanged=!1,this.lastChange=0,this.currentFrame=-1,this.scene=e.manager.scene,this.starX=this.scene.anims.get(ae.CONFETTI_STAR_X.KEY),this.starY=this.scene.anims.get(ae.CONFETTI_STAR_Y.KEY),this.star=this.starX,this.dtCount=0}update(e,t,s){const n=super.update(e,t,s);return this.updateFrames(e),this.dtCount+=e,this.dtCount<1e3/60||(this.dtCount-=1e3/60,this.updateFrameRate(),this.updateGravity(),this.updateVelocity()),n}updateGravity(){this.lifeCurrent>this.life-2e3||this.isGravityChanged||(this.isGravityChanged=!0,this.emitter.setGravityY(15),this.emitter.setSpeedX(0))}updateVelocity(){this.lifeCurrent>this.life-2e3||(this.velocityX>0?this.velocityX+=Phaser.Math.Between(-6,3):this.velocityX+=Phaser.Math.Between(-3,6))}updateFrames(e){if(this.lastChange+=e,this.lastChange>=this.star.msPerFrame){const t=Phaser.Math.RND.between(0,1);this.star=t>0?this.starX:this.starY,this.isYoyo?this.currentFrame--:this.currentFrame++,this.currentFrame<0&&(this.isYoyo=!1,this.currentFrame=1,this.emitter.setAlpha(1)),this.currentFrame>=this.star.frames.length&&(this.isYoyo=!0,this.currentFrame-=1,this.emitter.setAlpha(.8)),this.frame=this.star.frames[this.currentFrame].frame,this.lastChange-=this.star.msPerFrame}}updateFrameRate(){this.lifeCurrent<this.life-2e3?this.star.msPerFrame=150:this.star.msPerFrame=Phaser.Math.RND.between(300,600)}}const{KEY:fA,FRAME:nn}=_.EFFECTS;class ua extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitterConfetti;emitterRibbons;ribbonConfig;confettiConfig;width;height;constructor(e){super(e,fA,nn.BLANK),this.emitterRibbons=[],this.emitterConfetti=[],this.createConfigs(),this.createAnimations(),this.scene.add.existing(this)}createConfigs(){const e=[8443204,2928867,12013036,16376097,15285798],t=1/GameCore.Utils.Image.getImageScale();this.ribbonConfig={on:!1,visible:!1,timeScale:1.5,frame:nn.BLANK,particleBringToTop:!0,speedY:{min:-480,max:-560},gravityY:290,lifespan:{min:4500,max:5500},rotate:{start:0,end:360*5,random:!0},scale:{min:t*.6,max:t},particleClass:br,maxVelocityX:120},this.confettiConfig={on:!1,delay:200,timeScale:2,tint:e,particleBringToTop:!0,frame:nn.PREFIX_ANIMATION_RIBBON_CONFETTI_A+"1",speedY:{min:-460,max:-580},gravityY:280,lifespan:{min:5e3,max:6e3},rotate:{start:0,end:360*3},scale:{min:t*.6,max:t},particleClass:mA}}createAnimations(){if(!this.scene.anims.get(ae.CONFETTI_STAR_X.KEY)){const e=new oA(this.scene.anims);this.scene.anims.add(ae.CONFETTI_STAR_X.KEY,e)}if(!this.scene.anims.get(ae.CONFETTI_STAR_Y.KEY)){const e=new gA(this.scene.anims);this.scene.anims.add(ae.CONFETTI_STAR_Y.KEY,e)}if(!this.scene.anims.get(ae.RIBBON_A.KEY)){const e=new BS(this.scene.anims);this.scene.anims.add(ae.RIBBON_A.KEY,e)}if(!this.scene.anims.get(ae.RIBBON_B.KEY)){const e=new US(this.scene.anims);this.scene.anims.add(ae.RIBBON_B.KEY,e)}if(!this.scene.anims.get(ae.RIBBON_C.KEY)){const e=new $S(this.scene.anims);this.scene.anims.add(ae.RIBBON_C.KEY,e)}if(!this.scene.anims.get(ae.RIBBON_D.KEY)){const e=new eA(this.scene.anims);this.scene.anims.add(ae.RIBBON_D.KEY,e)}}run(e,t,s,n){this.setPosition(e,t),this.width=s,this.height=n,this.createEmitters(),this.emitterConfetti.forEach(a=>{a.emitParticle(25)}),this.emitterRibbons.forEach(a=>{a.emitParticle(20)})}stop(){this.emitterConfetti.forEach(e=>{e.killAll()}),this.emitterRibbons.forEach(e=>{e.killAll(),e.forEachDead(t=>{t instanceof br&&t.kill()},this)}),this.kill()}createEmitters(){this.emitterRibbons=[],this.emitterConfetti=[],this.createConfettiLeftEmitter(),this.createConfettiRightEmitter(),this.createRibbonLeftEmitter(),this.createRibbonRightEmitter()}createConfettiLeftEmitter(){const e={...this.confettiConfig,speedX:{min:5,max:90}},t=this.createEmitter(e);this.emitterConfetti.push(t)}createConfettiRightEmitter(){const{width:e}=this,t={...this.confettiConfig,x:e,speedX:{min:-5,max:-90}},s=this.createEmitter(t);this.emitterConfetti.push(s)}createRibbonLeftEmitter(){const e={...this.ribbonConfig,speedX:{min:20,max:80},emitCallback:s=>{s.setRibbonPosition(0,0)}},t=this.createEmitter(e);this.emitterRibbons.push(t)}createRibbonRightEmitter(){const{width:e}=this,t={...this.ribbonConfig,x:e,speedX:{min:-20,max:-80},emitCallback:n=>{n.setRibbonPosition(e,0)}},s=this.createEmitter(t);this.emitterRibbons.push(s)}}const{KEY:yA,FRAME:EA}=_.GAMEPLAY.GAMEPLAY_TEXTURES;class SA extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitter1;emitter2;constructor(e){super(e,yA),this.setDepth(z.SPRITES),this.scene.add.existing(this),this.createExplodeAnimation1(),this.createExplodeAnimation2()}createExplodeAnimation1(){const e=1/this.scene.world.getPixelRatio(),s={frame:Array(6).fill(null).map((n,a)=>EA.BOMB_FRAGMENT+(a+1)),lifespan:750,accelerationY:50,angle:{start:0,end:360,steps:34},speed:{start:20,end:120,steps:8},alpha:{start:1,end:.1},scale:{min:e*.2,max:e*.5},on:!1};this.emitter1=this.createEmitter(s),this.emitter1.setTint(16403978)}createExplodeAnimation2(){const{FRAME:e}=_.GAMEPLAY.GAMEPLAY_TEXTURES,t=1/this.scene.world.getPixelRatio(),n={frame:Array(6).fill(null).map((a,r)=>e.BOMB_FRAGMENT+(r+1)),lifespan:750,speed:{min:20,max:80},angle:{start:0,end:360,steps:18},alpha:{start:1,end:.2},scale:{start:t*1.2,end:t*.6},on:!1};this.emitter2=this.createEmitter(n)}explode(e,t){this.emitter1.explode(170,e,t),this.emitter2.explode(15,e,t)}stop(){this.emitter1.killAll(),this.emitter2.killAll()}}const{KEY:AA,FRAME:bA}=_.GAMEPLAY.GAMEPLAY_TEXTURES;class TA extends Phaser.GameObjects.Particles.ParticleEmitterManager{explosiveEmitters;constructor(e){super(e,AA),this.setDepth(z.BULLET),this.explosiveEmitters=new Map,this.scene.add.existing(this)}createOneEmitter(e){const t=1/this.scene.world.getPixelRatio(),s=new Phaser.Geom.Circle(0,0,10),a={frame:Array(6).fill(null).map((c,o)=>bA.EGG_SHELL+(o+1)),lifespan:{min:500,max:750},speedY:{min:-60,max:0},speedX:{min:-60,max:60},angle:{min:0,max:360},accelerationY:130,quantity:15,alpha:{start:1,end:.5},scale:{min:t*.5,max:t*1.2},emitZone:{type:"random",source:s},on:!1},r=this.createEmitter(a);return r.setTint(e),this.explosiveEmitters.set(e,r),r}explode(e,t,s){let n=this.explosiveEmitters.get(s);n||(n=this.createOneEmitter(s)),n.explode(4,e,t)}}class wA extends Phaser.GameObjects.Group{eggExplosiveParticle;constructor(e){super(e),this.eggExplosiveParticle=new TA(e),this.init()}init(){Array(50).fill(null).map(()=>this.get(0,0)).forEach(t=>{t.setVisible(!1),t.setActive(!1)})}spawn(e,t,s){const n=this.get(e,t),a=1/this.scene.world.getPixelRatio();return n.setScale(a).setTint(s).setActive(!0).setVisible(!0).setDepth(z.BALL_AND_TAIL),n}explode(e,t,s){const n=1/this.scene.world.getPixelRatio()*1.15,a=this.spawn(e,t,s).setAlpha(1).setScale(n).setDepth(z.BULLET).play("egg-explosive");a.once(Phaser.Animations.Events.ANIMATION_COMPLETE,()=>{this.despawn(a)}),this.eggExplosiveParticle.explode(e,t,s)}despawn(e){this.killAndHide(e)}}const{STATUS:an}=ca;class CA extends $s{scene;explosivePool;paperFireworksCelebration;bombExplosionParticle;constructor(e){super(e),this.scene=e}init(){const e=this.scene;this.explosivePool=new wA(e),this.paperFireworksCelebration=new ua(e),this.paperFireworksCelebration.setDepth(z.ON_TOP),this.bombExplosionParticle=new SA(e),this.setState(an.READY)}start(){this.isRunning()||(this.paperFireworksCelebration.revive(),this.bombExplosionParticle.revive(),this.setState(an.RUNNING))}stop(){this.isRunning()&&(this.paperFireworksCelebration.stop(),this.bombExplosionParticle.stop(),this.setState(an.STOPPED))}handleOrphanBallWillBeDestroyed=e=>{this.handleBallWillBeDestroyed(e),this.scene.audio.playSound(H.DROP_FLOOR)};handleBallsWillBeDestroyed=e=>{e.forEach(t=>{this.handleBallWillBeDestroyed(t)}),this.scene.audio.playSound(H.EGG_EXPLODE,{volume:.8})};handleBallWillBeDestroyed=e=>{this.explosivePool.explode(e.x,e.y,e.getColor())};handleBombWillBeDestroyed=e=>{this.bombExplosionParticle.explode(e.x,e.y)};handleDestroyedLotsEgg=()=>{const{width:e,height:t}=this.scene.gameZone;this.paperFireworksCelebration.run(-5,t+20,e+20,t*.8),this.scene.audio.playSound(H.DESTROYED_LOTS_EGG),this.scene.footer.makeTheDinoHappy()}}const rn={GIFT:{ID:"ItemGift"}},{KEY:IA}=_.GAMEPLAY.GAMEPLAY_TEXTURES;class PA extends Phaser.GameObjects.Container{scene;isActive=!0;item;shakeAnimation;constructor(e,t,s,n){super(e),this.scene=e,this.createItem(t,s,n),this.createAnimations(),this.setDepth(z.ITEM),this.scene.add.existing(this)}activeItem(){this.isActive=!0}deactivateItem(){this.isActive=!1}set onClick(e){const{width:t,height:s}=this.item;this.setSize(t,s),this.setInteractive({useHandCursor:!0}),this.on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,()=>{e(),this.logButtonEvent()})}createAnimations(){this.shakeAnimation=new ea({targets:[this.item],repeat:3,props:{x:4}})}createItem(e,t,s){this.item=this.scene.add.image(0,0,IA,e),this.item.setWorldSize(t,s),this.add(this.item)}logButtonEvent(){const e=this.getParentName(),t=this.name;this.scene.analytics.event(V.BUTTON_CLICK,{button_name:t,screen_name:e})}getParentName(){let e=this.parentContainer;for(;e;){if(e instanceof GameCore.Screen)return e.getScreenName();e=e.parentContainer}return this.scene.getSceneName()}}const{KEY:vA,FRAME:si}=_.GAMEPLAY.GAMEPLAY_TEXTURES,{Gameplay:OA}=GameCore.Configs,{giftTime:_A}=OA.ItemConfig;class RA extends PA{scene;timer;giftTime;timeCount;isGiftOpen;adsTimer;glowEffect;glowAnimation;starTwinkleUp;giftOpenAnimation;countDownText;constructor(e){super(e,si.ITEM_GIF_CLOSE,39,47.5),this.scene=e,this.setName("GiftBomb"),this.giftTime=_A,this.timeCount=0,this.onClick=this.handleClickGiftItem,this.createGlowEffect(),this.createStarEffect(),this.createCountdownText(),this.setGiftClose(),this.kill()}handleClickGiftItem=()=>{if(!this.isGiftOpen){this.shakeAnimation.play();return}this.useGiftItem()};createCountdownText(){this.countDownText=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(14),origin:{x:.5,y:.5}}),this.countDownText.setY(26),this.add(this.countDownText)}activeItem(){this.revive(),super.activeItem(),this.setGiftClose(),this.startCountdown(),this.runEnterAnimation()}deactivateItem(){super.deactivateItem(),this.setGiftClose(),this.stopCountdown(),this.kill()}startCountdown=()=>{if(!this.scene.itemManager.isRunning())return;this.timer?.remove(),this.timeCount=0,this.countDownText.revive();const e=di(this.giftTime,!1);this.countDownText.setText(e);let t=!1;this.timer=this.scene.time.addEvent({loop:!0,delay:1e3,callback:()=>{this.timeCount+=1e3;const s=this.giftTime-this.timeCount;if(s<=0){this.timer?.remove(),this.countDownText.kill(),this.setGiftOpen();return}!t&&s<6e4&&(t=!0,this.scene.ads.preloadRewardedVideoAsync().catch(a=>{}));const n=di(s,!1);this.countDownText.setText(n)}}),this.scene.timerEvents.push(this.timer)};stopCountdown(){this.timer?.remove(),this.countDownText.kill()}useGiftItem=async()=>{if(!this.scene)return;this.scene.stateManager.pause();const e=await this.showRewardAd();this.scene.stateManager.play(),e?this.handleReceiveGift():this.activeItem()};handleReceiveGift=()=>{this.scene.tweens.killTweensOf(this.item),this.scene.shooter.attachBomb(!0),this.activeItem()};showRewardAd=async()=>{let e=!1;const{audio:t,game:s}=this.scene;try{s.globalScene.screen.open(L.NOTIFY_SCREEN,{message:this.scene.lang.Text.LOADING,duration:0,loading:!0}),t.pauseMusic(),t.muteAll(),await this.scene.ads.showRewardedVideoAsync(),e=!0}catch(n){s.globalScene.screen.close(L.NOTIFY_SCREEN),n instanceof Object&&GameCore.Utils.Object.hasOwn(n,"code")&&n.code==="USER_INPUT"?this.showNotifySkipAd():this.showNotifyNoAd(),await xn(this.scene,800)}finally{this.scene.ads.preloadRewardedVideoAsync().catch(n=>{}),s.globalScene.screen.close(L.NOTIFY_SCREEN),this.adsTimer?.destroy(),t.unmuteAll(),t.playMusic()}return e};showNotifyNoAd=e=>{if(e&&e.name!==L.NOTIFY_SCREEN)return;const{globalScene:t}=this.scene.game;t.screen.open(L.NOTIFY_SCREEN,{message:this.scene.lang.Text.NO_ADS,duration:800,loading:!1})};showNotifySkipAd=()=>{const{globalScene:e}=this.scene.game;e.screen.open(L.NOTIFY_SCREEN,{message:`Sorry, No Rewards!
You have cancelled the ad!`,duration:800,loading:!1})};createGlowEffect(){this.glowEffect=this.scene.make.image({key:vA,frame:si.ITEM_GLOW_EFFECT}),this.glowEffect.setWorldSize(87,85.5),this.add(this.glowEffect),this.moveBelow(this.glowEffect,this.item)}createStarEffect(){this.starTwinkleUp=new cl(this.scene),this.add(this.starTwinkleUp)}runEnterAnimation(){new Ve({targets:[this]}).play()}runGiftOpenAnimation(){this.giftOpenAnimation?.remove(),this.giftOpenAnimation=this.scene.tweens.add({targets:[this.item],duration:500,loop:-1,yoyo:!0,ease:Phaser.Math.Easing.Sine.Out,props:{y:-2}})}runGlowEffect(){this.glowEffect.revive(),this.glowAnimation?.remove(),this.glowAnimation=new Mi({targets:[this.glowEffect],repeat:-1,duration:12e3}),this.glowAnimation.play()}setGiftClose(){this.isGiftOpen=!1,this.giftOpenAnimation?.remove(),this.glowEffect.kill(),this.item.setFrame(si.ITEM_GIF_CLOSE),this.item.setWorldSize(32,39.5),this.starTwinkleUp.stop()}setGiftOpen(){if(!this.scene.itemManager.isRunning())return;this.isGiftOpen=!0,this.item.setFrame(si.ITEM_GIFT_BOMB),this.item.setWorldSize(54,60.5),this.runGlowEffect(),this.runGiftOpenAnimation();const{x:e,y:t,width:s,height:n}=this.item;this.starTwinkleUp.run(2,e,t,s,n)}}class xA extends $s{scene;items={};constructor(e){super(e),this.scene=e,this.createItems()}createItems(){this.createGiftItem()}getItem(e){return this.items[e]}createGiftItem(){const e=new RA(this.scene);this.items[rn.GIFT.ID]=e,this.scene.footer.add(e),e.setPosition(-150,15)}start=()=>{super.start(),this.items[rn.GIFT.ID].activeItem()};stop=()=>{super.stop(),this.items[rn.GIFT.ID].deactivateItem()}}class DA extends is{gameSettings;header;footer;bulletBallPool;gridBallPool;bombPool;stampPool;flyingDinoPool;floatingScorePool;shotGuide;tailParticles;ropeLine;drag;shooter;grid;ballLayoutData;descentController;levelUpController;scoreCounter;vibrateController;readyScreen;pauseScreen;guideScreen;gameOverScreen;rescueScreen;gameModeManager;stateManager;physicsManager;animationsManager;itemManager;isNeedShowGuide;timerEvents=[];pauseButton;preload(){this.events.on(Phaser.Scenes.Events.WAKE,this.run),this.events.on(Phaser.Scenes.Events.CREATE,this.run)}run=()=>{this.stateManager.ready();const e=this.registry.get("log_level"),{score:t}=this.registry.get("gameData");this.analytics.levelStart(e,t),this.checkAndAddShortcut(),this.time.delayedCall(1e3,()=>{this.logPageviewOnOpen()})};create=()=>{super.create(),this.gameSettings=new Hy(this),this.createBackground($.GAME_BACKGROUND.KEY),this.createFooterBackground(),this.createController(),this.createParticle(),this.createPhysicsWorld(),this.createObjectPools(),this.createGlobalAnims(),this.createUI(),this.handleEvents(),this.createManagers(),this.checkNewUser(),this.checkAndAddShortcut(),TS(this),this.addGlobalMethodsForGlance()};createFooterBackground(){const{KEY:e,FRAME:t}=_.GAMEPLAY.GAMEPLAY_TEXTURES,s=this.registry.get("zones").zones,n=this.world.getPixelRatio(),a=this.add.image(0,0,e,t.FOOTER_BG);a.setWorldSize(375,231),a.setOrigin(0,1*n),a.setY(s.zone5.bottomY+65)}addGlobalMethodsForGlance=()=>{const e=()=>{this.screen.get(L.PAUSE_SCREEN)?.visible&&this.screen.close(L.PAUSE_SCREEN)},t=()=>{this.screen.get(L.REWARD_SCREEN)?.visible&&this.screen.close(L.REWARD_SCREEN)},s=()=>{const n=this.screen.get(L.RESCUE_SCREEN);n?.visible&&(n.closePopupSafely(),this.resumeGame())};window.pauseEvent=()=>{if(!this.scene.isActive()){console.warn("You can not call this function at this state");return}this.screen.get(L.PAUSE_SCREEN)?.visible||(this.screen.open(L.PAUSE_SCREEN),this.stateManager.pause())},window.resumeEvent=()=>{if(!this.scene.isActive()){console.warn("You can not call this function at this state");return}if(!this.stateManager.isPaused()){console.warn("Game is not paused");return}e(),this.stateManager.play()},window.replayGameEvent=async()=>{if(this.stateManager.isGameOver()&&this.scene.isActive()){console.warn("You can not call this function at this state");return}e(),t(),s();const n=this.registry.get("log_level"),{score:a}=this.registry.get("gameData");this.player.updateBestScore(a),this.analytics.levelFail(n),this.stateManager.quit(),await this.storage.dispatch(kA()),this.stateManager.ready(),this.run()},window.nextLevelEvent=()=>{console.warn("Game not have level")},window.gotoHomeEvent=()=>{if(!this.scene.isActive()||this.stateManager.isGameOver()||this.stateManager.isReady()||this.stateManager.isRescue()){console.warn("You can not call this function at this state");return}e(),t();const n=this.registry.get("log_level"),{score:a}=this.registry.get("gameData");this.player.updateBestScore(a),this.analytics.levelFail(n),this.scene.switch(j.DASHBOARD_SCENE)},window.gotoLevel=n=>{console.warn("Game not have level")}};createController(){this.vibrateController=new iE(this)}createPhysicsWorld(){const{width:e,height:t}=this.gameZone,s=this.data.get("physicsWorld").worldBoundWidth;this.physics.world.setBounds(e*.5-s*.5,-t*.5,s,t*1.5),this.physics.world.setBoundsCollision(!0,!0,!1,!1)}createObjectPools(){const{KEY:e}=_.GAMEPLAY.GAME_OBJECTS,t=this.physics.world;this.bulletBallPool=new eE(t,this),this.bulletBallPool.initObjects(5),this.gridBallPool=new tE(t,this,e),this.gridBallPool.initObjects(100),this.bombPool=new nE(t,this),this.bombPool.initObjects(2),this.stampPool=new rE(this),this.floatingScorePool=new Ny(this),this.flyingDinoPool=new ZE(this),this.shotGuide=new Vy(this)}pauseGame=()=>{this.tweens.pauseAll(),this.shooter.pause(),this.tailParticles.pause(),this.physics.world.pause(),this.levelUpController.pause(),this.timerEvents=this.timerEvents.filter(e=>(e.paused=!0,!e.hasDispatched))};resumeGame=()=>{this.tweens.resumeAll(),this.shooter.resume(),this.tailParticles.resume(),this.physics.world.resume(),this.levelUpController.resume(),this.timerEvents=this.timerEvents.filter(e=>(e.paused=!1,!e.hasDispatched))};createParticle(){this.tailParticles=new CS(this)}createGlobalAnims(){new YE(this)}createManagers(){this.gameModeManager=new Xy(this),this.gameModeManager.init(),this.physicsManager=new IS(this),this.physicsManager.init(),this.animationsManager=new CA(this),this.animationsManager.init(),this.itemManager=new xA(this),this.itemManager.init(),this.stateManager=new bS(this),this.stateManager.init()}createUI(){this.createReadyScreen(),this.createGuideScreen(),this.createPauseScreen(),this.createRescueScreen(),this.createGameOverScreen(),this.createHeader(),this.createRope(),this.createFooter(),this.createPauseButton()}createReadyScreen(){this.readyScreen=this.screen.add(L.READY_SCREEN,TE)}createGuideScreen(){this.guideScreen=this.screen.add(L.GUIDE_SCREEN,VE)}createPauseScreen(){this.pauseScreen=this.screen.add(L.PAUSE_SCREEN,CE)}createRescueScreen(){this.rescueScreen=this.screen.add(L.RESCUE_SCREEN,xE)}createGameOverScreen(){this.gameOverScreen=this.screen.add(L.GAME_OVER_SCREEN,AE)}createPauseButton(){const{KEY:e,FRAME:t}=_.GAMEPLAY.GAMEPLAY_TEXTURES,s=new Q(this,e,t.BUTTON_PAUSE,45.5,37);s.setName("Pause"),this.header.add(s),s.onClick=()=>{this.screen.open(L.PAUSE_SCREEN),this.stateManager.pause()},s.kill(),this.pauseButton=s,Phaser.Display.Align.In.Center(s,this.header,-35,-28)}createHeader(){this.header=new EE(this),Phaser.Display.Align.In.TopCenter(this.header,this.gameZone),this.header.setDepth(z.UI)}createRope(){const{KEY:e,FRAME:t}=_.GAMEPLAY.GAMEPLAY_TEXTURES,s=this.registry.get("zones").zones;this.ropeLine=this.add.image(375/2,s.zone5.topY,e,t.ROPE),this.ropeLine.setWorldSize(375,4),this.ropeLine.setDepth(z.BACKGROUND)}createFooter(){const e=this.registry.get("zones").zones;this.footer=new Yy(this),this.footer.setPosition(375/2,e.zone5.topY+55),this.footer.setDepth(z.BUTTON)}checkNewUser(){this.isNeedShowGuide=!1,(this.player.getPlayerIsNew()||GameCore.Configs.Tutorial.ForceUseTutorial)&&(this.handleCloseGuide(),this.isNeedShowGuide=!0)}handleEvents(){this.game.events.on(Phaser.Core.Events.HIDDEN,this.handleBlurGameScene),this.events.on(Phaser.Scenes.Events.SLEEP,()=>{this.stateManager.quit()})}handleBlurGameScene=()=>{if(!this.stateManager.isPlaying())return;this.stateManager.pause();const e=this.game.globalScene;e.screen.open(L.NOTIFY_SCREEN,{message:this.lang.Text.TOUCH_ANYWHERE,duration:0,loading:!1}),e.input.once(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,this.handleCloseScreen)};handleCloseScreen=()=>{this.game.globalScene.screen.close(L.NOTIFY_SCREEN),this.stateManager.play()};checkAndAddShortcut(){this.game.player.getPlayer().isUserNew||this.gameModeManager?.gameMode!==Ce&&this.facebook.attemptToAddShortcut()}handleCloseGuide(){this.guideScreen.once(GameCore.Screens.Events.CLOSE,()=>{this.showDrag(),this.analytics.event(V.TUTORIAL_COMPLETE)})}showDrag(){this.drag=new jE(this,0,0),Phaser.Display.Align.In.Center(this.drag,this.gameZone,-50),this.drag.show(),this.events.once(ee.SHOOT_BALL,()=>{this.drag.hide()})}update(e,t){this.stateManager.update(t)}handleGameModeChange(){const e=[{selector:dt,callback:t=>{t!==this.gameModeManager.gameMode&&(this.gameModeManager.stop(),this.gameModeManager.setGameMode(t),this.gameModeManager.start())}}];this.handleStateChange(e)}startManager(){this.stateManager.start(),this.gameModeManager.start(),this.physicsManager.start(),this.animationsManager.start()}stopManager(){this.stateManager.stop(),this.gameModeManager.stop(),this.physicsManager.stop(),this.animationsManager.stop(),this.itemManager.stop()}destroyGamePlay=()=>{this.stopManager(),this.destroyOldObject(),this.resetObjectPools(),this.removeAllListeners(),this.timerEvents=[],this.tweens.killAll(),this.time.removeAllEvents()};destroyOldObject(){this.grid?.destroy(),this.drag?.destroy(),this.shooter?.destroy(),this.levelUpController?.destroy()}resetObjectPools(){this.bombPool?.reset(),this.stampPool?.reset(),this.gridBallPool?.reset(),this.bulletBallPool?.reset(),this.flyingDinoPool?.reset(),this.floatingScorePool?.reset()}removeAllListeners(){this.events.off(ee.SHOOT_BALL),this.events.off(ee.TIMER_CREATED)}handleShowAdWhenReplay=async()=>{if(this.audio.pauseMusic(),this.audio.muteAll(),this.ads.canbeShowInterstitialAd())try{await this.ads.showInterstitialAdAsync()}catch(e){console.log("Show ad error",e)}this.audio.unmuteAll(),this.audio.playMusic(),this.ads.preloadInterstitialAdAsync().catch(()=>{})}}const da=DA,Gl=i=>{const{contextId:e}=i;if(e===""||typeof e!="string")throw new es(null,{contextId:e})};let Tr=null;const ls=i=>{clearTimeout(Tr),Tr=setTimeout(()=>{window.game.globalScene.screen.close(L.NOTIFY_SCREEN)},i)},BA=()=>({type:uc,payload:{}}),pa=()=>i=>{try{i(ki()),i(js(De))}catch(e){K(e)}},ga=()=>async i=>{try{try{await window.game.facebook.getTournamentAsync(),i(pa());return}catch{}i(ki()),i(js(ht))}catch(e){K(e)}},kA=()=>async(i,e)=>{try{const{globalScene:t}=window.game,s=e(),n=dt(s),a=sl(s);[ht,De].includes(n)&&(i(ki()),i(bl()));let r=null;n===Ce&&(t.screen.open(L.NOTIFY_SCREEN,{message:window.game.lang.Text.LOADING,loading:!0}),r=vt(s),i(vy())),i(Tl()),await i(js(n,r)),i(Ul(a))}catch(t){K(t)}finally{ls(300)}},Gi=(i="10",e=!1)=>t=>{try{t(Fl("reset",i,e))}catch(s){K(s)}},Fl=(i,e="10",t=!1)=>async s=>{try{const{player:n,facebook:a,globalScene:r}=window.game;r.screen.open(L.NOTIFY_SCREEN,{message:window.game.lang.Text.LOADING,loading:!0});let c=i,o=a.contextType;if(!e){const f=GameCore.Configs.PlayerIdMock,y=GameCore.Configs.PlayerIdMock2;e=n.getPlayerId()===f?y:f}if(i){if(e&&e!==xe.playerId){if(c=await a.createAsync(e),c===!1){t&&r.events.emit(we.SWITCH,j.DASHBOARD_SCENE);return}!c&&i!=="reset"&&(c=i)}o=a.contextType,s(Pn(c,o))}else{if(c=await a.chooseAsync(),c===!1){t&&r.events.emit(we.SWITCH,j.DASHBOARD_SCENE);return}try{await a.getTournamentAsync(),s(pa());return}catch{}}Gl({contextId:c});const l=n.getPlayerId(),h=n.getConnectedPlayers(),d=await a.getContextPlayers(l);let u=xe;e!==u.playerId&&h[e]?u=h[e]:d.length===1&&(u=d[0]),s(Tl());const{playerId:p,name:g,photo:m}=u;await s(js(Ce,{playerId:p,name:g,photo:m})),s(Pn(c,o))}catch(n){if(n instanceof es||n?.code==="USER_INPUT"||n?.code==="INVALID_OPERATION")return;K(n)}finally{ls(1e3)}},ma=i=>async e=>{try{const{facebook:t,globalScene:s,analytics:n}=window.game;s.screen.open(L.NOTIFY_SCREEN,{message:window.game.lang.Text.LOADING,loading:!0});const a=t.getContextID();Gl({contextId:a}),n.event(V.JOIN_GROUP,{group_id:a}),await e(js(Ot,i))}catch(t){if(t instanceof es||t?.code==="INVALID_OPERATION")return;K(t)}finally{ls(1e3)}},wr=(i,e,t=!1)=>async(s,n)=>{try{const{player:a,profile:r,facebook:c,globalScene:o}=window.game;t?o.events.emit(we.SWITCH,j.GAME_SCENE):o.screen.open(L.NOTIFY_SCREEN,{message:window.game.lang.Text.LOADING,loading:!0});const l=await GameCore.Utils.Valid.isValueChangeAsync(()=>a.isConnectedPlayersLoaded(),!0,{timeout:1e3}),h=a.getPlayerId(),d=a.getConnectedPlayers(),u=h===e,p=e===xe.playerId,g=l&&d[e];if(!p&&!g&&!t){o.events.emit(we.SWITCH,j.DASHBOARD_SCENE);return}let m=xe;const E=await c.getContextPlayers(h);if(!u&&!p&&g)m=d[e];else if(E.length===1)m=E[0];else if(!p){await r.requestProfiles([e]);const w=r.getProfiles();w[e]&&(m=w[e])}await s(Iy(i,m,!t));let y=n(),S=Za(y,{playerId:h});if(S===xe.playerId&&await s(Cy(i)),y=n(),S=Za(y,{playerId:h}),S!==h&&d[e]){s(Gi(e,!0,t));return}if(aa(y)!==i){o.events.emit(we.SWITCH,j.DASHBOARD_SCENE);return}const b=vf(y),C=ra(y,{playerId:h});s(GA({mode:Ce,status:b}));const O=c.getContextID(),v=c.contextType;if(s(Pn(O,v)),C){await a.requestConnectedPlayers(),o.events.emit(we.SWITCH,j.RESULT_MATCH_SCENE);return}o.events.emit(we.SWITCH,j.GAME_SCENE)}catch(a){K(a)}finally{ls(1e3)}},NA=()=>async(i,e)=>{try{const{analytics:t,facebook:s,globalScene:n}=window.game;n.screen.open(L.NOTIFY_SCREEN,{message:window.game.lang.Text.LOADING,loading:!0});let a=e();const r=dt(a),{score:c=0,level:o=0}=et(a),{RequestTournamentBeforeInterstitialAd:l}=GameCore.Configs.Tournament;i(MA(c)),await i(LA(r,{score:c})),a=e();const h=Sm(a),d=Am(a),u=Math.floor((d-h)/1e3);t.event(V.MATCH_END,{game_mode:GameCore.Utils.String.toUpperCamelCase(r),level:o,level_name:`level_${o}`,time_played:u});const p=s.getContextID();if(r===Ot&&p&&i(cy()),p&&r===Ce){const{playerId:g}=vt(a);if(!g||g===xe.playerId)return;const m=_t(a),{score:E=0}=m[g]||{},f=ts(a),{_id:y,whitePlayerFinish:S,blackPlayerFinish:T}=f;!S||!T?i(oy(g,{matchId:y,contextId:p,score:c})):c>E?i(ry(g,{matchId:y,contextId:p})):i(ay(g,{matchId:y,contextId:p}))}}catch(t){K(t)}finally{ls(300)}},MA=i=>e=>{try{const{player:t,notification:s}=window.game,n=t.getPlayerId();window.leaderboard_callback=async()=>{const h=window.game.scene.getScene(j.GAME_SCENE);h instanceof da&&await h.handleShowAdWhenReplay().catch(d=>{}),window.replayGameEvent()};const a=t.getDiamond(),r=t.getPlayerData(),{score:c=0,level:o}=r;c<i&&t.setBestScore(i),s.updateData({gameProgress:{currentLevel:o},gameStatistics:{highScore:c<i?i:c},currencyBalance:{diamond:a}}),s.sendRequest();const l={score:i,level:o};e(Ni(n,l)),e(Ks(l))}catch(t){if(t instanceof nf)return;K(t)}},js=(i,e=null)=>async(t,s)=>{try{const{player:n,analytics:a,facebook:r,globalScene:c}=window.game;let o=r.getContextID(),l=0,h=s();if(a.event(V.MATCH_START,{game_mode:GameCore.Utils.String.toUpperCamelCase(i),level:1,level_name:"level_1"}),t(BA()),[ht,De].includes(i)&&(await t(by()),h=s(),Si(h)||await t(bl()),l=Pf(h)),i===Ot&&t(Oy(e)),i===Ce){await t(wy(e)),h=s();const u=aa(h),{playerId:p}=vt(h);o||(o=window.FBInstant.context.getID());const g=kf(h,{opponentId:p});o&&p&&!g&&t(ny(p,{contextId:o,matchId:u}))}i===Wt&&t(Ry());const{score:d=0}=n.getPlayerData(h);t(Ks({score:l,bestScore:d})),t({type:dc,payload:{mode:i,contextId:o}}),t(tl(i)),c.events.emit(we.SWITCH,j.GAME_SCENE),a.event(V.MATCH_START,{game_mode:GameCore.Utils.String.toUpperCamelCase(i),level:1,level_name:"level_1"})}catch(n){if(n instanceof ve){const{globalScene:a}=window.game;a.screen.open(L.NOTIFY_SCREEN,{message:`Sorry!, you can now
create this match!`,duration:2500,loading:!1});return}K(n)}finally{ls(0)}},LA=(i,e)=>async(t,s)=>{const{player:n,globalScene:a}=window.game,{score:r=0,level:c=0}=e,o=s();if([ht,De].includes(i)){const l=Si(o);await t(Ty(l))}if(i===Ot){t(_y());const l=n.getPlayerId();t(Ni(l,e))}if(i===Ce){const l=aa(o);await t(Py(l,r,{level:c}))}i===Wt&&(Si(o),await t(Dy())),t({type:pc,payload:{mode:i}}),i===Ce?a.events.emit(we.SWITCH,j.RESULT_MATCH_SCENE):i===Wt?a.events.emit(we.SWITCH,j.RESULT_ONLINE_SCENE):a.events.emit(we.SWITCH,j.GAME_OVER_SCENE)},GA=i=>e=>{const{mode:t,status:s}=i;e({type:gc,payload:{mode:t,status:s}}),wi("game-mode",t)},FA=()=>(i,e)=>{i({type:mc,payload:{}});const t=e(),{level:s=0}=et(t),n=dt(t);window.game.analytics.event(V.MATCH_RESCUE,{game_mode:GameCore.Utils.String.toUpperCamelCase(n),level:s,level_name:`level_${s}`})},Ul=i=>({type:fc,payload:{type:i}});class Yl extends Q{label;constructor(e,t,s,n,a){super(e,t,s),n&&a&&this.button.setWorldSize(n,a),this.createLabel()}setLabel(e){this.label.setText(e)}createLabel(){this.label=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(15),origin:{x:.5,y:.5}}),this.label.setAlpha(.8),this.add(this.label),this.label.setY(40.5)}}const{KEY:UA,FRAME:YA}=_.DEFAULT;class HA extends Yl{constructor(e){super(e,UA,YA.ICON_SETTING,49,54.5),this.setName("Settings"),this.setLabel(this.scene.lang.Text.SETTINGS)}}const{KEY:Cr,FRAME:Ir}=_.DEFAULT;class zA extends Yl{noticeIcon;constructor(e){super(e,Cr,Ir.ICON_MISSION,53,57.5),this.setName("DailyMission"),this.setLabel(this.scene.lang.Text.MISSIONS),this.drawNoticeIcon()}checkNotice=()=>{const e=this.scene.storage.getState(),t=iS(e)||!1;this.noticeIcon.setVisible(t)};drawNoticeIcon(){this.noticeIcon=this.scene.make.image({key:Cr,frame:Ir.ICON_DOT}),this.noticeIcon.setWorldSize(15,16),this.add(this.noticeIcon),Phaser.Display.Align.In.TopRight(this.noticeIcon,this.button,4,4)}}const{KEY:WA,FRAME:VA}=_.DEFAULT;let KA=class extends Phaser.GameObjects.Container{inviteIcon;missionIcon;settingIcon;rankingIcon;buttons;block;constructor(e){super(e),this.createBlock(),this.createButtons(),this.alignButtons(),this.scene.add.existing(this)}createBlock(){this.block=this.scene.add.image(0,0,WA,VA.DASHBOARD_FOOTER_BLOCK),this.block.setOrigin(.5,1),this.block.setWorldSize(375,124.5);const e=62;this.block.setY(e),this.add(this.block)}alignButtons(){const s=-(150*((this.buttons.getLength()-1)/2));this.buttons.setX(s,150),this.buttons.setY(-50)}createButtons(){this.buttons=this.scene.add.group(),this.createMissionButton(),this.createSettingButton()}createSettingButton(){this.settingIcon=new HA(this.scene),this.add(this.settingIcon),this.buttons.add(this.settingIcon)}createMissionButton(){this.missionIcon=new zA(this.scene),this.add(this.missionIcon),this.buttons.add(this.missionIcon)}};class Hl extends Phaser.GameObjects.Container{startAbbreviate;fractionalDigits;key;frames;bar;icon;button;value;constructor(e,t,s){super(e),this.key=t,this.frames=s,this.startAbbreviate=99999,this.fractionalDigits=2,this.createBar(),this.createValue(),this.createIcon(),this.createButton(),this.alignObject(),this.scene.add.existing(this)}set onClick(e){this.scene.ads.enabled&&(this.setInteractive({useHandCursor:!0}),this.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,()=>{this.logButtonEvent(),e(),this.scene.audio.playSound(H.BUTTON_CLICK)}))}setValue(e){const t=GameCore.Utils.Number.toAbbreviatedString(e,{startAbbreviate:1e6});this.value.setText(t)}alignObject(){const{width:e,height:t}=this.bar;this.setSize(e,t),Phaser.Display.Align.In.Center(this.value,this.bar,5,1),Phaser.Display.Align.In.LeftCenter(this.icon,this.bar),this.button&&Phaser.Display.Align.In.RightCenter(this.button,this.bar)}createBar(){this.bar=this.scene.add.image(0,0,this.key,this.frames.background),this.bar.setY(4),this.add(this.bar)}createValue(){this.value=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(20),origin:{x:.5,y:.5}}),this.setValue(0),this.add(this.value)}createIcon(){this.icon=this.scene.add.image(0,0,this.key,this.frames.icon),this.add(this.icon)}createButton(){!this.frames.button||!this.scene.ads.enabled||(this.button=this.scene.add.image(0,0,this.key,this.frames.button),this.add(this.button))}logButtonEvent(){const e=this.getParentName(),t=this.name;this.scene.analytics.event(V.BUTTON_CLICK,{button_name:t,screen_name:e})}getParentName(){let e=this.parentContainer;for(;e;){if(e instanceof GameCore.Screen)return e.getScreenName();e=e.parentContainer}return this.scene.getSceneName()}}const{KEY:$A,FRAME:on}=_.DEFAULT;class jA extends Hl{constructor(e){super(e,$A,{background:on.TOP_PANEL,icon:on.ICON_COIN,button:on.BUTTON_ADD}),this.setName("CoinBar"),this.startAbbreviate=1e3,this.fractionalDigits=0,this.bar.setWorldSize(102,35),this.icon.setWorldSize(38,36),this.button?.setWorldSize(26,26),this.alignObject(),Phaser.Display.Align.In.LeftCenter(this.icon,this.bar,10),this.button&&Phaser.Display.Align.In.RightCenter(this.button,this.bar,8)}getCoinIconPosition(){return this.icon.getWorldPosition()}}const{KEY:XA,FRAME:Pr}=_.DEFAULT;class qA extends Hl{constructor(e){super(e,XA,{background:Pr.TOP_PANEL,icon:Pr.ICON_MEDAL}),this.setName("ScoreBar"),this.startAbbreviate=1e3,this.fractionalDigits=3,this.bar.setWorldSize(105,35),this.icon.setWorldSize(34,43),this.value.setOrigin(.4,.5),this.alignObject(),Phaser.Display.Align.In.LeftCenter(this.icon,this.bar,10)}}class ZA extends Phaser.GameObjects.Container{scoreBar;coinBar;constructor(e){super(e);const{width:t}=this.scene.gameZone;this.setSize(t,50),this.createScoreBar(),this.createCoinBar(),this.scene.add.existing(this)}createScoreBar(){this.scoreBar=new qA(this.scene),this.add(this.scoreBar),Phaser.Display.Align.In.LeftCenter(this.scoreBar,this,-20)}createCoinBar(){this.coinBar=new jA(this.scene),this.add(this.coinBar),Phaser.Display.Align.In.RightCenter(this.coinBar,this,-20)}}const JA={targets:[],props:{alpha:{start:0,to:1,duration:500,ease:Phaser.Math.Easing.Cubic.Out},scale:{start:.8,to:1,duration:1e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45]},y:{start:0,to:0,duration:500,ease:Phaser.Math.Easing.Back.Out}},delay:0};class fa extends pe{constructor(e){super(JA,e)}}const{KEY:cn,FRAME:St}=_.DEFAULT;let vr=class extends Phaser.GameObjects.Container{scene;rankIcon;username;score;showPopUp;avatar;rankText;background;constructor(e,t){super(e),this.scene=e,this.setDataEnabled(),this.setData(t),this.createBackground(),this.updateSize(),this.createAvatar(),this.createRank(),this.createUsername(),this.createScore(),this.scene.add.existing(this.setDepth(z.POPUP))}createBackground(){this.background=this.scene.make.image({key:cn,frame:St.LEADERBOARD_BG_DARK}),this.background.setWorldSize(270,44),this.add(this.background)}updateSize(){const{width:e,height:t}=this.background;this.setSize(e,t)}createAvatar(){const e=this.getData("playerId"),t=this.getData("photo");this.avatar=new ns(this.scene,{id:e,url:t,key:cn,frame:St.AVATAR_FRAME_PURPLE,background:St.AVATAR_BG,width:38,height:40,loadDelay:100}),this.add(this.avatar),Phaser.Display.Align.In.LeftCenter(this.avatar,this,-40,-2)}createRank(){this.createRankIcon(),this.createRankText()}createRankIcon(){let e;const t=+this.getData("score");e=+this.getData("rank"),t===0&&(e=0),this.rankIcon=this.scene.make.image({key:cn,frame:""}),this.add(this.rankIcon),this.updateRankIcon(e)}updateRankIcon(e){let t="";switch(e){case 1:t=St.ICON_GOLD;break;case 2:t=St.ICON_SILVER;break;case 3:t=St.ICON_BRONZE;break;case 0:t=St.ICON_QUESTION}this.rankIcon.setFrame(t),t!=""?(this.rankIcon.setWorldSize(38,49),e===0&&this.rankIcon.setWorldSize(11,16)):this.rankIcon.setVisible(!1),this.rankIcon.setPosition(-116,0)}createRankText(){let e;const t=+this.getData("score");e=+this.getData("rank"),t===0&&(e=0),this.rankText=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(18),text:"0",origin:{x:.5,y:.5}}),this.add(this.rankText),this.updateRankText(e)}createUsername(){const e=this.getData("name"),t=GameCore.Utils.String.getShortName(e,12),s=GameCore.Utils.String.removeDiacritics(t);this.username=this.scene.make.text({style:{fontFamily:B.FONT_FAMILY},origin:{x:0,y:.5},text:s}),this.username.setTint(14803687),this.username.setHighQuality(),this.username.setFontSize(16),Phaser.Display.Align.In.LeftCenter(this.username,this.background,-85,2),this.add(this.username)}createScore(){const e=this.getData("score"),t=this.getData("rank");switch(this.score=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(20),text:"0",origin:{x:1,y:.5}}),this.score.setTint(14803687),t){case 1:this.score.setTint(15511591);break;case 2:this.score.setTint(12763842);break;case 3:this.score.setTint(15700059);break}this.add(this.score),this.updateScore(e),Phaser.Display.Align.In.RightCenter(this.score,this.background,-16,2)}updateScore(e){const t=GameCore.Utils.Number.toAbbreviatedString(+e,{startAbbreviate:1e14});this.score.setText(`${t}`)}updateRankText(e){this.rankText.revive();let t=18,s=`${e}`;e<4&&this.rankText.kill(),e>999&&(t=14,s=GameCore.Utils.Number.toAbbreviatedString(+e,{fractionalDigits:1,removeLastZero:!0})),this.rankText.setText(s),this.rankText.setFontSize(t),this.rankText.setPosition(-110,0)}updateRank(e,t){t===0&&(e=0),this.updateRankIcon(e),this.updateRankText(e)}runShowPopUpAnimation(e,t){this.scene.tweens.killTweensOf(this),this.showPopUp=new fa({targets:[this],delay:e,duration:t,props:{y:{start:this.y+70,to:this.y}}}),this.showPopUp.play()}},QA=class extends Phaser.GameObjects.Container{scene;leaders;currentPlayerLeader;constructor(e){super(e),this.scene=e,this.scene.add.existing(this)}resetLeadersBoard(){this.leaders&&this.leaders.forEach(e=>e.kill()),this.currentPlayerLeader&&this.currentPlayerLeader.kill()}updateData(e){const t=Object.values(e)||[],s=window.game.player.getPlayerId();t.push({playerId:s,name:"You",photo:"./assets/images/others/avatar.png",rank:0,score:window.game.player.getBestScore()});const n=t.sort((c,o)=>+o.score-+c.score);this.leaders=[];let a=0,r=0;n.forEach((c,o)=>{const{playerId:l,photo:h,score:d,name:u,rank:p}=c;if(!l)return;if(s===l&&(a=o+1,r=d,o===n.length-1&&n.length>1)){const m=n[o-1].score,E=Math.ceil(m/(d===0?1:d));a=o+E}const g={playerId:l,photo:h,score:d,rank:s===l?a:o+1,name:u};if(this.leaders.length<3){const m=new vr(this.scene,g);this.leaders.push(m)}}),this.showLeaders(),this.showCurrentPlayerLeaders(a,r)}showLeaders(){const e=this.leaders,t=300;for(let s=0;s<e.length;s++){const n=e[s];if(!n)return;Phaser.Display.Align.In.Center(n,this.scene.main.board,0,s*(n.height+3)-35),n.runShowPopUpAnimation(s*100,t)}}async showCurrentPlayerLeaders(e,t){const{player:s}=window.game,{playerId:n,name:a,photo:r}=s.getPlayer();let c;if(!e||!t)try{c=await zf(n)||{}}catch{c={score:s.getBestScore()}}let o=0,l=0;if(GameCore.Configs.LeadersBoard.UseMock&&(l=Phaser.Math.Between(999,9999),o=Phaser.Math.Between(9999,99999)),c&&("score"in c&&GameCore.Utils.Valid.isString(c.score)&&(o=+parseInt(c.score)),"rank"in c&&GameCore.Utils.Valid.isNumber(c.rank)&&(l=+c.rank)),e!==void 0&&(l=e),t!==void 0&&(o=t),this.currentPlayerLeader)this.currentPlayerLeader.revive(),this.currentPlayerLeader.updateScore(o),this.currentPlayerLeader.updateRank(l,o);else{const u={playerId:n,photo:r,score:o,rank:l,name:a};this.currentPlayerLeader=new vr(this.scene,u)}this.currentPlayerLeader.avatar.setY(0),this.currentPlayerLeader.rankText&&(this.currentPlayerLeader.rankText.x-=5),this.currentPlayerLeader.background.kill();const{x:h,y:d}=this.scene.gameZone.getCenter();this.currentPlayerLeader.setPosition(h,d+70),this.currentPlayerLeader.runShowPopUpAnimation(400,300)}};const{KEY:Or,FRAME:_r}=_.DEFAULT;let eb=class extends Phaser.GameObjects.Container{scene;board;loading;subPanel;leadersBar;countdownTimer;countdownText;emptyMessage;constructor(e){super(e),this.scene=e,this.createBoard(),this.createSubPanel(),this.createClock(),this.createCountdownTimer(),this.createLoading(),this.createLeaderBar(),this.createEmptyMessage(),this.scene.add.existing(this)}setEmptyMessageVisible(e){e?this.emptyMessage.revive():this.emptyMessage.kill()}resetLeadersData(){this.leadersBar.resetLeadersBoard()}updateLeadersData(e){this.leadersBar.updateData(e)}createBoard(){this.board=new Ye(this.scene,0,0,305,200),this.add(this.board)}createSubPanel(){this.subPanel=this.scene.make.image({key:Or,frame:_r.POPUP_BOARD_BOTTOM}),this.subPanel.setWorldSize(291.5,58),this.add(this.subPanel),this.moveBelow(this.subPanel,this.board),Phaser.Display.Align.In.BottomCenter(this.subPanel,this.board,0,57)}createCountdownTimer(){this.countdownTimer?.destroy(),this.countdownTimer=this.scene.time.addEvent({loop:!0,delay:1e3,startAt:1e3,callback:this.updateCountdown})}createClock(){const e=this.scene.add.container();this.countdownText=this.scene.add.text(0,0,"0",{fontSize:"13px",fontFamily:B.FONT_FAMILY,color:"#b4b9c4"}),this.countdownText.setHighQuality(),Phaser.Display.Align.In.Center(this.countdownText,e,-30,-2);const t=this.scene.make.image({key:Or,frame:_r.ICON_CLOCK});t.setWorldSize(21,24),Phaser.Display.Align.In.Center(t,e,-47,0),e.add([t,this.countdownText]),Phaser.Display.Align.In.TopCenter(e,this.board,10,-33),this.add(e)}createLeaderBar(){this.leadersBar=new QA(this.scene).setDepth(z.POPUP)}createLoading(){this.loading=new Rt(this.scene),this.loading.setTint(5982858),this.loading.setWorldSize(55,55),this.add(this.loading),Phaser.Display.Align.In.Center(this.loading,this.board,0,15)}createEmptyMessage(){this.emptyMessage=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(20),text:this.scene.lang.Text.YOU_ARE_THE_TOP_OF_THE_TOP,origin:{x:.5,y:.5}}),this.emptyMessage.kill(),this.add(this.emptyMessage)}showLoading(e){this.loading.setVisible(e),this.setEmptyMessageVisible(!1)}updateCountdown=async()=>{const e=Date.now(),t=new Date(e),s=t.getDay(),n=t.getDate()-s+(s==0?1:8);let r=new Date(t.setDate(n)).setHours(0,0,0,0)-e;const c=Math.floor(r/(1e3*3600*24));r<0&&(r=0,this.resetLeaderBoards()),this.countdownText.setText(`0${c}:${di(r,!0)}`)};resetLeaderBoards(){this.leadersBar.resetLeadersBoard(),this.scene.storage.dispatch(ll())}};const{KEY:Rr,FRAME:xr}=_.DEFAULT;class tb extends Q{buttonsPulsateAnimation;constructor(e){super(e,Rr,xr.BUTTON_GREEN_BIG),this.setName("PlaySingle"),this.button.setWorldSize(135.5,73),this.createIcon(),this.createText()}createIcon(){const e=this.scene.lang.getCurrentLanguage(),t=this.scene.make.image({key:Rr,frame:xr.ICON_PLAY});t.setPosition(e==="ru"?-35:-28,-2),t.setWorldSize(28,38.5),this.add(t)}createText(){const e=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(20),text:this.scene.lang.Text.PLAY_NOW,origin:{x:.5,y:.5}});e.setPosition(16,0),e.setLeftAlign(),this.add(e)}runAnimation(){this.buttonsPulsateAnimation?.remove(),this.buttonsPulsateAnimation=new Jt({targets:[this],props:{scale:"-=0.02"}}),this.buttonsPulsateAnimation?.play()}}const{FRAME:Dr}=_.DEFAULT;class sb extends Phaser.GameObjects.Container{dinoTitle;board;scene;playSingleButton;constructor(e){super(e),this.scene=e,this.createBoard(),this.createDinoTitle(),this.createPlaySingleButton(),this.scene.add.existing(this)}createDinoTitle(){const e=this.scene.lang.getCurrentLanguage();this.dinoTitle=new as(this.scene,{title:this.scene.lang.Text.LEADERBOARDS,titleSize:e==="ru"?22:24}),this.dinoTitle.changeRibbon(Dr.RIBBON_PINK,276.5,68.5),this.dinoTitle.changeBackground(Dr.EGGS,204,61.5),this.add(this.dinoTitle),Phaser.Display.Align.In.Center(this.dinoTitle,this,0,-225)}createBoard(){this.board=new eb(this.scene),Phaser.Display.Align.In.Center(this.board,this.scene.gameZone,0,-55)}createPlaySingleButton(){this.playSingleButton=new tb(this.scene),this.add(this.playSingleButton);const e=610,s=(this.scene.gameZone.height-e)/4;this.playSingleButton.setPosition(0,155+s)}}class zl extends Phaser.GameObjects.Container{config;isEnable;maxHeight;isScrolling;boundTop;boundBottom;maskGraphics;objects;_value=0;velocity=0;isScrollingSmooth;lastScrollY;isScrollingBack;scrollingBackTo;lastScrollYCount=0;onScrollEvents=[];get marginTop(){return this.config.marginTop}get marginBottom(){return this.config.marginBottom}get acceleration(){return this.config.acceleration}get maxScrollOver(){return this.config.maxScrollOver}get scrollSmooth(){return this.config.scrollSmooth}get scrollingBackRate(){return this.config.scrollingBackRate}constructor(e,t){super(e),this.config={marginTop:0,marginBottom:0,acceleration:1400,maxScrollOver:.15,scrollSmooth:40,scrollingBackRate:5,...t};const{width:s,height:n}=t;this.isEnable=!1,this.maxHeight=0,this.lastScrollY=new Array(3).fill(0),this.setSize(s,n),this.createGroup(),this.createInput(),this.createEvents(),this.scene.add.existing(this)}onScroll(e){this.onScrollEvents.push(e)}get value(){return this._value}set value(e){const t=e-this._value;this._value=e,this.updateObject(t)}gotoTop(){this.value=this.config.marginTop}reset(){this.maxHeight=0,this.isScrolling=!1,this.isScrollingBack=!1,this.isScrollingSmooth=!1,this.gotoTop(),this.setEnable(!1)}createDebug(){const e=this.drawDebugBox(16711680,.8);console.log(e?.x,e?.y,e?.displayWidth,e?.displayHeight)}setEnable(e){this.isEnable=e,e?this.setInteractive({draggable:!0,useHandCursor:!0}):this.disableInteractive()}addItem(e){this.addAt(e),this.objects.add(e);const{y:t,height:s}=e,n=t+s+this.marginBottom-this.height/2;this.maxHeight=Math.max(this.maxHeight,n,0),this.updateObjectVisible()}addItems(e){this.addAt(e),this.objects.addMultiple(e);const t=e.map(s=>s.y+s.height+this.marginBottom-this.height/2);this.maxHeight=Math.max(this.maxHeight,Math.max(...t),0),this.updateObjectVisible()}clearItem(){this.objects.clear(!0,!0),this.reset()}getChildren(){return this.objects.getChildren().filter(e=>e.active)}createBound(e,t,s,n){this.boundTop=this.scene.make.image({key:e,frame:t}),this.boundBottom=this.scene.make.image({key:e,frame:t}),this.boundTop.setTint(n),this.boundBottom.setTint(n),this.boundTop.setAlpha(1,1,0,0),this.boundBottom.setAlpha(0,0,1,1),this.boundTop.setDepth(z.PRIORITY),this.boundBottom.setDepth(z.PRIORITY);const a=this.width,r=s,{x:c,y:o}=this.getWorldPosition();this.boundTop.setDisplaySize(a,r),this.boundBottom.setDisplaySize(a,r),this.boundTop.setY(-this.displayHeight/2+r/2+o-this.y-1),this.boundBottom.setY(this.displayHeight/2-r/2+o-this.y+1),this.boundTop.setX(c-this.x),this.boundBottom.setX(c-this.x),this.add([this.boundTop,this.boundBottom])}createMask(){this.maskGraphics?.destroy(),this.maskGraphics=this.scene.make.graphics({fillStyle:{color:255,alpha:1},visible:!0}),this.maskGraphics.setName("MaskGraphics");const e=this.width,t=this.height;this.maskGraphics.fillRoundedRect(0-e/2,0-t/2,e,t,0),this.setMask(this.maskGraphics.createGeometryMask()),this.scene.events.off(Phaser.Scenes.Events.UPDATE,this.updateMask,this),this.scene.events.on(Phaser.Scenes.Events.UPDATE,this.updateMask,this)}updateMask(){const{x:e,y:t}=this.getWorldPosition();this.maskGraphics.setPosition(e,t)}createGroup(){this.objects=this.scene.make.group({})}updateObject(e){this.objects.incY(e),this.updateObjectVisible()}updateObjectVisible=Os(()=>{const e=this.objects.getChildren();for(let t=0;t<e.length;t++){const s=e[t];s.y+s.height<-this.height||s.y-s.height>this.height?s.setVisible(!1):s.active&&s.setVisible(!0)}},100,{maxWait:100});createInput(){this.setInteractive({draggable:!0,useHandCursor:!0}),this.on(Phaser.Input.Events.POINTER_WHEEL,this.onMouseScroll),this.on(Phaser.Input.Events.GAMEOBJECT_DRAG,this.onTouchScroll),this.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onTouchDown),this.scene.input.on(Phaser.Input.Events.POINTER_UP,this.onTouchEnd,this)}createEvents(){this.scene.events.on(Phaser.Scenes.Events.UPDATE,this.update)}update=(e,t)=>{this.isScrollingSmooth&&this.velocity&&this.scrollingSmooth(t),this.isScrollingBack&&this.scrollingBack(t)};callOnScrollEvents(e,t){for(const s of this.onScrollEvents)s(this,e,t)}scrollingBack(e){const t=(this.scrollingBackTo-this.value)*e*this.scrollingBackRate/1e3;this.value+=t,Math.abs(this.scrollingBackTo-this.value)<.5&&(this.value=this.scrollingBackTo,this.stopScrollingBack()),this.callOnScrollEvents(this.value,t)}startScrollingBack(e){this.isScrollingBack=!0,this.scrollingBackTo=e}stopScrollingBack(){this.isScrollingBack=!1}scrollingSmooth(e){const t=this.velocity*e/1e3;this.value+=t;const s=Math.abs(this.velocity)/this.velocity;this.velocity-=s*this.acceleration*e/1e3,Math.abs(this.velocity)<this.acceleration*e/1e3&&this.stopScrollSmooth(),this.isReachTop()&&(this.startScrollingBack(this.marginTop),this.stopScrollSmooth()),this.isReachBottom()&&(this.startScrollingBack(-this.maxHeight),this.stopScrollSmooth()),this.callOnScrollEvents(this.value,t)}startScrollSmooth(e){this.isScrollingSmooth=!0,e&&(e*this.velocity>0?this.velocity+=e:this.velocity=e)}stopScrollSmooth(){this.isScrollingSmooth=!1,this.isScrolling=!1,this.velocity=0}isReachTop(){return this.value>this.marginTop}isReachBottom(){return-this.value>this.maxHeight}checkReachBound=()=>this.isReachTop()||this.isReachBottom();onMouseScroll=Os((e,t,s)=>{if(!this.isEnable)return;if(this.isScrolling=!0,this.checkReachBound()){this.lastScrollY=this.lastScrollY.map(()=>0),this.isScrolling=!1;return}this.stopScrollingBack(),this.startScrollSmooth(-s*this.scrollSmooth/15)},100,{isImmediate:!0,maxWait:100});onTouchScroll=e=>{if(!this.isEnable)return;this.velocity&&this.stopScrollSmooth(),this.stopScrollingBack(),this.isScrolling=!0;const t=this.scene.game.world.getZoomRatio(),{position:s,prevPosition:n}=e,a=(s.y-n.y)/t,r=this.height*this.maxScrollOver;let c=1;if(this.lastScrollY[++this.lastScrollYCount%this.lastScrollY.length]=a,this.isReachTop()&&a>=0){const h=(r-(this.value-this.marginTop))/r;c=Math.min(c,h)}if(this.isReachBottom()&&a<=0){const h=(r-(-this.maxHeight-this.value))/r;c=Math.min(c,h)}const o=a*c,l=this.maxScrollOver*this.height;this.value+o>this.marginTop+l?this.value=this.marginTop+l:this.value+o<-this.maxHeight-l?this.value=-this.maxHeight-l:this.value+=o,this.callOnScrollEvents(this.value,o)};onTouchDown=()=>{this.isEnable&&(this.velocity&&this.stopScrollSmooth(),this.stopScrollingBack())};onTouchEnd=()=>{if(!this.input.enabled||(this.isReachTop()&&(this.startScrollingBack(this.marginTop),this.stopScrollSmooth()),this.isReachBottom()&&(this.startScrollingBack(-this.maxHeight),this.stopScrollSmooth()),!this.isScrolling))return;const e=this.lastScrollY.reduce((t,s)=>t+s)/this.lastScrollY.length;this.startScrollSmooth(e*this.scrollSmooth),this.lastScrollY=this.lastScrollY.map(()=>0)}}const ib=[{id:"collect-eggs",title:"Collect 300 eggs",require:{egg:300},reward:{coin:200}},{id:"reach-target-points",title:"Reach 10,000 points",require:{score:1e4},reward:{coin:200}},{id:"get-dinomite-combo",title:"Get 1 Dinomite Combo",require:{"dinomite-combo":1},reward:{coin:200}},{id:"use-rescue",title:"Use Second Chance 2 times",require:{"use-rescue":2},reward:{coin:500}},{id:"shoot-flying-eggs",title:"Shoot 5 Flying Dinosaurs",require:{"flying-eggs":5},reward:{coin:200}},{id:"complete-games",title:"Complete game 5 times",require:{"complete-game":5},reward:{coin:200}}],nb=async()=>ib,{DailyTasks:ab}=GameCore.Configs,rb=()=>async(i,e)=>{const t=e();if(sS(t))return;i({type:zc,payload:{}});const n=await nb(),a=window.game.globalScene.lang;for(let r=0;r<n.length;r++){const c=n[r];c.id==="collect-eggs"?n[r].title=a.Text.COLLECT_300_EGGS:c.id==="reach-target-points"?n[r].title=a.Text.REACH_10000_POINTS:c.id==="get-dinomite-combo"?n[r].title=a.Text.GET_1_DINOMITE:c.id==="use-rescue"?n[r].title=a.Text.USE_SECOND_CHANCE_2:c.id==="shoot-flying-eggs"?n[r].title=a.Text.SHOOT_5_FLYING:c.id==="complete-games"&&(n[r].title=a.Text.COMPLETE_GAME_5)}i(ob(n))},ob=i=>e=>{e({type:Wc,payload:{tasks:i}});const{player:t}=window.game,s=t.getCustomData("dailyTasks"),{startedTime:n=0,logTasks:a={}}=s||{},c=(Date.now()-n)/1e3>ab.Duration;e(c?Wl(i):Vl(a))},Wl=i=>e=>{const t={};i.forEach(n=>{const{id:a,require:r}=n;t[a]={},Object.keys(r).forEach(c=>{t[a]={[c]:0,rewarded:!1}})});const{player:s}=window.game;s.setCustomData("dailyTasks",{logTasks:t,startedTime:Date.now()}),e(Vl(t)),q.emit(se.EVENTS.TASKS_RESET)},Vl=i=>({type:Vc,payload:{process:i}}),Br=()=>i=>{i({type:jc,payload:{}}),q.emit(se.EVENTS.NOTICE_UPDATE)};class cb extends Phaser.GameObjects.Container{payload;process;minProcess;maxProcess;progressBoxLeft;progressBoxBg;progressBoxRight;progressBarLeft;progressBarBg;progressBarRight;progressAnimation;constructor(e,t){super(e),this.payload=t;const s=t.width,n=16;this.setSize(s,n),this.process=0,this.minProcess=0,this.maxProcess=1,this.createProgressBox(),this.createProgressBar(),this.createContainer()}setProcess(e,t=!1){if(this.process=this.getCorrectValue(e),!this.scene||t){this.updateProcess();return}this.runProcessAnimation(e)}updateProcess(){const{displayHeight:e}=this.progressBarBg,t=this.getDisplayWidthByProcess(this.process);this.progressBarBg.setWorldSize(t,e);const{x:s}=this.progressBarBg;this.progressBarRight.setX(s+t)}getCorrectValue(e){let t=e;return isFinite(t)||(t=0),t<this.minProcess&&(t=this.minProcess),t>this.maxProcess&&(t=this.maxProcess),t}getDisplayWidthByProcess(e){const{width:t}=this;return(t-17)*e}runProcessAnimation(e){this.progressAnimation?.stop(1),this.progressAnimation=this.scene.add.tween({targets:[this.progressBarBg],duration:300,ease:Phaser.Math.Easing.Quadratic.InOut,props:{displayWidth:()=>{const t=this.getCorrectValue(e);return this.getDisplayWidthByProcess(t)}},onStart:()=>{const{displayHeight:t}=this.progressBarBg,s=this.getDisplayWidthByProcess(this.process);this.progressBarBg.setWorldSize(s,t)},onUpdate:()=>{const{x:t,displayWidth:s}=this.progressBarBg;this.progressBarRight.setX(t+s)},onComplete:()=>{this.updateProcess()}})}createProgressBox(){const{key:e,frames:t}=this.payload;this.progressBoxLeft=this.scene.make.image({key:e,frame:t.PROGRESS_BG_LEFT}),this.progressBoxLeft.setOrigin(0,.5),this.progressBoxLeft.setWorldSize(11,16),this.progressBoxRight=this.scene.make.image({key:e,frame:t.PROGRESS_BG_RIGHT}),this.progressBoxRight.setOrigin(0,.5),this.progressBoxRight.setWorldSize(11,16),this.progressBoxBg=this.scene.make.image({key:e,frame:t.PROGRESS_BG_MID}),this.progressBoxBg.setOrigin(0,.5),this.progressBoxBg.setWorldSize(11,16);const{displayHeight:s}=this.progressBoxBg,{displayWidth:n}=this,{displayWidth:a}=this.progressBoxLeft,{displayWidth:r}=this.progressBoxRight;this.progressBoxLeft.setWorldSize(a,s),this.progressBoxRight.setWorldSize(r,s),this.progressBoxBg.setWorldSize(n-(a+r),s),Phaser.Display.Align.In.Center(this.progressBoxBg,this,0,0),Phaser.Display.Align.In.LeftCenter(this.progressBoxLeft,this,0,0),Phaser.Display.Align.In.RightCenter(this.progressBoxRight,this,0,0)}createProgressBar(){const{key:e,frames:t}=this.payload;this.progressBarLeft=this.scene.make.image({key:e,frame:t.PROGRESS_BAR_LEFT}),this.progressBarLeft.setOrigin(0,.5),this.progressBarLeft.setWorldSize(11,16),this.progressBarRight=this.scene.make.image({key:e,frame:t.PROGRESS_BAR_RIGHT}),this.progressBarRight.setOrigin(0,.5),this.progressBarRight.setWorldSize(11,16),this.progressBarBg=this.scene.make.image({key:e,frame:t.PROGRESS_BAR_MID}),this.progressBarBg.setOrigin(0,.5),this.progressBarBg.setWorldSize(11,16);const s=-1,n=-5.8;Phaser.Display.Align.In.LeftCenter(this.progressBarBg,this,n),Phaser.Display.Align.In.LeftCenter(this.progressBarLeft,this,s),Phaser.Display.Align.In.LeftCenter(this.progressBarRight,this,s),this.setProcess(0,!0)}createContainer(){this.add([this.progressBoxBg,this.progressBoxLeft,this.progressBoxRight,this.progressBarBg,this.progressBarLeft,this.progressBarRight]),this.scene.add.existing(this)}}const Kl=()=>{const{player:i}=window.game,e=i.getCustomData("dailyTasks"),{logTasks:t}=e||{};return GameCore.Utils.Json.clone(t)},lb=(i,e,t)=>s=>{const n=Kl();if(!GameCore.Utils.Valid.isObject(n))return;const a=n;if(!GameCore.Utils.Object.hasOwn(a,i)||a[i].rewarded)return;a[i][e]+=t;const{player:r}=window.game;r.setCustomData("dailyTasks",{logTasks:a}),s({type:Kc,payload:{id:i,type:e,value:t}})},hb=i=>e=>{const t=Kl();if(!GameCore.Utils.Valid.isObject(t))return;const s=t;if(!GameCore.Utils.Object.hasOwn(s,i))return;s[i].rewarded=!0;const{player:n}=window.game;n.setCustomData("dailyTasks",{logTasks:s}),e({type:$c,payload:{id:i}})},ub=i=>e=>{e({type:Xc,payload:{id:i}}),q.emit(se.EVENTS.NOTICE_UPDATE)},{KEY:ys,FRAME:Ae}=_.DEFAULT;class kr extends Phaser.GameObjects.Container{payload;process;isCompleted;background;titleText;processText;progressBar;claimButton;rewardedIcon;missionIcon;constructor(e,t,s){super(e),this.payload=t,this.process=s,this.setName(`Task: ${t.id}`),this.createBackground(),this.updateBlockSize(),this.createMissionIcon(),this.createTitle(),this.createProcessBar(),this.createProcessStatus(),this.createClaimButton(),this.updateData()}setProcess(e){this.process=e,this.updateData()}getId(){return this.payload.id}set onClaim(e){this.claimButton.onClick=this.handleOnClaim(e),this.updateData()}handleOnClaim=e=>()=>{const{id:t,reward:s}=this.payload,n=this.claimButton.getWorldPosition();this.scene.storage.dispatch(hb(t)),this.claimButton.kill(),Object.keys(s).forEach(r=>{const c=s[r];e(r,c),this.scene.events.emit("claim-reward",n,c)})};getProcessValue(){const{require:e}=this.payload,t=Object.keys(e);let s=0,n=0;return t.forEach(a=>{s=e[a]||0;const r=this.process[a];n=typeof r=="number"?r:0}),{current:n,target:s}}updateData=()=>{const{current:e,target:t}=this.getProcessValue(),s=e/t;this.progressBar.setProcess(s,!0),this.setProcessText(e,t),this.isCompleted=e>=t&&!this.process?.rewarded,this.claimButton.setDisabled(!this.isCompleted),this.process?.rewarded&&this.claimButton.kill(),this.isCompleted&&this.rewardedIcon.setFrame(Ae.ICON_COIN_SMALL)};setProcessText(e,t){this.processText.setText(`${e} / ${t}`)}createBackground(){this.background=this.scene.make.image({key:ys,frame:Ae.MISSION_BLOCK_BG}),this.background.setWorldSize(298,74.5),this.add(this.background)}updateBlockSize(){const{width:e,height:t}=this.background;this.setSize(e,t)}createMissionIcon(){const{id:e}=this.payload,{COLLECT_EGGS:t,COMPLETE_GAMES:s,INVITE_FRIENDS:n,REACH_TARGET_POINTS:a,SHOOT_FLYING_EGG:r,USE_RESCUE:c,GET_DINOMITE_COMBO:o}=se;switch(this.missionIcon=this.scene.make.image({key:ys,frame:Ae.ICON_COIN_SMALL}),e){case t.ID:this.missionIcon.setFrame(Ae.ICON_EGGS),this.missionIcon.setWorldSize(55.5,59.5);break;case s.ID:this.missionIcon.setFrame(Ae.ICON_CROWN),this.missionIcon.setWorldSize(57,57.5);break;case n.ID:this.missionIcon.setFrame(Ae.ICON_INVITE),this.missionIcon.setWorldSize(59.5,54.5);break;case a.ID:this.missionIcon.setFrame(Ae.ICON_10K),this.missionIcon.setWorldSize(65.5,49);break;case r.ID:this.missionIcon.setFrame(Ae.ICON_BIRD),this.missionIcon.setWorldSize(60.5,55);break;case c.ID:this.missionIcon.setFrame(Ae.ICON_2ND),this.missionIcon.setWorldSize(64.5,48.5);break;case o.ID:this.missionIcon.setFrame(Ae.ICON_DYNAMITE),this.missionIcon.setWorldSize(47,59);break}this.add(this.missionIcon),this.missionIcon.setPosition(-110,0)}createTitle(){const{title:e}=this.payload,t=this.scene.lang.getCurrentLanguage();this.titleText=this.scene.make.text({text:e,style:{color:"#63452F",fontFamily:B.FONT_FAMILY,fontSize:`${t==="ru"?13:14}px`},origin:{x:0,y:.5}}),this.titleText.setHighQuality(),this.add(this.titleText),Phaser.Display.Align.In.LeftCenter(this.titleText,this,-70,-14)}createProcessBar(){this.progressBar=new cb(this.scene,{width:136,key:ys,frames:Ae}),this.add(this.progressBar),Phaser.Display.Align.In.Center(this.progressBar,this,-12,10)}createProcessStatus(){this.processText=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(12),origin:{x:.5,y:.5}}),this.add(this.processText),Phaser.Display.Align.In.Center(this.processText,this.progressBar,0,0)}createClaimButton(){this.claimButton=new Q(this.scene,ys,Ae.BUTTON_GREEN_MINOR,61.5,32);const t=`Claim:${GameCore.Utils.String.toUpperCamelCase(this.payload.id)}`;this.claimButton.setName(t),this.createRewardIcon(),this.createRewardValue(),this.add(this.claimButton),Phaser.Display.Align.In.RightCenter(this.claimButton,this.background,-18,8)}createRewardIcon(){this.rewardedIcon=this.scene.make.image({key:ys,frame:Ae.ICON_COIN_SMALL}),this.rewardedIcon.setFrame(Ae.ICON_COIN_SMALL_GREY),this.rewardedIcon.setWorldSize(15.5,15.5),this.claimButton.add(this.rewardedIcon),Phaser.Display.Align.In.Center(this.rewardedIcon,this.claimButton,-15,-1)}createRewardValue(){const{reward:e}=this.payload,t=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(14),text:`${e.coin}`,origin:{x:.5,y:.5}});this.claimButton.add(t),Phaser.Display.Align.In.Center(t,this.claimButton,8,-1)}}const{KEY:ii,FRAME:ni}=_.DEFAULT,{DailyTasks:db}=GameCore.Configs;class pb extends GameCore.Screen{onReward;missionsData;missionProcess;startedTime;scroller;popup;missionBlocks;countdownTimer;countdownText;countdownContainer;backgroundFadeInAnimation;popupShowUpAnimation;popupExitsAnimation;contentShowUpAnimation;constructor(e,t,s,n){super(e,t,s,n),this.createPopup(),this.createCloseButton(),this.createPopupContents(),this.createScroller(),this.createDebugTools(),this.setDepth(Be.POPUP),this.background.setAlpha(.8)}open(e){super.open(e),this.scene.storage.dispatch(Br()),this.updateTasksData(),this.scroller.value=0,this.createCountdownTimer(),this.createMissionBlocks(),this.runOpenAnimation(),this.scroller.setEnable(!0)}createScroller(){this.scroller=new zl(this.scene,{width:280,height:310}),this.scene.renderer instanceof Phaser.Renderer.WebGL.WebGLRenderer&&this.scroller.createBound(_.DEFAULT.KEY,_.DEFAULT.FRAME.BLANK,4,2826565),this.scroller.createMask(),this.scroller.setPosition(0,20),this.popup.add(this.scroller)}handleClosePopup=()=>{this.scene.storage.dispatch(Br()),this.runCloseAnimation()};handleOnClaim=(e,t)=>{this.claimReward(e,t)};claimReward(e,t){typeof this.onReward=="function"&&(this.onReward(e,t),this.updateTasksData(),this.updateMissionBlocks(),this.scene.audio.playSound(H.DAILY_REWARD))}resetTaskData=async()=>{this.startedTime=Date.now(),await this.scene.storage.dispatch(Wl(this.missionsData)),this.updateTasksData(),this.scroller.value=0,this.createMissionBlocks()};updateTasksData=()=>{const{player:e,storage:t}=this.scene,s=t.getState(),n=ha(s)||[],a=Dl(s)||{},r=e.getCustomData("dailyTasks"),{startedTime:c=0}=r||{};this.missionsData=n,this.missionProcess=a,this.startedTime=c};runOpenAnimation(){this.setVisible(!0),this.scene.audio.playSound(H.POPUP_SHOW),this.runBackgroundEntrancesAnimation(0,300),this.runPopupEntrancesAnimation(200,500),this.runPopupContentEntrancesAnimation(400,400)}runCloseAnimation(){this.scene.audio.playSound(H.POPUP_OFF,{volume:.6}),this.runPopupExitsAnimation(0,200)}runBackgroundEntrancesAnimation(e,t){this.backgroundFadeInAnimation||(this.backgroundFadeInAnimation=new Ve({targets:[this.background],delay:e,duration:t,props:{alpha:{start:0,from:0,to:.8}}})),this.backgroundFadeInAnimation?.play()}runPopupEntrancesAnimation(e,t){if(!this.popupShowUpAnimation){this.popupShowUpAnimation=new rs({targets:[this.popup],delay:e,duration:t,props:{y:{from:350,to:this.popup.y},scale:{start:0,from:0,to:1},alpha:{start:1,from:1,to:1}}}),this.popupShowUpAnimation?.play();return}this.popupShowUpAnimation?.play()}runPopupContentEntrancesAnimation(e,t){const s=this.missionBlocks.getChildren();s.length<1||(this.missionBlocks.setAlpha(0),this.contentShowUpAnimation?.remove(),this.contentShowUpAnimation=new zs({targets:s,duration:t,delay:this.scene.tweens.stagger(80,{start:e}),props:{alpha:{from:0,to:1}}}),this.contentShowUpAnimation?.play())}runPopupExitsAnimation(e,t){if(!this.popupExitsAnimation){this.popupExitsAnimation=new ke({targets:[this.popup],delay:e,duration:t,props:{y:250,scale:0},onComplete:()=>{this.scene.screen.close(this.name),this.popup.setY(0)}}),this.popupExitsAnimation?.play();return}this.popupExitsAnimation?.play()}createDebugTools(){if(!GameCore.Utils.Valid.isDebugger())return;const e=new Q(this.scene,ii,ni.ICON_CANCEL);e.button.setWorldSize(21,23),e.setName("Reset"),e.onClick=this.resetTaskData,this.add(e),Phaser.Display.Align.In.TopLeft(e,this.zone,-30,-60)}createCloseButton(){const e=new Qt(this.scene,{key:ii,frame:ni.BUTTON_CLOSE,width:48.5,height:43,paddingZone:20});this.popup.add(e),e.setName("Close"),e.useSound=!1,e.onClick=this.handleClosePopup,Phaser.Display.Align.In.TopRight(e,this.popup,25,25)}createPopup(){this.popup=new Ye(this.scene,0,0,334,410),this.add(this.popup),Phaser.Display.Align.In.Center(this.popup,this.zone)}createPopupContents(){this.createTitle(),this.createCountdown()}createTitle(){const e=this.scene.add.container(),t=this.scene.make.image({key:ii,frame:ni.RIBBON_ORANGE});t.setWorldSize(225,65.5);const s=this.scene.lang.getCurrentLanguage(),n=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(s==="ru"?18:24),text:this.scene.lang.Text.DAILY_MISSIONS});Phaser.Display.Align.In.Center(n,t,0,-4),e.add([t,n]),this.popup.add(e),Phaser.Display.Align.In.TopCenter(e,this.popup,0,-10)}createCountdown(){this.countdownContainer=this.scene.add.container();const e=this.scene.make.image({key:ii,frame:ni.ICON_CLOCK});e.setWorldSize(18,20.5),this.countdownText=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(16),text:"00:00:00",origin:{x:.5,y:.5}}),Phaser.Display.Align.To.RightCenter(this.countdownText,e,3);const t=e.width+this.countdownText.width-10;this.countdownContainer.add([e,this.countdownText]),this.popup.add(this.countdownContainer),Phaser.Display.Align.In.TopCenter(this.countdownContainer,this.popup,-t/2,-55)}createCountdownTimer(){this.countdownTimer?.destroy(),this.countdownTimer=this.scene.time.addEvent({loop:!0,delay:1e3,startAt:1e3,callback:this.updateCountdown})}updateCountdown=async()=>{if(!this.startedTime)return;const t=Date.now()-this.startedTime;let s=db.Duration*1e3-t;s<0&&(s=0,await this.resetTaskData()),this.countdownText.setText(`${di(s,!0)}`)};createMissionBlocks(){this.missionBlocks?.destroy(!0);const e=this.missionsData.length,t=new Array(e).fill(null);this.missionBlocks=this.scene.add.group({maxSize:e}),t.forEach((n,a)=>{const r=this.createMissionBlock(a);r!==null&&this.missionBlocks.add(r)}),this.missionBlocks.setX(0);const s=this.missionBlocks.getChildren();this.scroller.addItems(s)}createMissionBlock(e){const{id:t}=this.missionsData[e];if(!GameCore.Utils.Object.hasOwn(this.missionProcess,t))return null;const s=this.missionProcess[t];if(!GameCore.Utils.Valid.isObject(s))return null;const n=new kr(this.scene,this.missionsData[e],s);return n.setY(e*70-110),n.onClaim=this.handleOnClaim,n}updateMissionBlocks(){this.missionBlocks.getChildren().forEach(e=>{if(e instanceof kr){const t=e.getId();if(!GameCore.Utils.Object.hasOwn(this.missionProcess,t))return;const s=this.missionProcess[t];if(!GameCore.Utils.Valid.isObject(s))return;e.setProcess(s)}})}}const gb=[{id:1,type:"diamond",value:1e3},{id:2,type:"diamond",value:1200},{id:3,type:"diamond",value:1400},{id:4,type:"diamond",value:1600},{id:5,type:"diamond",value:1800},{id:6,type:"diamond",value:2e3}],mb=async()=>gb,lt={REWARDED:"rewarded",SKIPPED:"skipped",READY:"ready",WAITING:"waiting"},fb=i=>i[qn]?.rewards,yb=i=>i[qn]?.isRequesting,Eb=G([fb],i=>i),Sb=G([yb],i=>i),{DailyRewards:Nr}=GameCore.Configs,Ab=()=>async(i,e)=>{const t=e();if(Sb(t))return;i({type:qc,payload:{}});const n=await mb();i(bb(n))},bb=i=>e=>{const{player:t}=window.game,s=t.getCustomData("dailyRewarded"),{logDays:n=[],lastRewarded:a=0}=s||{},r=new Date,c=new Date(a),o=new Date(c.toDateString()),l=Math.abs(r.valueOf()-o.valueOf()),d=Math.floor(l/864e5)>1,p=Nr.CheckInterrupt&&d||n.length>=Nr.MaxDays,g=p?[!1]:[...n,!1];$l(g);const m=i.map((E,f)=>{const y=f<g.length,S=g.length===f+1,T=g[f]===!1;let b=lt.WAITING;return S?b=lt.READY:p?b=lt.WAITING:y&&T?b=lt.SKIPPED:y&&(b=lt.REWARDED),{...E,status:b}});e({type:Zc,payload:{rewards:m}})},$l=(i,e=!1)=>{const{player:t}=window.game;t.setCustomData("dailyRewarded",{logDays:i,lastRewarded:e?0:Date.now()})},{KEY:ln,FRAME:be}=_.DEFAULT;class Tb extends Phaser.GameObjects.Container{payload;blockBg;titleText;iconStatus;glowLight;currencyIcon;currencyText;glowAnimation;scaleAnimation;constructor(e,t){super(e),this.payload=t,this.setName(`Day: ${t.day}`),this.drawObjects(),this.setStatus()}setStatus(){const{status:e}=this.payload,{READY:t,REWARDED:s,SKIPPED:n}=lt;switch(e){case t:this.setStatusReady(),this.runAnimations();break;case n:this.setStatusSkipped();break;case s:this.setStatusRewarded();break;default:this.setStatusWaiting()}}setStatusReady(){this.setCurrentIconByDay(this.payload.day),this.blockBg.setFrame(be.DAILY_DAY_BG_OPEN),this.glowLight.setVisible(!0),Phaser.Display.Align.In.Center(this.glowLight,this.blockBg)}setStatusRewarded(){this.setCurrentIconByDay(this.payload.day),this.titleText.setText(this.scene.lang.Text.OWNED),this.titleText.setTint(7332137),this.blockBg.setFrame(be.DAILY_DAY_BG_REWARD)}setStatusSkipped(){this.setCurrentIconByDay(this.payload.day),this.titleText.setText(this.scene.lang.Text.SKIPPED),this.titleText.setTint(7332137),this.currencyIcon.setPipeline("Grayscale"),this.blockBg.setFrame(be.DAILY_DAY_BG_REWARD)}setStatusWaiting(){this.currencyIcon.setVisible(!1),this.currencyText.setVisible(!1),this.blockBg.setFrame(be.DAILY_DAY_BG_WAIT)}setCurrentIconByDay(e){let t=be.DAILY_DAY_COIN_DAY_1;switch(e){case 1:t=be.DAILY_DAY_COIN_DAY_1,this.currencyIcon.setFrame(t),this.currencyIcon.setWorldSize(32,30.5);break;case 2:t=be.DAILY_DAY_COIN_DAY_2,this.currencyIcon.setFrame(t),this.currencyIcon.setWorldSize(41.5,31.5);break;case 3:t=be.DAILY_DAY_COIN_DAY_3,this.currencyIcon.setFrame(t),this.currencyIcon.setWorldSize(55,34.5);break;case 4:t=be.DAILY_DAY_COIN_DAY_4,this.currencyIcon.setFrame(t),this.currencyIcon.setWorldSize(55,59);break;case 5:t=be.DAILY_DAY_COIN_DAY_5,this.currencyIcon.setFrame(t),this.currencyIcon.setWorldSize(61.5,61);break;case 6:t=be.DAILY_DAY_COIN_DAY_6,this.currencyIcon.setFrame(t),this.currencyIcon.setWorldSize(64.5,55);break}}drawObjects(){this.createGlowLight(),this.createBlockBG(),this.createTitleText(),this.createCurrencyIcon(),this.createCurrencyText(),this.createIconStatus()}createGlowLight(){const{KEY:e,FRAME:t}=_.EFFECTS;this.glowLight=this.scene.make.image({key:e,frame:t.FX_GLOW_LIGHT}),this.glowLight.setVisible(!1),this.glowLight.setWorldSize(206,199.5),this.add(this.glowLight)}createBlockBG(){this.blockBg=this.scene.make.image({key:ln,frame:be.DAILY_DAY_BG_WAIT}),this.blockBg.setWorldSize(91.5,107.5),this.add(this.blockBg)}createTitleText(){const{day:e}=this.payload,t=this.scene.lang.getCurrentLanguage();this.titleText=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(t==="ru"?13:16),text:this.scene.lang.getText({key:"DAY_X",variables:[e]}),origin:{x:.5,y:.5}}),this.add(this.titleText),Phaser.Display.Align.In.TopCenter(this.titleText,this.blockBg,0,-12)}createCurrencyIcon(){this.currencyIcon=this.scene.make.image({key:ln,frame:be.DAILY_DAY_COIN_DAY_1}),this.currencyIcon.setWorldSize(32,30.5),this.add(this.currencyIcon),Phaser.Display.Align.In.Center(this.currencyIcon,this.blockBg,0,-3)}createIconStatus(){this.iconStatus=this.scene.make.image({key:ln,frame:be.ICON_DOT}),this.iconStatus.setVisible(!1),this.iconStatus.setWorldSize(10,11),this.add(this.iconStatus),Phaser.Display.Align.In.Center(this.iconStatus,this.currencyIcon,20,10)}createCurrencyText(){const{value:e}=this.payload;this.currencyText=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(24),text:`${e}`,origin:{x:.5,y:.5}}),this.add(this.currencyText),Phaser.Display.Align.In.BottomCenter(this.currencyText,this.blockBg,0,-12)}runAnimations(){this.runGlowAnimation(),this.runScaleAnimation()}runGlowAnimation(){this.glowAnimation||(this.glowAnimation=new Mi({targets:[this.glowLight],repeat:-1,duration:6e3})),this.glowAnimation.play()}runScaleAnimation(){this.scaleAnimation||(this.scaleAnimation=new Ns({targets:[this],delay:1e3,duration:1e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],props:{scale:1.2},onStart:()=>{this.parentContainer?.bringToTop(this)}})),this.scaleAnimation.play()}}const{KEY:ai,FRAME:ri}=_.DEFAULT,{DailyRewards:oi}=GameCore.Configs,wb={id:0,type:"diamond",value:0};class Cb extends GameCore.Screen{onReward;onSkipAd;onNoAd;logDays;rewardsData;popup;loading;dayBlocks;currentDayBlocks;claimButton2X;backgroundFadeInAnimation;popupShowUpAnimation;popupExitsAnimation;contentShowUpAnimation;adsTimer;constructor(e,t,s,n){super(e,t,s,n),this.rewardsData=[],this.createPopup(),this.createCloseButton(),this.createPopupContents(),this.setDepth(Be.POPUP),this.background.setAlpha(.8)}async open(e){const{readonly:t=!1}=e||{};!await this.checkOpenable()&&!t||(super.open(),t&&this.claimButton2X.setDisabled(!0),await this.updateRewardsData(),this.createDayBlocks(),this.runOpenAnimation())}handleOnClaim=()=>{const e=this.getCurrentRewardValue();this.claimReward(e)};handleOnClaimX2=async()=>{const{audio:e,game:t}=this.scene;try{this.claimButton2X.setDisabled(!0),t.globalScene.screen.open(L.NOTIFY_SCREEN,{message:this.scene.lang.Text.LOADING,duration:0,loading:!0}),e.pauseMusic(),e.muteAll(),await this.scene.ads.showRewardedVideoAsync(),t.globalScene.screen.close(L.NOTIFY_SCREEN);const s=this.getCurrentRewardValue();this.claimReward(s*2)}catch(s){if(s instanceof Object&&GameCore.Utils.Object.hasOwn(s,"code")&&s.code==="USER_INPUT"){this.onSkipAd();return}this.onNoAd()}finally{this.scene.ads.preloadRewardedVideoAsync().catch(s=>{}),this.adsTimer?.destroy(),e.unmuteAll(),e.playMusic(),this.claimButton2X.setDisabled(!1)}};claimReward(e){if(typeof this.onReward!="function"||this.logDays?.length<1||this.logDays[this.logDays.length-1])return;this.logDays[this.logDays.length-1]=!0,$l([...this.logDays]);const t=this.currentDayBlocks.getWorldPosition().x,s=this.currentDayBlocks.getWorldPosition().y;this.scene.events.emit("claim-reward",{x:t,y:s},e),this.onReward(e),this.scene.audio.playSound(H.DAILY_REWARD),this.runCloseAnimation()}updateRewardsData=async()=>{const{storage:e,player:t}=this.scene;await e.dispatch(Ab());const s=e.getState(),n=Eb(s)||[];if(n?.length<1)return;this.rewardsData=n;const a=t.getCustomData("dailyRewarded"),{logDays:r=[]}=a||{};this.logDays=[...r]};getCurrentRewardValue(){return this.rewardsData.find(({status:t})=>t===lt.READY)?.value||0}getRewardByDay(e){return this.rewardsData.find(t=>t.id===e)||wb}checkOpenable=async()=>{const{player:e}=this.scene,t=e.getCustomData("dailyRewarded"),{logDays:s=[],lastRewarded:n=0}=t||{};return s.length>oi.MaxDays||oi.MockTime>0&&Date.now()-n>=oi.MockTime*1e3?!0:!fn(n)};runOpenAnimation(){this.setVisible(!0),this.scene.audio.playSound(H.POPUP_SHOW),this.runBackgroundEntrancesAnimation(0,300),this.runPopupEntrancesAnimation(150,400),this.runPopupContentEntrancesAnimation(300,300)}runCloseAnimation(){this.scene.audio.playSound(H.POPUP_OFF,{volume:.6}),this.runPopupExitsAnimation(0,200)}runBackgroundEntrancesAnimation(e,t){this.backgroundFadeInAnimation||(this.backgroundFadeInAnimation=new Ve({targets:[this.background],delay:e,duration:t,props:{alpha:{getStart:()=>0,getEnd:()=>.8}}})),this.backgroundFadeInAnimation.play()}runPopupEntrancesAnimation(e,t){this.popupShowUpAnimation||(this.popupShowUpAnimation=new rs({targets:[this.popup],delay:e,duration:t,props:{scale:{start:0,from:0,to:1},alpha:{start:1,from:1,to:1}}})),this.popupShowUpAnimation.play()}runPopupContentEntrancesAnimation(e,t){const s=this.dayBlocks.getChildren();s.length<1||(this.contentShowUpAnimation?.remove(),this.contentShowUpAnimation=new zs({targets:s,duration:t,delay:this.scene.tweens.stagger(150,{start:e}),props:{alpha:{start:0,from:0,to:1}}}),this.contentShowUpAnimation.play())}runPopupExitsAnimation(e,t){this.popupExitsAnimation||(this.popupExitsAnimation=new ke({targets:[this.popup],delay:e,duration:t,props:{y:250,scale:0},onComplete:()=>{this.scene.screen.close(this.name)}})),this.dayBlocks.destroy(!0,!0),this.popupExitsAnimation.play()}createCloseButton(){const e=new Qt(this.scene,{key:ai,frame:ri.BUTTON_CLOSE,width:48.5,height:43,paddingZone:20});this.popup.add(e),e.setName("Close"),e.useSound=!1,e.onClick=this.handleOnClaim,Phaser.Display.Align.In.TopRight(e,this.popup,25,25)}createPopup(){this.popup=new Ye(this.scene,0,0,334,390),this.add(this.popup),Phaser.Display.Align.In.Center(this.popup,this.zone)}createPopupContents(){this.createTitle(),this.createLoading(),this.createClaimX2Button()}createTitle(){const e=this.scene.add.container(),t=this.scene.make.image({key:ai,frame:ri.RIBBON_VIOLET});t.setWorldSize(225,65.5);const s=this.scene.lang.getCurrentLanguage(),n=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(s==="ru"?16:22),text:this.scene.lang.Text.DAILY_REWARDS});Phaser.Display.Align.In.Center(n,t,0,-2),e.add([t,n]),this.popup.add(e),Phaser.Display.Align.In.TopCenter(e,this.popup,0,-10)}createLoading(){this.loading=new Rt(this.scene),this.loading.setVisible(!1),this.loading.setTint(12237498),this.popup.add(this.loading),Phaser.Display.Align.In.Center(this.loading,this.popup)}createDayBlocks(){this.dayBlocks?.destroy(!0,!0);const e=2,t=3,s=oi.MaxDays,n=12,a=90,r=110,c=a+n,o=r+n;this.dayBlocks=this.scene.make.group({maxSize:s}),new Array(s).fill(null).forEach((h,d)=>{const u=this.createDayBlock(d+1);this.dayBlocks.add(u)}),Phaser.Actions.GridAlign(this.dayBlocks.getChildren(),{width:t,height:e,cellWidth:c,cellHeight:o,x:-50,y:-30})}createDayBlock(e){const{type:t,value:s,status:n=""}=this.getRewardByDay(e),a=new Tb(this.scene,{day:e,type:t,value:s,status:n});return a.setAlpha(0),this.popup.add(a),n===lt.READY&&(this.currentDayBlocks=a),a}createClaimX2Button(){this.claimButton2X=new Q(this.scene,ai,ri.BUTTON_BLUE,134,68),this.claimButton2X.setName("ClaimX2");const e=this.scene.lang.getCurrentLanguage(),t=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(e==="ru"?12:16),text:this.scene.lang.Text.CLAIM_X2,origin:{x:0,y:.5}}),s=this.scene.make.image({key:ai,frame:ri.ICON_ADS_VIDEO});s.setWorldSize(36,28),Phaser.Display.Align.In.Center(s,this.claimButton2X,-34),Phaser.Display.Align.In.Center(t,this.claimButton2X,19,0),this.claimButton2X.add([t,s]),this.popup.add(this.claimButton2X),Phaser.Display.Align.In.BottomCenter(this.claimButton2X,this.popup,0,-25),this.claimButton2X.onClick=this.handleOnClaimX2}}const{KEY:Es,FRAME:Te}=_.DEFAULT;class Ib extends GameCore.Screen{popup;title;contents;settingMusic;settingSound;settingVibrate;blockMusic;blockSound;blockVibrate;popupShowUpAnimation;popupFadeOutAnimation;contentShowUpAnimation;constructor(e,t,s,n){super(e,t,s,n),this.createPopup(),this.createCloseButton(),this.createTitle(),this.createButtons(),this.addItem(),this.createInput(),this.setDepth(Be.POPUP),this.background.setAlpha(.8)}open(){super.open();const{player:e}=this.scene,t=e.getPlayerSettings(),{music:s,sound:n,vibrate:a}=t;this.settingMusic.updateStatus(s),this.settingSound.updateStatus(n),this.settingVibrate.updateStatus(a),la()||(this.blockVibrate.setVisible(!1),this.blockMusic.setPosition(0,-30),this.blockSound.setPosition(0,40)),this.runOpenAnimation()}createInput(){this.settingMusic.onClick=this.handleMusicSetting,this.settingSound.onClick=this.handleSoundSetting,this.settingVibrate.onClick=this.handleVibrateSetting}handleClose=()=>{this.runCloseAnimation()};handleMusicSetting=e=>{this.scene.player.setSetting("music",e),e?this.scene.audio.playMusic():this.scene.audio.pauseMusic()};handleSoundSetting=e=>{this.scene.player.setSetting("sound",e)};handleVibrateSetting=e=>{this.scene.player.setSetting("vibrate",e)};createCloseButton(){const e=new Qt(this.scene,{key:Es,frame:Te.BUTTON_CLOSE,width:48.5,height:43,paddingZone:20});this.popup.add(e),e.setName("Close"),e.useSound=!1,e.onClick=this.handleClose,Phaser.Display.Align.In.TopRight(e,this.popup,25,25)}createPopup(){this.popup=new Ye(this.scene,0,0,310,220),this.add(this.popup),Phaser.Display.Align.In.Center(this.popup,this.zone)}createTitle(){this.title=this.scene.add.container();const e=this.scene.make.image({key:Es,frame:Te.RIBBON_VIOLET});e.setWorldSize(225,65.5);const t=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(26),text:this.scene.lang.Text.SETTINGS,origin:{x:.5,y:.5}});Phaser.Display.Align.In.Center(t,e,0,-2),this.title.add([e,t]),Phaser.Display.Align.In.TopCenter(this.title,this.popup)}createButtons(){const{music:e,sound:t,vibrate:s}=this.scene.player.getPlayerSettings();this.createMusicButton(e),this.createSoundButton(t),this.createVibrateButton(s)}createMusicButton(e){this.blockMusic=this.scene.make.container({}),this.settingMusic=new vs(this.scene,{enable:e,frameOn:Te.SWITCH_ON,frameOff:Te.SWITCH_OFF,framePanel:Te.SWITCH_PANEL}),this.settingMusic.setName("Music"),this.settingMusic.setPosition(60,0),this.settingMusic.icon.setWorldSize(25.5,24),this.settingMusic.button.setWorldSize(67.5,26);const t=this.scene.make.image({key:Es,frame:Te.ICON_MUSIC});t.setPosition(-85,0),t.setWorldSize(34,37.5);const s=this.scene.lang.getCurrentLanguage(),n=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(s==="ru"?17:20),text:this.scene.lang.Text.MUSIC,alpha:.8});n.setPosition(-60,-8),this.blockMusic.add([t,n,this.settingMusic]),this.blockMusic.setPosition(0,-40)}createSoundButton(e){this.blockSound=this.scene.make.container({}),this.settingSound=new vs(this.scene,{enable:e,frameOn:Te.SWITCH_ON,frameOff:Te.SWITCH_OFF,framePanel:Te.SWITCH_PANEL}),this.settingSound.setName("Sound"),this.settingSound.setPosition(60,0),this.settingSound.icon.setWorldSize(25.5,24),this.settingSound.button.setWorldSize(67.5,26);const t=this.scene.make.image({key:Es,frame:Te.ICON_SOUND});t.setPosition(-85,0),t.setWorldSize(30.5,37.5);const s=this.scene.lang.getCurrentLanguage(),n=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(s==="ru"?17:20),text:this.scene.lang.Text.SOUND,alpha:.8});n.setPosition(-60,-8),this.blockSound.add([t,n,this.settingSound]),this.blockSound.setPosition(0,10)}createVibrateButton(e){this.blockVibrate=this.scene.make.container({}),this.settingVibrate=new vs(this.scene,{enable:e,frameOn:Te.SWITCH_ON,frameOff:Te.SWITCH_OFF,framePanel:Te.SWITCH_PANEL}),this.settingVibrate.setName("Vibrate"),this.settingVibrate.setPosition(60,0),this.settingVibrate.icon.setWorldSize(25.5,24),this.settingVibrate.button.setWorldSize(67.5,26);const t=this.scene.make.image({key:Es,frame:Te.ICON_VIB});t.setPosition(-85,0),t.setWorldSize(28,40);const s=this.scene.lang.getCurrentLanguage(),n=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(s==="ru"?17:20),text:this.scene.lang.Text.VIBRATE,alpha:.8});n.setPosition(-60,s==="ru"?-8:-12),this.blockVibrate.add([t,n,this.settingVibrate]),this.blockVibrate.setPosition(0,60)}addItem(){this.popup.add([this.title,this.blockMusic,this.blockSound,this.blockVibrate]),this.contents=this.scene.add.group(),this.contents.addMultiple([this.blockMusic,this.blockSound,this.blockVibrate])}runOpenAnimation(){this.popupShowUpAnimation?.tween?.isPlaying()||(this.scene.audio.playSound(H.POPUP_SHOW),this.runPopupEntrancesAnimation(0,400),this.runPopupContentEntrancesAnimation(200,300))}runCloseAnimation(){this.popupFadeOutAnimation?.tween?.isPlaying()||(this.scene.audio.playSound(H.POPUP_OFF,{volume:.6}),this.runPopupExitsAnimation(0,200))}runPopupEntrancesAnimation(e,t){if(!this.popupShowUpAnimation){const{y:s,scale:n}=this.popup;this.popupShowUpAnimation=new rs({targets:[this.popup],delay:e,duration:t,props:{y:{from:350,to:s},alpha:{start:1,from:1,to:1},scale:{start:0,from:0,to:n}}})}this.popupShowUpAnimation.play()}runPopupContentEntrancesAnimation(e,t){this.contentShowUpAnimation?.remove(),this.contentShowUpAnimation=new zs({targets:this.contents.getChildren(),duration:t,delay:e,props:{alpha:{start:0,from:0,to:1}}}),this.contentShowUpAnimation.play()}runPopupExitsAnimation(e,t){this.popupFadeOutAnimation||(this.popupFadeOutAnimation=new ke({targets:[this.popup],delay:e,duration:t,props:{y:250,scale:0},onComplete:()=>{this.popup.setY(0),this.scene.screen.close(this.name)}})),this.popupFadeOutAnimation.play()}}const{KEY:Pb,FRAME:Mr}=_.EFFECTS;class vb extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitter;constructor(e){super(e,Pb,Mr.FX_COMET),this.scene=e,this.createEmitters(),this.setActive(!1),this.setVisible(!1),this.scene.add.existing(this)}createEmitters(){const e=1/GameCore.Utils.Image.getImageScale();this.emitter=this.createEmitter({on:!1,frame:Mr.FX_COMET,alpha:{start:.8,end:.5},speed:{min:60,max:120},scale:{start:e*.4,end:e},lifespan:{min:700,max:1200}})}explode(e,t,s){this.revive(),this.emitter.explode(e,t,s)}}const{KEY:Ob,FRAME:Lr}=_.EFFECTS;class _b extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitter;constructor(e){super(e,Ob,Lr.FX_COMET),this.scene=e,this.createEmitters(),this.setActive(!1),this.setVisible(!1),this.scene.add.existing(this)}createEmitters(){const e=1/GameCore.Utils.Image.getImageScale();this.emitter=this.createEmitter({on:!1,frame:Lr.FX_COMET,alpha:{start:1,end:.8},speed:{min:40,max:80},scale:{start:e*.4,end:e*.7},lifespan:{min:400,max:600}})}explode(e,t,s){this.revive(),this.emitter.explode(e,t,s)}}const{KEY:Rb,FRAME:xb}=_.EFFECTS;class Db extends Phaser.GameObjects.Container{coinGroup;containerGroup;startsExplosive;startsExplosiveSmall;startsExplosiveSmallTimer;constructor(e){super(e),this.setVisible(!0),this.coinGroup=this.scene.add.group({defaultKey:Rb,defaultFrame:xb.COIN}),this.containerGroup=this.scene.add.group({classType:Phaser.GameObjects.Container}),this.startsExplosive=new vb(e),this.startsExplosive.setDepth(z.ON_TOP+1),this.startsExplosiveSmall=new _b(e),this.startsExplosiveSmall.setDepth(z.ON_TOP+1),this.scene.add.existing(this)}createConfigOne(e,t,s){const n=e/300,a=new Phaser.Math.Vector2(0,0),r=new Phaser.Math.Vector2(0,-e),c=s?-1:1,o=Phaser.Math.RND.between(-90,90),l=o<0?1:(300-Math.abs(o))/300,h=(o+90)/180*180*l*n,d=Phaser.Math.RND.between(20,h+20),u=new Phaser.Math.Vector2(1,0);u.setAngle(o*Math.PI/180);const p=Phaser.Math.RND.between(-Math.abs(o)-15,-Math.abs(o)+15),g=d*(100-Math.abs(o))/100*n,m=Phaser.Math.RND.between(g*.2,g),E=new Phaser.Math.Vector2(1,0);E.setAngle(p*Math.PI/180);const f=c*u.x*d,y=u.y*d,S=c*E.x*m,T=E.y*m-e,b=new Phaser.Math.Vector2(f,y),C=new Phaser.Math.Vector2(S,T),O=new Phaser.Curves.CubicBezier(a,b,C,r),v=Phaser.Math.RND.between(1200+d*3,1600+d*3),w=this.coinGroup.get(0,0);return w.revive(),w.setRotation(-t.rotation),w.setWorldSize(24,22),t.add(w),{from:0,to:1,duration:v,ease:"Sine.In",onUpdate:P=>{const D=O.getPointAt(P.getValue());w.setPosition(D.x,D.y)},onComplete:P=>{if(w.kill(),P.totalProgress<1||(this.scene.audio.playSound(H.DIAMONDS_EAT),this.startsExplosiveSmallTimer&&!this.startsExplosiveSmallTimer.hasDispatched))return;this.startsExplosiveSmallTimer=this.scene.time.delayedCall(100,()=>null);const D=w.getWorldPosition();this.startsExplosiveSmall.explode(10,D.x,D.y)}}}explode(e,t,s,n,a){if(e<=0)return[];this.startsExplosive.explode(30,t,s);const r=new Phaser.Math.Vector2(n-t,a-s),c=r.length(),o=this.containerGroup.get(t,s);o.setRotation(r.angle()+Math.PI/2),o.revive(),this.add(o);let l,h=0;const d=[];for(let p=0;p<e;p++){const g=this.createConfigOne(c,o,p%2===0),m=this.scene.tweens.addCounter(g);d.push(m),g.duration>h&&(h=g.duration,l=m)}const u=()=>{d.forEach(p=>{p.complete()}),this.startsExplosive.emitters.getAt(0)?.killAll(),this.startsExplosiveSmall.emitters.getAt(0)?.killAll(),o.kill()};return l?.once(Phaser.Tweens.Events.TWEEN_COMPLETE,()=>{o.kill(),this.scene.events.off("sleep",u)}),this.scene.events.once("sleep",u),d}}const{Gameplay:Bb,LeadersBoard:kb}=GameCore.Configs;class Nb extends is{main;header;footer;rewardScreen;dailyMissionScreen;dailyRewardsScreen;currentCoins;timerDailyRewards;coinsExplosive2;coinsExplosiveTimer;run=()=>{this.currentCoins=0,this.footer.missionIcon?.checkNotice(),this.main.playSingleButton.runAnimation(),q.off(se.EVENTS.NOTICE_UPDATE,this.footer.missionIcon.checkNotice),q.on(se.EVENTS.NOTICE_UPDATE,this.footer.missionIcon.checkNotice),this.updateCurrentBestScore(),this.updateCurrentCoins(),this.timerDailyRewards?.remove(),this.timerDailyRewards=this.time.delayedCall(300,()=>{this.screen.open(L.DAILY_REWARD_SCREEN)});const e=[{selector:ul,callback:t=>{if(this.main.board.showLoading(t),this.main.board.resetLeadersData(),t===!1){const s=this.game.storage.getState(),n=hl(s);if(Object.keys(n).length<1){this.main.board.setEmptyMessageVisible(!0);return}this.main.board.updateLeadersData(n),this.main.board.setEmptyMessageVisible(!1)}}}];this.handleStateChange(e),this.storage.dispatch(hi(kb.LeaderboardId,Yt,30,0)),this.facebook.attemptToAddShortcut()};updateCurrentBestScore(){const e=this.player.getBestScore(),t=this.storage.getState(),{bestScore:s=0}=et(t),n=e>s?e:s;this.header.scoreBar.setValue(n)}updateCurrentCoins(){const e=this.player.getCoins();this.setCoins(e)}preload(){this.events.on("wake",this.run),this.events.on("resume",this.run),this.events.on("create",this.run),this.events.on(Phaser.Scenes.Events.PAUSE,()=>{this.timerDailyRewards?.remove()})}create(){super.create(),this.createBackground($.BACKGROUND.KEY),this.createEffects(),this.createSettingsScreen(),this.createRewardScreen(),this.createDailyMissionScreen(),this.createDailyRewardsScreen(),this.createHeaderBar(),this.createMainContent(),this.createFooterBar(),this.listenEvents()}eatCoins=e=>{const t=this.currentCoins+e;this.player.setCustomData("coin",t)};earnAdsRewardAnimation=e=>{const t=this.gameZone.width/2,s=this.gameZone.height/2;this.runCoinsExplodeEffect({x:t,y:s},e)};setCoins(e){const t=e<0?0:e;this.currentCoins=t,this.header.coinBar.setValue(t)}createSettingsScreen(){this.screen.add(L.SETTINGS_SCREEN,Ib)}createRewardScreen(){this.rewardScreen=this.screen.add(L.REWARD_SCREEN,Zm)}createDailyMissionScreen(){this.dailyMissionScreen=this.screen.add(L.DAILY_MISSIONS_SCREEN,pb),this.dailyMissionScreen.onReward=(e,t)=>{e==="coin"&&this.eatCoins(t)}}createDailyRewardsScreen(){this.dailyRewardsScreen=this.screen.add(L.DAILY_REWARD_SCREEN,Cb),this.dailyRewardsScreen.onNoAd=this.showNotifyNoAds,this.dailyRewardsScreen.onSkipAd=this.showNotifySkipAds,this.dailyRewardsScreen.onReward=e=>{this.eatCoins(e)}}listenEvents(){this.events.on("claim-reward",this.runCoinsExplodeEffect)}runCoinsExplodeEffect=(e,t)=>{const{x:s,y:n}=this.header.coinBar.getCoinIconPosition(),a=t/25>15?15:t/25;this.coinsExplosive2.explode(a,e.x,e.y,s,n).forEach(c=>{c.on(Phaser.Tweens.Events.TWEEN_START,()=>{this.header.setDepth(z.ON_TOP)}),c.on(Phaser.Tweens.Events.TWEEN_COMPLETE,o=>{const l=this.currentCoins+t/a;if(this.setCoins(l),this.coinsExplosiveTimer?.remove(),o.totalProgress<1){this.header.setDepth(z.ITEM);return}this.coinsExplosiveTimer=this.time.delayedCall(1e3,()=>{this.header.setDepth(z.ITEM)})})})};showNotifyNoAds=()=>{const{globalScene:e}=this.game;e.screen.open(L.NOTIFY_SCREEN,{message:this.lang.Text.NO_ADS,duration:1200,loading:!1})};showNotifySkipAds=()=>{const{globalScene:e}=this.game;e.screen.open(L.NOTIFY_SCREEN,{message:this.lang.Text.SORRY_NO_REWARDS,duration:1500,loading:!1})};createHeaderBar(){this.header=new ZA(this),this.header.setDepth(z.BUTTON),this.header.coinBar.onClick=this.handleCoinBarClick,Phaser.Display.Align.In.TopCenter(this.header,this.gameZone)}createMainContent(){this.main=new sb(this),this.main.setDepth(z.LOGO),this.main.playSingleButton.onClick=this.handlePlaySingle,Phaser.Display.Align.In.Center(this.main,this.gameZone,0,-5)}createFooterBar(){this.footer=new KA(this),this.footer.setDepth(z.BUTTON),this.footer.missionIcon.onClick=this.handleDailyIconClick,this.footer.settingIcon.onClick=this.handleSettingClick;const e=this.ads.getBannerHeight();Phaser.Display.Align.In.BottomCenter(this.footer,this.gameZone,0,-e)}createEffects(){this.coinsExplosive2=new Db(this),this.coinsExplosive2.setDepth(z.ON_TOP)}handlePlaySingle=()=>{this.storage.dispatch(ga()),this.storage.dispatch(Ul("endless"))};handleSettingClick=()=>{this.screen.open(L.SETTINGS_SCREEN)};handleDailyIconClick=()=>{this.screen.open(L.DAILY_MISSIONS_SCREEN)};handleCoinBarClick=()=>{this.rewardScreen.onReward=this.earnAdsRewardAnimation,this.screen.open(L.REWARD_SCREEN,{awardCoins:Bb.AwardCoins})}}const{KEY:Mb,FRAME:Gr}=_.EFFECTS;class Fr extends Phaser.GameObjects.Particles.ParticleEmitterManager{config;emitter;constructor(e,t){super(e,Mb,Gr.BLANK),this.config=t||{},this.scene.add.existing(this)}createEmitters(){const{FX_CONFETTI_SMALL_1:e,FX_CONFETTI_SMALL_2:t,FX_CONFETTI_SMALL_3:s,FX_CONFETTI_SMALL_4:n}=Gr,a=1/GameCore.Utils.Image.getImageScale(),r={on:!1,particleBringToTop:!0,frame:[e,t,s,n],tint:[14223402,1021804,5420529,16702052],timeScale:1,frequency:300,maxParticles:120,gravityY:-10,speedX:{min:-100,max:100},speedY:{min:80,max:250},alpha:{start:1,end:.8},rotate:{start:0,end:360*3},scale:{min:a*.8,max:a},angle:{min:20,max:160},lifespan:{min:8e3,max:12e3}},c=Ie(r,this.config);this.emitter=this.createEmitter(c)}run(e,t,s){this.stop(),this.emitter.setQuantity(e),this.emitter.setPosition(t,s),this.emitter.start()}explode(e,t,s){this.emitter||this.createEmitters(),this.emitter.explode(e,t,s)}stop(){this.emitter?.killAll(),this.emitter?.stop(),this.emitter?.remove(),this.createEmitters()}}const Lb={targets:[],duration:600,ease:Phaser.Math.Easing.Back.Out,props:{y:{from:500,to:0}}};class jl extends pe{constructor(e){super(Lb,e)}}const Xl=i=>{const e=i?i.split("_"):[];let t=e.length>0?e[0]:"en_US";switch(t){case"id":case"in":t="id";break}return t},Gb={targets:[],props:{alpha:{duration:500,value:{start:0,from:0,to:1},ease:Phaser.Math.Easing.Cubic.Out},scale:{duration:1e3,value:{start:.8,from:.8,to:1},ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45]}}};class ql extends pe{constructor(e){super(Gb,e)}}const{KEY:Ur,FRAME:At}=_.DEFAULT;let Fb=class extends ns{scene;rankIcon;constructor(e){super(e,{key:Ur,frame:At.AVATAR_FRAME_PURPLE,background:At.AVATAR_BG,width:67,height:67,loadDelay:100}),this.scene=e,this.createRankIcon()}setHighlight(){this.avtFrame.setFrame(At.AVATAR_FRAME_BLUE_BIG),this.avtFrame.setWorldSize(67,67)}updateLeaderRankIcon(e){e===1?this.rankIcon.setFrame(At.ICON_GOLD):e===2?this.rankIcon.setFrame(At.ICON_SILVER):e===3?this.rankIcon.setFrame(At.ICON_BRONZE):this.rankIcon.kill()}createRankIcon(){this.rankIcon=this.scene.make.image({key:Ur,frame:At.ICON_GOLD}),this.rankIcon.setWorldSize(39,47.5),this.add(this.rankIcon),Phaser.Display.Align.In.TopLeft(this.rankIcon,this,15,15)}};const{KEY:hn,FRAME:un}=_.DEFAULT;class Ss extends Phaser.GameObjects.Container{scene;payload;isCurrentPlayer=!1;avatar;block;playerScore;label;playerNameText;shareButton;shareButtonLabel;playButton;playButtonLabel;showItems;showPopUp;scaleAnimation;constructor(e,t){super(e),this.scene=e,this.createAvatar(),this.createPlayButton(),this.createPlayerName(),this.createPlayerScore(),this.updateInfo(t),this.scene.add.existing(this)}updateInfo(e){e&&(this.payload=e),this.updateAvatar(),this.updateButton(),this.updatePlayerName(),this.updatePlayerScore(),this.updateLeaderRankIcon(),e&&e.playerId===this.scene.player.getPlayerId()&&this.setHighLight()}set onClick(e){const{width:t,height:s}=this.block;this.setSize(t,s+this.avatar.height),this.setInteractive({useHandCursor:!0}),this.off(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN),this.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,e)}setLabel(e){this.label.setText(e)}setScore(e){this.playerScore.setText(e)}showAnimations(e=0,t=300){const s=e*200;this.runShowItemAnimation(s,t),this.runShowPopUpAnimation(s,t)}updateLeaderRankIcon(){if(!this.payload?.rank){this.avatar.updateLeaderRankIcon(0);return}this.avatar.updateLeaderRankIcon(this.payload.rank)}updateButton(){this.playButton?.revive(),this.shareButton?.kill(),this.payload||(this.playButton.kill(),this.playButton=new Q(this.scene,hn,un.BUTTON_GREEN_MINOR,70,31),this.playButton.setName("Random"),this.playButtonLabel.setText(this.scene.lang.Text.RANDOM),this.playButton.add(this.playButtonLabel),this.add(this.playButton),Phaser.Display.Align.In.Center(this.playButtonLabel,this.playButton),Phaser.Display.Align.In.Center(this.playButton,this.avatar,0,90))}runShowPopUpAnimation(e,t){this.scene.tweens.killTweensOf(this),this.showPopUp=new fa({targets:[this],delay:e,duration:t,props:{y:{start:this.y+70,to:this.y}}}),this.showPopUp.play()}runShowItemAnimation(e,t){const s=this.getAll();this.scene.tweens.killTweensOf(s),this.showItems=new ql({targets:s,duration:t,delay:this.scene.tweens.stagger(50,{start:e+50}),props:{scale:{duration:1e3,getStart:n=>n.scale*.8,getEnd:n=>n.scale,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45]}}}),this.showItems.play()}createAvatar(){this.avatar=new Fb(this.scene),this.add(this.avatar),Phaser.Display.Align.In.TopCenter(this.avatar,this,0,35+this.avatar.displayHeight/2)}updateAvatar(){if(!this.payload?.playerId||!this.payload?.photo){this.avatar.loadPhoto($.ICON_EARTH.KEY,$.ICON_EARTH.FILE,50);return}const{playerId:e,photo:t}=this.payload;this.avatar.loadPhoto(e,t,50)}createPlayerScore(){this.playerScore=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(18),origin:{x:.5,y:.5}}),this.playerScore.setTint(16777215),Phaser.Display.Align.In.Center(this.playerScore,this.avatar,0,60),this.add(this.playerScore)}updatePlayerScore(){if(!this.payload?.score){this.playerScore.kill();return}this.playerScore.setText(Math.floor(this.payload.score).toString()),Phaser.Display.Align.In.Center(this.playerScore,this.avatar,0,62)}updatePlayerName(){if(!this.payload?.name)return;const{name:e}=this.payload,t=GameCore.Utils.String.getShortName(e,9),s=GameCore.Utils.String.removeDiacritics(t);this.playerNameText.setText(s),Phaser.Display.Align.In.Center(this.playerNameText,this.avatar,0,44)}createPlayButton(){this.playButton=new Q(this.scene,hn,un.BUTTON_GREEN_MINOR,60,31),this.playButton.setName("Play"),this.playButton.onClick=()=>{const e=this.payload?.playerId;e&&this.scene.storage.dispatch(Gi(e))},this.add(this.playButton),this.playButtonLabel=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(13),text:this.scene.lang.Text.PLAY,origin:{x:.5,y:.5}}),this.playButton.add(this.playButtonLabel),Phaser.Display.Align.In.Center(this.playButtonLabel,this.playButton,0,-1),Phaser.Display.Align.In.Center(this.playButton,this.avatar,0,90)}setHighLight(){this.isCurrentPlayer=!0,this.avatar.setHighlight(),this.useShareButton()}useShareButton(){if(this.playButton.kill(),this.shareButton){this.shareButton.revive();return}this.shareButton=new Q(this.scene,hn,un.BUTTON_BLUE_MINOR,60,31),this.shareButton.setName("Share"),this.shareButton.onClick=()=>{this.scene.storage.dispatch(qf())},this.add(this.shareButton),this.shareButtonLabel=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(13),text:this.scene.lang.Text.SHARE,origin:{x:.5,y:.5}}),this.shareButton.add(this.shareButtonLabel),Phaser.Display.Align.In.Center(this.shareButtonLabel,this.shareButton,0,-1),Phaser.Display.Align.In.Center(this.shareButton,this.avatar,0,90)}setCurrentUserLeader(){this.runScaleAnimation()}runScaleAnimation(){!this.scaleAnimation&&this.isCurrentPlayer&&(this.scaleAnimation=new Ns({targets:[this.avatar],delay:1e3,duration:2e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],props:{scale:1.15,y:this.avatar.y-3}}),this.scaleAnimation.play())}createPlayerName(){this.playerNameText=this.scene.make.text({style:{fontFamily:B.FONT_FAMILY},text:"Global"}),this.playerNameText.setTint(12700904),this.playerNameText.setHighQuality(),this.playerNameText.setFontSize(14),this.add(this.playerNameText),Phaser.Display.Align.In.Center(this.playerNameText,this.avatar,0,55)}}class Ub extends Phaser.GameObjects.Container{scene;payload;leaderBlocks;loading;globalBlock;tournamentBlock;background;entrancesAnimation;constructor(e,t){super(e),this.scene=e,t&&this.updateInfo(t),this.setName("LeadersBar"),this.createBackground(),this.createLoading(),this.createLeaderBlocks(),this.createGlobalMatchBlock(),this.createTournamentBlock(),this.createEntrancesAnimation(),this.scene.add.existing(this)}updateAnimations(){this.leaderBlocks.getChildren().forEach((e,t)=>{e.active&&e instanceof Ss&&(e.showAnimations(t,1e3),e.setCurrentUserLeader())})}updateInfo(e){this.payload=e;const{leaders:t}=this.payload;this.leaderBlocks.clear(!0),t.forEach((s,n)=>{if(s.rank=n+1,this.leaderBlocks.countActive(!1)>0){const r=this.leaderBlocks.get();r.revive(),r.updateInfo(s);return}const a=new Ss(this.scene,s);a.revive(),a.updateInfo(s),this.background.add(a),this.leaderBlocks.add(a)}),this.updateSpecialBlock(),this.alignBlocks(),this.runAnimation()}killAndHideAll(){this.removeAll(!1),this.leaderBlocks.getChildren().forEach(e=>this.leaderBlocks.killAndHide(e))}showLoading(e){this.loading.setVisible(e)}runAnimation(){this.leaderBlocks.setAlpha(0),this.updateAnimations()}createGlobalMatchBlock(){const e=new Ss(this.scene);e.updateInfo(),e.playButton.setName("JoinGroup"),e.playButton.onClick=this.handleMatchingGroup,e.kill(),this.background.add(e),this.globalBlock=e}createTournamentBlock(){const e=new Ss(this.scene);e.useShareButton(),e.shareButton.revive(),e.shareButton.setName("InviteTournament"),e.shareButton.onClick=this.handleInviteTournament,e.playButton.kill(),e.playerNameText.setText(this.scene.lang.Text.FRIENDS),e.shareButtonLabel.setText(this.scene.lang.Text.INVITE),e.playerNameText.setX(e.playerNameText.x-3),e.kill(),this.background.add(e),this.tournamentBlock=e}createBackground(){this.background=new Ye(this.scene,0,0,375,170),this.add(this.background),Phaser.Display.Align.In.Center(this.background,this.scene.gameZone,0,90)}createEntrancesAnimation(){this.entrancesAnimation=new jl({targets:this.leaderBlocks.getChildren(),delay:this.scene.tweens.stagger(50,{start:400})})}createLoading(){this.loading=new Rt(this.scene),this.loading.setTint(5982858),this.loading.setWorldSize(55,55),this.loading.setDepth(z.POPUP),this.add(this.loading),Phaser.Display.Align.In.Center(this.loading,this.background)}updateSpecialBlock(){const{storage:e}=this.scene,t=e.getState();dt(t)===De?(this.tournamentBlock.revive(),this.leaderBlocks.add(this.tournamentBlock)):(this.globalBlock.revive(),this.leaderBlocks.add(this.globalBlock))}alignBlocks(){const s=-(90*((this.leaderBlocks.getLength()-1)/2));this.leaderBlocks.setX(s,90)}createLeaderBlocks(){this.leaderBlocks=this.scene.add.group({classType:Ss})}handleMatchingGroup=async()=>{const{player:e,storage:t,game:s,facebook:n}=this.scene;try{s.globalScene.screen.open(L.NOTIFY_SCREEN,{message:this.scene.lang.Text.MATCHING,loading:!0});const a=e.getPlayer();let r="global";const c=Xl(a.locale);c==="en"&&(r="en"),c==="in"&&(r="in");const o=await n.matchPlayerAsync(r,!0,!0);if(s.globalScene.screen.close(L.NOTIFY_SCREEN),!o)return;t.dispatch(ma())}catch(a){s.globalScene.screen.close(L.NOTIFY_SCREEN),console.warn(a)}};handleInviteTournament=async()=>{}}const{KEY:Yr,FRAME:Hr}=_.DEFAULT;class Yb extends Q{constructor(e){super(e,Yr,Hr.BUTTON_BLUE_SHORT),this.scene=e,this.button.setWorldSize(63,58),this.createIcon()}createIcon(){const e=this.scene.add.image(0,0,Yr,Hr.ICON_HOME);e.setWorldSize(31,26),this.add(e),Phaser.Display.Align.In.Center(e,this.button,0,-2)}}const{KEY:zr,FRAME:Wr}=_.DEFAULT;class Hb extends Q{constructor(e){super(e,zr,Wr.BUTTON_GREEN),this.scene=e,this.button.setWorldSize(134,68),this.createIcon(),this.createText()}createIcon(){const e=this.scene.make.image({key:zr,frame:Wr.ICON_REPLAY});e.setWorldSize(26.5,27),Phaser.Display.Align.In.LeftCenter(e,this.button,-20),this.add(e)}createText(){const e=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(16),text:this.scene.lang.Text.REPLAY,origin:{x:1,y:.5}});Phaser.Display.Align.In.RightCenter(e,this.button,-25),this.add(e)}}let Zl=class extends Phaser.GameObjects.Container{homeButton;playButton;constructor(e){super(e),this.scene=e,this.createButtons(),this.alignButtons(),this.scene.add.existing(this)}alignButtons(){Phaser.Display.Align.In.Center(this.homeButton,this,0),Phaser.Display.Align.In.Center(this.playButton,this,0,-100)}createButtons(){this.createHomeButton(),this.createPlayButton()}createHomeButton(){this.homeButton=new Yb(this.scene),this.homeButton.setName("Home"),this.add(this.homeButton)}createPlayButton(){this.playButton=new Hb(this.scene),this.homeButton.setName("Replay"),this.add(this.playButton)}};class zb extends Zl{scene;entrancesAnimation;constructor(e){super(e),this.scene=e,this.createEntrancesAnimation()}runAnimation=()=>{this.entrancesAnimation.play()};createEntrancesAnimation(){this.entrancesAnimation=new jl({targets:[this],delay:800,props:{y:"-=5",alpha:{start:0,from:0,to:1}}})}}const Wb={targets:[],yoyo:!0,duration:120,ease:Phaser.Math.Easing.Circular.Out,props:{scale:{from:1,to:1.3}}};class Vb extends pe{constructor(e){super(Wb,e)}}class Kb extends as{dinoPulsateAnimation;constructor(e,t){super(e,t),this.removeBackground()}updateCongratsTitle(){this.updateCongratsBackground(),this.isDinoSad(!1)}removeBackground(){this.background.kill()}updateCongratsBackground(){this.background.revive(),this.background.setPosition(0,-10)}runAnimations(){super.runAnimations(),this.runDinoPulsateAnimation()}runDinoPulsateAnimation(){this.dinoPulsateAnimation||(this.dinoPulsateAnimation=new Jt({targets:[this.dino,this.leaves],duration:1400,repeatDelay:200,props:{scale:"+=0.08"}})),this.dinoPulsateAnimation.play()}}const{KEY:$b,FRAME:Vr}=_.DEFAULT,{Gameplay:jb}=GameCore.Configs;class Xb extends Phaser.GameObjects.Container{scene;bestScore;payload;dino;yourScoreText;bestScoreText;currentScoreText;entrancesAnimation;scoreAnimation;counterAnimation;bestScoreIcon;constructor(e){super(e),this.scene=e,this.bestScore=0,this.createDinoTitle(),this.createCurrentScore(),this.createBestScore(),this.createScoreAnimation(),this.createEntrancesAnimation(),this.scene.add.existing(this)}updateData(e){this.payload=e;const{bestScore:t,currentScore:s}=e;s<t&&(this.setBestScore(t),this.runScoreAnimation()),this.runAnimation()}runAnimation(){const{currentScore:e}=this.payload;this.setCurrentScore(0),e>0?(this.runScoreCounter(),this.scene.time.delayedCall(1300,()=>{this.entrancesAnimation.play()})):(this.setCurrentScore(e),this.entrancesAnimation.play())}runScoreCounter(){const{bestScore:e,currentScore:t}=this.payload;this.counterAnimation?.remove(),this.counterAnimation=this.scene.tweens.addCounter({from:0,to:t,delay:500,duration:2e3,completeDelay:300,onStart:()=>{this.scene.audio.playSound(H.SCORE_COUNTER)},onUpdate:s=>{const n=Math.floor(s.getValue());this.runScoreAnimation(),this.setCurrentScore(n)},onComplete:()=>{this.bestScore=e,this.setCurrentScore(t),(t>e||jb.AlwayShowBestScore)&&(this.bestScore=t,this.scene.screen.open(L.BEST_SCORE_SCREEN,{bestScore:t}),this.updateCongratsTitle(),this.scene.runConfettiEffects()),this.setBestScore(this.bestScore)}})}runScoreAnimation(){this.scoreAnimation.play()}setBestScore(e){this.bestScoreText.setText(`${e}`),Phaser.Display.Align.In.Center(this.bestScoreText,this.currentScoreText,5,50),Phaser.Display.Align.In.LeftCenter(this.bestScoreIcon,this.bestScoreText,30)}setCurrentScore(e){this.currentScoreText.setText(`${e}`)}createDinoTitle(){this.dino=new Kb(this.scene,{title:this.scene.lang.Text.YOUR_SCORE_,titleSize:25}),this.dino.isDinoSad(!0),this.dino.changeBackground(Vr.TRUMPET,278.5,82),Phaser.Display.Align.In.TopCenter(this.dino,this,0,20),this.add(this.dino)}updateCongratsTitle(){this.dino.updateCongratsTitle()}createCurrentScore(){this.currentScoreText=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(43),origin:{x:.5,y:.5}}),this.currentScoreText.setTint(15779090),Phaser.Display.Align.In.Center(this.currentScoreText,this,0,110),this.add(this.currentScoreText)}createBestScore(){this.createBestScoreText(),this.createBestScoreIcon(),this.setBestScore(this.bestScore)}createBestScoreText(){this.bestScoreText=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(30),origin:{x:0,y:.5}}),this.add(this.bestScoreText)}createBestScoreIcon(){this.bestScoreIcon=this.scene.make.image({key:$b,frame:Vr.ICON_BEST_SCORE_CUP}),this.bestScoreIcon.setWorldSize(26,24.5),this.add(this.bestScoreIcon)}createEntrancesAnimation(){this.entrancesAnimation=new Jt({targets:[this],repeat:0,duration:200,props:{scale:"+=0.03"}})}createScoreAnimation(){this.scoreAnimation=new Vb({targets:[this.currentScoreText],props:{scale:{from:1,to:1.3}}})}}class qb extends Phaser.GameObjects.Container{scene;bestScoreBlock;constructor(e){super(e),this.scene=e,this.createBestScoreBlock(),this.scene.add.existing(this)}createBestScoreBlock(){this.bestScoreBlock=new Xb(this.scene),this.add(this.bestScoreBlock)}}const{KEY:Kr,FRAME:$r}=_.EFFECTS;class Zb extends Phaser.GameObjects.Container{halo;star;constructor(e){super(e),this.createStar(),this.createHalo(),this.scene.add.existing(this)}run(){this.runStarAnimation(),this.runHaloAnimation()}createStar(){this.star=this.scene.make.image({key:Kr,frame:$r.FX_STAR_YELLOW,visible:!1}),this.star.setWorldSize(35,35),this.add(this.star)}createHalo(){this.halo=this.scene.make.image({key:Kr,frame:$r.FX_CIRCLE,visible:!1}),this.halo.setWorldSize(162,162),this.add(this.halo)}runStarAnimation(){this.scene.tweens.killTweensOf(this.star),this.star.setVisible(!0);const e=1/GameCore.Utils.Image.getImageScale();this.scene.tweens.add({targets:[this.star],duration:400,ease:Phaser.Math.Easing.Quintic.Out,props:{scaleX:{start:e*16,to:0},scaleY:{start:e*10,to:0}},onComplete:()=>{}})}runHaloAnimation(){this.scene.tweens.killTweensOf(this.halo);const e=1/this.scene.world.getPixelRatio();this.halo.setScale(e),this.halo.setVisible(!0),this.scene.tweens.add({targets:[this.halo],duration:200,ease:Phaser.Math.Easing.Cubic.Out,props:{scale:{from:e,to:e*5},alpha:{from:1,to:0}},onComplete:()=>{}})}}const{KEY:jr,FRAME:Xr}=_.DEFAULT;class Jb extends GameCore.Screen{scoreText;cupImage;bigStarExplosive;constructor(e,t,s,n){super(e,t,s,n),this.setDepth(Be.POPUP),this.background.setAlpha(.8),this.createObjects()}open=e=>{super.open(e);const t=this.getData("bestScore");this.setBestScore(t),this.runOpenAnimation(),this.scene.audio.playSound(H.CONGRATULATION)};createObjects(){this.createClose(),this.createBestScoreTitle(),this.createGlowEffect(),this.createCupImage(),this.createBestScoreNumber(),this.createBigStarExplosive()}setBestScore(e){this.scoreText.setText(`${e}`)}createClose(){const e=new Q(this.scene,jr,Xr.BUTTON_CLOSE,48.5,43);e.setName("Close"),this.add(e),Phaser.Display.Align.In.TopRight(e,this.zone,-15,-15),e.onClick=this.handleClose}handleClose=()=>{this.scene.screen.close(this.name)};createBestScoreTitle(){const e=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(50),text:this.scene.lang.Text.HIGH_SCORE});this.add(e),e.setTint(15911443),Phaser.Display.Align.In.TopCenter(e,this.zone,0,-100)}createBestScoreNumber(){this.scoreText=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(80),origin:{x:.5,y:.5}}),this.add(this.scoreText),this.scoreText.setTint(16777215),this.scoreText.letterSpacing=5,Phaser.Display.Align.In.Center(this.scoreText,this.zone,0,60)}createCupImage(){this.cupImage=this.scene.add.image(0,0,jr,Xr.ICON_RANKING),this.cupImage.setWorldSize(100,100),this.add(this.cupImage),Phaser.Display.Align.In.Center(this.cupImage,this.zone,0,-80)}createGlowEffect(){const{KEY:e,FRAME:t}=_.EFFECTS,s=this.scene.make.image({key:e,frame:t.FX_GLOW_LIGHT});s.setWorldSize(246,246),this.add(s),this.moveDown(s),Phaser.Display.Align.In.Center(s,this,0,-80),this.scene.tweens.add({targets:[s],duration:6e3,repeat:-1,props:{angle:360,scale:{value:"+=0.01",yoyo:!0,duration:800,ease:Phaser.Math.Easing.Sine.InOut}}})}createBigStarExplosive(){this.bigStarExplosive=new Zb(this.scene),this.add(this.bigStarExplosive)}runOpenAnimation(){this.runBigStarExplosive(),this.runScoreEntrancesAnimation()}runBigStarExplosive=()=>{const{x:e,y:t}=this.cupImage;this.bigStarExplosive.setPosition(e,t),this.bigStarExplosive.run()};runScoreEntrancesAnimation(){this.scene.tweens.killTweensOf(this.scoreText),new rs({targets:[this.scoreText],duration:300,props:{y:{from:0,to:this.scoreText.y}}}).play()}}class Qb extends is{bestScore;currentScore;leadersBar;footerBar;main;countdownText;confettiEffect;confettiLeftEffect;confettiRightEffect;preload(){this.events.on("resume",()=>{this.updateScore()}),this.events.on("sleep",()=>{this.storage.dispatch(ki())}),this.events.on("wake",this.run),this.events.on("create",this.run)}create(){super.create(),this.createBackground($.OTHER_BACKGROUND.KEY);const e=this.player.getBestScore();this.bestScore=e,this.currentScore=0,this.createMain(),this.createLeadersBar(),this.createFooterBar(),this.createBestScoreScreen(),this.createConfettiAnimations(),this.createClock()}run=()=>{this.updateScore(),this.main.bestScoreBlock.counterAnimation&&this.main.bestScoreBlock.counterAnimation.state!==Phaser.Tweens.REMOVED?this.main.bestScoreBlock.counterAnimation.on(Phaser.Tweens.Events.TWEEN_COMPLETE,()=>{this.handleShowBestScorePopup()}):this.time.delayedCall(800,()=>{this.handleShowBestScorePopup()}),this.footerBar.setAlpha(0),this.footerBar.runAnimation(),this.audio.pauseMusic(),this.audio.playSound(H.GAME_OVER_SCENE),this.time.delayedCall(3600,this.audio.playMusic,void 0,this.audio)};updateScore(){const e=this.storage.getState(),{score:t=0,bestScore:s=0}=et(e);this.bestScore=s<this.bestScore?this.bestScore:s,this.currentScore=t,this.main.bestScoreBlock.updateData({bestScore:this.bestScore,currentScore:this.currentScore})}runConfettiEffects=()=>{const{displayWidth:e}=this.gameZone,t=0,s=-100,n=e;this.confettiLeftEffect.stop(),this.confettiRightEffect.stop(),this.children.bringToTop(this.confettiLeftEffect),this.children.bringToTop(this.confettiRightEffect),this.children.bringToTop(this.confettiEffect),this.confettiEffect.run(0,675,380,675),this.time.delayedCall(1e3,()=>{this.confettiLeftEffect.run(1,t,s),this.confettiRightEffect.run(1,t+n,s),this.tweens.addCounter({delay:1e4,from:100,to:0,ease:Phaser.Math.Easing.Cubic.Out,duration:400,onUpdate:a=>{const r=a.getValue()/100;this.confettiLeftEffect.emitter?.setAlpha(r),this.confettiRightEffect.emitter?.setAlpha(r)},onComplete:()=>{this.confettiLeftEffect.emitter?.setAlpha(1),this.confettiRightEffect.emitter?.setAlpha(1),this.confettiLeftEffect.stop(),this.confettiRightEffect.stop()}})})};createConfettiAnimations(){this.confettiLeftEffect=new Fr(this,{speedX:{min:-20,max:100},rotate:{start:-360*3,end:0}}),this.confettiRightEffect=new Fr(this,{speedX:{min:20,max:-100},rotate:{start:0,end:360*3}}),this.confettiEffect=new ua(this),this.confettiEffect.setDepth(z.ON_TOP),this.confettiLeftEffect.setDepth(z.ON_TOP),this.confettiRightEffect.setDepth(z.ON_TOP)}createMain(){this.bestScore=0,this.main=new qb(this),Phaser.Display.Align.In.TopCenter(this.main,this.gameZone,0,-130)}createLeadersBar(){this.leadersBar=new Ub(this),Phaser.Display.Align.In.Center(this.leadersBar,this.gameZone,0,70)}createFooterBar(){const e=this.ads.getBannerHeight();this.footerBar=new zb(this),Phaser.Display.Align.In.BottomCenter(this.footerBar,this.gameZone,0,-60-e),this.footerBar.homeButton.onClick=this.handleHomeClick,this.footerBar.playButton.onClick=this.handlePlaySingle}createBestScoreScreen(){this.screen.add(L.BEST_SCORE_SCREEN,Jb)}handlePlaySingle=()=>{this.storage.dispatch(ga())};handleHomeClick=()=>{this.audio.stopSound(H.GAME_OVER_SCENE),this.audio.playMusic(),this.scene.switch(j.DASHBOARD_SCENE)};handleShowBestScorePopup(){this.currentScore>this.bestScore&&this.storage.dispatch(Ks({bestScore:this.currentScore}));const e=this.storage.getState(),t=dt(e),s=[ht,De].indexOf(t)>=0;this.currentScore>this.bestScore&&!s&&this.main.bestScoreBlock.updateCongratsTitle()}createClock(){GameCore.Configs.GameOver.ShowClock&&(this.countdownText=this.add.text(this.gameZone.width-10,10,"0",{fontSize:"13px",fontFamily:B.FONT_FAMILY,color:"#b4b9c4"}),this.countdownText.setOrigin(1,0),this.countdownText.setHighQuality(),this.events.on("update",()=>{const e=new Date;this.countdownText.setText(e.toLocaleTimeString())}))}}const Jl=i=>({type:nc,payload:{sceneKey:i}}),eT=i=>i.scene.currentSceneKey,tT=G([eT],i=>i),{KEY:sT,FRAME:iT}=_.DEFAULT;class nT extends Phaser.GameObjects.Container{fps=0;fpsString="FPS: %1";fpsText;background;lastUpdate;constructor(e){super(e,0,0),this.createFps(),this.setDepth(z.DEBUG),this.scene.add.existing(this),this.scene.events.on(Phaser.Scenes.Events.UPDATE,this.update)}update=e=>{if(e-this.lastUpdate<800)return;this.lastUpdate=e;const t=Math.floor(this.scene.game.loop.actualFps);this.setFps(t)};setFps(e){this.fps=e;const t=Phaser.Utils.String.Format(this.fpsString,[e]);this.fpsText.setText(t)}createFps(){this.background=this.scene.make.image({key:sT,frame:iT.BLANK}),this.background.setName("BG"),this.background.setTint(13801480),this.background.setWorldSize(45,25),this.fpsText=this.scene.make.bitmapText({size:this.scene.fontSize(14),text:this.fpsString,font:B.PRIMARY.KEY,origin:{x:.5,y:.5}}),this.fpsText.setName("FPS Meter"),Phaser.Display.Align.In.Center(this.fpsText,this.background),this.add([this.background,this.fpsText]),this.setFps(0)}}class aT extends Phaser.GameObjects.Container{performance;memory=0;maxMemoryLimit;maxPercentThreshold;normalColor=3459162;warningColor=16768343;alarmColor=15812200;memoryString="Memory: %1MB / %2MB";memoryText;lastUpdate;constructor(e){if(super(e,0,0),this.performance=window.performance,this.createMemory(),this.setDepth(z.DEBUG),this.scene.add.existing(this),!this.isSupport()){this.memoryText.setText("Memory: not supported!");return}const{jsHeapSizeLimit:t}=this.performance.memory;this.maxPercentThreshold=90,this.setMaxMemory(t/1048576),this.scene.events.on(Phaser.Scenes.Events.UPDATE,this.update)}update=e=>{if(e-this.lastUpdate<1e3)return;this.lastUpdate=e;const{usedJSHeapSize:t}=this.performance.memory,s=this.maxMemoryLimit*1048576,n=Math.round(t/1048576);this.setMemory(n),this.memoryText.setTint(this.normalColor),t>this.maxPercentThreshold/100*s&&this.memoryText.setTint(this.warningColor),t>s&&this.memoryText.setTint(this.alarmColor)};isSupport(){return this.performance&&!!this.performance?.memory}setMaxMemory(e){this.maxMemoryLimit=Math.round(e)}setMemory(e){this.memory=e;const t=Phaser.Utils.String.Format(this.memoryString,[e,this.maxMemoryLimit]);this.memoryText.setText(t)}createMemory(){this.memoryText=this.scene.make.bitmapText({size:this.scene.fontSize(14),text:this.memoryString,font:B.PRIMARY.KEY,depth:2e3}),this.memoryText.setName("Memory Meter"),this.add(this.memoryText),this.setMemory(0)}}const{KEY:rT,FRAME:oT}=_.DEFAULT;class ya extends is{mask;fadeInAnim;fadeOutAnim;fpsMeter;memoryMeter;init(){this.listenScenesEvents(),this.game.globalScene=this}setup(){this.scaleGame(),this.addMask(),this.addNotifyScreen(),this.addFPS(),this.addMemory()}addNotifyScreen(){const e=this.screen.add(L.NOTIFY_SCREEN,Rl);Phaser.Display.Align.In.Center(e,this.gameZone)}addMask(){this.mask=this.make.image({key:rT,frame:oT.BLANK});const{width:e,height:t}=this.gameZone;this.mask.setAlpha(0),this.mask.setOrigin(0,0),this.mask.setTint(0),this.mask.setWorldSize(e,t)}addFPS(){const{ShowFPSInGame:e}=GameCore.Configs.Statistics;e&&(this.fpsMeter=new nT(this),Phaser.Display.Align.In.TopLeft(this.fpsMeter,this.gameZone,-20,-10))}addMemory(){const{ShowMemoryInGame:e}=GameCore.Configs.Statistics;e&&(this.memoryMeter=new aT(this),Phaser.Display.Align.In.TopLeft(this.memoryMeter,this.gameZone,-45,-3))}updateSceneState(){this.setGlobalSceneOnTop()}setGlobalSceneOnTop(){this.scene.bringToTop(this)}runMaskFadeInAnimation(){this.mask&&GameCore.Configs.EnableEffectSceneTransition&&(this.fadeInAnim?.remove(),this.fadeOutAnim?.remove(),this.fadeInAnim=new Ve({targets:[this.mask],duration:400,ease:Phaser.Math.Easing.Cubic.In,props:{alpha:{start:0,from:0,to:.6}}}),this.mask.setAlpha(0),this.fadeInAnim.play())}runMaskFadeOutAnimation(){this.mask&&GameCore.Configs.EnableEffectSceneTransition&&(this.fadeInAnim?.remove(),this.fadeOutAnim?.remove(),this.fadeOutAnim=new ke({targets:[this.mask],duration:400,ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:{start:.6,from:.6,to:0}}}),this.mask.setAlpha(1),this.fadeOutAnim.play())}listenScenesEvents(){this.scene.manager.getScenes(!1).forEach(t=>{t.events.on(Phaser.Scenes.Events.CREATE,this.emitGameEventStartScene),t.events.on(Phaser.Scenes.Events.SLEEP,this.emitGameEventSleepScene),t.events.on(Phaser.Scenes.Events.WAKE,this.emitGameEventWakeScene),t.events.on(Phaser.Scenes.Events.PAUSE,this.emitGameEventPauseScene),t.events.on(Phaser.Scenes.Events.RESUME,this.emitGameEventResumeScene),t.events.on(Phaser.Scenes.Events.SHUTDOWN,this.emitGameEventShutdownScene)}),this.events.on(we.SWITCH,this.switchScene)}getActiveScene(){return this.scene.manager.getScenes(!0)[0]}getCurrentScene(){return this.currentScene}get currentScene(){const e=this.storage.getState(),t=tT(e);let s;return t?s=this.scene.manager.getScene(t):s=this.getActiveScene(),s.scene}switchScene=e=>{this.currentScene.key!==e&&this.currentScene.switch(e)};updateActiveSceneKey(e){e!==j.GLOBAL_SCENE&&this.storage.dispatch(Jl(e))}emitGameEventStartScene=e=>{const{key:t}=e.scene;console.info("%cScene start","color: #D27D2D",t),this.updateSceneState(),this.runMaskFadeOutAnimation(),this.updateActiveSceneKey(t),this.game.events.emit(Phaser.Scenes.Events.START,t),wi("scene",`Start scene: ${t}`)};emitGameEventSleepScene=e=>{const{key:t}=e.scene.scene;console.info("%cScene sleep","color: #D27D2D",t),t!==j.LOAD_SCENE&&(this.runMaskFadeInAnimation(),this.game.events.emit(Phaser.Scenes.Events.SLEEP,t))};emitGameEventWakeScene=e=>{const{key:t}=e.scene.scene;console.info("%cScene wake","color: #D27D2D",t),t!==j.LOAD_SCENE&&(this.updateSceneState(),this.runMaskFadeOutAnimation(),this.updateActiveSceneKey(t),this.game.events.emit(Phaser.Scenes.Events.WAKE,t))};emitGameEventPauseScene=e=>{const{key:t}=e.scene.scene;console.info("%cScene pause","color: #D27D2D",t),this.game.events.emit(Phaser.Scenes.Events.PAUSE,t)};emitGameEventResumeScene=e=>{const{key:t}=e.scene;console.info("%cScene resume","color: #D27D2D",t),this.game.events.emit(Phaser.Scenes.Events.RESUME,t)};emitGameEventShutdownScene=e=>{const{key:t}=e.scene.scene;console.info("%cScene shutdown","color: #D27D2D",t),this.game.events.emit(Phaser.Scenes.Events.SHUTDOWN,t)};logEventOpen(){}logPageviewOnOpen(){}}const{KEY:qr,FRAME:Zr}=_.DEFAULT;class cT extends Phaser.GameObjects.Container{homeButton;constructor(e){super(e),this.scene=e,this.createButtons(),this.alignButtons(),this.scene.add.existing(this)}alignButtons(){Phaser.Display.Align.In.Center(this.homeButton,this,0)}createButtons(){this.createHomeButton()}createHomeButton(){this.homeButton=new Q(this.scene,qr,Zr.BUTTON_GREEN,134,68);const e=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(20),text:this.scene.lang.Text.HOME,origin:{x:.5,y:.5}}),t=this.scene.make.image({key:qr,frame:Zr.ICON_HOME});t.setWorldSize(31,26),this.homeButton.setName("Home"),this.homeButton.add([e,t]),this.add(this.homeButton);const s=this.scene.lang.getCurrentLanguage();Phaser.Display.Align.In.Center(t,this.homeButton,s==="ru"?-36:-29,-3),Phaser.Display.Align.To.RightCenter(e,t,6,1)}}class F0 extends Phaser.GameObjects.GameObject{constructor(e){super(e,"UpdateAbleObject")}updateInfo}class lT extends zl{classType;listConfigs;padding;startObjectIndex;endObjectIndex;listObjects;constructor(e,t){super(e,t),this.classType=t.classType,this.listConfigs=t.listConfigs,this.padding=t.padding?t.padding:0,this.objects.classType=this.classType,this.updateConfig(this.listConfigs)}reset(){super.reset(),this.killAndHideAll()}getChildren(){return this.listObjects.filter(e=>e!=null&&e.active)}get objHeight(){const e=this.objects.getChildren();return e.length==0?this.maxHeight=0:e[0].height}updateConfig(e){this.reset(),this.listConfigs=e,this.listObjects=new Array(e.length).fill(void 0),this.addObjectIndex(0,0);const t=this.getEndObjectIndex();this.addObjectIndex(1,t),this.startObjectIndex=this.getStartObjectIndex(),this.endObjectIndex=this.getEndObjectIndex(),this.updateMaxHeight(),this.value=this.marginTop}killAndHideAll(){this.listObjects instanceof Array&&this.listObjects.map(e=>{e!==void 0&&this.objects.killAndHide(e)})}setItemPosition(e,t){const s=e.height;e.setPosition(0,s/2+(s+this.padding)*t-this.height/2)}updateMaxHeight(){return this.maxHeight=Math.max(this.listConfigs.length*(this.objHeight+this.padding)-this.padding+this.marginBottom-this.height,0)}updateObject(e){this.objects.incY(e);const t=this.getStartObjectIndex(),s=this.getEndObjectIndex();t!=this.startObjectIndex&&(t>this.startObjectIndex?this.killObjectIndex(this.startObjectIndex,t-1):this.addObjectIndex(t,this.startObjectIndex-1),this.startObjectIndex=t),s!=this.endObjectIndex&&(s<this.endObjectIndex?this.killObjectIndex(s+1,this.endObjectIndex):this.addObjectIndex(this.endObjectIndex+1,s),this.endObjectIndex=s)}killObjectIndex(e,t){for(let s=e;s<=t;s++){const n=this.listObjects[s];n&&(this.objects.killAndHide(n),this.listObjects[s]=void 0)}}addObjectIndex(e,t){for(let s=e;s<=t;s++){const{padding:n,listConfigs:a}=this;if(s>=a.length)return;const r=this.objects.getFirstDead(!0),c=r.height,o=c/2+(c+n)*s+this.value-this.height/2;r.updateInfo(a[s]),r.setPosition(0,o),r.setActive(!0),r.setVisible(!0),this.addAt(r),this.listObjects[s]=r}}getStartObjectIndex(){const{objHeight:e,padding:t}=this;return Math.max(Math.floor((0-this.value)/(e+t)),0)}getEndObjectIndex(){const{objHeight:e,padding:t,listConfigs:s}=this,n=e+t;return Math.min(Math.floor((this.height-this.value)/n),s.length)}}const{KEY:ci,FRAME:Ge}=_.DEFAULT;class hT extends Phaser.GameObjects.Container{button;avatar;rankIcon;rankText;username;scoreText;background;showPopUp;showItems;payload;constructor(e,t){super(e),this.createBackground(),this.updateSize(),this.createAvatar(),this.createRank(),this.createUsername(),this.createScore(),this.createButton(),t&&this.updateInfo(t),this.scene.add.existing(this)}updateInfo(e){e&&(this.payload={scoreRight:!0,isHighlight:!1,useChallenge:!1,...e},this.updateBackground(),this.updateAvatar(),this.updateRank(),this.updateUsername(),this.updateScore(),this.updatePosition())}updatePosition(){const e=this.payload.scoreRight,t=this.payload.useChallenge;if(this.button.setVisible(!!t),e){this.username.setFontSize(20),Phaser.Display.Align.In.LeftCenter(this.username,this.background,-90,1);const s=this.scene.fontSize(20);this.scoreText.setFontSize(s),this.scoreText.setOrigin(1,.5),this.scoreText.setPosition(130,1)}else{this.username.setFontSize(16),Phaser.Display.Align.In.TopLeft(this.username,this.background,-90,-8);const s=this.scene.fontSize(18);this.scoreText.setFontSize(s),this.scoreText.setOrigin(0,.5),this.scoreText.setPosition(-55,10)}}createBackground(){this.background=this.scene.make.image({key:ci,frame:Ge.LEADERBOARD_BG_LIGHT}),this.background.setWorldSize(290.5,43.5),this.add(this.background)}updateBackground(){const e=this.payload.isHighlight;let t="";e?t=Ge.LEADERBOARD_BG_LIGHT:t=Ge.LEADERBOARD_BG_DARK,this.background.setFrame(t),this.background.setWorldSize(290.5,43.5)}updateSize(){const{width:e,height:t}=this.background;this.setSize(e,t)}createAvatar(){this.avatar=new ns(this.scene,{key:ci,frame:Ge.AVATAR_FRAME_PURPLE,background:Ge.AVATAR_BG,width:38,height:40,loadDelay:300}),this.add(this.avatar),Phaser.Display.Align.In.LeftCenter(this.avatar,this.background,-45,-2)}updateAvatar(){const{playerId:e,photo:t}=this.payload;this.avatar.loadPhoto(e,t)}createRank(){this.createRankIcon(),this.createRankText()}updateRank(){this.updateRankIcon(),this.updateRankText()}getRankIconSymbol(e){let t="";switch(e){case 1:t=Ge.ICON_GOLD;break;case 2:t=Ge.ICON_SILVER;break;case 3:t=Ge.ICON_BRONZE;break;case 0:t=Ge.ICON_QUESTION}return t}createRankIcon(){const e=Ge.ICON_GOLD;this.rankIcon=this.scene.make.image({key:ci,frame:e}),this.rankIcon.setPosition(-119,0),this.add(this.rankIcon)}updateRankIcon(){const e=+this.payload.score;let t=+this.payload.rank;e===0&&(t=0);const s=this.getRankIconSymbol(t);this.rankIcon.setFrame(s),s==""?this.rankIcon.kill():this.rankIcon.revive(),this.rankIcon.setWorldSize(39,47.5),t===0&&this.rankIcon.setWorldSize(11,16)}createRankText(){this.rankText=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(15),text:"",origin:{x:.5,y:.5}}),this.add(this.rankText)}updateRankText(){const e=+this.payload.score;let{rank:t}=this.payload;e===0&&(t=0);let s=`${t}`;if(this.rankText.revive(),t<4&&this.rankText.kill(),t>999){const n=this.scene.fontSize(13);this.rankText.setFontSize(n),s=GameCore.Utils.Number.toAbbreviatedString(+t,{fractionalDigits:1,removeLastZero:!0})}this.rankText.setText(s),this.rankText.setPosition(-120,2)}createUsername(){this.username=this.scene.make.text({style:{fontFamily:B.FONT_FAMILY},origin:{x:0,y:.5}}),this.username.setText(""),this.username.setTint(14342381),this.username.setHighQuality(),this.add(this.username)}updateUsername(){const{name:e}=this.payload;if(!e)return;const t=GameCore.Utils.String.getShortName(e,10),s=GameCore.Utils.String.removeDiacritics(t);this.username.setText(s)}createScore(){this.scoreText=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(20),origin:{x:0,y:.5}}),this.scoreText.setTint(16777215),this.add(this.scoreText)}updateScore(){const e=+this.payload.score,t=GameCore.Utils.Number.toAbbreviatedString(e,{startAbbreviate:1e14});this.scoreText.setText(t)}createButton(){this.button=new Q(this.scene,ci,Ge.BUTTON_GREEN_MINOR,61.5,32),this.button.setName("ChallengeFriend");const e=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(11),text:this.scene.lang.Text.CHALLENGE});this.button.add(e),this.add(this.button),Phaser.Display.Align.In.Center(e,this.button),Phaser.Display.Align.In.RightCenter(this.button,this.background,-10),this.button.onClick=this.handleChallengeFriend}handleChallengeFriend=()=>{const{playerId:e}=this.payload;this.scene.storage.dispatch(Gi(e))};runShowPopUpAnimation(e,t){this.scene.tweens.killTweensOf(this);const s=this.y;this.showPopUp=new fa({targets:[this],delay:e,duration:t,props:{y:{start:this.y+70,to:this.y}},onStop:()=>{this.y=s}}),this.showPopUp.play()}runShowItemAnimation(e,t){const s=[this.avatar,this.rankText,this.button,this.username,this.scoreText];s.forEach(n=>n.setScale(1)),this.scene.tweens.killTweensOf(s),this.showItems=new ql({targets:s,duration:t,delay:this.scene.tweens.stagger(50,{start:e+50}),props:{scale:{duration:1e3,start:.8,end:1,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45]}}}),this.showItems.play()}runShowUpAnimation(e=0,t=300){const s=e*100;this.runShowPopUpAnimation(s,t),this.runShowItemAnimation(s,t)}}class uT extends Phaser.GameObjects.Container{scene;currentPlayerId;scroller;constructor(e){super(e),this.scene=e;const{player:t}=this.scene;this.currentPlayerId=t.getPlayerId(),this.createReuseScroller(),this.scene.add.existing(this)}createReuseScroller(){this.scroller=new lT(this.scene,{classType:hT,listConfigs:[],width:310-30,height:420-110,padding:5,marginTop:10,marginBottom:10,maxScrollOver:.05}),this.scene.renderer instanceof Phaser.Renderer.WebGL.WebGLRenderer&&this.scroller.createBound(_.DEFAULT.KEY,_.DEFAULT.FRAME.BLANK,10,2826565),this.scroller.createMask(),this.scroller.setPosition(0,5),this.add(this.scroller)}async updateData(e){const t=Object.values(e)||[];if(t.length<1){this.scene.isSwitchable=!0,this.scene.board.showMessage(!0,this.scene.lang.Text.LEADERBOARD_IS_EMPTY);return}const s=t.sort((a,r)=>+r.score-+a.score),n=[];for(const a of s){const{playerId:r,photo:c,score:o,name:l}=a,{rank:h}=a;if(!r)continue;const d=this.currentPlayerId===r,u=this.scene.tabId===Yt,p=!1;//!isPlayer && this.scene.tabId === LEADERBOARD_TYPE_FRIEND
const g={playerId:r,photo:c,name:l,rank:h,score:o,scoreRight:u,useChallenge:p,isHighlight:d};n.push(g)}this.scroller.updateConfig(n),this.showLeaders()}removeLeaders(){this.scroller.updateConfig([])}getLeaders(){return this.scroller.getChildren()}showLeaders(){const e=this.getLeaders();if(e.length<1){this.scene.isSwitchable=!0,this.scene.board.showMessage(!0,this.scene.lang.Text.LEADERBOARD_IS_EMPTY);return}const t=Math.min(e.length,6),s=300;for(let a=0;a<t;a++){const r=e[a];r&&(r.setVisible(!0),r.runShowUpAnimation(a,s))}const n=s+t*100+50*5;this.scene.time.delayedCall(n,()=>{this.scene.isSwitchable=!0,this.scroller.setEnable(!0)})}}const{FRAME:Jr}=_.DEFAULT;class dT extends Phaser.GameObjects.Container{scene;background;leaders;loading;message;messageAnimation;constructor(e){super(e),this.scene=e,this.createBackground(),this.updateSize(),this.createLoading(),this.createMessage(),this.createContents(),this.createAnimation(),this.scene.add.existing(this)}showLoading(e){this.loading.setVisible(e),this.showMessage(!1)}showMessage(e,t){this.message.setVisible(e),t&&(this.message.setText(t),this.messageAnimation.play())}createBackground(){this.background=new Ye(this.scene,0,0,310,350),this.add(this.background)}updateSize(){const{width:e,height:t}=this.background;this.setSize(e,t)}createLoading(){this.loading=new Rt(this.scene),this.add(this.loading),this.loading.setTint(5982858),this.loading.setWorldSize(55,55),Phaser.Display.Align.In.Center(this.loading,this.background)}createMessage(){this.message=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(18),origin:{x:.5,y:.5}}),this.add(this.message),Phaser.Display.Align.In.Center(this.message,this.background)}createContents(){this.createLeaders(),this.createTitle()}createLeaders(){this.leaders=new uT(this.scene),this.add(this.leaders),Phaser.Display.Align.In.Center(this.leaders,this.background,0,0)}createTitle(){const e=this.scene.lang.getCurrentLanguage(),t=new as(this.scene,{title:this.scene.lang.Text.LEADERBOARDS,titleSize:e==="ru"?22:25});t.changeRibbon(Jr.RIBBON_PINK,276.5,68.5),t.changeBackground(Jr.EGGS,204,61.5),Phaser.Display.Align.In.TopCenter(t,this.background,0,75),this.add(t)}createAnimation(){this.messageAnimation=new ea({targets:[this.message],duration:60,repeat:2})}}const{LeadersBoard:at}=GameCore.Configs;class pT extends is{board;footerButtons;tabId;offset;isSwitchable;isRequesting;run=()=>{this.isRequesting=!1;const e=[{selector:ul,callback:t=>{if(this.isRequesting=t,this.board.showLoading(t),t===!1){const s=this.game.storage.getState(),n=hl(s);this.time.delayedCall(0,()=>{this.board.leaders.updateData(n)})}}}];this.handleStateChange(e),this.selectWorldTab()};preload(){this.events.on("wake",this.run),this.events.on("create",this.run)}create(){super.create(),this.createBackground($.OTHER_BACKGROUND.KEY),this.createBoard(),this.createFooter()}selectWorldTab(){this.tabId=Yt,this.offset=0,this.board.showLoading(!0),this.board.leaders.removeLeaders(),this.storage.dispatch(hi(at.LeaderboardId,Yt,at.Limit,this.offset))}loadMoreTabFriend(){this.isRequesting||(this.offset+=at.Limit,this.storage.dispatch(hi(at.LeaderboardId,sa,at.Limit,this.offset)))}loadMoreTabWorld(){this.isRequesting||(this.offset+=at.Limit,this.storage.dispatch(hi(at.LeaderboardId,Yt,at.Limit,this.offset)))}createBoard(){this.board=new dT(this),Phaser.Display.Align.In.Center(this.board,this.gameZone)}createFooter(){this.footerButtons=new cT(this),Phaser.Display.Align.In.BottomCenter(this.footerButtons,this.board,0,45),this.footerButtons.homeButton.onClick=this.handleHomeClick}handleHomeClick=()=>{this.scene.switch(j.DASHBOARD_SCENE)}}class gT extends Error{constructor(e,t){super(e,t),this.name="LoadResourceFail",this.message=e||"Load resource fail",this.payload=t}}let xt=class{game;id;taskData;requireTypes;constructor(e,t){this.game=e,this.id=t,this.init()}init(){const e=this.game.storage.getState(),t=ha(e)||[];if(t?.length<1)return;const s=t?.find(n=>n.id===this.id);s&&(this.taskData=s,this.requireTypes=Object.keys(this.taskData.require),this.initEvents())}getDataByType(e){const t=this.game.storage.getState(),s=Dl(t),n={value:0,target:0};if(!s||!GameCore.Utils.Object.hasOwn(s,this.taskData.id))return n;const a=s[this.taskData.id];if(GameCore.Utils.Valid.isObject(a)&&GameCore.Utils.Object.hasOwn(a,e)){const r=a[e];typeof r=="number"&&(n.value=r)}return n.target=this.taskData.require[e]||0,n}getCorrectValue(e,t){const{value:s,target:n}=this.getDataByType(e);let a=t;return s+t>n&&(a=n-s),Math.round(a)}isPassRequiredTarget(e){const{value:t,target:s}=this.getDataByType(e);return t>=s}isTaskFinished(e){const{value:t,target:s}=this.getDataByType(e);return t>=s}process=e=>{let{type:t,value:s}=e;if(s<1||this.requireTypes.indexOf(t)===-1||this.isPassRequiredTarget(t)||!this.processMore(e))return;({type:t,value:s}=e);const a=this.getCorrectValue(t,s);this.game.storage.dispatch(lb(this.id,t,a)),this.isTaskFinished(t)&&this.game.storage.dispatch(ub(this.id))}};const{ID:mT,EVENTS:Qr}=se.COLLECT_EGGS;class fT extends xt{constructor(e){super(e,mT)}initEvents(){q.off(Qr.COLLECT_EGGS,this.process),q.on(Qr.COLLECT_EGGS,this.process)}processMore(){return!0}}const{ID:yT,EVENTS:eo}=se.INVITE_FRIENDS;class ET extends xt{invitedFriends;constructor(e){super(e,yT),this.resetData()}initEvents(){q.off(eo.INVITED_FRIEND,this.process),q.on(eo.INVITED_FRIEND,this.process),q.on(se.EVENTS.TASKS_RESET,()=>{this.resetData()})}resetData=()=>{this.invitedFriends=[]};processMore(e){const{opponentId:t}=e;return!t||this.invitedFriends.indexOf(t)!==-1?!1:(this.invitedFriends.push(t),!0)}}const{ID:ST,EVENTS:to}=se.COMPLETE_GAMES;class AT extends xt{totalScore;lastUpdate;constructor(e){super(e,ST),this.totalScore=0,this.lastUpdate=Date.now()}initEvents(){q.off(to.COMPLETE_GAME,this.process),q.on(to.COMPLETE_GAME,this.process)}processMore(e){const{value:t}=e,s=Date.now();return s-this.lastUpdate<3e3?(this.totalScore+=t,!1):(e.value+=this.totalScore,this.totalScore=0,this.lastUpdate=s,!0)}}const{ID:bT,EVENTS:so}=se.GET_DINOMITE_COMBO;class TT extends xt{constructor(e){super(e,bT)}initEvents(){q.off(so.GET_DINOMITE_COMBO,this.process),q.on(so.GET_DINOMITE_COMBO,this.process)}processMore(){return!0}}const{ID:wT,EVENTS:io}=se.REACH_TARGET_POINTS;class CT extends xt{constructor(e){super(e,wT)}initEvents(){q.off(io.REACH_TARGET_POINTS,this.process),q.on(io.REACH_TARGET_POINTS,this.process)}processMore(){return!0}}const{ID:IT,EVENTS:no}=se.SHOOT_FLYING_EGG;class PT extends xt{constructor(e){super(e,IT)}initEvents(){q.off(no.SHOOT_FLYING_EGG,this.process),q.on(no.SHOOT_FLYING_EGG,this.process)}processMore(){return!0}}const{ID:vT,EVENTS:ao}=se.USE_RESCUE;class OT extends xt{constructor(e){super(e,vT)}initEvents(){q.off(ao.USE_RESCUE,this.process),q.on(ao.USE_RESCUE,this.process)}processMore(){return!0}}class _T{game;eventsListener;constructor(e){this.game=e,this.init()}getEventListener(e){return this.eventsListener[e]}init=async()=>{this.eventsListener={},await this.initData(),this.initEvents()};initData=async()=>{await this.game.storage.dispatch(rb())};initEvents(){this.eventsListener[se.COLLECT_EGGS.ID]=new fT(this.game),this.eventsListener[se.COMPLETE_GAMES.ID]=new AT(this.game),this.eventsListener[se.INVITE_FRIENDS.ID]=new ET(this.game),this.eventsListener[se.GET_DINOMITE_COMBO.ID]=new TT(this.game),this.eventsListener[se.REACH_TARGET_POINTS.ID]=new CT(this.game),this.eventsListener[se.SHOOT_FLYING_EGG.ID]=new PT(this.game),this.eventsListener[se.USE_RESCUE.ID]=new OT(this.game)}}const RT=[{name:"collect-red-gems",id:"collect-gems",require:{red:5},reward:50},{name:"collect-blue-gems",id:"collect-gems",require:{blue:5},reward:50},{name:"collect-pink-gems",id:"collect-gems",require:{pink:5},reward:50},{name:"collect-green-gems",id:"collect-gems",require:{green:5},reward:50},{name:"collect-yellow-gems",id:"collect-gems",require:{yellow:5},reward:50},{name:"collect-red-blue-gems",id:"collect-gems",require:{red:5,blue:5},reward:120},{name:"collect-red-pink-gems",id:"collect-gems",require:{red:5,pink:5},reward:120},{name:"collect-red-green-gems",id:"collect-gems",require:{red:5,green:5},reward:120},{name:"collect-red-yellow-gems",id:"collect-gems",require:{red:5,yellow:5},reward:120},{name:"collect-blue-pink-gems",id:"collect-gems",require:{blue:5,pink:5},reward:120},{name:"collect-blue-green-gems",id:"collect-gems",require:{blue:5,green:5},reward:120},{name:"collect-blue-yellow-gems",id:"collect-gems",require:{blue:5,yellow:5},reward:120},{name:"collect-pink-green-gems",id:"collect-gems",require:{pink:5,green:5},reward:120},{name:"collect-pink-yellow-gems",id:"collect-gems",require:{pink:5,yellow:5},reward:120},{name:"collect-green-yellow-gems",id:"collect-gems",require:{green:5,yellow:5},reward:120},{name:"collect-red-blue-pink-gems",id:"collect-gems",require:{red:5,blue:5,pink:5},reward:210},{name:"collect-red-blue-green-gems",id:"collect-gems",require:{red:5,blue:5,green:5},reward:210},{name:"collect-red-blue-yellow-gems",id:"collect-gems",require:{red:5,blue:5,yellow:5},reward:210},{name:"collect-red-pink-green-gems",id:"collect-gems",require:{red:5,pink:5,green:5},reward:210},{name:"collect-red-pink-yellow-gems",id:"collect-gems",require:{red:5,pink:5,yellow:5},reward:210},{name:"collect-red-green-yellow-gems",id:"collect-gems",require:{red:5,green:5,yellow:5},reward:210},{name:"collect-blue-pink-green-gems",id:"collect-gems",require:{blue:5,pink:5,green:5},reward:210},{name:"collect-blue-pink-yellow-gems",id:"collect-gems",require:{blue:5,pink:5,yellow:5},reward:210},{name:"collect-blue-green-yellow-gems",id:"collect-gems",require:{blue:5,green:5,yellow:5},reward:210},{name:"collect-pink-green-yellow-gems",id:"collect-gems",require:{pink:5,green:5,yellow:5},reward:210}],xT=async()=>RT,DT=(i,e)=>e.name,BT=i=>i[Pi]?.missions,kT=i=>i[Pi]?.isRequesting,Ql=G([BT],i=>i),NT=G([kT],i=>i);G([Ql,DT],(i,e)=>!i||typeof e!="string"?null:GameCore.Utils.Object.hasOwn(i,e)?i[e]:null);const MT=()=>async(i,e)=>{const t=e();if(NT(t))return;i({type:Fc,payload:{}});const n=await xT();i(LT(n))},LT=i=>({type:Uc,payload:{missions:i}}),Qe={TYPES:{COLLECT_GEMS:"collect-gems",USE_ITEM:"use-item",COMBO:"combo"},EVENTS:{MISSION_START:"mission-start",MISSION_UPDATE:"mission-update",MISSION_FAILED:"mission-failed",MISSION_COMPLETED:"mission-completed"},OBJECTS:{UNUSED:"testing"}},GT=(i,e,t)=>({type:Yc,payload:{name:i,type:e,value:t}}),FT=i=>({type:Hc,payload:{name:i}}),UT=i=>i[Pi]?.mission,Dn=G([UT],i=>i);G([Dn],i=>i?i.name:null);class Ea{game;id;name;reward;constructor(e,t,s){this.id=t,this.name=s,this.game=e}start(){const e=this.game.storage.getState(),t=Dn(e);t&&t.name===this.name&&(this.reward=t.reward,this.initEvents())}getMissionData(){const e=this.game.storage.getState(),t=Dn(e);return!t||t.name!==this.name?null:t}getDataByType(e){const t=this.getMissionData();if(!t)return null;const s=t.require[e];return{value:t.process[e],target:s}}isTypeRequired(e){const t=this.getDataByType(e);return t?t.target>0:!1}isMissionComplete(){const e=this.getMissionData();if(!e)return!0;const{require:t,process:s}=e;let n=!0;return Object.keys(t).forEach(a=>{if(!n)return;const r=t[a];s[a]<r&&(n=!1)}),n}process=e=>{const{id:t,type:s,value:n}=e;n<1||this.id!==t||!this.isTypeRequired(s)||!this.processMore(e)||(this.game.storage.dispatch(GT(this.name,s,n)),this.isMissionComplete()&&(q.emit(Qe.EVENTS.MISSION_COMPLETED,{name:this.name,reward:this.reward}),this.game.storage.dispatch(FT(this.name))))}}const{EVENTS:ro,TYPES:YT}=Qe;class HT extends Ea{constructor(e,t){super(e,YT.COLLECT_GEMS,t)}initEvents(){q.off(ro.MISSION_UPDATE,this.process),q.on(ro.MISSION_UPDATE,this.process)}processMore(){return!0}}const{EVENTS:oo,TYPES:zT}=Qe;class WT extends Ea{constructor(e,t){super(e,zT.COMBO,t)}initEvents(){q.off(oo.MISSION_UPDATE,this.process),q.on(oo.MISSION_UPDATE,this.process)}processMore(){return!0}}const{EVENTS:co,TYPES:VT}=Qe;class KT extends Ea{constructor(e,t){super(e,VT.USE_ITEM,t)}initEvents(){q.off(co.MISSION_UPDATE,this.process),q.on(co.MISSION_UPDATE,this.process)}processMore(e){return console.log("UseItem",{payload:e}),!0}}class $T{game;listener;constructor(e){this.game=e,this.init()}init=async()=>{await this.initData(),this.initListeners(),this.initEvents()};initData=async()=>{await this.game.storage.dispatch(MT())};initListeners(){this.listener={};const e=this.game.storage.getState(),t=Ql(e);t&&Object.keys(t).forEach(s=>{const{id:n}=t[s];switch(n){case Qe.TYPES.COLLECT_GEMS:this.listener[s]=new HT(this.game,s);break;case Qe.TYPES.COMBO:this.listener[s]=new WT(this.game,s);break;case Qe.TYPES.USE_ITEM:this.listener[s]=new KT(this.game,s);break}})}initEvents(){q.off(Qe.EVENTS.MISSION_START,this.startListener),q.on(Qe.EVENTS.MISSION_START,this.startListener)}startListener=e=>{this.listener[e]&&this.listener[e].start()}}class jT extends Error{constructor(e,t){super(e,t),this.name="ProcessContextFail",this.message=e||"Progress context fail",this.payload=t}}const{UseLeaderboard:Y0}=GameCore.Configs.Tournament,XT=i=>({type:kc,payload:{tournamentId:i}}),qT=()=>(i,e)=>{const{player:t,analytics:s,globalScene:n}=window.game;try{const a=e(),r=Zt(a),c=el(a),o=t.getPlayer(),{entryPointData:l}=r,{type:h}=l||{};if(o.isUserNew&&s.event(V.NEW_USER),c===De){i(ZT());return}if(c===Ce){if(h===Jn){i(JT());return}if(h===qt){i(QT());return}}if(c===Ot){i(e0());return}if(o.isUserNew){i(t0());return}n.events.emit(we.SWITCH,j.DASHBOARD_SCENE)}catch(a){n.events.emit(we.SWITCH,j.DASHBOARD_SCENE),console.warn(a),kn(new jT(null),{error:a})}},eh=i=>{try{const e=Zt(i),{player:t}=window.game,{entryPointData:s}=e,{playerId:n,playerName:a,playerPhoto:r}=s||{};return t.getPlayer().playerId===n?xe:new Ht(n,a,r).toObject()}catch(e){return console.warn(e),xe}},ZT=()=>i=>{try{const{facebook:e}=window.game;e.getTournamentAsync().then(t=>{const s=t.getID().toString();i(XT(s))}).catch(t=>{console.warn(t)}),i(pa())}catch(e){console.warn(e)}},JT=()=>(i,e)=>{try{const t=e(),s=Zt(t),{player:n}=window.game,a=n.getPlayer(),{contextId:r,entryPointData:c}=s,{playerId:o}=c||{},l=a.playerId===o,h=eh(t);l||n.updateConnectedPlayers([h]);const{playerId:d}=h;i(Fl(r,d,!0))}catch(t){throw new Error("processInviteMode: "+t)}},QT=()=>(i,e)=>{try{const t=e(),s=Zt(t),{player:n}=window.game,a=n.getPlayer(),{entryPointData:r}=s,{matchId:c,opponentId:o,playerId:l}=r||{},h=a.playerId===l;i(h?wr(c,o,!0):wr(c,l,!0))}catch(t){throw new Error("processChallengeFriendMode: "+t)}},e0=()=>(i,e)=>{try{const t=e(),s=Zt(t),{entryPointData:n}=s,{playerId:a,playerScore:r}=n||{};i(Ni(a,{score:r,level:0}));const l={...eh(t),score:r};i(ma(l))}catch(t){throw new Error("processMatchingGroupMode: "+t)}},t0=()=>i=>{try{i(ga())}catch(e){throw new Error("processNewUserMode: "+e)}},As={BACKGROUND:{KEY:"background",FILE:["./assets/music/bg_music.ogg","./assets/music/bg_music.mp3"]},EFFECTS:{KEY:"effects",FILE:["./assets/sounds/effects.ogg","./assets/sounds/effects.mp3"],JSON:"./assets/sounds/effects.json",PATH:"./assets/sounds/"}};class s0 extends Phaser.Scene{loadingPercent=0;preload(){window.getLoadingPerc=()=>this.loadingPercent,this.facebook.progressLoading.loadingProgressFbLoadScene(),this.analytics.event(V.SCREEN_OPEN,{screen_name:"LoadScene"}),this.analytics.event(V.LOAD_START);const e=s=>{this.loadingPercent=Math.max(this.loadingPercent,s*100),s===1&&this.load.off("progress",e),this.facebook.progressLoading.onProgress(s)};this.load.on("progress",e),this.load.on(Phaser.Loader.Events.FILE_LOAD_ERROR,s=>{const n=new gT("Load resources at LoadScene failed.");kn(n,{file:s?.url})}),this.load.on(Phaser.Loader.Events.COMPLETE,()=>{this.load.off(Phaser.Loader.Events.FILE_LOAD_ERROR)}),this.textStyler.addFont({type:"local",fontType:"truetype",fontName:B.FONT_FAMILY});const t=this.lang.getCurrentLanguage();this.load.bitmapFont(B.PRIMARY.KEY,B.PRIMARY.TEXTURE[t],B.PRIMARY.DATA[t]),this.load.image($.AVATAR.KEY,$.AVATAR.FILE),this.load.image($.BACKGROUND.KEY,$.BACKGROUND.FILE),this.load.atlas({key:_.DEFAULT.KEY,textureURL:_.DEFAULT.TEXTURE,atlasURL:_.DEFAULT.JSON}),this.load.atlas({key:_.GAMEPLAY.GAMEPLAY_TEXTURES.KEY,textureURL:_.GAMEPLAY.GAMEPLAY_TEXTURES.TEXTURE,atlasURL:_.GAMEPLAY.GAMEPLAY_TEXTURES.JSON}),this.load.atlas({key:_.GAMEPLAY.GAME_OBJECTS.KEY,textureURL:_.GAMEPLAY.GAME_OBJECTS.TEXTURE,atlasURL:_.GAMEPLAY.GAME_OBJECTS.JSON}),this.load.atlas({key:_.EFFECTS.KEY,textureURL:_.EFFECTS.TEXTURE,atlasURL:_.EFFECTS.JSON}),this.load.image($.AVATAR.KEY,$.AVATAR.FILE),this.load.image($.BACKGROUND.KEY,$.BACKGROUND.FILE),this.load.image($.GAME_BACKGROUND.KEY,$.GAME_BACKGROUND.FILE),this.load.image($.OTHER_BACKGROUND.KEY,$.OTHER_BACKGROUND.FILE),this.player.updateData().then(()=>{this.processAfterUpdatePlayerProfile(),this.initModules()}).catch(s=>{console.warn("LoadScene: player.updateData() failed",s)})}create(){this.analytics.event(V.LOAD_COMPLETE),this.facebook.on("startgame",this.handleFBInstantGameStarted),this.facebook.gameStarted(),this.setupGlobalScene(),this.lazyLoadResource(),this.startGame()}handleFBInstantGameStarted=()=>{window.__fbGameReady=!0,this.player.requestConnectedPlayers()};processAfterUpdatePlayerProfile=()=>{};setupGlobalScene(){const e=this.scene.get(j.GLOBAL_SCENE);e instanceof ya&&e.setup()}startGame=async()=>{this.showStickyBannerAd(),this.preloadAds(),this.analytics.event(V.APP_READY),this.storage.dispatch(Jl(j.LOAD_SCENE)),await this.storage.dispatch(qT()),this.analytics.event(V.APP_READY)};showStickyBannerAd=()=>{this.ads.showBannerAdAsync().catch(e=>{console.warn(e)})};preloadAds=()=>{this.ads.preloadRewardedVideoAsync().catch(e=>{}),this.ads.preloadInterstitialAdAsync().catch(e=>{})};initModules(){try{new $T(this.game),new _T(this.game)}catch(e){K(e)}}lazyLoadResource(){setTimeout(()=>{this.scene.wake(),this.loadSounds(),this.loadTexture32Bit(),this.load.once(Phaser.Loader.Events.COMPLETE,()=>{this.scene.sleep()})},1e3)}loadSounds(){const{FILE_KEY_COMPLETE:e}=Phaser.Loader.Events;this.load.once(`${e}audio-${As.BACKGROUND.KEY}`,this.handleLoadMusicCompleted),this.load.audio(As.BACKGROUND.KEY,As.BACKGROUND.FILE);for(const t of Object.keys(H)){const s=H[t];this.load.audio(s,[As.EFFECTS.PATH+s+".ogg"])}this.load.start()}handleLoadMusicCompleted=()=>{this.audio.initMusic(As.BACKGROUND.KEY),this.audio.playMusic()};loadTexture32Bit(){if(!GameCore.Configs.LazyTexture32Bit)return;const{GAMEPLAY_TEXTURES_32BIT:e}=_.GAMEPLAY,{DEFAULT_32BIT:t}=_;this.load.atlas({key:e.KEY,textureURL:e.TEXTURE,atlasURL:e.JSON}),this.load.atlas({key:t.KEY,textureURL:t.TEXTURE,atlasURL:t.JSON}),this.load.on(Phaser.Loader.Events.FILE_COMPLETE,s=>{if(console.log(s),!s.endsWith("-32bit"))return;const n=s.replace("-32bit","");if(!this.textures.exists(s)||!this.textures.exists(n))return;const a=this.textures.get(s),r=this.textures.get(n);Object.keys(r.frames).forEach(function(c){Object.assign(r.get(c),a.get(c))})}),this.load.start()}}const i0={targets:[],duration:300,ease:Phaser.Math.Easing.Quadratic.Out,props:{x:100}};class lo extends pe{constructor(e){super(i0,e)}buildConfig(e,t){if(t?.props){const s=t.props.x;t.props.x=n=>n.x+s}super.buildConfig(e,t)}}const{KEY:ho,FRAME:dn}=_.DEFAULT;class th extends Phaser.GameObjects.Container{avatar;button;payload;constructor(e,t){super(e),this.payload=t,this.createAvatar(),this.createButton(),this.scene.add.existing(this)}set onClick(e){this.button.setInteractive({useHandCursor:!0}),this.button.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,e)}createAvatar(){const{playerId:e,playerPhoto:t}=this.payload;this.avatar=new ns(this.scene,{id:e,url:t,key:ho,frame:dn.AVATAR_FRAME_PURPLE_BIG,background:dn.AVATAR_BG,width:58,height:58,radius:34}),this.avatar.photo.setWorldSize(48,48),this.add(this.avatar),this.avatar.setPosition(0,-15)}createButton(){const{buttonText:e}=this.payload;this.button=new Q(this.scene,ho,dn.BUTTON_GREEN_MINOR,61.5,32);const t=this.scene.make.text({text:e,style:{color:"#ffffff",fontFamily:B.FONT_FAMILY,fontSize:"10px",stroke:"#000000",strokeThickness:2}});t.setHighQuality(),this.button.add(t),this.add(this.button),Phaser.Display.Align.In.Center(t,this.button,0,-1),this.button.setPosition(0,32)}}class n0 extends Phaser.GameObjects.Container{currentPlayerId;maskGraphics;group;onChallenge;constructor(e,t,s){super(e),this.setSize(t,s),this.group=this.scene.add.group(),this.currentPlayerId=this.scene.player.getPlayerId(),this.createMask()}updateData(e){this.group.clear(!0,!0);for(const t in e){if(!GameCore.Utils.Object.hasOwn(e,t))continue;const{playerId:s,photo:n}=e[t];if(this.currentPlayerId===s)continue;const a=new th(this.scene,{playerId:s,playerPhoto:n,buttonText:this.scene.lang.Text.CHALLENGE});this.onChallenge&&(a.onClick=()=>{this.onChallenge(s)}),this.add(a),this.group.add(a)}this.group.setX(-99,66),this.updateMaskPosition()}createMask(){this.maskGraphics=this.scene.make.graphics({fillStyle:{color:255,alpha:1},visible:!0});const{width:e,height:t}=this;this.maskGraphics.fillRect(-e/2,-t/2,e,t),this.setMask(this.maskGraphics.createGeometryMask()),this.updateMaskPosition()}updateMaskPosition(){const{x:e,y:t}=this.getWorldPosition();this.maskGraphics.setPosition(e,t)}}const{KEY:pn,FRAME:gn}=_.DEFAULT;class a0 extends Phaser.GameObjects.Container{moveIndex;currentPlayerId;linesGroup;background;loading;leftArrow;rightArrow;matchingBlock;friendList;nextAnim;prevAnim;constructor(e){super(e),this.currentPlayerId=this.scene.player.getPlayerId(),this.createBackground(),this.createLines(),this.createFriendList(),this.createMatchingBlock(),this.createLeftArrow(),this.createRightArrow(),this.createLoading(),this.scene.add.existing(this)}updateFriends(e){this.loading.setVisible(!1);let t=0;for(const n in e){if(!GameCore.Utils.Object.hasOwn(e,n))continue;const{playerId:a}=e[n];this.currentPlayerId!==a&&t++}if(t<1){this.matchingBlock.revive();return}this.matchingBlock.kill();const s=t>4;this.rightArrow.setVisible(s),this.linesGroup.setVisible(!0),this.moveIndex=0,this.friendList.updateData(e)}createBackground(){this.background=new Ye(this.scene,0,0,306,130),this.add(this.background)}createLines(){this.linesGroup=this.scene.make.group({key:pn,frame:gn.LINE_VER,repeat:2}),this.linesGroup.children.each(e=>{const t=e;t.setAlpha(.6),t.setWorldSize(2,106)}),this.linesGroup.setX(-66,66),this.linesGroup.setVisible(!1),this.add(this.linesGroup.children.entries)}createLeftArrow(){this.leftArrow=new Q(this.scene,pn,gn.ICON_ARROW_BIG,18.5,33.5),this.leftArrow.setVisible(!1),this.leftArrow.setPosition(-150,0),this.leftArrow.onClick=this.handlePrevList,this.add(this.leftArrow)}createRightArrow(){this.rightArrow=new Q(this.scene,pn,gn.ICON_ARROW_BIG,18.5,33.5),this.rightArrow.setVisible(!1),this.rightArrow.setPosition(150,0),this.rightArrow.button.setFlipX(!0),this.rightArrow.onClick=this.handleNextList,this.add(this.rightArrow)}createLoading(){this.loading=new Rt(this.scene),this.loading.setDisplaySize(80,80),this.add(this.loading)}createFriendList(){const{width:e,height:t}=this.background;this.friendList=new n0(this.scene,e-27,t),this.add(this.friendList)}createMatchingBlock(){this.matchingBlock=new th(this.scene,{playerId:$.ICON_EARTH.KEY,playerPhoto:$.ICON_EARTH.FILE,buttonText:this.scene.lang.Text.RANDOM}),this.matchingBlock.button.setName("JoinGroup"),this.matchingBlock.kill(),this.add(this.matchingBlock)}handlePrevList=()=>{this.prevAnim?.tween?.isPlaying()&&this.prevAnim.tween.complete(),this.prevAnim?.remove();const e=this.friendList.group.getChildren();this.prevAnim=new lo({targets:e,duration:300,props:{x:66},onStart:()=>{this.leftArrow.setVisible(this.moveIndex>0)},onComplete:()=>{this.rightArrow.setVisible(this.moveIndex<e.length-4)}}),this.moveIndex--,this.prevAnim.play()};handleNextList=()=>{this.nextAnim?.tween?.isPlaying()&&this.nextAnim.tween.complete(),this.nextAnim?.remove();const e=this.friendList.group.getChildren();this.nextAnim=new lo({targets:e,duration:300,props:{x:-66},onStart:()=>{this.rightArrow.setVisible(this.moveIndex<e.length-4)},onComplete:()=>{this.leftArrow.setVisible(this.moveIndex>0)}}),this.moveIndex++,this.nextAnim.play()}}const{KEY:uo,FRAME:bs}=_.DEFAULT;class po extends ns{glow;crown;glowAnimation;constructor(e){super(e,{key:uo,frame:bs.AVATAR_FRAME_BLUE_BIG,background:bs.AVATAR_BG_BIG,width:104.5,height:109.5,loadDelay:100}),this.createGlow(),this.createCrown(),this.createGlowAnimation(),this.scene.add.existing(this)}updateData(e){const{isWin:t,id:s,photo:n}=e;this.glow.setVisible(t),this.crown.setVisible(t),t?this.avtFrame.setFrame(bs.AVATAR_FRAME_BLUE_BIG):this.avtFrame.setFrame(bs.AVATAR_FRAME_PURPLE_BIG),this.loadPhoto(s,n),this.moveBelow(this.glow,this.background)}setPhoto(e){super.setPhoto(e);const{width:t,height:s}=this.payload,n=Math.min(t,s)-24;this.photo.setWorldSize(n,n)}createGlow(){const{KEY:e,FRAME:t}=_.EFFECTS;this.glow=this.scene.make.image({key:e,frame:t.FX_GLOW_LIGHT}),this.glow.setVisible(!1),this.glow.setWorldSize(206,199.5),this.add(this.glow)}createCrown(){this.crown=this.scene.make.image({key:uo,frame:bs.ICON_CROWN}),this.crown.setVisible(!1),this.crown.setPosition(-40,-50),this.crown.setWorldSize(57,57.5),this.add(this.crown)}createGlowAnimation(){this.glowAnimation=new Mi({targets:[this.glow],repeat:-1,duration:6e3}),this.glowAnimation.play()}}class r0 extends Phaser.GameObjects.Container{avatarLeft;avatarRight;scoreLeft;scoreRight;constructor(e){super(e),this.scene=e,this.createVsText(),this.createAvatarLeft(),this.createAvatarRight(),this.createScoreLeft(),this.createScoreRight(),this.scene.add.existing(this)}createVsText(){const e=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(50),text:this.scene.lang.Text.VS,origin:{x:.5,y:.5}});this.add(e)}createAvatarLeft(){this.avatarLeft=new po(this.scene),this.avatarLeft.setPosition(-100,0),this.add(this.avatarLeft)}createAvatarRight(){this.avatarRight=new po(this.scene),this.avatarRight.setPosition(100,0),this.add(this.avatarRight)}createScoreLeft(){this.scoreLeft=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(25),origin:{x:.5,y:.5}}),Phaser.Display.Align.In.BottomCenter(this.scoreLeft,this.avatarLeft,0,20),this.add(this.scoreLeft)}createScoreRight(){this.scoreRight=this.scene.make.bitmapText({font:B.PRIMARY.KEY,size:this.scene.fontSize(25),origin:{x:.5,y:.5}}),Phaser.Display.Align.In.BottomCenter(this.scoreRight,this.avatarRight,0,20),this.add(this.scoreRight)}}const{FRAME:o0}=_.DEFAULT;class c0 extends is{result;dinoTitle;friendList;footerButtons;scaleAnimation;counterScoreTimer;counterPlayerScore;counterOpponentScore;confettiEffect;preload(){this.events.on("wake",this.run),this.events.on("create",this.run)}run=()=>{this.loadFriendList(),this.updateResultInfo()};updateResultScreen(e,t,s,n){this.updateTitle(e,t,s,n),this.updateAvatar(e,t,s,n),this.updateSoundEffect(e,t,s,n)}updateResultInfo(){const e=this.storage.getState(),t=dt(e),s=_t(e),{playerId:n,photo:a}=this.player.getPlayer(),{playerId:r,photo:c}=vt(e),{score:o=0}=s[n]||{},{score:l=0}=s[r]||{};let h=ra(e,{playerId:n}),d=pl(e,{opponentId:r});t===Ot&&(h=!0,d=!0),h&&d?this.runScoreCounter(h,d,o,l):(this.setPlayerScore(o),this.setOpponentScore(l),this.updateResultScreen(h,d,o,l)),this.result.avatarLeft.updateData({id:n,photo:a,isWin:!1}),this.result.avatarRight.updateData({id:r,photo:c,isWin:!1})}updateSoundEffect(e,t,s,n){}updateAvatar(e,t,s,n){const a=this.storage.getState(),{playerId:r,photo:c}=this.player.getPlayer(),{playerId:o,photo:l}=vt(a),h=e&&t;if(this.result.avatarLeft.updateData({id:r,photo:c,isWin:h&&s>n}),this.result.avatarRight.updateData({id:o,photo:l,isWin:h&&n>s}),h){const d=s>n?this.result.avatarLeft:this.result.avatarRight;this.runScaleAnimation(d)}}updateTitle(e,t,s,n){!e||!t?(this.dinoTitle.isDinoSad(!1),this.dinoTitle.setTitle("Waiting")):s===n?(this.dinoTitle.isDinoSad(!1),this.dinoTitle.title.setText("Draw")):s>n?(this.trumpetFire(),this.runConfettiEffect(),this.dinoTitle.isDinoSad(!1),this.dinoTitle.setTitle("You Win!")):s<n&&(this.dinoTitle.isDinoSad(!0),this.dinoTitle.setTitle("You Lose"))}loadFriendList(){const e=this.storage.getState(),t=Gn(e);this.friendList.updateFriends(t)}create(){super.create(),this.createBackground($.OTHER_BACKGROUND.KEY),this.createDinoTitle(),this.createResultMatch(),this.createFriendList(),this.createFooter(),this.createConfettiEffect()}createDinoTitle(){this.dinoTitle=new as(this,{title:"Result"}),this.dinoTitle.changeBackground(o0.TRUMPET,278.5,82),this.dinoTitle.background.y+=20,Phaser.Display.Align.In.TopCenter(this.dinoTitle,this.gameZone,0,-90)}createResultMatch(){this.result=new r0(this),Phaser.Display.Align.In.Center(this.result,this.gameZone,0,-50)}createFriendList(){this.friendList=new a0(this),this.friendList.friendList.onChallenge=this.handleChallengeFriend,this.friendList.matchingBlock.onClick=this.handleMatchingGroup,Phaser.Display.Align.In.Center(this.friendList,this.gameZone,0,120)}createFooter(){this.footerButtons=new Zl(this),Phaser.Display.Align.In.BottomCenter(this.footerButtons,this.gameZone,0,-80),this.footerButtons.homeButton.onClick=this.handleHomeClick,this.footerButtons.playButton.onClick=this.handlePlayWithFriend}handleChallengeFriend=e=>{this.storage.dispatch(Gi(e))};handlePlayWithFriend=async()=>{};handleHomeClick=()=>{this.scene.switch(j.DASHBOARD_SCENE)};handleMatchingGroup=async()=>{const{player:e,storage:t,game:s,facebook:n}=this;try{s.globalScene.screen.open(L.NOTIFY_SCREEN,{message:this.lang.Text.MATCHING,loading:!0});const a=e.getPlayer();let r="global";const c=Xl(a.locale);c==="en"&&(r="en"),c==="in"&&(r="in");const o=await n.matchPlayerAsync(r,!0,!0);if(s.globalScene.screen.close(L.NOTIFY_SCREEN),!o)return;t.dispatch(ma())}catch(a){s.globalScene.screen.close(L.NOTIFY_SCREEN),console.warn(a)}};setPlayerScore(e){this.result.scoreLeft.setText(`${e}`)}setOpponentScore(e){this.result.scoreRight.setText(`${e}`)}runScoreCounter(e,t,s,n){this.counterScoreTimer?.remove(),this.counterPlayerScore?.remove(),this.counterOpponentScore?.remove(),this.counterScoreTimer=this.time.delayedCall(2800,()=>{this.setPlayerScore(s),this.setOpponentScore(n),this.updateResultScreen(e,t,s,n)}),this.counterPlayerScore=this.tweens.addCounter({from:0,to:s,delay:500,duration:2e3,onUpdate:a=>{const r=Math.floor(a.getValue());this.setPlayerScore(r)}}),this.counterOpponentScore=this.tweens.addCounter({from:0,to:n,delay:500,duration:2e3,onUpdate:a=>{const r=Math.floor(a.getValue());this.setOpponentScore(r)}})}runScaleAnimation(e){this.scaleAnimation||(this.scaleAnimation=new Ns({targets:[e],delay:0,duration:500,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],props:{scale:1.1}}),this.scaleAnimation.play())}createConfettiEffect(){this.confettiEffect=new ua(this),this.confettiEffect.setDepth(z.EFFECT)}trumpetFire(){if(this.dinoTitle.background&&this.dinoTitle.background.active){const e=this.dinoTitle.background.scale,t=new Ns({targets:[this.dinoTitle.background],yoyo:!0,duration:200,ease:Phaser.Math.Easing.Back.InOut,easeParams:[.1,.45],props:{scale:e*1.15},onComplete:()=>{t.remove()}});t.play()}}runConfettiEffect=()=>{this.confettiEffect.run(0,675,380,675)}}class l0 extends Phaser.Plugins.BasePlugin{isVisible=!0;browserPrefixes=["moz","ms","o","","webkit"];visibleCallbacks=[];hiddenCallbacks=[];configure(){const e=this.getBrowserPrefix(),t=this.getVisibilityEvent(e);document.addEventListener(t,this.handleVisibilityChange,!1),document.addEventListener("focus",()=>{this.handleVisibilityChange(!0)},!1),document.addEventListener("blur",()=>{this.handleVisibilityChange(!1)},!1),window.addEventListener("focus",()=>{this.handleVisibilityChange(!0)},!1),window.addEventListener("blur",()=>{this.handleVisibilityChange(!1)},!1)}addEventVisible(e){this.visibleCallbacks.push(e)}addEventHidden(e){this.hiddenCallbacks.push(e)}isGameVisible(){return this.isVisible}getHiddenPropertyName(e){return e?e+"Hidden":"hidden"}getVisibilityEvent(e){return(e||"")+"visibilitychange"}getBrowserPrefix(){for(let e=0;e<this.browserPrefixes.length;e++)if(this.getHiddenPropertyName(this.browserPrefixes[e])in document)return this.browserPrefixes[e];return""}onVisibleEvent(){this.isVisible||(this.isVisible=!0,console.log("visible"),this.visibleCallbacks.forEach(e=>{e()}))}onHiddenEvent(){this.isVisible&&(this.isVisible=!1,console.log("hidden"),this.hiddenCallbacks.forEach(e=>{e()}))}handleVisibilityChange=e=>{if(typeof e=="boolean")return e?this.onVisibleEvent():this.onHiddenEvent();const t=this.getBrowserPrefix(),s=this.getHiddenPropertyName(t);return document[s]?this.onHiddenEvent():this.onVisibleEvent()}}const{Valid:go}=GameCore.Utils;class h0{currencies;constructor(e){this.initDefaultValues(),go.isObject(e)&&Object.keys(e).forEach(t=>{Object.hasOwn(e,t)&&go.isNumber(e[t])&&(this.currencies[t]=e[t])})}initDefaultValues(){this.currencies={}}toObject(){return{...this.currencies}}}const{Object:bt,Valid:rt}=GameCore.Utils;class u0{currentLevel;itemsCollected;levelsCompleted;constructor(e){this.initDefaultValues(),rt.isObject(e)&&(bt.hasOwn(e,"currentLevel")&&rt.isNumber(e.currentLevel)&&(this.currentLevel=e.currentLevel),bt.hasOwn(e,"itemsCollected")&&Array.isArray(e.itemsCollected)&&(this.itemsCollected=e.itemsCollected.filter(t=>!(!rt.isObject(t)||!bt.hasOwn(t,"itemId")||!rt.isString(t.itemId)||!bt.hasOwn(t,"quantity")||!rt.isNumber(t.quantity)))),bt.hasOwn(e,"levelsCompleted")&&Array.isArray(e.levelsCompleted)&&(this.levelsCompleted=e.levelsCompleted.filter(t=>!(!rt.isObject(t)||!bt.hasOwn(t,"score")||!rt.isNumber(t.score)||!bt.hasOwn(t,"levelId")||!rt.isString(t.levelId)))))}initDefaultValues(){this.currentLevel=0,this.levelsCompleted=[],this.itemsCollected=[]}toObject(){return{currentLevel:this.currentLevel,itemsCollected:this.itemsCollected,levelsCompleted:this.levelsCompleted}}}const{Object:li,Valid:Ts}=GameCore.Utils;class d0{highScore;timePlayed;totalGamesWon;totalGamesLose;constructor(e){this.initDefaultValues(),Ts.isObject(e)&&(li.hasOwn(e,"highScore")&&Ts.isNumber(e.highScore)&&(this.highScore=e.highScore),li.hasOwn(e,"timePlayed")&&Ts.isNumber(e.timePlayed)&&(this.timePlayed=e.timePlayed),li.hasOwn(e,"totalGamesWon")&&Ts.isNumber(e.totalGamesWon)&&(this.totalGamesWon=e.totalGamesWon),li.hasOwn(e,"totalGamesLose")&&Ts.isNumber(e.totalGamesLose)&&(this.totalGamesLose=e.totalGamesLose))}initDefaultValues(){this.highScore=0,this.timePlayed=0,this.totalGamesWon=0,this.totalGamesLose=0}toObject(){return{highScore:this.highScore,timePlayed:this.timePlayed,totalGamesWon:this.totalGamesWon,totalGamesLose:this.totalGamesLose}}}const{settings:p0}=Jc,{Object:Re,Valid:ot}=GameCore.Utils;class g0{gpId;appId;glanceId;playerId;name;photo;locale;friendIds;gameProgress;gameSettings;gameStatistics;currencyBalance;constructor(e){this.initDefaultValues(),ot.isObject(e)&&(Re.hasOwn(e,"gpId")&&ot.isString(e.gpId)&&(this.gpId=e.gpId),Re.hasOwn(e,"appId")&&ot.isString(e.appId)&&(this.appId=e.appId),Re.hasOwn(e,"glanceId")&&ot.isString(e.glanceId)&&(this.glanceId=e.glanceId),Re.hasOwn(e,"playerId")&&ot.isString(e.playerId)&&(this.playerId=e.playerId),Re.hasOwn(e,"name")&&ot.isString(e.name)&&(this.name=e.name),Re.hasOwn(e,"photo")&&ot.isString(e.photo)&&(this.photo=e.photo),Re.hasOwn(e,"locale")&&ot.isString(e.locale)&&(this.locale=e.locale),Re.hasOwn(e,"friendIds")&&Array.isArray(e.friendIds)&&(this.friendIds=e.friendIds),Re.hasOwn(e,"gameProgress")&&(this.gameProgress=new u0(e.gameProgress).toObject()),Re.hasOwn(e,"gameStatistics")&&(this.gameStatistics=new d0(e.gameStatistics).toObject()),Re.hasOwn(e,"currencyBalance")&&(this.currencyBalance=new h0(e.currencyBalance).toObject()),Re.hasOwn(e,"gameSettings")&&(this.gameSettings=new Qc(e.gameSettings).toObject()))}initDefaultValues(){this.gpId="",this.appId="",this.glanceId="",this.playerId="",this.name="",this.photo="",this.locale="en_US",this.friendIds=[],this.gameProgress={currentLevel:0,itemsCollected:[],levelsCompleted:[]},this.gameSettings={...p0},this.gameStatistics={highScore:0,timePlayed:0,totalGamesWon:0,totalGamesLose:0},this.currencyBalance={}}toObject(){return{gpId:this.gpId,appId:this.appId,glanceId:this.glanceId,playerId:this.playerId,name:this.name,photo:this.photo,locale:this.locale,friendIds:this.friendIds,gameProgress:this.gameProgress,gameSettings:this.gameSettings,gameStatistics:this.gameStatistics,currencyBalance:this.currencyBalance}}}class m0 extends Phaser.Plugins.BasePlugin{data;endpoint;enabled;async setup(e,t){this.enabled=!0,this.endpoint=e,console.log("NotificationPlugin: configure",e,t),this.updateData(t)}updateData=async e=>{if(!this.enabled)return;const t=Ie(this.data,e);this.data=new g0(t).toObject(),console.log("NotificationPlugin: updatePayload",this.data)};sendRequest=async()=>{try{if(!this.enabled)return;const{playerId:e}=this.data,t={...this.data};console.log("NotificationPlugin: sendRequest",t);const n=(await Fs(`players/${e}`,t,{},this.endpoint,10))?.data||{};this.updateData(n)}catch(e){console.warn("NotificationPlugin: sendRequest",e)}}}class mo extends GameCore.Ads.AdInstance{instance;placementId;constructor(e,t){super(e),this.instance=null,this.placementId=t}static setGame(e){self.game=e}async loadAsync(){if(console.log("loadAsync",this.type,this.status),this.status===GameCore.Ads.Status.IDLE)try{if(this.status=GameCore.Ads.Status.LOADING,this.instance=await this.createInstanceByType(this.type),this.instance===null)throw new GameCore.Ads.AdError("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");await this.instance.loadAsync(),this.status=GameCore.Ads.Status.FILLED}catch(e){throw this.status=GameCore.Ads.Status.IDLE,this.instance=null,e}}async showAsync(){const e=this.getSceneName();try{if(console.log("showAsync",this.type,this.status),this.status===GameCore.Ads.Status.LOADING)throw new GameCore.Ads.AdError("AD_ARE_LOADING","Ads are loading.");if(this.status!==GameCore.Ads.Status.FILLED)throw new GameCore.Ads.AdError("AD_NOT_FILLED","Ads no fill.");if(this.status=GameCore.Ads.Status.SHOWING,this.instance===null)throw new GameCore.Ads.AdError("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");this.type===GameCore.Ads.Types.REWARDED&&window.sendCustomAnalyticsEvent(V.GLANCE_REWARDED_AD,{failureCB:()=>window.handleRewardedFail(),successCB:()=>window.handleRewardedSuccess()}),await this.instance.showAsync(),this.type===GameCore.Ads.Types.INTERSTITIAL&&self.game.analytics.showInterstitialAd(e),this.type===GameCore.Ads.Types.REWARDED&&self.game.analytics.showRewardedVideoAd(e),this.status=GameCore.Ads.Status.IDLE,this.instance=null}catch(t){if(console.warn("showAsync error",t),this.status=GameCore.Ads.Status.IDLE,this.instance=null,t instanceof Object&&GameCore.Utils.Object.hasOwn(t,"code")){if(t.code==="AD_ARE_LOADING"&&this.type===GameCore.Ads.Types.REWARDED){self.game.analytics.showAdFail(this.type,e,t);return}if(t.code==="AD_NOT_FILLED"&&this.type===GameCore.Ads.Types.REWARDED){self.game.analytics.showAdFail(this.type,e,t);return}}throw self.game.analytics.showAdFail(this.type,e,t),t}}getStatus(){return this.status}async createInstanceByType(e){const{facebook:t}=self.game;switch(e){case GameCore.Ads.Types.REWARDED:return await t.getRewardedVideoAsync(this.placementId);case GameCore.Ads.Types.INTERSTITIAL:return await t.getInterstitialAdAsync(this.placementId);default:return null}}getSceneName(){try{const{globalScene:e}=self.game;return e instanceof ya?e.getCurrentScene().scene.getSceneName():"unknown"}catch{return"unknown"}}}const{Object:fo,Valid:Je}=GameCore.Utils;class f0 extends Phaser.Game{constructor(e){super(e)}async boot(){super.boot(),this.addExtraGameObjectMethods(),this.addExtraFBInstantFunctions(),this.addPlugins(),await this.addDevPlugins(),await this.initAdsAsync(),this.addScenes(),this.addDevScenes(),this.initWorld(),this.initStorage(),this.initLanguage(),this.initVisibilityChangeHandler(),this.initUtils(),this.initRollbar(),this.initConsole(),this.initDebugger(),this.initStatistics(),this.initParticleEditor(),this.initNotificationPlugin(),this.initAdaptivePerformance(),this.initProfilerPlugin(),this.handleShowInterAdWhenStartGame(),this.addGlanceGlobalMethods()}start(){super.start()}addExtraGameObjectMethods(){const e=new qu;e.addKillRevive(),e.addKillReviveGroup(),e.addDrawDebugBox(),e.addSetWorldSize(),e.addSetWorldSizeForContainer(),e.addGetWorldPosition(),e.addHighQuality(),e.addSetLineHeightForBitmapText()}addExtraFBInstantFunctions(){const e=new ju(this.facebook);this.facebook.getLocale=e.getLocale,this.facebook.shareAsync=e.shareAsync,this.facebook.inviteAsync=e.inviteAsync,this.facebook.switchAsync=e.switchAsync,this.facebook.chooseAsync=e.chooseAsync,this.facebook.createAsync=e.createAsync,this.facebook.sendMessage=e.sendMessage,this.facebook.getContextID=e.getContextID,this.facebook.getPlayerToken=e.getPlayerToken,this.facebook.matchPlayerAsync=e.matchPlayerAsync,this.facebook.getContextPlayers=e.getContextPlayers,this.facebook.setLoadingProgress=e.setLoadingProgress,this.facebook.getTournamentAsync=e.getTournamentAsync,this.facebook.attemptToAddShortcut=e.attemptToAddShortcut,this.facebook.attemptToSubscribeBot=e.attemptToSubscribeBot,this.facebook.postSessionScoreAsync=e.postSessionScoreAsync,this.facebook.getRewardedVideoAsync=e.getRewardedVideoAsync,this.facebook.getInterstitialAdAsync=e.getInterstitialAdAsync,this.facebook.sendNotificationAsync=e.sendNotificationAsync,e.injectTournament(),this.facebook.progressLoading=new Xu(this)}addPlugins(){this.plugins.install("Storage",Mg,!0,"storage"),this.plugins.install("Rollbar",gp,!0,"rollbar"),this.plugins.install("AdsManager",Ju,!0,"ads"),this.plugins.install("AuthManager",fd,!0,"auth"),this.plugins.install("AudioManager",id,!0,"audio"),this.plugins.install("WorldManager",Yg,!0,"world"),this.plugins.install("PlayerManager",Xd,!0,"player"),this.plugins.install("LanguageManager",dm,!0,"lang"),this.plugins.install("ProfileManager",ip,!0,"profile"),this.plugins.install("AnalyticsManager",ed,!0,"analytics"),this.plugins.install("NotificationPlugin",m0,!0,"notification"),this.plugins.install("AdaptivePerformance",Td,!0,"performance"),this.plugins.install("VisibilityChangeHandler",l0,!0,"visibility"),this.plugins.installScenePlugin("textStyler",Ug,"textStyler"),this.plugins.installScenePlugin("ScreenManager",Ep,"screen"),this.plugins.installScenePlugin("FrameCapture",Ad,"frameCapture"),window.SpinePlugin&&this.plugins.installScenePlugin("SpinePlugin",SpinePlugin,"spine"),this.storage=this.plugins.get("Storage"),this.rollbar=this.plugins.get("Rollbar"),this.ads=this.plugins.get("AdsManager"),this.auth=this.plugins.get("AuthManager"),this.audio=this.plugins.get("AudioManager"),this.world=this.plugins.get("WorldManager"),this.player=this.plugins.get("PlayerManager"),this.lang=this.plugins.get("LanguageManager"),this.profile=this.plugins.get("ProfileManager"),this.analytics=this.plugins.get("AnalyticsManager"),this.notification=this.plugins.get("NotificationPlugin"),this.performance=this.plugins.get("AdaptivePerformance"),this.visibility=this.plugins.get("VisibilityChangeHandler")}async addDevPlugins(){if(!Je.isDebugger())return;const e=(await pt(()=>import("./devtool.js").then(r=>r.i),[],import.meta.url)).default,t=(await pt(()=>import("./devtool.js").then(r=>r.a),[],import.meta.url)).default,s=(await pt(()=>import("./devtool.js").then(r=>r.b),[],import.meta.url)).default,n=(await pt(()=>import("./devtool.js").then(r=>r.c),[],import.meta.url)).default,a=(await pt(()=>import("./devtool.js").then(r=>r.d),[],import.meta.url)).default;this.plugins.install("Console",e,!0,"console"),this.plugins.install("Debugger",t,!0,"debugger"),this.plugins.install("Profiler",n,!0,"profiler"),this.plugins.install("Statistics",s,!0,"statistics"),this.plugins.install("ParticleEditor",a,!0,"particle-editor"),this.eruda=this.plugins.get("Console"),this.debugger=this.plugins.get("Debugger"),this.profiler=this.plugins.get("Profiler"),this.statistics=this.plugins.get("Statistics"),this.particleEditor=this.plugins.get("ParticleEditor")}addScenes(){this.scene.add(j.BOOT_SCENE,Tm,!0),this.scene.add(j.LOAD_SCENE,s0,!1),this.scene.add(j.GAME_SCENE,da,!1),this.scene.add(j.GAME_OVER_SCENE,Qb,!1),this.scene.add(j.DASHBOARD_SCENE,Nb,!1),this.scene.add(j.LEADERBOARD_SCENE,pT,!1),this.scene.add(j.RESULT_MATCH_SCENE,c0,!1),this.scene.add(j.GLOBAL_SCENE,ya,!1)}async addDevScenes(){if(!Je.isDebugger())return;const e=(await pt(()=>import("./devscene.js").then(s=>s.T),[],import.meta.url)).default,t=(await pt(()=>import("./devscene.js").then(s=>s.i),[],import.meta.url)).default;this.scene.add(j.TEST_SCENE,e,!1),this.scene.add(j.ANIMATIONS_SCENE,t,!1)}async initAdsAsync(){const{Ads:e}=GameCore.Configs;mo.setGame(this);const t=mo,s={...e.InterstitialAdOptions},n=window.GlanceGamingAdInterface!=null&&window.isAdSDKLoaded;s.showWhenStartGame&&(s.secondsFirstTime=0),this.ads.configure(t,{enabled:e.Enabled&&n,calculateSafeAreaBottom:e.CalculateSafeAreaBottom,enableRewardVideoResetInterstitial:e.EnableRewardVideoResetInterstitial,interstitialAdOptions:s,rewardAdOptions:e.RewardAdOptions,bannerAdOptions:e.BannerAdOptions})}initWorld(){const{Game:e}=GameCore.Configs,{AutoResize:t,PortraitRatio:s,PortraitWidth:n,PortraitHeight:a,LandscapeRatio:r,LandscapeWidth:c,LandscapeHeight:o,DisableLandscape:l,FullSizeOnLandscape:h}=e,d=t,u=l,p=h,g=s,m=n,E=a,f=r,y=c,S=o;this.world.configure({autoResize:d,portraitRatio:g,portraitWidth:m,portraitHeight:E,landscapeRatio:f,landscapeWidth:y,landscapeHeight:S,disableLandscape:u,fullSizeOnLandscape:p}),this.world.resize(e.ForcePixelRatio)}initStorage(){const e=new im(this);this.storage.setInitiator(e)}initLanguage(){const e=this.facebook.getLocale();this.lang.configure({locale:e,upperCaseText:!0})}initVisibilityChangeHandler(){this.visibility.configure()}initUtils(){this.handlePauseAudio()}initConsole(){if(!Je.isDebugger())return;const{ShowConsole:e}=GameCore.Configs.Debugger;e&&this.eruda.configure({tool:["console","info"],defaults:{theme:"Dark"}})}initDebugger(){if(!Je.isDebugger())return;const{ShowInspector:e,ShowMonitoring:t}=GameCore.Configs.Debugger;!e&&!t||this.debugger.configure(GameCore.Configs.Debugger)}initStatistics(){if(!Je.isDebugger())return;const{Enable:e}=GameCore.Configs.Statistics;e&&this.statistics.configure(GameCore.Configs.Statistics)}initParticleEditor(){if(!Je.isDebugger())return;const{Enable:e}=GameCore.Configs.ParticleEditor;e&&this.particleEditor.configure(GameCore.Configs.ParticleEditor)}initProfilerPlugin(){if(!Je.isDebugger())return;const{Enable:e}=GameCore.Configs.ProfilerPlugin;e&&this.profiler.configure()}initNotificationPlugin(){const{AppId:e}=GameCore.Configs,{Enable:t,ApiUrl:s}=GameCore.Configs.Notification;if(!t)return;let n=null;if(fo.hasOwn(window.__glancePlayerData,"glanceId")&&Je.isString(window.__glancePlayerData.glanceId)&&(n=window.__glancePlayerData.glanceId),!n)return;let a=null;if(fo.hasOwn(window.__glancePlayerData,"gpID")&&Je.isString(window.__glancePlayerData.gpID)&&(a=window.__glancePlayerData.gpID),!a)return;const r={gpId:a,appId:e,glanceId:n};this.notification.setup(s,r)}addGlanceGlobalMethods(){window.enableSound=e=>{this.player.setSetting("music",e),this.player.setSetting("sound",e),e?this.audio.playMusic():this.audio.pauseMusic()}}initAdaptivePerformance(){const{Enable:e,...t}=GameCore.Configs.Performance;if(!e)return;const s=this.world.getPixelRatio();this.performance.configure({pixelRatio:s,...t}),this.performance.active()}initRollbar(){const{Enable:e}=GameCore.Configs.Rollbar;console.warn({isRollbarEnabled:e}),e&&this.rollbar.setup()}handlePauseAudio(){this.sound.pauseOnBlur=!1,this.visibility.addEventVisible(()=>{this.audio.playMusic()}),this.visibility.addEventHidden(()=>{this.audio.pauseMusic()})}async handleShowInterAdWhenStartGame(){const{InterstitialAdOptions:e}=GameCore.Configs.Ads;if(e.showWhenStartGame)try{this.audio.stopMusic(),this.audio.muteAll(),await this.ads.preloadInterstitialAdAsync(),await this.ads.showInterstitialAdAsync()}catch(t){K(t)}finally{this.audio.unmuteAll(),this.audio.playMusic()}}}const{ShowInspector:y0}=GameCore.Configs.Debugger,E0={parent:"app",type:Phaser.AUTO,width:0,height:0,scale:{autoRound:!0},dom:{createContainer:!1},loader:{maxParallelDownloads:6,crossOrigin:"no-cros"},audio:{noAudio:!1,disableWebAudio:!1},input:{gamepad:!1,keyboard:y0,touch:{capture:!0},smoothFactor:1,activePointers:1,windowEvents:!1},disableContextMenu:!0,render:{antialias:!0,transparent:!1,clearBeforeRender:!1},physics:{default:"arcade",arcade:{gravity:{y:0}}},plugins:{global:[]}};Uu();const S0=()=>{try{const i=new f0(E0);window.game=i}catch(i){K(i)}},A0=()=>{const i=setInterval(()=>{if(!window.__analyticsInitiated||!window.FBInstant)return;//! temporarily fix for not use adapter
window.GameSDK=window.FBInstant,window.__fbGameReady=!1,clearInterval(i),clearInterval(window.__fbInstantLoadingTimer),GameSDK.setLoadingProgress(30),"gtag"in window&&gtag("event","app_initialize",{send_to:["GA"]}),S0()},50)};A0();export{ae as A,is as B,Fr as C,z as D,Qt as E,B as F,ua as P,_ as S,jl as a,vb as b,$o as c,$m as d,cl as e,Vm as f,np as g,Zb as h,ea as i,Um as j,Ns as k,Db as l,Ie as m,_b as n,Q as o,zl as p};
