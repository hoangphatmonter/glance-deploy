import"./engine.js";const eh=(i,e=1)=>Array.from({length:Math.ceil(i.length/e)},(t,s)=>i.slice(s*e,s*e+e)),th=(i,e)=>i.filter(t=>!e.includes(t)),sh=i=>{for(let e=i.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[i[e],i[t]]=[i[t],i[e]]}},ih=(i,e,t)=>t.indexOf(i)===e&&i!==null&&i!==void 0,nh=i=>i.filter(ih),ah={chunk:eh,difference:th,shuffle:sh,unique:nh};var rh={isEqual:!0,isMatchingKey:!0,isPromise:!0,maxSize:!0,onCacheAdd:!0,onCacheChange:!0,onCacheHit:!0,transformKey:!0},oh=Array.prototype.slice;function ei(i){var e=i.length;return e?e===1?[i[0]]:e===2?[i[0],i[1]]:e===3?[i[0],i[1],i[2]]:oh.call(i,0):[]}function ch(i){var e={};for(var t in i)rh[t]||(e[t]=i[t]);return e}function lh(i){return typeof i=="function"&&i.isMemoized}function hh(i,e){return i===e||i!==i&&e!==e}function ga(i,e){var t={};for(var s in i)t[s]=i[s];for(var s in e)t[s]=e[s];return t}var uh=function(){function i(e){this.keys=[],this.values=[],this.options=e;var t=typeof e.isMatchingKey=="function";t?this.getKeyIndex=this._getKeyIndexFromMatchingKey:e.maxSize>1?this.getKeyIndex=this._getKeyIndexForMany:this.getKeyIndex=this._getKeyIndexForSingle,this.canTransformKey=typeof e.transformKey=="function",this.shouldCloneArguments=this.canTransformKey||t,this.shouldUpdateOnAdd=typeof e.onCacheAdd=="function",this.shouldUpdateOnChange=typeof e.onCacheChange=="function",this.shouldUpdateOnHit=typeof e.onCacheHit=="function"}return Object.defineProperty(i.prototype,"size",{get:function(){return this.keys.length},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"snapshot",{get:function(){return{keys:ei(this.keys),size:this.size,values:ei(this.values)}},enumerable:!1,configurable:!0}),i.prototype._getKeyIndexFromMatchingKey=function(e){var t=this.options,s=t.isMatchingKey,n=t.maxSize,a=this.keys,r=a.length;if(!r)return-1;if(s(a[0],e))return 0;if(n>1){for(var c=1;c<r;c++)if(s(a[c],e))return c}return-1},i.prototype._getKeyIndexForMany=function(e){var t=this.options.isEqual,s=this.keys,n=s.length;if(!n)return-1;if(n===1)return this._getKeyIndexForSingle(e);var a=e.length,r,c;if(a>1){for(var o=0;o<n;o++)if(r=s[o],r.length===a){for(c=0;c<a&&t(r[c],e[c]);c++);if(c===a)return o}}else for(var o=0;o<n;o++)if(r=s[o],r.length===a&&t(r[0],e[0]))return o;return-1},i.prototype._getKeyIndexForSingle=function(e){var t=this.keys;if(!t.length)return-1;var s=t[0],n=s.length;if(e.length!==n)return-1;var a=this.options.isEqual;if(n>1){for(var r=0;r<n;r++)if(!a(s[r],e[r]))return-1;return 0}return a(s[0],e[0])?0:-1},i.prototype.orderByLru=function(e,t,s){for(var n=this.keys,a=this.values,r=n.length,c=s;c--;)n[c+1]=n[c],a[c+1]=a[c];n[0]=e,a[0]=t;var o=this.options.maxSize;r===o&&s===r?(n.pop(),a.pop()):s>=o&&(n.length=a.length=o)},i.prototype.updateAsyncCache=function(e){var t=this,s=this.options,n=s.onCacheChange,a=s.onCacheHit,r=this.keys[0],c=this.values[0];this.values[0]=c.then(function(o){return t.shouldUpdateOnHit&&a(t,t.options,e),t.shouldUpdateOnChange&&n(t,t.options,e),o},function(o){var l=t.getKeyIndex(r);throw l!==-1&&(t.keys.splice(l,1),t.values.splice(l,1)),o})},i}();function Ms(i,e){if(e===void 0&&(e={}),lh(i))return Ms(i.fn,ga(i.options,e));if(typeof i!="function")throw new TypeError("You must pass a function to `memoize`.");var t=e.isEqual,s=t===void 0?hh:t,n=e.isMatchingKey,a=e.isPromise,r=a===void 0?!1:a,c=e.maxSize,o=c===void 0?1:c,l=e.onCacheAdd,h=e.onCacheChange,d=e.onCacheHit,u=e.transformKey,p=ga({isEqual:s,isMatchingKey:n,isPromise:r,maxSize:o,onCacheAdd:l,onCacheChange:h,onCacheHit:d,transformKey:u},ch(e)),m=new uh(p),g=m.keys,y=m.values,f=m.canTransformKey,E=m.shouldCloneArguments,S=m.shouldUpdateOnAdd,I=m.shouldUpdateOnChange,T=m.shouldUpdateOnHit,b=function(){var O=E?ei(arguments):arguments;f&&(O=u(O));var _=g.length?m.getKeyIndex(O):-1;if(_!==-1)T&&d(m,p,b),_&&(m.orderByLru(g[_],y[_],_),I&&h(m,p,b));else{var w=i.apply(this,arguments),v=E?O:ei(arguments);m.orderByLru(v,w,g.length),r&&m.updateAsyncCache(b),S&&l(m,p,b),I&&h(m,p,b)}return y[0]};return b.cache=m,b.fn=i,b.isMemoized=!0,b.options=p,b}const dh=Ms((i,e)=>{if(typeof i=="string"){const t=e[i.toLowerCase()];if(typeof t=="string")return t}return"?"}),ph=Ms(i=>{let e=null;const t=[],s=/:([A-Z0-9?]+)/gm;for(;(e=s.exec(i))!==null;)t.push(e[1]);return t}),mh=Ms(i=>{let e=null;const t=[],s=/([0-9]+[A-Z?]{1}|[A-Z?]{1})/gm;for(;(e=s.exec(i))!==null;){const n=e[0];if(n.length>=2){const{length:a}=n,r=n.slice(0,a-1),c=n[a-1],o=new Array(+r).fill(c);t.push(...o);continue}t.push(n)}return t}),gh=(i,e)=>{const t=i,s=GameCore.Utils.Object.invert(e),n={};let a=0,r=0;return ph(t).forEach(o=>{a=0,r++,n[r]||(n[r]={}),mh(o).forEach(h=>{a++,n[r][a]=dh(h,s)})}),n},fh=Ms((i,e)=>{const t=e[i];return typeof t=="string"?`${t.toUpperCase()}`:"?"}),Wr=(i,e,t=!1)=>{let s="";if(!GameCore.Utils.Valid.isObject(i))return s;let n="",a=1;for(const r in i){if(!GameCore.Utils.Object.hasOwn(i,r))continue;const c=i[r];if(GameCore.Utils.Valid.isObject(c)){s+=`:${Wr(c,e,!0)}`;continue}if(!GameCore.Utils.Valid.isString(c))continue;const o=fh(c,e);o===n?(a++,s=s.slice(0,-2)):a=1,s+=`${a}${o}`,n=o}return s=s.replace(/1([A-Z])/g,"$1"),s},Eh=i=>{try{return atob(i)}catch{return""}},yh=i=>{try{return btoa(i)}catch{return""}},Sh={decodeMap:gh,encodeMap:Wr,hashToString:Eh,stringToHash:yh},Ah=(i,e)=>{const t=document.createElement("style"),s=Object.keys(e).map(n=>Th(n,e[n])).join(";");return t.innerHTML=`${i} { ${s} }`,document.head.appendChild(t),t},Th=(i,e)=>`${GameCore.Utils.String.toKebabCase(i)}: ${e}`,Ih={dynamicCSS:Ah},Kr=i=>{try{return JSON.parse(i)}catch{return null}},jr=i=>{try{return JSON.stringify(i,null,0)}catch{return""}},bh=i=>Kr(jr(i)),wh={clone:bh,decode:Kr,encode:jr},ln=i=>{const e=typeof i=="object"||typeof i=="function",t=Array.isArray(i);return i!==null&&e&&!t},Ch=i=>i==null,zr=i=>{if(!ln(i))return i;for(const e in i){Ch(i[e])&&delete i[e];const t=i[e];ln(t)&&(i[e]=zr(t))}return i},bn=(i,e)=>Object.prototype.hasOwnProperty.call(i,e),vh=i=>{const e={};return Object.keys(i).forEach(t=>{if(!bn(i,t))return;const s=i[t];typeof s=="string"&&(e[s]=t)}),e},_h=(i,e)=>{if(!Array.isArray(i))return{};const t={};return i.forEach(s=>{if(!bn(s,e))return;const n=s[e];typeof n=="string"&&(t[n]=s)}),t},Oh={clear:zr,hasOwn:bn,invert:vh,keyBy:_h},Rh=i=>i&&i[0].toUpperCase()+i.slice(1),Ph=i=>{let e=0;if(i.length==0)return e;for(let t=0;t<i.length;t++){const s=i.charCodeAt(t);e=(e<<5)-e+s,e=e&e}return e},Dh=i=>Object.keys(i).reduce((t,s)=>{const n=i[s];return n!==void 0&&t.push(`${s}=${n}`),t},[]).join("&"),Mh="0123456789ABCDEF",Lh=(i="0x")=>{let e=i;for(let t=0;t<6;t++)e+=Mh[Math.floor(Math.random()*16)];return e},xh=i=>{const e=i.replace(/[-_\s.]+(.)?/g,(t,s)=>s?s.toUpperCase():"");return e.substr(0,1).toUpperCase()+e.substr(1)},Nh=i=>{const e=i.replace(/[-_\s.]+(.)?/g,(t,s)=>s?s.toUpperCase():"");return e.substr(0,1).toLowerCase()+e.substr(1)},kh=i=>i.replace(/([a-z0-9]|(?=[A-Z]))([A-Z])/g,"$1-$2").toLowerCase(),Gh=(i,e)=>{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789*#%&!";let s="",n=i;e!=null&&(n-=e.length,s+=e);for(let a=0;a<n;a++){const r=Math.floor(Math.random()*t.length);s+=t.charAt(r)}return s},Bh=i=>i.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,t=>t==="đ"?"d":"D"),Uh=(i,e)=>{const t=i.split(" "),n=(t.length<=1?[...t]:[t[0],t.pop()]).join(" "),a=n.lastIndexOf(" ")||0,r=a>=0?a:e;return(n.length>e?n.substring(0,r):n).substring(0,e)},Fh=(i=16)=>{const e=s=>Math.floor(s).toString(i);return e(Date.now()/1e3)+" ".repeat(i).replace(/./g,()=>e(Math.random()*i))},Yh={capitalize:Rh,hashCode:Ph,params:Dh,toCamelCase:Nh,toKebabCase:kh,toUpperCamelCase:xh,randomColor:Lh,random:Gh,removeDiacritics:Bh,getShortName:Uh,generateObjectId:Fh},Hh=i=>typeof i=="boolean",$r="false";console.log("DEBUG",$r);const Vh=()=>$r==="true",Wh=i=>typeof i=="function",Kh=i=>typeof i=="number",jh=i=>["string","number","symbol"].indexOf(typeof i)>-1,zh=i=>typeof i=="string",$h=(i,e,t)=>{const{timeout:s=1e3,checkInterval:n=100}=t||{};return new Promise(a=>{const r=setInterval(()=>{const c=typeof i=="function"?i():i,o=typeof e=="function"?e():e;c===o&&(clearInterval(r),a(!0))},n);s>0&&setTimeout(()=>{clearInterval(r),a(!1)},s)})},Xh={isBoolean:Hh,isDebugger:Vh,isFunction:Wh,isNumber:Kh,isObject:ln,isPropertyKey:jh,isString:zh,isValueChangeAsync:$h},qh=i=>{const{scene:e,key:t,newKey:s}=i,n=e.textures.get(t).getSourceImage();if(!n)return!1;const a=Math.min(n.width,n.height);s||e.textures.removeKey(t);const r=e.textures.createCanvas(s||t,a,a),c=r.context;return c.beginPath(),c.arc(a/2,a/2,a/2,0,Math.PI*2,!1),c.clip(),r.draw((n.width-a)/2,(n.height-a)/2,n),!0},Zh=i=>{const{scene:e,key:t,newKey:s,radius:n}=i;let{width:a,height:r}=i;const c=e.textures.get(t).getSourceImage();if(!c)return!1;a||(a=c.width),r||(r=c.height),s||e.textures.removeKey(t);const o=e.textures.createCanvas(s||t,a,r),l=o.context,d=Math.min(a,r)/100*n/2,u=0,p=0;return l.beginPath(),l.moveTo(u+d,p),l.lineTo(u+a-d,p),l.quadraticCurveTo(u+a,p,u+a,p+d),l.lineTo(u+a,p+r-d),l.quadraticCurveTo(u+a,p+r,u+a-d,p+r),l.lineTo(u+d,p+r),l.quadraticCurveTo(u,p+r,u,p+r-d),l.lineTo(u,p+d),l.quadraticCurveTo(u,p,u+d,p),l.closePath(),l.clip(),o.draw(0,0,c),!0},Jh={drawCircle:qh,drawBorder:Zh},Qh=(i,e)=>{const{fractionalDigits:t=0,startAbbreviate:s=1e3,abbreviateStep:n=3,maxLength:a=-1,removeLastZero:r=!0,suffixes:c=["","k","m","b","t","q"]}=e||{},o=a===-1?99999999:a;if(i>=s){const u=Math.floor(i/10**n),p=Math.floor((u.toString().length-1)/n)+1,g=(i/(10**n)**p).toFixed(t),y=o-c[p].length,f=g.substring(0,y);return(r?fa(f):f)+c[p]}const l=i.toFixed(t),h=o-c[0].length,d=l.substring(0,h);return r?fa(d):d+c[0]},fa=i=>{if(i.indexOf(".")<0)return i;for(let e=i.length-1;e>=0;e--){if(i[e]==".")return i.substring(0,e);if(i[e]!="0")return i.substring(0,e+1)}return i},eu=(i,e,t="0")=>{let s=i.toString();const n=s.length;for(let a=0;a<e-n;a++)s=t+s;return s},tu=(i,e,t="0")=>{let s=i.toString();const n=s.length;for(let a=0;a<e-n;a++)s=s+t;return s},su={toAbbreviatedString:Qh,padStart:eu,padEnd:tu},iu=()=>{const i=navigator.userAgent;return/Windows|Mac OS/i.test(i)&&!/like Mac OS/.test(i)},nu=()=>{const i=navigator.userAgent;return/Android|iP[ao]d|iPhone/i.test(i)},au=()=>FBInstant.getPlatform()==="ANDROID",ru=()=>FBInstant.getPlatform()==="IOS",ou=()=>FBInstant.getPlatform()==="MOBILE_WEB",cu=()=>Math.round(window.devicePixelRatio)||1,lu={isDesktop:iu,isMobile:nu,isAndroid:au,isIOS:ru,isMobileWeb:ou,pixelRatio:cu},Xr={Array:ah,Hash:Sh,Html:Ih,Json:wh,Object:Oh,String:Yh,Valid:Xh,Image:Jh,Number:su,Device:lu};function qr(i){return Object.prototype.toString.call(i).slice(8,-1)}function Hs(i){if(qr(i)!=="Object")return!1;const e=Object.getPrototypeOf(i);return e.constructor===Object&&e===Object.prototype}function Ea(i){return qr(i)==="Symbol"}function ya(i,e,t,s){const n={}.propertyIsEnumerable.call(s,e)?"enumerable":"nonenumerable";n==="enumerable"&&(i[e]=t),n==="nonenumerable"&&Object.defineProperty(i,e,{value:t,enumerable:!1,writable:!0,configurable:!0})}function Zr(i,e,t){if(!Hs(e))return e;let s={};if(Hs(i)){const c=Object.getOwnPropertyNames(i),o=Object.getOwnPropertySymbols(i);s=[...c,...o].reduce((l,h)=>{const d=i[h];return(!Ea(h)&&!Object.getOwnPropertyNames(e).includes(h)||Ea(h)&&!Object.getOwnPropertySymbols(e).includes(h))&&ya(l,h,d,i),l},{})}const n=Object.getOwnPropertyNames(e),a=Object.getOwnPropertySymbols(e);return[...n,...a].reduce((c,o)=>{let l=e[o];const h=Hs(i)?i[o]:void 0;h!==void 0&&Hs(l)&&(l=Zr(h,l,t));const d=t?t(h,l,o):l;return ya(c,o,d,e),c},s)}function Ce(i,...e){return e.reduce((t,s)=>Zr(t,s),i)}const hu={ENV:"development",AppId:"",PlayerDataStoreUsingApi:!1,ApiHost:"",OtherHost:"",Notification:{Enable:!0,DisableSendNotification:!0,ApiUrl:"https://nostra-notifications.suncs.io",GameTitle:"Sun Studio",GameImage:""},PlayerMock:{id:"",signature:""},OpponentMock:{id:"",signature:""},MatchMockFailRate:5,Gameplay:{StartLevel:1,StartScore:0,StartDiamonds:0,DefaultDiamondsForNewUser:300,LevelDifficultRate:{FromUnder30:1.07,FromUnder35:1.05,FromUnder45:1.05,FromUnder200:1.1},StartAdAtLevel:2,GiftTime:10800,AwardDiamonds:100,FreeItems:!1,DelayStart:2e3,DelayLevelUp:1800,DelayFinishGame:2900,EnableVibrate:!0},Tutorial:{ForceUseTutorial:!1,NumberOfTutorial:{FirstMove:3,TargetScore:1,CurrentScore:1,ColorfulGem:1,ItemPaint:1,ItemHammer:1,ItemShuffle:1}},PlayerDataStore:"PlayerData.PopJewels",Game:{AutoResize:!0,PortraitRatio:375/667,PortraitWidth:375,PortraitHeight:667,LandscapeRatio:760/450,LandscapeWidth:760,LandscapeHeight:500,ForcePixelRatio:0,DisableLandscape:!0,FullSizeOnLandscape:!1},Debugger:{ShowInspector:!1,ShowMonitoring:!1,ShowConsole:!1,Expanded:!0,AutoRefresh:!0,InspectorAutoUpdate:!0,Opacity:.8},Statistics:{Enable:!1,DisplayMode:0,FPS:!0,MS:!0,MB:!0,Opacity:.8,ShowFPSInGame:!0,ShowMemoryInGame:!1},ParticleEditor:{Enable:!1,Opacity:.8,Expanded:!0},ProfilerPlugin:{Enable:!1},Match:{MaxRescueCount:1,RescueGamePopupTimeout:15,ContinueSingleMatchEnabled:!1,SingleMatchStore:"singleMatch",LocalSingleMatchDefault:{_id:"12345678890",status:"open",playerId:"",score:0,level:1,startedAt:0,updateAt:0,finishAt:0,data:{}}},DailyRewards:{MaxDays:6,MockTime:0,CheckInterrupt:!0},DailyTasks:{Duration:86400},Tournament:{UseMock:!1,ForcePlay:!1,UseLeaderboard:!1,TournamentContextIds:[]},LeadersBoard:{Name:null,UseMock:!1,Prefix:"leaderboards",LeaderboardId:"",Limit:50},LanguageSupport:{en:"en"},EnableEffectSceneTransition:!1,DefaultTheme:"default",ThemeSupport:{default:"default"},Ads:{Enabled:!0,CalculateSafeAreaBottom:!0,EnableRewardVideoResetInterstitial:!1,Mockup:{Enable:!1,ErrorRate:5,GiphyApiKey:""},InterstitialAdOptions:{pID:"",showWhenStartGame:!1,secondsFirstTime:0,secondsBetweenAds:90},RewardAdOptions:{pID:"",secondsFirstTime:0,secondsBetweenAds:0},BannerAdOptions:[{placementId:"1",bannerHeight:50,platform:"MOBILE",secondsReload:0},{placementId:"2",bannerHeight:50,platform:"DESKTOP",secondsReload:0}]},Network:{MaximumRequest:6,Timeout:15e3,Retries:3},Analytics:{GoogleAnalytics:{consoleLog:!1},FacebookAnalytics:{prefix:"fba",consoleLog:!1}},Sentry:{errorCodes:{accepted:[],ignored:["USER_INPUT","NETWORK_FAILURE"]},errorMessages:{accepted:[],ignored:["Load image failed"]}},Rollbar:{Enable:!1,UseMockup:!1,FilterError:{Codes:{accepted:[],ignored:["USER_INPUT","NETWORK_FAILURE"]},Messages:{accepted:[],ignored:["Load image failed","Request failed to be processed"]}},ListPlayerDevIds:[]},Performance:{Enable:!1,trackingSceneKeys:["DASHBOARD_SCENE","GAME_SCENE"],minQuality:1,maxQuality:2,fpsThreshold:48,checkInterval:2e3,qualityAdjustStep:.1,autoUpgradeQuality:!0,onlyUpdateWhenSwitchScene:!0}},uu={AppId:"363448398316789"},du={ENV:"development",Notification:{Enable:!1},Ads:{Enabled:!0,Mockup:{Enable:!1,ErrorRate:5,GiphyApiKey:"VmjHIRsfrwCAssDS4mDo9DoImxJm1lLM"},RewardAdOptions:{pID:"123"},InterstitialAdOptions:{pID:"456"},BannerAdOptions:[{placementId:"789",bannerHeight:50,platform:"MOBILE",secondsReload:0},{placementId:"012",bannerHeight:50,platform:"DESKTOP",secondsReload:0}]},Analytics:{GoogleAnalytics:null,FacebookAnalytics:null},Statistics:{ShowFPSInGame:!0},Tournament:{UseMock:!0}},pu={AppId:"363448398316789"},mu={ENV:"production",ApiHost:"",OtherHost:"",Notification:{Enable:!1},LeadersBoard:{Prefix:"leaderboards",LeaderboardId:""},Debugger:{ShowConsole:!1,ShowInspector:!1,ShowMonitoring:!1},Statistics:{Enable:!1,ShowFPSInGame:!1,ShowMemoryInGame:!1}};let ze=hu;const gu="production";switch(gu){case"development":ze=Ce({...ze},du),ze=Ce({...ze},uu);break;case"production":ze=Ce({...ze},mu),ze=Ce({...ze},pu);break}const Jr=ze,fu=i=>e=>{try{const{game:t}=window,{module:s}=e;if(t.scene.getScenes(!0)[0].scene.key!==i)return;const r=s.default;t.scene.remove(i),t.scene.add(i,r,!0),t.scene.bringToTop(t.globalScene),console.log("%c HotScene: ","font-size:12px;background-color: #465975;color:#fff;",i)}catch{}};function hi(i,e,t){var s,n,a;e===void 0&&(e=50),t===void 0&&(t={});var r=(s=t.isImmediate)!=null&&s,c=(n=t.callback)!=null&&n,o=t.maxWait,l=Date.now(),h=[];function d(){if(o!==void 0){var p=Date.now()-l;if(p+e>=o)return o-p}return e}var u=function(){var p=[].slice.call(arguments),m=this;return new Promise(function(g,y){var f=r&&a===void 0;if(a!==void 0&&clearTimeout(a),a=setTimeout(function(){if(a=void 0,l=Date.now(),!r){var S=i.apply(m,p);c&&c(S),h.forEach(function(I){return(0,I.resolve)(S)}),h=[]}},d()),f){var E=i.apply(m,p);return c&&c(E),g(E)}h.push({resolve:g,reject:y})})};return u.cancel=function(p){a!==void 0&&clearTimeout(a),h.forEach(function(m){return(0,m.reject)(p)}),h=[]},u}let Cs=!1;const Eu=(i,e=Cs)=>t=>{try{const{game:s}=window,{module:n}=t;let r=s.scene.getScenes(!0)[0];if(r.scene.key!==i)return;Cs=e;const c=n.default,o=`${i}-draft`;s.scene.remove(o);const l=s.scene.add(o,c);console.log("%c HotSceneObjects: ","font-size:12px;background-color: #465975;color:#fff;",i),r=s.scene.getScene(i),l.events.once(Phaser.Scenes.Events.RENDER,hi(()=>{const h=l.children.getAll();Qr(r,h),s.scene.remove(o)}),50),s.scene.run(o),s.scene.bringToTop(r),s.scene.bringToTop(s.globalScene)}catch(s){console.warn(s)}},Qr=(i,e,t)=>{e.forEach(s=>{if(!s.name)return;let n=null;if(t?n=t.getByName(s.name):n=i.children.getByName(s.name),Cs&&console.log("%c Checking object: ","font-size:12px;background-color: #465975;color:#fff;",s.name,s.type),!n)return;if(s.type==="Container"){const o=s,l=n,h=o.getAll();if(Qr(i,h,l),!l.hotContainer)return;console.log("%c Update container: ","font-size:12px;background-color: #33A5FF;color:#fff;",l.name)}const a=Reflect.ownKeys(s),r=["_events","_sysEvents","input","localTransform","list","displayList"],c=a.filter(o=>{if(typeof o!="string"||r.indexOf(o)>=0||!n)return!1;const l=Reflect.get(s,o);if(l instanceof Function||l instanceof Phaser.Scene||l instanceof Phaser.GameObjects.Group||l instanceof Phaser.GameObjects.GameObject)return!1;const h=Reflect.get(n,o);return l===h});c.length<1||(Cs&&console.log("%c HotObject: ","font-size:12px;background-color: #2EAFB0;color:#fff;",s.name,c),c.forEach(o=>{if(!n)return;const l=Reflect.get(s,o),h=Reflect.get(n,o),d=Reflect.set(n,o,l);Cs&&console.log("%c Update property: ","font-size:12px;background-color: #B03734;color:#fff;",d,o,{oldValue:h,newValue:l})}))})},yu={Scene:fu,SceneObjects:Eu},Su={Configs:Jr,Utils:Xr,LiveUpdate:yu};window.GameCore=Su;const Au="production";console.warn(Au,{Configs:Jr,isDebugger:Xr.Valid.isDebugger()});const Tu="null",Iu=Tu!=="null",bu=()=>{const i=setInterval(()=>{window.Sentry&&(clearInterval(i),console.warn({isSentryEnabled:Iu}))},100)},ui=(i,e)=>{window.Sentry&&window.Sentry.addBreadcrumb({category:i,message:e})},wu=i=>{window.Sentry&&window.Sentry.setUser(i)},Cu=i=>{{console.error(i);return}},j=i=>{i&&Cu(i)},vu="modulepreload",_u=function(i,e){return new URL(i,e).href},Sa={},ls=function(e,t,s){if(!t||t.length===0)return e();const n=document.getElementsByTagName("link");return Promise.all(t.map(a=>{if(a=_u(a,s),a in Sa)return;Sa[a]=!0;const r=a.endsWith(".css"),c=r?'[rel="stylesheet"]':"";if(!!s)for(let h=n.length-1;h>=0;h--){const d=n[h];if(d.href===a&&(!r||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${c}`))return;const l=document.createElement("link");if(l.rel=r?"stylesheet":vu,r||(l.as="script",l.crossOrigin=""),l.href=a,document.head.appendChild(l),r)return new Promise((h,d)=>{l.addEventListener("load",h),l.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>e())},z={BUTTON_CLICK:"button_click",SCREEN_OPEN:"screen_open",LOAD_START:"load_start",LOAD_COMPLETE:"load_complete",APP_READY:"app_ready",TUTORIAL_BEGIN:"tutorial_begin",TUTORIAL_STEP:"tutorial_step",TUTORIAL_COMPLETE:"tutorial_complete",MATCH_START:"match_start",MATCH_RESCUE:"match_rescue",MATCH_END:"match_end",LEVEL_START:"level_start",LEVEL_RESCUE:"level_rescue",LEVEL_END:"level_end",SHARE:"share",MESSAGE:"message",INVITE:"invite",SHORTCUT_CREATE:"shortcut_create",SHORTCUT_CREATE_POPUP:"shortcut_create_popup",BOT_SUBSCRIBE:"bot_subscribe",BOT_SUBSCRIBE_POPUP:"bot_subscribe_popup",AD_SHOW:"ad_show",AD_SHOW_FAILED:"ad_show_failed",NEW_USER:"new_user",AD_IMPRESSION:"ad_impression",JOIN_GROUP:"join_group",TOURNAMENT_SHARE:"tournament_share",TOURNAMENT_CREATE:"tournament_create",TOURNAMENT_POST_SCORE:"tournament_post_score",GLANCE_GAME_LOAD:"game_load",GLANCE_GAME_START:"game_start",GLANCE_GAME_REPLAY:"game_replay",GLANCE_GAME_LEVEL:"game_level",GLANCE_GAME_END:"game_end",GLANCE_GAME_LEVEL_COMPLETED:"level_completed",GLANCE_REWARDED_AD:"rewarded_ad",GLANCE_GAME_MILESTONE:"game_milestone",GLANCE_GAME_LIFE_END:"game_life_end",GLANCE_INGAME_TRANSACTIONS:"ingame_transactions"},eo=()=>GameCore.Utils.Device.isDesktop()||GameCore.Utils.Device.pixelRatio()>1?2:1,Ou=eo(),fe={AVATAR:{KEY:"avatar",FILE:"./assets/images/others/avatar.png",CONFIG:{}},ICON_EARTH:{KEY:"icon-earth",FILE:"./assets/images/others/icon-earth.png",CONFIG:{}},BACKGROUND:{KEY:"background",FILE:`./assets/images/${Ou}x/bg.jpg`,CONFIG:{}}};class Ht{playerId;name;photo;locale;constructor(e,t,s,n){this.playerId=e,this.name=t,this.photo=s||fe.AVATAR.FILE,this.locale=n||"en_US"}toObject(){return{playerId:this.playerId,name:this.name,photo:this.photo,locale:this.locale}}}const wn=i=>new Promise(e=>setTimeout(e,i)),hn=i=>{const e=new Date(i),t=new Date;return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()},to=(i,e=!0)=>{const t=new Date(i).toISOString();return e?t.slice(11,-5):t.slice(14,-5)},{Notification:Ru}=GameCore.Configs,{GameTitle:Pu,GameImage:Du}=Ru;class Mu{async createAsync(e){return await GameSDK.tournament.createAsync(e)}async shareAsync(e){await GameSDK.tournament.shareAsync(e)}async joinAsync(e){return await GameSDK.tournament.joinAsync(e)}async postScoreAsync(e){await GameSDK.tournament.postScoreAsync(e)}async getTournamentsAsync(){return await GameSDK.tournament.getTournamentsAsync()}}class Lu{facebook;isCalledSubscribeBot=!1;isCalledCreateShortcut=!1;constructor(e){this.facebook=e}async switchAsync(e){await GameCore.Utils.Valid.isValueChangeAsync(window.__fbGameReady,!0),await GameSDK.context.switchAsync(e)}async chooseAsync(){try{return await GameCore.Utils.Valid.isValueChangeAsync(window.__fbGameReady,!0),await GameSDK.context.chooseAsync({filters:["INCLUDE_EXISTING_CHALLENGES"],minSize:2,maxSize:2}),GameSDK.context.getID()}catch(e){if(e instanceof Object&&GameCore.Utils.Object.hasOwn(e,"code"))switch(e.code){case"USER_INPUT":return!1;case"SAME_CONTEXT":return GameSDK.context.getID()}return null}}async createAsync(e){try{return await GameCore.Utils.Valid.isValueChangeAsync(window.__fbGameReady,!0),await GameSDK.context.createAsync(`${e}`),GameSDK.context.getID()}catch(t){if(t instanceof Object&&GameCore.Utils.Object.hasOwn(t,"code"))switch(t.code){case"USER_INPUT":return!1;case"SAME_CONTEXT":return GameSDK.context.getID()}return null}}async getPlayerToken(){return(await GameSDK.player.getSignedPlayerInfoAsync()).getSignature()}async getContextPlayers(e){try{const t=await GameSDK.context.getPlayersAsync(),s=[];return t.forEach(n=>{const a=n.getID();if(a===e)return;const r=n.getName();if(!r)return;const c=n.getPhoto();s.push(new Ht(a,r,c).toObject())}),GameCore.Utils.Array.unique(s)}catch(t){return console.warn("getPlayersAsync",{error:t}),[]}}async shareAsync(e){await GameSDK.shareAsync(e)}async sendMessage(e){}async inviteAsync(e){}async postSessionScoreAsync(e){await GameSDK.postSessionScoreAsync(e)}async getRewardedVideoAsync(e){return await GameSDK.getRewardedVideoAsync(e)}async getInterstitialAdAsync(e){return await GameSDK.getInterstitialAdAsync(e)}getContextID(){return GameSDK.context.getID()}async attemptToAddShortcut(){if(this.isCalledCreateShortcut)return!1;try{if(GameSDK.getPlatform()==="ANDROID")return!1;const s=(await GameSDK.player.getDataAsync(["lastCallCreateShortcut"])||{}).lastCallCreateShortcut;if(s&&hn(+s))return!1;const n=Date.now();if(GameSDK.player.setDataAsync({lastCallCreateShortcut:n}),!GameSDK.getSupportedAPIs().includes("canCreateShortcutAsync"))return!1;if(await GameSDK.canCreateShortcutAsync()){const{SHORTCUT_CREATE:c,SHORTCUT_CREATE_POPUP:o}=z;this.isCalledCreateShortcut=!0,window.game.analytics.event(o);try{return await GameCore.Utils.Valid.isValueChangeAsync(window.__fbGameReady,!0),await GameSDK.createShortcutAsync(),window.game.analytics.event(c,{success:!0}),!0}catch{return window.game.analytics.event(c,{success:!1}),!1}}return!1}catch{return!1}}async attemptToSubscribeBot(){if(this.isCalledSubscribeBot)return!1;try{if(!GameSDK.getSupportedAPIs().includes("player.canSubscribeBotAsync"))return!1;if(await GameSDK.player.canSubscribeBotAsync()){const n=(await GameSDK.player.getDataAsync(["lastCallSubscribeBot"])||{}).lastCallSubscribeBot;if(n&&hn(+n))return!1;const a=Date.now();GameSDK.player.setDataAsync({lastCallSubscribeBot:a});const{BOT_SUBSCRIBE:r,BOT_SUBSCRIBE_POPUP:c}=z;this.isCalledSubscribeBot=!0,window.game.analytics.event(c);try{return await GameCore.Utils.Valid.isValueChangeAsync(window.__fbGameReady,!0),await GameSDK.player.subscribeBotAsync(),window.game.analytics.event(r,{success:!0}),!0}catch{return window.game.analytics.event(r,{success:!1}),!1}}return!1}catch{return!1}}async matchPlayerAsync(e,t,s){try{return!GameSDK.getSupportedAPIs().includes("checkCanPlayerMatchAsync")||!await GameSDK.checkCanPlayerMatchAsync()?!1:(await GameSDK.matchPlayerAsync(e,t,s),!0)}catch{return!1}}setLoadingProgress(e){GameSDK.setLoadingProgress(e)}getLocale(){return GameSDK.getLocale()||"en"}async injectTournament(){this.facebook.tournament=new Mu,this.facebook.getTournamentAsync=this.getTournamentAsync,this.facebook.requestTournamentAsync=this.requestTournamentAsync}async getTournamentAsync(){return await GameSDK.getTournamentAsync()}requestTournamentAsync=async e=>{try{await this.facebook.getTournamentAsync(),await this.facebook.tournament.shareAsync({score:e})}catch{const s=GameSDK.player.getName();await this.facebook.tournament.createAsync({initialScore:e,config:{tournamentTitle:`${s}'s Tournament`}})}};async sendNotificationAsync(e){try{const{message:t,delayTime:s}=e;await GameSDK.graphApi.requestAsync("/me/notifications","POST",{message:JSON.stringify({title:Pu,body:t,media_url:Du}),schedule_interval:s})}catch(t){console.warn("🤖 ? sendNotificationAsync",t)}}}let Aa=0,Me=0;class xu{game;progressFbTimeEvent;constructor(e){this.game=e}loadingProgressFbBootScene(){let n=100;Me=30;const a=()=>{if(n<=0){clearTimeout(this.progressFbTimeEvent);return}this.progressFbTimeEvent=setTimeout(()=>{this.game.facebook.setLoadingProgress(Math.round(Me)),Me+=30/n,n--,a()},50)};a()}finishLoadingProgressFbBootScene(){clearTimeout(this.progressFbTimeEvent)}loadingProgressFbLoadScene(){(!Me||Me<30)&&(Me=60),Aa=Me;const t=()=>{this.progressFbTimeEvent=setTimeout(()=>{this.game.facebook.setLoadingProgress(Math.round(Me)),Me+=.1,t()},50)};t()}onProgress(e){const t=100-Me,s=Math.round(e*t+Me);s>Aa&&clearTimeout(this.progressFbTimeEvent),this.game.facebook.setLoadingProgress(s)}}class Nu{addKillRevive(){[Phaser.GameObjects.Container,Phaser.GameObjects.Image,Phaser.GameObjects.Sprite,Phaser.GameObjects.Graphics,Phaser.GameObjects.Text,Phaser.GameObjects.BitmapText,Phaser.GameObjects.Particles.ParticleEmitter,Phaser.GameObjects.Particles.ParticleEmitterManager].forEach(e=>{e.prototype.kill=this.kill,e.prototype.revive=this.revive})}addKillReviveGroup(){Phaser.GameObjects.Group.prototype.killGroup=this.killGroup,Phaser.GameObjects.Group.prototype.reviveGroup=this.reviveGroup}addSetWorldSize(){[Phaser.GameObjects.Image,Phaser.GameObjects.Sprite].forEach(e=>{e.prototype.setWorldSize=this.setWorldSize})}addSetWorldSizeForContainer(){[Phaser.GameObjects.Container].forEach(e=>{e.prototype.setWorldSize=this.setWorldSizeForContainer})}addGetWorldPosition(){[Phaser.GameObjects.Container,Phaser.GameObjects.Image,Phaser.GameObjects.Sprite,Phaser.GameObjects.Graphics,Phaser.GameObjects.Text,Phaser.GameObjects.BitmapText].forEach(e=>{e.prototype.getWorldPosition=this.getWorldPosition})}addDrawDebugBox(){[Phaser.GameObjects.Container,Phaser.GameObjects.Image,Phaser.GameObjects.Sprite,Phaser.GameObjects.Graphics,Phaser.GameObjects.Text,Phaser.GameObjects.BitmapText,Phaser.GameObjects.Zone].forEach(e=>{e.prototype.drawDebugBox=this.drawDebugBox})}addHighQuality(){[Phaser.GameObjects.Text].forEach(e=>{e.prototype.setHighQuality=this.setHighQuality})}kill(){this.setActive(!1),this.setVisible(!1)}revive(){this.setActive(!0),this.setVisible(!0)}killGroup(){this.getChildren().forEach(e=>{e.setActive(!1),e.setVisible(!1)})}reviveGroup(){this.getChildren().forEach(e=>{e.setActive(!0),e.setVisible(!0)})}setWorldSize(e,t){this.setSize(e,t),this.setDisplaySize(e,t)}setWorldSizeForContainer(e,t,s=2){this.setSize(e*s,t*s),this.setDisplaySize(e,t)}getWorldPosition(){const e=this.getWorldTransformMatrix(),{translateX:t,translateY:s}=e.decomposeMatrix();return{x:t,y:s}}drawDebugBox(e,t){const{x:s,y:n,width:a,height:r,depth:c,originX:o,originY:l}=this,h=this.scene.add.rectangle(s,n,a,r,e,t);h.setName("Debug Box"),h.setDepth(c);const{isNumber:d}=GameCore.Utils.Valid;return d(o)&&d(l)&&h.setOrigin(o,l),h}setHighQuality(){return this.renderer instanceof Phaser.Renderer.WebGL.WebGLRenderer?this.setResolution(this.scene.game.world.getZoomRatio()*2):this}}const un={LOADED:"loaded",DISPLAYED:"displayed"};var so=(i=>(i.IDLE="idle",i.LOADING="loading",i.FILLED="filled",i.SHOWING="showing",i))(so||{});const io=so;var no=(i=>(i.REWARDED="rewarded",i.INTERSTITIAL="interstitial",i))(no||{});const Le=no;class yt extends Error{code;constructor(e,t){super(t),this.code=e,this.message=t}}class ku{type;status;constructor(e){this.type=e,this.status=io.IDLE}}GameCore.Ads={Types:Le,Status:io,Events:un,AdError:yt,AdInstance:ku};class Gu extends Phaser.Plugins.BasePlugin{events;enabled;config;lastInterAdShownTime;lastRewardAdShownTime;interstitial;rewardedVideo;safeAreaBottom;showingBannerAd;reloadBannerAdIntervals;bannerAdConfig;isHaveBannerAdOptions;init(){this.events=new Phaser.Events.EventEmitter,this.safeAreaBottom=0,this.lastInterAdShownTime=0,this.lastRewardAdShownTime=0,this.showingBannerAd={},this.reloadBannerAdIntervals={},this.isHaveBannerAdOptions=!0}calculateSafeAreaBottom(){try{if(!this.config.calculateSafeAreaBottom)return;this.safeAreaBottom=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--sab")),isNaN(this.safeAreaBottom)&&(this.safeAreaBottom=0)}catch{this.safeAreaBottom=0}}configure(e,t){this.enabled=t.enabled,this.config=t;const{bannerAdOptions:s}=this.config;s.length===0&&(this.isHaveBannerAdOptions=!1),this.setAdInstance(e),this.calculateSafeAreaBottom()}setAdInstance(e){const{rewardAdOptions:t,interstitialAdOptions:s}=this.config;this.interstitial=new e(Le.INTERSTITIAL,t.pID),this.rewardedVideo=new e(Le.REWARDED,s.pID)}async preloadInterstitialAdAsync(){console.log("preloading Interstitial"),await this.preloadAdAsync(Le.INTERSTITIAL)}async showInterstitialAdAsync(){if(!this.canbeShowInterstitialAd())throw new yt("INTERSTITIAL_AD_CAN_NOT_SHOW","Can't show interstitial ad");await this.showAdAsync(Le.INTERSTITIAL)}async preloadRewardedVideoAsync(){console.log("preloading RewardedVideo"),await this.preloadAdAsync(Le.REWARDED)}async showRewardedVideoAsync(){if(!this.canbeShowRewardAd())throw new yt("REWARDED_VIDEO_CAN_NOT_SHOW","Can't show rewarded video");await this.showAdAsync(Le.REWARDED),this.lastRewardAdShownTime=window.performance.now()/1e3}getRemainingRewardTime(){const e=window.performance.now()/1e3,{secondsBetweenAds:t}=this.config.rewardAdOptions,s=e-this.lastRewardAdShownTime;return s<t?t-s:0}async preloadAdAsync(e){if(!this.enabled)throw new yt("ADS_NOT_ENABLED","Ads is't enabled");const t=this.getAdInstanceByType(e);if(t===null)throw new yt("AD_INSTANCE_NOT_INITIALLED","The instance ads not yet initiated");await t.loadAsync(),this.events.emit(un.LOADED,e)}async showAdAsync(e){if(!this.enabled)throw new yt("ADS_NOT_ENABLED","Ads is't enabled");const t=this.getAdInstanceByType(e);if(t===null)throw new yt("AD_INSTANCE_NOT_INITIALLED","The instance ads not yet initiated");if(e===Le.INTERSTITIAL&&(this.lastInterAdShownTime=window.performance.now()/1e3),e===Le.REWARDED){this.lastRewardAdShownTime=window.performance.now()/1e3;const{enableRewardVideoResetInterstitial:s}=this.config;s&&(this.lastInterAdShownTime=this.lastRewardAdShownTime)}await t.showAsync(),this.events.emit(un.DISPLAYED,e)}getAdStatus(e){const t=this.getAdInstanceByType(e);return t?t.getStatus():null}getAdInstanceByType(e){switch(e){case Le.INTERSTITIAL:return this.interstitial;case Le.REWARDED:return this.rewardedVideo;default:return null}}canbeShowInterstitialAd(){return this.canbeShowInterstitialAdByTime()}canbeShowInterstitialAdByTime(){const e=window.performance.now()/1e3,{secondsFirstTime:t,secondsBetweenAds:s}=this.config.interstitialAdOptions,n=Math.floor(e-this.lastInterAdShownTime);return this.lastInterAdShownTime>0?n>=s:n>=t}canbeShowRewardAd(){const e=window.performance.now()/1e3,{secondsFirstTime:t,secondsBetweenAds:s}=this.config.rewardAdOptions,n=Math.floor(e-this.lastRewardAdShownTime);return this.lastRewardAdShownTime>0?n>=s:n>=t}canShowBannerAd(){if(!this.isHaveBannerAdOptions)return!1;const{bannerAdOptions:e}=this.config,t=GameCore.Utils.Device.isDesktop();for(let s=0;s<e.length;s++){const n=e[s],a=n.platform;if(a=="ALL"||a=="DESKTOP"&&t||a=="MOBILE"&&!t)return this.bannerAdConfig=n,!0}return!1}async showBannerAdAsync(){if(!this.enabled||!this.canShowBannerAd())return;this.reloadBannerAdIntervals=this.reloadBannerAdIntervals||{};const{placementId:e,secondsReload:t}=this.bannerAdConfig;if(!(!e||e=="")){if(t>0){if(this.reloadBannerAdIntervals[e])return;this.loadBannerAdAsync(e),this.reloadBannerAdIntervals[e]=setInterval(()=>{this.loadBannerAdAsync(e)},t*1e3);return}this.loadBannerAdAsync(e)}}async loadBannerAdAsync(e){if(this.enabled)try{if(!this.enabled)return;await GameSDK.loadBannerAdAsync(e),this.showingBannerAd[e]=!0}catch(t){console.log(t)}}async hideBannerAdAsync(){if(this.enabled&&this.isHaveBannerAdOptions)try{if(!this.enabled)return;const{bannerAdOptions:e}=this.config;e.forEach(t=>{const{placementId:s}=t,n=this.reloadBannerAdIntervals[s];n&&(clearInterval(n),this.reloadBannerAdIntervals[s]=null),this.showingBannerAd[s]=!1}),await GameSDK.hideBannerAdAsync()}catch(e){console.log(e)}}getBannerHeight(){if(!this.enabled||!this.canShowBannerAd())return 0;const{bannerHeight:e=0}=this.bannerAdConfig||{},t=e+this.safeAreaBottom;if(this.game.world){const s=this.game.world,n=s.getPixelRatio(),a=s.getZoomRatio(),r=s.getScreenHeight()*.01;return this.game.world.getPhysicPixels(t+r,n/a)}return t}}class Bu{name;color;selfLog;options;constructor(e,t,s){this.name=e,this.color=s||"#FFF",this.options=t,this.selfLog=!0,console.info(`%c${this.name}: init`,`color: ${this.color}`,this.options)}event(e,t,s){this.processEvent(e,t,s),this.selfLog&&console.info(`%c${this.name}: event`,`color: ${this.color}`,{name:e,value:s,payload:t})}pageview(e){const t=this.getPageByKey(e);this.processPageView(t),this.selfLog&&console.info(`%c${this.name}: pageview`,`color: ${this.color}`,{page:t})}levelStart(e,t,s){this.processLevelStart(e,t,s),this.selfLog&&console.info(`%c${this.name}: level start`,`color: ${this.color}`,{level:e,score:t,levelName:s})}levelFail(e,t,s){this.processLevelFail(e,t,s),this.selfLog&&console.info(`%c${this.name}: level fail`,`color: ${this.color}`,{level:e,score:t,levelName:s})}levelRescue(e,t,s){this.processLevelRescue(e,t,s),this.selfLog&&console.info(`%c${this.name}: level rescue`,`color: ${this.color}`,{level:e,score:t,levelName:s})}levelComplete(e,t,s){this.processLevelComplete(e,t,s),this.selfLog&&console.info(`%c${this.name}: level complete`,`color: ${this.color}`,{level:e,score:t,levelName:s})}showInterstitialAd(e){this.processShowInterstitialAd(e),this.selfLog&&console.info(`%c${this.name}: show interstitial ad`,`color: ${this.color}`,{placement:e})}showRewardedVideoAd(e){this.processShowRewardedVideoAd(e),this.selfLog&&console.info(`%c${this.name}: show rewarded video ad`,`color: ${this.color}`,{placement:e})}receiveReward(e){this.processReceiveReward(e),this.selfLog&&console.info(`%c${this.name}: receive reward`,`color: ${this.color}`,{placement:e})}showAdFail(e,t,s){this.processShowAdFail(e,t,s),this.selfLog&&console.info(`%c${this.name}: show ad fail`,`color: ${this.color}`,{type:e,placement:t,reason:s})}gameMilestone(e,t,s,n){this.processGameMilestone(e,t,s,n),this.selfLog&&console.info(`%c${this.name}: game milestone`,`color: ${this.color}`,{type:e,meta:t,level:s,score:n})}gameLifeEnd(e,t,s){this.processGameLifeEnd(e,t,s),this.selfLog&&console.info(`%c${this.name}: game life end`,`color: ${this.color}`,{remainingLife:e,level:t,score:s})}gameIngameTransactions(e,t,s,n){this.gameIngameTransactions(e,t,s,n),this.selfLog&&console.info(`%c${this.name}: ingame transaction`,`color: ${this.color}`,{transactionType:e,meta:t,level:s,score:n})}getPageByKey(e){let t=e.replace(/_/g,"-");return t=t.toLowerCase(),t}processLevelStart(e,t,s){}processLevelFail(e,t,s){}processLevelRescue(e,t,s){}processLevelComplete(e,t,s){}processShowInterstitialAd(e){}processShowRewardedVideoAd(e){}processReceiveReward(e){}processShowAdFail(e,t,s){}processGameMilestone(e,t={},s=0,n=0){}processGameLifeEnd(e,t=0,s=0){}processIngameTransactions(e,t={},s=0,n=0){}}GameCore.Analytics={BaseAnalytics:Bu};class Uu extends Phaser.Plugins.BasePlugin{analytics;init(){this.analytics=[]}add(e){this.analytics.push(e)}pageview=e=>{this.isActive()&&this.analytics.forEach(t=>{t.pageview(e)})};event(e,t,s){this.isActive()&&this.analytics.forEach(n=>{n.event(e,t,s)})}levelStart(e,t,s){this.isActive()&&this.analytics.forEach(n=>{n.levelStart(e,t,s)})}levelRescue(e,t,s){this.isActive()&&this.analytics.forEach(n=>{n.levelRescue(e,t,s)})}levelFail(e,t,s){this.isActive()&&this.analytics.forEach(n=>{n.levelFail(e,t,s)})}levelComplete(e,t,s){this.isActive()&&this.analytics.forEach(n=>{n.levelComplete(e,t,s)})}showInterstitialAd(e){this.isActive()&&this.analytics.forEach(t=>{t.showInterstitialAd(e)})}showRewardedVideoAd(e){this.isActive()&&this.analytics.forEach(t=>{t.showRewardedVideoAd(e)})}receiveReward(e){this.isActive()&&this.analytics.forEach(t=>{t.receiveReward(e)})}showAdFail(e,t,s){this.isActive()&&this.analytics.forEach(n=>{n.showAdFail(e,t,s)})}gameMilestone(e,t,s,n){this.isActive()&&this.analytics.forEach(a=>{a.gameMilestone(e,t,s,n)})}gameLifeEnd(e,t,s){this.isActive()&&this.analytics.forEach(n=>{n.gameLifeEnd(e,t,s)})}gameIngameTransactions(e,t,s,n){this.isActive()&&this.analytics.forEach(a=>{a.gameIngameTransactions(e,t,s,n)})}isActive(){return this.analytics.length>=1}}class Ta{name;game;isSprite;audio;markers;volume;constructor(e,t,s){this.name=t,this.game=e,this.markers={},this.isSprite=s,this.isSprite||(this.audio=this.game.sound.add(this.name))}play(e,t){const s={volume:this.volume,...t||{}};if(s.volume!==this.volume&&(s.volume*=this.volume),!this.isSprite){if(this.audio?.seek>0){this.audio.resume();return}this.audio?.play(e,s);return}this.createMaker(e),this.markers[e]?.play(e,s)}pause(e){if(!this.isSprite){this.audio?.pause();return}this.markers[e]?.pause()}stop(e){if(!this.isSprite){this.audio?.stop();return}this.markers[e]?.stop()}setVolume(e){this.volume=e}isMusicEnabled=()=>{const{player:e}=this.game;return!!e.getPlayerSetting("music")};isSoundEnabled=()=>{const{player:e}=this.game;return!!e.getPlayerSetting("sound")};createMaker(e){if(!this.markers[e])try{this.markers[e]=this.game.sound.addAudioSprite(this.name)}catch(t){console.warn("createMaker",t)}}}class Fu extends Phaser.Plugins.BasePlugin{soundManager;musicManager;isMuteAll;initMusic=e=>{this.musicManager=new Ta(this.game,e,!1),this.setMusicVolume(this.isMuteAll?0:1)};initSound=e=>{this.soundManager=new Ta(this.game,e,!0),this.setSoundVolume(this.isMuteAll?0:1)};playSound(e,t){try{if(!this.soundManager||this.isMuteAll||!this.soundManager.isSoundEnabled())return;this.soundManager.play(e,t)}catch{}}stopSound(e){try{this.soundManager.stop(e)}catch{}}playMusic(e={}){try{if(!this.musicManager||this.isMuteAll||!this.musicManager.isMusicEnabled())return;this.musicManager.play("",{loop:!0,volume:.2,...e})}catch{}}pauseMusic(){try{if(!this.musicManager)return;this.musicManager.pause("")}catch{}}stopMusic(){try{if(!this.musicManager)return;this.musicManager.stop("")}catch{}}setSoundVolume(e){try{if(!this.soundManager)return;this.soundManager.setVolume(e)}catch(t){console.warn("setSoundVolume",t)}}setMusicVolume(e){try{if(!this.musicManager)return;this.musicManager.setVolume(e)}catch(t){console.warn("setMusicVolume",t)}}muteAll(){this.isMuteAll=!0,this.setMusicVolume(0),this.setSoundVolume(0),this.game.globalScene.sound.mute=!0}unmuteAll(e=1){this.isMuteAll=!1,this.setMusicVolume(e),this.setSoundVolume(e),this.game.globalScene.sound.mute=!1}}const ao="AUTH_TOKEN_REQUEST",ro="AUTH_TOKEN_RECEIVED";class Yu extends Error{payload;constructor(e,t){super(e),this.name="RequestTokenFail",this.message=e||"Request token fail",this.payload=t||{}}}var ti="NOT_FOUND";function Hu(i){var e;return{get:function(s){return e&&i(e.key,s)?e.value:ti},put:function(s,n){e={key:s,value:n}},getEntries:function(){return e?[e]:[]},clear:function(){e=void 0}}}function Vu(i,e){var t=[];function s(c){var o=t.findIndex(function(h){return e(c,h.key)});if(o>-1){var l=t[o];return o>0&&(t.splice(o,1),t.unshift(l)),l.value}return ti}function n(c,o){s(c)===ti&&(t.unshift({key:c,value:o}),t.length>i&&t.pop())}function a(){return t}function r(){t=[]}return{get:s,put:n,getEntries:a,clear:r}}var Wu=function(e,t){return e===t};function Ku(i){return function(t,s){if(t===null||s===null||t.length!==s.length)return!1;for(var n=t.length,a=0;a<n;a++)if(!i(t[a],s[a]))return!1;return!0}}function ju(i,e){var t=typeof e=="object"?e:{equalityCheck:e},s=t.equalityCheck,n=s===void 0?Wu:s,a=t.maxSize,r=a===void 0?1:a,c=t.resultEqualityCheck,o=Ku(n),l=r===1?Hu(o):Vu(r,o);function h(){var d=l.get(arguments);if(d===ti){if(d=i.apply(null,arguments),c){var u=l.getEntries(),p=u.find(function(m){return c(m.value,d)});p&&(d=p.value)}l.put(arguments,d)}return d}return h.clearCache=function(){return l.clear()},h}function zu(i){var e=Array.isArray(i[0])?i[0]:i;if(!e.every(function(s){return typeof s=="function"})){var t=e.map(function(s){return typeof s=="function"?"function "+(s.name||"unnamed")+"()":typeof s}).join(", ");throw new Error("createSelector expects all input-selectors to be functions, but received the following types: ["+t+"]")}return e}function $u(i){for(var e=arguments.length,t=new Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];var n=function(){for(var r=arguments.length,c=new Array(r),o=0;o<r;o++)c[o]=arguments[o];var l=0,h,d={memoizeOptions:void 0},u=c.pop();if(typeof u=="object"&&(d=u,u=c.pop()),typeof u!="function")throw new Error("createSelector expects an output function after the inputs, but received: ["+typeof u+"]");var p=d,m=p.memoizeOptions,g=m===void 0?t:m,y=Array.isArray(g)?g:[g],f=zu(c),E=i.apply(void 0,[function(){return l++,u.apply(null,arguments)}].concat(y)),S=i(function(){for(var T=[],b=f.length,O=0;O<b;O++)T.push(f[O].apply(null,arguments));return h=E.apply(null,T),h});return Object.assign(S,{resultFunc:u,memoizedResultFunc:E,dependencies:f,lastResult:function(){return h},recomputations:function(){return l},resetRecomputations:function(){return l=0}}),S};return n}var V=$u(ju);const Cn="auth",Xu=i=>i[Cn].token,qu=i=>i[Cn].isRequesting,oo=V([Xu],i=>i),Zu=V([qu],i=>i),Ju=()=>async(i,e)=>{try{const{facebook:t}=window.game,s=e(),n=oo(s);if(Zu(s)||n!=="")return;i({type:ao,payload:{}});const r=await t.getPlayerToken();i(Ia(r))}catch(t){if(t instanceof Object&&GameCore.Utils.Object.hasOwn(t,"code")&&t.code==="PENDING_REQUEST")return;if(i(Ia("")),t instanceof Object&&GameCore.Utils.Object.hasOwn(t,"message")&&typeof t.message=="string"){j(new Error(t.message));return}j(new Yu)}},Ia=i=>({type:ro,payload:{token:i}});class Qu extends Phaser.Plugins.BasePlugin{get state(){return this.game.storage.getState()}async requestToken(){const{storage:e}=this.game;await e.dispatch(Ju())}getToken(){return oo(this.state)}}const ed='nunito,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif',td=(i,e)=>({string:"+",style:"font-size: 1px; padding: "+Math.floor(e/2)+"px "+Math.floor(i/2)+"px;"}),sd=(i,e=1)=>{const t=new Image;t.onload=function(){const s=td(this.width*e,this.height*e);console.info(`%c ${s.string}`,`${s.style} background: transparent url(${i}) no-repeat center center; background-size: ${this.width*e}px ${this.height*e}px;`)},t.src=i};class id extends Phaser.Plugins.ScenePlugin{width;height;renderOptions;canvas;preload(e){const t=Object.keys(e);t.length<1||(t.forEach(s=>{this.scene.load.image(s,e[s])}),this.scene.load.start())}async capture(e){const{width:t,height:s,renderOptions:n}=e;return this.width=t,this.height=s,this.renderOptions=n,this.createCanvas(),await this.loadImages(),this.drawObjects(),this.snapshotFrame()}createCanvas(){this.canvas||(this.canvas=this.game.textures.createCanvas("FrameCaptureCanvas")),this.canvas.clear(),this.canvas.setSize(this.width,this.height)}loadImages(){return new Promise((e,t)=>{for(const s in this.renderOptions){const{name:n,image:a}=this.renderOptions[s];!a||this.scene.textures.get(n).key===n||this.scene.load.image(n,a)}this.scene.load.on(Phaser.Loader.Events.COMPLETE,e),this.scene.load.on(Phaser.Loader.Events.FILE_LOAD_ERROR,()=>{const s=new Error("Load image failed");t(s)}),this.scene.load.start()})}drawObjects(){for(const e in this.renderOptions){const t=this.renderOptions[e];switch(t.type){case"text":this.drawText(t);break;case"image":this.drawImage(t);break}}}drawText(e){const{context:t}=this.canvas,{x:s,y:n,font:a,text:r,fillStyle:c,lineWidth:o,textAlign:l}=e;t.font=`${a} ${ed}`,t.fillStyle=c||"#ffffff",o&&(t.lineWidth=o),l&&(t.textAlign=l),t.fillText(r,s,n)}drawImage(e){const{context:t}=this.canvas,{x:s,y:n,name:a,frame:r,width:c,height:o,fallbackWithImage:l}=e;let h=this.scene.textures.get(a),d=h.getSourceImage(r);h.key==="__MISSING"&&l&&(h=this.scene.textures.get(l),d=h.getSourceImage()),t.drawImage(d,s,n,c,o)}snapshotFrame(){const e=this.canvas.getCanvas().toDataURL("image/jpeg",.85);return GameCore.Utils.Valid.isDebugger()&&sd(e),e}}class nd extends Phaser.Events.EventEmitter{game;options;performance;isRunning=!1;checkTimer;fpsHistory;constructor(e,t,s){super(),this.game=e,this.options=s,this.performance=t}start=()=>{if(this.isRunning)return;this.isRunning=!0;const{checkInterval:e}=this.options;this.checkTimer=e,this.fpsHistory=[],this.game.events.on(Phaser.Core.Events.POST_STEP,this.onPostStep)};stop=()=>{if(!this.isRunning)return;this.isRunning=!1,this.game.events.off(Phaser.Core.Events.POST_STEP,this.onPostStep);const{onlyUpdateWhenSwitchScene:e}=this.options;e&&this.checkFps()};onPostStep=(e,t)=>{if(this.checkTimer-=t,this.checkTimer>0)return;const{checkInterval:s,onlyUpdateWhenSwitchScene:n}=this.options;this.checkTimer+=s,this.fpsHistory.push(this.game.loop.actualFps),n===!1&&this.fpsHistory.length>=5&&this.checkFps()};checkFps(){if(this.fpsHistory.length===0)return;const{autoUpgradeQuality:e}=this.options;let t=!1;this.isLowFps()?t=this.performance.downgradeGraphicsQuality():e&&this.isHighFps()&&(t=this.performance.upgradeGraphicsQuality()),t&&(this.fpsHistory=[])}getFpsMedian(){return Phaser.Math.Median(this.fpsHistory)}isLowFps(){return this.getFpsMedian()<this.options.fpsThreshold}isHighFps(){return this.getFpsMedian()>this.options.fpsThreshold*1.2}}class ad extends Phaser.Plugins.BasePlugin{fpsTracker;pixelRatio;minQuality;maxQuality;qualityAdjustStep;trackingSceneKeys=[];configure(e){const{pixelRatio:t,minQuality:s,maxQuality:n,qualityAdjustStep:a,trackingSceneKeys:r,...c}=e;this.pixelRatio=t,this.minQuality=s,this.maxQuality=n,this.qualityAdjustStep=a,this.trackingSceneKeys=r,this.fpsTracker=new nd(this.game,this,c)}active(){this.game.events.on(Phaser.Scenes.Events.WAKE,this.trackingScene),this.game.events.on(Phaser.Scenes.Events.START,this.trackingScene)}trackingScene=e=>{if(!this.trackingSceneKeys.includes(e))return;const t=this.game.scene.getScene(e);t.events.once(Phaser.Scenes.Events.UPDATE,this.fpsTracker.start),t.events.once(Phaser.Scenes.Events.SLEEP,this.fpsTracker.stop)};downgradeGraphicsQuality(){const e=this.pixelRatio;if(e<=this.minQuality)return!1;const t=+(e-this.qualityAdjustStep).toFixed(2);return t<this.minQuality?!1:(this.pixelRatio=t,this.game.world.resize(this.pixelRatio),console.warn(`💫 Graphics quality was downgraded! (${e} -> ${t})`),!0)}upgradeGraphicsQuality(){const e=this.pixelRatio;if(e>=this.maxQuality)return!1;const t=+(e+this.qualityAdjustStep).toFixed(2);return t>this.maxQuality?!1:(this.pixelRatio=t,this.game.world.resize(this.pixelRatio),console.warn(`🚀 Graphics quality was upgraded! (${e} -> ${t})`),!0)}}const{DefaultTheme:rd}=GameCore.Configs,vs={sound:!0,music:!0,vibrate:!0,language:"en",theme:rd},vn=i=>{try{const e=localStorage.getItem(i);return e===null?null:GameCore.Utils.Json.decode(e)}catch{return null}},zt=(i,e)=>{try{const t=vn(i);let s={};GameCore.Utils.Valid.isObject(t)&&(s=t);const n=GameCore.Utils.Json.clone(e);if(!GameCore.Utils.Valid.isObject(n))return!1;const a=GameCore.Utils.Object.clear(n),r=Ce(s,a),c=GameCore.Utils.Json.encode(r);return localStorage.setItem(i,c),!0}catch{return!1}};class co extends Error{constructor(e,t){super(e,t),this.name="BadRequest",this.message=e||"This request is bad",this.payload=t}}class dn extends Error{constructor(e,t){super(e,t),this.name="RequestTimeout",this.message=e||"This request is timeout",this.payload=t}}const{AppId:od,Network:_n}=GameCore.Configs,cd=i=>{if(!i.ok)throw new co(null,{response:i})},lo=()=>{const i=window.game.auth.getToken();return{token:i,timeout:_n.Timeout,headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}}},ho=(i,e,t,s)=>async()=>{try{const n=`${i}/apps/${od}/${e}`,a=new AbortController;t.signal=a.signal;const r=setTimeout(()=>{a.abort()},t.timeout);GameCore.Utils.Valid.isObject(s)&&(t.body=JSON.stringify(s));const c=await fetch(n,t);return clearTimeout(r),cd(c),await c.json()||{}}catch(n){if(n instanceof co)return null;throw n instanceof Object&&GameCore.Utils.Object.hasOwn(n,"name")&&n.name==="AbortError"?new dn(null):n}},On=async(i,e)=>{try{return i()}catch(t){if(t instanceof dn&&e>0)try{return await wn(600),await On(i,e-1)}catch{return{}}return t instanceof dn?{}:(console.warn(t),{})}},$t=async(i,e={},t,s=_n.Retries)=>{if(!t)return{};try{const n={...lo(),...e,method:"GET"},a=ho(t,i,n);return await On(a,s)}catch(n){return console.warn(n),{}}},Xt=async(i,e,t={},s,n=_n.Retries)=>{if(!s)return{};try{const a={...lo(),...t,method:"POST"},r=ho(s,i,a,e);return await On(r,n)}catch(a){return console.warn(a),{}}},Rn={score:0,settings:{...vs},userGuideDisplays:0,customFields:{diamond:300,lastReceiveGift:0}},{ApiHost:uo,PlayerDataStoreUsingApi:po}=GameCore.Configs,Ls=async i=>po?ld(i):hd(i),ld=async i=>{const e=GameCore.Utils.String.params(i);return(await $t(`players?${e}`,{},uo))?.data||[]},hd=async i=>{await GameSDK.player.setDataAsync(i);const e=Object.keys(Rn).concat(Object.keys(i)),t=e.filter((a,r)=>e.indexOf(a)===r),s=await GameSDK.player.getDataAsync(t),n=await GameSDK.player.getStatsAsync();return{...s,...n}},ud=async i=>po?dd(i):pd(),dd=async i=>(await Xt(`players/${i}/user-guide-displays/inc`,{},{},uo))?.data||{},pd=async()=>await GameSDK.player.incrementStatsAsync({userGuideDisplays:1}),mo="PLAYER_RECEIVED",go="PLAYER_DATA_UPDATE",fo="PLAYER_SCORE_UPDATE",Eo="PLAYER_PROFILE_UPDATE",yo="PLAYER_SETTING_UPDATE",So="PLAYER_CONNECTED_PLAYERS_UPDATE",{sound:md,music:gd,theme:fd,vibrate:Ed,language:yd}=vs,{Object:hs,Valid:Dt}=GameCore.Utils;class Ao{sound;music;vibrate;theme;language;constructor(e){this.initDefaultData(),Dt.isObject(e)&&(hs.hasOwn(e,"sound")&&Dt.isBoolean(e.sound)&&(this.sound=e.sound),hs.hasOwn(e,"music")&&Dt.isBoolean(e.music)&&(this.music=e.music),hs.hasOwn(e,"vibrate")&&Dt.isBoolean(e.vibrate)&&(this.vibrate=e.vibrate),hs.hasOwn(e,"theme")&&Dt.isString(e.theme)&&(this.theme=e.theme),hs.hasOwn(e,"language")&&Dt.isString(e.language)&&(this.language=e.language))}initDefaultData(){this.sound=md,this.music=gd,this.theme=fd,this.vibrate=Ed,this.language=yd}toObject(){return{sound:this.sound,music:this.music,theme:this.theme,vibrate:this.vibrate,language:this.language}}}const{userGuideDisplays:Sd,customFields:Ad,settings:Td}=Rn;class To{data;constructor(e){const{settings:t,score:s,customFields:n,userGuideDisplays:a}=e,r=GameCore.Utils.Valid.isNumber(s)&&s>0?s:0,c=GameCore.Utils.Valid.isNumber(a)?a:Sd,o=GameCore.Utils.Valid.isObject(n)?n:Ad;let l=Td;GameCore.Utils.Valid.isObject(t)&&(l=new Ao(t).toObject()),this.data={score:r,userGuideDisplays:c,settings:l,customFields:o}}toObject(){return this.data}}class Io extends Error{payload;constructor(e,t){super(e),this.name="PlayerDataNameNotSupport",this.message=e||"The name of player data is not supported",this.payload=t||{}}}const di="player",Id=i=>i[di],bd=i=>i[di].data,wd=i=>i[di].connectedPlayers,Cd=(i,e)=>e.limit,vd=(i,e)=>e.offset,pi=V([Id],i=>i),_d=V([pi],i=>i.playerId),Od=V([pi],i=>i.ASID),qt=V([bd],i=>i),bo=V([qt],i=>i.settings),wo=V([wd],i=>i),Rd=V([wo,Cd,vd],(i,e,t)=>typeof e!="number"?[]:typeof t!="number"?[]:Object.keys(i).slice(t,e+t)||[]),Pd=V([qt],i=>i.score),Dd=V([qt],i=>i.customFields),{AppId:ba,Tutorial:Md,LanguageSupport:Ld,ThemeSupport:xd,PlayerDataStore:Pn}=GameCore.Configs,Nd=(i,e)=>t=>{const{playerId:s,name:n,photo:a,locale:r}=i;t({type:mo,payload:{playerId:s,name:n,photo:a,locale:r,data:e||{}}})},kd=()=>async i=>{try{const{facebook:e}=window.game,t=await new Promise((a,r)=>{e.once("players",c=>{a(c)}),e.once("playersfail",()=>r([])),e.getPlayers()}),s=a=>!!a,n=t.map(a=>{const r=a.getID(),c=a.getName(),o=a.getPhoto();return!r||!c||!o?null:new Ht(r,c,o).toObject()}).filter(s);if(n.length<1)return;i(Co(n))}catch(e){j(e)}},Co=i=>({type:So,payload:{connectedPlayers:i}}),Gd=(i,e)=>(t,s)=>{try{const n=s(),a=bo(n);t({type:yo,payload:{name:i,value:e}});const r={settings:{...a,[i]:e}};zt(Pn,r),Ls(r)}catch(n){j(n)}},Bd=()=>async(i,e)=>{try{const t=e(),s=pi(t),{playerId:n,name:a,photo:r,locale:c}=s,o=await FBInstant.player.getASIDAsync();i({type:Eo,payload:{profile:{appId:ba,playerId:n,name:a,photo:r,locale:c,ASID:o}}});const h=await Ls({appId:ba,playerId:n,name:a,photo:r,locale:c});if(!GameCore.Utils.Valid.isObject(h)||h.playerId!==n)return;const d=bo(t),{theme:u,sound:p,music:m,vibrate:g,language:y}=d,f=new To(h).toObject(),{theme:E,music:S,sound:I,vibrate:T,language:b}=f.settings,O=y in Ld,_=u in xd;(y!==b||!O)&&(f.settings.language=b),S===!0&&m!==S&&(f.settings.music=S),I===!0&&p!==I&&(f.settings.sound=I),T===!0&&g!==T&&(f.settings.vibrate=T),(u!==E||!_)&&(f.settings.theme=E),i(mi(f)),f.settings.music===!0&&window.game.audio.playMusic()}catch(t){j(t)}},Ud=(i,e)=>async(t,s)=>{try{const n={customFields:{[i]:e}};await t(mi(n));const a=s(),c={...qt(a)};Ls(c)}catch(n){if(n instanceof Io)return;j(n)}},Fd=i=>async(e,t)=>{try{await e(mi({customFields:i}));const n=t(),r={...qt(n)};Ls(r)}catch(s){if(s instanceof Io)return;j(s)}},mi=i=>e=>{try{e({type:go,payload:{data:i}}),zt(Pn,i)}catch(t){j(t)}},Yd=()=>async(i,e)=>{try{if(Md.ForceUseTutorial)return;const{facebook:t}=window.game;i(mi({userGuideDisplays:1}));const s=e(),n=_d(s);await ud(n),t.data.set("userGuideDisplays",1)}catch(t){j(t)}},wa=i=>async(e,t)=>{try{await e({type:fo,payload:{score:i}}),Ls({score:i});const s=t(),a={...qt(s)};zt(Pn,a)}catch(s){j(s)}};class Hd extends Phaser.Plugins.BasePlugin{get state(){return this.game.storage.getState()}async incUserGuideDisplays(){const{storage:e}=this.game;await e.dispatch(Yd())}receiveData(e,t){const{storage:s}=this.game;s.dispatch(Nd(e,t))}async updateData(){const{storage:e}=this.game;await e.dispatch(Bd())}async updateBestScore(e){const t=this.getBestScore();if(e<=t)return;const{storage:s}=this.game;await s.dispatch(wa(e))}async setScore(e){const{storage:t}=this.game;await t.dispatch(wa(e))}async setSetting(e,t){const{storage:s}=this.game;await s.dispatch(Gd(e,t))}async setCustomData(e,t){const{storage:s}=this.game;await s.dispatch(Ud(e,t))}async updateCustomFields(e){const{storage:t}=this.game;await t.dispatch(Fd(e))}async requestConnectedPlayers(){const{storage:e}=this.game;await e.dispatch(kd())}async updateConnectedPlayers(e){const{storage:t}=this.game;await t.dispatch(Co(e))}getPlayer(){return pi(this.state)}getPlayerId(){return this.getPlayer().playerId}getPlayerASID(){return Od(this.state)}getPlayerData(){return this.getPlayer().data}getPlayerSetting(e){const t=this.getPlayerSettings();return typeof e!="string"?null:GameCore.Utils.Object.hasOwn(t,e)?t[e]:GameCore.Utils.Object.hasOwn(vs,e)?vs[e]:null}getPlayerSettings(){return this.getPlayerData().settings}getPlayerIsNew(){return this.getPlayer().isUserNew}getCoins(){const e=this.getCustomData("coin");return GameCore.Utils.Valid.isNumber(e)?e:0}getDiamond(){const e=this.getCustomData("diamond");return GameCore.Utils.Valid.isNumber(e)?e:0}getBestScore(){return Pd(this.state)}getCustomData(e){const t=Dd(this.state);return!GameCore.Utils.Valid.isObject(t)||!GameCore.Utils.Object.hasOwn(t,e)?null:t[e]}getConnectedPlayers(){return wo(this.state)}getConnectedPlayerIds(e,t){return Rd(this.state,{limit:e,offset:t})}}const{ApiHost:Vd}=GameCore.Configs,Wd=async i=>{const e=GameCore.Utils.String.params(i);return(await $t(`players?${e}`,{},Vd))?.data||[]},vo="PROFILES_DATA_UPDATE",Dn="profile",Kd=i=>i[Dn].data,jd=i=>i[Dn].profileIds,zd=V([Kd],i=>i),$d=V([jd],i=>i),Xd=i=>async(e,t)=>{try{const s=t(),n=$d(s),a=GameCore.Utils.Array.difference(i,n);if(a.length<1)return;const r=await Wd({playerIds:a});e({type:vo,payload:{data:r}})}catch(s){j(s)}};class qd extends Phaser.Plugins.BasePlugin{get state(){return this.game.storage.getState()}async requestProfiles(e){const{storage:t}=this.game;await t.dispatch(Xd(e))}getProfiles(){return zd(this.state)}}var _o=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Zd(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var pn={},Jd={get exports(){return pn},set exports(i){pn=i}};(function(i,e){(function(t,s){i.exports=s()})(_o,function(){return function(t){var s={};function n(a){if(s[a])return s[a].exports;var r=s[a]={i:a,l:!1,exports:{}};return t[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=s,n.d=function(a,r,c){n.o(a,r)||Object.defineProperty(a,r,{enumerable:!0,get:c})},n.r=function(a){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},n.t=function(a,r){if(1&r&&(a=n(a)),8&r||4&r&&typeof a=="object"&&a&&a.__esModule)return a;var c=Object.create(null);if(n.r(c),Object.defineProperty(c,"default",{enumerable:!0,value:a}),2&r&&typeof a!="string")for(var o in a)n.d(c,o,function(l){return a[l]}.bind(null,o));return c},n.n=function(a){var r=a&&a.__esModule?function(){return a.default}:function(){return a};return n.d(r,"a",r),r},n.o=function(a,r){return Object.prototype.hasOwnProperty.call(a,r)},n.p="",n(n.s=6)}([function(t,s,n){var a=n(12),r={};function c(T,b){return b===o(T)}function o(T){var b=typeof T;return b!=="object"?b:T?T instanceof Error?"error":{}.toString.call(T).match(/\s([a-zA-Z]+)/)[1].toLowerCase():"null"}function l(T){return c(T,"function")}function h(T){var b=Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?"),O=RegExp("^"+b+"$");return d(T)&&O.test(T)}function d(T){var b=typeof T;return T!=null&&(b=="object"||b=="function")}function u(){var T=I();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var O=(T+16*Math.random())%16|0;return T=Math.floor(T/16),(b==="x"?O:7&O|8).toString(16)})}var p={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};function m(T,b){var O,_;try{O=r.stringify(T)}catch(w){if(b&&l(b))try{O=b(T)}catch(v){_=v}else _=w}return{error:_,value:O}}function g(T,b){return function(O,_){try{b(O,_)}catch(w){T.error(w)}}}function y(T){return function b(O,_){var w,v,M,L={};try{for(v in O)(w=O[v])&&(c(w,"object")||c(w,"array"))?_.includes(w)?L[v]="Removed circular reference: "+o(w):((M=_.slice()).push(w),L[v]=b(w,M)):L[v]=w}catch(N){L="Failed cloning custom data: "+N.message}return L}(T,[T])}var f=["log","network","dom","navigation","error","manual"],E=["critical","error","warning","info","debug"];function S(T,b){for(var O=0;O<T.length;++O)if(T[O]===b)return!0;return!1}function I(){return Date.now?+Date.now():+new Date}t.exports={addParamsAndAccessTokenToPath:function(T,b,O){(O=O||{}).access_token=T;var _,w=[];for(_ in O)Object.prototype.hasOwnProperty.call(O,_)&&w.push([_,O[_]].join("="));var v="?"+w.sort().join("&");(b=b||{}).path=b.path||"";var M,L=b.path.indexOf("?"),N=b.path.indexOf("#");L!==-1&&(N===-1||N>L)?(M=b.path,b.path=M.substring(0,L)+v+"&"+M.substring(L+1)):N!==-1?(M=b.path,b.path=M.substring(0,N)+v+M.substring(N)):b.path=b.path+v},createItem:function(T,b,O,_,w){for(var v,M,L,N,G,B,q=[],ie=[],ye=0,te=T.length;ye<te;++ye){var Qe=o(B=T[ye]);switch(ie.push(Qe),Qe){case"undefined":break;case"string":v?q.push(B):v=B;break;case"function":N=g(b,B);break;case"date":q.push(B);break;case"error":case"domexception":case"exception":M?q.push(B):M=B;break;case"object":case"array":if(B instanceof Error||typeof DOMException<"u"&&B instanceof DOMException){M?q.push(B):M=B;break}if(_&&Qe==="object"&&!G){for(var _e=0,os=_.length;_e<os;++_e)if(B[_[_e]]!==void 0){G=B;break}if(G)break}L?q.push(B):L=B;break;default:if(B instanceof Error||typeof DOMException<"u"&&B instanceof DOMException){M?q.push(B):M=B;break}q.push(B)}}L&&(L=y(L)),q.length>0&&(L||(L=y({})),L.extraArgs=y(q));var He={message:v,err:M,custom:L,timestamp:I(),callback:N,notifier:O,diagnostic:{},uuid:u()};return function(cs,Pe){Pe&&Pe.level!==void 0&&(cs.level=Pe.level,delete Pe.level),Pe&&Pe.skipFrames!==void 0&&(cs.skipFrames=Pe.skipFrames,delete Pe.skipFrames)}(He,L),_&&G&&(He.request=G),w&&(He.lambdaContext=w),He._originalArgs=T,He.diagnostic.original_arg_types=ie,He},addErrorContext:function(T,b){var O=T.data.custom||{},_=!1;try{for(var w=0;w<b.length;++w)b[w].hasOwnProperty("rollbarContext")&&(O=a(O,y(b[w].rollbarContext)),_=!0);_&&(T.data.custom=O)}catch(v){T.diagnostic.error_context="Failed: "+v.message}},createTelemetryEvent:function(T){for(var b,O,_,w,v=0,M=T.length;v<M;++v)switch(o(w=T[v])){case"string":!b&&S(f,w)?b=w:!_&&S(E,w)&&(_=w);break;case"object":O=w}return{type:b||"manual",metadata:O||{},level:_}},filterIp:function(T,b){if(T&&T.user_ip&&b!==!0){var O=T.user_ip;if(b)try{var _;if(O.indexOf(".")!==-1)(_=O.split(".")).pop(),_.push("0"),O=_.join(".");else if(O.indexOf(":")!==-1){if((_=O.split(":")).length>2){var w=_.slice(0,3),v=w[2].indexOf("/");v!==-1&&(w[2]=w[2].substring(0,v)),O=w.concat("0000:0000:0000:0000:0000").join(":")}}else O=null}catch{O=null}else O=null;T.user_ip=O}},formatArgsAsString:function(T){var b,O,_,w=[];for(b=0,O=T.length;b<O;++b){switch(o(_=T[b])){case"object":(_=(_=m(_)).error||_.value).length>500&&(_=_.substr(0,497)+"...");break;case"null":_="null";break;case"undefined":_="undefined";break;case"symbol":_=_.toString()}w.push(_)}return w.join(" ")},formatUrl:function(T,b){if(!(b=b||T.protocol)&&T.port&&(T.port===80?b="http:":T.port===443&&(b="https:")),b=b||"https:",!T.hostname)return null;var O=b+"//"+T.hostname;return T.port&&(O=O+":"+T.port),T.path&&(O+=T.path),O},get:function(T,b){if(T){var O=b.split("."),_=T;try{for(var w=0,v=O.length;w<v;++w)_=_[O[w]]}catch{_=void 0}return _}},handleOptions:function(T,b,O,_){var w=a(T,b,O);return w=function(v,M){return v.hostWhiteList&&!v.hostSafeList&&(v.hostSafeList=v.hostWhiteList,v.hostWhiteList=void 0,M&&M.log("hostWhiteList is deprecated. Use hostSafeList.")),v.hostBlackList&&!v.hostBlockList&&(v.hostBlockList=v.hostBlackList,v.hostBlackList=void 0,M&&M.log("hostBlackList is deprecated. Use hostBlockList.")),v}(w,_),!b||b.overwriteScrubFields||b.scrubFields&&(w.scrubFields=(T.scrubFields||[]).concat(b.scrubFields)),w},isError:function(T){return c(T,"error")||c(T,"exception")},isFiniteNumber:function(T){return Number.isFinite(T)},isFunction:l,isIterable:function(T){var b=o(T);return b==="object"||b==="array"},isNativeFunction:h,isObject:d,isString:function(T){return typeof T=="string"||T instanceof String},isType:c,isPromise:function(T){return d(T)&&c(T.then,"function")},jsonParse:function(T){var b,O;try{b=r.parse(T)}catch(_){O=_}return{error:O,value:b}},LEVELS:{debug:0,info:1,warning:2,error:3,critical:4},makeUnhandledStackInfo:function(T,b,O,_,w,v,M,L){var N={url:b||"",line:O,column:_};N.func=L.guessFunctionName(N.url,N.line),N.context=L.gatherContext(N.url,N.line);var G=typeof document<"u"&&document&&document.location&&document.location.href,B=typeof window<"u"&&window&&window.navigator&&window.navigator.userAgent;return{mode:v,message:w?String(w):T||M,url:G,stack:[N],useragent:B}},merge:a,now:I,redact:function(){return"********"},RollbarJSON:r,sanitizeUrl:function(T){var b=function(O){if(c(O,"string")){for(var _=p,w=_.parser[_.strictMode?"strict":"loose"].exec(O),v={},M=0,L=_.key.length;M<L;++M)v[_.key[M]]=w[M]||"";return v[_.q.name]={},v[_.key[12]].replace(_.q.parser,function(N,G,B){G&&(v[_.q.name][G]=B)}),v}}(T);return b?(b.anchor===""&&(b.source=b.source.replace("#","")),T=b.source.replace("?"+b.query,"")):"(unknown)"},set:function(T,b,O){if(T){var _=b.split("."),w=_.length;if(!(w<1))if(w!==1)try{for(var v=T[_[0]]||{},M=v,L=1;L<w-1;++L)v[_[L]]=v[_[L]]||{},v=v[_[L]];v[_[w-1]]=O,T[_[0]]=M}catch{return}else T[_[0]]=O}},setupJSON:function(T){l(r.stringify)&&l(r.parse)||(c(JSON,"undefined")||(T?(h(JSON.stringify)&&(r.stringify=JSON.stringify),h(JSON.parse)&&(r.parse=JSON.parse)):(l(JSON.stringify)&&(r.stringify=JSON.stringify),l(JSON.parse)&&(r.parse=JSON.parse))),l(r.stringify)&&l(r.parse)||T&&T(r))},stringify:m,maxByteSize:function(T){for(var b=0,O=T.length,_=0;_<O;_++){var w=T.charCodeAt(_);w<128?b+=1:w<2048?b+=2:w<65536&&(b+=3)}return b},typeName:o,uuid4:u}},function(t,s,n){n(17);var a=n(18),r=n(0);t.exports={error:function(){var c=Array.prototype.slice.call(arguments,0);c.unshift("Rollbar:"),a.ieVersion()<=8?console.error(r.formatArgsAsString(c)):console.error.apply(console,c)},info:function(){var c=Array.prototype.slice.call(arguments,0);c.unshift("Rollbar:"),a.ieVersion()<=8?console.info(r.formatArgsAsString(c)):console.info.apply(console,c)},log:function(){var c=Array.prototype.slice.call(arguments,0);c.unshift("Rollbar:"),a.ieVersion()<=8?console.log(r.formatArgsAsString(c)):console.log.apply(console,c)}}},function(t,s,n){t.exports={parse:function(a){var r,c,o={protocol:null,auth:null,host:null,path:null,hash:null,href:a,hostname:null,port:null,pathname:null,search:null,query:null};if((r=a.indexOf("//"))!==-1?(o.protocol=a.substring(0,r),c=r+2):c=0,(r=a.indexOf("@",c))!==-1&&(o.auth=a.substring(c,r),c=r+1),(r=a.indexOf("/",c))===-1){if((r=a.indexOf("?",c))===-1)return(r=a.indexOf("#",c))===-1?o.host=a.substring(c):(o.host=a.substring(c,r),o.hash=a.substring(r)),o.hostname=o.host.split(":")[0],o.port=o.host.split(":")[1],o.port&&(o.port=parseInt(o.port,10)),o;o.host=a.substring(c,r),o.hostname=o.host.split(":")[0],o.port=o.host.split(":")[1],o.port&&(o.port=parseInt(o.port,10)),c=r}else o.host=a.substring(c,r),o.hostname=o.host.split(":")[0],o.port=o.host.split(":")[1],o.port&&(o.port=parseInt(o.port,10)),c=r;if((r=a.indexOf("#",c))===-1?o.path=a.substring(c):(o.path=a.substring(c,r),o.hash=a.substring(r)),o.path){var l=o.path.split("?");o.pathname=l[0],o.query=l[1],o.search=o.query?"?"+o.query:null}return o}}},function(t,s,n){var a=n(24),r=new RegExp("^(([a-zA-Z0-9-_$ ]*): *)?(Uncaught )?([a-zA-Z0-9-_$ ]*): ");function c(){return null}function o(d){var u={};return u._stackFrame=d,u.url=d.fileName,u.line=d.lineNumber,u.func=d.functionName,u.column=d.columnNumber,u.args=d.args,u.context=null,u}function l(d,u){return{stack:function(){var p=[];u=u||0;try{p=a.parse(d)}catch{p=[]}for(var m=[],g=u;g<p.length;g++)m.push(new o(p[g]));return m}(),message:d.message,name:h(d),rawStack:d.stack,rawException:d}}function h(d){var u=d.name&&d.name.length&&d.name,p=d.constructor.name&&d.constructor.name.length&&d.constructor.name;return u&&p?u==="Error"?p:u:u||p}t.exports={guessFunctionName:function(){return"?"},guessErrorClass:function(d){if(!d||!d.match)return["Unknown error. There was no error message to display.",""];var u=d.match(r),p="(unknown)";return u&&(p=u[u.length-1],d=(d=d.replace((u[u.length-2]||"")+p+":","")).replace(/(^[\s]+|[\s]+$)/g,"")),[p,d]},gatherContext:c,parse:function(d,u){var p=d;if(p.nested||p.cause){for(var m=[];p;)m.push(new l(p,u)),p=p.nested||p.cause,u=0;return m[0].traceChain=m,m[0]}return new l(p,u)},Stack:l,Frame:o}},function(t,s,n){var a=n(0),r=n(5);function c(o,l){var h=l.split("."),d=h.length-1;try{for(var u=0;u<=d;++u)u<d?o=o[h[u]]:o[h[u]]=a.redact()}catch{}}t.exports=function(o,l,h){if(l=l||[],h)for(var d=0;d<h.length;++d)c(o,h[d]);var u=function(g){for(var y,f=[],E=0;E<g.length;++E)y="^\\[?(%5[bB])?"+g[E]+"\\[?(%5[bB])?\\]?(%5[dD])?$",f.push(new RegExp(y,"i"));return f}(l),p=function(g){for(var y,f=[],E=0;E<g.length;++E)y="\\[?(%5[bB])?"+g[E]+"\\[?(%5[bB])?\\]?(%5[dD])?",f.push(new RegExp("("+y+"=)([^&\\n]+)","igm"));return f}(l);function m(g,y){return y+a.redact()}return r(o,function g(y,f,E){var S=function(I,T){var b;for(b=0;b<u.length;++b)if(u[b].test(I)){T=a.redact();break}return T}(y,f);return S===f?a.isType(f,"object")||a.isType(f,"array")?r(f,g,E):function(I){var T;if(a.isType(I,"string"))for(T=0;T<p.length;++T)I=I.replace(p[T],m);return I}(S):S})}},function(t,s,n){var a=n(0);t.exports=function(r,c,o){var l,h,d,u,p=a.isType(r,"object"),m=a.isType(r,"array"),g=[];if(o=o||{obj:[],mapped:[]},p){if(u=o.obj.indexOf(r),p&&u!==-1)return o.mapped[u]||o.obj[u];o.obj.push(r),u=o.obj.length-1}if(p)for(l in r)Object.prototype.hasOwnProperty.call(r,l)&&g.push(l);else if(m)for(d=0;d<r.length;++d)g.push(d);var y=p?{}:[],f=!0;for(d=0;d<g.length;++d)h=r[l=g[d]],y[l]=c(l,h,o),f=f&&y[l]===r[l];return p&&!f&&(o.mapped[u]=y),f?r:y}},function(t,s,n){t.exports=n(7)},function(t,s,n){var a=n(8),r=typeof window<"u"&&window._rollbarConfig,c=r&&r.globalAlias||"Rollbar",o=typeof window<"u"&&window[c]&&typeof window[c].shimId=="function"&&window[c].shimId()!==void 0;if(typeof window>"u"||window._rollbarStartTime||(window._rollbarStartTime=new Date().getTime()),!o&&r){var l=new a(r);window[c]=l}else typeof window<"u"?(window.rollbar=a,window._rollbarDidLoad=!0):typeof self<"u"&&(self.rollbar=a,self._rollbarDidLoad=!0);t.exports=a},function(t,s,n){var a=n(9),r=n(31),c=n(32),o=n(35),l=n(37),h=n(4),d=n(38);a.setComponents({telemeter:r,instrumenter:c,polyfillJSON:o,wrapGlobals:l,scrub:h,truncation:d}),t.exports=a},function(t,s,n){var a=n(10),r=n(0),c=n(15),o=n(1),l=n(19),h=n(20),d=n(2),u=n(23),p=n(26),m=n(27),g=n(28),y=n(3);function f(w,v){this.options=r.handleOptions(_,w,null,o),this.options._configuredOptions=w;var M=this.components.telemeter,L=this.components.instrumenter,N=this.components.polyfillJSON;this.wrapGlobals=this.components.wrapGlobals,this.scrub=this.components.scrub;var G=this.components.truncation,B=new h(G),q=new c(this.options,B,d,G);M&&(this.telemeter=new M(this.options)),this.client=v||new a(this.options,q,o,this.telemeter,"browser");var ie=T(),ye=typeof document<"u"&&document;this.isChrome=ie.chrome&&ie.chrome.runtime,this.anonymousErrorsPending=0,function(te,Qe,_e){te.addTransform(u.handleDomException).addTransform(u.handleItemWithError).addTransform(u.ensureItemHasSomethingToSay).addTransform(u.addBaseInfo).addTransform(u.addRequestInfo(_e)).addTransform(u.addClientInfo(_e)).addTransform(u.addPluginInfo(_e)).addTransform(u.addBody).addTransform(p.addMessageWithError).addTransform(p.addTelemetryData).addTransform(p.addConfigToPayload).addTransform(u.addScrubber(Qe.scrub)).addTransform(p.addPayloadOptions).addTransform(p.userTransform(o)).addTransform(p.addConfiguredOptions).addTransform(p.addDiagnosticKeys).addTransform(p.itemToPayload)}(this.client.notifier,this,ie),this.client.queue.addPredicate(g.checkLevel).addPredicate(m.checkIgnore).addPredicate(g.userCheckIgnore(o)).addPredicate(g.urlIsNotBlockListed(o)).addPredicate(g.urlIsSafeListed(o)).addPredicate(g.messageIsIgnored(o)),this.setupUnhandledCapture(),L&&(this.instrumenter=new L(this.options,this.client.telemeter,this,ie,ye),this.instrumenter.instrument()),r.setupJSON(N)}var E=null;function S(w){var v="Rollbar is not initialized";o.error(v),w&&w(new Error(v))}function I(w){for(var v=0,M=w.length;v<M;++v)if(r.isFunction(w[v]))return w[v]}function T(){return typeof window<"u"&&window||typeof self<"u"&&self}f.init=function(w,v){return E?E.global(w).configure(w):E=new f(w,v)},f.prototype.components={},f.setComponents=function(w){f.prototype.components=w},f.prototype.global=function(w){return this.client.global(w),this},f.global=function(w){if(E)return E.global(w);S()},f.prototype.configure=function(w,v){var M=this.options,L={};return v&&(L={payload:v}),this.options=r.handleOptions(M,w,L,o),this.options._configuredOptions=r.handleOptions(M._configuredOptions,w,L),this.client.configure(this.options,v),this.instrumenter&&this.instrumenter.configure(this.options),this.setupUnhandledCapture(),this},f.configure=function(w,v){if(E)return E.configure(w,v);S()},f.prototype.lastError=function(){return this.client.lastError},f.lastError=function(){if(E)return E.lastError();S()},f.prototype.log=function(){var w=this._createItem(arguments),v=w.uuid;return this.client.log(w),{uuid:v}},f.log=function(){if(E)return E.log.apply(E,arguments);var w=I(arguments);S(w)},f.prototype.debug=function(){var w=this._createItem(arguments),v=w.uuid;return this.client.debug(w),{uuid:v}},f.debug=function(){if(E)return E.debug.apply(E,arguments);var w=I(arguments);S(w)},f.prototype.info=function(){var w=this._createItem(arguments),v=w.uuid;return this.client.info(w),{uuid:v}},f.info=function(){if(E)return E.info.apply(E,arguments);var w=I(arguments);S(w)},f.prototype.warn=function(){var w=this._createItem(arguments),v=w.uuid;return this.client.warn(w),{uuid:v}},f.warn=function(){if(E)return E.warn.apply(E,arguments);var w=I(arguments);S(w)},f.prototype.warning=function(){var w=this._createItem(arguments),v=w.uuid;return this.client.warning(w),{uuid:v}},f.warning=function(){if(E)return E.warning.apply(E,arguments);var w=I(arguments);S(w)},f.prototype.error=function(){var w=this._createItem(arguments),v=w.uuid;return this.client.error(w),{uuid:v}},f.error=function(){if(E)return E.error.apply(E,arguments);var w=I(arguments);S(w)},f.prototype.critical=function(){var w=this._createItem(arguments),v=w.uuid;return this.client.critical(w),{uuid:v}},f.critical=function(){if(E)return E.critical.apply(E,arguments);var w=I(arguments);S(w)},f.prototype.buildJsonPayload=function(w){return this.client.buildJsonPayload(w)},f.buildJsonPayload=function(){if(E)return E.buildJsonPayload.apply(E,arguments);S()},f.prototype.sendJsonPayload=function(w){return this.client.sendJsonPayload(w)},f.sendJsonPayload=function(){if(E)return E.sendJsonPayload.apply(E,arguments);S()},f.prototype.setupUnhandledCapture=function(){var w=T();this.unhandledExceptionsInitialized||(this.options.captureUncaught||this.options.handleUncaughtExceptions)&&(l.captureUncaughtExceptions(w,this),this.wrapGlobals&&this.options.wrapGlobalEventHandlers&&this.wrapGlobals(w,this),this.unhandledExceptionsInitialized=!0),this.unhandledRejectionsInitialized||(this.options.captureUnhandledRejections||this.options.handleUnhandledRejections)&&(l.captureUnhandledRejections(w,this),this.unhandledRejectionsInitialized=!0)},f.prototype.handleUncaughtException=function(w,v,M,L,N,G){if(this.options.captureUncaught||this.options.handleUncaughtExceptions){if(this.options.inspectAnonymousErrors&&this.isChrome&&N===null&&v==="")return"anonymous";var B,q=r.makeUnhandledStackInfo(w,v,M,L,N,"onerror","uncaught exception",y);r.isError(N)?(B=this._createItem([w,N,G]))._unhandledStackInfo=q:r.isError(v)?(B=this._createItem([w,v,G]))._unhandledStackInfo=q:(B=this._createItem([w,G])).stackInfo=q,B.level=this.options.uncaughtErrorLevel,B._isUncaught=!0,this.client.log(B)}},f.prototype.handleAnonymousErrors=function(){if(this.options.inspectAnonymousErrors&&this.isChrome){var w=this;try{Error.prepareStackTrace=function(v,M){if(w.options.inspectAnonymousErrors&&w.anonymousErrorsPending){if(w.anonymousErrorsPending-=1,!v)return;v._isAnonymous=!0,w.handleUncaughtException(v.message,null,null,null,v)}return v.stack}}catch(v){this.options.inspectAnonymousErrors=!1,this.error("anonymous error handler failed",v)}}},f.prototype.handleUnhandledRejection=function(w,v){if(this.options.captureUnhandledRejections||this.options.handleUnhandledRejections){var M="unhandled rejection was null or undefined!";if(w)if(w.message)M=w.message;else{var L=r.stringify(w);L.value&&(M=L.value)}var N,G=w&&w._rollbarContext||v&&v._rollbarContext;r.isError(w)?N=this._createItem([M,w,G]):(N=this._createItem([M,w,G])).stackInfo=r.makeUnhandledStackInfo(M,"",0,0,null,"unhandledrejection","",y),N.level=this.options.uncaughtErrorLevel,N._isUncaught=!0,N._originalArgs=N._originalArgs||[],N._originalArgs.push(v),this.client.log(N)}},f.prototype.wrap=function(w,v,M){try{var L;if(L=r.isFunction(v)?v:function(){return v||{}},!r.isFunction(w)||w._isWrap)return w;if(!w._rollbar_wrapped&&(w._rollbar_wrapped=function(){M&&r.isFunction(M)&&M.apply(this,arguments);try{return w.apply(this,arguments)}catch(B){var G=B;throw G&&window._rollbarWrappedError!==G&&(r.isType(G,"string")&&(G=new String(G)),G._rollbarContext=L()||{},G._rollbarContext._wrappedSource=w.toString(),window._rollbarWrappedError=G),G}},w._rollbar_wrapped._isWrap=!0,w.hasOwnProperty))for(var N in w)w.hasOwnProperty(N)&&N!=="_rollbar_wrapped"&&(w._rollbar_wrapped[N]=w[N]);return w._rollbar_wrapped}catch{return w}},f.wrap=function(w,v){if(E)return E.wrap(w,v);S()},f.prototype.captureEvent=function(){var w=r.createTelemetryEvent(arguments);return this.client.captureEvent(w.type,w.metadata,w.level)},f.captureEvent=function(){if(E)return E.captureEvent.apply(E,arguments);S()},f.prototype.captureDomContentLoaded=function(w,v){return v||(v=new Date),this.client.captureDomContentLoaded(v)},f.prototype.captureLoad=function(w,v){return v||(v=new Date),this.client.captureLoad(v)},f.prototype.loadFull=function(){o.info("Unexpected Rollbar.loadFull() called on a Notifier instance. This can happen when Rollbar is loaded multiple times.")},f.prototype._createItem=function(w){return r.createItem(w,o,this)};var b=n(29),O=n(30),_={version:b.version,scrubFields:O.scrubFields,logLevel:b.logLevel,reportLevel:b.reportLevel,uncaughtErrorLevel:b.uncaughtErrorLevel,endpoint:b.endpoint,verbose:!1,enabled:!0,transmit:!0,sendConfig:!1,includeItemsInTelemetry:!0,captureIp:!0,inspectAnonymousErrors:!0,ignoreDuplicateErrors:!0,wrapGlobalEventHandlers:!1};t.exports=f},function(t,s,n){var a=n(11),r=n(13),c=n(14),o=n(0);function l(u,p,m,g,y){this.options=o.merge(u),this.logger=m,l.rateLimiter.configureGlobal(this.options),l.rateLimiter.setPlatformOptions(y,this.options),this.api=p,this.queue=new r(l.rateLimiter,p,m,this.options);var f=this.options.tracer||null;d(f)?(this.tracer=f,this.options.tracer="opentracing-tracer-enabled",this.options._configuredOptions.tracer="opentracing-tracer-enabled"):this.tracer=null,this.notifier=new c(this.queue,this.options),this.telemeter=g,h(u),this.lastError=null,this.lastErrorHash="none"}function h(u){u.stackTraceLimit&&(Error.stackTraceLimit=u.stackTraceLimit)}function d(u){if(!u||!u.scope||typeof u.scope!="function")return!1;var p=u.scope();return!(!p||!p.active||typeof p.active!="function")}l.rateLimiter=new a({maxItems:0,itemsPerMinute:60}),l.prototype.global=function(u){return l.rateLimiter.configureGlobal(u),this},l.prototype.configure=function(u,p){var m=this.options,g={};p&&(g={payload:p}),this.options=o.merge(m,u,g);var y=this.options.tracer||null;return d(y)?(this.tracer=y,this.options.tracer="opentracing-tracer-enabled",this.options._configuredOptions.tracer="opentracing-tracer-enabled"):this.tracer=null,this.notifier&&this.notifier.configure(this.options),this.telemeter&&this.telemeter.configure(this.options),h(u),this.global(this.options),d(u.tracer)&&(this.tracer=u.tracer),this},l.prototype.log=function(u){var p=this._defaultLogLevel();return this._log(p,u)},l.prototype.debug=function(u){this._log("debug",u)},l.prototype.info=function(u){this._log("info",u)},l.prototype.warn=function(u){this._log("warning",u)},l.prototype.warning=function(u){this._log("warning",u)},l.prototype.error=function(u){this._log("error",u)},l.prototype.critical=function(u){this._log("critical",u)},l.prototype.wait=function(u){this.queue.wait(u)},l.prototype.captureEvent=function(u,p,m){return this.telemeter&&this.telemeter.captureEvent(u,p,m)},l.prototype.captureDomContentLoaded=function(u){return this.telemeter&&this.telemeter.captureDomContentLoaded(u)},l.prototype.captureLoad=function(u){return this.telemeter&&this.telemeter.captureLoad(u)},l.prototype.buildJsonPayload=function(u){return this.api.buildJsonPayload(u)},l.prototype.sendJsonPayload=function(u){this.api.postJsonPayload(u)},l.prototype._log=function(u,p){var m;if(p.callback&&(m=p.callback,delete p.callback),this.options.ignoreDuplicateErrors&&this._sameAsLastError(p)){if(m){var g=new Error("ignored identical item");g.item=p,m(g)}}else try{this._addTracingInfo(p),p.level=p.level||u,this.telemeter&&this.telemeter._captureRollbarItem(p),p.telemetryEvents=this.telemeter&&this.telemeter.copyEvents()||[],this.notifier.log(p,m)}catch(y){m&&m(y),this.logger.error(y)}},l.prototype._defaultLogLevel=function(){return this.options.logLevel||"debug"},l.prototype._sameAsLastError=function(u){if(!u._isUncaught)return!1;var p=function(m){var g=m.message||"",y=(m.err||{}).stack||String(m.err);return g+"::"+y}(u);return this.lastErrorHash===p||(this.lastError=u.err,this.lastErrorHash=p,!1)},l.prototype._addTracingInfo=function(u){if(this.tracer){var p=this.tracer.scope().active();if(function(y){if(!y||!y.context||typeof y.context!="function")return!1;var f=y.context();return!(!f||!f.toSpanId||!f.toTraceId||typeof f.toSpanId!="function"||typeof f.toTraceId!="function")}(p)){p.setTag("rollbar.error_uuid",u.uuid),p.setTag("rollbar.has_error",!0),p.setTag("error",!0),p.setTag("rollbar.item_url","https://rollbar.com/item/uuid/?uuid="+u.uuid),p.setTag("rollbar.occurrence_url","https://rollbar.com/occurrence/uuid/?uuid="+u.uuid);var m=p.context().toSpanId(),g=p.context().toTraceId();u.custom?(u.custom.opentracing_span_id=m,u.custom.opentracing_trace_id=g):u.custom={opentracing_span_id:m,opentracing_trace_id:g}}}},t.exports=l},function(t,s,n){var a=n(0);function r(l){this.startTime=a.now(),this.counter=0,this.perMinCounter=0,this.platform=null,this.platformOptions={},this.configureGlobal(l)}function c(l,h,d){return!l.ignoreRateLimit&&h>=1&&d>h}function o(l,h,d,u,p,m,g){var y=null;return d&&(d=new Error(d)),d||u||(y=function(f,E,S,I,T){var b,O=E.environment||E.payload&&E.payload.environment;b=T?"item per minute limit reached, ignoring errors until timeout":"maxItems has been hit, ignoring errors until reset.";var _={body:{message:{body:b,extra:{maxItems:S,itemsPerMinute:I}}},language:"javascript",environment:O,notifier:{version:E.notifier&&E.notifier.version||E.version}};return f==="browser"?(_.platform="browser",_.framework="browser-js",_.notifier.name="rollbar-browser-js"):f==="server"?(_.framework=E.framework||"node-js",_.notifier.name=E.notifier.name):f==="react-native"&&(_.framework=E.framework||"react-native",_.notifier.name=E.notifier.name),_}(l,h,p,m,g)),{error:d,shouldSend:u,payload:y}}r.globalSettings={startTime:a.now(),maxItems:void 0,itemsPerMinute:void 0},r.prototype.configureGlobal=function(l){l.startTime!==void 0&&(r.globalSettings.startTime=l.startTime),l.maxItems!==void 0&&(r.globalSettings.maxItems=l.maxItems),l.itemsPerMinute!==void 0&&(r.globalSettings.itemsPerMinute=l.itemsPerMinute)},r.prototype.shouldSend=function(l,h){var d=(h=h||a.now())-this.startTime;(d<0||d>=6e4)&&(this.startTime=h,this.perMinCounter=0);var u=r.globalSettings.maxItems,p=r.globalSettings.itemsPerMinute;if(c(l,u,this.counter))return o(this.platform,this.platformOptions,u+" max items reached",!1);if(c(l,p,this.perMinCounter))return o(this.platform,this.platformOptions,p+" items per minute reached",!1);this.counter++,this.perMinCounter++;var m=!c(l,u,this.counter),g=m;return m=m&&!c(l,p,this.perMinCounter),o(this.platform,this.platformOptions,null,m,u,p,g)},r.prototype.setPlatformOptions=function(l,h){this.platform=l,this.platformOptions=h},t.exports=r},function(t,s,n){var a=Object.prototype.hasOwnProperty,r=Object.prototype.toString,c=function(o){if(!o||r.call(o)!=="[object Object]")return!1;var l,h=a.call(o,"constructor"),d=o.constructor&&o.constructor.prototype&&a.call(o.constructor.prototype,"isPrototypeOf");if(o.constructor&&!h&&!d)return!1;for(l in o);return l===void 0||a.call(o,l)};t.exports=function o(){var l,h,d,u,p,m={},g=null,y=arguments.length;for(l=0;l<y;l++)if((g=arguments[l])!=null)for(p in g)h=m[p],m!==(d=g[p])&&(d&&c(d)?(u=h&&c(h)?h:{},m[p]=o(u,d)):d!==void 0&&(m[p]=d));return m}},function(t,s,n){var a=n(0);function r(o,l,h,d){this.rateLimiter=o,this.api=l,this.logger=h,this.options=d,this.predicates=[],this.pendingItems=[],this.pendingRequests=[],this.retryQueue=[],this.retryHandle=null,this.waitCallback=null,this.waitIntervalID=null}r.prototype.configure=function(o){this.api&&this.api.configure(o);var l=this.options;return this.options=a.merge(l,o),this},r.prototype.addPredicate=function(o){return a.isFunction(o)&&this.predicates.push(o),this},r.prototype.addPendingItem=function(o){this.pendingItems.push(o)},r.prototype.removePendingItem=function(o){var l=this.pendingItems.indexOf(o);l!==-1&&this.pendingItems.splice(l,1)},r.prototype.addItem=function(o,l,h,d){l&&a.isFunction(l)||(l=function(){});var u=this._applyPredicates(o);if(u.stop)return this.removePendingItem(d),void l(u.err);if(this._maybeLog(o,h),this.removePendingItem(d),this.options.transmit){this.pendingRequests.push(o);try{this._makeApiRequest(o,function(p,m){this._dequeuePendingRequest(o),l(p,m)}.bind(this))}catch(p){this._dequeuePendingRequest(o),l(p)}}else l(new Error("Transmit disabled"))},r.prototype.wait=function(o){a.isFunction(o)&&(this.waitCallback=o,this._maybeCallWait()||(this.waitIntervalID&&(this.waitIntervalID=clearInterval(this.waitIntervalID)),this.waitIntervalID=setInterval(function(){this._maybeCallWait()}.bind(this),500)))},r.prototype._applyPredicates=function(o){for(var l=null,h=0,d=this.predicates.length;h<d;h++)if(!(l=this.predicates[h](o,this.options))||l.err!==void 0)return{stop:!0,err:l.err};return{stop:!1,err:null}},r.prototype._makeApiRequest=function(o,l){var h=this.rateLimiter.shouldSend(o);h.shouldSend?this.api.postItem(o,function(d,u){d?this._maybeRetry(d,o,l):l(d,u)}.bind(this)):h.error?l(h.error):this.api.postItem(h.payload,l)};var c=["ECONNRESET","ENOTFOUND","ESOCKETTIMEDOUT","ETIMEDOUT","ECONNREFUSED","EHOSTUNREACH","EPIPE","EAI_AGAIN"];r.prototype._maybeRetry=function(o,l,h){var d=!1;if(this.options.retryInterval){for(var u=0,p=c.length;u<p;u++)if(o.code===c[u]){d=!0;break}d&&a.isFiniteNumber(this.options.maxRetries)&&(l.retries=l.retries?l.retries+1:1,l.retries>this.options.maxRetries&&(d=!1))}d?this._retryApiRequest(l,h):h(o)},r.prototype._retryApiRequest=function(o,l){this.retryQueue.push({item:o,callback:l}),this.retryHandle||(this.retryHandle=setInterval(function(){for(;this.retryQueue.length;){var h=this.retryQueue.shift();this._makeApiRequest(h.item,h.callback)}}.bind(this),this.options.retryInterval))},r.prototype._dequeuePendingRequest=function(o){var l=this.pendingRequests.indexOf(o);l!==-1&&(this.pendingRequests.splice(l,1),this._maybeCallWait())},r.prototype._maybeLog=function(o,l){if(this.logger&&this.options.verbose){var h=l;if(h=(h=h||a.get(o,"body.trace.exception.message"))||a.get(o,"body.trace_chain.0.exception.message"))return void this.logger.error(h);(h=a.get(o,"body.message.body"))&&this.logger.log(h)}},r.prototype._maybeCallWait=function(){return!(!a.isFunction(this.waitCallback)||this.pendingItems.length!==0||this.pendingRequests.length!==0)&&(this.waitIntervalID&&(this.waitIntervalID=clearInterval(this.waitIntervalID)),this.waitCallback(),!0)},t.exports=r},function(t,s,n){var a=n(0);function r(c,o){this.queue=c,this.options=o,this.transforms=[],this.diagnostic={}}r.prototype.configure=function(c){this.queue&&this.queue.configure(c);var o=this.options;return this.options=a.merge(o,c),this},r.prototype.addTransform=function(c){return a.isFunction(c)&&this.transforms.push(c),this},r.prototype.log=function(c,o){if(o&&a.isFunction(o)||(o=function(){}),!this.options.enabled)return o(new Error("Rollbar is not enabled"));this.queue.addPendingItem(c);var l=c.err;this._applyTransforms(c,function(h,d){if(h)return this.queue.removePendingItem(c),o(h,null);this.queue.addItem(d,o,l,c)}.bind(this))},r.prototype._applyTransforms=function(c,o){var l=-1,h=this.transforms.length,d=this.transforms,u=this.options,p=function(m,g){m?o(m,null):++l!==h?d[l](g,u,p):o(null,g)};p(null,c)},t.exports=r},function(t,s,n){var a=n(0),r=n(16),c={hostname:"api.rollbar.com",path:"/api/1/item/",search:null,version:"1",protocol:"https:",port:443};function o(h,d,u,p,m){this.options=h,this.transport=d,this.url=u,this.truncation=p,this.jsonBackup=m,this.accessToken=h.accessToken,this.transportOptions=l(h,u)}function l(h,d){return r.getTransportFromOptions(h,c,d)}o.prototype.postItem=function(h,d){var u=r.transportOptions(this.transportOptions,"POST"),p=r.buildPayload(this.accessToken,h,this.jsonBackup),m=this;setTimeout(function(){m.transport.post(m.accessToken,u,p,d)},0)},o.prototype.buildJsonPayload=function(h,d){var u,p=r.buildPayload(this.accessToken,h,this.jsonBackup);return(u=this.truncation?this.truncation.truncate(p):a.stringify(p)).error?(d&&d(u.error),null):u.value},o.prototype.postJsonPayload=function(h,d){var u=r.transportOptions(this.transportOptions,"POST");this.transport.postJsonPayload(this.accessToken,u,h,d)},o.prototype.configure=function(h){var d=this.oldOptions;return this.options=a.merge(d,h),this.transportOptions=l(this.options,this.url),this.options.accessToken!==void 0&&(this.accessToken=this.options.accessToken),this},t.exports=o},function(t,s,n){var a=n(0);t.exports={buildPayload:function(r,c,o){if(!a.isType(c.context,"string")){var l=a.stringify(c.context,o);l.error?c.context="Error: could not serialize 'context'":c.context=l.value||"",c.context.length>255&&(c.context=c.context.substr(0,255))}return{access_token:r,data:c}},getTransportFromOptions:function(r,c,o){var l=c.hostname,h=c.protocol,d=c.port,u=c.path,p=c.search,m=r.timeout,g=function(E){var S=typeof window<"u"&&window||typeof self<"u"&&self,I=E.defaultTransport||"xhr";return S.fetch===void 0&&(I="xhr"),S.XMLHttpRequest===void 0&&(I="fetch"),I}(r),y=r.proxy;if(r.endpoint){var f=o.parse(r.endpoint);l=f.hostname,h=f.protocol,d=f.port,u=f.pathname,p=f.search}return{timeout:m,hostname:l,protocol:h,port:d,path:u,search:p,proxy:y,transport:g}},transportOptions:function(r,c){var o=r.protocol||"https:",l=r.port||(o==="http:"?80:o==="https:"?443:void 0),h=r.hostname,d=r.path,u=r.timeout,p=r.transport;return r.search&&(d+=r.search),r.proxy&&(d=o+"//"+h+d,h=r.proxy.host||r.proxy.hostname,l=r.proxy.port,o=r.proxy.protocol||o),{timeout:u,protocol:o,hostname:h,path:d,port:l,method:c,transport:p}},appendPathToPath:function(r,c){var o=/\/$/.test(r),l=/^\//.test(c);return o&&l?c=c.substring(1):o||l||(c="/"+c),r+c}}},function(t,s){(function(n){n.console||(n.console={});for(var a,r,c=n.console,o=function(){},l=["memory"],h="assert,clear,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profiles,profileEnd,show,table,time,timeEnd,timeline,timelineEnd,timeStamp,trace,warn".split(",");a=l.pop();)c[a]||(c[a]={});for(;r=h.pop();)c[r]||(c[r]=o)})(typeof window>"u"?this:window)},function(t,s,n){var a={ieVersion:function(){if(typeof document<"u"){for(var r=3,c=document.createElement("div"),o=c.getElementsByTagName("i");c.innerHTML="<!--[if gt IE "+ ++r+"]><i></i><![endif]-->",o[0];);return r>4?r:void 0}}};t.exports=a},function(t,s,n){function a(r,c,o,l){r._rollbarWrappedError&&(l[4]||(l[4]=r._rollbarWrappedError),l[5]||(l[5]=r._rollbarWrappedError._rollbarContext),r._rollbarWrappedError=null);var h=c.handleUncaughtException.apply(c,l);o&&o.apply(r,l),h==="anonymous"&&(c.anonymousErrorsPending+=1)}t.exports={captureUncaughtExceptions:function(r,c,o){if(r){var l;if(typeof c._rollbarOldOnError=="function")l=c._rollbarOldOnError;else if(r.onerror){for(l=r.onerror;l._rollbarOldOnError;)l=l._rollbarOldOnError;c._rollbarOldOnError=l}c.handleAnonymousErrors();var h=function(){var d=Array.prototype.slice.call(arguments,0);a(r,c,l,d)};o&&(h._rollbarOldOnError=l),r.onerror=h}},captureUnhandledRejections:function(r,c,o){if(r){typeof r._rollbarURH=="function"&&r._rollbarURH.belongsToShim&&r.removeEventListener("unhandledrejection",r._rollbarURH);var l=function(h){var d,u,p;try{d=h.reason}catch{d=void 0}try{u=h.promise}catch{u="[unhandledrejection] error getting `promise` from event"}try{p=h.detail,!d&&p&&(d=p.reason,u=p.promise)}catch{}d||(d="[unhandledrejection] error getting `reason` from event"),c&&c.handleUnhandledRejection&&c.handleUnhandledRejection(d,u)};l.belongsToShim=o,r._rollbarURH=l,r.addEventListener("unhandledrejection",l)}}}},function(t,s,n){var a=n(0),r=n(21),c=n(22);function o(l){this.truncation=l}o.prototype.get=function(l,h,d,u,p){u&&a.isFunction(u)||(u=function(){}),a.addParamsAndAccessTokenToPath(l,h,d);var m=a.formatUrl(h);this._makeZoneRequest(l,m,"GET",null,u,p,h.timeout,h.transport)},o.prototype.post=function(l,h,d,u,p){if(u&&a.isFunction(u)||(u=function(){}),!d)return u(new Error("Cannot send empty request"));var m;if((m=this.truncation?this.truncation.truncate(d):a.stringify(d)).error)return u(m.error);var g=m.value,y=a.formatUrl(h);this._makeZoneRequest(l,y,"POST",g,u,p,h.timeout,h.transport)},o.prototype.postJsonPayload=function(l,h,d,u,p){u&&a.isFunction(u)||(u=function(){});var m=a.formatUrl(h);this._makeZoneRequest(l,m,"POST",d,u,p,h.timeout,h.transport)},o.prototype._makeZoneRequest=function(){var l=typeof window<"u"&&window||p!==void 0&&p,h=l&&l.Zone&&l.Zone.current,d=Array.prototype.slice.call(arguments);if(h&&h._name==="angular"){var u=h._parent,p=this;u.run(function(){p._makeRequest.apply(void 0,d)})}else this._makeRequest.apply(void 0,d)},o.prototype._makeRequest=function(l,h,d,u,p,m,g,y){if(typeof RollbarProxy<"u")return function(f,E){new RollbarProxy().sendJsonPayload(f,function(S){},function(S){E(new Error(S))})}(u,p);y==="fetch"?r(l,h,d,u,p,g):c(l,h,d,u,p,m,g)},t.exports=o},function(t,s,n){var a=n(1),r=n(0);t.exports=function(c,o,l,h,d,u){var p,m;r.isFiniteNumber(u)&&(p=new AbortController,m=setTimeout(function(){p.abort()},u)),fetch(o,{method:l,headers:{"Content-Type":"application/json","X-Rollbar-Access-Token":c,signal:p&&p.signal},body:h}).then(function(g){return m&&clearTimeout(m),g.json()}).then(function(g){d(null,g)}).catch(function(g){a.error(g.message),d(g)})}},function(t,s,n){var a=n(0),r=n(1);function c(o,l){var h=new Error(o);return h.code=l||"ENOTFOUND",h}t.exports=function(o,l,h,d,u,p,m){var g;if(!(g=p?p():function(){var E,S,I=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],T=I.length;for(S=0;S<T;S++)try{E=I[S]();break}catch{}return E}()))return u(new Error("No way to send a request"));try{try{var y=function(){try{if(y&&g.readyState===4){y=void 0;var E=a.jsonParse(g.responseText);if((T=g)&&T.status&&T.status===200)return void u(E.error,E.value);if(function(b){return b&&a.isType(b.status,"number")&&b.status>=400&&b.status<600}(g)){if(g.status===403){var S=E.value&&E.value.message;r.error(S)}u(new Error(String(g.status)))}else u(c("XHR response had no status code (likely connection failure)"))}}catch(b){var I;I=b&&b.stack?b:new Error(b),u(I)}var T};g.open(h,l,!0),g.setRequestHeader&&(g.setRequestHeader("Content-Type","application/json"),g.setRequestHeader("X-Rollbar-Access-Token",o)),a.isFiniteNumber(m)&&(g.timeout=m),g.onreadystatechange=y,g.send(d)}catch{if(typeof XDomainRequest<"u"){if(!window||!window.location)return u(new Error("No window available during request, unknown environment"));window.location.href.substring(0,5)==="http:"&&l.substring(0,5)==="https"&&(l="http"+l.substring(5));var f=new XDomainRequest;f.onprogress=function(){},f.ontimeout=function(){u(c("Request timed out","ETIMEDOUT"))},f.onerror=function(){u(new Error("Error during request"))},f.onload=function(){var S=a.jsonParse(f.responseText);u(S.error,S.value)},f.open(h,l,!0),f.send(d)}else u(new Error("Cannot find a method to transport a request"))}}catch(E){u(E)}}},function(t,s,n){var a=n(0),r=n(3),c=n(1);function o(u,p,m){var g=u.message,y=u.custom;g||(g="Item sent with null or missing arguments.");var f={body:g};y&&(f.extra=a.merge(y)),a.set(u,"data.body",{message:f}),m(null,u)}function l(u){var p=u.stackInfo.stack;return p&&p.length===0&&u._unhandledStackInfo&&u._unhandledStackInfo.stack&&(p=u._unhandledStackInfo.stack),p}function h(u,p,m){var g=u&&u.data.description,y=u&&u.custom,f=l(u),E=r.guessErrorClass(p.message),S={exception:{class:d(p,E[0],m),message:E[1]}};if(g&&(S.exception.description=g),f){var I,T,b,O,_,w,v,M;for(f.length===0&&(S.exception.stack=p.rawStack,S.exception.raw=String(p.rawException)),S.frames=[],v=0;v<f.length;++v)T={filename:(I=f[v]).url?a.sanitizeUrl(I.url):"(unknown)",lineno:I.line||null,method:I.func&&I.func!=="?"?I.func:"[anonymous]",colno:I.column},m.sendFrameUrl&&(T.url=I.url),T.method&&T.method.endsWith&&T.method.endsWith("_rollbar_wrapped")||(b=O=_=null,(w=I.context?I.context.length:0)&&(M=Math.floor(w/2),O=I.context.slice(0,M),b=I.context[M],_=I.context.slice(M)),b&&(T.code=b),(O||_)&&(T.context={},O&&O.length&&(T.context.pre=O),_&&_.length&&(T.context.post=_)),I.args&&(T.args=I.args),S.frames.push(T));S.frames.reverse(),y&&(S.extra=a.merge(y))}return S}function d(u,p,m){return u.name?u.name:m.guessErrorClass?p:"(unknown)"}t.exports={handleDomException:function(u,p,m){if(u.err&&r.Stack(u.err).name==="DOMException"){var g=new Error;g.name=u.err.name,g.message=u.err.message,g.stack=u.err.stack,g.nested=u.err,u.err=g}m(null,u)},handleItemWithError:function(u,p,m){if(u.data=u.data||{},u.err)try{u.stackInfo=u.err._savedStackTrace||r.parse(u.err,u.skipFrames),p.addErrorContext&&function(g){var y=[],f=g.err;for(y.push(f);f.nested||f.cause;)f=f.nested||f.cause,y.push(f);a.addErrorContext(g,y)}(u)}catch(g){c.error("Error while parsing the error object.",g);try{u.message=u.err.message||u.err.description||u.message||String(u.err)}catch(y){u.message=String(u.err)||String(y)}delete u.err}m(null,u)},ensureItemHasSomethingToSay:function(u,p,m){u.message||u.stackInfo||u.custom||m(new Error("No message, stack info, or custom data"),null),m(null,u)},addBaseInfo:function(u,p,m){var g=p.payload&&p.payload.environment||p.environment;u.data=a.merge(u.data,{environment:g,level:u.level,endpoint:p.endpoint,platform:"browser",framework:"browser-js",language:"javascript",server:{},uuid:u.uuid,notifier:{name:"rollbar-browser-js",version:p.version},custom:u.custom}),m(null,u)},addRequestInfo:function(u){return function(p,m,g){var y={};u&&u.location&&(y.url=u.location.href,y.query_string=u.location.search);var f="$remote_ip";m.captureIp?m.captureIp!==!0&&(f+="_anonymize"):f=null,f&&(y.user_ip=f),Object.keys(y).length>0&&a.set(p,"data.request",y),g(null,p)}},addClientInfo:function(u){return function(p,m,g){if(!u)return g(null,p);var y=u.navigator||{},f=u.screen||{};a.set(p,"data.client",{runtime_ms:p.timestamp-u._rollbarStartTime,timestamp:Math.round(p.timestamp/1e3),javascript:{browser:y.userAgent,language:y.language,cookie_enabled:y.cookieEnabled,screen:{width:f.width,height:f.height}}}),g(null,p)}},addPluginInfo:function(u){return function(p,m,g){if(!u||!u.navigator)return g(null,p);for(var y,f=[],E=u.navigator.plugins||[],S=0,I=E.length;S<I;++S)y=E[S],f.push({name:y.name,description:y.description});a.set(p,"data.client.javascript.plugins",f),g(null,p)}},addBody:function(u,p,m){u.stackInfo?u.stackInfo.traceChain?function(g,y,f){for(var E=g.stackInfo.traceChain,S=[],I=E.length,T=0;T<I;T++){var b=h(g,E[T],y);S.push(b)}a.set(g,"data.body",{trace_chain:S}),f(null,g)}(u,p,m):function(g,y,f){if(l(g)){var E=h(g,g.stackInfo,y);a.set(g,"data.body",{trace:E}),f(null,g)}else{var S=g.stackInfo,I=r.guessErrorClass(S.message),T=d(S,I[0],y),b=I[1];g.message=T+": "+b,o(g,y,f)}}(u,p,m):o(u,p,m)},addScrubber:function(u){return function(p,m,g){if(u){var y=m.scrubFields||[],f=m.scrubPaths||[];p.data=u(p.data,y,f)}g(null,p)}}}},function(t,s,n){var a,r,c;(function(o,l){r=[n(25)],(c=typeof(a=function(h){var d=/(^|@)\S+:\d+/,u=/^\s*at .*(\S+:\d+|\(native\))/m,p=/^(eval@)?(\[native code])?$/;return{parse:function(m){if(m.stacktrace!==void 0||m["opera#sourceloc"]!==void 0)return this.parseOpera(m);if(m.stack&&m.stack.match(u))return this.parseV8OrIE(m);if(m.stack)return this.parseFFOrSafari(m);throw new Error("Cannot parse given Error object")},extractLocation:function(m){if(m.indexOf(":")===-1)return[m];var g=/(.+?)(?::(\d+))?(?::(\d+))?$/.exec(m.replace(/[()]/g,""));return[g[1],g[2]||void 0,g[3]||void 0]},parseV8OrIE:function(m){return m.stack.split(`
`).filter(function(g){return!!g.match(u)},this).map(function(g){g.indexOf("(eval ")>-1&&(g=g.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var y=g.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),f=y.match(/ (\(.+\)$)/);y=f?y.replace(f[0],""):y;var E=this.extractLocation(f?f[1]:y),S=f&&y||void 0,I=["eval","<anonymous>"].indexOf(E[0])>-1?void 0:E[0];return new h({functionName:S,fileName:I,lineNumber:E[1],columnNumber:E[2],source:g})},this)},parseFFOrSafari:function(m){return m.stack.split(`
`).filter(function(g){return!g.match(p)},this).map(function(g){if(g.indexOf(" > eval")>-1&&(g=g.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),g.indexOf("@")===-1&&g.indexOf(":")===-1)return new h({functionName:g});var y=/((.*".+"[^@]*)?[^@]*)(?:@)/,f=g.match(y),E=f&&f[1]?f[1]:void 0,S=this.extractLocation(g.replace(y,""));return new h({functionName:E,fileName:S[0],lineNumber:S[1],columnNumber:S[2],source:g})},this)},parseOpera:function(m){return!m.stacktrace||m.message.indexOf(`
`)>-1&&m.message.split(`
`).length>m.stacktrace.split(`
`).length?this.parseOpera9(m):m.stack?this.parseOpera11(m):this.parseOpera10(m)},parseOpera9:function(m){for(var g=/Line (\d+).*script (?:in )?(\S+)/i,y=m.message.split(`
`),f=[],E=2,S=y.length;E<S;E+=2){var I=g.exec(y[E]);I&&f.push(new h({fileName:I[2],lineNumber:I[1],source:y[E]}))}return f},parseOpera10:function(m){for(var g=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,y=m.stacktrace.split(`
`),f=[],E=0,S=y.length;E<S;E+=2){var I=g.exec(y[E]);I&&f.push(new h({functionName:I[3]||void 0,fileName:I[2],lineNumber:I[1],source:y[E]}))}return f},parseOpera11:function(m){return m.stack.split(`
`).filter(function(g){return!!g.match(d)&&!g.match(/^Error created at/)},this).map(function(g){var y,f=g.split("@"),E=this.extractLocation(f.pop()),S=f.shift()||"",I=S.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0;S.match(/\(([^)]*)\)/)&&(y=S.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var T=y===void 0||y==="[arguments not available]"?void 0:y.split(",");return new h({functionName:I,args:T,fileName:E[0],lineNumber:E[1],columnNumber:E[2],source:g})},this)}}})=="function"?a.apply(s,r):a)===void 0||(t.exports=c)})()},function(t,s,n){var a,r,c;(function(o,l){r=[],(c=typeof(a=function(){function h(I){return I.charAt(0).toUpperCase()+I.substring(1)}function d(I){return function(){return this[I]}}var u=["isConstructor","isEval","isNative","isToplevel"],p=["columnNumber","lineNumber"],m=["fileName","functionName","source"],g=u.concat(p,m,["args"],["evalOrigin"]);function y(I){if(I)for(var T=0;T<g.length;T++)I[g[T]]!==void 0&&this["set"+h(g[T])](I[g[T]])}y.prototype={getArgs:function(){return this.args},setArgs:function(I){if(Object.prototype.toString.call(I)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=I},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(I){if(I instanceof y)this.evalOrigin=I;else{if(!(I instanceof Object))throw new TypeError("Eval Origin must be an Object or StackFrame");this.evalOrigin=new y(I)}},toString:function(){var I=this.getFileName()||"",T=this.getLineNumber()||"",b=this.getColumnNumber()||"",O=this.getFunctionName()||"";return this.getIsEval()?I?"[eval] ("+I+":"+T+":"+b+")":"[eval]:"+T+":"+b:O?O+" ("+I+":"+T+":"+b+")":I+":"+T+":"+b}},y.fromString=function(I){var T=I.indexOf("("),b=I.lastIndexOf(")"),O=I.substring(0,T),_=I.substring(T+1,b).split(","),w=I.substring(b+1);if(w.indexOf("@")===0)var v=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(w,""),M=v[1],L=v[2],N=v[3];return new y({functionName:O,args:_||void 0,fileName:M,lineNumber:L||void 0,columnNumber:N||void 0})};for(var f=0;f<u.length;f++)y.prototype["get"+h(u[f])]=d(u[f]),y.prototype["set"+h(u[f])]=function(I){return function(T){this[I]=Boolean(T)}}(u[f]);for(var E=0;E<p.length;E++)y.prototype["get"+h(p[E])]=d(p[E]),y.prototype["set"+h(p[E])]=function(I){return function(T){if(b=T,isNaN(parseFloat(b))||!isFinite(b))throw new TypeError(I+" must be a Number");var b;this[I]=Number(T)}}(p[E]);for(var S=0;S<m.length;S++)y.prototype["get"+h(m[S])]=d(m[S]),y.prototype["set"+h(m[S])]=function(I){return function(T){this[I]=String(T)}}(m[S]);return y})=="function"?a.apply(s,r):a)===void 0||(t.exports=c)})()},function(t,s,n){var a=n(0);function r(c,o){a.isFunction(c[o])&&(c[o]=c[o].toString())}t.exports={itemToPayload:function(c,o,l){var h=c.data;c._isUncaught&&(h._isUncaught=!0),c._originalArgs&&(h._originalArgs=c._originalArgs),l(null,h)},addPayloadOptions:function(c,o,l){var h=o.payload||{};h.body&&delete h.body,c.data=a.merge(c.data,h),l(null,c)},addTelemetryData:function(c,o,l){c.telemetryEvents&&a.set(c,"data.body.telemetry",c.telemetryEvents),l(null,c)},addMessageWithError:function(c,o,l){if(c.message){var h="data.body.trace_chain.0",d=a.get(c,h);if(d||(h="data.body.trace",d=a.get(c,h)),d){if(!d.exception||!d.exception.description)return a.set(c,h+".exception.description",c.message),void l(null,c);var u=a.get(c,h+".extra")||{},p=a.merge(u,{message:c.message});a.set(c,h+".extra",p)}l(null,c)}else l(null,c)},userTransform:function(c){return function(o,l,h){var d=a.merge(o),u=null;try{a.isFunction(l.transform)&&(u=l.transform(d.data,o))}catch(p){return l.transform=null,c.error("Error while calling custom transform() function. Removing custom transform().",p),void h(null,o)}a.isPromise(u)?u.then(function(p){p&&(d.data=p),h(null,d)},function(p){h(p,o)}):h(null,d)}},addConfigToPayload:function(c,o,l){if(!o.sendConfig)return l(null,c);var h=a.get(c,"data.custom")||{};h._rollbarConfig=o,c.data.custom=h,l(null,c)},addConfiguredOptions:function(c,o,l){var h=o._configuredOptions;r(h,"transform"),r(h,"checkIgnore"),r(h,"onSendCallback"),delete h.accessToken,c.data.notifier.configured_options=h,l(null,c)},addDiagnosticKeys:function(c,o,l){var h=a.merge(c.notifier.client.notifier.diagnostic,c.diagnostic);if(a.get(c,"err._isAnonymous")&&(h.is_anonymous=!0),c._isUncaught&&(h.is_uncaught=c._isUncaught),c.err)try{h.raw_error={message:c.err.message,name:c.err.name,constructor_name:c.err.constructor&&c.err.constructor.name,filename:c.err.fileName,line:c.err.lineNumber,column:c.err.columnNumber,stack:c.err.stack}}catch(d){h.raw_error={failed:String(d)}}c.data.notifier.diagnostic=a.merge(c.data.notifier.diagnostic,h),l(null,c)}}},function(t,s,n){var a=n(0);t.exports={checkIgnore:function(r,c){return!a.get(c,"plugins.jquery.ignoreAjaxErrors")||!a.get(r,"body.message.extra.isAjax")}}},function(t,s,n){var a=n(0);function r(o,l,h){if(!o)return!h;var d,u,p=o.frames;if(!p||p.length===0)return!h;for(var m=l.length,g=p.length,y=0;y<g;y++){if(d=p[y].filename,!a.isType(d,"string"))return!h;for(var f=0;f<m;f++)if(u=l[f],new RegExp(u).test(d))return!0}return!1}function c(o,l,h,d){var u,p,m=!1;h==="blocklist"&&(m=!0);try{if(u=m?l.hostBlockList:l.hostSafeList,p=a.get(o,"body.trace_chain")||[a.get(o,"body.trace")],!u||u.length===0||p.length===0||!p[0])return!m;for(var g=p.length,y=0;y<g;y++)if(r(p[y],u,m))return!0}catch(E){m?l.hostBlockList=null:l.hostSafeList=null;var f=m?"hostBlockList":"hostSafeList";return d.error("Error while reading your configuration's "+f+" option. Removing custom "+f+".",E),!m}return!1}t.exports={checkLevel:function(o,l){var h=o.level,d=a.LEVELS[h]||0,u=l.reportLevel;return!(d<(a.LEVELS[u]||0))},userCheckIgnore:function(o){return function(l,h){var d=!!l._isUncaught;delete l._isUncaught;var u=l._originalArgs;delete l._originalArgs;try{a.isFunction(h.onSendCallback)&&h.onSendCallback(d,u,l)}catch(p){h.onSendCallback=null,o.error("Error while calling onSendCallback, removing",p)}try{if(a.isFunction(h.checkIgnore)&&h.checkIgnore(d,u,l))return!1}catch(p){h.checkIgnore=null,o.error("Error while calling custom checkIgnore(), removing",p)}return!0}},urlIsNotBlockListed:function(o){return function(l,h){return!c(l,h,"blocklist",o)}},urlIsSafeListed:function(o){return function(l,h){return c(l,h,"safelist",o)}},messageIsIgnored:function(o){return function(l,h){var d,u,p,m,g,y;try{if(!(p=h.ignoredMessages)||p.length===0||(y=function(f){var E=f.body,S=[];if(E.trace_chain)for(var I=E.trace_chain,T=0;T<I.length;T++){var b=I[T];S.push(a.get(b,"exception.message"))}return E.trace&&S.push(a.get(E,"trace.exception.message")),E.message&&S.push(a.get(E,"message.body")),S}(l)).length===0)return!0;for(m=p.length,d=0;d<m;d++)for(g=new RegExp(p[d],"gi"),u=0;u<y.length;u++)if(g.test(y[u]))return!1}catch{h.ignoredMessages=null,o.error("Error while reading your configuration's ignoredMessages option. Removing custom ignoredMessages.")}return!0}}}},function(t,s,n){t.exports={version:"2.26.1",endpoint:"api.rollbar.com/api/1/item/",logLevel:"debug",reportLevel:"debug",uncaughtErrorLevel:"error",maxItems:0,itemsPerMin:60}},function(t,s,n){t.exports={scrubFields:["pw","pass","passwd","password","secret","confirm_password","confirmPassword","password_confirmation","passwordConfirmation","access_token","accessToken","X-Rollbar-Access-Token","secret_key","secretKey","secretToken","cc-number","card number","cardnumber","cardnum","ccnum","ccnumber","cc num","creditcardnumber","credit card number","newcreditcardnumber","new credit card","creditcardno","credit card no","card#","card #","cc-csc","cvc","cvc2","cvv2","ccv2","security code","card verification","name on credit card","name on card","nameoncard","cardholder","card holder","name des karteninhabers","ccname","card type","cardtype","cc type","cctype","payment type","expiration date","expirationdate","expdate","cc-exp","ccmonth","ccyear"]}},function(t,s,n){var a=n(0);function r(o){this.queue=[],this.options=a.merge(o);var l=this.options.maxTelemetryEvents||100;this.maxQueueSize=Math.max(0,Math.min(l,100))}function c(o,l){return l||{error:"error",manual:"info"}[o]||"info"}r.prototype.configure=function(o){var l=this.options;this.options=a.merge(l,o);var h=this.options.maxTelemetryEvents||100,d=Math.max(0,Math.min(h,100)),u=0;this.maxQueueSize>d&&(u=this.maxQueueSize-d),this.maxQueueSize=d,this.queue.splice(0,u)},r.prototype.copyEvents=function(){var o=Array.prototype.slice.call(this.queue,0);if(a.isFunction(this.options.filterTelemetry))try{for(var l=o.length;l--;)this.options.filterTelemetry(o[l])&&o.splice(l,1)}catch{this.options.filterTelemetry=null}return o},r.prototype.capture=function(o,l,h,d,u){var p={level:c(o,h),type:o,timestamp_ms:u||a.now(),body:l,source:"client"};d&&(p.uuid=d);try{if(a.isFunction(this.options.filterTelemetry)&&this.options.filterTelemetry(p))return!1}catch{this.options.filterTelemetry=null}return this.push(p),p},r.prototype.captureEvent=function(o,l,h,d){return this.capture(o,l,h,d)},r.prototype.captureError=function(o,l,h,d){var u={message:o.message||String(o)};return o.stack&&(u.stack=o.stack),this.capture("error",u,l,h,d)},r.prototype.captureLog=function(o,l,h,d){return this.capture("log",{message:o},l,h,d)},r.prototype.captureNetwork=function(o,l,h,d){l=l||"xhr",o.subtype=o.subtype||l,d&&(o.request=d);var u=this.levelFromStatus(o.status_code);return this.capture("network",o,u,h)},r.prototype.levelFromStatus=function(o){return o>=200&&o<400?"info":o===0||o>=400?"error":"info"},r.prototype.captureDom=function(o,l,h,d,u){var p={subtype:o,element:l};return h!==void 0&&(p.value=h),d!==void 0&&(p.checked=d),this.capture("dom",p,"info",u)},r.prototype.captureNavigation=function(o,l,h){return this.capture("navigation",{from:o,to:l},"info",h)},r.prototype.captureDomContentLoaded=function(o){return this.capture("navigation",{subtype:"DOMContentLoaded"},"info",void 0,o&&o.getTime())},r.prototype.captureLoad=function(o){return this.capture("navigation",{subtype:"load"},"info",void 0,o&&o.getTime())},r.prototype.captureConnectivityChange=function(o,l){return this.captureNetwork({change:o},"connectivity",l)},r.prototype._captureRollbarItem=function(o){if(this.options.includeItemsInTelemetry)return o.err?this.captureError(o.err,o.level,o.uuid,o.timestamp):o.message?this.captureLog(o.message,o.level,o.uuid,o.timestamp):o.custom?this.capture("log",o.custom,o.level,o.uuid,o.timestamp):void 0},r.prototype.push=function(o){this.queue.push(o),this.queue.length>this.maxQueueSize&&this.queue.shift()},t.exports=r},function(t,s,n){var a=n(0),r=n(33),c=n(4),o=n(2),l=n(34),h={network:!0,networkResponseHeaders:!1,networkResponseBody:!1,networkRequestHeaders:!1,networkRequestBody:!1,networkErrorOnHttp5xx:!1,networkErrorOnHttp4xx:!1,networkErrorOnHttp0:!1,log:!0,dom:!0,navigation:!0,connectivity:!0,contentSecurityPolicy:!0,errorOnContentSecurityPolicy:!1};function d(m,g,y,f,E){var S=m[g];m[g]=y(S),f&&f[E].push([m,g,S])}function u(m,g){for(var y;m[g].length;)(y=m[g].shift())[0][y[1]]=y[2]}function p(m,g,y,f,E){this.options=m;var S=m.autoInstrument;m.enabled===!1||S===!1?this.autoInstrument={}:(a.isType(S,"object")||(S=h),this.autoInstrument=a.merge(h,S)),this.scrubTelemetryInputs=!!m.scrubTelemetryInputs,this.telemetryScrubber=m.telemetryScrubber,this.defaultValueScrubber=function(I){for(var T=[],b=0;b<I.length;++b)T.push(new RegExp(I[b],"i"));return function(O){var _=function(v){if(!v||!v.attributes)return null;for(var M=v.attributes,L=0;L<M.length;++L)if(M[L].key==="name")return M[L].value;return null}(O);if(!_)return!1;for(var w=0;w<T.length;++w)if(T[w].test(_))return!0;return!1}}(m.scrubFields),this.telemeter=g,this.rollbar=y,this.diagnostic=y.client.notifier.diagnostic,this._window=f||{},this._document=E||{},this.replacements={network:[],log:[],navigation:[],connectivity:[]},this.eventRemovers={dom:[],connectivity:[],contentsecuritypolicy:[]},this._location=this._window.location,this._lastHref=this._location&&this._location.href}p.prototype.configure=function(m){this.options=a.merge(this.options,m);var g=m.autoInstrument,y=a.merge(this.autoInstrument);m.enabled===!1||g===!1?this.autoInstrument={}:(a.isType(g,"object")||(g=h),this.autoInstrument=a.merge(h,g)),this.instrument(y),m.scrubTelemetryInputs!==void 0&&(this.scrubTelemetryInputs=!!m.scrubTelemetryInputs),m.telemetryScrubber!==void 0&&(this.telemetryScrubber=m.telemetryScrubber)},p.prototype.instrument=function(m){!this.autoInstrument.network||m&&m.network?!this.autoInstrument.network&&m&&m.network&&this.deinstrumentNetwork():this.instrumentNetwork(),!this.autoInstrument.log||m&&m.log?!this.autoInstrument.log&&m&&m.log&&this.deinstrumentConsole():this.instrumentConsole(),!this.autoInstrument.dom||m&&m.dom?!this.autoInstrument.dom&&m&&m.dom&&this.deinstrumentDom():this.instrumentDom(),!this.autoInstrument.navigation||m&&m.navigation?!this.autoInstrument.navigation&&m&&m.navigation&&this.deinstrumentNavigation():this.instrumentNavigation(),!this.autoInstrument.connectivity||m&&m.connectivity?!this.autoInstrument.connectivity&&m&&m.connectivity&&this.deinstrumentConnectivity():this.instrumentConnectivity(),!this.autoInstrument.contentSecurityPolicy||m&&m.contentSecurityPolicy?!this.autoInstrument.contentSecurityPolicy&&m&&m.contentSecurityPolicy&&this.deinstrumentContentSecurityPolicy():this.instrumentContentSecurityPolicy()},p.prototype.deinstrumentNetwork=function(){u(this.replacements,"network")},p.prototype.instrumentNetwork=function(){var m=this;function g(f,E){f in E&&a.isFunction(E[f])&&d(E,f,function(S){return m.rollbar.wrap(S)})}if("XMLHttpRequest"in this._window){var y=this._window.XMLHttpRequest.prototype;d(y,"open",function(f){return function(E,S){return a.isType(S,"string")&&(this.__rollbar_xhr?(this.__rollbar_xhr.method=E,this.__rollbar_xhr.url=S,this.__rollbar_xhr.status_code=null,this.__rollbar_xhr.start_time_ms=a.now(),this.__rollbar_xhr.end_time_ms=null):this.__rollbar_xhr={method:E,url:S,status_code:null,start_time_ms:a.now(),end_time_ms:null}),f.apply(this,arguments)}},this.replacements,"network"),d(y,"setRequestHeader",function(f){return function(E,S){return this.__rollbar_xhr||(this.__rollbar_xhr={}),a.isType(E,"string")&&a.isType(S,"string")&&(m.autoInstrument.networkRequestHeaders&&(this.__rollbar_xhr.request_headers||(this.__rollbar_xhr.request_headers={}),this.__rollbar_xhr.request_headers[E]=S),E.toLowerCase()==="content-type"&&(this.__rollbar_xhr.request_content_type=S)),f.apply(this,arguments)}},this.replacements,"network"),d(y,"send",function(f){return function(E){var S=this;function I(){if(S.__rollbar_xhr&&(S.__rollbar_xhr.status_code===null&&(S.__rollbar_xhr.status_code=0,m.autoInstrument.networkRequestBody&&(S.__rollbar_xhr.request=E),S.__rollbar_event=m.captureNetwork(S.__rollbar_xhr,"xhr",void 0)),S.readyState<2&&(S.__rollbar_xhr.start_time_ms=a.now()),S.readyState>3)){S.__rollbar_xhr.end_time_ms=a.now();var T=null;if(S.__rollbar_xhr.response_content_type=S.getResponseHeader("Content-Type"),m.autoInstrument.networkResponseHeaders){var b=m.autoInstrument.networkResponseHeaders;T={};try{var O,_;if(b===!0){var w=S.getAllResponseHeaders();if(w){var v,M,L=w.trim().split(/[\r\n]+/);for(_=0;_<L.length;_++)O=(v=L[_].split(": ")).shift(),M=v.join(": "),T[O]=M}}else for(_=0;_<b.length;_++)T[O=b[_]]=S.getResponseHeader(O)}catch{}}var N=null;if(m.autoInstrument.networkResponseBody)try{N=S.responseText}catch{}var G=null;(N||T)&&(G={},N&&(m.isJsonContentType(S.__rollbar_xhr.response_content_type)?G.body=m.scrubJson(N):G.body=N),T&&(G.headers=T)),G&&(S.__rollbar_xhr.response=G);try{var B=S.status;B=B===1223?204:B,S.__rollbar_xhr.status_code=B,S.__rollbar_event.level=m.telemeter.levelFromStatus(B),m.errorOnHttpStatus(S.__rollbar_xhr)}catch{}}}return g("onload",S),g("onerror",S),g("onprogress",S),"onreadystatechange"in S&&a.isFunction(S.onreadystatechange)?d(S,"onreadystatechange",function(T){return m.rollbar.wrap(T,void 0,I)}):S.onreadystatechange=I,S.__rollbar_xhr&&m.trackHttpErrors()&&(S.__rollbar_xhr.stack=new Error().stack),f.apply(this,arguments)}},this.replacements,"network")}"fetch"in this._window&&d(this._window,"fetch",function(f){return function(E,S){for(var I=new Array(arguments.length),T=0,b=I.length;T<b;T++)I[T]=arguments[T];var O,_=I[0],w="GET";a.isType(_,"string")?O=_:_&&(O=_.url,_.method&&(w=_.method)),I[1]&&I[1].method&&(w=I[1].method);var v={method:w,url:O,status_code:null,start_time_ms:a.now(),end_time_ms:null};if(I[1]&&I[1].headers){var M=r(I[1].headers);v.request_content_type=M.get("Content-Type"),m.autoInstrument.networkRequestHeaders&&(v.request_headers=m.fetchHeaders(M,m.autoInstrument.networkRequestHeaders))}return m.autoInstrument.networkRequestBody&&(I[1]&&I[1].body?v.request=I[1].body:I[0]&&!a.isType(I[0],"string")&&I[0].body&&(v.request=I[0].body)),m.captureNetwork(v,"fetch",void 0),m.trackHttpErrors()&&(v.stack=new Error().stack),f.apply(this,I).then(function(L){v.end_time_ms=a.now(),v.status_code=L.status,v.response_content_type=L.headers.get("Content-Type");var N=null;m.autoInstrument.networkResponseHeaders&&(N=m.fetchHeaders(L.headers,m.autoInstrument.networkResponseHeaders));var G=null;return m.autoInstrument.networkResponseBody&&typeof L.text=="function"&&(G=L.clone().text()),(N||G)&&(v.response={},G&&(typeof G.then=="function"?G.then(function(B){B&&m.isJsonContentType(v.response_content_type)?v.response.body=m.scrubJson(B):v.response.body=B}):v.response.body=G),N&&(v.response.headers=N)),m.errorOnHttpStatus(v),L})}},this.replacements,"network")},p.prototype.captureNetwork=function(m,g,y){return m.request&&this.isJsonContentType(m.request_content_type)&&(m.request=this.scrubJson(m.request)),this.telemeter.captureNetwork(m,g,y)},p.prototype.isJsonContentType=function(m){return!!(m&&a.isType(m,"string")&&m.toLowerCase().includes("json"))},p.prototype.scrubJson=function(m){return JSON.stringify(c(JSON.parse(m),this.options.scrubFields))},p.prototype.fetchHeaders=function(m,g){var y={};try{var f;if(g===!0){if(typeof m.entries=="function")for(var E=m.entries(),S=E.next();!S.done;)y[S.value[0]]=S.value[1],S=E.next()}else for(f=0;f<g.length;f++){var I=g[f];y[I]=m.get(I)}}catch{}return y},p.prototype.trackHttpErrors=function(){return this.autoInstrument.networkErrorOnHttp5xx||this.autoInstrument.networkErrorOnHttp4xx||this.autoInstrument.networkErrorOnHttp0},p.prototype.errorOnHttpStatus=function(m){var g=m.status_code;if(g>=500&&this.autoInstrument.networkErrorOnHttp5xx||g>=400&&this.autoInstrument.networkErrorOnHttp4xx||g===0&&this.autoInstrument.networkErrorOnHttp0){var y=new Error("HTTP request failed with Status "+g);y.stack=m.stack,this.rollbar.error(y,{skipFrames:1})}},p.prototype.deinstrumentConsole=function(){if("console"in this._window&&this._window.console.log)for(var m;this.replacements.log.length;)m=this.replacements.log.shift(),this._window.console[m[0]]=m[1]},p.prototype.instrumentConsole=function(){if("console"in this._window&&this._window.console.log){var m=this,g=this._window.console,y=["debug","info","warn","error","log"];try{for(var f=0,E=y.length;f<E;f++)S(y[f])}catch(I){this.diagnostic.instrumentConsole={error:I.message}}}function S(I){var T=g[I],b=g,O=I==="warn"?"warning":I;g[I]=function(){var _=Array.prototype.slice.call(arguments),w=a.formatArgsAsString(_);m.telemeter.captureLog(w,O),T&&Function.prototype.apply.call(T,b,_)},m.replacements.log.push([I,T])}},p.prototype.deinstrumentDom=function(){("addEventListener"in this._window||"attachEvent"in this._window)&&this.removeListeners("dom")},p.prototype.instrumentDom=function(){if("addEventListener"in this._window||"attachEvent"in this._window){var m=this.handleClick.bind(this),g=this.handleBlur.bind(this);this.addListener("dom",this._window,"click","onclick",m,!0),this.addListener("dom",this._window,"blur","onfocusout",g,!0)}},p.prototype.handleClick=function(m){try{var g=l.getElementFromEvent(m,this._document),y=g&&g.tagName,f=l.isDescribedElement(g,"a")||l.isDescribedElement(g,"button");y&&(f||l.isDescribedElement(g,"input",["button","submit"]))?this.captureDomEvent("click",g):l.isDescribedElement(g,"input",["checkbox","radio"])&&this.captureDomEvent("input",g,g.value,g.checked)}catch{}},p.prototype.handleBlur=function(m){try{var g=l.getElementFromEvent(m,this._document);g&&g.tagName&&(l.isDescribedElement(g,"textarea")?this.captureDomEvent("input",g,g.value):l.isDescribedElement(g,"select")&&g.options&&g.options.length?this.handleSelectInputChanged(g):l.isDescribedElement(g,"input")&&!l.isDescribedElement(g,"input",["button","submit","hidden","checkbox","radio"])&&this.captureDomEvent("input",g,g.value))}catch{}},p.prototype.handleSelectInputChanged=function(m){if(m.multiple)for(var g=0;g<m.options.length;g++)m.options[g].selected&&this.captureDomEvent("input",m,m.options[g].value);else m.selectedIndex>=0&&m.options[m.selectedIndex]&&this.captureDomEvent("input",m,m.options[m.selectedIndex].value)},p.prototype.captureDomEvent=function(m,g,y,f){if(y!==void 0)if(this.scrubTelemetryInputs||l.getElementType(g)==="password")y="[scrubbed]";else{var E=l.describeElement(g);this.telemetryScrubber?this.telemetryScrubber(E)&&(y="[scrubbed]"):this.defaultValueScrubber(E)&&(y="[scrubbed]")}var S=l.elementArrayToString(l.treeToArray(g));this.telemeter.captureDom(m,S,y,f)},p.prototype.deinstrumentNavigation=function(){var m=this._window.chrome;!(m&&m.app&&m.app.runtime)&&this._window.history&&this._window.history.pushState&&u(this.replacements,"navigation")},p.prototype.instrumentNavigation=function(){var m=this._window.chrome;if(!(m&&m.app&&m.app.runtime)&&this._window.history&&this._window.history.pushState){var g=this;d(this._window,"onpopstate",function(y){return function(){var f=g._location.href;g.handleUrlChange(g._lastHref,f),y&&y.apply(this,arguments)}},this.replacements,"navigation"),d(this._window.history,"pushState",function(y){return function(){var f=arguments.length>2?arguments[2]:void 0;return f&&g.handleUrlChange(g._lastHref,f+""),y.apply(this,arguments)}},this.replacements,"navigation")}},p.prototype.handleUrlChange=function(m,g){var y=o.parse(this._location.href),f=o.parse(g),E=o.parse(m);this._lastHref=g,y.protocol===f.protocol&&y.host===f.host&&(g=f.path+(f.hash||"")),y.protocol===E.protocol&&y.host===E.host&&(m=E.path+(E.hash||"")),this.telemeter.captureNavigation(m,g)},p.prototype.deinstrumentConnectivity=function(){("addEventListener"in this._window||"body"in this._document)&&(this._window.addEventListener?this.removeListeners("connectivity"):u(this.replacements,"connectivity"))},p.prototype.instrumentConnectivity=function(){if("addEventListener"in this._window||"body"in this._document)if(this._window.addEventListener)this.addListener("connectivity",this._window,"online",void 0,function(){this.telemeter.captureConnectivityChange("online")}.bind(this),!0),this.addListener("connectivity",this._window,"offline",void 0,function(){this.telemeter.captureConnectivityChange("offline")}.bind(this),!0);else{var m=this;d(this._document.body,"ononline",function(g){return function(){m.telemeter.captureConnectivityChange("online"),g&&g.apply(this,arguments)}},this.replacements,"connectivity"),d(this._document.body,"onoffline",function(g){return function(){m.telemeter.captureConnectivityChange("offline"),g&&g.apply(this,arguments)}},this.replacements,"connectivity")}},p.prototype.handleCspEvent=function(m){var g="Security Policy Violation: blockedURI: "+m.blockedURI+", violatedDirective: "+m.violatedDirective+", effectiveDirective: "+m.effectiveDirective+", ";m.sourceFile&&(g+="location: "+m.sourceFile+", line: "+m.lineNumber+", col: "+m.columnNumber+", "),g+="originalPolicy: "+m.originalPolicy,this.telemeter.captureLog(g,"error"),this.handleCspError(g)},p.prototype.handleCspError=function(m){this.autoInstrument.errorOnContentSecurityPolicy&&this.rollbar.error(m)},p.prototype.deinstrumentContentSecurityPolicy=function(){"addEventListener"in this._document&&this.removeListeners("contentsecuritypolicy")},p.prototype.instrumentContentSecurityPolicy=function(){if("addEventListener"in this._document){var m=this.handleCspEvent.bind(this);this.addListener("contentsecuritypolicy",this._document,"securitypolicyviolation",null,m,!1)}},p.prototype.addListener=function(m,g,y,f,E,S){g.addEventListener?(g.addEventListener(y,E,S),this.eventRemovers[m].push(function(){g.removeEventListener(y,E,S)})):f&&(g.attachEvent(f,E),this.eventRemovers[m].push(function(){g.detachEvent(f,E)}))},p.prototype.removeListeners=function(m){for(;this.eventRemovers[m].length;)this.eventRemovers[m].shift()()},t.exports=p},function(t,s,n){function a(c){return typeof c!="string"&&(c=String(c)),c.toLowerCase()}function r(c){this.map={},c instanceof r?c.forEach(function(o,l){this.append(l,o)},this):Array.isArray(c)?c.forEach(function(o){this.append(o[0],o[1])},this):c&&Object.getOwnPropertyNames(c).forEach(function(o){this.append(o,c[o])},this)}r.prototype.append=function(c,o){c=a(c),o=function(h){return typeof h!="string"&&(h=String(h)),h}(o);var l=this.map[c];this.map[c]=l?l+", "+o:o},r.prototype.get=function(c){return c=a(c),this.has(c)?this.map[c]:null},r.prototype.has=function(c){return this.map.hasOwnProperty(a(c))},r.prototype.forEach=function(c,o){for(var l in this.map)this.map.hasOwnProperty(l)&&c.call(o,this.map[l],l,this)},r.prototype.entries=function(){var c=[];return this.forEach(function(o,l){c.push([l,o])}),function(o){return{next:function(){var l=o.shift();return{done:l===void 0,value:l}}}}(c)},t.exports=function(c){return typeof Headers>"u"?new r(c):new Headers(c)}},function(t,s,n){function a(o){return(o.getAttribute("type")||"").toLowerCase()}function r(o){if(!o||!o.tagName)return"";var l=[o.tagName];o.id&&l.push("#"+o.id),o.classes&&l.push("."+o.classes.join("."));for(var h=0;h<o.attributes.length;h++)l.push("["+o.attributes[h].key+'="'+o.attributes[h].value+'"]');return l.join("")}function c(o){if(!o||!o.tagName)return null;var l,h,d,u,p={};p.tagName=o.tagName.toLowerCase(),o.id&&(p.id=o.id),(l=o.className)&&typeof l=="string"&&(p.classes=l.split(/\s+/));var m=["type","name","title","alt"];for(p.attributes=[],u=0;u<m.length;u++)h=m[u],(d=o.getAttribute(h))&&p.attributes.push({key:h,value:d});return p}t.exports={describeElement:c,descriptionToString:r,elementArrayToString:function(o){for(var l,h,d=3,u=[],p=0,m=o.length-1;m>=0;m--){if(l=r(o[m]),h=p+u.length*d+l.length,m<o.length-1&&h>=83){u.unshift("...");break}u.unshift(l),p+=l.length}return u.join(" > ")},treeToArray:function(o){for(var l,h=[],d=0;o&&d<5&&(l=c(o)).tagName!=="html";d++)h.unshift(l),o=o.parentNode;return h},getElementFromEvent:function(o,l){return o.target?o.target:l&&l.elementFromPoint?l.elementFromPoint(o.clientX,o.clientY):void 0},isDescribedElement:function(o,l,h){if(o.tagName.toLowerCase()!==l.toLowerCase())return!1;if(!h)return!0;o=a(o);for(var d=0;d<h.length;d++)if(h[d]===o)return!0;return!1},getElementType:a}},function(t,s,n){var a=n(36);t.exports=a},function(t,s){t.exports=function(n){var a,r,c,o,l,h,d,u,p,m,g,y,f,E=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;function S(b){return b<10?"0"+b:b}function I(){return this.valueOf()}function T(b){return E.lastIndex=0,E.test(b)?'"'+b.replace(E,function(O){var _=c[O];return typeof _=="string"?_:"\\u"+("0000"+O.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+b+'"'}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+S(this.getUTCMonth()+1)+"-"+S(this.getUTCDate())+"T"+S(this.getUTCHours())+":"+S(this.getUTCMinutes())+":"+S(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=I,Number.prototype.toJSON=I,String.prototype.toJSON=I),typeof n.stringify!="function"&&(c={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},n.stringify=function(b,O,_){var w;if(a="",r="",typeof _=="number")for(w=0;w<_;w+=1)r+=" ";else typeof _=="string"&&(r=_);if(o=O,O&&typeof O!="function"&&(typeof O!="object"||typeof O.length!="number"))throw new Error("JSON.stringify");return function v(M,L){var N,G,B,q,ie,ye=a,te=L[M];switch(te&&typeof te=="object"&&typeof te.toJSON=="function"&&(te=te.toJSON(M)),typeof o=="function"&&(te=o.call(L,M,te)),typeof te){case"string":return T(te);case"number":return isFinite(te)?String(te):"null";case"boolean":case"null":return String(te);case"object":if(!te)return"null";if(a+=r,ie=[],Object.prototype.toString.apply(te)==="[object Array]"){for(q=te.length,N=0;N<q;N+=1)ie[N]=v(N,te)||"null";return B=ie.length===0?"[]":a?`[
`+a+ie.join(`,
`+a)+`
`+ye+"]":"["+ie.join(",")+"]",a=ye,B}if(o&&typeof o=="object")for(q=o.length,N=0;N<q;N+=1)typeof o[N]=="string"&&(B=v(G=o[N],te))&&ie.push(T(G)+(a?": ":":")+B);else for(G in te)Object.prototype.hasOwnProperty.call(te,G)&&(B=v(G,te))&&ie.push(T(G)+(a?": ":":")+B);return B=ie.length===0?"{}":a?`{
`+a+ie.join(`,
`+a)+`
`+ye+"}":"{"+ie.join(",")+"}",a=ye,B}}("",{"":b})}),typeof n.parse!="function"&&(n.parse=(m={"\\":"\\",'"':'"',"/":"/",t:"	",n:`
`,r:"\r",f:"\f",b:"\b"},g={go:function(){l="ok"},firstokey:function(){u=p,l="colon"},okey:function(){u=p,l="colon"},ovalue:function(){l="ocomma"},firstavalue:function(){l="acomma"},avalue:function(){l="acomma"}},y={go:function(){l="ok"},ovalue:function(){l="ocomma"},firstavalue:function(){l="acomma"},avalue:function(){l="acomma"}},f={"{":{go:function(){h.push({state:"ok"}),d={},l="firstokey"},ovalue:function(){h.push({container:d,state:"ocomma",key:u}),d={},l="firstokey"},firstavalue:function(){h.push({container:d,state:"acomma"}),d={},l="firstokey"},avalue:function(){h.push({container:d,state:"acomma"}),d={},l="firstokey"}},"}":{firstokey:function(){var b=h.pop();p=d,d=b.container,u=b.key,l=b.state},ocomma:function(){var b=h.pop();d[u]=p,p=d,d=b.container,u=b.key,l=b.state}},"[":{go:function(){h.push({state:"ok"}),d=[],l="firstavalue"},ovalue:function(){h.push({container:d,state:"ocomma",key:u}),d=[],l="firstavalue"},firstavalue:function(){h.push({container:d,state:"acomma"}),d=[],l="firstavalue"},avalue:function(){h.push({container:d,state:"acomma"}),d=[],l="firstavalue"}},"]":{firstavalue:function(){var b=h.pop();p=d,d=b.container,u=b.key,l=b.state},acomma:function(){var b=h.pop();d.push(p),p=d,d=b.container,u=b.key,l=b.state}},":":{colon:function(){if(Object.hasOwnProperty.call(d,u))throw new SyntaxError("Duplicate key '"+u+'"');l="ovalue"}},",":{ocomma:function(){d[u]=p,l="okey"},acomma:function(){d.push(p),l="avalue"}},true:{go:function(){p=!0,l="ok"},ovalue:function(){p=!0,l="ocomma"},firstavalue:function(){p=!0,l="acomma"},avalue:function(){p=!0,l="acomma"}},false:{go:function(){p=!1,l="ok"},ovalue:function(){p=!1,l="ocomma"},firstavalue:function(){p=!1,l="acomma"},avalue:function(){p=!1,l="acomma"}},null:{go:function(){p=null,l="ok"},ovalue:function(){p=null,l="ocomma"},firstavalue:function(){p=null,l="acomma"},avalue:function(){p=null,l="acomma"}}},function(b,O){var _,w,v=/^[\u0020\t\n\r]*(?:([,:\[\]{}]|true|false|null)|(-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)|"((?:[^\r\n\t\\\"]|\\(?:["\\\/trnfb]|u[0-9a-fA-F]{4}))*)")/;l="go",h=[];try{for(;_=v.exec(b);)_[1]?f[_[1]][l]():_[2]?(p=+_[2],y[l]()):(w=_[3],p=w.replace(/\\(?:u(.{4})|([^u]))/g,function(M,L,N){return L?String.fromCharCode(parseInt(L,16)):m[N]}),g[l]()),b=b.slice(_[0].length)}catch(M){l=M}if(l!=="ok"||/[^\u0020\t\n\r]/.test(b))throw l instanceof SyntaxError?l:new SyntaxError("JSON");return typeof O=="function"?function M(L,N){var G,B,q=L[N];if(q&&typeof q=="object")for(G in p)Object.prototype.hasOwnProperty.call(q,G)&&((B=M(q,G))!==void 0?q[G]=B:delete q[G]);return O.call(L,N,q)}({"":p},""):p}))}},function(t,s,n){function a(r,c,o){if(c.hasOwnProperty&&c.hasOwnProperty("addEventListener")){for(var l=c.addEventListener;l._rollbarOldAdd&&l.belongsToShim;)l=l._rollbarOldAdd;var h=function(p,m,g){l.call(this,p,r.wrap(m),g)};h._rollbarOldAdd=l,h.belongsToShim=o,c.addEventListener=h;for(var d=c.removeEventListener;d._rollbarOldRemove&&d.belongsToShim;)d=d._rollbarOldRemove;var u=function(p,m,g){d.call(this,p,m&&m._rollbar_wrapped||m,g)};u._rollbarOldRemove=d,u.belongsToShim=o,c.removeEventListener=u}}t.exports=function(r,c,o){if(r){var l,h,d="EventTarget,Window,Node,ApplicationCache,AudioTrackList,ChannelMergerNode,CryptoOperation,EventSource,FileReader,HTMLUnknownElement,IDBDatabase,IDBRequest,IDBTransaction,KeyOperation,MediaController,MessagePort,ModalWindow,Notification,SVGElementInstance,Screen,TextTrack,TextTrackCue,TextTrackList,WebSocket,WebSocketWorker,Worker,XMLHttpRequest,XMLHttpRequestEventTarget,XMLHttpRequestUpload".split(",");for(l=0;l<d.length;++l)r[h=d[l]]&&r[h].prototype&&a(c,r[h].prototype,o)}}},function(t,s,n){var a=n(0),r=n(5);function c(g,y){return[g,a.stringify(g,y)]}function o(g,y){var f=g.length;return f>2*y?g.slice(0,y).concat(g.slice(f-y)):g}function l(g,y,f){f=f===void 0?30:f;var E,S=g.data.body;if(S.trace_chain)for(var I=S.trace_chain,T=0;T<I.length;T++)E=o(E=I[T].frames,f),I[T].frames=E;else S.trace&&(E=o(E=S.trace.frames,f),S.trace.frames=E);return[g,a.stringify(g,y)]}function h(g,y){return y&&y.length>g?y.slice(0,g-3).concat("..."):y}function d(g,y,f){return[y=r(y,function E(S,I,T){switch(a.typeName(I)){case"string":return h(g,I);case"object":case"array":return r(I,E,T);default:return I}}),a.stringify(y,f)]}function u(g){return g.exception&&(delete g.exception.description,g.exception.message=h(255,g.exception.message)),g.frames=o(g.frames,1),g}function p(g,y){var f=g.data.body;if(f.trace_chain)for(var E=f.trace_chain,S=0;S<E.length;S++)E[S]=u(E[S]);else f.trace&&(f.trace=u(f.trace));return[g,a.stringify(g,y)]}function m(g,y){return a.maxByteSize(g)>y}t.exports={truncate:function(g,y,f){f=f===void 0?524288:f;for(var E,S,I,T=[c,l,d.bind(null,1024),d.bind(null,512),d.bind(null,256),p];E=T.shift();)if(g=(S=E(g,y))[0],(I=S[1]).error||!m(I.value,f))return I;return I},raw:c,truncateFrames:l,truncateStrings:d,maybeTruncateValue:h}}])})})(Jd);const Qd=Zd(pn),ep="production",tp="null",sp="0",ip="webpack:///./",np="master",{UseMockup:ap,FilterError:Di,ListPlayerDevIds:rp}=GameCore.Configs.Rollbar;class op extends Phaser.Plugins.BasePlugin{enable;rollbar;events=[];setup(){this.rollbar=new Qd({accessToken:tp,checkIgnore:this.checkIgnore,onSendCallback:this.beforeSend,captureUncaught:!0,scrubTelemetryInputs:!0,captureUnhandledRejections:!0,autoInstrument:{dom:!1,navigation:!1},payload:{environment:ep,client:{javascript:{code_version:sp}},server:{root:ip,branch:np}}}),this.enable=!0,this.sendTestException()}configure(e){this.rollbar&&this.rollbar.configure(e)}sendTestException(){const e=this.game.facebook.getPlayerID();rp.includes(e)&&this.rollbar.debug(new Error("Test rollbar"),{playerID:e})}beforeSend=(e,t,s)=>{ap&&this.showPopupError(s)};checkIgnore=(e,t,s)=>{try{return this.isErrorIgnore(t)?(console.warn(t),!0):!1}catch{return!1}};showPopupError=e=>{const t=e?.body?.trace?.exception;t&&this.events.push(t);const s=e?.body?.trace?.frames||[];this.events.push(...s);let n=document.getElementById("popup-error");n||(n=document.createElement("div"),n.id="popup-error",document.body.appendChild(n)),n.innerHTML=`<div style="color: #fff; display: flex; flex-flow: column; align-items: center; ">
      <pre id="json" style="overflow: auto; background-color: rgb(195 112 97 / 80%); padding: 10px; max-height: 80vh; max-width: 90vw; border: 5px solid #545454;">${JSON.stringify(this.events,null,2)}</pre>
      <button id="close" style="cursor: pointer; padding: 10px 20px; border-radius: 100px;">Close</button>
      </div>`,n.style="top: 0px; z-index: 10000; width: 100vw; max-height: 100vh; position: absolute; display: flex; align-items: center; justify-content: center;";const a=document.getElementById("close");a&&(a.onclick=this.closePopup)};closePopup=()=>{this.events=[{}],document.getElementById("popup-error")?.remove()};isErrorIgnore=e=>{if(!e||e.length===0)return!1;let t=!1;const s=e[0];return s instanceof Object&&(t=this.isIgnoreByCode(s)||this.isIgnoreByMessage(s)),t};isIgnoreByCode=e=>{if(GameCore.Utils.Object.hasOwn(e,"code")){const{code:t}=e,{accepted:s,ignored:n}=Di.Codes;if(typeof t=="string"){if(s.indexOf(t)>=0)return!1;if(n.indexOf(t)>=0)return!0}}else if(GameCore.Utils.Object.hasOwn(e,"name")){const{name:t}=e,{accepted:s,ignored:n}=Di.Codes;if(typeof t=="string"){if(s.indexOf(t)>=0)return!1;if(n.indexOf(t)>=0)return!0}}return!1};isIgnoreByMessage=e=>{if(GameCore.Utils.Object.hasOwn(e,"message")){const{message:t}=e,{accepted:s,ignored:n}=Di.Messages;if(typeof t=="string"){if(s.indexOf(t)>=0)return!1;if(n.indexOf(t)>=0)return!0}}return!1};addExtraState=()=>{try{if(!GameCore.Utils.Object.hasOwn(window,"game")||!GameCore.Utils.Object.hasOwn(window.game,"storage")||!GameCore.Utils.Object.hasOwn(window.game.storage,"getState"))return;const{getState:e}=window.game.storage,t=e(),{player:s,match:n,...a}=t||{};this.rollbar.configure({payload:{player:s,match:n,other:a}})}catch(e){console.warn("%c addExtraState: ","font-size:12px;background-color: #42b983;color:#fff;",e)}};sendException(e,t){if(e){if(!this.enable){console.error(e);return}this.rollbar&&(this.addExtraState(),this.rollbar.error(e,t))}}}class cp extends Phaser.Events.EventEmitter{emit(e,t){return super.emit(e,t)}}class lp extends Phaser.GameObjects.Container{zone;background;constructor(e,t,s,n){super(e),this.setName(t),this.setVisible(!1);const{width:a,height:r}=this.scene.world.getWorldSize();this.setSize(s||a,n||r),this.addZone(),this.addBackground()}open(e){GameCore.Utils.Valid.isObject(e)&&(this.setDataEnabled(),this.setData(e)),this.setBlockInputOutsideEnabled(!0),this.scene.screen.bringToTop(this.name),!this.visible&&(this.setVisible(!0),this.logPageviewOnOpen(),this.logEventOpen())}close(){this.setBlockInputOutsideEnabled(!1),this.visible&&(this.setVisible(!1),this.logPageviewOnClose())}incY(e){this.y+=e,this.background.y-=e}incX(e){this.x+=e,this.background.x-=e}incScale(e){this.scale+=e,this.background.scale-=e^e*(100/e)}setBlockInputOutsideEnabled(e){this.scene.input.setTopOnly(e)}addZone(){this.zone=this.scene.add.zone(0,0,this.width,this.height),this.zone.setInteractive({}),this.add(this.zone)}addBackground(){const e="screen-background";if(!this.scene.textures.exists(e)){const t=this.width+2,s=this.height+2,n=this.scene.add.graphics();n.fillStyle(0,1),n.fillRect(0,0,t,s),n.generateTexture(e,t,s),n.destroy()}this.background=this.scene.add.image(0,0,e),this.add(this.background)}logPageviewOnOpen(){this.scene.analytics.pageview(this.name)}logPageviewOnClose(){this.scene.analytics.pageview(this.scene.scene.key)}logEventOpen(){this.scene.analytics.event(z.SCREEN_OPEN,{screen_name:this.getScreenName()})}getScreenName(){return GameCore.Utils.String.toUpperCamelCase(this.name.toLowerCase())}}const Oo={OPEN:"open",CLOSE:"close",CREATED:"created"};GameCore.Screen=lp;GameCore.Screens={Events:Oo};class hp extends Phaser.Plugins.ScenePlugin{events;boot(){this.events=new cp,this.registryScreenFactory()}get(e){const t=this.scene.children.getByName(e);return t===null?null:t}add(e,t,s,n){let a=this.get(e);return a||(a=this.scene.add.screen(e,t,s,n),this.events.emit(GameCore.Screens.Events.CREATED,a),a)}open(e,t){const s=this.get(e);return s?(s.open(t),s.emit(GameCore.Screens.Events.OPEN,s),this.events.emit(GameCore.Screens.Events.OPEN,s),console.log("Screen open",e,t),!0):!1}close(e){const t=this.get(e);return t?(t.close(),t.emit(GameCore.Screens.Events.CLOSE,t),this.events.emit(GameCore.Screens.Events.CLOSE,t),console.log("Screen close",e),!0):!1}bringToTop(e){const t=this.scene.children.getByName(e);t&&this.scene.children.bringToTop(t)}registryScreenFactory(){Phaser.GameObjects.GameObjectFactory.register("screen",this.createScreen)}createScreen(e,t,s,n){const a=new t(this.scene,e,s,n);return Phaser.Display.Align.In.Center(a,this.scene.gameZone),this.existing(a),a}}var mn={},up={get exports(){return mn},set exports(i){mn=i}};(function(i){(function(e,t){i.exports=t()})(_o,function(){var e=Object.prototype.toString;function t(d,u){return d==null?!1:Object.prototype.hasOwnProperty.call(d,u)}function s(d){if(!d||r(d)&&d.length===0)return!0;if(typeof d!="string"){for(var u in d)if(t(d,u))return!1;return!0}return!1}function n(d){return e.call(d)}function a(d){return typeof d=="object"&&n(d)==="[object Object]"}var r=Array.isArray||function(d){return e.call(d)==="[object Array]"};function c(d){return typeof d=="boolean"||n(d)==="[object Boolean]"}function o(d){var u=parseInt(d);return u.toString()===d?u:d}function l(d){d=d||{};var u=function(f){return Object.keys(u).reduce(function(E,S){return S==="create"||typeof u[S]=="function"&&(E[S]=u[S].bind(u,f)),E},{})},p;d.includeInheritedProps?p=function(){return!0}:p=function(f,E){return typeof E=="number"&&Array.isArray(f)||t(f,E)};function m(f,E){if(p(f,E))return f[E]}var g;d.includeInheritedProps?g=function(f,E){typeof E!="string"&&typeof E!="number"&&(E=String(E));var S=m(f,E);if(E==="__proto__"||E==="prototype"||E==="constructor"&&typeof S=="function")throw new Error("For security reasons, object's magic properties cannot be set");return S}:g=function(f,E){return m(f,E)};function y(f,E,S,I){if(typeof E=="number"&&(E=[E]),!E||E.length===0)return f;if(typeof E=="string")return y(f,E.split(".").map(o),S,I);var T=E[0],b=g(f,T);return E.length===1?((b===void 0||!I)&&(f[T]=S),b):(b===void 0&&(typeof E[1]=="number"?f[T]=[]:f[T]={}),y(f[T],E.slice(1),S,I))}return u.has=function(f,E){if(typeof E=="number"?E=[E]:typeof E=="string"&&(E=E.split(".")),!E||E.length===0)return!!f;for(var S=0;S<E.length;S++){var I=o(E[S]);if(typeof I=="number"&&r(f)&&I<f.length||(d.includeInheritedProps?I in Object(f):t(f,I)))f=f[I];else return!1}return!0},u.ensureExists=function(f,E,S){return y(f,E,S,!0)},u.set=function(f,E,S,I){return y(f,E,S,I)},u.insert=function(f,E,S,I){var T=u.get(f,E);I=~~I,r(T)||(T=[],u.set(f,E,T)),T.splice(I,0,S)},u.empty=function(f,E){if(!s(E)&&f!=null){var S,I;if(S=u.get(f,E)){if(typeof S=="string")return u.set(f,E,"");if(c(S))return u.set(f,E,!1);if(typeof S=="number")return u.set(f,E,0);if(r(S))S.length=0;else if(a(S))for(I in S)p(S,I)&&delete S[I];else return u.set(f,E,null)}}},u.push=function(f,E){var S=u.get(f,E);r(S)||(S=[],u.set(f,E,S)),S.push.apply(S,Array.prototype.slice.call(arguments,2))},u.coalesce=function(f,E,S){for(var I,T=0,b=E.length;T<b;T++)if((I=u.get(f,E[T]))!==void 0)return I;return S},u.get=function(f,E,S){if(typeof E=="number"&&(E=[E]),!E||E.length===0)return f;if(f==null)return S;if(typeof E=="string")return u.get(f,E.split("."),S);var I=o(E[0]),T=g(f,I);return T===void 0?S:E.length===1?T:u.get(f[I],E.slice(1),S)},u.del=function(E,S){if(typeof S=="number"&&(S=[S]),E==null||s(S))return E;if(typeof S=="string")return u.del(E,S.split("."));var I=o(S[0]);if(g(E,I),!p(E,I))return E;if(S.length===1)r(E)?E.splice(I,1):delete E[I];else return u.del(E[I],S.slice(1));return E},u}var h=l();return h.create=l,h.withInheritedProps=l({includeInheritedProps:!0}),h})})(up);var Ca=mn.get;function dp(i,e){return i===e}function pp(i,e,t){t=t||dp;var s=Ca(i(),e);return function(a){return function(){var r=Ca(i(),e);if(!t(s,r)){var c=s;s=r,a(r,c,e)}}}}var mp=pp;const gp=mp;function _s(i){return _s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_s(i)}function fp(i,e){if(_s(i)!=="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(_s(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function Ep(i){var e=fp(i,"string");return _s(e)==="symbol"?e:String(e)}function yp(i,e,t){return e=Ep(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function va(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),t.push.apply(t,s)}return t}function _a(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?va(Object(t),!0).forEach(function(s){yp(i,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):va(Object(t)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(t,s))})}return i}function ge(i){return"Minified Redux error #"+i+"; visit https://redux.js.org/Errors?code="+i+" for the full message or use the non-minified dev environment for full errors. "}var Oa=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),Mi=function(){return Math.random().toString(36).substring(7).split("").join(".")},si={INIT:"@@redux/INIT"+Mi(),REPLACE:"@@redux/REPLACE"+Mi(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+Mi()}};function Sp(i){if(typeof i!="object"||i===null)return!1;for(var e=i;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(i)===e}function Ro(i,e,t){var s;if(typeof e=="function"&&typeof t=="function"||typeof t=="function"&&typeof arguments[3]=="function")throw new Error(ge(0));if(typeof e=="function"&&typeof t>"u"&&(t=e,e=void 0),typeof t<"u"){if(typeof t!="function")throw new Error(ge(1));return t(Ro)(i,e)}if(typeof i!="function")throw new Error(ge(2));var n=i,a=e,r=[],c=r,o=!1;function l(){c===r&&(c=r.slice())}function h(){if(o)throw new Error(ge(3));return a}function d(g){if(typeof g!="function")throw new Error(ge(4));if(o)throw new Error(ge(5));var y=!0;return l(),c.push(g),function(){if(y){if(o)throw new Error(ge(6));y=!1,l();var E=c.indexOf(g);c.splice(E,1),r=null}}}function u(g){if(!Sp(g))throw new Error(ge(7));if(typeof g.type>"u")throw new Error(ge(8));if(o)throw new Error(ge(9));try{o=!0,a=n(a,g)}finally{o=!1}for(var y=r=c,f=0;f<y.length;f++){var E=y[f];E()}return g}function p(g){if(typeof g!="function")throw new Error(ge(10));n=g,u({type:si.REPLACE})}function m(){var g,y=d;return g={subscribe:function(E){if(typeof E!="object"||E===null)throw new Error(ge(11));function S(){E.next&&E.next(h())}S();var I=y(S);return{unsubscribe:I}}},g[Oa]=function(){return this},g}return u({type:si.INIT}),s={dispatch:u,subscribe:d,getState:h,replaceReducer:p},s[Oa]=m,s}function Ap(i){Object.keys(i).forEach(function(e){var t=i[e],s=t(void 0,{type:si.INIT});if(typeof s>"u")throw new Error(ge(12));if(typeof t(void 0,{type:si.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(ge(13))})}function Po(i){for(var e=Object.keys(i),t={},s=0;s<e.length;s++){var n=e[s];typeof i[n]=="function"&&(t[n]=i[n])}var a=Object.keys(t),r;try{Ap(t)}catch(c){r=c}return function(o,l){if(o===void 0&&(o={}),r)throw r;for(var h=!1,d={},u=0;u<a.length;u++){var p=a[u],m=t[p],g=o[p],y=m(g,l);if(typeof y>"u")throw l&&l.type,new Error(ge(14));d[p]=y,h=h||y!==g}return h=h||a.length!==Object.keys(o).length,h?d:o}}function Do(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];return e.length===0?function(s){return s}:e.length===1?e[0]:e.reduce(function(s,n){return function(){return s(n.apply(void 0,arguments))}})}function Tp(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];return function(s){return function(){var n=s.apply(void 0,arguments),a=function(){throw new Error(ge(15))},r={getState:n.getState,dispatch:function(){return a.apply(void 0,arguments)}},c=e.map(function(o){return o(r)});return a=Do.apply(void 0,c)(n.dispatch),_a(_a({},n),{},{dispatch:a})}}}function Mo(i){var e=function(s){var n=s.dispatch,a=s.getState;return function(r){return function(c){return typeof c=="function"?c(n,a,i):r(c)}}};return e}var Lo=Mo();Lo.withExtraArgument=Mo;const Ip=Lo,xo="CONTEXT_RECEIVED",No="CONTEXT_PROCESSED",ko="CONTEXT_GAME_MODE_DETECTED",Go="MESSAGES_SENT_UPDATE",Bo="MESSAGES_SENT_REMOVE",Uo="SCENE_KEY_UPDATE";function Ne(i){for(var e=arguments.length,t=Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];throw Error("[Immer] minified error nr: "+i+(t.length?" "+t.map(function(n){return"'"+n+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function bt(i){return!!i&&!!i[se]}function wt(i){var e;return!!i&&(function(t){if(!t||typeof t!="object")return!1;var s=Object.getPrototypeOf(t);if(s===null)return!0;var n=Object.hasOwnProperty.call(s,"constructor")&&s.constructor;return n===Object||typeof n=="function"&&Function.toString.call(n)===Dp}(i)||Array.isArray(i)||!!i[Na]||!!(!((e=i.constructor)===null||e===void 0)&&e[Na])||Mn(i)||Ln(i))}function Ct(i,e,t){t===void 0&&(t=!1),Zt(i)===0?(t?Object.keys:Ut)(i).forEach(function(s){t&&typeof s=="symbol"||e(s,i[s],i)}):i.forEach(function(s,n){return e(n,s,i)})}function Zt(i){var e=i[se];return e?e.i>3?e.i-4:e.i:Array.isArray(i)?1:Mn(i)?2:Ln(i)?3:0}function Bt(i,e){return Zt(i)===2?i.has(e):Object.prototype.hasOwnProperty.call(i,e)}function bp(i,e){return Zt(i)===2?i.get(e):i[e]}function Fo(i,e,t){var s=Zt(i);s===2?i.set(e,t):s===3?i.add(t):i[e]=t}function Yo(i,e){return i===e?i!==0||1/i==1/e:i!=i&&e!=e}function Mn(i){return Rp&&i instanceof Map}function Ln(i){return Pp&&i instanceof Set}function St(i){return i.o||i.t}function xn(i){if(Array.isArray(i))return Array.prototype.slice.call(i);var e=Vo(i);delete e[se];for(var t=Ut(e),s=0;s<t.length;s++){var n=t[s],a=e[n];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(e[n]={configurable:!0,writable:!0,enumerable:a.enumerable,value:i[n]})}return Object.create(Object.getPrototypeOf(i),e)}function Nn(i,e){return e===void 0&&(e=!1),kn(i)||bt(i)||!wt(i)||(Zt(i)>1&&(i.set=i.add=i.clear=i.delete=wp),Object.freeze(i),e&&Ct(i,function(t,s){return Nn(s,!0)},!0)),i}function wp(){Ne(2)}function kn(i){return i==null||typeof i!="object"||Object.isFrozen(i)}function Fe(i){var e=yn[i];return e||Ne(18,i),e}function Cp(i,e){yn[i]||(yn[i]=e)}function gn(){return Os}function Li(i,e){e&&(Fe("Patches"),i.u=[],i.s=[],i.v=e)}function ii(i){fn(i),i.p.forEach(vp),i.p=null}function fn(i){i===Os&&(Os=i.l)}function Ra(i){return Os={p:[],l:Os,h:i,m:!0,_:0}}function vp(i){var e=i[se];e.i===0||e.i===1?e.j():e.O=!0}function xi(i,e){e._=e.p.length;var t=e.p[0],s=i!==void 0&&i!==t;return e.h.g||Fe("ES5").S(e,i,s),s?(t[se].P&&(ii(e),Ne(4)),wt(i)&&(i=ni(e,i),e.l||ai(e,i)),e.u&&Fe("Patches").M(t[se].t,i,e.u,e.s)):i=ni(e,t,[]),ii(e),e.u&&e.v(e.u,e.s),i!==Ho?i:void 0}function ni(i,e,t){if(kn(e))return e;var s=e[se];if(!s)return Ct(e,function(c,o){return Pa(i,s,e,c,o,t)},!0),e;if(s.A!==i)return e;if(!s.P)return ai(i,s.t,!0),s.t;if(!s.I){s.I=!0,s.A._--;var n=s.i===4||s.i===5?s.o=xn(s.k):s.o,a=n,r=!1;s.i===3&&(a=new Set(n),n.clear(),r=!0),Ct(a,function(c,o){return Pa(i,s,n,c,o,t,r)}),ai(i,n,!1),t&&i.u&&Fe("Patches").N(s,t,i.u,i.s)}return s.o}function Pa(i,e,t,s,n,a,r){if(bt(n)){var c=ni(i,n,a&&e&&e.i!==3&&!Bt(e.R,s)?a.concat(s):void 0);if(Fo(t,s,c),!bt(c))return;i.m=!1}else r&&t.add(n);if(wt(n)&&!kn(n)){if(!i.h.D&&i._<1)return;ni(i,n),e&&e.A.l||ai(i,n)}}function ai(i,e,t){t===void 0&&(t=!1),!i.l&&i.h.D&&i.m&&Nn(e,t)}function Ni(i,e){var t=i[se];return(t?St(t):i)[e]}function Da(i,e){if(e in i)for(var t=Object.getPrototypeOf(i);t;){var s=Object.getOwnPropertyDescriptor(t,e);if(s)return s;t=Object.getPrototypeOf(t)}}function rt(i){i.P||(i.P=!0,i.l&&rt(i.l))}function ki(i){i.o||(i.o=xn(i.t))}function En(i,e,t){var s=Mn(e)?Fe("MapSet").F(e,t):Ln(e)?Fe("MapSet").T(e,t):i.g?function(n,a){var r=Array.isArray(n),c={i:r?1:0,A:a?a.A:gn(),P:!1,I:!1,R:{},l:a,t:n,k:null,o:null,j:null,C:!1},o=c,l=Rs;r&&(o=[c],l=bs);var h=Proxy.revocable(o,l),d=h.revoke,u=h.proxy;return c.k=u,c.j=d,u}(e,t):Fe("ES5").J(e,t);return(t?t.A:gn()).p.push(s),s}function _p(i){return bt(i)||Ne(22,i),function e(t){if(!wt(t))return t;var s,n=t[se],a=Zt(t);if(n){if(!n.P&&(n.i<4||!Fe("ES5").K(n)))return n.t;n.I=!0,s=Ma(t,a),n.I=!1}else s=Ma(t,a);return Ct(s,function(r,c){n&&bp(n.t,r)===c||Fo(s,r,e(c))}),a===3?new Set(s):s}(i)}function Ma(i,e){switch(e){case 2:return new Map(i);case 3:return Array.from(i)}return xn(i)}function Op(){function i(a,r){var c=n[a];return c?c.enumerable=r:n[a]=c={configurable:!0,enumerable:r,get:function(){var o=this[se];return Rs.get(o,a)},set:function(o){var l=this[se];Rs.set(l,a,o)}},c}function e(a){for(var r=a.length-1;r>=0;r--){var c=a[r][se];if(!c.P)switch(c.i){case 5:s(c)&&rt(c);break;case 4:t(c)&&rt(c)}}}function t(a){for(var r=a.t,c=a.k,o=Ut(c),l=o.length-1;l>=0;l--){var h=o[l];if(h!==se){var d=r[h];if(d===void 0&&!Bt(r,h))return!0;var u=c[h],p=u&&u[se];if(p?p.t!==d:!Yo(u,d))return!0}}var m=!!r[se];return o.length!==Ut(r).length+(m?0:1)}function s(a){var r=a.k;if(r.length!==a.t.length)return!0;var c=Object.getOwnPropertyDescriptor(r,r.length-1);if(c&&!c.get)return!0;for(var o=0;o<r.length;o++)if(!r.hasOwnProperty(o))return!0;return!1}var n={};Cp("ES5",{J:function(a,r){var c=Array.isArray(a),o=function(h,d){if(h){for(var u=Array(d.length),p=0;p<d.length;p++)Object.defineProperty(u,""+p,i(p,!0));return u}var m=Vo(d);delete m[se];for(var g=Ut(m),y=0;y<g.length;y++){var f=g[y];m[f]=i(f,h||!!m[f].enumerable)}return Object.create(Object.getPrototypeOf(d),m)}(c,a),l={i:c?5:4,A:r?r.A:gn(),P:!1,I:!1,R:{},l:r,t:a,k:o,o:null,O:!1,C:!1};return Object.defineProperty(o,se,{value:l,writable:!0}),o},S:function(a,r,c){c?bt(r)&&r[se].A===a&&e(a.p):(a.u&&function o(l){if(l&&typeof l=="object"){var h=l[se];if(h){var d=h.t,u=h.k,p=h.R,m=h.i;if(m===4)Ct(u,function(S){S!==se&&(d[S]!==void 0||Bt(d,S)?p[S]||o(u[S]):(p[S]=!0,rt(h)))}),Ct(d,function(S){u[S]!==void 0||Bt(u,S)||(p[S]=!1,rt(h))});else if(m===5){if(s(h)&&(rt(h),p.length=!0),u.length<d.length)for(var g=u.length;g<d.length;g++)p[g]=!1;else for(var y=d.length;y<u.length;y++)p[y]=!0;for(var f=Math.min(u.length,d.length),E=0;E<f;E++)u.hasOwnProperty(E)||(p[E]=!0),p[E]===void 0&&o(u[E])}}}}(a.p[0]),e(a.p))},K:function(a){return a.i===4?t(a):s(a)}})}var La,Os,Gn=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",Rp=typeof Map<"u",Pp=typeof Set<"u",xa=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",Ho=Gn?Symbol.for("immer-nothing"):((La={})["immer-nothing"]=!0,La),Na=Gn?Symbol.for("immer-draftable"):"__$immer_draftable",se=Gn?Symbol.for("immer-state"):"__$immer_state";var Dp=""+Object.prototype.constructor,Ut=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(i){return Object.getOwnPropertyNames(i).concat(Object.getOwnPropertySymbols(i))}:Object.getOwnPropertyNames,Vo=Object.getOwnPropertyDescriptors||function(i){var e={};return Ut(i).forEach(function(t){e[t]=Object.getOwnPropertyDescriptor(i,t)}),e},yn={},Rs={get:function(i,e){if(e===se)return i;var t=St(i);if(!Bt(t,e))return function(n,a,r){var c,o=Da(a,r);return o?"value"in o?o.value:(c=o.get)===null||c===void 0?void 0:c.call(n.k):void 0}(i,t,e);var s=t[e];return i.I||!wt(s)?s:s===Ni(i.t,e)?(ki(i),i.o[e]=En(i.A.h,s,i)):s},has:function(i,e){return e in St(i)},ownKeys:function(i){return Reflect.ownKeys(St(i))},set:function(i,e,t){var s=Da(St(i),e);if(s?.set)return s.set.call(i.k,t),!0;if(!i.P){var n=Ni(St(i),e),a=n?.[se];if(a&&a.t===t)return i.o[e]=t,i.R[e]=!1,!0;if(Yo(t,n)&&(t!==void 0||Bt(i.t,e)))return!0;ki(i),rt(i)}return i.o[e]===t&&(t!==void 0||e in i.o)||Number.isNaN(t)&&Number.isNaN(i.o[e])||(i.o[e]=t,i.R[e]=!0),!0},deleteProperty:function(i,e){return Ni(i.t,e)!==void 0||e in i.t?(i.R[e]=!1,ki(i),rt(i)):delete i.R[e],i.o&&delete i.o[e],!0},getOwnPropertyDescriptor:function(i,e){var t=St(i),s=Reflect.getOwnPropertyDescriptor(t,e);return s&&{writable:!0,configurable:i.i!==1||e!=="length",enumerable:s.enumerable,value:t[e]}},defineProperty:function(){Ne(11)},getPrototypeOf:function(i){return Object.getPrototypeOf(i.t)},setPrototypeOf:function(){Ne(12)}},bs={};Ct(Rs,function(i,e){bs[i]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}}),bs.deleteProperty=function(i,e){return bs.set.call(this,i,e,void 0)},bs.set=function(i,e,t){return Rs.set.call(this,i[0],e,t,i[0])};var Mp=function(){function i(t){var s=this;this.g=xa,this.D=!0,this.produce=function(n,a,r){if(typeof n=="function"&&typeof a!="function"){var c=a;a=n;var o=s;return function(g){var y=this;g===void 0&&(g=c);for(var f=arguments.length,E=Array(f>1?f-1:0),S=1;S<f;S++)E[S-1]=arguments[S];return o.produce(g,function(I){var T;return(T=a).call.apply(T,[y,I].concat(E))})}}var l;if(typeof a!="function"&&Ne(6),r!==void 0&&typeof r!="function"&&Ne(7),wt(n)){var h=Ra(s),d=En(s,n,void 0),u=!0;try{l=a(d),u=!1}finally{u?ii(h):fn(h)}return typeof Promise<"u"&&l instanceof Promise?l.then(function(g){return Li(h,r),xi(g,h)},function(g){throw ii(h),g}):(Li(h,r),xi(l,h))}if(!n||typeof n!="object"){if((l=a(n))===void 0&&(l=n),l===Ho&&(l=void 0),s.D&&Nn(l,!0),r){var p=[],m=[];Fe("Patches").M(n,l,p,m),r(p,m)}return l}Ne(21,n)},this.produceWithPatches=function(n,a){if(typeof n=="function")return function(l){for(var h=arguments.length,d=Array(h>1?h-1:0),u=1;u<h;u++)d[u-1]=arguments[u];return s.produceWithPatches(l,function(p){return n.apply(void 0,[p].concat(d))})};var r,c,o=s.produce(n,a,function(l,h){r=l,c=h});return typeof Promise<"u"&&o instanceof Promise?o.then(function(l){return[l,r,c]}):[o,r,c]},typeof t?.useProxies=="boolean"&&this.setUseProxies(t.useProxies),typeof t?.autoFreeze=="boolean"&&this.setAutoFreeze(t.autoFreeze)}var e=i.prototype;return e.createDraft=function(t){wt(t)||Ne(8),bt(t)&&(t=_p(t));var s=Ra(this),n=En(this,t,void 0);return n[se].C=!0,fn(s),n},e.finishDraft=function(t,s){var n=t&&t[se],a=n.A;return Li(a,s),xi(void 0,a)},e.setAutoFreeze=function(t){this.D=t},e.setUseProxies=function(t){t&&!xa&&Ne(20),this.g=t},e.applyPatches=function(t,s){var n;for(n=s.length-1;n>=0;n--){var a=s[n];if(a.path.length===0&&a.op==="replace"){t=a.value;break}}n>-1&&(s=s.slice(n+1));var r=Fe("Patches").$;return bt(t)?r(t,s):this.produce(t,function(c){return r(c,s)})},i}(),ve=new Mp,Lp=ve.produce;ve.produceWithPatches.bind(ve);ve.setAutoFreeze.bind(ve);ve.setUseProxies.bind(ve);ve.applyPatches.bind(ve);ve.createDraft.bind(ve);ve.finishDraft.bind(ve);const be=Lp,xp={currentSceneKey:"",prevSceneKey:""},Np=(i=xp,e)=>be(i,t=>{const{payload:s}=e;if(!s)return;const{sceneKey:n}=s;switch(e.type){case Uo:t.currentSceneKey=n,t.prevSceneKey=i.currentSceneKey;break}});Op();const Wo={processed:!1,contextId:"",contextType:"SOLO",entryPointData:{},currentGameMode:""},Gi=Wo,kp=(i=Wo,e)=>be(i,t=>{const{payload:s}=e;if(!s)return;const{gameMode:n,contextId:a,contextType:r,entryPointData:c}=s;switch(e.type){case xo:t.contextId=a,t.contextType=r,t.entryPointData=c;break;case No:t.contextId=a,t.contextType=r,t.processed=!0;break;case ko:t.currentGameMode=n;break}}),Gp={data:{}},Bp=(i=Gp,e)=>be(i,t=>{const{payload:s}=e;if(!s)return;const{opponentId:n}=s;if(typeof n=="string")switch(e.type){case Go:i.data[n]?t.data[n].sent=!0:t.data[n]={sent:!0};break;case Bo:i.data[n]?t.data[n].sent=!1:t.data[n]={sent:!1};break}}),Up={token:"",isRequesting:!1},Fp=(i=Up,e)=>be(i,t=>{const{payload:s}=e;if(!s)return;const{token:n}=s;switch(e.type){case ao:t.isRequesting=!0;break;case ro:t.token=n,t.isRequesting=!1;break}}),Yp={[Cn]:Fp},Hp={ASID:"",playerId:"",name:"",photo:"",locale:"",connectedPlayers:{},data:{score:0,settings:vs,userGuideDisplays:0,customFields:{}},isUserNew:!0},Vp=(i=Hp,e)=>be(i,t=>{const{payload:s}=e;if(!s)return;const{name:n,value:a,data:r={},score:c,connectedPlayers:o=[],profile:l}=s;switch(e.type){case mo:{const{playerId:h,name:d,photo:u,locale:p,data:m}=s;if(t.playerId=h,t.name=d,t.photo=u,t.locale=p,GameCore.Utils.Valid.isObject(m)){const g=m;t.data=Ce(i.data,g)}m.userGuideDisplays>0&&(t.isUserNew=!1)}break;case Eo:{const{playerId:h,name:d,photo:u,locale:p,ASID:m}=l;t.ASID=m,t.playerId=h,t.name=d,t.photo=u,t.locale=p}break;case fo:t.data.score=c;break;case yo:if(!GameCore.Utils.Object.hasOwn(t.data.settings,n))break;t.data.settings[n]=a;break;case go:t.data=Ce(i.data,r),r.userGuideDisplays>0&&(t.isUserNew=!1);break;case So:{if(o.length<=0)break;const h=GameCore.Utils.Object.keyBy(o,"playerId");t.connectedPlayers=Ce(i.connectedPlayers,h)}break}}),Wp={[di]:Vp},Kp={data:{},profileIds:[]},jp=(i=Kp,e)=>be(i,t=>{const{payload:s}=e;if(!s)return;const{data:n=[]}=s;switch(e.type){case vo:{const a=GameCore.Utils.Object.keyBy(n,"playerId"),r=Object.keys(a);t.data=Ce({...i.data},a),t.profileIds=[...new Set([...i.profileIds,...r])]}break}}),zp={[Dn]:jp},Ko="match",jo="MATCH_GAMEPLAY_INITIALIZE",zo="MATCH_GAMEPLAY_START",$o="MATCH_GAMEPLAY_FINISH",Xo="MATCH_GAMEPLAY_UPDATE",qo="MATCH_GAMEPLAY_RESCUE",Zo="MATCH_GAMEPLAY_TYPE_UPDATE",Jo="MATCH_STATS_DATA_CLEAR",Qo="MATCH_STATS_DATA_UPDATE",ec="MATCH_STATS_CURRENT_UPDATE",$p="MATCH_STATS_CONTEXT_REQUEST",Xp="MATCH_STATS_CONTEXT_RECEIVED",tc="MATCH_SINGLE_CREATE_REQUEST",sc="MATCH_SINGLE_DETAIL_REQUEST",qp="MATCH_SINGLE_FINISH_REQUEST",ic="MATCH_SINGLE_MOVE_UPDATED",nc="MATCH_SINGLE_DATA_RECEIVED",ac="MATCH_SINGLE_DATA_CLEAR",rc="MATCH_CHALLENGE_JOIN_REQUEST",oc="MATCH_CHALLENGE_CREATE_REQUEST",cc="MATCH_CHALLENGE_FINISH_REQUEST",lc="MATCH_CHALLENGE_CONTINUE_REQUEST",Bn="MATCH_CHALLENGE_DATA_RECEIVED",hc="MATCH_CHALLENGE_DATA_CLEAR",uc="MATCH_GROUP_CREATE_REQUEST",dc="MATCH_GROUP_FINISH_REQUEST",pc="MATCH_ONLINE_CREATE_REQUEST",Un="MATCH_ONLINE_DATA_RECEIVED",Zp="MATCH_ONLINE_STATS_UPDATE",Jp="MATCH_ONLINE_FINISH_REQUEST",Qp="MATCH_ONLINE_DATA_CLEAR",Gt="open",Vt="active",Ps="finished",tt={mode:"",status:Gt,rescued:0,startAt:0,finishAt:0,type:"endless"},em=(i=tt,e)=>be(i,t=>{const{payload:s}=e;if(!s)return;const{mode:n,status:a,type:r}=s;switch(e.type){case jo:t.status=Gt,t.mode=tt.mode,t.rescued=tt.rescued,t.startAt=tt.startAt,t.finishAt=tt.finishAt,t.opponentInfo=tt.opponentInfo,t.type=tt.type;break;case zo:t.mode=n,t.status=Vt,t.rescued=tt.rescued,t.startAt=Date.now();break;case Xo:t.mode=typeof n=="string"?n:i.mode,t.status=a||i.status;break;case $o:t.status=Ps,t.finishAt=Date.now();break;case qo:t.rescued+=1;break;case Zo:t.type=r;break}}),pt={single:{_id:"",data:{fen:""},playerId:"",status:Gt},group:{status:Gt,opponentInfo:{playerId:"",name:"",photo:""}},challenge:{_id:"",status:Gt,whitePlayerId:"",blackPlayerId:"",opponentInfo:{playerId:"",name:"",photo:""}},online:{_id:"",status:Gt,players:{}},updateAt:0,isRequesting:!1},tm=(i=pt,e)=>be(i,t=>{const{payload:s}=e;if(!s)return;const{match:n,opponentInfo:a,players:r}=s;switch(e.type){case tc:case sc:case rc:case cc:case pc:t.isRequesting=!0;break;case ic:t.single={...i.single,...n},t.updateAt=Date.now();break;case nc:t.isRequesting=!1,t.single=n||pt.single;break;case ac:t.isRequesting=!1,t.single=pt.single;break;case oc:case lc:t.isRequesting=!0,t.challenge.opponentInfo=a;break;case Bn:t.isRequesting=!1,t.challenge={...n||pt.challenge},t.challenge.opponentInfo=i.challenge.opponentInfo;break;case hc:t.isRequesting=!1,t.challenge=pt.challenge;break;case uc:t.group.status=Vt,a&&(t.group.opponentInfo=a);break;case dc:t.group.status=Ps;break;case Qp:t.online.status=pt.online.status,t.online.players=pt.online.players;break;case Un:t.online.status=Vt,t.online.players=r;break;case Jp:t.online.status=Ps;break}}),Bi={current:{updateAt:0},data:{updateAt:0},isRequesting:!1},sm=(i=Bi,e)=>be(i,t=>{const{payload:s}=e;if(!s)return;const{playerId:n,stats:a,match:r,current:c,players:o,leaders:l}=s;switch(e.type){case Jo:delete t.data[n],t.current=Bi.current;break;case $p:t.data=Bi.data,t.isRequesting=!0;break;case Xp:t.data=a,t.isRequesting=!1;break;case Qo:t.data[n]=a;break;case ec:t.current=Ce({...i.current},a);break;case Un:Object.keys(o).forEach(h=>{t.data[h]={score:0}});break;case Zp:l.forEach(h=>{const{playerId:d,score:u,rank:p}=h;t.data[d]={score:u,rank:p}});break;case Bn:{const{blackPlayerId:h,blackPlayerScore:d,whitePlayerId:u,whitePlayerScore:p,whitePlayerLevel:m,blackPlayerLevel:g}=r||{};if(!h||!u)break;c&&(t.current=c),t.data[h]={score:d,level:g},t.data[u]={score:p,level:m}}break}}),im={[Ko]:Po({gameplay:em,match:tm,stats:sm})},nm="tournament",mc="TOURNAMENT_ACTIVE",am="TOURNAMENT_REQUEST",rm="TOURNAMENT_RECEIVED",om={active:!1,tournamentId:null,bestSessionScore:0,isRequesting:!1},cm=(i=om,e)=>be(i,t=>{const{payload:s}=e;if(!s)return;const{score:n=0,tournamentId:a}=s;switch(e.type){case mc:t.active=!0,t.tournamentId=a;break;case am:t.isRequesting=!0;break;case rm:t.isRequesting=!1,n>i.bestSessionScore&&(t.bestSessionScore=n);break}}),lm={[nm]:cm},gc="leaderboards",fc="LEADERBOARD_DATA_REQUEST",Ec="LEADERBOARD_DATA_UPDATE",hm="LEADERBOARD_DATA_CLEAR",mt={leaderboardId:"",type:"",limit:0,offset:0,leaders:{},isRequesting:!1},um=(i=mt,e)=>be(i,t=>{const{payload:s}=e;if(!s)return;const{leaderboardId:n,type:a,limit:r,offset:c,leaders:o}=s;switch(e.type){case fc:i.type!==a&&c===0&&(t.leaders=mt.leaders),t.isRequesting=!0,t.leaderboardId=n,t.type=a,t.limit=r,t.offset=c;break;case Ec:{if(t.isRequesting=!1,i.type!==a)break;const l=GameCore.Utils.Json.clone({...i.leaders,...o}),d=Object.values(l).filter(u=>!!u.name);d.sort((u,p)=>+p.score-+u.score),d.forEach((u,p)=>{u.rank=p+1,i.leaders[u.playerId]||(t.leaders[u.playerId]=u)})}break;case hm:t.isRequesting=!1,t.type=mt.type,t.limit=mt.limit,t.offset=mt.offset,t.leaders=mt.leaders,t.leaderboardId=mt.leaderboardId;break}}),dm={[gc]:um},gi="missions",yc="MISSIONS_DATA_REQUEST",Sc="MISSIONS_DATA_RECEIVE",Ac="MISSION_START",Tc="MISSION_UPDATE",Ic="MISSION_COMPLETED",pm={mission:null,missions:null,isRequesting:!1},mm=(i=pm,e)=>be(i,t=>{const{payload:s}=e;if(!s)return;const{name:n,type:a,value:r,missions:c}=s;switch(e.type){case yc:t.isRequesting=!0;break;case Sc:if(t.isRequesting=!1,c.length<1)return;t.missions={},c.forEach(o=>{t.missions[o.name]=o});break;case Ac:{if(i.missions===null)break;const o=i.missions[n];t.mission={name:n,process:{},require:o.require,reward:o.reward},Object.keys(o.require).forEach(l=>{t.mission.process[l]=0});break}case Tc:if(i.mission?.name!==n)break;t.mission.process[a]+=r;break;case Ic:if(i.mission?.name!==n)break;t.mission=null;break}}),gm={[gi]:mm},xs="dailyTasks",bc="DAILY_TASKS_DATA_REQUEST",wc="DAILY_TASKS_DATA_RECEIVE",Cc="DAILY_TASKS_PROCESS_UPDATE",vc="DAILY_TASK_VALUE_ADD",_c="DAILY_TASK_REWARDED",Oc="DAILY_TASKS_SEEN",Rc="DAILY_TASK_FINISHED",fm={tasks:[],process:[],isRequesting:!1,isNotice:!1},Em=(i=fm,e)=>be(i,t=>{const{payload:s}=e;if(!s)return;const{id:n,type:a,value:r,tasks:c,process:o}=s;switch(e.type){case bc:t.isRequesting=!0;break;case wc:t.isRequesting=!1,t.tasks=c;break;case Cc:t.process=o;break;case vc:if(!i.process[n])break;t.process[n][a]+=r;break;case _c:if(!i.process[n])break;t.process[n].rewarded=!0;break;case Oc:t.isNotice=!1;break;case Rc:t.isNotice=!0;break}}),ym={[xs]:Em},Fn="dailyRewards",Pc="DAILY_REWARDS_REQUEST",Dc="DAILY_REWARDS_RECEIVE",Sm={rewards:[],isRequesting:!1},Am=(i=Sm,e)=>be(i,t=>{const{payload:s}=e;if(!s)return;const{rewards:n}=s;switch(e.type){case Pc:t.isRequesting=!0;break;case Dc:t.isRequesting=!1,t.rewards=n;break}}),Tm={[Fn]:Am},Im=Po({scene:Np,context:kp,messages:Bp,...Yp,...Wp,...zp,...im,...lm,...dm,...gm,...ym,...Tm}),{__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:qb}=window;let bm=Do;const wm=i=>{const e=bm(Tp(Ip));return Ro(Im,i,e)};class Cm extends Phaser.Plugins.BasePlugin{store;initiator;init(){this.store=wm({})}setInitiator(e){this.initiator=e}syncStore(){this.initiator.initContext(),this.initiator.initPlayer()}dispatch=e=>this.store.dispatch(e);getState=()=>this.store.getState();subscribe=e=>this.store.subscribe(e);watch=(e,t)=>{const s=gp(()=>{const n=this.getState();return e(n)});return this.subscribe(s(n=>{t(n)}))}}var Sn={},vm={get exports(){return Sn},set exports(i){Sn=i}};(function(i){(function(){function e(A,C,P){return A.call.apply(A.bind,arguments)}function t(A,C,P){if(!A)throw Error();if(2<arguments.length){var R=Array.prototype.slice.call(arguments,2);return function(){var x=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(x,R),A.apply(C,x)}}return function(){return A.apply(C,arguments)}}function s(A,C,P){return s=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?e:t,s.apply(null,arguments)}var n=Date.now||function(){return+new Date};function a(A,C){this.a=A,this.o=C||A,this.c=this.o.document}var r=!!window.FontFace;function c(A,C,P,R){if(C=A.c.createElement(C),P)for(var x in P)P.hasOwnProperty(x)&&(x=="style"?C.style.cssText=P[x]:C.setAttribute(x,P[x]));return R&&C.appendChild(A.c.createTextNode(R)),C}function o(A,C,P){A=A.c.getElementsByTagName(C)[0],A||(A=document.documentElement),A.insertBefore(P,A.lastChild)}function l(A){A.parentNode&&A.parentNode.removeChild(A)}function h(A,C,P){C=C||[],P=P||[];for(var R=A.className.split(/\s+/),x=0;x<C.length;x+=1){for(var F=!1,H=0;H<R.length;H+=1)if(C[x]===R[H]){F=!0;break}F||R.push(C[x])}for(C=[],x=0;x<R.length;x+=1){for(F=!1,H=0;H<P.length;H+=1)if(R[x]===P[H]){F=!0;break}F||C.push(R[x])}A.className=C.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function d(A,C){for(var P=A.className.split(/\s+/),R=0,x=P.length;R<x;R++)if(P[R]==C)return!0;return!1}function u(A){return A.o.location.hostname||A.a.location.hostname}function p(A,C,P){function R(){Z&&x&&F&&(Z(H),Z=null)}C=c(A,"link",{rel:"stylesheet",href:C,media:"all"});var x=!1,F=!0,H=null,Z=P||null;r?(C.onload=function(){x=!0,R()},C.onerror=function(){x=!0,H=Error("Stylesheet failed to load"),R()}):setTimeout(function(){x=!0,R()},0),o(A,"head",C)}function m(A,C,P,R){var x=A.c.getElementsByTagName("head")[0];if(x){var F=c(A,"script",{src:C}),H=!1;return F.onload=F.onreadystatechange=function(){H||this.readyState&&this.readyState!="loaded"&&this.readyState!="complete"||(H=!0,P&&P(null),F.onload=F.onreadystatechange=null,F.parentNode.tagName=="HEAD"&&x.removeChild(F))},x.appendChild(F),setTimeout(function(){H||(H=!0,P&&P(Error("Script load timeout")))},R||5e3),F}return null}function g(){this.a=0,this.c=null}function y(A){return A.a++,function(){A.a--,E(A)}}function f(A,C){A.c=C,E(A)}function E(A){A.a==0&&A.c&&(A.c(),A.c=null)}function S(A){this.a=A||"-"}S.prototype.c=function(A){for(var C=[],P=0;P<arguments.length;P++)C.push(arguments[P].replace(/[\W_]+/g,"").toLowerCase());return C.join(this.a)};function I(A,C){this.c=A,this.f=4,this.a="n";var P=(C||"n4").match(/^([nio])([1-9])$/i);P&&(this.a=P[1],this.f=parseInt(P[2],10))}function T(A){return _(A)+" "+(A.f+"00")+" 300px "+b(A.c)}function b(A){var C=[];A=A.split(/,\s*/);for(var P=0;P<A.length;P++){var R=A[P].replace(/['"]/g,"");R.indexOf(" ")!=-1||/^\d/.test(R)?C.push("'"+R+"'"):C.push(R)}return C.join(",")}function O(A){return A.a+A.f}function _(A){var C="normal";return A.a==="o"?C="oblique":A.a==="i"&&(C="italic"),C}function w(A){var C=4,P="n",R=null;return A&&((R=A.match(/(normal|oblique|italic)/i))&&R[1]&&(P=R[1].substr(0,1).toLowerCase()),(R=A.match(/([1-9]00|normal|bold)/i))&&R[1]&&(/bold/i.test(R[1])?C=7:/[1-9]00/.test(R[1])&&(C=parseInt(R[1].substr(0,1),10)))),P+C}function v(A,C){this.c=A,this.f=A.o.document.documentElement,this.h=C,this.a=new S("-"),this.j=C.events!==!1,this.g=C.classes!==!1}function M(A){A.g&&h(A.f,[A.a.c("wf","loading")]),N(A,"loading")}function L(A){if(A.g){var C=d(A.f,A.a.c("wf","active")),P=[],R=[A.a.c("wf","loading")];C||P.push(A.a.c("wf","inactive")),h(A.f,P,R)}N(A,"inactive")}function N(A,C,P){A.j&&A.h[C]&&(P?A.h[C](P.c,O(P)):A.h[C]())}function G(){this.c={}}function B(A,C,P){var R=[],x;for(x in C)if(C.hasOwnProperty(x)){var F=A.c[x];F&&R.push(F(C[x],P))}return R}function q(A,C){this.c=A,this.f=C,this.a=c(this.c,"span",{"aria-hidden":"true"},this.f)}function ie(A){o(A.c,"body",A.a)}function ye(A){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+b(A.c)+";"+("font-style:"+_(A)+";font-weight:"+(A.f+"00")+";")}function te(A,C,P,R,x,F){this.g=A,this.j=C,this.a=R,this.c=P,this.f=x||3e3,this.h=F||void 0}te.prototype.start=function(){var A=this.c.o.document,C=this,P=n(),R=new Promise(function(H,Z){function J(){n()-P>=C.f?Z():A.fonts.load(T(C.a),C.h).then(function(ne){1<=ne.length?H():setTimeout(J,25)},function(){Z()})}J()}),x=null,F=new Promise(function(H,Z){x=setTimeout(Z,C.f)});Promise.race([F,R]).then(function(){x&&(clearTimeout(x),x=null),C.g(C.a)},function(){C.j(C.a)})};function Qe(A,C,P,R,x,F,H){this.v=A,this.B=C,this.c=P,this.a=R,this.s=H||"BESbswy",this.f={},this.w=x||3e3,this.u=F||null,this.m=this.j=this.h=this.g=null,this.g=new q(this.c,this.s),this.h=new q(this.c,this.s),this.j=new q(this.c,this.s),this.m=new q(this.c,this.s),A=new I(this.a.c+",serif",O(this.a)),A=ye(A),this.g.a.style.cssText=A,A=new I(this.a.c+",sans-serif",O(this.a)),A=ye(A),this.h.a.style.cssText=A,A=new I("serif",O(this.a)),A=ye(A),this.j.a.style.cssText=A,A=new I("sans-serif",O(this.a)),A=ye(A),this.m.a.style.cssText=A,ie(this.g),ie(this.h),ie(this.j),ie(this.m)}var _e={D:"serif",C:"sans-serif"},os=null;function He(){if(os===null){var A=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);os=!!A&&(536>parseInt(A[1],10)||parseInt(A[1],10)===536&&11>=parseInt(A[2],10))}return os}Qe.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=n(),Pe(this)};function cs(A,C,P){for(var R in _e)if(_e.hasOwnProperty(R)&&C===A.f[_e[R]]&&P===A.f[_e[R]])return!0;return!1}function Pe(A){var C=A.g.a.offsetWidth,P=A.h.a.offsetWidth,R;(R=C===A.f.serif&&P===A.f["sans-serif"])||(R=He()&&cs(A,C,P)),R?n()-A.A>=A.w?He()&&cs(A,C,P)&&(A.u===null||A.u.hasOwnProperty(A.a.c))?Ri(A,A.v):Ri(A,A.B):Fl(A):Ri(A,A.v)}function Fl(A){setTimeout(s(function(){Pe(this)},A),50)}function Ri(A,C){setTimeout(s(function(){l(this.g.a),l(this.h.a),l(this.j.a),l(this.m.a),C(this.a)},A),0)}function Pi(A,C,P){this.c=A,this.a=C,this.f=0,this.m=this.j=!1,this.s=P}var Ys=null;Pi.prototype.g=function(A){var C=this.a;C.g&&h(C.f,[C.a.c("wf",A.c,O(A).toString(),"active")],[C.a.c("wf",A.c,O(A).toString(),"loading"),C.a.c("wf",A.c,O(A).toString(),"inactive")]),N(C,"fontactive",A),this.m=!0,ra(this)},Pi.prototype.h=function(A){var C=this.a;if(C.g){var P=d(C.f,C.a.c("wf",A.c,O(A).toString(),"active")),R=[],x=[C.a.c("wf",A.c,O(A).toString(),"loading")];P||R.push(C.a.c("wf",A.c,O(A).toString(),"inactive")),h(C.f,R,x)}N(C,"fontinactive",A),ra(this)};function ra(A){--A.f==0&&A.j&&(A.m?(A=A.a,A.g&&h(A.f,[A.a.c("wf","active")],[A.a.c("wf","loading"),A.a.c("wf","inactive")]),N(A,"active")):L(A.a))}function oa(A){this.j=A,this.a=new G,this.h=0,this.f=this.g=!0}oa.prototype.load=function(A){this.c=new a(this.j,A.context||this.j),this.g=A.events!==!1,this.f=A.classes!==!1,Hl(this,new v(this.c,A),A)};function Yl(A,C,P,R,x){var F=--A.h==0;(A.f||A.g)&&setTimeout(function(){var H=x||null,Z=R||null||{};if(P.length===0&&F)L(C.a);else{C.f+=P.length,F&&(C.j=F);var J,ne=[];for(J=0;J<P.length;J++){var ae=P[J],Se=Z[ae.c],De=C.a,Pt=ae;if(De.g&&h(De.f,[De.a.c("wf",Pt.c,O(Pt).toString(),"loading")]),N(De,"fontloading",Pt),De=null,Ys===null)if(window.FontFace){var Pt=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),Ql=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);Ys=Pt?42<parseInt(Pt[1],10):!Ql}else Ys=!1;Ys?De=new te(s(C.g,C),s(C.h,C),C.c,ae,C.s,Se):De=new Qe(s(C.g,C),s(C.h,C),C.c,ae,C.s,H,Se),ne.push(De)}for(J=0;J<ne.length;J++)ne[J].start()}},0)}function Hl(A,C,P){var x=[],R=P.timeout;M(C);var x=B(A.a,P,A.c),F=new Pi(A.c,C,R);for(A.h=x.length,C=0,P=x.length;C<P;C++)x[C].load(function(H,Z,J){Yl(A,F,H,Z,J)})}function ca(A,C){this.c=A,this.a=C}ca.prototype.load=function(A){function C(){if(F["__mti_fntLst"+R]){var H=F["__mti_fntLst"+R](),Z=[],J;if(H)for(var ne=0;ne<H.length;ne++){var ae=H[ne].fontfamily;H[ne].fontStyle!=null&&H[ne].fontWeight!=null?(J=H[ne].fontStyle+H[ne].fontWeight,Z.push(new I(ae,J))):Z.push(new I(ae))}A(Z)}else setTimeout(function(){C()},50)}var P=this,R=P.a.projectId,x=P.a.version;if(R){var F=P.c.o;m(this.c,(P.a.api||"https://fast.fonts.net/jsapi")+"/"+R+".js"+(x?"?v="+x:""),function(H){H?A([]):(F["__MonotypeConfiguration__"+R]=function(){return P.a},C())}).id="__MonotypeAPIScript__"+R}else A([])};function la(A,C){this.c=A,this.a=C}la.prototype.load=function(A){var C,P,R=this.a.urls||[],x=this.a.families||[],F=this.a.testStrings||{},H=new g;for(C=0,P=R.length;C<P;C++)p(this.c,R[C],y(H));var Z=[];for(C=0,P=x.length;C<P;C++)if(R=x[C].split(":"),R[1])for(var J=R[1].split(","),ne=0;ne<J.length;ne+=1)Z.push(new I(R[0],J[ne]));else Z.push(new I(R[0]));f(H,function(){A(Z,F)})};function Vl(A,C){A?this.c=A:this.c=Wl,this.a=[],this.f=[],this.g=C||""}var Wl="https://fonts.googleapis.com/css";function Kl(A,C){for(var P=C.length,R=0;R<P;R++){var x=C[R].split(":");x.length==3&&A.f.push(x.pop());var F="";x.length==2&&x[1]!=""&&(F=":"),A.a.push(x.join(F))}}function jl(A){if(A.a.length==0)throw Error("No fonts to load!");if(A.c.indexOf("kit=")!=-1)return A.c;for(var C=A.a.length,P=[],R=0;R<C;R++)P.push(A.a[R].replace(/ /g,"+"));return C=A.c+"?family="+P.join("%7C"),0<A.f.length&&(C+="&subset="+A.f.join(",")),0<A.g.length&&(C+="&text="+encodeURIComponent(A.g)),C}function zl(A){this.f=A,this.a=[],this.c={}}var ha={latin:"BESbswy","latin-ext":"çöüğş",cyrillic:"йяЖ",greek:"αβΣ",khmer:"កខគ",Hanuman:"កខគ"},$l={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},Xl={i:"i",italic:"i",n:"n",normal:"n"},ql=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function Zl(A){for(var C=A.f.length,P=0;P<C;P++){var R=A.f[P].split(":"),x=R[0].replace(/\+/g," "),F=["n4"];if(2<=R.length){var H,Z=R[1];if(H=[],Z)for(var Z=Z.split(","),J=Z.length,ne=0;ne<J;ne++){var ae;if(ae=Z[ne],ae.match(/^[\w-]+$/)){var Se=ql.exec(ae.toLowerCase());if(Se==null)ae="";else{if(ae=Se[2],ae=ae==null||ae==""?"n":Xl[ae],Se=Se[1],Se==null||Se=="")Se="4";else var De=$l[Se],Se=De||(isNaN(Se)?"4":Se.substr(0,1));ae=[ae,Se].join("")}}else ae="";ae&&H.push(ae)}0<H.length&&(F=H),R.length==3&&(R=R[2],H=[],R=R?R.split(","):H,0<R.length&&(R=ha[R[0]])&&(A.c[x]=R))}for(A.c[x]||(R=ha[x])&&(A.c[x]=R),R=0;R<F.length;R+=1)A.a.push(new I(x,F[R]))}}function ua(A,C){this.c=A,this.a=C}var Jl={Arimo:!0,Cousine:!0,Tinos:!0};ua.prototype.load=function(A){var C=new g,P=this.c,R=new Vl(this.a.api,this.a.text),x=this.a.families;Kl(R,x);var F=new zl(x);Zl(F),p(P,jl(R),y(C)),f(C,function(){A(F.a,F.c,Jl)})};function da(A,C){this.c=A,this.a=C}da.prototype.load=function(A){var C=this.a.id,P=this.c.o;C?m(this.c,(this.a.api||"https://use.typekit.net")+"/"+C+".js",function(R){if(R)A([]);else if(P.Typekit&&P.Typekit.config&&P.Typekit.config.fn){R=P.Typekit.config.fn;for(var x=[],F=0;F<R.length;F+=2)for(var H=R[F],Z=R[F+1],J=0;J<Z.length;J++)x.push(new I(H,Z[J]));try{P.Typekit.load({events:!1,classes:!1,async:!0})}catch{}A(x)}},2e3):A([])};function pa(A,C){this.c=A,this.f=C,this.a=[]}pa.prototype.load=function(A){var C=this.f.id,P=this.c.o,R=this;C?(P.__webfontfontdeckmodule__||(P.__webfontfontdeckmodule__={}),P.__webfontfontdeckmodule__[C]=function(x,F){for(var H=0,Z=F.fonts.length;H<Z;++H){var J=F.fonts[H];R.a.push(new I(J.name,w("font-weight:"+J.weight+";font-style:"+J.style)))}A(R.a)},m(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+u(this.c)+"/"+C+".js",function(x){x&&A([])})):A([])};var et=new oa(window);et.a.c.custom=function(A,C){return new la(C,A)},et.a.c.fontdeck=function(A,C){return new pa(C,A)},et.a.c.monotype=function(A,C){return new ca(C,A)},et.a.c.typekit=function(A,C){return new da(C,A)},et.a.c.google=function(A,C){return new ua(C,A)};var ma={load:s(et.load,et)};i.exports?i.exports=ma:(window.WebFont=ma,window.WebFontConfig&&et.load(window.WebFontConfig))})()})(vm);const _m=Sn;class Om extends Phaser.Loader.File{payload;constructor(e,t){super(e,{type:"webfont",key:t.type}),this.payload=t}load(){const{type:e}=this.payload;let t;switch(e){case"google":t=this.getGoogleFontConfig(this.payload);break;case"local":t=this.getLocalFontConfig(this.payload);break}_m.load(t)}getGoogleFontConfig(e){const{character:t,fontName:s,fontWeight:n=400}=e;return{google:{families:[`${s}:${n}`],text:t},active:()=>{this.loader.nextFile(this,!0)},timeout:15e3}}getLocalFontConfig(e){const{fontName:t,fontType:s}=e,n=document.createElement("style");document.head.appendChild(n);const a=n.sheet;if(a){const c=`@font-face { font-family: "${t}"; src: url("assets/fonts/${t}${s==="opentype"?".otf":".ttf"}") format("${s}"); }`;a.insertRule(c,0)}return{custom:{families:[t]},active:()=>{this.loader.nextFile(this,!0)},timeout:15e3}}}class Rm extends Phaser.Plugins.ScenePlugin{addFont(e){const t=new Om(this.scene.load,e);this.scene.load.addFile(t)}}class Pm extends Phaser.Plugins.BasePlugin{portraitRatio;portraitWidth;portraitHeight;landscapeRatio;landscapeWidth;landscapeHeight;worldWidth;worldHeight;worldRatio;autoResize;disableLandscape;fullSizeOnLandscape;forcePixelRatio;configure(e){const{autoResize:t,portraitRatio:s,portraitWidth:n,portraitHeight:a,landscapeWidth:r,landscapeHeight:c,landscapeRatio:o,disableLandscape:l,fullSizeOnLandscape:h}=e;this.autoResize=t,this.disableLandscape=l,this.fullSizeOnLandscape=h,this.portraitRatio=s,this.portraitWidth=n,this.portraitHeight=a,this.landscapeRatio=o,this.landscapeWidth=r,this.landscapeHeight=c,this.initWorldSize(),this.addEventResize()}resize(e){e&&e>0&&(this.forcePixelRatio=e);const{width:t,height:s}=this.getCanvasSizeFixedRatio(this.worldRatio);this.resizeCanvas(t,s),this.game.scene.scenes.forEach(n=>{const a=n.cameras.main;if(!a)return;const r=this.getZoomRatio(),{width:c,height:o}=this.getWorldSize();a.setZoom(r),a.centerOn(c/2,o/2)})}resizeCanvas(e,t){this.game.canvas.width=e,this.game.canvas.height=t,this.game.scale.resize(e,t)}getWorldSize(){return{width:this.worldWidth,height:this.worldHeight}}initWorldSize(){if(this.worldWidth=this.portraitWidth,this.worldHeight=this.portraitHeight,this.isScreenSmallerRatio(this.portraitRatio))this.worldHeight=this.worldWidth/this.getScreenRatio();else if(!this.disableLandscape&&(this.worldWidth=this.landscapeWidth,this.worldHeight=this.landscapeHeight,this.fullSizeOnLandscape)){this.worldRatio=this.worldWidth/this.worldHeight,this.landscapeRatio=this.getScreenRatio();const{width:e,height:t}=this.getCanvasSizeFixedRatio(this.landscapeRatio),s=this.getZoomRatio();this.worldWidth=e/s,this.worldHeight=t/s}this.worldRatio=this.worldWidth/this.worldHeight,console.info("🚀 > this.worldRatio",this.worldRatio)}getZoomRatio(){const{width:e}=this.getWorldSize(),{width:t}=this.getCanvasSizeFixedRatio(this.worldRatio);return t/e}getPixelRatio(){if(this.forcePixelRatio>0)return this.forcePixelRatio;if(GameCore.Utils.Device.isDesktop())return 2;let e=GameCore.Utils.Device.pixelRatio();return e>2&&(e=2),e}getPhysicPixels(e,t){return e*t}getCanvasSizeFixedRatio(e){const t=this.getPixelRatio();let s=this.getScreenWidth()*t,n=this.getScreenHeight()*t;return this.isScreenSmallerRatio(e)?n=s/e:s=n*e,{width:s,height:n}}getScreenRatio(){return this.getScreenWidth()/this.getScreenHeight()}getScreenHeight(){const{body:e,documentElement:t}=document,{clientHeight:s}=e,{clientHeight:n}=t;return Math.max(n,s)||0}getScreenWidth(){const{body:e,documentElement:t}=document,{clientWidth:s}=e,{clientWidth:n}=t;return Math.max(n,s)||0}isScreenSmallerRatio(e){return this.getScreenRatio()<e}addEventResize(){this.autoResize&&window.addEventListener("resize",this.handleResize)}handleResize=hi(()=>{this.resize()},300);isLandscape(){return this.disableLandscape?!1:this.worldRatio>this.portraitRatio}}class Dm{contextId;contextType;entryPointData;constructor(e,t,s){this.contextId=e||Gi.contextId,this.contextType=t||Gi.contextType,this.entryPointData=s||Gi.entryPointData}toObject(){return{contextId:this.contextId,contextType:this.contextType,entryPointData:this.entryPointData}}}class Yn extends Error{constructor(e,t){super(e,t),this.name="InvalidPlayerId",this.message=e||"The playerId is not valid",this.payload=t}}const Hn="share_invite",ka="tournament",Jt="challenge_friend_match",Vn="matching_group_match",Re=new Ht("10","Your Friend",fe.AVATAR.FILE).toObject(),Ye="single",Ge="challenge-friends",$e="matching-group",Xe="tournaments",Mm="online",Lm=i=>i.context,xm=i=>i.context.currentGameMode,Qt=V([Lm],i=>i),Mc=V([xm],i=>i),Nm=(i,e,t)=>({type:xo,payload:{contextId:i,contextType:e,entryPointData:t}}),An=(i,e)=>({type:No,payload:{contextId:i,contextType:e}}),km=()=>async(i,e)=>{const t=e(),s=Qt(t),{player:n,facebook:a}=window.game,r=n.getPlayerId(),{contextId:c,entryPointData:o}=s,{type:l,matchId:h,playerId:d,opponentId:u=Re.playerId,tournamentContextId:p}=o||{},m=r===d,g=u===Re.playerId||[u,d].indexOf(r)>=0;let y=Ye;if(c&&(l===void 0||l===ka))try{await a.getTournamentAsync(),y=Xe}catch{}l===ka&&p&&(y=Xe),c&&l===Hn&&!m&&(y=Ge),h&&c&&g&&l===Jt&&(y=Ge),c&&l===Vn&&(y=$e),i(Lc(y))},Lc=i=>e=>{e({type:ko,payload:{gameMode:i}}),ui("game-mode",i)},{PlayerDataStore:Gm}=GameCore.Configs;class Bm{game;constructor(e){this.game=e}initContext=()=>{const e=window.GameSDK.context.getID(),t=window.GameSDK.context.getType(),s=window.GameSDK.getEntryPointData(),n=new Dm(e,t,s),{contextId:a,contextType:r,entryPointData:c}=n.toObject();this.game.storage.dispatch(Nm(a,r,c))};initPlayer=()=>{const e=this.getPlayerInfo(),t=this.getPlayerDataLocal(),{player:s}=this.game;s.receiveData(e,t)};getPlayerInfo=()=>{try{const e=window.GameSDK.player.getID();let t=window.GameSDK.player.getName();const s=window.GameSDK.player.getPhoto(),n=window.GameSDK.getLocale();if(!GameCore.Utils.Valid.isString(e))throw new Yn(null,{playerId:e});return GameCore.Utils.Valid.isString(t)||(t="You"),new Ht(e,t,s,n).toObject()}catch{return new Ht("123","You").toObject()}};getPlayerDataLocal=()=>{try{const e=vn(Gm);return GameCore.Utils.Valid.isObject(e)?new To(e).toObject():null}catch(e){return console.warn(e),null}}}const $={BOOT_SCENE:"BOOT_SCENE",LOAD_SCENE:"LOAD_SCENE",GAME_SCENE:"GAME_SCENE",GLOBAL_SCENE:"GLOBAL_SCENE",DASHBOARD_SCENE:"DASHBOARD_SCENE",GAME_OVER_SCENE:"GAME_OVER_SCENE",LEADERBOARD_SCENE:"LEADERBOARD_SCENE",RESULT_MATCH_SCENE:"RESULT_MATCH_SCENE",TEST_SCENE:"TEST_SCENE",ANIMATIONS_SCENE:"ANIMATIONS_SCENE"},ke={SWITCH:Symbol("SWITCH")};class Um extends Phaser.Plugins.BasePlugin{Text;Texture;currentLocale;supportedLanguages;data;configure(e){this.applyOptions(e)}getCurrentLanguage(){return this.currentLocale}switchLanguage(e="en"){const t=this.getCorrectLocale(e);this.currentLocale=t,this.Text=this.data[t].Text,this.Texture=this.data[t].Texture}getText(e){if(typeof e=="object"){const{key:t,variables:s=[],locale:n=this.currentLocale}=e,a=this.getCorrectLocale(n),r=this.data[a].Text[t];return this.replaceVariables(r,s)}return this.Text[e]}getTexture(e){if(typeof e=="object"){const{key:t,variables:s=[],locale:n=this.currentLocale}=e,a=this.getCorrectLocale(n),r=this.data[a].Texture[t];return this.replaceVariables(r,s)}return this.Texture[e]}isSupportLanguage(e){return this.supportedLanguages.indexOf(e)>=0}applyOptions(e){const{data:t,locale:s="en",upperCaseText:n=!1}=e;this.data=t,this.supportedLanguages=Object.keys(t);const a=this.getCorrectLocale(s);if(this.currentLocale=a,this.Text=t[a].Text,this.Texture=t[a].Texture,n)for(const r in this.Text)this.Text[r]=this.Text[r].toUpperCase()}replaceVariables(e,t){const s=t.length;if(s==0)return e;let n=0;return e.replace(/{.*}/,function(){return String(t[Math.min(n++,s-1)])})}getCorrectLocale(e){let t=e.split("_")[0];return this.isSupportLanguage(t)||(t="en"),t}}const Fm={PLAY_NOW:"PLAY NOW",RANK:"RANK",DAILY:"DAILY",GIFT:"GIFT",SETTINGS:"SETTINGS",GUIDE_1_TAP:"TAP ON TWO OR MORE GEMS OF THE SAME COLOR TO DESTROY THEM",GUIDE_2_SCORE:"THIS IS YOUR CURRENT SCORE",GUIDE_3_TARGET_SCORE:"THIS IS THE TARGET SCORE FOR EACH LEVEL YOU NEED TO PASS",LEVEL:"LEVEL",TARGET:"TARGET",REPLAY:"REPLAY",PLAY_WITH_FRIENDS:"PLAY WITH FRIENDS",PLAY:"PLAY",WITH_FRIENDS:"WITH_FRIENDS",HOME:"HOME",DAILY_REWARDS:"DAILY REWARDS",DAY_X:"DAY {X}",CLAIM:"CLAIM",CLAIM_X2:"CLAIM X2",CANCELLED_AD:`SORRY, NO REWARDS!
YOU HAVE CANCELLED
THE AD!`,LOADING:"LOADING...",WATCH_A_VIDEO:`WATCH A VIDEO TO GET
{X} DIAMONDS`,GET_NOW:"GET NOW!",NO_THANKS:"NO THANKS!",LOADING_ADS:"LOADING ADS...",NO_ADS:"NO ADS TO DISPLAY!",DAILY_MISSIONS:"DAILY MISSIONS",PASS_10_LEVELS:"PASS 10 LEVELS",COLLECT_300:"COLLECT 300 DIAMONDS",INVITE_2:"INVITE 2 FRIENDS",REACH_TOTAL:"REACH TOTAL SCORES",LEADERBOARDS:"LEADERBOARDS",FRIENDS:"FRIENDS",WORLD:"WORLD",HAMMER:"HAMMER",USE_HAMMER:`USE HAMMER TO SMASH
ANY GEM`,MAGIC_BOTTLE:"MAGIC BOTTLE",USE_MAGIC:`USE MAGIC BOTTLE TO 
CHANGE A GEM COLOR`,CONGRATULATIONS:"CONGRATULATIONS !",GOOD:"GOOD !",EXCELLENT:"EXCELLENT !",COOL:"COOL !",GREAT:"GREAT !",LOADING_INTER_AD:"Loading interstitial ad...",LEVEL_FAILED:"LEVEL FAILED",YOU_DID_NOT_REACH:"YOU DID NOT REACH THE TARGET SCORE",YOUR_SCORE:"YOUR SCORE",BEST_SCORE:"BEST SCORE",GLOBAL:"GLOBAL",JOIN:"JOIN",CONTINUE:"CONTINUE",TODAY_RECORD:"TODAY RECORD",SHARE:"SHARE",WAITING:"WAITING",WAITING_OPPONENT:"WAITING FOR OPPONENT",DRAW:"DRAW",YOU_WIN:"YOU WIN",YOU_LOSE:"YOU LOSE",RESTART:"RESTART",A_HA:"A ha, I'm the best!",PHEWW:"Pheww, a great match!",DIAMOND:"DIAMOND",LB_IS_EMPTY:"Leaderboard is empty!",YOU_RECEIVED_X_DIAMONDS:`You have just received
{X} diamonds`,MISSION:"Mission",REQUESTING:"requesting...",MILESTONE:"MILESTONE"},Ym={NO_THANK:"texts/no-thank",COOL:"texts/cool",GOOD:"texts/good",GREAT:"texts/great",EXCELLENT:"texts/excellent",CONGRATULATION:"texts/congratulation",LOGO:"title-logo"},Hm={Text:Fm,Texture:Ym},Vm={PLAY_NOW:"今すぐプレイ",RANK:"ランク",DAILY:"デイリー",GIFT:"ギフト",SETTINGS:"設定",GUIDE_1_TAP:`同じ色のジェムを
2つ以上タップする
と破壊できます`,GUIDE_2_SCORE:"現在のスコアはこちらです",GUIDE_3_TARGET_SCORE:`各レベルをクリアするため
に必要な目標スコアです`,LEVEL:"レベル",TARGET:"目標",REPLAY:"リプレイ",PLAY_WITH_FRIENDS:"フレンドとプレイ",PLAY:"プレイ",WITH_FRIENDS:"友達と",HOME:"ホーム",DAILY_REWARDS:"デイリーリワード",DAY_X:"{X}日目",CLAIM:"入手",CLAIM_X2:"2倍入手",CANCELLED_AD:`申し訳ありません、
報酬はありません！
広告をキャンセル
しました！`,LOADING:"読み込み中",WATCH_A_VIDEO:`動画の視聴で
ダイヤモンド {X}個を獲得`,GET_NOW:"今すぐ入手！",NO_THANKS:"結構です！",LOADING_ADS:"広告を読み込み中...",NO_ADS:"表示する広告はありません！",DAILY_MISSIONS:"デイリーミッション",PASS_10_LEVELS:"レベル10をクリア",COLLECT_300:"ダイヤモンドを300個集める",INVITE_2:"2人のフレンドを招待",REACH_TOTAL:"合計スコアに到達",LEADERBOARDS:"リーダーボード",FRIENDS:"フレンド",WORLD:"世界",HAMMER:"ハンマー",USE_HAMMER:`ハンマーを使って  
ジェムを破壊`,MAGIC_BOTTLE:"マジックボトル",USE_MAGIC:`マジックボトルを使って   
ジェムの色を変える`,CONGRATULATIONS:"おめでとうございます！",GOOD:"良い！",EXCELLENT:"素晴らしい！",COOL:"かっこいい !",GREAT:"最高！",LOADING_INTER_AD:"インタースティシャル広告を読み込み中...",LEVEL_FAILED:"レベルクリア失敗",YOU_DID_NOT_REACH:"目標スコアに到達できませんでした",YOUR_SCORE:"あなたのスコア",BEST_SCORE:"最高スコア",GLOBAL:"グローバル",JOIN:"参加",CONTINUE:"続ける",TODAY_RECORD:"本日の記録",SHARE:"シェア",WAITING:"待機中",WAITING_OPPONENT:"対戦相手を待っています",DRAW:"引き分け",YOU_WIN:"勝利",YOU_LOSE:"敗北",RESTART:"やり直す",A_HA:"ああ、私は最高 !",PHEWW:"ふぅ、素晴らしい試合だった！",DIAMOND:"ダイヤモンド",LB_IS_EMPTY:"リーダーボードが空です！",YOU_RECEIVED_X_DIAMONDS:`{X} 個のダイヤモンド
を受け取りました`,MISSION:"ミッション",REQUESTING:"リクエスト中...",MILESTONE:"マイルストーン"},Wm={NO_THANK:"texts/no-thank-ja",COOL:"texts/cool-ja",GOOD:"texts/good-ja",GREAT:"texts/great-ja",EXCELLENT:"texts/excellent-ja",CONGRATULATION:"texts/congratulation-ja",LOGO:"title-logo-ja"},Km={Text:Vm,Texture:Wm},jm={PLAY_NOW:"MAINKAN SEKARANG",RANK:"PERINGKAT",DAILY:"HARIAN",GIFT:"HADIAH",SETTINGS:"PENGATURAN",GUIDE_1_TAP:"KETUK PADA DUA ATAU LEBIH PERMATA BERWARNA SAMA UNTUK MENGHANCURKANNYA",GUIDE_2_SCORE:"INI ADALAH SKORMU SEKARANG",GUIDE_3_TARGET_SCORE:"INI ADALAH SKOR TARGET UNTUK SETIAP LEVEL YANG DIPERLUKAN UNTUK MENYELESAIKAN LEVEL",LEVEL:"LEVEL",TARGET:"TARGET",REPLAY:"MAINKAN ULANG",PLAY_WITH_FRIENDS:"MAIN DENGAN TEMAN",PLAY:"MAIN",WITH_FRIENDS:"DENGAN TEMAN",HOME:"HALAMAN UTAMA",DAILY_REWARDS:"HADIAH HARIAN",DAY_X:"HARI {X}",CLAIM:"KLAIM",CLAIM_X2:"KLAIM X2",CANCELLED_AD:`MAAF, TIDAK ADA HADIAH!
KAMU MEMBATALKAN
IKLANNYA!`,LOADING:"MEMULAI ...",WATCH_A_VIDEO:`TONTON VIDEO UNTUK
MENDAPATKAN {X} BERLIAN`,GET_NOW:`DAPATKAN
SEKARANG!`,NO_THANKS:"TIDAK, TERIMA KASIH!",LOADING_ADS:"MEMULAI IKLAN ...",NO_ADS:`TIDAK ADA IKLAN
UNTUK DITAMPILKAN!`,DAILY_MISSIONS:"MISI HARIAN",PASS_10_LEVELS:"LEWATI 10 LEVEL",COLLECT_300:"KUMPULKAN 300 BERLIAN",INVITE_2:"UNDANG 2 TEMAN",REACH_TOTAL:"CAPAI SKOR TOTAL",LEADERBOARDS:"PAPAN PERINGKAT",FRIENDS:"TEMAN",WORLD:"DUNIA",HAMMER:"PALU",USE_HAMMER:"GUNAKAN PALU UNTUK MENGHANCURKAN  PERMATA APA PUN",MAGIC_BOTTLE:"BOTOL AJAIB",USE_MAGIC:`GUNAKAN BOTOL AJAIB UNTUK
MENGUBAH WARNA SATU PERMATA`,CONGRATULATIONS:"SELAMAT !",GOOD:"BAGUS !",EXCELLENT:"LUAR BIASA !",COOL:"KEREN !",GREAT:"HEBAT !",LOADING_INTER_AD:"Memulai iklan pengantara ...",LEVEL_FAILED:"LEVEL GAGAL",YOU_DID_NOT_REACH:"KAMU TIDAK MENCAPAI SKOR TARGET",YOUR_SCORE:"SKOR KAMU",BEST_SCORE:"SKOR TERBAIK",GLOBAL:"GLOBAL",JOIN:"GABUNG",CONTINUE:"Lanjut",TODAY_RECORD:"REKOR HARI INI",SHARE:"BAGIKAN",WAITING:"MENUNGGU",WAITING_OPPONENT:"MENUNGGU LAWAN",DRAW:"SERI",YOU_WIN:"KAMU MENANG",YOU_LOSE:"KAMU KALAH",RESTART:"MULAI ULANG",A_HA:"A ha, akulah yang terbaik!",PHEWW:"Fiuh, pertandingan hebat!",DIAMOND:"BERLIAN",LB_IS_EMPTY:"Papan peringkat kosong!",YOU_RECEIVED_X_DIAMONDS:`Kamu baru saja menerima
{100} berlian`,MISSION:"Misi",REQUESTING:"meminta ...",MILESTONE:"TONGGAK PENCAPAIAN"},zm={NO_THANK:"texts/no-thank-id",COOL:"texts/cool-id",GOOD:"texts/good-id",GREAT:"texts/great-id",EXCELLENT:"texts/excellent-id",CONGRATULATION:"texts/congratulation-id",LOGO:"title-logo-id"},$m={Text:jm,Texture:zm},Xm={en:Hm,ja:Km,id:$m};class qm extends Um{configure(e){super.configure({data:Xm,locale:"en",upperCaseText:!1,...e})}}const de=i=>i[Ko],Zm=i=>de(i).gameplay.mode,Jm=i=>de(i).gameplay.rescued,Qm=i=>de(i).gameplay.startAt,eg=i=>de(i).gameplay.finishAt,tg=i=>de(i).gameplay.type,vt=V([Zm],i=>i),sg=V([Jm],i=>i),ig=V([Qm],i=>i),ng=V([eg],i=>i),xc=V([tg],i=>i);class ag extends GameCore.Analytics.BaseAnalytics{isGamePlaying=!1;isGameStartLog=!1;constructor(e,t){super("GLanceAnalytics",{...t},"#E35360"),this.selfLog=!1}processEvent(e,t,s){if(e==z.LOAD_COMPLETE){window.sendCustomAnalyticsEvent(z.GLANCE_GAME_LOAD,{});return}}processGameEnd(e,t,s=-1e5){let n;const a=this.getCurrentGameType(),r={score:e,highScore:t};s!==-1e5&&a==="level"?n={...r,level:s}:n=r,Object.keys(n).forEach(c=>{n[c]==null&&delete n[c]}),e!=null&&t!=null&&a!="level"&&(window.game.audio.pauseMusic(),window.game.audio.muteAll()),window.sendCustomAnalyticsEvent(z.GLANCE_GAME_END,n)}processGameStart(e,t=-1e5){if(!this.isGameStartLog){this.isGameStartLog=!0,window.sendCustomAnalyticsEvent(z.GLANCE_GAME_START,{});return}let s;const n=this.getCurrentGameType(),a={score:0,highScore:e};t!==-1e5&&n==="level"?s={...a,level:t}:s=a,window.sendCustomAnalyticsEvent(z.GLANCE_GAME_REPLAY,s)}processGameLevel(e){window.sendCustomAnalyticsEvent(z.GLANCE_GAME_LEVEL,{level:e})}processPageView(e){}processLevelStart(e){if(!this.isGamePlaying){const t=window.game.player.getBestScore();this.processGameStart(t,e),this.isGamePlaying=!0}this.isGamePlaying&&this.getCurrentGameType()==="level"&&this.processGameLevel(e)}processLevelFail(e,t){if(this.isGamePlaying){if(t!=null){const s=t||0,n=window.game.player.getBestScore(),a=Math.max(n,s);this.processGameEnd(s,a,e)}else this.processGameEnd(void 0,void 0,e);this.isGamePlaying=!1}}processLevelComplete(e,t){if(this.getCurrentGameType()!=="level")return;const n=t||0;window.sendCustomAnalyticsEvent(z.GLANCE_GAME_LEVEL_COMPLETED,{level:e,score:n})}processGameMilestone(e,t={},s=0,n=0){const a=window.game.player.getBestScore();sendCustomAnalyticsEvent(z.GLANCE_GAME_MILESTONE,{type:e,meta:t,level:s,score:n,highScore:Math.max(a,n)})}processGameLifeEnd(e,t=0,s=0){const n=window.game.player.getBestScore();sendCustomAnalyticsEvent(z.GLANCE_GAME_LIFE_END,{remainingLife:e,level:t,score:s,highScore:Math.max(n,s)})}processIngameTransactions(e,t={},s=0,n=0){const a=window.game.player.getBestScore();sendCustomAnalyticsEvent(z.GLANCE_INGAME_TRANSACTIONS,{transactionType:e,meta:t,level:s,score:n,highScore:Math.max(a,n)})}getCurrentGameType(){const{storage:e}=window.game,t=e.getState();let s=xc(t);if(s!=="endless"&&s!=="level"){//! INVALID GAME TYPE
console.warn("Invalid game type detected. Game type must be either endless or level!"),s="level"}return s}}class rg extends Phaser.Scene{create(){this.facebook.progressLoading.loadingProgressFbBootScene(),this.startGame()}startGame=async()=>{try{await this.auth.requestToken(),this.storage.syncStore(),this.configureSentry(),this.configureRollbar(),await this.detectGameMode(),this.initAnalytics(),this.analytics.event(z.LOAD_START),this.scene.launch($.GLOBAL_SCENE),this.scene.start($.LOAD_SCENE),this.analytics.pageview($.LOAD_SCENE)}catch(e){j(e)}finally{this.facebook.progressLoading.finishLoadingProgressFbBootScene(),this.scene.sleep($.BOOT_SCENE)}};configureSentry(){const e=this.player.getPlayer();wu({id:e.playerId,username:e.name})}configureRollbar(){if(!this.rollbar)return;const e=this.player.getPlayer();this.rollbar.configure({payload:{person:{id:e.playerId,name:e.name}}})}async detectGameMode(){await this.storage.dispatch(km())}initAnalytics(){this.analytics.add(new ag(this.game,{}))}}const Y={BACKGROUND:1,FIREWORKS:5,ITEM:10,LOGO:15,BUTTON:20,TILE:25,TEXT:30,ENCOURAGING:31,EFFECT:32,MESSAGE:33,POPUP:40,PRIORITY:80,DEBUG:90,ON_TOP:1e4},U={PAUSE_SCREEN:"PAUSE_SCREEN",NOTIFY_SCREEN:"NOTIFY_SCREEN",REWARD_SCREEN:"REWARD_SCREEN",RESCUE_SCREEN:"RESCUE_SCREEN",SETTINGS_SCREEN:"SETTINGS_SCREEN",BEST_SCORE_SCREEN:"BEST_SCORE_SCREEN",DAILY_REWARD_SCREEN:"DAILY_REWARD_SCREEN",DAILY_MISSIONS_SCREEN:"DAILY_MISSIONS_SCREEN",LUCKY_REWARD_SCREEN:"LUCKY_REWARD_SCREEN"},ht={SCREEN:200,POPUP:300,PRIORITY:999},Ga=Oo,Be=eo(),D={TUTORIAL:{KEY:"tutorial-resources",TEXTURE:`./assets/textures/${Be}x/tutorial-resources.png`,JSON:`./assets/textures/${Be}x/tutorial-resources.json`,FRAME:{TIP:"tip",HAND:"hand",BLANK:"blank",AVATAR_CAT:"avatar-cat",POPUP_TALK:"talk-popup",FIRST_MOVE:"first-move",CURRENT_SCORE:"current-score",TARGET_SCORE:"target-score",HAMMER_ITEM:"hammer-item",PAINT_ITEM:"paint-item",SHUFFLE_ITEM:"shuffle-item",COLORFUL_GEM_1:"colorful-gem-1",COLORFUL_GEM_2:"colorful-gem-2"}},DEFAULT:{KEY:"default-resources",TEXTURE:`./assets/textures/${Be}x/default-resources.png`,JSON:`./assets/textures/${Be}x/default-resources.json`,FRAME:{LINE:"line",BLANK:"blank",LOGO:"title-logo",LOGO_JA:"title-logo-ja",GEMS:"title-gems",TEXT_LOADING:"loading",BOTTOM_BG:"bottom-bg",BOTTOM_LINE:"bottom-line",BOTTOM_HORIZONTAL_LINE:"bottom-horizontal-line",TOP_BG_LONG:"top-bg-long",BLOCK_LEADER_BLUE:"block-blue-bg",BLOCK_LEADER_YELLOW:"block-yellow-bg",PRELOADER:"preloader/dual-ring",LEADERBOARD_TAB_ON:"leaderboards/tab-on",LEADERBOARD_TAB_OFF:"leaderboards/tab-off",LEADERBOARD_BG_DARK:"leaderboards/bg-dark",LEADERBOARD_BG_LIGHT:"leaderboards/bg-light",MISSION_ICON_BG:"dailyMission/bg-icon",MISSION_BLOCK_BG:"dailyMission/bg-block",MISSION_CLOCK_BG:"dailyMission/bg-clock",DAILY_DAY_BG:"dailyRewards/bg",DAILY_DAY_LABEL:"dailyRewards/label",DAILY_DAY_BG_WAIT:"dailyRewards/bg-wait",DAILY_DAY_BG_OPEN:"dailyRewards/bg-open",DAILY_DAY_TITLE_GREY:"dailyRewards/title-grey",DAILY_DAY_TITLE_GREEN:"dailyRewards/title-green",DAILY_DAY_TITLE_ORANGE:"dailyRewards/title-orange",RIBBON_LONG:"ribbon/long",RIBBON_FULL:"ribbon/long-full",RIBBON_SHORT:"ribbon/short",RIBBON_SMALL:"ribbon/small",AVATAR_BG_BLUE:"avatar/blue-bg",AVATAR_FRAME_BLUE:"avatar/blue-frame",AVATAR_BG_BLUE_SMALL:"avatar/blue-bg-small",AVATAR_FRAME_BLUE_SMALL:"avatar/blue-frame-small",AVATAR_BG_BLUE_BIG:"avatar/blue-bg-big",AVATAR_FRAME_BLUE_BIG:"avatar/blue-frame-big",AVATAR_BG_YELLOW:"avatar/yellow-bg",AVATAR_FRAME_YELLOW:"avatar/yellow-frame",AVATAR_BG_YELLOW_SMALL:"avatar/yellow-bg-small",AVATAR_FRAME_YELLOW_SMALL:"avatar/yellow-frame-small",AVATAR_BG_YELLOW_BIG:"avatar/yellow-bg-big",AVATAR_FRAME_YELLOW_BIG:"avatar/yellow-frame-big",THE_CAT:"logo/cat",SAD_CAT:"logo/sad-cat",LOGO_GIFT:"logo/gift",LOGO_GIFT_ADS:"logo/gift-ad",LOGO_GIFT_WHITE:"logo/gift_white",LOGO_DIAMONDS_LIGHT_2:"logo/diamonds-light-2",LOGO_DIAMONDS_LIGHT_3:"logo/diamonds-light-3",LOGO_DIAMONDS_LIGHT_4:"logo/diamonds-light-4",LOGO_DIAMONDS_LIGHT_5:"logo/diamonds-light-5",LOGO_DIAMONDS_LIGHT_6:"logo/diamonds-light-6",LOGO_ADS_DIAMONDS:"logo/ads-diamonds",POPUP_TOP_LEFT:"popup/top-left",POPUP_TOP_MID:"popup/top-middle",POPUP_TOP_RIGHT:"popup/top-right",POPUP_MID_LEFT:"popup/middle-left",POPUP_MID_MID:"popup/middle-middle",POPUP_MID_RIGHT:"popup/middle-right",POPUP_BOTTOM_LEFT:"popup/bottom-left",POPUP_BOTTOM_MID:"popup/bottom-middle",POPUP_BOTTOM_RIGHT:"popup/bottom-right",PROGRESS_BG_LEFT:"progress/bg-left",PROGRESS_BG_MID:"progress/bg-mid",PROGRESS_BG_RIGHT:"progress/bg-right",PROGRESS_BAR_LEFT:"progress/bar-left",PROGRESS_BAR_MID:"progress/bar-mid",PROGRESS_BAR_RIGHT:"progress/bar-right",ICON_DOT:"icons/dot",ICON_CUP:"icons/cup",ICON_GIFT:"icons/gift",ICON_PLUS:"icons/plus",ICON_RANK:"icons/rank",ICON_FLAG:"icons/flag",ICON_CLOCK:"icons/clock",ICON_DAILY:"icons/daily",ICON_ADS:"icons/flat-ad",ICON_CHECK:"icons/check",ICON_CANCEL:"icons/cancel",ICON_SETTING:"icons/setting",ICON_RESUME:"icons/flat-resume",ICON_VIB_ON:"icons/flat-vib-on",ICON_VIB_OFF:"icons/flat-vib-off",ICON_MUSIC_ON:"icons/flat-music-on",ICON_MUSIC_OFF:"icons/flat-music-off",ICON_SOUND_ON:"icons/flat-sound-on",ICON_SOUND_OFF:"icons/flat-sound-off",ICON_FLAT_HOME:"icons/flat-home",ICON_FLAT_RANK:"icons/flat-rank",ICON_FLAT_SHARE:"icons/flat-share",ICON_CROWN:"icons/crown",ICON_CUP_MINI:"icons/cup-mini",ICON_CUP_GOLD:"icons/cup-gold",ICON_CUP_SILVER:"icons/cup-silver",ICON_CUP_COPPER:"icons/cup-bronze",ICON_DIAMOND:"icons/diamond",ICON_DIAMOND_SMALL:"icons/diamond-small",ICON_DIAMOND_GREY:"icons/diamond-grey",ICON_DIAMOND_LIGHT:"icons/diamond-light",BUTTON_CLOSE:"buttons/close",BUTTON_RED_LONG:"buttons/red-long",BUTTON_YELLOW_LONG:"buttons/yellow-long",BUTTON_YELLOW_CIRCLE:"buttons/yellow-circle",BUTTON_BLUE:"buttons/blue",BUTTON_BLUE_SHORT:"buttons/blue-short",BUTTON_BLUE_LONG:"buttons/blue-long",BUTTON_BLUE_CIRCLE:"buttons/blue-circle",BUTTON_GREEN:"buttons/green",BUTTON_GREEN_SHORT:"buttons/green-short",BUTTON_GREEN_LONG:"buttons/green-long",BUTTON_GREEN_MINOR:"buttons/green-minor",BUTTON_GREEN_CIRCLE:"buttons/green-circle",BUTTON_GREEN_MINOR_MINI:"buttons/green-minor-mini",NO_THANK_TEXT:"texts/no-thank",NO_THANK_TEXT_JA:"texts/no-thank-ja",HORIZONTAL_LUCKY_BAR:"lucky-bar/horizontal-lucky-bar",HORIZONTAL_ARROW:"lucky-bar/horizontal-arrow",ARC_LUCKY_BAR:"lucky-bar/arc-lucky-bar",ARC_ARROW:"lucky-bar/arc-arrow"}},EFFECTS:{KEY:"effects-resources",PATH:`./assets/textures/${Be}x/`,JSON:`./assets/textures/${Be}x/effects-resources.json`,FRAME:{BLANK:"blank",FX_COMET:"comet",FX_SPARK:"spark",FX_CIRCLE:"circle",FX_CIRCLE_LIGHT:"circle-light",FX_GLOW_LIGHT:"glow-light",FX_GLOW_SMALL:"glow-small",FX_STAR_WHITE:"star-white",FX_STAR_YELLOW:"star-yellow",TEXT_COOL:"texts/cool",TEXT_GOOD:"texts/good",TEXT_GREAT:"texts/great",TEXT_EXCELLENT:"texts/excellent",TEXT_CONGRATULATION:"texts/congratulation",TEXT_COOL_JA:"texts/cool-ja",TEXT_GOOD_JA:"texts/good-ja",TEXT_GREAT_JA:"texts/great-ja",TEXT_EXCELLENT_JA:"texts/excellent-ja",TEXT_CONGRATULATION_JA:"texts/congratulation-ja",FX_CONFETTI_SMALL_1:"confetti/small-1",FX_CONFETTI_SMALL_2:"confetti/small-2",FX_CONFETTI_SMALL_3:"confetti/small-3",FX_CONFETTI_SMALL_4:"confetti/small-4",FX_CONFETTI_HEXAGON:"confetti/hexagon-",FX_FIREWORKS_SMALL:"fireworks/small",FX_FIREWORKS_BIG_0:"fireworks/big-explosive-0",FX_FIREWORKS_BIG_1:"fireworks/big-explosive-1",FX_FIREWORKS_SOAR_LINE:"fireworks/soar-line",FX_FIREWORKS_SOAR_CIRCLE:"fireworks/soar-circle",FX_HIGHLIGHT:"fx-items/highlight",FX_PAINT_EXPLOSIVE:"fx-items/paint-explosive-",FX_RED_EXPLOSIVE:"fx-gems/red-explosive-",FX_BLUE_EXPLOSIVE:"fx-gems/blue-explosive-",FX_PINK_EXPLOSIVE:"fx-gems/pink-explosive-",FX_GREEN_EXPLOSIVE:"fx-gems/green-explosive-",FX_YELLOW_EXPLOSIVE:"fx-gems/yellow-explosive-",FX_COLORFUL:"fx-gems/colorful-",FX_COLOR_CHANGE:"fx-gems/color-change-",FX_FREEZE_EXPLOSIVE:"fx-gems/freeze-explosive-",FX_COLORFUL_EXPLOSIVE:"fx-gems/colorful-explosive-"}},ANIMATION_SCENE:{KEY:"effects-resources",PATH:`./assets/textures/${Be}x/`,JSON:`./assets/textures/${Be}x/animation-scene-resources.json`,FRAME:{BLANK:"blank",COIN:"coins/coin",COIN_SMALL:"coins/coin-small",COIN_SMALL_GREY:"coins/coin-small-grey",ANIMATION_STAR_X:"star-x/star-",ANIMATION_STAR_Y:"star-y/star-",FX_SPARK_YELLOW:"yellow-spark",FX_CONFETTI_RIBBON:"ribbon/ribbon",PREFIX_ANIMATION_RIBBON_CONFETTI_A:"ribbon/falling-confetti/confetti-a/confetti-a-",PREFIX_ANIMATION_RIBBON_CONFETTI_B:"ribbon/falling-confetti/confetti-b/confetti-b-",PREFIX_ANIMATION_RIBBON_CONFETTI_C:"ribbon/falling-confetti/confetti-c/confetti-c-",PREFIX_ANIMATION_RIBBON_CONFETTI_D:"ribbon/falling-confetti/confetti-d/confetti-d-"}},GAMEPLAY:{KEY:"gameplay-resources",TEXTURE:`./assets/textures/${Be}x/gameplay-resources.png`,JSON:`./assets/textures/${Be}x/gameplay-resources.json`,FRAME:{BLANK:"blank",BIG_TOP:"bg-top",BIG_PLAYER:"bg-player",BIG_CIRCLE:"big-circle",BUTTON_PLUS:"buttons/plus",BUTTON_SETTING:"buttons/setting",AVATAR_BLUE_BG:"avatars/bg-blue-mini",AVATAR_BLUE_FRAME:"avatars/frame-blue-mini",PROGRESS_BG_LEFT:"progress/bg-left",PROGRESS_BG_MID:"progress/bg-mid",PROGRESS_BG_RIGHT:"progress/bg-right",PROGRESS_BAR_LEFT:"progress/bar-left",PROGRESS_BAR_MID:"progress/bar-mid",PROGRESS_BAR_RIGHT:"progress/bar-right",ITEM_GIFT:"items/gift",ITEM_PAINT:"items/paint",ITEM_HAMMER:"items/hammer",ITEM_SHUFFLE:"items/shuffle",ITEM_BG_COIN:"items/bg-coin",ITEM_BG_ITEM:"items/bg-item",ICON_PLUS:"icons/plus",ICON_CHECK:"icons/check",ICON_CLOCK:"icons/clock",ICON_DIAMOND:"icons/diamond",ICON_DIAMOND_SMALL:"icons/diamond-small",ICON_CUP_SUPERMINI:"icons/cup-supermini",TILE_RED:"gems/red",TILE_BLUE:"gems/blue",TILE_PINK:"gems/pink",TILE_GREEN:"gems/green",TILE_YELLOW:"gems/yellow",TILE_FREEZE:"gems/freeze",TILE_COLORFUL:"gems/colorful",TILE_COLOR_CHANGE:"gems/change"}},DEMO_SPINE:{KEY:"demo-spine",jsonPATH:"./assets/spines/demo/demo.json",atlasPATH:"./assets/spines/demo/demo.atlas"}};GameCore.Utils.Valid.isDebugger()&&(D.EFFECTS.FRAME={...D.ANIMATION_SCENE.FRAME,...D.EFFECTS.FRAME});const K={BUTTON_CLICK:"button_click",CONGRATULATION:"congratulation",DAILY_REWARD:"daily_reward",DIAMONDS_DROP:"diamonds_drop",DIAMONDS_EAT:"diamonds_eat",FIREWORKS_BIG:"fireworks_big",FIREWORKS_SOAR:"fireworks_soar",FIREWORKS_SMALL:"fireworks_small",GEM_DROP:"gem_drop",GAME_OVER_SCENE:"game_over_scene",GEM_EXPLOSIVE_1:"gem_explosive_1",GEM_EXPLOSIVE_2:"gem_explosive_2",GEM_EXPLOSIVE_3:"gem_explosive_3",GEM_EXPLOSIVE_4:"gem_explosive_4",GEM_EXPLOSIVE_5:"gem_explosive_5",GEM_EXPLOSIVE_6:"gem_explosive_6",GEM_EXPLOSIVE_FREEZE:"gem_explosive_freeze",GEM_FALLING:"gem_falling",GIFT_CHARGE:"gift_charge",GIFT_EXPLODE:"gift_explode",GIFT_REVEAL:"gift_reveal",ITEM_ACTIVE_AMBIENCE:"item_active_ambience",MISSION_COMPLETED:"mission_completed",MISSION_REWARD:"mission_reward",MOVE_WRONG:"move_wrong",START_LEVEL:"start_level",POPUP_OFF:"popup_off",POPUP_SHOW:"popup_show",SCORE_COUNTER:"score_counter",START_GAME:"start_game",USE_HAMMER:"use_hammer",USE_PAINT:"use_paint",USE_SHUFFLE:"use_shuffle",YOU_LOSE:"you_lose",YOU_WIN:"you_win"},{KEY:Ui,FRAME:us}=D.EFFECTS,{FIREWORKS_SMALL:og,FIREWORKS_BIG:cg,FIREWORKS_SOAR:lg}=K;class Nc extends Phaser.GameObjects.Container{soar;fireworks1;fireworks2;colors={red:16462401,blue:1863148,pink:15271420,green:183084,yellow:16631323};constructor(e){super(e,0,0),this.kill(),this.createObjects(),this.setDepth(Y.FIREWORKS),this.scene.add.existing(this)}createObjects(){this.soar=this.scene.make.image({key:Ui,frame:us.FX_FIREWORKS_SOAR_LINE,visible:!1}),this.fireworks1=this.scene.make.image({key:Ui,frame:us.FX_FIREWORKS_BIG_0,visible:!1}),this.fireworks2=this.scene.make.image({key:Ui,frame:us.FX_FIREWORKS_BIG_1,visible:!1}),this.add([this.soar,this.fireworks2,this.fireworks1])}playExplosiveSound(){const e=Phaser.Math.RND.between(0,100);let t;e<30?t=lg:e<70?t=cg:t=og,this.scene.audio.playSound(t)}randomColor(){const e=Object.values(this.colors);let t=Phaser.Math.RND.between(0,e.length-1),s=e[t];this.fireworks1.setTint(s),t=Phaser.Math.RND.between(0,e.length-1),s=e[t],this.fireworks2.setAlpha(.5),this.fireworks2.setTint(s)}fire(e,t,s){this.setVisible(!0),this.setPosition(e,t),this.runFireworkAnimation(s),this.playExplosiveSound()}runFireworkAnimation(e){if(!this.scene)return;const t=Phaser.Math.RND.between(-120,120);this.setAlpha(.6),this.soar.setVisible(!0),this.soar.setOrigin(.5,.1),this.soar.setFrame(us.FX_FIREWORKS_SOAR_LINE),this.scene.tweens.add({targets:[this],duration:600,ease:Phaser.Math.Easing.Sine.Out,props:{y:e+t,alpha:{from:.6,to:.2},scale:{from:.1,to:1/this.scene.world.getZoomRatio()}},onComplete:this.runSoarExplosiveAnimation})}runSoarExplosiveAnimation=()=>{this.setAlpha(0),this.setScale(0),this.soar.setOrigin(.5,.5),this.soar.setFrame(us.FX_FIREWORKS_SOAR_CIRCLE),this.scene.tweens.add({targets:[this],duration:200,ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:{from:0,to:1},scale:{from:0,to:Phaser.Math.RND.between(.8,1)/this.scene.world.getZoomRatio()}},onComplete:this.runFireworkExplosiveAnimation})};runFireworkExplosiveAnimation=()=>{this.fireworks1.setAlpha(0),this.fireworks1.setScale(.1),this.fireworks1.setVisible(!0),this.scene.tweens.add({targets:[this.fireworks1],duration:600,ease:Phaser.Math.Easing.Sine.Out,props:{alpha:{from:0,to:1,duration:300},scale:{from:.1,to:Phaser.Math.RND.between(.6,.8)}}}),this.fireworks2.setVisible(!0),this.fireworks2.setScale(.1),this.scene.tweens.add({targets:[this.fireworks2],duration:800,ease:Phaser.Math.Easing.Cubic.Out,props:{scale:{from:.1,to:Phaser.Math.RND.between(.5,.6)}}}),this.runExistAnimation()};runExistAnimation=()=>{this.scene.tweens.add({targets:[this],duration:600,delay:400,ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:0},onComplete:()=>{this.setVisible(!1),this.setAlpha(1),this.soar.setVisible(!1),this.fireworks1.setVisible(!1),this.fireworks2.setVisible(!1)}})}}const{KEY:hg,FRAME:ug}=D.DEFAULT;class dg extends Phaser.GameObjects.Image{onUpdate;onComplete;positions;visibleAnimation;eatAnimation;constructor(e,t){super(e,0,0,hg,ug.ICON_DIAMOND),this.setWorldSize(25,24),this.positions=t,this.setVisible(!1),this.setDepth(Y.PRIORITY),this.createAnimation(),this.scene.add.existing(this)}createAnimation(){const{from:e,to:t}=this.positions,s=1/this.scene.world.getPixelRatio();this.visibleAnimation=this.scene.add.tween({targets:this,duration:1e3,paused:!0,props:{alpha:{duration:500,ease:Phaser.Math.Easing.Cubic.Out,value:{from:0,to:1}},x:{getStart:()=>e.x},y:{ease:Phaser.Math.Easing.Bounce.Out,value:{getStart:()=>e.y,getEnd:()=>e.y+100}},scale:{duration:400,ease:Phaser.Math.Easing.Cubic.Out,value:{from:s*2,to:s}}},onStart:()=>{this.setVisible(!0),this.scene.audio.playSound(K.DIAMONDS_EAT)},onComplete:()=>{this.eatAnimation.play()}}),this.eatAnimation=this.scene.add.tween({targets:this,duration:500,delay:50,ease:"Circ.easeOut",paused:!0,props:{x:{getEnd:()=>t.x},y:{getEnd:()=>t.y}},onUpdate:()=>{typeof this.onUpdate=="function"&&this.onUpdate()},onComplete:()=>{this.destroy(),typeof this.onComplete=="function"&&this.onComplete()}})}run(){this.visibleAnimation.play()}}class Ee{scene;config;isStarted;tween;constructor(e,t){if(t.targets.length<1)return;this.buildConfig(e,t);const{scene:s}=this.config.targets[0];s&&(this.scene=s,this.isStarted=!1,this.tween=s.tweens.create(this.config))}buildConfig(e,t){this.config=Ce(e,t)}play(){if(this.tween){if(this.isStarted&&this.tween.hasStarted){this.restart();return}this.tween.play(),this.isStarted=!0}}restart(){this.tween?.restart()}stop(){this.tween?.stop()}remove(){this.tween?.remove()}next(e){return this.tween?(this.tween.off(Phaser.Tweens.Events.TWEEN_COMPLETE,e),this.tween.once(Phaser.Tweens.Events.TWEEN_COMPLETE,e),this.tween):null}}var pg=4,mg=.001,gg=1e-7,fg=10,ws=11,Vs=1/(ws-1),Eg=typeof Float32Array=="function";function kc(i,e){return 1-3*e+3*i}function Gc(i,e){return 3*e-6*i}function Bc(i){return 3*i}function ri(i,e,t){return((kc(e,t)*i+Gc(e,t))*i+Bc(e))*i}function Uc(i,e,t){return 3*kc(e,t)*i*i+2*Gc(e,t)*i+Bc(e)}function yg(i,e,t,s,n){var a,r,c=0;do r=e+(t-e)/2,a=ri(r,s,n)-i,a>0?t=r:e=r;while(Math.abs(a)>gg&&++c<fg);return r}function Sg(i,e,t,s){for(var n=0;n<pg;++n){var a=Uc(e,t,s);if(a===0)return e;var r=ri(e,t,s)-i;e-=r/a}return e}function Ag(i){return i}var Tg=function(e,t,s,n){if(!(0<=e&&e<=1&&0<=s&&s<=1))throw new Error("bezier x values must be in [0, 1] range");if(e===t&&s===n)return Ag;for(var a=Eg?new Float32Array(ws):new Array(ws),r=0;r<ws;++r)a[r]=ri(r*Vs,e,s);function c(o){for(var l=0,h=1,d=ws-1;h!==d&&a[h]<=o;++h)l+=Vs;--h;var u=(o-a[h])/(a[h+1]-a[h]),p=l+u*Vs,m=Uc(p,e,s);return m>=mg?Sg(o,p,e,s):m===0?p:yg(o,l,l+Vs,e,s)}return function(l){return l===0?0:l===1?1:ri(c(l),t,n)}};const Fc=Tg,Ig=Fc(.55,.47,.43,.91),bg={targets:[],yoyo:!0,repeat:-1,duration:600,repeatDelay:50,ease:Ig,easeParams:[0,.9],props:{scale:{from:1,to:1.2}}};class qe extends Ee{constructor(e){super(bg,e)}}const wg={targets:[],repeat:-1,yoyo:!0,duration:33,ease:Phaser.Math.Easing.Sine.InOut,props:{x:5}};class Wn extends Ee{posX;constructor(e){super(wg,e),this.config?.props&&(this.posX=this.config.props.x,this.tween?.on(Phaser.Tweens.Events.TWEEN_REPEAT,this.handleSwitchPosition))}handleSwitchPosition=()=>{this.posX=-this.posX,this.tween?.updateTo("x",-this.posX)}}const Kn=Fc(.48,1.57,.6,.83),Cg={targets:[],duration:400,ease:Kn,props:{scale:"-=0.1"}};class oi extends Ee{constructor(e){super(Cg,e)}}const vg={targets:[],duration:600,ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:{start:0,from:0,to:1}}};class es extends Ee{constructor(e){super(vg,e)}}const _g={targets:[],duration:600,ease:Phaser.Math.Easing.Quadratic.Out,props:{alpha:{start:1,from:1,to:0}}};class ut extends Ee{constructor(e){super(_g,e)}}const Og={targets:[],duration:300,ease:Kn,props:{scale:{from:1.2,to:1}}};class ts extends Ee{constructor(e){super(Og,e)}}const Rg={targets:[],duration:1e3,ease:Phaser.Math.Easing.Quadratic.InOut,props:{scale:.2}};class Yc extends Ee{spline;constructor(e){super(Rg,e);const{curve:t}=this.config;t&&(this.spline=new Phaser.Curves.Spline(t),this.tween?.on(Phaser.Tweens.Events.TWEEN_START,this.createCounter))}createCounter=(e,t)=>{const{onCurveUpdate:s}=this.config,n=typeof s=="function"?s:null;t.forEach((a,r)=>{if(!this.scene)return;const{duration:c,delay:o}=e.data[r],l=new Phaser.Math.Vector2;this.scene.tweens.addCounter({delay:o,duration:c,ease:Phaser.Math.Easing.Quadratic.InOut,onUpdate:h=>{this.spline.getPoint(h.getValue(),l),a.x=l.x,a.y=l.y,n&&n(a)}})})}}class ee extends Phaser.GameObjects.Container{useSound=!0;isClicked=!1;scaleUp=-1;scaleDown=-1;button;upAnimation;downAnimation;isUsePixelPerfect=!1;hitArea;hitZone;scaleDownPress;parentName;constructor(e,t,s,n,a,r=!1){super(e),this.isUsePixelPerfect=r,this.setDepth(Y.BUTTON),this.createButton(t,s,n,a),this.updateSize(),this.listenEvents(),this.scene.add.existing(this)}listenEvents(){this.scene.events.on(Phaser.Scenes.Events.SLEEP,this.handleSceneSleep),this.once(Phaser.GameObjects.Events.DESTROY,this.handelObjectDestroy)}handelObjectDestroy=()=>{this.scene&&this.scene.events.off(Phaser.Scenes.Events.SLEEP,this.handleSceneSleep)};handleSceneSleep=()=>{this.scene&&this.scene.tweens.killTweensOf(this)};set onClick(e){this.isUsePixelPerfect?(this.hitArea=this.button,this.hitArea.setInteractive({useHandCursor:!0,pixelPerfect:!0})):(this.hitArea=this.hitZone,this.updateSize(),this.hitArea.setInteractive({useHandCursor:!0})),this.hitArea.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.handlePointerDown),this.hitArea.on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,this.handleOnClick(e)),this.hitArea.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,this.handlePointerOut)}get isUsePixelPerFect(){return this.isUsePixelPerfect}handlePointerDown=()=>{this.isClicked||this.upAnimation?.tween?.isPlaying()||(this.isClicked=!0,this.runDownAnimation())};handleOnClick=e=>()=>{this.isClicked&&(this.upAnimation?.tween?.isPlaying()||(this.isClicked=!1,this.runUpAnimation(),this.upAnimation?.tween?.once(Phaser.Tweens.Events.TWEEN_COMPLETE,()=>{this.logButtonEvent(),this.addDebugData(),this.processCallback(e)})))};handlePointerOut=()=>{this.isClicked&&(this.upAnimation?.tween?.isPlaying()||(this.isClicked=!1,this.runUpAnimation()))};processCallback(e){this.upAnimation?.stop(),this.downAnimation?.stop(),this.scene?.tweens.killTweensOf(this),this.scaleUp!==-1&&this.setScale(this.scaleUp),e()}setDisabled(e){e?(this.setAlpha(.5),this.hitArea?.disableInteractive()):(this.setAlpha(1),this.hitArea?.setInteractive())}createButton(e,t,s,n){this.button=this.scene.add.image(0,0,e,t),s&&n&&this.button.setWorldSize(s,n),this.scaleDownPress=this.scale-.1;const{displayWidth:a,displayHeight:r}=this.button;this.hitZone=this.scene.make.zone({displayWidth:a,displayHeight:r}),this.add([this.button,this.hitZone])}updateSize(){const{width:e,height:t}=this.button,s=10,n=e/100*10,a=t/100*10,r=n<s?n:s,c=a<s?a:s;this.setSize(e+r,t+c),this.hitZone.setSize(e+r,t+c)}runDownAnimation=()=>{this.scaleDown===-1&&(this.scaleUp=this.scale,this.scaleDown=this.scaleDownPress),this.useSound&&this.scene.audio.playSound(K.BUTTON_CLICK),this.downAnimation?.remove(),this.downAnimation=new oi({targets:[this],duration:150,props:{scale:this.scaleDown},onUpdate:()=>{this.hitZone.scale=1/this.scale}}),this.downAnimation.play()};runUpAnimation=()=>{this.scaleUp!==-1&&(this.upAnimation?.remove(),this.upAnimation=new oi({targets:[this],duration:150,props:{scale:this.scaleUp},onUpdate:()=>{this.hitZone.scale=1/this.scale}}),this.upAnimation.play())};addDebugData(){const e=this.getParentName(),t=this.name;ui("ui-click",`${e}:${t}`)}logButtonEvent(){const e=this.getParentName(),t=this.name;this.scene.analytics.event(z.BUTTON_CLICK,{button_name:t,screen_name:e})}getParentName(){if(this.parentName)return this.parentName;let e=this.parentContainer;for(;e;){if(e instanceof GameCore.Screen){const t=e;return this.parentName=t.getScreenName(),this.parentName}e=e.parentContainer}return this.parentName=this.scene.getSceneName(),this.parentName}}const{KEY:Pg,FRAME:Dg}=D.TUTORIAL;class Hc extends Phaser.GameObjects.Container{hand;constructor(e){super(e),this.name="TapTutorialHand",this.addHand(),this.scene.add.existing(this)}addHand(){this.hand=this.scene.make.image({key:Pg,frame:Dg.HAND,origin:{x:.5,y:.5}}),this.hand.setWorldSize(65.5,55.5),this.add(this.hand)}playAnimation(e=0,t=800){const s=1/this.scene.world.getPixelRatio();this.hand.angle=30,this.scene?.tweens.add({delay:e,targets:[this.hand],ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:{start:0,value:1,duration:200},scale:{duration:400,start:s*1.6,to:s*1.2},angle:{from:30,value:0,duration:400}},onComplete:()=>{this.scene?.tweens.add({targets:[this.hand],delay:200,duration:200,ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:0},onComplete:()=>{this.hand.x=0,this.hand.y=0,this.hand.scale=s,this.playAnimation(t)}})}})}stopAnimation(){this.scene.tweens.killTweensOf(this.hand)}preDestroy(){this.scene.tweens.killTweensOf(this.hand)}}const k={PRIMARY:{KEY:"notoSans",TEXTURE:{en:"./assets/fonts/bebas.png",ja:"./assets/fonts/MochiyPopOne-Regular-JA.png",id:"./assets/fonts/bebas.png"},DATA:{en:"./assets/fonts/bebas.xml",ja:"./assets/fonts/MochiyPopOne-Regular-JA.xml",id:"./assets/fonts/bebas.xml"}},FONT_FAMILY:'-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif'},{KEY:Mg,FRAME:Ba}=D.EFFECTS;class Vc extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitZone;emitter;constructor(e){super(e,Mg,Ba.FX_COMET),this.createEmitZone(),this.scene.add.existing(this)}createEmitZone(){this.emitZone=new Phaser.Geom.Rectangle}createEmitters(){const e=1/this.scene.world.getPixelRatio();this.emitter=this.createEmitter({on:!1,frame:Ba.FX_COMET,emitZone:{source:this.emitZone,type:"random"},speed:20,timeScale:1,frequency:100,alpha:{start:1,end:0,ease:Phaser.Math.Easing.Expo.Out},scale:{start:e*2,end:e*.1,ease:Phaser.Math.Easing.Expo.Out},lifespan:2666})}run(e,t,s,n,a){this.stop(),this.reset(),this.emitZone.setSize(n,a),this.emitZone.setPosition(t-n/2,s-a/2),this.emitter.setQuantity(e),this.emitter.start()}explode(e,t,s){this.emitter||this.reset(),this.emitter.explode(e,t,s)}stop(){this.emitter?.killAll(),this.emitter?.stop()}reset(){this.createEmitters()}}const{KEY:Lg,FRAME:Ua}=D.EFFECTS;class xg extends Phaser.GameObjects.Particles.ParticleEmitterManager{deathZone;emitter;constructor(e){super(e,Lg,Ua.FX_SPARK),this.createDeathZone(),this.createEmitters(),this.setActive(!1),this.setVisible(!1),this.scene.add.existing(this)}createDeathZone(){this.deathZone=new Phaser.Geom.Circle}createEmitters(){const e=1/this.scene.world.getPixelRatio();this.emitter=this.createEmitter({on:!1,frame:Ua.FX_SPARK,speed:{min:10,max:1200},scale:{start:e*1.33,end:0},alpha:{start:1,end:0,ease:Phaser.Math.Easing.Expo.Out},deathZone:{source:this.deathZone,type:"onLeave"},lifespan:3e3})}explode(e,t,s,n){this.setActive(!0),this.setVisible(!0),this.deathZone.radius=n,this.deathZone.setPosition(t,s),this.emitter.explode(e,t,s)}}const{KEY:Ng,FRAME:Fa}=D.EFFECTS;class Wc extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitZone;emitter;constructor(e){super(e,Ng,Fa.FX_COMET),this.createEmitZone(),this.createEmitters(),this.scene.add.existing(this)}createEmitZone(){this.emitZone=new Phaser.Geom.Rectangle}createEmitters(){const e=1/this.scene.world.getPixelRatio();this.emitter=this.createEmitter({on:!1,frame:Fa.FX_COMET,emitZone:{source:this.emitZone,type:"random"},deathZone:{source:this.emitZone,type:"onLeave"},timeScale:1,frequency:150,speedY:{min:-20,max:-60},alpha:{start:1,end:0,ease:Phaser.Math.Easing.Cubic.Out},scale:{start:e*1,end:0,ease:Phaser.Math.Easing.Cubic.Out},lifespan:{min:1500,max:2500}})}run(e,t,s,n,a){this.stop(),this.emitZone.setSize(n,a),this.emitZone.setPosition(t-n/2,s-a/2),this.emitter.setQuantity(e),this.emitter.start()}stop(){this.emitter?.killAll(),this.emitter?.stop()}}const{KEY:Mt,FRAME:ds}=D.DEFAULT;class Kc extends GameCore.Screen{rewardValue;onReward;hand;viewAdButton;skipButton;giftIcon;giftIconWhite;currencyIcon;currencyText;popupContents;cometTwinkle;starTwinkleUp;sparksExplosive;popupFadeOutAnimation;backgroundFadeInAnimation;contentShowUpAnimation;giftEntrancesAnimation;giftAttentionAnimation;iconAttentionAnimation;giftShakeAnimation;giftOpenAnimation;adsTimer;constructor(e,t,s,n){super(e,t,s,n),this.setDepth(ht.POPUP),this.background.setAlpha(.8),this.createViewAdsButton(),this.createSkipButton(),this.createCurrencyIcon(),this.createCurrencyText(),this.createEffects(),this.createGiftIcon(),this.createHand(),this.createContentsGroup()}open=e=>{super.open(e);const t=this.getData("awardDiamonds");this.setRewardValue(t),this.runOpenAnimation()};handleClosePopup=()=>{this.runCloseAnimation()};handleShowRewardedVideoAd=async()=>{try{const{audio:e,game:t}=this.scene;this.viewAdButton.setDisabled(!0),t.globalScene.screen.open(U.NOTIFY_SCREEN,{message:this.scene.lang.Text.LOADING_ADS,duration:0,loading:!0}),e.pauseMusic(),e.muteAll(),await this.scene.ads.showRewardedVideoAsync(),t.globalScene.screen.close(U.NOTIFY_SCREEN),this.starTwinkleUp.stop(),this.scene.audio.playSound(K.DAILY_REWARD),this.popupContents.killGroup(),this.runTheGiftEntrancesAnimation(0,1500)}catch(e){if(e instanceof Object&&GameCore.Utils.Object.hasOwn(e,"code")&&e.code==="USER_INPUT"){this.showNotifySkipAds();return}this.showNotifyNoAds()}finally{this.scene.ads.preloadRewardedVideoAsync().catch(e=>{}),this.adsTimer?.destroy(),this.scene.audio.unmuteAll(),this.scene.audio.playMusic(),this.viewAdButton.setDisabled(!1)}};setTheGiftClickable(e){e?this.giftIcon.setInteractive():this.giftIcon.disableInteractive()}handleTheGiftClick=()=>{this.setTheGiftClickable(!1),this.logButtonEvent("OpenGift"),this.hand.kill(),this.giftIconWhite.revive(),this.scene.tweens.killTweensOf(this.giftIcon),Phaser.Display.Align.In.Center(this.giftIconWhite,this.giftIcon),this.scene.audio.playSound(K.GIFT_CHARGE),this.runShakeTheGift(),this.runOpenTheGift()};logButtonEvent(e){const t=this.getScreenName();this.scene.analytics.event(z.BUTTON_CLICK,{button_name:e,screen_name:t})}showNotifyNoAds=e=>{if(e&&e.name!==U.NOTIFY_SCREEN)return;const{globalScene:t}=this.scene.game;t.screen.open(U.NOTIFY_SCREEN,{message:this.scene.lang.Text.NO_ADS,duration:1200,loading:!1})};showNotifySkipAds=()=>{const{globalScene:e}=this.scene.game;e.screen.open(U.NOTIFY_SCREEN,{message:this.scene.lang.Text.CANCELLED_AD,duration:1500,loading:!1})};runOpenAnimation(){this.revive(),this.hand.kill(),this.popupContents.reviveGroup(),this.starTwinkleUp.stop(),this.runBackgroundEntrancesAnimation(0,200),this.runPopupContentEntrancesAnimation(100,400),this.runLogoAttentionAnimation(500)}runCloseAnimation=()=>{this.runExitsAnimation(0,200)};runBackgroundEntrancesAnimation(e,t){this.backgroundFadeInAnimation||(this.backgroundFadeInAnimation=new es({targets:[this.background],delay:e,duration:t,props:{alpha:{start:0,to:.8}}})),this.backgroundFadeInAnimation.play()}runPopupContentEntrancesAnimation(e,t){this.contentShowUpAnimation?.remove(),this.contentShowUpAnimation=new ts({targets:this.popupContents.getChildren(),duration:t,delay:this.scene.tweens.stagger(100,{start:e}),props:{scale:{getStart:s=>s.scale-.3,getEnd:s=>s.scale},alpha:{start:0,from:0,to:1}}}),this.contentShowUpAnimation.play()}runLogoAttentionAnimation(e){const{x:t,y:s,width:n,height:a}=this.currencyIcon;this.starTwinkleUp.run(1,t,s,n,a),this.iconAttentionAnimation||(this.iconAttentionAnimation=new qe({targets:[this.currencyIcon],delay:e,props:{scale:"+=0.05"}})),this.iconAttentionAnimation.play()}runTheGiftEntrancesAnimation(e,t){this.giftIcon.revive(),this.giftIcon.setAlpha(1),Phaser.Display.Align.In.TopRight(this.giftIcon,this.zone),this.giftEntrancesAnimation?.remove();const{x:s,y:n}=this.giftIcon,{x:a,y:r}=this.currencyText,c={x:s,y:n},o={x:a,y:r},l=1/this.scene.world.getPixelRatio();this.giftEntrancesAnimation=new Yc({targets:[this.giftIcon],delay:e,duration:t,curve:[[c.x,c.y],[c.x-80,c.y+80],[o.x,o.y]],props:{scale:{start:l*.5,to:l},angle:{start:20,to:0}},onCurveUpdate:h=>{const u=h.x+Phaser.Math.RND.between(-40,40),p=h.y+Phaser.Math.RND.between(-40,40);this.cometTwinkle.explode(1,u,p)},onComplete:()=>{this.scene.audio.playSound(K.GIFT_REVEAL);const h=1.5;this.starTwinkleUp.setScale(h);const{x:d,y:u,width:p,height:m}=this.giftIcon;this.starTwinkleUp.run(1,d,u,p/h,m/h),this.moveTo(this.starTwinkleUp,this.length-1),this.runTheGiftAttentionAnimation()}}),this.giftEntrancesAnimation.play()}runTheGiftAttentionAnimation(){this.giftAttentionAnimation||(this.giftAttentionAnimation=new qe({targets:[this.giftIcon],props:{scale:"+=0.05"}})),this.hand.revive(),this.hand.playAnimation(),Phaser.Display.Align.In.Center(this.hand,this.giftIcon,20,20),this.setTheGiftClickable(!0),this.giftAttentionAnimation.play()}runShakeTheGift(){this.giftShakeAnimation||(this.giftShakeAnimation=new Wn({targets:[this.giftIcon,this.giftIconWhite],duration:22})),this.giftShakeAnimation.play()}runOpenTheGift(){if(!this.giftOpenAnimation){const e=1/this.scene.world.getPixelRatio();this.giftOpenAnimation=new oi({targets:[this.giftIcon,this.giftIconWhite],duration:1500,props:{alpha:0,scale:e},onUpdate:()=>{this.giftIconWhite.setAlpha(1)},onComplete:()=>{this.giftShakeAnimation.stop(),this.giftIcon.kill(),this.giftIconWhite.kill(),this.sparksExplosive.explode(100,this.giftIcon.x,this.giftIcon.y,230),this.scene.audio.playSound(K.GIFT_EXPLODE),this.onReward(this.rewardValue),this.scene.time.delayedCall(500,this.runCloseAnimation)}})}this.giftOpenAnimation.play()}runExitsAnimation(e,t){this.popupFadeOutAnimation||(this.popupFadeOutAnimation=new ut({targets:this.getAll(),delay:e,duration:t,props:{alpha:{start:.8,to:0}},onComplete:()=>{this.scene.screen.close(this.name)}})),this.popupFadeOutAnimation.play()}createHand(){this.hand=new Hc(this.scene),this.add(this.hand)}createContentsGroup(){this.popupContents=this.scene.make.group({}),this.popupContents.addMultiple([this.currencyIcon,this.currencyText,this.viewAdButton,this.skipButton])}createCurrencyIcon(){this.currencyIcon=this.scene.add.image(0,0,Mt,ds.LOGO_GIFT_ADS),this.currencyIcon.setWorldSize(150,150),Phaser.Display.Align.In.Center(this.currencyIcon,this.zone,0,-80),this.add(this.currencyIcon)}createCurrencyText(){this.currencyText=this.scene.make.bitmapText({size:this.scene.fontSize(22),font:k.PRIMARY.KEY,origin:{x:.5,y:.5}}),this.currencyText.setCenterAlign(),this.setRewardValue(0),this.add(this.currencyText)}setRewardValue(e){this.rewardValue=e,this.currencyText.setText(this.scene.lang.getText({key:"WATCH_A_VIDEO",variables:[e]})),Phaser.Display.Align.In.BottomCenter(this.currencyText,this.currencyIcon,0,60)}createViewAdsButton(){this.viewAdButton=new ee(this.scene,Mt,ds.BUTTON_BLUE_LONG,232,69),this.viewAdButton.setName("ViewAd"),this.viewAdButton.onClick=this.handleShowRewardedVideoAd;const e=this.scene.add.image(0,0,Mt,ds.ICON_ADS);e.setWorldSize(37,34),Phaser.Display.Align.In.Center(e,this.viewAdButton);let t=70;this.scene.lang.getCurrentLanguage()==="id"&&(t=50),e.setX(this.viewAdButton.x-t),this.viewAdButton.add(e);const s=this.scene.lang.getCurrentLanguage(),n=this.scene.make.bitmapText({size:this.scene.fontSize(s==="id"?18:30),text:this.scene.lang.Text.GET_NOW,font:k.PRIMARY.KEY}),a=s==="id"?30:15;Phaser.Display.Align.In.Center(n,this.viewAdButton,a,0),this.viewAdButton.add(n),Phaser.Display.Align.In.Center(this.viewAdButton,this.zone,0,100),this.add(this.viewAdButton)}createSkipButton(){const e=this.scene.lang.getCurrentLanguage(),t=e==="ja"?147.5:e==="id"?161.5:129,s=e==="ja"?21:e==="id"?16.5:25;this.skipButton=new ee(this.scene,Mt,this.scene.lang.Texture.NO_THANK,t,s),this.skipButton.setName("NoThanks"),this.skipButton.onClick=this.handleClosePopup,Phaser.Display.Align.In.BottomCenter(this.skipButton,this.viewAdButton,0,50),this.add(this.skipButton)}createGiftIcon(){this.giftIconWhite=this.scene.make.image({key:Mt,frame:ds.LOGO_GIFT_WHITE,visible:!1}),this.giftIconWhite.setWorldSize(150,150),this.giftIconWhite.setDepth(Y.PRIORITY),this.add(this.giftIconWhite),this.giftIcon=this.scene.make.image({key:Mt,frame:ds.LOGO_GIFT,visible:!1}),this.giftIcon.setInteractive({useHandCursor:!0}),this.giftIcon.setWorldSize(150,150),this.giftIcon.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.handleTheGiftClick),this.setTheGiftClickable(!1),this.add(this.giftIcon)}createEffects(){this.cometTwinkle=new Vc(this.scene),this.starTwinkleUp=new Wc(this.scene),this.sparksExplosive=new xg(this.scene),this.add([this.cometTwinkle,this.starTwinkleUp,this.sparksExplosive])}}const ue={PASS_LEVELS:{ID:"pass-levels",EVENTS:{PASS_LEVEL:"pass-level"}},COLLECT_DIAMONDS:{ID:"collect-diamonds",EVENTS:{COLLECT_DIAMONDS:"collect-diamonds"}},INVITE_FRIENDS:{ID:"invite-friends",EVENTS:{INVITED_FRIEND:"INVITED_FRIEND"}},REACH_SCORE:{ID:"reach-score",EVENTS:{ADD_SCORE:"add-score"}},EVENTS:{TASKS_RESET:"tasks-reset",NOTICE_UPDATE:"notice-update"}};class ss extends Error{constructor(e,t){super(e,t),this.name="InvalidContextId",this.message=e||"This contextId is not valid",this.payload=t}}const kg={targets:[],yoyo:!0,duration:120,ease:Phaser.Math.Easing.Circular.Out,props:{scale:{from:1,to:1.3}}};class jn extends Ee{constructor(e){super(kg,e)}}class Gg{scene;bonusScore;fadeInAnimation;fadeOutAnimation;bonusScoreAnimation;bonusScoreText;constructor(e){this.scene=e,this.createText()}setBonusScore(e){this.bonusScore=e,this.bonusScoreText.setText(`${e}`)}runAnimation=()=>{this.bonusScoreText.setVisible(!0),this.runFadeInAnimations(),this.runBonusScoreAnimations(),this.bonusScoreAnimation?.next(this.eatScore)};eatScore=()=>{this.scene.eatScore(this.bonusScore),this.runFadeOutAnimations(),this.fadeOutAnimation?.next(this.hideScore)};hideScore=()=>{this.bonusScoreText.setVisible(!1)};createText(){const{width:e}=this.scene.gameZone;this.bonusScoreText=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(36),depth:Y.TEXT,origin:{x:.5,y:.5},visible:!1,x:e/2,y:200})}runBonusScoreAnimations(){this.bonusScoreAnimation||(this.bonusScoreAnimation=new jn({targets:[this.bonusScoreText],duration:250,props:{scale:1.8}})),this.bonusScoreAnimation.play()}runFadeInAnimations(){this.fadeInAnimation||(this.fadeInAnimation=new es({targets:[this.bonusScoreText],duration:50})),this.fadeInAnimation.play()}runFadeOutAnimations(){this.fadeOutAnimation||(this.fadeOutAnimation=new ut({targets:[this.bonusScoreText],duration:200})),this.fadeOutAnimation.play()}}const xe={COOL:"cool",GOOD:"good",GREAT:"great",TEXT_EXCELLENT:"very-excellent",CONGRATULATION:"congratulation"},{KEY:Bg}=D.EFFECTS;class Ug{scene;originScale;isPlayTextTween;mushPlayCongratulationTween;textTween;endTween;congratulationTween;textImage;constructor(e){this.scene=e,this.createText()}runAnimation=e=>{!this.textTween&&e!==xe.CONGRATULATION&&this.createTextAnimation();const t=this.scene.lang.getCurrentLanguage();switch(e){case xe.COOL:this.textImage.setFrame(this.scene.lang.Texture.COOL),t==="ja"?this.textImage.setWorldSize(157,65.5):t==="id"?this.textImage.setWorldSize(226,74.5):this.textImage.setWorldSize(165,75),this.playTextAnimation();break;case xe.GOOD:this.textImage.setFrame(this.scene.lang.Texture.GOOD),t==="ja"?this.textImage.setWorldSize(134,64.5):t==="id"?this.textImage.setWorldSize(179,75.5):this.textImage.setWorldSize(179,76),this.playTextAnimation();break;case xe.GREAT:this.textImage.setFrame(this.scene.lang.Texture.GREAT),t==="ja"||t==="id"?this.textImage.setWorldSize(191.5,82):this.textImage.setWorldSize(192,82),this.playTextAnimation();break;case xe.TEXT_EXCELLENT:this.textImage.setFrame(this.scene.lang.Texture.EXCELLENT),t==="ja"||t==="id"?this.textImage.setWorldSize(255,84.5):this.textImage.setWorldSize(255,85),this.playTextAnimation();break;case xe.CONGRATULATION:{if(this.congratulationTween?.isPlaying())return;if(this.isPlayTextTween){this.mushPlayCongratulationTween=!0;return}this.playCongratulationAnimation()}break}};playTextAnimation=()=>{this.isPlayTextTween=!0,this.textImage.setVisible(!0),this.textTween.restart()};playCongratulationAnimation=()=>{const e=this.scene.lang.getCurrentLanguage();if(this.textImage.setFrame(this.scene.lang.Texture.CONGRATULATION),this.textImage.setVisible(!0),e==="ja"||e==="id"?this.textImage.setWorldSize(306,99):this.textImage.setWorldSize(306,99),!this.congratulationTween){this.createCongratulationTween();return}this.congratulationTween.restart()};createText(){this.textImage=this.scene.add.sprite(0,0,Bg),this.textImage.setVisible(!1),this.originScale=1/this.scene.world.getPixelRatio(),this.textImage.setDepth(Y.ENCOURAGING),this.alignText()}alignText=()=>{const e=-220+this.textImage.displayHeight/2;Phaser.Display.Align.In.TopCenter(this.textImage,this.scene.gameZone,0,e)};createCongratulationTween(){const e=this.originScale*.8;this.congratulationTween=this.scene.add.tween({targets:this.textImage,completeDelay:200,props:{alpha:{duration:150,value:{from:0,to:1}},scale:{delay:100,duration:450,ease:"Bounce.easeOut",value:{from:e,to:this.originScale}}},onStart:()=>{this.endTween?.stop(),this.textTween?.stop(),this.textImage.setScale(e),this.textImage.setFrame(this.scene.lang.Texture.CONGRATULATION)},onComplete:()=>{if(this.mushPlayCongratulationTween=!1,!this.endTween){this.createEndAnimation();return}this.endTween.restart()}})}createTextAnimation(){this.textTween=this.scene.add.tween({targets:this.textImage,props:{scale:{delay:0,duration:350,ease:Phaser.Math.Easing.Back.Out,value:{from:this.originScale*.5,to:this.originScale}},alpha:{repeat:4,delay:500,duration:120,value:{from:1,to:0}}},onComplete:()=>{if(this.isPlayTextTween=!1,!this.endTween){this.createEndAnimation();return}this.endTween.restart()}})}createEndAnimation=()=>{this.endTween=this.scene.add.tween({targets:this.textImage,duration:300,delay:100,props:{alpha:{from:1,to:0}},onComplete:()=>{if(this.mushPlayCongratulationTween){this.playCongratulationAnimation();return}this.textImage.setVisible(!1)}})}}class fi extends Phaser.GameObjects.Container{payload;mainText;shadowText;constructor(e,t){super(e),this.payload=t,this.createMainText(),this.createShadowText(),this.updateSize(),this.moveDown(this.shadowText),this.scene.add.existing(this)}setText(e){this.mainText.setText(e),this.shadowText.setText(e),this.updateSize()}setTintText(e,t,s,n){this.mainText.setTint(e,t,s,n)}setDropShadow(e,t,s,n=1){this.shadowText.setVisible(!0),this.shadowText.setTint(s),this.shadowText.setAlpha(n),Phaser.Display.Align.In.Center(this.shadowText,this.mainText,e,t)}updateSize(){const{width:e,height:t}=this.mainText;this.setSize(e,t)}createMainText(){this.mainText=this.scene.make.bitmapText({font:this.payload.font,size:this.payload.size,origin:{x:.5,y:.5}}),this.add(this.mainText)}createShadowText(){this.shadowText=this.scene.make.bitmapText({font:this.payload.font,size:this.payload.size,origin:{x:.5,y:.5},visible:!1}),this.add(this.shadowText)}}class Fg{scene;posX;posY;totalScoreAnimation;totalScoreText;constructor(e){this.scene=e,this.createTexts()}setTotalScore(e){this.totalScoreText.setText(`${e}`)}runAnimation=(e,t)=>{const{boardManager:s}=this.scene,{boardContainer:n}=s;this.posX=n.x+e,this.posY=n.y+t,this.posX<40?this.posX=40:this.posX>330&&(this.posX=330),this.runTotalScoreAnimation()};createTexts(){this.totalScoreText=new fi(this.scene,{font:k.PRIMARY.KEY,size:this.scene.fontSize(50)}),this.totalScoreText.setDropShadow(0,1,2368548),this.totalScoreText.setDepth(Y.TEXT),this.totalScoreText.kill()}runTotalScoreAnimation(){this.totalScoreText.revive(),this.totalScoreText.setAlpha(1),this.totalScoreText.setScale(.2),this.totalScoreText.setPosition(this.posX,this.posY),this.totalScoreAnimation?.remove(),this.totalScoreAnimation=this.scene.tweens.add({targets:[this.totalScoreText],ease:Phaser.Math.Easing.Cubic.Out,props:{x:{duration:400,getStart:()=>this.posX},y:{duration:400,getStart:()=>this.posY,getEnd:()=>this.posY-70},scale:{ease:Phaser.Math.Easing.Back.Out,value:{from:.2,to:1}},alpha:{value:{from:1,to:0},delay:900,duration:300}},onComplete:()=>{this.scene&&this.totalScoreText?.kill()}})}}const{EFFECTS:ce}=D,Q={COLORFUL:{KEY:"colorful-animation",TEXTURE:ce.KEY,PREFIX:ce.FRAME.FX_COLORFUL,FRAME_RATE:30,END:17,ZERO_PAD:1},COLOR_CHANGE:{KEY:"color-change-animation",TEXTURE:ce.KEY,PREFIX:ce.FRAME.FX_COLOR_CHANGE,FRAME_RATE:18,END:18,ZERO_PAD:1},PAINT_EXPLOSIVE:{KEY:"paint-explosive-animation",TEXTURE:ce.KEY,PREFIX:ce.FRAME.FX_PAINT_EXPLOSIVE,FRAME_RATE:18,END:12,ZERO_PAD:1},FREEZE_EXPLOSIVE:{KEY:"freeze-explosive-animation",TEXTURE:ce.KEY,PREFIX:ce.FRAME.FX_FREEZE_EXPLOSIVE,FRAME_RATE:30,END:9,ZERO_PAD:1},COLORFUL_EXPLOSIVE:{KEY:"colorful-explosive-animation",TEXTURE:ce.KEY,PREFIX:ce.FRAME.FX_COLORFUL_EXPLOSIVE,FRAME_RATE:30,END:9,ZERO_PAD:1},RED_EXPLOSIVE:{KEY:"red-explosive-animation",TEXTURE:ce.KEY,PREFIX:ce.FRAME.FX_RED_EXPLOSIVE,FRAME_RATE:28,END:9,ZERO_PAD:1},BLUE_EXPLOSIVE:{KEY:"blue-explosive-animation",TEXTURE:ce.KEY,PREFIX:ce.FRAME.FX_BLUE_EXPLOSIVE,FRAME_RATE:28,END:9,ZERO_PAD:1},PINK_EXPLOSIVE:{KEY:"pink-explosive-animation",TEXTURE:ce.KEY,PREFIX:ce.FRAME.FX_PINK_EXPLOSIVE,FRAME_RATE:28,END:9,ZERO_PAD:1},GREEN_EXPLOSIVE:{KEY:"green-explosive-animation",TEXTURE:ce.KEY,PREFIX:ce.FRAME.FX_GREEN_EXPLOSIVE,FRAME_RATE:28,END:9,ZERO_PAD:1},YELLOW_EXPLOSIVE:{KEY:"yellow-explosive-animation",TEXTURE:ce.KEY,PREFIX:ce.FRAME.FX_YELLOW_EXPLOSIVE,FRAME_RATE:28,END:9,ZERO_PAD:1}},{KEY:Yg,TEXTURE:Hg,FRAME_RATE:Vg,END:Wg,PREFIX:Kg,ZERO_PAD:jg}=Q.BLUE_EXPLOSIVE;class zg extends Phaser.Animations.Animation{constructor(e){const t={repeat:0,frameRate:Vg,frames:e.generateFrameNames(Hg,{prefix:Kg,end:Wg,zeroPad:jg}),showOnStart:!0,hideOnComplete:!0,skipMissedFrames:!0};super(e,Yg,t)}}const{KEY:$g,TEXTURE:Xg,FRAME_RATE:qg,END:Zg,PREFIX:Jg,ZERO_PAD:Qg}=Q.COLORFUL_EXPLOSIVE;class ef extends Phaser.Animations.Animation{constructor(e){const t={repeat:0,frameRate:qg,frames:e.generateFrameNames(Xg,{prefix:Jg,end:Zg,zeroPad:Qg}),showOnStart:!0,hideOnComplete:!0,skipMissedFrames:!0};super(e,$g,t)}}const{KEY:tf,TEXTURE:sf,FRAME_RATE:nf,END:af,PREFIX:rf,ZERO_PAD:of}=Q.GREEN_EXPLOSIVE;class cf extends Phaser.Animations.Animation{constructor(e){const t={repeat:0,frameRate:nf,frames:e.generateFrameNames(sf,{prefix:rf,end:af,zeroPad:of}),showOnStart:!0,hideOnComplete:!0,skipMissedFrames:!0};super(e,tf,t)}}const{KEY:lf,TEXTURE:hf,FRAME_RATE:uf,END:df,PREFIX:pf,ZERO_PAD:mf}=Q.PAINT_EXPLOSIVE;class gf extends Phaser.Animations.Animation{constructor(e){const t={repeat:0,frameRate:uf,frames:e.generateFrameNames(hf,{prefix:pf,end:df,zeroPad:mf}),showOnStart:!0,hideOnComplete:!0,skipMissedFrames:!0};super(e,lf,t)}}const{KEY:ff,TEXTURE:Ef,FRAME_RATE:yf,END:Sf,PREFIX:Af,ZERO_PAD:Tf}=Q.PINK_EXPLOSIVE;class If extends Phaser.Animations.Animation{constructor(e){const t={repeat:0,frameRate:yf,frames:e.generateFrameNames(Ef,{prefix:Af,end:Sf,zeroPad:Tf}),showOnStart:!0,hideOnComplete:!0,skipMissedFrames:!0};super(e,ff,t)}}const{KEY:bf,TEXTURE:wf,FRAME_RATE:Cf,END:vf,PREFIX:_f,ZERO_PAD:Of}=Q.RED_EXPLOSIVE;class Rf extends Phaser.Animations.Animation{constructor(e){const t={repeat:0,frameRate:Cf,frames:e.generateFrameNames(wf,{prefix:_f,end:vf,zeroPad:Of}),showOnStart:!0,hideOnComplete:!0,skipMissedFrames:!0};super(e,bf,t)}}const{KEY:Pf,TEXTURE:Df,FRAME_RATE:Mf,END:Lf,PREFIX:xf,ZERO_PAD:Nf}=Q.YELLOW_EXPLOSIVE;class kf extends Phaser.Animations.Animation{constructor(e){const t={repeat:0,frameRate:Mf,frames:e.generateFrameNames(Df,{prefix:xf,end:Lf,zeroPad:Nf}),showOnStart:!0,hideOnComplete:!0,skipMissedFrames:!0};super(e,Pf,t)}}const{KEY:Gf,TEXTURE:Bf,FRAME_RATE:Uf,END:Ff,PREFIX:Yf,ZERO_PAD:Hf}=Q.COLOR_CHANGE;class Vf extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:Uf,frames:e.generateFrameNames(Bf,{prefix:Yf,end:Ff,zeroPad:Hf}),showOnStart:!0,hideOnComplete:!0};super(e,Gf,t)}}const{KEY:Wf,TEXTURE:Kf,FRAME_RATE:jf,END:zf,PREFIX:$f,ZERO_PAD:Xf}=Q.COLORFUL;class qf extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:jf,frames:e.generateFrameNames(Kf,{prefix:$f,end:zf,zeroPad:Xf}),showOnStart:!0,hideOnComplete:!0};super(e,Wf,t)}}const{TILE_RED:Zf,TILE_BLUE:Jf,TILE_PINK:Qf,TILE_GREEN:eE,TILE_YELLOW:tE,TILE_FREEZE:sE,TILE_COLORFUL:iE,TILE_COLOR_CHANGE:nE}=D.GAMEPLAY.FRAME,jc={RED:"red",BLUE:"blue",PINK:"pink",GREEN:"green",YELLOW:"yellow"},zc={FREEZE:"freeze",COLORFUL:"colorful",COLOR_CHANGE:"color_change"},aE={SET_3:"set_3",SET_4:"set_4",SET_5:"set_5",SET_6:"set_6",SET_7:"set_7",SET_8:"set_8",SET_9:"set_9"},{RED:$c,BLUE:Xc,PINK:qc,GREEN:Zc,YELLOW:Jc}=jc,{FREEZE:Qc,COLORFUL:el,COLOR_CHANGE:tl}=zc,rE={[$c]:"r",[Xc]:"b",[qc]:"p",[Zc]:"g",[Jc]:"y",[Qc]:"f",[el]:"c",[tl]:"m"},W={SIZE:37,STATUS:{READY:"ready",MOVING:"moving",CAPTURED:"captured"},FRAME:{[$c]:Zf,[Xc]:Jf,[qc]:Qf,[Zc]:eE,[Jc]:tE,[Qc]:sE,[el]:iE,[tl]:nE},SETS:aE,COLORS:jc,SPECIALS:zc,HASH:rE},oE={targets:[],duration:400,ease:Kn,props:{scale:"+=0.1"}};class zn extends Ee{constructor(e){super(oE,e)}}const{KEY:cE,FRAME:lE}=D.EFFECTS;class hE extends Phaser.GameObjects.Sprite{bonusPosY;colors={red:16462401,blue:1863148,pink:15271420,green:183084,yellow:16631323};constructor(e){super(e,0,0,cE,lE.FX_FIREWORKS_SMALL),this.bonusPosY=100,this.kill(),this.setWorldSize(49,49.5),this.setDepth(Y.FIREWORKS),this.scene.add.existing(this)}randomColor(){const e=Object.values(this.colors),t=Phaser.Math.RND.between(0,e.length-1),s=e[t];this.setTintFill(s)}setColor(e){this.setTintFill(this.colors[e])}fire(e,t,s){this.revive(),this.setPosition(e,t),this.runFireworkAnimation(s),this.scene.audio.playSound(K.FIREWORKS_SOAR,{volume:.2})}runFireworkAnimation(e){if(!this.scene)return;const t=1/this.scene.world.getPixelRatio(),s=Phaser.Math.RND.between(0,this.bonusPosY);this.scene.tweens.add({targets:[this],duration:300,ease:Phaser.Math.Easing.Circular.Out,props:{angle:{repeat:-1,value:360},scale:{yoyo:!0,value:t*.8}}}),this.scene.tweens.add({targets:[this],duration:800,ease:Phaser.Math.Easing.Circular.Out,props:{y:e+s},onComplete:()=>{this.scene.tweens.killTweensOf(this),this.kill()}})}}const{GAMEPLAY:Ya,EFFECTS:Ha}=D,{STATUS:Ws}=W,{GEM_EXPLOSIVE_1:uE,GEM_EXPLOSIVE_2:dE,GEM_EXPLOSIVE_3:pE,GEM_EXPLOSIVE_4:mE,GEM_EXPLOSIVE_5:gE,GEM_EXPLOSIVE_6:fE}=K,Ks=[uE,dE,pE,mE,gE,fE];class Ze extends Phaser.GameObjects.Container{scene;scaleUp=1;scaleDown=1;eatScore=0;row;column;color;frame;tileType;block;highlight;score;firework;unselectAnimation;selectAnimation;highlightTween;soundTimer;explosiveTimer;constructor(e,t,s){super(e,0,0),this.scene=e,s&&(this.color=s,this.tileType=s),this.scaleUp=this.scale,this.scaleDown=this.scale-.1,this.setDepth(Y.TILE),t&&(this.frame=t,this.drawBlock(t)),this.scene.add.existing(this),this.setState(Ws.READY)}show(){this.setVisible(!0),this.block.setVisible(!0),this.setVisible(!0)}setRow(e){this.row=e}setColumn(e){this.column=e}setEatScore(e){const{tileManager:t}=this.scene,s=t.scoreTextGroup.getMatching("visible",!1);s.length<1?this.createScoreText():this.score=s[0],this.eatScore=e,this.score.setAlpha(0),this.score.setVisible(!0),this.score.setText(`${e}`)}removeEvents(){this.block.off(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,this.handleOnUnselect),this.block.off(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,this.handleOnUnselect)}createInput(){this.block.off(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.handleOnSelect),this.block.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.handleOnSelect)}showHighlight(e=-1,t=0){this.scene&&(this.scene.boardManager.boardContainer.bringToTop(this),this.highlight||this.drawHighlight(),!this.highlightTween?.isPlaying()&&this.runHighlightAnimations(e,t))}hideHighlight=()=>{this.highlight||this.drawHighlight(),this.highlightTween?.remove(),this.highlight.setAlpha(0),this.highlight.setVisible(!1)};explosive=(e=0,t,s=!0)=>{this.scene&&(this.explosiveTimer?.remove(),this.explosiveTimer=this.scene.time.addEvent({delay:e,callback:()=>{s&&this.eatScoreAnimation(),this.explosiveAnimation(),this.fireworksAnimation()}}),this.soundTimer?.remove(),this.soundTimer=this.scene.time.addEvent({delay:e-300,callback:()=>{this.playSoundByIndex(t)}}))};playSoundByIndex(e){if(e<0||!Ks[e])return;const t=Ks[e]||Ks[Ks.length-1];this.scene.audio.playSound(t)}handleOnSelect=()=>{this.removeEvents(),this.block.once(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,this.handleOnUnselect),this.block.once(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,this.handleOnUnselect),this.runSelectAnimation()};handleOnUnselect=()=>{this.runUnselectAnimation()};eatScoreAnimation=()=>{!this.scene||!this.score||this.runShowScoreAnimation()};fireworksAnimation(){if(!this.scene)return;const{levelHandler:e,tileManager:t,currentScore:s,boardManager:n,layoutManager:a}=this.scene,{targetScore:r}=e;if(s<r||!t.isEndBoard)return;const{x:c,y:o,color:l}=this,{boardContainer:h}=n,d=h.x+c,u=h.y+o,{objects:p}=a,m=p.header.topBar.y+100;this.firework||(this.firework=new hE(this.scene),this.firework.setColor(l)),this.firework.setVisible(!0),this.firework.fire(d,u,m)}getExplosiveAnimationKey=()=>Q.BLUE_EXPLOSIVE.KEY;explosiveAnimation=()=>{if(!this.block||!this.block.anims)return;const e=this.getExplosiveAnimationKey();this.block.once(Phaser.Animations.Events.ANIMATION_COMPLETE,()=>{this.hideHighlight(),this.removeTile(),this.block.revive(),this.block.setTexture(Ya.KEY),this.block.setFrame(this.frame),this.block.setDisplaySize(37,37)}),this.block.anims.play(e,!0)};enableTile(){this.revive(),this.setState(W.STATUS.READY)}removeTile(){if(!this.scene)return;const{tileManager:e}=this.scene;e.removeTile(this)}drawBlock(e){this.block=this.scene.make.sprite({key:Ya.KEY,frame:e}),this.block.setDisplaySize(37,37),this.add(this.block)}drawHighlight(){this.highlight=this.scene.add.image(0,0,Ha.KEY,Ha.FRAME.FX_HIGHLIGHT),this.highlight.setWorldSize(40,40),this.highlight.setVisible(!1),this.add(this.highlight)}createScoreText(){this.score=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(26),origin:{x:.5,y:.5}}),this.score.setVisible(!1),this.score.setDepth(Y.TEXT);const{tileManager:e}=this.scene;e.scoreTextGroup.add(this.score)}runHighlightAnimations(e,t){this.highlightTween?.remove(),this.scene.tweens.killTweensOf(this.highlight),this.highlightTween=this.scene.tweens.add({targets:this.highlight,duration:130,repeat:e,delay:t,ease:Phaser.Math.Easing.Cubic.InOut,props:{alpha:{from:.3,to:1}},onStart:()=>{this.highlight.setAlpha(0),this.highlight.setVisible(!0),this.moveUp(this.highlight)},onComplete:this.hideHighlight})}runShowScoreAnimation(){this.add(this.score),Phaser.Display.Align.In.Center(this.score,this.block);const{x:e,y:t}=this.score.getWorldPosition();this.remove(this.score),this.score.setPosition(e,t),this.scene.tweens.killTweensOf(this.score),this.scene.tweens.add({targets:this.score,duration:400,ease:Phaser.Math.Easing.Cubic.InOut,props:{y:"-=3",alpha:{from:0,to:.8}},onComplete:()=>{this.scene&&this.runEatScoreAnimation()}})}runEatScoreAnimation(){const{objects:e}=this.scene.layoutManager,{x:t,y:s}=e.header.topBar.currentScoreBar.getWorldPosition();this.scene.tweens.add({targets:this.score,duration:600,ease:Phaser.Math.Easing.Cubic.InOut,props:{x:t,y:s,alpha:{duration:100,delay:370,value:0}},onComplete:()=>{this.score.setVisible(!1),this.scene?.eatScore(this.eatScore),this.removeTile()}})}runSelectAnimation(){this.scene&&(this.selectAnimation||(this.selectAnimation=new oi({targets:[this],duration:100,yoyo:!0,props:{scale:{start:this.scaleUp,from:this.scaleUp,to:this.scaleDown}}})),this.selectAnimation.play())}runUnselectAnimation=()=>{this.scene&&(this.unselectAnimation||(this.unselectAnimation=new zn({targets:[this],duration:100,props:{scale:this.scaleUp}})),this.unselectAnimation.play())};isReady(){return this.state===Ws.READY}isMoving(){return this.state===Ws.MOVING}isCaptured(){return this.state===Ws.CAPTURED}}const{FRAME:EE}=D.GAMEPLAY,{SPECIALS:yE}=W;class ot extends Ze{constructor(e,t,s){super(e,EE.TILE_FREEZE,yE.FREEZE),this.setName("FreezeTile"),this.setRow(t),this.setColumn(s),this.block.removeInteractive(),this.block.off(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN),this.block.once(Phaser.Animations.Events.ANIMATION_START,this.handleStartExplosive)}getExplosiveAnimationKey=()=>Q.FREEZE_EXPLOSIVE.KEY;handleStartExplosive=()=>{const{boardManager:e}=this.scene,{boardContainer:t}=e;this.scene.audio.playSound(K.GEM_EXPLOSIVE_FREEZE),t.moveTo(this,t.count("visible",!0)-1)}}const SE={STATUS:{READY:"ready",RUNNING:"running",STOPPED:"stopped"}},{STATUS:Lt}=SE;class dt{state;scene;constructor(e){this.scene=e}init(){this.setState(Lt.READY)}start(){this.isRunning()||this.setState(Lt.RUNNING)}stop(){this.isRunning()&&this.setState(Lt.STOPPED)}setState(e){this.state=e}isReady(){return this.state===Lt.READY}isRunning(){return this.state===Lt.RUNNING}isStopped(){return this.state===Lt.STOPPED}}const{KEY:AE,TEXTURE:TE,FRAME_RATE:IE,END:bE,PREFIX:wE,ZERO_PAD:CE}=Q.FREEZE_EXPLOSIVE;class vE extends Phaser.Animations.Animation{constructor(e){const t={repeat:0,frameRate:IE,frames:e.generateFrameNames(TE,{prefix:wE,end:bE,zeroPad:CE}),showOnStart:!0,hideOnComplete:!0,skipMissedFrames:!0};super(e,AE,t)}}class _E extends dt{scene;moveDuration=250;moveRowsTween;moveColumnsTween;constructor(e){super(e),this.scene=e,this.createAnimations()}createAnimations(){const{COLORFUL:e,COLOR_CHANGE:t,RED_EXPLOSIVE:s,BLUE_EXPLOSIVE:n,PINK_EXPLOSIVE:a,GREEN_EXPLOSIVE:r,YELLOW_EXPLOSIVE:c,FREEZE_EXPLOSIVE:o,COLORFUL_EXPLOSIVE:l,PAINT_EXPLOSIVE:h}=Q,d=new qf(this.scene.anims),u=new Vf(this.scene.anims),p=new vE(this.scene.anims),m=new ef(this.scene.anims),g=new Rf(this.scene.anims),y=new zg(this.scene.anims),f=new If(this.scene.anims),E=new cf(this.scene.anims),S=new kf(this.scene.anims),I=new gf(this.scene.anims);this.scene.anims.add(e.KEY,d),this.scene.anims.add(t.KEY,u),this.scene.anims.add(o.KEY,p),this.scene.anims.add(l.KEY,m),this.scene.anims.add(s.KEY,g),this.scene.anims.add(n.KEY,y),this.scene.anims.add(a.KEY,f),this.scene.anims.add(r.KEY,E),this.scene.anims.add(c.KEY,S),this.scene.anims.add(h.KEY,I)}moveEase(e){return 2.70158*e*e*e-1.70158*e*e}startBoard(e){const n=[],r=600/e.length;return e.forEach(o=>{const{x:l,y:h,scale:d}=o;n.push({x:l,y:h,scale:d}),o.setX(-50),o.setY(-900),o.setAlpha(0),o.setScale(0)}),this.scene.time.addEvent({repeat:10,delay:600/10,callback:()=>{this.scene.audio.playSound(K.GEM_FALLING)}}),this.scene.tweens.add({targets:e,duration:600,props:{y:{value:{getEnd:(o,l,h,d)=>n[d].y},duration:600-600/12},x:{value:{getEnd:(o,l,h,d)=>n[d].x},duration:600-600/5},scale:{value:{getEnd:(o,l,h,d)=>n[d].scale},delay:0},alpha:{value:1,duration:600-100}},delay:(o,l,h,d)=>{const u=Phaser.Math.RND.between(0,r*d/2);return r*d-u}})}endBoard(e){const{length:a}=e,{levelHandler:r,currentScore:c}=this.scene,{targetScore:o}=r,l=c>=o;e.forEach((u,p)=>{let m=250*p+400;const g=l?-1:1;p>=10&&(m=100*p+2e3),u.explosive(m,g,!1),u.showHighlight(0,m-400)});let h=10;return this.scene.tweens.addCounter({repeat:a+1,duration:250,onRepeat:u=>{if(h<0){u.setTimeScale(1.6);return}this.scene.runBonusScoreAnimation(200*h),h--}})}capturing(e,t,s){return e.forEach((a,r)=>{const c=100*r,o=s?r:-1;a.explosive(c+t,o),!(a instanceof ot)&&a.showHighlight(0,c)}),this.scene.time.addEvent({delay:e.length*100+t+150})}moveRows(e,t=0){const{tile:s,fromRow:n,toRow:a}=e;if(!n||!a)return;const r=a*W.SIZE-n*W.SIZE;this.moveRowsTween?.isPlaying()&&this.moveRowsTween.stop(),this.moveRowsTween=this.scene.tweens.add({targets:s,props:{y:{value:s.y+r,delay:t,duration:this.moveDuration,ease:this.moveEase}}})}moveColumns(e,t=0){const{tile:s,fromColumn:n,toColumn:a}=e;if(!n||!a)return;const r=a*W.SIZE-n*W.SIZE;this.moveColumnsTween?.isPlaying()&&this.moveColumnsTween.stop(),this.moveColumnsTween=this.scene.tweens.add({targets:s,props:{x:{value:s.x+r,delay:t,duration:this.moveDuration,ease:this.moveEase}}})}}const is={STATUS:{READY:"ready",RUNNING:"running",STOPPED:"stopped"}},sl=(i,e)=>e.playerId,OE=(i,e)=>e.opponentId,RE=i=>de(i).match.single,PE=i=>de(i).match.single._id,DE=i=>de(i).match.single.score,ME=i=>de(i).match.single.level,LE=i=>de(i).match.single.data?.fen,xE=i=>de(i).match.single.data?.diamond,NE=i=>de(i).match.challenge,kE=i=>de(i).match.challenge._id,GE=i=>de(i).match.challenge.status,BE=i=>de(i).match.challenge.opponentInfo,UE=i=>de(i).match.group.opponentInfo,FE=V([RE],i=>i),Wt=V([PE],i=>i),il=V([DE],i=>i||0),YE=V([ME],i=>i||0),HE=V([xE],i=>i||0),nl=V([LE],i=>i||null),Ns=V([NE],i=>i),Ei=V([kE],i=>i),VE=V([GE],i=>i),_t=V([BE],i=>i),Va=V([Ns,sl],(i,e)=>{const{whitePlayerId:t,blackPlayerId:s}=i;return t===e?t:s===e?s:Re.playerId}),$n=V([Ns,sl],(i,e)=>{const{whitePlayerId:t,blackPlayerId:s,whitePlayerFinish:n,blackPlayerFinish:a}=i;return e&&t===e?n:e&&s===e?a:!1}),al=V([Ns,OE],(i,e)=>{const{whitePlayerId:t,blackPlayerId:s,whitePlayerFinish:n,blackPlayerFinish:a}=i;return e&&t===e?n:e&&s===e?a:!1}),rl=V([UE],i=>i),{STATUS:Fi}=is,{SET_3:WE,SET_4:KE,SET_5:jE,SET_6:zE,SET_7:$E,SET_8:XE,SET_9:qE}=W.SETS,{Match:ZE}=GameCore.Configs;class JE extends dt{scene;tileMap={};boardMap={};boardContainer;constructor(e){super(e),this.scene=e,this.boardContainer=this.scene.make.container({})}init(){this.clearBoard(),this.setState(Fi.READY)}start(){this.isRunning()||(this.loadSavedBoard(),this.generateBoard(),this.setState(Fi.RUNNING))}stop(){this.isRunning()&&this.setState(Fi.STOPPED)}loadSavedBoard(){if(this.scene.gameplayMode!==Ye||!ZE.ContinueSingleMatchEnabled)return;const e=this.scene.storage.getState(),t=nl(e);t&&this.loadBoardByFen(t)}loadBoardByFen(e){const{tileManager:t}=this.scene;this.tileMap=GameCore.Utils.Hash.decodeMap(e,W.HASH);for(const s in this.tileMap){const n=this.tileMap[s];if(GameCore.Utils.Valid.isObject(n))for(const a in n){const r=n[a],c=t.createTileByType(r,+s,+a);this.setTileToMap(c,+s,+a)}}}clearBoard(){this.tileMap={},this.boardMap={},this.boardContainer.removeAll()}generateBoard(){this.generateTiles(),this.placeBoard(),this.alignBoard()}generateTiles(){const{tileManager:e,levelHandler:t}=this.scene,s=t.getConfigs(),{rows:n,columns:a,colors:r,specials:c,sets:o}=s,l=n*a;if(Object.keys(this.boardMap).length>0)return;const h=Object.keys(o),d=Object.keys(c),u=[...r,...d],p=[],m={};h.forEach(f=>{const E=o[f]||0;for(let S=0;S<E;S++)p.push(f)}),GameCore.Utils.Array.shuffle(p),d.forEach(f=>{m[f]=c[f]});let g=0,y="red";for(let f=0;f<l;f++){const{row:E,column:S}=this.getPositionByIndex(f);if(this.boardMap[E]&&this.boardMap[E][S])continue;let I=this.getRandomTileId(u,[y]);const T=m[I]||0,b=E===1||E===n,O=S===1||S===a;if(T>0&&!b&&!O){const M=e.createTileByType(I,E,S);this.setTileToMap(M,E,S),m[I]=T-1,y=I;continue}I=this.getRandomTileId(r,[y]);const _=[];if(this.findSameColor(E,S,_,I),Phaser.Math.RND.between(0,100)>60){_.indexOf(I)>=0&&(I=this.getRandomTileId(r,_)),y=I;const M=p[g],L=this.getSetCount(M);if(L>0&&this.createTilesBySet(f,L,I)){g++;continue}}y=I;const v=e.createTileByType(I,E,S);this.setTileToMap(v,E,S)}}getSetCount(e){switch(e){case WE:return 3;case KE:return 4;case jE:return 5;case zE:return 6;case $E:return 7;case XE:return 8;case qE:return 9;default:return 0}}getRandomTileId(e,t){const s=GameCore.Utils.Array.difference(e,t),n=s.length-1,a=Phaser.Math.RND.between(0,n);return s[a]}createTilesBySet(e,t,s){const{tileManager:n}=this.scene,a=[],{row:r,column:c}=this.getPositionByIndex(e);return this.findEmptySlot(r,c,a,t),a.length<t?!1:(a.forEach(o=>{const{row:l,column:h}=o,d=n.createTileByType(s,l,h);this.setTileToMap(d,l,h)}),!0)}findSameColor(e,t,s,n,a=2,r=!1){if(a<1)return;const{levelHandler:c}=this.scene,o=c.getConfigs(),{rows:l,columns:h}=o;if(!(e<1||t<1)&&!(e>l||t>h)){if(r){if(!(e in this.boardMap)||!(t in this.boardMap[e]))return;const d=this.boardMap[e][t];s.push(d.color)}this.findSameColor(e,t-1,s,n,a-1,!0),this.findSameColor(e-1,t,s,n,a-1,!0),this.findSameColor(e-1,t+1,s,n,a-1,!0)}}findEmptySlot(e,t,s,n){if(s.length>=n)return;const{levelHandler:a}=this.scene,r=a.getConfigs(),{rows:c,columns:o}=r;if(e<1||t<1||e>c||t>o||e in this.boardMap&&t in this.boardMap[e])return;s.push({row:e,column:t}),Phaser.Math.RND.between(0,100)>=40?this.findEmptySlot(e,t+1,s,n):this.findEmptySlot(e+1,t,s,n)}getTilesByMap(){const e=[];for(const t in this.boardMap){const s=this.boardMap[t];for(const n in s){const a=this.boardMap[t][n];e.push(a)}}return e}placeBoard(){const{levelHandler:e}=this.scene,t=e.getConfigs(),{rows:s,columns:n}=t,a=this.getTilesByMap();Phaser.Actions.GridAlign(a,{width:n,height:s,cellWidth:W.SIZE,cellHeight:W.SIZE,x:-(n*W.SIZE)/2,y:-(s*W.SIZE)})}alignBoard(){const e=this.scene.ads.getBannerHeight();Phaser.Display.Align.In.BottomCenter(this.boardContainer,this.scene.gameZone,W.SIZE,20-e)}getPositionByIndex(e){const{columns:t}=this.scene.levelHandler.getConfigs(),s=Math.floor(e/t)+1,n=e%t+1;return{row:s,column:n}}getTileByIndex(e){const{row:t,column:s}=this.getPositionByIndex(e);return this.boardMap[t][s]}setTileToMap(e,t,s){const{tileManager:n}=this.scene;this.tileMap[t]||(this.tileMap[t]={}),this.boardMap[t]||(this.boardMap[t]={}),e.setRow(t),e.setColumn(s),this.tileMap[t][s]=e.color;const a=this.boardMap[t][s];a&&n.removeTile(a),this.boardMap[t][s]=e,this.boardContainer.add(e),n.addTile(e)}tileSwap(e){const{fromRow:t,toRow:s,fromColumn:n,toColumn:a}=e,r=this.boardMap[s][a],c=this.boardMap[t][n];r.setRow(t),r.setColumn(n),c.setRow(s),c.setColumn(a),this.boardMap[s][a]=c,this.boardMap[t][n]=r,this.tileMap[s][a]=c.color,this.tileMap[t][n]=r.color}}const re={GIFT:{ID:"ItemGift"},PAINT:{ID:"ItemPaint"},HAMMER:{ID:"ItemHammer"},SHUFFLE:{ID:"ItemShuffle"},CHANGE_COLOR:{ID:"ItemChangeColor"}},QE={targets:[],duration:600,ease:Phaser.Math.Easing.Linear,props:{angle:{from:0,to:360}}};class ol extends Ee{constructor(e){super(QE,e)}}const{KEY:ey,FRAME:ty}=D.GAMEPLAY;class sy{scene;fadeInAnimation;rotateAnimation;hammer;onCompleted;constructor(e){this.scene=e}runAnimation(e,t){this.addToAScene(),this.hammer.revive(),this.hammer.setAlpha(1),this.hammer.setPosition(e+35,t),this.runFadeInAnimation(),this.runRotateAnimation(),typeof this.onCompleted=="function"&&this.rotateAnimation?.next(this.onCompleted)}addToAScene(){const{boardManager:e}=this.scene,{boardContainer:t}=e;this.createHammer(),t.exists(this.hammer)||t.add(this.hammer);const s=t.count("visible",!0);t.moveTo(this.hammer,s)}createHammer(){if(this.scene.children.exists(this.hammer))return;this.hammer=this.scene.add.image(0,0,ey,ty.ITEM_HAMMER),this.hammer.setFlipX(!0),this.hammer.setAngle(50),this.hammer.setOrigin(1,1),this.hammer.setWorldSize(29.5,37.5);const e=1/this.scene.world.getPixelRatio();this.hammer.setScale(e*1.2),this.hammer.setDepth(Y.ITEM),this.hammer.kill()}runFadeInAnimation(){this.hammer.setVisible(!0),this.fadeInAnimation?.remove(),this.fadeInAnimation=new es({targets:[this.hammer]}),this.fadeInAnimation?.play()}runRotateAnimation(){this.rotateAnimation?.remove(),this.rotateAnimation=new ol({targets:[this.hammer],ease:Phaser.Math.Easing.Back.In,duration:500,props:{angle:-20},onComplete:()=>{this.hammer.kill()}}),this.rotateAnimation?.play()}}const iy={targets:[],props:{alpha:{duration:500,value:{start:0,from:0,to:1},ease:Phaser.Math.Easing.Cubic.Out},scale:{duration:1e3,value:{start:.8,from:.8,to:1},ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45]}}};class yi extends Ee{constructor(e){super(iy,e)}}const{Gameplay:Yi}=GameCore.Configs,{KEY:Hi,FRAME:Wa}=D.GAMEPLAY;class Si extends Phaser.GameObjects.Container{scene;isActive=!0;value;autoRunUpAnimation=!0;item;bg;bar;icon;diamond;showItemAnimation;bubbleAnimation;shakeAnimation;constructor(e,t,s,n){super(e),this.scene=e,this.createBg(),this.createItem(t,s,n),this.createBar(),this.createIcon(),this.createDiamond(),this.createAnimations(),this.setDepth(Y.ITEM),this.scene.add.existing(this)}activeItem(){this.isActive=!0,this.showItemAnimation.play(),this.bg.setVisible(!1),this.bar.setVisible(!1),this.icon.setVisible(!1),this.diamond.setVisible(!1)}deactivateItem(){this.isActive=!1,this.bg.setVisible(!0),this.bar.setVisible(!Yi.FreeItems),this.icon.setVisible(!Yi.FreeItems),this.diamond.setVisible(!Yi.FreeItems)}set onClick(e){const{width:t,height:s}=this.bg,{height:n}=this.item;this.setSize(t,s+n),this.setInteractive({useHandCursor:!0}),this.on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,e)}createBg(){const{KEY:e,FRAME:t}=D.GAMEPLAY;this.bg=this.scene.add.image(0,0,e,t.ITEM_BG_ITEM),this.bg.setWorldSize(50,50),this.add(this.bg)}createItem(e,t,s){this.item=this.scene.add.image(0,0,Hi,e),this.item.setWorldSize(t,s),Phaser.Display.Align.In.Center(this.item,this.bg),this.add(this.item)}createBar(){this.bar=this.scene.add.image(0,0,Hi,Wa.ITEM_BG_COIN),this.bar.setWorldSize(47,17),Phaser.Display.Align.In.BottomCenter(this.bar,this.bg,0,15),this.add(this.bar)}createIcon(){this.icon=this.scene.add.image(0,0,Hi,Wa.ICON_DIAMOND_SMALL),this.icon.setWorldSize(10,10),Phaser.Display.Align.In.RightCenter(this.icon,this.bar,-4),this.add(this.icon)}createDiamond(){this.diamond=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(16),origin:{x:.5,y:.5}}),this.setDiamond(0),this.add(this.diamond)}setDiamond(e){this.value=e,this.diamond.setText(`-${e}`),this.icon.setVisible(!0);const t=this.icon.width+6;Phaser.Display.Align.In.RightCenter(this.diamond,this.bar,-t)}createAnimations(){const e=1/this.scene.world.getPixelRatio();this.showItemAnimation=new yi({targets:[this.item],props:{scale:{duration:1e3,value:{start:e*.8,from:e*.8,to:e},ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45]}}}),this.bubbleAnimation=new qe({targets:[this.item],props:{scale:{from:e,to:e*1.2}}}),this.shakeAnimation=new Wn({targets:[this.diamond],repeat:3,props:{x:4}})}}const oe={FIRST_MOVE:"FirstMove",TARGET_SCORE:"TargetScore",CURRENT_SCORE:"CurrentScore",COLORFUL_GEM:"ColorfulGem",ITEM_PAINT:"ItemPaint",ITEM_HAMMER:"ItemHammer",ITEM_SHUFFLE:"ItemShuffle"},Ae={START:"tut-start",SETUP_COMPLETED:"tut-setup-completed",GEMS_EAT:"tut-gems-eat",GEMS_DROPPED:"tut-gems-dropped"},{ID:Vi}=re.HAMMER,{FRAME:ny}=D.GAMEPLAY;class cl extends Si{scene;isRunning=!1;hammerAnimation;constructor(e){super(e,ny.ITEM_HAMMER,29.5,37.5),this.scene=e,this.setDiamond(45),this.createAnimations(),this.onClick=this.handleUseItem}activeItem(){super.activeItem(),this.bubbleAnimation.play(),this.scene.audio.pauseMusic()}deactivateItem(){super.deactivateItem(),this.bubbleAnimation.stop(),this.scene.audio.playMusic()}createAnimations(){super.createAnimations(),this.hammerAnimation=new sy(this.scene)}handleUseItem=()=>{if(this.isRunning)return;const{itemManager:e,tutorialManager:t,tileManager:s}=this.scene;if(this.isActive){if(t.tutorialId===oe.ITEM_HAMMER)return;e.deactivateItem(Vi);return}if(!e.activeItem(Vi)){this.scene.audio.playSound(K.MOVE_WRONG),this.shakeAnimation.play();return}s.removeSuggestionsTiles()};useItem(e){if(this.scene.audio.stopSound(K.ITEM_ACTIVE_AMBIENCE),!this.isActive||this.isRunning)return!1;this.isRunning=!0;const{tileManager:t,boardManager:s}=this.scene,{boardContainer:n}=s;t.isSelectable=!1;const{x:a,y:r}=e,c=n.count("visible",!0);return n.moveTo(e,c-1),this.hammerAnimation.onCompleted=this.hitTile(e),this.hammerAnimation.runAnimation(a,r),!0}hitTile=e=>()=>{const{tileManager:t,itemManager:s}=this.scene;t.isSelectable=!0,t.tilesCapturing([e],!1,0,300),t.isSelectable=!1,this.scene.audio.playSound(K.USE_HAMMER),this.scene.time.addEvent({delay:1e3,callback:()=>{this.isRunning=!1,s.deactivateItem(Vi),t.isSelectable=!0,t.suggestionsEatableTiles()}})}}const{KEY:ay}=D.GAMEPLAY;class ry{scene;paint;constructor(e){this.scene=e}runAnimation(e,t){return this.addToAScene(),this.paint.revive(),this.paint.setPosition(e,t),this.paint.anims.play(Q.PAINT_EXPLOSIVE.KEY),this.paint.setWorldSize(134,133),this.scene.audio.playSound(K.USE_PAINT),this.paint}addToAScene(){const{boardManager:e}=this.scene,{boardContainer:t}=e;if(t.exists(this.paint)){const s=t.count("visible",!0);t.moveTo(this.paint,s);return}this.createPaint(),t.add(this.paint)}createPaint(){this.paint?.destroy(),this.paint=this.scene.add.sprite(0,0,ay),this.paint.kill(),this.paint.setDepth(Y.ITEM)}}const{ID:Wi}=re.PAINT,{FRAME:oy}=D.GAMEPLAY;class ll extends Si{scene;isRunning;paintAnimation;maxRowsAround=1;maxColumnsAround=1;constructor(e){super(e,oy.ITEM_PAINT,31.5,33),this.scene=e,this.isRunning=!1,this.setDiamond(100),this.createAnimations(),this.onClick=this.handleUseItem}activeItem(){super.activeItem(),this.bubbleAnimation.play(),this.scene.audio.pauseMusic()}deactivateItem(){super.deactivateItem(),this.bubbleAnimation.stop(),this.scene.audio.playMusic()}createAnimations(){super.createAnimations(),this.paintAnimation=new ry(this.scene)}handleUseItem=()=>{if(this.isRunning)return;const{itemManager:e,tutorialManager:t,tileManager:s}=this.scene;if(this.isActive){if(t.tutorialId===oe.ITEM_PAINT)return;e.deactivateItem(Wi);return}if(!e.activeItem(Wi)){this.scene.audio.playSound(K.MOVE_WRONG),this.shakeAnimation.play();return}s.removeSuggestionsTiles()};useItem(e){if(this.scene.audio.stopSound(K.ITEM_ACTIVE_AMBIENCE),!this.isActive||this.isRunning)return!1;this.isRunning=!0;const{tileManager:t,itemManager:s}=this.scene;t.isSelectable=!1;const n=t.getTilesAround(e,this.maxRowsAround,this.maxColumnsAround),{x:a,y:r,tileType:c}=e;return this.paintAnimation.runAnimation(a,r).once(Phaser.Animations.Events.ANIMATION_COMPLETE,()=>{t.tilesChangeColor(c,n),s.deactivateItem(Wi),t.isSelectable=!0,t.suggestionsEatableTiles(),this.isRunning=!1}),!0}}const he={TYPES:{COLLECT_GEMS:"collect-gems",USE_ITEM:"use-item",COMBO:"combo"},EVENTS:{MISSION_START:"mission-start",MISSION_UPDATE:"mission-update",MISSION_FAILED:"mission-failed",MISSION_COMPLETED:"mission-completed"},OBJECTS:{...W.COLORS,...W.SPECIALS,PAINT:re.PAINT.ID,HAMMER:re.HAMMER.ID,SHUFFLE:re.SHUFFLE.ID}},{STATUS:cy}=is,{Gameplay:ly}=GameCore.Configs;class hy extends dt{scene;itemTitle;itemDescription;items={};itemActive="";currentHideableObjects=[];itemUI;constructor(e){super(e),this.scene=e,this.itemUI=this.scene.add.group(),this.createItems(),this.createItemTitle(),this.createItemDescription(),this.currentHideableObjects=[]}init(){for(const e in this.items)this.deactivateItem(e);this.setState(cy.READY)}activeItem(e){if(!this.isRunning())return!1;const{tileManager:t,tutorialManager:s}=this.scene;if(!this.items[e]||this.itemActive&&this.itemActive!==e||this.scene.currentDiamond<this.items[e].value&&!ly.FreeItems)return!1;const{tutorialId:n}=s,a=n===e;if(!t.isUseableItem&&!a)return!1;for(const r in this.items)this.deactivateItem(r,!1);return this.itemActive=e,this.items[e].activeItem(),this.showMask(),!0}deactivateItem(e,t=!0){this.items[e]&&(this.itemActive="",this.items[e].deactivateItem(),this.scene.audio.stopSound(K.ITEM_ACTIVE_AMBIENCE),this.scene.updateMove(),t&&this.hideMask())}getActiveItem(){if(this.isRunning()&&this.items[this.itemActive])return this.items[this.itemActive]}showMask(){if([re.HAMMER.ID,re.PAINT.ID].indexOf(this.itemActive)!==-1){switch(this.scene.tweens.killTweensOf(this.currentHideableObjects),this.scene.tweens.killTweensOf([this.itemTitle,this.itemDescription,this.scene.background]),this.itemUI.killGroup(),this.itemActive){case re.HAMMER.ID:this.items[re.HAMMER.ID].setVisible(!0),this.scene.audio.playSound(K.ITEM_ACTIVE_AMBIENCE,{volume:.4,loop:!0});break;case re.PAINT.ID:this.items[re.PAINT.ID].setVisible(!0),this.scene.audio.playSound(K.ITEM_ACTIVE_AMBIENCE,{volume:.4,loop:!0});break}switch(this.currentHideableObjects=this.itemUI.getMatching("visible",!1),this.currentHideableObjects.forEach(e=>{e.setVisible(!0)}),this.scene.add.tween({targets:this.currentHideableObjects,duration:400,ease:Phaser.Math.Easing.Quadratic.Out,props:{alpha:0},onComplete:()=>{this.currentHideableObjects.forEach(e=>{e.setVisible(!1)})}}),this.scene.add.tween({targets:[this.scene.background],duration:400,ease:Phaser.Math.Easing.Quadratic.Out,props:{alpha:.2}}),this.itemTitle.setVisible(!0),this.itemDescription.setVisible(!0),this.itemActive){case re.HAMMER.ID:this.itemTitle.setText(this.scene.lang.Text.HAMMER),this.itemDescription.setFontSize(this.scene.fontSize(28)),this.itemDescription.setText(this.scene.lang.Text.USE_HAMMER);break;case re.PAINT.ID:{this.scene.lang.getCurrentLanguage()==="ja"?this.itemDescription.setFontSize(this.scene.fontSize(28)):this.itemDescription.setFontSize(this.scene.fontSize(25)),this.itemTitle.setText(this.scene.lang.Text.MAGIC_BOTTLE),this.itemDescription.setText(this.scene.lang.Text.USE_MAGIC);break}}this.itemTitle.setAlpha(0),this.itemDescription.setAlpha(0),this.scene.add.tween({targets:[this.itemTitle,this.itemDescription],duration:400,ease:Phaser.Math.Easing.Quadratic.Out,props:{alpha:1}})}}hideMask(){this.scene.tweens.killTweensOf(this.currentHideableObjects),this.scene.tweens.killTweensOf([this.itemTitle,this.itemDescription,this.scene.background]),this.scene.add.tween({targets:[this.itemTitle,this.itemDescription],duration:400,ease:Phaser.Math.Easing.Quadratic.In,props:{alpha:0},onComplete:()=>{this.itemTitle.setVisible(!1),this.itemDescription.setVisible(!1),this.itemTitle.setText(""),this.itemDescription.setText("")}}),this.itemUI.reviveGroup(),this.scene.add.tween({targets:[this.scene.background,...this.currentHideableObjects],duration:400,ease:Phaser.Math.Easing.Quadratic.In,props:{alpha:1}})}applyItem(e){if(!this.isRunning())return!1;const t=this.getActiveItem();if(!t)return!1;let s=!1;switch(this.itemActive){case re.HAMMER.ID:if(e instanceof ot)return!1;t instanceof cl&&(s=t.useItem(e));break;case re.PAINT.ID:if(e instanceof ot)return!1;t instanceof ll&&(s=t.useItem(e));break;default:return!1}if(s){const{tutorialId:n}=this.scene.tutorialManager,{ITEM_HAMMER:a,ITEM_PAINT:r,ITEM_SHUFFLE:c}=oe;(!n||[a,r,c].indexOf(n)===-1)&&this.scene.useDiamond(t.value);const{missionsManager:o}=this.scene;o.updateMission(he.TYPES.USE_ITEM,this.itemActive,1)}return s}createItemTitle(){const e=this.scene.lang.getCurrentLanguage();this.itemTitle=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(35),text:"Title",origin:{x:.5,y:.5},visible:!1}),this.itemTitle.setTint(16705563);let t=-95;e==="id"&&(t=-80),Phaser.Display.Align.In.TopCenter(this.itemTitle,this.scene.gameZone,0,t)}createItemDescription(){const e=this.scene.lang.getCurrentLanguage();this.itemDescription=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(28),text:"Description",origin:{x:.5,y:.5},visible:!1}),this.itemDescription.setMaxWidth(250),this.itemDescription.setCenterAlign();let t=-180;e==="id"&&(t=-165),Phaser.Display.Align.In.TopCenter(this.itemDescription,this.scene.gameZone,0,t)}createItems(){const{objects:e}=this.scene.layoutManager;this.items[re.GIFT.ID]=e.giftItem,this.items[re.PAINT.ID]=e.paintItem,this.items[re.HAMMER.ID]=e.hammerItem,this.items[re.SHUFFLE.ID]=e.shuffleItem,this.itemUI.addMultiple([e.giftItem,e.paintItem,e.hammerItem,e.shuffleItem])}}const Ie={NORMAL:"normal",FALL_DOWN:"fall-down",FLY_UP:"fly-up",PUSH_LEFT:"push-left",PUSH_RIGHT:"push-right",PUT_ROWS_MIDDLE:"put-rows-middle",PUT_COLUMNS_MIDDLE:"put-columns-middle",FLY_UP_PUSH_LEFT:"fly-up-push-left",FLY_UP_PUSH_RIGHT:"fly-up-push-right",FALL_DOWN_PUSH_LEFT:"fall-down-push-left",FALL_DOWN_PUSH_RIGHT:"fall-down-push-right",FLY_UP_PUT_COLUMNS_MIDDLE:"fly-up-put-columns-middle",FALL_DOWN_PUT_COLUMNS_MIDDLE:"fall-down-put-columns-middle"},uy=[{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{},sets:{set_3:10,set_5:2,set_7:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:1200},{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{colorful:2},sets:{set_3:8,set_4:4,set_5:2,set_6:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:3e3},{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{colorful:2,freeze:2},sets:{set_3:8,set_4:7,set_5:2},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:5e3},{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{freeze:2,colorful:2,color_change:2},sets:{set_3:9,set_4:5,set_5:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:7500},{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{freeze:2,colorful:1,color_change:2},sets:{set_3:6,set_4:4,set_6:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:1e4},{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{freeze:3,colorful:1,color_change:2},sets:{set_3:6,set_4:3,set_5:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:12500},{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{freeze:3,colorful:3,color_change:5},sets:{set_3:6,set_4:3,set_5:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:15e3},{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{freeze:3,colorful:1,color_change:1},sets:{set_3:8,set_4:2,set_5:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:18e3},{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{freeze:1,colorful:3,color_change:2},sets:{set_3:8,set_4:1,set_6:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:2e4},{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{freeze:1,colorful:2,color_change:4},sets:{set_3:7,set_4:1,set_5:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:22e3},{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{freeze:5,colorful:2,color_change:3},sets:{set_3:6,set_4:1,set_5:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:25e3},{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{freeze:2,colorful:1,color_change:5},sets:{set_3:8,set_5:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:27500},{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{freeze:3,colorful:6,color_change:5},sets:{set_3:10,set_4:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:3e4},{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{freeze:6,colorful:1,color_change:3},sets:{set_3:10,set_4:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:33e3},{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{freeze:8,colorful:3,color_change:4},sets:{set_3:10,set_4:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:36e3},{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{freeze:4,colorful:3,color_change:5},sets:{set_3:10,set_4:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:38500},{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{freeze:2,colorful:7,color_change:7},sets:{set_3:10,set_4:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:41e3},{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{freeze:4,colorful:4,color_change:8},sets:{set_3:10,set_4:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:44e3},{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{freeze:5,colorful:5,color_change:4},sets:{set_3:10,set_4:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:46500},{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{freeze:8,colorful:3,color_change:7},sets:{set_3:10,set_4:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:5e4},{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{freeze:7,colorful:4,color_change:4},sets:{set_3:8,set_5:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:52500},{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{freeze:8,colorful:5,color_change:4},sets:{set_3:8,set_5:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:55e3},{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{freeze:4,colorful:8,color_change:6},sets:{set_3:8,set_5:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:58e3},{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{freeze:6,colorful:5,color_change:8},sets:{set_3:8,set_5:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:61e3},{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{freeze:7,colorful:5,color_change:5},sets:{set_3:8,set_5:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:63500},{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{freeze:5,colorful:7,color_change:7},sets:{set_3:8,set_5:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:66500},{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{freeze:5,colorful:7,color_change:1},sets:{set_3:8,set_5:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:69e3},{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{freeze:4,colorful:10,color_change:6},sets:{set_3:8,set_5:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:72e3},{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{freeze:4,colorful:10,color_change:6},sets:{set_3:8,set_5:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:75e3},{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{freeze:11,colorful:4,color_change:5},sets:{set_3:8,set_5:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:78e3},{mode:"fall-down-push-left",colors:["red","blue","pink","green","yellow"],specials:{freeze:11,colorful:4,color_change:5},sets:{set_3:8,set_5:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:80500}],{SET_3:dy,SET_4:py,SET_5:my,SET_6:gy,SET_7:fy,SET_8:Ey,SET_9:yy}=W.SETS,{RED:Sy,BLUE:Ay,PINK:Ty,GREEN:Iy,YELLOW:by}=W.COLORS,{FREEZE:wy,COLORFUL:Cy,COLOR_CHANGE:vy}=W.SPECIALS,Ki=[{mode:Ie.NORMAL,colors:[Sy,Ay,Ty,Iy,by],specials:{[wy]:1,[Cy]:1,[vy]:1},sets:{[dy]:1,[py]:1,[my]:1,[gy]:1,[fy]:1,[Ey]:1,[yy]:1},rows:10,columns:10,eatableSize:2,scorePerItem:5,targetScore:0},...uy],{Gameplay:Ka}=GameCore.Configs;class _y{scene;level=0;targetScore=0;gameLevel;levelConfig;constructor(e){this.scene=e,this.gameLevel=Ki}init(){this.level=Ka.StartLevel,this.setConfig(this.level)}getConfigs(){return this.levelConfig}getConfigByLevel(e){return this.gameLevel[e]||null}up(e){if(e<this.targetScore)return!1;const t=this.canLevelUp(this.level),s=t>=Ki.length-1;return t===this.level?s?(this.level+=1,this.setConfig(this.level),!0):!1:(this.level=t,this.setConfig(t),!0)}canLevelUp(e){const t=e+1;return this.gameLevel[t]?t:e}calcByDifficult(e,t){let s=1;const{LevelDifficultRate:n}=Ka;return e<=30?s=n.FromUnder30:e<=35?s=n.FromUnder35:e<=45?s=n.FromUnder45:e>45&&(s=n.FromUnder200),Math.round(t*s/100)*100}setConfig(e){const t=Ki.length-1,s=e>t,n=s?t:e;this.levelConfig=this.gameLevel[n];const{targetScore:a=0}=this.levelConfig,{currentScore:r}=this.scene,o=(r>a?r:a)+2e3;this.targetScore=this.calcByDifficult(n,s?o:a),this.scene.setTargetScore(this.targetScore)}}const Oy=i=>({type:Ac,payload:{name:i}}),Ry=(i,e,t)=>({type:Tc,payload:{name:i,type:e,value:t}}),Py=i=>({type:Ic,payload:{name:i}}),Dy=i=>i[gi]?.mission,ci=V([Dy],i=>i),My=i=>i[gi]?.missions,Ly=i=>i[gi]?.isRequesting,hl=V([My],i=>i),xy=V([Ly],i=>i);var Tn={},Ny={get exports(){return Tn},set exports(i){Tn=i}};(function(i){var e=Object.prototype.hasOwnProperty,t="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function n(o,l,h){this.fn=o,this.context=l,this.once=h||!1}function a(o,l,h,d,u){if(typeof h!="function")throw new TypeError("The listener must be a function");var p=new n(h,d||o,u),m=t?t+l:l;return o._events[m]?o._events[m].fn?o._events[m]=[o._events[m],p]:o._events[m].push(p):(o._events[m]=p,o._eventsCount++),o}function r(o,l){--o._eventsCount===0?o._events=new s:delete o._events[l]}function c(){this._events=new s,this._eventsCount=0}c.prototype.eventNames=function(){var l=[],h,d;if(this._eventsCount===0)return l;for(d in h=this._events)e.call(h,d)&&l.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(h)):l},c.prototype.listeners=function(l){var h=t?t+l:l,d=this._events[h];if(!d)return[];if(d.fn)return[d.fn];for(var u=0,p=d.length,m=new Array(p);u<p;u++)m[u]=d[u].fn;return m},c.prototype.listenerCount=function(l){var h=t?t+l:l,d=this._events[h];return d?d.fn?1:d.length:0},c.prototype.emit=function(l,h,d,u,p,m){var g=t?t+l:l;if(!this._events[g])return!1;var y=this._events[g],f=arguments.length,E,S;if(y.fn){switch(y.once&&this.removeListener(l,y.fn,void 0,!0),f){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,h),!0;case 3:return y.fn.call(y.context,h,d),!0;case 4:return y.fn.call(y.context,h,d,u),!0;case 5:return y.fn.call(y.context,h,d,u,p),!0;case 6:return y.fn.call(y.context,h,d,u,p,m),!0}for(S=1,E=new Array(f-1);S<f;S++)E[S-1]=arguments[S];y.fn.apply(y.context,E)}else{var I=y.length,T;for(S=0;S<I;S++)switch(y[S].once&&this.removeListener(l,y[S].fn,void 0,!0),f){case 1:y[S].fn.call(y[S].context);break;case 2:y[S].fn.call(y[S].context,h);break;case 3:y[S].fn.call(y[S].context,h,d);break;case 4:y[S].fn.call(y[S].context,h,d,u);break;default:if(!E)for(T=1,E=new Array(f-1);T<f;T++)E[T-1]=arguments[T];y[S].fn.apply(y[S].context,E)}}return!0},c.prototype.on=function(l,h,d){return a(this,l,h,d,!1)},c.prototype.once=function(l,h,d){return a(this,l,h,d,!0)},c.prototype.removeListener=function(l,h,d,u){var p=t?t+l:l;if(!this._events[p])return this;if(!h)return r(this,p),this;var m=this._events[p];if(m.fn)m.fn===h&&(!u||m.once)&&(!d||m.context===d)&&r(this,p);else{for(var g=0,y=[],f=m.length;g<f;g++)(m[g].fn!==h||u&&!m[g].once||d&&m[g].context!==d)&&y.push(m[g]);y.length?this._events[p]=y.length===1?y[0]:y:r(this,p)}return this},c.prototype.removeAllListeners=function(l){var h;return l?(h=t?t+l:l,this._events[h]&&r(this,h)):(this._events=new s,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=t,c.EventEmitter=c,i.exports=c})(Ny);const ky=Tn,X=new ky,{STATUS:ji}=is;class Gy extends dt{scene;timer;requireData;missionIds;constructor(e){super(e),this.scene=e}init(){this.setupData()&&(this.listenEvents(),this.setState(ji.READY))}setupData(){const e=this.scene.storage.getState(),t=hl(e);return t?(this.missionIds=[],this.requireData={},Object.keys(t).forEach(s=>{this.missionIds.push(s);const{require:n}=t[s];Object.keys(n).forEach(a=>{if(!this.requireData[a]){this.requireData[a]=[s];return}this.requireData[a].indexOf(s)>=0||this.requireData[a].push(s)})}),!0):!1}listenEvents(){X.off(he.EVENTS.MISSION_FAILED,this.missionFailed),X.off(he.EVENTS.MISSION_COMPLETED,this.missionCompleted),X.on(he.EVENTS.MISSION_FAILED,this.missionFailed),X.on(he.EVENTS.MISSION_COMPLETED,this.missionCompleted)}start(){if(!this.isReady()||this.isRunning())return;if(!this.startMission()){this.getMissionBlock().showRequesting(!0);return}this.updateMissionBlock(),this.startCountdown(),this.setState(ji.RUNNING)}stop(){this.isRunning()&&this.setState(ji.STOPPED)}getMissionBlock(){const{objects:e}=this.scene.layoutManager,{missionBlock:t}=e.header.topBar;return t}startCountdown(){const e=Phaser.Math.RND.between(20,40);this.timer?.stop();let t=0;const s=this.getMissionBlock();this.timer=this.scene.tweens.addCounter({duration:1e3,repeat:e,onRepeat:()=>{t++,e-t===2&&s.runTimeOutAnimation()},onComplete:()=>{const n=this.scene.storage.getState(),a=ci(n);X.emit(he.EVENTS.MISSION_FAILED,a?.name)}})}updateMissionBlock(){const e=this.scene.storage.getState(),t=ci(e);if(!t)return;this.getMissionBlock().updateInfo(t)}getRandomMissionId(e){const{levelHandler:t}=this.scene,{colors:s,specials:n}=t.getConfigs(),a=Object.keys(n).map(d=>d),r=[...s,...a],c=Phaser.Math.RND.between(0,this.missionIds.length-1),o=Phaser.Math.RND.between(0,r.length-1),l=r[o];if(!l)return this.missionIds[c];let h=this.requireData[l]||[];return h.length<1?this.missionIds[c]:(e&&(h=h.filter(d=>d!==e)||[]),h.length<1?this.missionIds[c]:h[o])}startMission=e=>{const t=this.getRandomMissionId(e);return t?(this.scene.storage.dispatch(Oy(t)),X.emit(he.EVENTS.MISSION_START,t),!0):!1};updateMission=(e,t,s)=>{this.isRunning()&&(X.emit(he.EVENTS.MISSION_UPDATE,{id:e,type:t,value:s}),this.updateMissionBlock())};missionFailed=e=>{this.timer?.remove(),this.nextMission(e)};missionCompleted=e=>{if(this.timer?.stop(),!this.isRunning())return;const{name:t,reward:s}=e;if(!GameCore.Utils.Valid.isString(t)||!GameCore.Utils.Valid.isNumber(s))return;const n=this.getMissionBlock();this.updateMissionBlock(),this.scene.audio.playSound(K.MISSION_COMPLETED),n.runRewardAnimation(s),X.emit(ue.REACH_SCORE.EVENTS.ADD_SCORE,{type:"score",value:s}),this.nextMission(t)};nextMission(e){this.scene.time.delayedCall(1200,()=>{const t=this.startMission(e);if(this.startCountdown(),!t){this.getMissionBlock().showRequesting(!0);return}this.updateMissionBlock()})}}class By extends dt{scene;constructor(e){super(e),this.scene=e}applyMode=()=>{const{mode:e}=this.scene.levelHandler.getConfigs(),{moveDuration:t}=this.scene.animationManager,s=t-50;switch(this.scene.time.delayedCall(s-150,()=>{this.scene.audio.playSound(K.GEM_DROP,{volume:.5})}),e){case Ie.NORMAL:break;case Ie.FALL_DOWN:this.tilesFallDown(0);break;case Ie.FLY_UP:this.tilesFlyUp(0);break;case Ie.PUSH_LEFT:this.tilesPushLeft(0);break;case Ie.PUSH_RIGHT:this.tilesPushRight(0);break;case Ie.FALL_DOWN_PUSH_LEFT:this.tilesFallDown(0),this.tilesPushLeft(s);break;case Ie.FLY_UP_PUSH_RIGHT:this.tilesFlyUp(0),this.tilesPushRight(s);break;case Ie.FALL_DOWN_PUSH_RIGHT:this.tilesFallDown(0),this.tilesPushRight(s);break;case Ie.FLY_UP_PUSH_LEFT:this.tilesFlyUp(0),this.tilesPushLeft(s);break;case Ie.PUT_COLUMNS_MIDDLE:this.tilesPutColumnsMiddle(0);break;case Ie.PUT_ROWS_MIDDLE:this.tilesPutRowsMiddle(0);break;case Ie.FALL_DOWN_PUT_COLUMNS_MIDDLE:this.tilesFallDown(0),this.tilesPutColumnsMiddle(s);break;case Ie.FLY_UP_PUT_COLUMNS_MIDDLE:this.tilesFlyUp(0),this.tilesPutColumnsMiddle(s);break}};getTiles(){const{boardManager:e}=this.scene,{boardMap:t}=e,s=[];for(const n in t)for(const a in t[n]){const r=t[n][a];s.push(r)}return s}tilesFlyUp(e=0){const{boardManager:t,animationManager:s}=this.scene;this.getTiles().forEach(a=>{const{row:r,column:c}=a;if(a.isCaptured())return;const o=this.getEmptySpacesAbove(r,c);o<1||(t.tileSwap({fromRow:r,toRow:r-o,fromColumn:c,toColumn:c}),s.moveRows({tile:a,fromRow:r,toRow:r-o},e))})}tilesFallDown(e=0){const{boardManager:t,animationManager:s}=this.scene,n=this.getTiles();n.reverse(),n.forEach(a=>{const{row:r,column:c}=a;if(a.isCaptured())return;const o=this.getEmptySpacesBlow(r,c);o<1||(t.tileSwap({fromRow:r,toRow:r+o,fromColumn:c,toColumn:c}),s.moveRows({tile:a,fromRow:r,toRow:r+o},e))})}tilesPushLeft(e=0){const{boardManager:t,animationManager:s}=this.scene;this.getTiles().forEach(a=>{const{row:r,column:c}=a;if(a.isCaptured())return;const o=this.getEmptySpacesLeft(r,c);o<1||(t.tileSwap({fromRow:r,toRow:r,fromColumn:c,toColumn:c-o}),s.moveColumns({tile:a,fromColumn:c,toColumn:c-o},e))})}tilesPushRight(e=0){const{boardManager:t,animationManager:s}=this.scene,n=this.getTiles();n.reverse(),n.forEach(a=>{const{row:r,column:c}=a;if(a.isCaptured())return;const o=this.getEmptySpacesRight(r,c);o<1||(t.tileSwap({fromRow:r,toRow:r,fromColumn:c,toColumn:c+o}),s.moveColumns({tile:a,fromColumn:c,toColumn:c+o},e))})}tilesPutColumnsMiddle(e=0){const{boardManager:t,animationManager:s}=this.scene,n=this.getTiles();n.forEach(a=>{const{row:r,column:c}=a;if(a.isCaptured())return;const o=this.getEmptySpacesMiddleLeft(r,c);o<1||(t.tileSwap({fromRow:r,toRow:r,fromColumn:c,toColumn:c-o}),s.moveColumns({tile:a,fromColumn:c,toColumn:c-o},e))}),n.reverse(),n.forEach(a=>{const{row:r,column:c}=a;if(a.isCaptured())return;const o=this.getEmptySpacesMiddleRight(r,c);o<1||(t.tileSwap({fromRow:r,toRow:r,fromColumn:c,toColumn:c+o}),s.moveColumns({tile:a,fromColumn:c,toColumn:c+o},e))})}tilesPutRowsMiddle(e=0){const{boardManager:t,animationManager:s}=this.scene,n=this.getTiles();n.forEach(a=>{const{row:r,column:c}=a;if(a.isCaptured())return;const o=this.getEmptySpacesMiddleAbove(r,c);o<1||(t.tileSwap({fromRow:r,toRow:r-o,fromColumn:c,toColumn:c}),s.moveRows({tile:a,fromRow:c,toRow:c-o},e))}),n.reverse(),n.forEach(a=>{const{row:r,column:c}=a;if(a.isCaptured())return;const o=this.getEmptySpacesMiddleBelow(r,c);o<1||(t.tileSwap({fromRow:r,toRow:r+o,fromColumn:c,toColumn:c}),s.moveRows({tile:a,fromRow:c,toRow:c+o},e))})}getEmptySpacesAbove(e,t,s=0){if(this.isEmptySpaceAbove(e,t)){s++;const n=e-1;return this.getEmptySpacesAbove(n,t,s)}return s}getEmptySpacesBlow(e,t,s=0){if(this.isEmptySpaceBlow(e,t)){s++;const n=e+1;return this.getEmptySpacesBlow(n,t,s)}return s}getEmptySpacesLeft(e,t,s=0){if(this.isEmptySpaceLeft(e,t)){s++;const n=t-1;return this.getEmptySpacesLeft(e,n,s)}return s}getEmptySpacesRight(e,t,s=0){if(this.isEmptySpaceRight(e,t)){s++;const n=t+1;return this.getEmptySpacesRight(e,n,s)}return s}getEmptySpacesMiddleLeft(e,t,s=0){if(this.isEmptySpaceMiddleLeft(e,t)){s++;const n=t-1;return this.getEmptySpacesMiddleLeft(e,n,s)}return s}getEmptySpacesMiddleRight(e,t,s=0){if(this.isEmptySpaceMiddleRight(e,t)){s++;const n=t+1;return this.getEmptySpacesMiddleRight(e,n,s)}return s}getEmptySpacesMiddleAbove(e,t,s=0){if(this.isEmptySpaceMiddleAbove(e,t)){s++;const n=e-1;return this.getEmptySpacesMiddleAbove(n,t,s)}return s}getEmptySpacesMiddleBelow(e,t,s=0){if(this.isEmptySpaceMiddleBelow(e,t)){s++;const n=e+1;return this.getEmptySpacesMiddleBelow(n,t,s)}return s}isEmptySpaceAbove(e,t){const s=e-1,{boardManager:n}=this.scene,{boardMap:a}=n;return!a[s]||!a[s][t]?!1:a[s][t].isCaptured()}isEmptySpaceBlow(e,t){const s=e+1,{boardManager:n}=this.scene,{boardMap:a}=n;return!a[s]||!a[s][t]?!1:a[s][t].isCaptured()}isEmptySpaceLeft(e,t){const s=t-1,{boardManager:n}=this.scene,{boardMap:a}=n;return!a[e]||!a[e][s]?!1:a[e][s].isCaptured()}isEmptySpaceRight(e,t){const s=t+1,{boardManager:n}=this.scene,{boardMap:a}=n;return!a[e]||!a[e][s]?!1:a[e][s].isCaptured()}isEmptySpaceMiddleLeft(e,t){const{columns:s}=this.scene.levelHandler.getConfigs(),n=t-1;if(n<s/2)return!1;const{boardManager:a}=this.scene,{boardMap:r}=a;return!r[e]||!r[e][n]?!1:r[e][n].isCaptured()}isEmptySpaceMiddleRight(e,t){const{columns:s}=this.scene.levelHandler.getConfigs(),n=t+1;if(n>s/2)return!1;const{boardManager:a}=this.scene,{boardMap:r}=a;return!r[e]||!r[e][n]?!1:r[e][n].isCaptured()}isEmptySpaceMiddleAbove(e,t){const{rows:s}=this.scene.levelHandler.getConfigs(),n=e-1;if(n<s/2)return!1;const{boardManager:a}=this.scene,{boardMap:r}=a;return!r[n]||!r[n][t]?!1:r[n][t].isCaptured()}isEmptySpaceMiddleBelow(e,t){const{rows:s}=this.scene.levelHandler.getConfigs(),n=e+1;if(n>s/2)return!1;const{boardManager:a}=this.scene,{boardMap:r}=a;return!r[n]||!r[n][t]?!1:r[n][t].isCaptured()}}const{FRAME:Uy}=D.GAMEPLAY,{COLORS:Fy}=W;class Yy extends Ze{constructor(e,t,s){super(e,Uy.TILE_BLUE,Fy.BLUE),this.setName("BlueTile"),this.setRow(t),this.setColumn(s)}getExplosiveAnimationKey=()=>Q.BLUE_EXPLOSIVE.KEY}const{KEY:ja,FRAME:za}=D.GAMEPLAY,{COLORS:ps,SPECIALS:Hy}=W;class $a extends Ze{effect;background;constructor(e,t,s){super(e,za.TILE_COLOR_CHANGE,Hy.COLOR_CHANGE),this.setName("ColorChangeTile"),this.setRow(t),this.setColumn(s),this.createEffect();const n=this.randomColor();this.setColor(n),this.block.off(Phaser.Animations.Events.ANIMATION_START,this.handleStartExplosive),this.block.on(Phaser.Animations.Events.ANIMATION_START,this.handleStartExplosive)}enableTile(){super.enableTile(),this.block.setVisible(!0),this.effect.setVisible(!0),this.background.setVisible(!0)}getExplosiveAnimationKey=()=>{switch(this.color){case ps.RED:return Q.RED_EXPLOSIVE.KEY;case ps.BLUE:return Q.BLUE_EXPLOSIVE.KEY;case ps.PINK:return Q.PINK_EXPLOSIVE.KEY;case ps.GREEN:return Q.GREEN_EXPLOSIVE.KEY;case ps.YELLOW:return Q.YELLOW_EXPLOSIVE.KEY;default:return Q.BLUE_EXPLOSIVE.KEY}};createEffect(){this.effect=this.scene.make.sprite({key:ja,frame:za.TILE_COLOR_CHANGE}),this.effect.anims.playReverse(Q.COLOR_CHANGE.KEY),this.effect.setWorldSize(37,37),this.effect.setRotation(1),this.scene.add.tween({repeat:-1,ease:Phaser.Math.Easing.Cubic.InOut,targets:[this.effect],duration:15e3,props:{angle:{from:0,to:360}}}),this.add(this.effect)}randomColor(){const{levelHandler:e}=this.scene,{colors:t}=e.getConfigs(),s=Phaser.Math.RND.between(0,t.length-1);return t[s]}handleStartExplosive=()=>{this.effect?.setVisible(!1),this.background?.setVisible(!1)};setColor(e){this.isCaptured()||(this.background&&this.remove(this.background,!0),this.color=e,this.background=this.scene.add.image(0,0,ja,W.FRAME[e]),this.block.setAlpha(.75),this.background.setVisible(!0),this.background.setWorldSize(36,36),this.effect.setVisible(!0),this.add(this.background),this.moveTo(this.background,0),this.moveTo(this.block,1),this.moveTo(this.effect,2))}}const{KEY:Vy,FRAME:Xa}=D.GAMEPLAY,{SPECIALS:Wy}=W;class qa extends Ze{effect;constructor(e,t,s){super(e,Xa.TILE_COLORFUL,Wy.COLORFUL),this.setName("ColorfulTile"),this.setRow(t),this.setColumn(s),this.createEffect(),this.block.once(Phaser.Animations.Events.ANIMATION_START,this.handleStartExplosive)}getExplosiveAnimationKey=()=>Q.COLORFUL_EXPLOSIVE.KEY;createEffect(){this.effect=this.scene.make.sprite({key:Vy,frame:Xa.TILE_COLORFUL}),this.effect.setWorldSize(W.SIZE,W.SIZE),this.effect.anims.play(Q.COLORFUL.KEY),this.add(this.effect)}handleStartExplosive=()=>{const{boardManager:e}=this.scene,{boardContainer:t}=e,s=t.count("visible",!0);t.moveTo(this,s-1),this.effect?.setVisible(!1)};removeTile(){super.removeTile(),this.effect?.setVisible(!0)}}class Ky extends Ze{constructor(e,t,s){super(e),this.setName("EmptyTile"),this.setRow(t),this.setColumn(s),this.setState(W.STATUS.CAPTURED),this.destroy()}}const{FRAME:jy}=D.GAMEPLAY,{COLORS:zy}=W;class $y extends Ze{constructor(e,t,s){super(e,jy.TILE_GREEN,zy.GREEN),this.setName("GreenTile"),this.setRow(t),this.setColumn(s)}getExplosiveAnimationKey=()=>Q.GREEN_EXPLOSIVE.KEY}const{FRAME:Xy}=D.GAMEPLAY,{COLORS:qy}=W;class Zy extends Ze{constructor(e,t,s){super(e,Xy.TILE_PINK,qy.PINK),this.setName("PinkTile"),this.setRow(t),this.setColumn(s)}getExplosiveAnimationKey=()=>Q.PINK_EXPLOSIVE.KEY}const{FRAME:Jy}=D.GAMEPLAY,{COLORS:Qy}=W;class eS extends Ze{constructor(e,t,s){super(e,Jy.TILE_RED,Qy.RED),this.setName("RedTile"),this.setRow(t),this.setColumn(s)}getExplosiveAnimationKey=()=>Q.RED_EXPLOSIVE.KEY}const{FRAME:tS}=D.GAMEPLAY,{COLORS:sS}=W;class iS extends Ze{constructor(e,t,s){super(e,tS.TILE_YELLOW,sS.YELLOW),this.setName("YellowTile"),this.setRow(t),this.setColumn(s)}getExplosiveAnimationKey=()=>Q.YELLOW_EXPLOSIVE.KEY}const Xn=()=>{const i=GameCore.Utils.Device,{vibrate:e}=window.navigator;return i.isAndroid()&&typeof e=="function"||i.isMobileWeb()&&typeof e=="function"||i.isIOS()},js=i=>{try{if(!Xn())return!1;const e=GameCore.Utils.Device;return(e.isAndroid()||e.isMobileWeb())&&nS(i),!0}catch{return!1}},nS=i=>{window.navigator.vibrate(0),window.navigator.vibrate(i)},{STATUS:zi}=is,{RED:aS,BLUE:rS,PINK:oS,GREEN:cS,YELLOW:lS}=W.COLORS,{FREEZE:Za,COLORFUL:Ja,COLOR_CHANGE:hS}=W.SPECIALS,{Gameplay:uS}=GameCore.Configs;class dS extends dt{scene;isSelectable=!1;isUseableItem=!1;isEndBoard=!1;tilesHighlight=[];suggestionsDelay=5e3;suggestionsTimer;freezeCheckTimer;delayEnableItemTimer;tilesGroup;scoreTextGroup;constructor(e){super(e),this.scene=e,this.createGroup()}init(){this.isSelectable=!1,this.isUseableItem=!1,this.hideTexts(),this.removeSuggestionsTiles(),this.clearTiles(),this.setState(zi.READY)}start(){this.isRunning()||(this.isSelectable=!1,this.isUseableItem=!1,this.showUpTilesAnimation(),this.setState(zi.RUNNING))}stop(){this.isRunning()&&(this.isSelectable=!1,this.isUseableItem=!1,this.hideTexts(),this.removeSuggestionsTiles(),this.setState(zi.STOPPED))}createGroup(){this.scoreTextGroup=this.scene.add.group(),this.tilesGroup=this.scene.make.group({active:!1,runChildUpdate:!1})}hideTexts(){this.scoreTextGroup.setVisible(!1);const e=this.scoreTextGroup.getChildren();this.scene.tweens.killTweensOf(e)}getTiles(){return!this.scene||!this.tilesGroup?.scene?[]:this.tilesGroup.getMatching("visible",!0)}clearTiles(){const{boardManager:e}=this.scene;this.tilesGroup&&this.tilesGroup.children.each(t=>{t.setVisible(!1),this.tilesGroup.killAndHide(t),e.boardContainer.remove(t),t.destroy()})}getTileExits(e){const t=this.tilesGroup.getMatching("tileType",e);return t.length<1?null:t.find(s=>s.visible===!1)||null}createTileByType(e,t,s){const n=this.getTileExits(e);if(n)return n.enableTile(),n.setRow(t),n.setColumn(s),n;switch(e){case aS:return new eS(this.scene,t,s);case oS:return new Zy(this.scene,t,s);case rS:return new Yy(this.scene,t,s);case cS:return new $y(this.scene,t,s);case lS:return new iS(this.scene,t,s);case Za:return new ot(this.scene,t,s);case Ja:return new qa(this.scene,t,s);case hS:return new $a(this.scene,t,s);default:return new Ky(this.scene,t,s)}}addTile(e){this.tilesGroup.add(e),this.addEventsTile(e)}addEventsTile=e=>{e.block&&(e.block.setInteractive({useHandCursor:!0}),e.block.off(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN),e.block.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.tileSelect(e)),e.createInput())};tileCapture(e){e.setState(W.STATUS.CAPTURED)}removeTile(e){if(!e)return;const{boardManager:t}=this.scene,{boardContainer:s,tileMap:n}=t,{row:a,column:r}=e;n[a]&&n[a][r]&&(n[a][r]="?"),e.setVisible(!1),s.remove(e),this.tilesGroup.killAndHide(e)}showUpTilesAnimation(){const e=[...this.getTiles()];e.reverse();const{animationManager:t}=this.scene;t.startBoard(e).once(Phaser.Tweens.Events.TWEEN_COMPLETE,()=>{this.scene.tweens.killTweensOf(e),e.forEach(n=>{n.setAlpha(1)}),this.suggestionsEatableTiles(),this.isSelectable=!0,this.isUseableItem=!0,this.scene.events.emit(Ae.GEMS_DROPPED)})}isCanMove(){if(!this.isRunning())return!1;let e=!0;if(this.tilesGroup.countActive()<1)return!1;const t=this.getTiles();for(const s of t){if(s.isCaptured())continue;if(this.getTilesSameColor(s).length>1){e=!1;break}}return!e}processNextLevel(){const e=this.getTiles(),t=[];for(const s of e)s.isCaptured()||t.push(s);this.isEndBoard=!0,this.scene.time.addEvent({delay:800,callback:()=>{if(t.length<=0){this.scene.runBonusScoreAnimation(2e3),X.emit(ue.REACH_SCORE.EVENTS.ADD_SCORE,{type:"score",value:2e3}),this.scene.time.addEvent({delay:1400,callback:()=>{this.isEndBoard=!1,this.scene.levelUp()}});return}const{animationManager:s}=this.scene,n=s.endBoard(t);t.length<10&&t.length>0&&X.emit(ue.REACH_SCORE.EVENTS.ADD_SCORE,{type:"score",value:2e3-200*t.length}),n.once(Phaser.Tweens.Events.TWEEN_COMPLETE,()=>{t.forEach(a=>{this.tileCapture(a),this.removeTile(a)}),this.scene.time.addEvent({delay:600,callback:()=>{this.isEndBoard=!1,this.scene.levelUp()}})})}})}getTilesCanCapture(){const{levelHandler:e}=this.scene,{eatableSize:t}=e.getConfigs(),s=[];for(const n of this.getTiles()){if(n.isCaptured())continue;const a=this.getTilesSameColor(n);a.length<t||s.push(a)}return s}getBoundOfTiles(e){const{displayWidth:t,displayHeight:s}=this.scene.gameZone;let n=t,a=s,r=10,c=1,o=10,l=1,h=W.SIZE,d=W.SIZE;e.forEach(f=>{const{x:E,y:S,row:I,column:T}=f;E<n&&(n=E),S<a&&(a=S),I<r&&(r=I),I>c&&(c=I),T<o&&(o=T),T>l&&(l=T)}),h*=l-o+1,d*=c-r+1;const u=2;h+=u,d+=u,n=(o-1)*W.SIZE+u;const{levelHandler:p}=this.scene,m=p.getConfigs(),{rows:g}=m,y=this.scene.ads.getBannerHeight()+18;return a=s-y-(g-r+1)*W.SIZE,{x:n,y:a,width:h,height:d}}suggestionsEatableTiles(){this.suggestionsTimer?.remove(),this.removeSuggestionsTiles();const{levelHandler:e}=this.scene,{eatableSize:t}=e.getConfigs();this.suggestionsTimer=this.scene.time.addEvent({delay:this.suggestionsDelay,callback:()=>{if(!this.isRunning())return;this.removeSuggestionsTiles();const s=this.getTilesCanCapture();if(s.length<1)return;const n=Phaser.Math.RND.between(0,s.length-1);this.tilesHighlight=s[n],!(this.tilesHighlight.length<t)&&this.showHighlightTiles(this.tilesHighlight)}})}removeSuggestionsTiles(){this.tilesHighlight.length<1||(this.hideHighlightTiles(this.tilesHighlight),this.tilesHighlight=[])}showHighlightTiles(e){e.forEach(t=>{t.showHighlight()})}hideHighlightTiles(e){e.forEach(t=>{t.hideHighlight()})}tileSelect=e=>()=>{const{itemManager:t,missionsManager:s}=this.scene;if(!this.isSelectable||(this.removeSuggestionsTiles(),t.itemActive!==""&&t.applyItem(e)))return;let n=[];const{color:a}=e;let r=-1;switch(a){case Ja:r=10,n=this.getTilesAround(e,1,1);break;case Za:break;default:n=this.captureTilesSameColor(e)}if(n.length<1){this.scene.audio.playSound(K.MOVE_WRONG),this.suggestionsEatableTiles();return}this.tilesCapturing(n,!0,r,200),this.startVibrate(n.length),s.updateMission(he.TYPES.COMBO,a,n.length),s.updateMission(he.TYPES.COLLECT_GEMS,a,n.length)};captureTilesSameColor(e){const{levelHandler:t}=this.scene,s=this.getTilesSameColor(e),{eatableSize:n}=t.getConfigs();return s.length<n?[]:s}getTilesSameColor(e){const t=[],{color:s,row:n,column:a}=e;return this.findTilesSameColor(n,a,s,t),t}findTilesSameColor(e,t,s,n){const{boardManager:a,levelHandler:r}=this.scene,c=r.getConfigs(),{rows:o,columns:l}=c;if(e<1||t<1||e>o||t>l)return;const h=a.boardMap[e][t];h.isCaptured()||this.isSameColor(s,h)&&(n.indexOf(h)>=0||(n.push(h),this.findTilesSameColor(e-1,t,s,n),this.findTilesSameColor(e,t+1,s,n),this.findTilesSameColor(e+1,t,s,n),this.findTilesSameColor(e,t-1,s,n)))}isSameColor(e,t){const s=e===t.color,n=t instanceof qa,a=t instanceof ot;return s&&!a||n}getTilesAround(e,t,s){const n=[],{row:a,column:r}=e,c=a+t,o=r+s,l=a-t,h=r-s;return this.findTilesAround({row:a,column:r,maxRow:c,maxColumn:o,minRow:l,minColumn:h},n),n}findTilesAround(e,t){const{boardManager:s}=this.scene,{boardMap:n}=s,{row:a,column:r,maxRow:c,maxColumn:o,minRow:l,minColumn:h}=e;if(!n[a]||!n[a][r]||a<l||r<h||a>c||r>o)return;const d=n[a][r];d.isCaptured()||t.indexOf(d)>=0||(t.push(d),this.findTilesAround({...e,row:a-1},t),this.findTilesAround({...e,column:r+1},t),this.findTilesAround({...e,row:a+1},t),this.findTilesAround({...e,column:r-1},t))}tilesChangeColor(e,t){const{boardManager:s}=this.scene;t.forEach(n=>{const{row:a,column:r,x:c,y:o}=n,l=this.createTileByType(e,a,r);s.setTileToMap(l,a,r),l.setX(c),l.setY(o),this.removeTile(n)})}updateColorChangeTiles(e){const{levelHandler:t}=this.scene,{colors:s,specials:n}=t.getConfigs();let a=e;if(n[e]){const c=Phaser.Math.RND.between(0,s.length-1);a=s[c]}this.getTiles().forEach(c=>{c instanceof $a&&c.setColor(a)})}updateFreezeTiles(e=!1){const{levelHandler:t,animationManager:s}=this.scene,{rows:n}=t.getConfigs();this.freezeCheckTimer?.remove(),this.freezeCheckTimer=this.scene.time.addEvent({delay:s.moveDuration,callback:()=>{if(!this.isRunning())return;const a=this.getTiles(),r=[];if(a.forEach(c=>{c instanceof ot&&(c.isCaptured()||c.row<n&&c.row>1||r.push(c))}),r.length<1){e&&!this.isEndBoard&&this.processNextLevel();return}e&&(this.isSelectable=!0),this.tilesCapturing(r,!1,100),this.isSelectable=!1}})}tilesCapturing(e,t=!0,s=-1,n=0,a=!1){if(!this.isSelectable&&!a)return;this.isSelectable=!1,this.isUseableItem=!1,this.delayEnableItemTimer?.remove();const{modeManager:r,animationManager:c,levelHandler:o}=this.scene,{scorePerItem:l}=o.getConfigs(),h=e.length;let d=l*h;s>-1&&(d=s),e.forEach(p=>{this.tileCapture(p),p.setEatScore(d)});const u=c.capturing(e,300,t);u.callback=()=>{if(this.updateAfterMoved(e),!this.isCanMove()){this.updateFreezeTiles(!0);return}this.updateFreezeTiles(),this.suggestionsEatableTiles(),this.isSelectable=!0,this.delayEnableItemTimer=this.scene.time.addEvent({delay:300,callback:()=>{this.isUseableItem=!0,this.scene.events.emit(Ae.GEMS_EAT)}})},this.scene.time.addEvent({delay:1e3,callback:()=>{this.showEncouragingText(h)}}),this.scene.time.addEvent({delay:100*e.length-1+n,callback:()=>{if(r.applyMode(),e.length>1){const p=e[0];if(!p)return;const m=d*h,{x:g,y}=p;this.scene.runTotalScoreAnimation(m,g,y)}}})}showEncouragingText(e){if(!(e<=4)){if(e<=6){this.scene.runEncouragingAnimation(xe.COOL);return}if(e<=8){this.scene.runEncouragingAnimation(xe.GOOD);return}if(e<=9){this.scene.runEncouragingAnimation(xe.GREAT);return}if(e>9){this.scene.runEncouragingAnimation(xe.TEXT_EXCELLENT);return}}}startVibrate(e){try{if(!uS.EnableVibrate||e<=4)return;const{player:t}=this.scene;if(!t.getPlayerSetting("vibrate"))return;if(e<=6){js(340);return}if(e<=8){js(410);return}if(e<=9){js(480);return}if(e>9){js(600);return}}catch(t){j(t)}}updateAfterMoved=e=>{if(!this.scene||e[0]instanceof ot)return;const t=e[0]?.color;this.updateColorChangeTiles(t)}}const{KEY:Qa,FRAME:er}=D.TUTORIAL;class pS extends Phaser.GameObjects.Container{theCat;popover;description;constructor(e){super(e),this.name="PopoverTutorial",this.createAvatarCat(),this.createPopover(),this.createDescription(),this.scene.add.existing(this)}createAvatarCat(){this.theCat=this.scene.make.image({key:Qa,frame:er.AVATAR_CAT,origin:{x:.95,y:0}}),this.theCat.setWorldSize(126,126.5),this.add(this.theCat)}createPopover(){this.popover=this.scene.make.image({key:Qa,frame:er.POPUP_TALK,origin:{x:0,y:0}}),this.popover.setWorldSize(219.5,124),this.add(this.popover)}createDescription(){this.description=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(20)}),this.description.setTint(11632977),this.description.setCenterAlign(),this.add(this.description)}updateData(e,t){this.theCat.setVisible(!0),this.popover.setVisible(!0),this.description.setText(t),this.description.setVisible(!0),this.description.setMaxWidth(e),Phaser.Display.Align.In.Center(this.description,this.popover,15,-5)}playAnimation(e=0){this.setAlpha(0),this.scene?.tweens.add({delay:e,targets:this,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1})}stopAnimation(){this.scene.tweens.killTweensOf(this)}preDestroy(){this.scene.tweens.killTweensOf(this)}}class mS{manager;constructor(e){this.manager=e}setup(){this.loadCustomBoard(),this.manager.scene.events.once(Ae.GEMS_DROPPED,this.startGuideFirstFeature)}loadCustomBoard(){const{boardManager:e}=this.manager.scene;e.loadBoardByFen(":P2GRYPBRPR:2P2G2YPGBG:BGYBRC2PYB:YRYBGBGP2Y:P2YP3YRBG:YBG2RPGPRP:3GBRBRCRP:3RPG2BGYR:PBY2P3RPY:RPYG2YBGBP")}startGuideFirstFeature=()=>{const{boardManager:e,tileManager:t}=this.manager.scene;t.isSelectable=!1,t.isUseableItem=!1;const s=e.getTileByIndex(14),n=e.getTileByIndex(36);this.createHighlightTiles([s,n]),this.createDescription([s,n],{text:"Rainbow gem can clear the gems surrounding it",popoverWidth:160});const a=e.getTileByIndex(25);this.createHandAtTile(a),a.block.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.handleUseGem(a))};createHandAtTile(e){const t=e.getWorldTransformMatrix(),{translateX:s,translateY:n}=t.decomposeMatrix(),a=s+W.SIZE/2,r=n+W.SIZE/2;this.manager.hand.setPosition(a,r),this.manager.hand.revive(),this.manager.hand.stopAnimation(),this.manager.hand.playAnimation(300)}createHighlightTiles(e){const{tileManager:t}=this.manager.scene,{x:s,y:n,width:a,height:r}=t.getBoundOfTiles(e);this.manager.createMask(s,n,a,r)}createDescription(e,t){const{scene:s}=this.manager,{tileManager:n}=s,{text:a,popoverWidth:r}=t;this.manager.popover.updateData(r,a);const{y:c,height:o}=n.getBoundOfTiles(e);this.manager.popover.setY(c-80-o),this.manager.popover.revive(),this.manager.popover.stopAnimation(),this.manager.popover.playAnimation(300)}handleUseGem=e=>()=>{this.manager.hand.kill(),this.manager.popover.kill(),this.manager.background.kill();const{tileManager:t}=this.manager.scene;t.isSelectable=!0,t.tileSelect(e)()}}class gS{manager;constructor(e){this.manager=e}setup(){const{tileManager:e}=this.manager.scene;e.isSelectable=!1,e.isUseableItem=!1,this.createHighlight(),this.createDescription(),this.manager.background.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.handleOnCloseTutorial)}createHighlight(){this.manager.createMask(146,-3,85,85,40)}createDescription(){const{scene:e}=this.manager,t=this.manager.scene.lang.Text.GUIDE_2_SCORE;this.manager.popover.updateData(140,t);const{objects:s}=e.layoutManager,{currentScoreBar:n}=s.header.topBar,{y:a}=n.getWorldPosition();this.manager.popover.setY(a+60),this.manager.popover.setActive(!0),this.manager.popover.setVisible(!0),this.manager.popover.stopAnimation(),this.manager.popover.playAnimation(300)}handleOnCloseTutorial=()=>{this.manager.stopTutorial();const{tileManager:e}=this.manager.scene;e.isSelectable=!0,e.isUseableItem=!0,this.manager.startTutorial(oe.TARGET_SCORE).then(t=>{t||this.manager.stopTutorial()})}}class fS{manager;constructor(e){this.manager=e}setup(){const{scene:e}=this.manager,{tileManager:t,levelHandler:s}=e,n=t.getTilesCanCapture();if(n.length<1){this.manager.stop();return}const a=Object.values(W.SPECIALS),{eatableSize:r}=s.getConfigs(),o=n.filter(l=>!l.find(h=>a.indexOf(h.color)>=0)).sort((l,h)=>h.length-l.length)[0];if(o?.length<r){this.manager.stop();return}t.isSelectable=!1,t.isUseableItem=!1,t.suggestionsTimer?.remove(),t.showHighlightTiles(o),this.createHighlightTiles(o),this.createHandAtCenterTitles(o),this.manager.displayCount(oe.FIRST_MOVE)<1&&this.createDescription(o),o.forEach(l=>{l.block.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,()=>{o.forEach(h=>{h.block.off(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN)}),this.handleOnTileClicked(l)})})}createHighlightTiles(e){const{tileManager:t}=this.manager.scene,{x:s,y:n,width:a,height:r}=t.getBoundOfTiles(e);this.manager.createMask(s,n,a,r)}createHandAtCenterTitles(e){e.sort((o,l)=>o.row-l.row+o.column-l.column);const t=Math.floor(e.length/2),s=e[t],{x:n,y:a}=s.getWorldPosition(),r=n+W.SIZE/2,c=a+W.SIZE/2;this.manager.hand.setPosition(r,c),this.manager.hand.revive(),this.manager.hand.stopAnimation(),this.manager.hand.playAnimation(300)}createDescription(e){const t=this.manager.scene.lang.Text.GUIDE_1_TAP;this.manager.popover.updateData(170,t);const{tileManager:s}=this.manager.scene,{y:n,height:a}=s.getBoundOfTiles(e);this.manager.popover.setY(n-100-a),this.manager.popover.y<0&&this.manager.popover.setY(5),this.manager.popover.revive(),this.manager.popover.stopAnimation(),this.manager.popover.playAnimation(300)}handleOnTileClicked=e=>{const{manager:t}=this,{tileManager:s}=t.scene;s.isSelectable=!0,s.tileSelect(e)(),t.hand.kill(),t.popover.kill(),t.stopTutorial()}}class ES{manager;constructor(e){this.manager=e}setup(){this.loadCustomBoard(),this.manager.scene.events.once(Ae.GEMS_DROPPED,this.startGuide)}loadCustomBoard(){const{boardManager:e}=this.manager.scene;e.loadBoardByFen(":BGPY3BYGY:B2PYBYRYGY:BYBYRB2PGB:2YB5RYP:2GB5RYG:PGYB3RBYG:BRGYGRYBGB:2GBP2G2PCB:GYCBPGYGPY:BPY2BPRPGP")}startGuide=()=>{const{scene:e}=this.manager,{tileManager:t,layoutManager:s,currentDiamond:n}=e,{hammerItem:a}=s.objects;t.isSelectable=!1,t.isUseableItem=!1,this.createHighlightItem(),this.createHandAtItem(),this.createDescription(),n<a.value&&e.eatDiamond(a.value),a.once(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,this.handleOnUseItem)};createHighlightItem(){const{layoutManager:e}=this.manager.scene,{hammerItem:t}=e.objects,{x:s,y:n}=t;this.manager.createMask(s-30,n-30,60,70)}createHandAtItem(){const{layoutManager:e}=this.manager.scene,{hammerItem:t}=e.objects,{x:s,y:n}=t;this.manager.hand.setPosition(s+20,n+20),this.manager.hand.revive(),this.manager.hand.stopAnimation(),this.manager.hand.playAnimation(300)}createDescription(){const{layoutManager:e}=this.manager.scene,{hammerItem:t}=e.objects,s=160,n="This is a Hammer, use it to smash any gem!";this.manager.popover.updateData(s,n),this.manager.popover.setY(t.y+55),this.manager.popover.revive(),this.manager.popover.stopAnimation(),this.manager.popover.playAnimation(300)}handleOnUseItem=()=>{const{boardManager:e,tileManager:t}=this.manager.scene,s=e.getTileByIndex(26);if(!s){this.manager.stop();return}if(t.getTilesCanCapture().filter(r=>r.find(c=>c.color===W.COLORS.RED)).length<1){this.manager.stopTutorial();return}this.manager.popover.kill(),this.createHandAtTile(s),this.manager.background.setVisible(!1),s.block.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.handleUseHammer(s))};createHandAtTile(e){const t=e.getWorldTransformMatrix(),{translateX:s,translateY:n}=t.decomposeMatrix(),a=s+W.SIZE/2,r=n+W.SIZE/2;this.manager.hand.setPosition(a,r),this.manager.hand.revive(),this.manager.hand.stopAnimation(),this.manager.hand.playAnimation(300)}handleUseHammer=e=>()=>{const{itemManager:t}=this.manager.scene;t.applyItem(e),this.manager.hand.kill(),this.closeTutorial()};closeTutorial=()=>{this.manager.stopTutorial()}}class yS{manager;constructor(e){this.manager=e}setup(){this.loadCustomBoard(),this.manager.scene.events.once(Ae.GEMS_DROPPED,this.startGuide)}loadCustomBoard(){const{boardManager:e}=this.manager.scene;e.loadBoardByFen(":PRPRBGRYRP:PBRY2BR2GB:GPRB2RGBGR:2GP3YBPBP:GBP3Y2RPB:RGR3YGRPR:YBG4YGYG:PYBGRPBRPG:PBRYGRBGBR:BGR2GPBRBP")}startGuide=()=>{const{scene:e}=this.manager,{tileManager:t,layoutManager:s,currentDiamond:n}=e,{paintItem:a}=s.objects;t.isSelectable=!1,t.isUseableItem=!1,this.createHighlightItem(),this.createHandAtItem(),this.createDescription(),n<a.value&&e.eatDiamond(a.value),a.once(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,this.handleOnUseItem)};createHighlightItem(){const{layoutManager:e}=this.manager.scene,{paintItem:t}=e.objects,{x:s,y:n}=t;this.manager.createMask(s-30,n-30,60,70)}createHandAtItem(){const{layoutManager:e}=this.manager.scene,{paintItem:t}=e.objects,{x:s,y:n}=t;this.manager.hand.setPosition(s+20,n+20),this.manager.hand.setActive(!0),this.manager.hand.setVisible(!0),this.manager.hand.stopAnimation(),this.manager.hand.playAnimation(300)}createDescription(){const{layoutManager:e}=this.manager.scene,{paintItem:t}=e.objects,s="This is a Magic bottle, use it to change a gem colour";this.manager.popover.updateData(160,s),this.manager.popover.setY(t.y+55),this.manager.popover.revive(),this.manager.popover.stopAnimation(),this.manager.popover.playAnimation(300)}handleOnUseItem=()=>{const{tileManager:e,boardManager:t}=this.manager.scene;if(e.getTilesCanCapture().filter(r=>r.find(c=>c.color===W.COLORS.YELLOW))?.length<1){this.manager.stop();return}this.manager.popover.kill(),this.manager.background.kill();const a=t.getTileByIndex(45);this.createHandAtTile(a),a.block.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.handleUsePaint(a))};createHandAtTile(e){const t=e.getWorldTransformMatrix(),{translateX:s,translateY:n}=t.decomposeMatrix(),a=s+W.SIZE/2,r=n+W.SIZE/2;this.manager.hand.setPosition(a,r),this.manager.hand.revive(),this.manager.hand.stopAnimation(),this.manager.hand.playAnimation(300)}handleUsePaint=e=>()=>{const{itemManager:t}=this.manager.scene;t.applyItem(e),this.manager.hand.kill(),this.closeTutorial()};closeTutorial(){this.manager.stopTutorial()}}class SS{manager;constructor(e){this.manager=e}setup(){this.loadCustomBoard(),this.manager.scene.events.once(Ae.SETUP_COMPLETED,this.disableUseItem),this.manager.scene.events.once(Ae.GEMS_DROPPED,this.startGuide)}loadCustomBoard(){const{boardManager:e}=this.manager.scene;e.loadBoardByFen(":BPBPRBPRGB:PYGBGRYGRG:YGYPBCBRGY:PRBGRYGPBG:YGPRPRBRGR:GRGCGBRBYB:RPYGBRBPGY:GRGYPBGYPB:YPBGYGYGRP:RGRBPBPRYB")}disableUseItem=()=>{this.manager.tutorialId="";const{tileManager:e}=this.manager.scene;e.isSelectable=!1,e.isUseableItem=!1};startGuide=()=>{const{scene:e}=this.manager,{tileManager:t,layoutManager:s,currentDiamond:n}=e,{shuffleItem:a}=s.objects;this.manager.tutorialId=oe.ITEM_SHUFFLE,t.isSelectable=!1,t.isUseableItem=!1,this.createHighlight(),this.createHandAtItem(),this.createDescription(),n<a.value&&e.eatDiamond(a.value),a.once(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,this.handleOnUseItem)};createHighlight(){const{layoutManager:e}=this.manager.scene,{shuffleItem:t}=e.objects,{x:s,y:n}=t;this.manager.createMask(s-30,n-30,60,70)}createHandAtItem(){const{layoutManager:e}=this.manager.scene,{shuffleItem:t}=e.objects,{x:s,y:n}=t;this.manager.hand.setPosition(s+20,n+20),this.manager.hand.revive(),this.manager.hand.stopAnimation(),this.manager.hand.playAnimation(300)}createDescription(){const{layoutManager:e}=this.manager.scene,{shuffleItem:t}=e.objects,s="This is a Shuffle tile, use it to shuffle all gems";this.manager.popover.updateData(160,s),this.manager.popover.setY(t.y+55),this.manager.popover.revive(),this.manager.popover.stopAnimation(),this.manager.popover.playAnimation(300)}handleOnUseItem=()=>{this.manager.hand.kill(),this.manager.popover.kill(),this.manager.stopTutorial()}}class AS{manager;constructor(e){this.manager=e}setup(){const{tileManager:e}=this.manager.scene;e.isSelectable=!1,e.isUseableItem=!1,this.createHighlight(),this.createDescription(),this.manager.background.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.handleOnCloseTutorial)}createHighlight(){this.manager.createMask(50,0,95,50)}createDescription(){const{scene:e}=this.manager,t=this.manager.scene.lang.Text.GUIDE_3_TARGET_SCORE;this.manager.popover.updateData(170,t);const{objects:s}=e.layoutManager,{targetScoreBar:n}=s.header.topBar,{y:a}=n.getWorldPosition();this.manager.popover.setY(a+30),this.manager.popover.setActive(!0),this.manager.popover.setVisible(!0),this.manager.popover.stopAnimation(),this.manager.popover.playAnimation(300)}handleOnCloseTutorial=()=>{this.manager.stopTutorial();const{tileManager:e}=this.manager.scene;e.isSelectable=!0,e.isUseableItem=!0,this.manager.startTutorial(oe.FIRST_MOVE).then(t=>{t||this.manager.stopTutorial()})}}const{STATUS:$i}=is,{KEY:TS,FRAME:IS}=D.TUTORIAL,{Tutorial:zs}=GameCore.Configs;class bS extends dt{scene;tutorialId;tutorialsDisplayed=[];hand;popover;background;maskGraphics;tutFirstMove;tutTargetScore;tutCurrentScore;tutColorfulGem;tutItemPaint;tutItemHammer;tutItemShuffle;constructor(e){super(e),this.scene=e,this.createBackground(),this.createHand(),this.createPopover()}init(){this.hand.kill(),this.popover.kill(),this.background.kill(),this.removeEvents(),this.setState($i.READY)}start(){this.isRunning()||!this.isValidForTutorial()&&!zs.ForceUseTutorial||(this.scene.player.incUserGuideDisplays(),this.setState($i.RUNNING),this.listenEvents(),this.scene.events.emit(Ae.START))}stop(){this.isRunning()&&(this.removeEvents(),this.scene.tweens.killTweensOf([this.background,this.hand]),this.setState($i.STOPPED))}displayCount(e){return this.tutorialsDisplayed.filter(s=>s===e).length}hasDisplayedEnough(e){if(!GameCore.Utils.Object.hasOwn(zs.NumberOfTutorial,e))return!0;const t=zs.NumberOfTutorial[e];return GameCore.Utils.Valid.isNumber(t)?this.displayCount(e)>=t:!0}isNothingToDisplay(){return Object.keys(zs.NumberOfTutorial).filter(t=>!this.hasDisplayedEnough(t)).length<1}listenEvents(){this.scene.events.on(Ae.START,this.showTutorialWhenStart),this.scene.events.on(Ae.GEMS_EAT,this.showTutorialWhenGemsMove),this.scene.events.on(Ae.GEMS_DROPPED,this.showTutorialWhenGemsDropped)}removeEvents(){this.scene.events.off(Ae.START,this.showTutorialWhenStart),this.scene.events.off(Ae.GEMS_EAT,this.showTutorialWhenGemsMove),this.scene.events.off(Ae.GEMS_DROPPED,this.showTutorialWhenGemsDropped)}showTutorialWhenStart=()=>{const{levelHandler:e}=this.scene;e.level===1&&this.scene.analytics.event(z.TUTORIAL_BEGIN),e.level===2&&this.startTutorial(oe.COLORFUL_GEM),e.level===3&&this.startTutorial(oe.ITEM_HAMMER),e.level===4&&this.startTutorial(oe.ITEM_SHUFFLE),e.level===5&&this.startTutorial(oe.ITEM_PAINT)};showTutorialWhenGemsDropped=()=>{const{levelHandler:e}=this.scene;e.level===1&&this.startTutorial(oe.FIRST_MOVE)};showTutorialWhenGemsMove=()=>{const{levelHandler:e}=this.scene;e.level===1&&this.startTutorial(oe.CURRENT_SCORE).then(t=>{t||this.startTutorial(oe.FIRST_MOVE).then(s=>{s||this.stopTutorial()})})};startTutorial=async e=>{if(!this.isRunning()||this.isNothingToDisplay()||this.hasDisplayedEnough(e))return!1;switch(this.background.kill(),e){case oe.FIRST_MOVE:this.tutFirstMove=new fS(this),this.tutFirstMove.setup();break;case oe.CURRENT_SCORE:this.tutCurrentScore=new gS(this),this.tutCurrentScore.setup();break;case oe.TARGET_SCORE:this.tutTargetScore=new AS(this),this.tutTargetScore.setup();break;case oe.COLORFUL_GEM:this.tutColorfulGem=new mS(this),this.tutColorfulGem.setup();break;case oe.ITEM_PAINT:this.tutItemPaint=new yS(this),this.tutItemPaint.setup();break;case oe.ITEM_HAMMER:this.tutItemHammer=new ES(this),this.tutItemHammer.setup();break;case oe.ITEM_SHUFFLE:this.tutItemShuffle=new SS(this),this.tutItemShuffle.setup();break;default:return!1}return this.isRunning()?(this.tutorialId=e,this.tutorialsDisplayed.push(this.tutorialId),this.scene.events.emit(Ae.SETUP_COMPLETED),this.scene.analytics.event(z.TUTORIAL_STEP,{step:this.tutorialId}),!0):!1};stopTutorial(){this.tutorialId="",this.hand.kill(),this.popover.kill(),this.background.kill(),this.isNothingToDisplay()&&this.scene.analytics.event(z.TUTORIAL_COMPLETE)}isValidForTutorial(){const{game:e}=this.scene;return e.player.getPlayer().isUserNew}createHand(){this.hand=new Hc(this.scene),this.hand.kill(),this.hand.setDepth(Y.PRIORITY)}createPopover(){this.popover=new pS(this.scene),this.popover.kill(),this.popover.setDepth(Y.PRIORITY),Phaser.Display.Align.In.Center(this.popover,this.scene.gameZone,-50,-150)}createBackground(){this.background=this.scene.make.image({key:TS,frame:IS.BLANK}),this.background.setInteractive({}),this.scene.input.setTopOnly(!1),this.background.setTint(0),this.background.setAlpha(.8),this.background.setDepth(Y.PRIORITY);const{displayWidth:e,displayHeight:t}=this.scene.gameZone,s=e+100,n=t+100;this.background.setDisplaySize(s,n),Phaser.Display.Align.In.Center(this.background,this.scene.gameZone)}createMask(e,t,s,n,a=10){this.maskGraphics?.destroy(),this.maskGraphics=this.scene.make.graphics({fillStyle:{color:16711680,alpha:1}}),this.maskGraphics.setName("MaskGraphics"),this.maskGraphics.fillRoundedRect(e,t,s,n,a),this.background.revive(),this.background.clearMask(!0),this.background.setMask(this.maskGraphics.createGeometryMask()),this.background.mask.invertAlpha=!0,this.runShowMaskAnimation()}runShowMaskAnimation(){const e=[this.background];this.background.setAlpha(0),this.scene.tweens.killTweensOf(e),this.scene.tweens.add({targets:e,duration:300,ease:Phaser.Math.Easing.Quadratic.Out,props:{alpha:{from:0,to:.8}}})}}const wS={targets:[],duration:600,ease:Phaser.Math.Easing.Back.Out,props:{y:{from:250,to:0},scale:{from:.9,to:1},alpha:{start:0,from:0,to:1}}};class ks extends Ee{constructor(e){super(wS,e)}}const{KEY:Ve,FRAME:We}=D.DEFAULT;class Je extends Phaser.GameObjects.Container{barTopLeft;barTopMid;barTopRight;barMidLeft;barMidBg;barMidRight;barBottomLeft;barBottomMid;barBottomRight;constructor(e,t,s,n,a){super(e,t,s),this.setSize(n,a),this.setDepth(Y.POPUP),this.createPopup(),this.scene.add.existing(this)}set onClose(e){this.setInteractive({useHandCursor:!0}),this.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,e)}createPopup(){this.createPopupImages(),this.updatePopupSize(),this.alignPopupImages()}createPopupImages(){this.barTopLeft=this.scene.add.image(0,0,Ve,We.POPUP_TOP_LEFT),this.barTopMid=this.scene.add.image(0,0,Ve,We.POPUP_TOP_MID),this.barTopRight=this.scene.add.image(0,0,Ve,We.POPUP_TOP_RIGHT),this.barMidLeft=this.scene.add.image(0,0,Ve,We.POPUP_MID_LEFT),this.barMidBg=this.scene.add.image(0,0,Ve,We.POPUP_MID_MID),this.barMidRight=this.scene.add.image(0,0,Ve,We.POPUP_MID_RIGHT),this.barBottomLeft=this.scene.add.image(0,0,Ve,We.POPUP_BOTTOM_LEFT),this.barBottomMid=this.scene.add.image(0,0,Ve,We.POPUP_BOTTOM_MID),this.barBottomRight=this.scene.add.image(0,0,Ve,We.POPUP_BOTTOM_RIGHT),this.barTopLeft.setWorldSize(65,48),this.barTopMid.setWorldSize(65,48),this.barTopRight.setWorldSize(65,48),this.barMidLeft.setWorldSize(65,48),this.barMidBg.setWorldSize(65,48),this.barMidRight.setWorldSize(65,48),this.barBottomLeft.setWorldSize(65,48),this.barBottomMid.setWorldSize(65,48),this.barBottomRight.setWorldSize(65,48),this.add([this.barTopRight,this.barTopMid,this.barBottomLeft,this.barBottomRight,this.barMidLeft,this.barMidRight,this.barTopLeft,this.barBottomMid,this.barMidBg])}updatePopupSize(){this.barTopMid.setWorldSize(this.width-129,this.barTopMid.height),this.barMidLeft.setWorldSize(this.barMidLeft.width,this.height-95),this.barMidBg.setWorldSize(this.width-129,this.height-95),this.barMidRight.setWorldSize(this.barMidRight.width,this.height-95),this.barBottomMid.setWorldSize(this.width-129,this.barBottomMid.height)}alignPopupImages(){Phaser.Display.Align.In.TopLeft(this.barTopLeft,this),Phaser.Display.Align.In.TopCenter(this.barTopMid,this),Phaser.Display.Align.In.TopRight(this.barTopRight,this),Phaser.Display.Align.In.LeftCenter(this.barMidLeft,this),Phaser.Display.Align.In.Center(this.barMidBg,this),Phaser.Display.Align.In.RightCenter(this.barMidRight,this),Phaser.Display.Align.In.BottomLeft(this.barBottomLeft,this),Phaser.Display.Align.In.BottomCenter(this.barBottomMid,this),Phaser.Display.Align.In.BottomRight(this.barBottomRight,this)}}const{KEY:tr}=D.DEFAULT;class Ft extends ee{options;icon;constructor(e,t){super(e,tr,t.backgroundOn),this.options=t,this.createIcon()}processCallback(e){const{enable:t}=this.options;this.updateStatus(!t),e(!t)}updateStatus(e){this.options.enable=e;const t=this.getFrameByStatus();this.icon.setFrame(t);const s=this.getBackgroundByStatus();this.button.setFrame(s)}getFrameByStatus=()=>{const{enable:e,frameOn:t,frameOff:s}=this.options;return e?t:s};getBackgroundByStatus=()=>{const{enable:e,backgroundOn:t,backgroundOff:s}=this.options;return e?t:s};createButton=e=>{const t=this.getBackgroundByStatus();this.button=this.scene.add.image(0,0,e,t),this.add(this.button)};createIcon(){const e=this.getFrameByStatus();this.icon=this.scene.make.image({key:tr,frame:e}),this.add(this.icon),Phaser.Display.Align.In.Center(this.icon,this.button)}logButtonEvent(){const e=this.getParentName(),t=this.name,s=!this.options.enable;this.scene.analytics.event(z.BUTTON_CLICK,{button_name:t,screen_name:e,enable:s})}}const li={REPLAY:"replay",RESCUE:"rescue",RECEIVE_DIAMONDS:"receive-coins"},{KEY:ms,FRAME:pe}=D.DEFAULT;class CS extends GameCore.Screen{popup;line;title;replayButton;homeButton;settingMusic;settingSound;settingVibrate;contents;popupShowUpAnimation;popupFadeOutAnimation;contentShowUpAnimation;constructor(e,t,s,n){super(e,t,s,n),this.createPopup(),this.createPopupContent(),this.createInput(),this.setDepth(ht.POPUP),this.background.setAlpha(.6)}open=()=>{super.open();const{player:e}=this.scene,t=e.getPlayerSettings(),{music:s,sound:n,vibrate:a}=t;if(this.settingMusic.updateStatus(s),this.settingSound.updateStatus(n),this.settingVibrate.updateStatus(a),!Xn()){this.settingVibrate.setVisible(!1);const r=80;Phaser.Display.Align.In.Center(this.settingMusic,this.settingVibrate,-r),Phaser.Display.Align.In.Center(this.settingSound,this.settingVibrate,r)}this.runOpenAnimation()};createInput(){this.replayButton.onClick=this.handleReplayGame,this.homeButton.onClick=this.handleGotoDashboard,this.settingMusic.onClick=this.handleMusicSetting,this.settingSound.onClick=this.handleSoundSetting,this.settingVibrate.onClick=this.handleVibrateSetting}handleClosePopup=()=>{this.scene.audio.playSound(K.POPUP_OFF,{volume:.6}),this.runCloseAnimation(),this.popupFadeOutAnimation.next(()=>{this.scene.screen.close(this.name)})};handleReplayGame=()=>{this.runCloseAnimation(),this.popupFadeOutAnimation.next(async()=>{this.scene instanceof Tt&&(this.scene.player.updateBestScore(this.scene.currentScore),this.scene.analytics.levelFail(this.scene.levelHandler.level)),this.scene.screen.close(this.name),await this.scene.storage.dispatch(ta()),X.emit(li.REPLAY)})};handleGotoDashboard=()=>{this.runCloseAnimation(),this.popupFadeOutAnimation.next(()=>{this.scene instanceof Tt&&(this.scene.player.updateBestScore(this.scene.currentScore),this.scene.analytics.levelFail(this.scene.levelHandler.level)),this.scene.screen.close(this.name),this.scene.scene.switch($.DASHBOARD_SCENE)})};handleMusicSetting=e=>{this.scene.player.setSetting("music",e),e?this.scene.audio.playMusic():this.scene.audio.pauseMusic()};handleSoundSetting=e=>{this.scene.player.setSetting("sound",e)};handleVibrateSetting=e=>{this.scene.player.setSetting("vibrate",e)};createPopup(){this.popup=new Je(this.scene,0,0,310,370),this.add(this.popup),Phaser.Display.Align.In.Center(this.popup,this.zone)}createPopupContent(){this.createTitle(),this.createMenuButtons(),this.createLine(),this.createFooterButtons(),this.popup.add([this.line,this.title,this.replayButton,this.homeButton,this.settingMusic,this.settingSound,this.settingVibrate]),this.contents=this.scene.make.group({}),this.contents.addMultiple([this.replayButton,this.homeButton,this.settingMusic,this.settingVibrate,this.settingSound])}createTitle(){this.title=this.scene.add.container();const e=this.scene.make.image({key:ms,frame:pe.RIBBON_SHORT});e.setWorldSize(271,81);const t=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(30),text:this.scene.lang.Text.SETTINGS,origin:{x:.5,y:.5}});Phaser.Display.Align.In.Center(t,e,0,-10);const s=new ee(this.scene,ms,pe.BUTTON_CLOSE,38,38);s.setName("Close"),s.useSound=!1,s.onClick=this.handleClosePopup,Phaser.Display.Align.In.RightCenter(s,e,-5,-5),this.title.add([e,t,s]),Phaser.Display.Align.In.TopCenter(this.title,this.popup)}createMenuButtons(){this.replayButton=new ee(this.scene,ms,pe.BUTTON_BLUE_LONG,232,76.94),this.replayButton.setName("Replay");const e=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(30),text:this.scene.lang.Text.REPLAY});Phaser.Display.Align.In.Center(e,this.replayButton),this.replayButton.add(e),Phaser.Display.Align.In.Center(this.replayButton,this.popup,0,-105),this.homeButton=new ee(this.scene,ms,pe.BUTTON_RED_LONG,231,68),this.homeButton.setName("Home");const t=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(28),text:this.scene.lang.Text.HOME});Phaser.Display.Align.In.Center(t,this.homeButton),this.homeButton.add(t)}createLine(){this.line=this.scene.make.image({key:ms,frame:pe.LINE}),this.line.setWorldSize(228.5,2),Phaser.Display.Align.In.BottomCenter(this.line,this.popup,0,-100)}createFooterButtons(){const e=this.scene.player.getPlayerSettings(),{sound:t,vibrate:s,music:n}=e;this.createMusicButton(n),this.createVibrateButton(s),this.createSoundButton(t);const{height:a}=this.popup;this.settingVibrate.setPosition(0,a/2-65);const r=75;Phaser.Display.Align.In.BottomCenter(this.settingMusic,this.settingVibrate,-r),Phaser.Display.Align.In.BottomCenter(this.settingSound,this.settingVibrate,r)}createMusicButton(e){this.settingMusic=new Ft(this.scene,{enable:e,frameOn:pe.ICON_MUSIC_ON,frameOff:pe.ICON_MUSIC_OFF,backgroundOn:pe.BUTTON_GREEN_CIRCLE,backgroundOff:pe.BUTTON_GREEN_CIRCLE}),this.settingMusic.setName("Music"),this.settingMusic.icon.setWorldSize(43,43),this.settingMusic.button.setWorldSize(70,70)}createVibrateButton(e){this.settingVibrate=new Ft(this.scene,{enable:e,frameOn:pe.ICON_VIB_ON,frameOff:pe.ICON_VIB_OFF,backgroundOn:pe.BUTTON_GREEN_CIRCLE,backgroundOff:pe.BUTTON_GREEN_CIRCLE}),this.settingVibrate.setName("Vibrate"),this.settingVibrate.icon.setWorldSize(43,43),this.settingVibrate.button.setWorldSize(70,70)}createSoundButton(e){this.settingSound=new Ft(this.scene,{enable:e,frameOn:pe.ICON_SOUND_ON,frameOff:pe.ICON_SOUND_OFF,backgroundOn:pe.BUTTON_GREEN_CIRCLE,backgroundOff:pe.BUTTON_GREEN_CIRCLE}),this.settingSound.setName("Sound"),this.settingSound.icon.setWorldSize(43,43),this.settingSound.button.setWorldSize(70,70)}runOpenAnimation(){this.scene.audio.playSound(K.POPUP_SHOW),this.runPopupEntrancesAnimation(0,300),this.runPopupContentEntrancesAnimation(200,300)}runCloseAnimation(){this.runPopupExitsAnimation(0,200)}runPopupEntrancesAnimation(e,t){if(!this.popupShowUpAnimation){const{y:s,scale:n}=this.popup;this.popupShowUpAnimation=new ks({targets:[this.popup],delay:e,duration:t,props:{y:{from:350,to:s},alpha:{start:1,from:1,to:1},scale:{start:0,from:0,to:n}}})}this.popupShowUpAnimation.play()}runPopupContentEntrancesAnimation(e,t){this.contentShowUpAnimation||(this.contentShowUpAnimation=new ts({targets:this.contents.getChildren(),duration:t,delay:this.scene.tweens.stagger(80,{start:e}),props:{alpha:{start:0,from:0,to:1}}})),this.contentShowUpAnimation.play()}runPopupExitsAnimation(e,t){this.popupFadeOutAnimation||(this.popupFadeOutAnimation=new ut({targets:[this.popup],delay:e,duration:t,props:{y:250,scale:0},onComplete:()=>{this.popup.setY(0)}})),this.popupFadeOutAnimation?.play()}}const{KEY:Xi,FRAME:sr}=D.DEFAULT,{Match:qi}=GameCore.Configs;class vS extends GameCore.Screen{isUseRescue;countdownText;countdownTimer;countdownCount;progressColor=0;progressTween;progressCircle;progressAngle;progressSize;progressRadius;skipText;continueButton;continueButtonAnimation;adsTimer;constructor(e,t,s,n){super(e,t,s,n),this.progressColor=0,this.progressAngle=-90,this.progressSize=15,this.progressRadius=70,this.countdownCount=qi.MaxRescueCount,this.setDepth(ht.POPUP),this.background.setAlpha(.8),this.createContent()}open=()=>{super.open(),this.isUseRescue=!1,this.progressColor=4249855,this.countdownCount=qi.RescueGamePopupTimeout,this.setTime(this.countdownCount),this.runCountdown(),this.runContinueButtonAnimation(),this.scene.audio.playSound(K.POPUP_SHOW)};handleShowRewardedVideoAd=async()=>{const{globalScene:e,audio:t}=this.scene.game;try{if(this.isUseRescue)return;this.scene.storage.dispatch(_T()),this.isUseRescue=!0,this.progressTween.pause(),this.countdownTimer.remove(),e.screen.open(U.NOTIFY_SCREEN,{message:this.scene.lang.Text.LOADING_ADS,duration:0,loading:!0}),t.pauseMusic(),t.muteAll(),await this.scene.ads.showRewardedVideoAsync(),e.screen.open(U.NOTIFY_SCREEN,{message:this.scene.lang.Text.REPLAY,duration:0,loading:!0}),e.screen.events.off(GameCore.Screens.Events.CLOSE),await wn(2e3),X.emit(li.RESCUE),this.scene.audio.playSound(K.DAILY_REWARD),e.screen.close(U.NOTIFY_SCREEN)}catch(s){if(s instanceof Object&&GameCore.Utils.Object.hasOwn(s,"code")&&s.code==="USER_INPUT"){this.showNotifySkipAds();return}this.showNotifyNoAds()}finally{this.scene.ads.preloadRewardedVideoAsync().catch(s=>{}),this.adsTimer?.destroy(),this.scene.audio.unmuteAll(),this.scene.audio.playMusic(),this.scene.screen.close(this.name)}};showNotifyNoAds=e=>{if(e&&e.name!==U.NOTIFY_SCREEN)return;const{globalScene:t}=this.scene.game;t.screen.events.off(GameCore.Screens.Events.CLOSE),t.screen.events.once(GameCore.Screens.Events.CLOSE,this.showGameOver),t.screen.open(U.NOTIFY_SCREEN,{message:this.scene.lang.Text.NO_ADS,duration:2e3,loading:!1})};showNotifySkipAds=()=>{const{globalScene:e}=this.scene.game;e.screen.events.off(GameCore.Screens.Events.CLOSE),e.screen.events.once(GameCore.Screens.Events.CLOSE,this.showGameOver),e.screen.open(U.NOTIFY_SCREEN,{message:this.scene.lang.Text.CANCELLED_AD,duration:3e3,loading:!1})};showGameOver=e=>{e&&e.name!==U.NOTIFY_SCREEN||(this.scene instanceof Tt&&this.scene.analytics.levelFail(this.scene.levelHandler.level,this.scene.currentScore),this.countdownTimer.remove(),this.progressTween.pause(),this.scene.screen.close(this.name),this.scene.storage.dispatch(In()))};handleSkip=()=>{this.scene instanceof Tt&&this.scene.analytics.levelFail(this.scene.levelHandler.level,this.scene.currentScore),this.countdownTimer.remove(),this.progressTween.pause(),this.scene.screen.close(this.name),this.scene.storage.dispatch(In())};createContent(){this.createProgressCircle(),this.createCountdown(),this.createContinueButton(),this.createSkipText()}createCountdown(){this.countdownText=this.scene.make.bitmapText({size:this.scene.fontSize(75),font:k.PRIMARY.KEY,origin:{x:.5,y:.5}}),this.add(this.countdownText),this.setTime(this.countdownCount)}runCountdown(){const e={delay:1e3,loop:!0,callback:this.handleRunCountdown};this.countdownTimer=this.scene.time.addEvent(e),this.startProgressCircle()}setProgressCircle(e){const{x:t,y:s}=this.countdownText,n=Phaser.Math.DegToRad(e-360+this.progressAngle),a=Phaser.Math.DegToRad(this.progressAngle);this.progressCircle.clear(),this.progressCircle.beginPath(),this.progressCircle.lineStyle(this.progressSize,this.progressColor),this.progressCircle.arc(t,s,this.progressRadius,n,a,!0,.02),this.progressCircle.strokePath(),this.progressCircle.closePath()}setTime(e){this.countdownText.setText(`${e}`),Phaser.Display.Align.In.Center(this.countdownText,this.zone,0,-120)}createProgressCircle(){this.progressCircle=this.scene.add.graphics(),this.add(this.progressCircle)}startProgressCircle(){this.progressTween=this.scene.tweens.addCounter({from:360,to:0,duration:qi.RescueGamePopupTimeout*1e3,onUpdate:e=>{const t=+e.getValue().toFixed(2);this.setProgressCircle(t)}})}createContinueButton(){this.continueButton=new ee(this.scene,Xi,sr.BUTTON_BLUE_LONG,232,68),this.continueButton.setName("Continue"),this.add(this.continueButton),this.continueButton.onClick=this.handleShowRewardedVideoAd;const e=this.scene.add.image(0,0,Xi,sr.ICON_ADS);Phaser.Display.Align.In.Center(e,this.continueButton),e.setWorldSize(36.5,33.5),e.setX(this.continueButton.x-70),this.continueButton.add(e);const t=this.scene.make.bitmapText({size:this.scene.fontSize(28),text:this.scene.lang.Text.CONTINUE,font:k.PRIMARY.KEY,origin:{x:.35,y:.55}});this.continueButton.add(t),Phaser.Display.Align.In.Center(this.continueButton,this.zone,0,30)}createSkipText(){const e=this.scene.lang.getCurrentLanguage(),t=e==="ja"?147.5:e==="id"?161.5:129,s=e==="ja"?21:e==="id"?16.5:25;this.skipText=new ee(this.scene,Xi,this.scene.lang.Texture.NO_THANK,t,s),this.skipText.setName("NoThanks"),this.add(this.skipText),this.skipText.onClick=this.handleSkip,Phaser.Display.Align.In.BottomCenter(this.skipText,this.continueButton,0,60)}handleRunCountdown=()=>{if(this.countdownCount-=1,this.countdownCount===5&&(this.progressColor=15812177),this.countdownCount<=0){this.countdownTimer.remove(),this.progressTween.complete(),this.rescueTimeout();return}this.setTime(this.countdownCount)};rescueTimeout(){this.scene instanceof Tt&&this.scene.analytics.levelFail(this.scene.levelHandler.level,this.scene.currentScore),this.scene.screen.close(this.name),this.showGameOver()}runContinueButtonAnimation(){this.continueButtonAnimation||(this.continueButtonAnimation=new qe({targets:[this.continueButton],props:{scale:"-=0.02"}})),this.continueButtonAnimation?.play()}}const{KEY:_S,FRAME:OS}=D.GAMEPLAY;class RS extends Phaser.GameObjects.Container{scene;score;scoreAnimation;constructor(e){super(e),this.scene=e,this.createBar(),this.createTitle(),this.createScoreText(),this.createScoreAnimation()}setScore(e){let t=`${e}`;e>99999&&(t=`${Math.floor(e/1e3)}k`),this.score.setText(t),this.scoreAnimation.play()}createBar(){const e=this.scene.make.image({key:_S,frame:OS.BIG_CIRCLE});e.setSize(71,71).setDisplaySize(71,71),this.add(e);const{width:t,height:s}=e;this.setSize(t,s)}createTitle(){const e=this.scene.lang.getCurrentLanguage(),t=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(e==="ja"?10:12),text:this.scene.lang.Text.YOUR_SCORE,origin:{x:.5,y:.5}});this.add(t),Phaser.Display.Align.In.Center(t,this,0,-14)}createScoreText(){this.score=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(24),text:"0",origin:{x:.5,y:.5}}),this.add(this.score),Phaser.Display.Align.In.Center(this.score,this,0,8)}createScoreAnimation(){this.scoreAnimation=new jn({targets:[this.score]})}}const{KEY:PS,FRAME:ir}=D.EFFECTS;class DS extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitZone;emitter;constructor(e){super(e,PS,ir.FX_STAR_YELLOW),this.scene=e,this.createEmitZone(),this.scene.add.existing(this)}createEmitZone(){this.emitZone=new Phaser.Geom.Rectangle}createEmitters(){const e=1/this.scene.world.getPixelRatio();this.emitter=this.createEmitter({on:!1,frame:ir.FX_STAR_WHITE,emitZone:{source:this.emitZone,type:"random"},timeScale:1,frequency:80,maxParticles:15,scale:{start:0,end:e*1,ease:Phaser.Math.Easing.Bounce.Out},lifespan:400})}run(e,t,s,n,a){this.stop(),this.reset(),this.emitZone.setSize(n,a),this.emitZone.setPosition(t-n/2,s-a/2),this.emitter.setQuantity(e),this.emitter.start()}explode(e,t,s,n,a){this.stop(),this.reset(),this.emitZone.setSize(n,a),this.emitZone.setPosition(-n/2,-a/2),this.emitter.explode(e,t,s)}stop(){this.emitter?.killAll(),this.emitter?.stop()}reset(){this.createEmitters()}}const{KEY:nr,FRAME:MS}=D.GAMEPLAY;class LS extends Phaser.GameObjects.Container{scene;objectType;payload;icon;checkIcon;requireText;constructor(e,t,s){super(e),this.scene=e,this.objectType=t,this.payload=s,this.createIcon(),this.createCheckIcon(),this.createRequireText()}updateCount(e){e<=0?(this.checkIcon.revive(),this.requireText.kill()):(this.checkIcon.kill(),this.requireText.revive(),this.requireText.setText(`${e}`))}createIcon(){this.icon=this.scene.make.image({key:nr,frame:this.payload.icon}),this.icon.setWorldSize(18.5,18.5),this.add(this.icon)}createRequireText(){this.requireText=new fi(this.scene,{font:k.PRIMARY.KEY,size:8}),this.requireText.setDropShadow(.5,.5,8158332),this.requireText.setText(`${this.payload.require}`),this.add(this.requireText),Phaser.Display.Align.In.Center(this.requireText,this.icon,6,5)}createCheckIcon(){this.checkIcon=this.scene.make.image({key:nr,frame:MS.ICON_CHECK,visible:!1}),this.checkIcon.setWorldSize(13,13),this.add(this.checkIcon),Phaser.Display.Align.In.Center(this.checkIcon,this.icon,6,5)}}const{FRAME:st}=D.GAMEPLAY,{OBJECTS:it}=he;let xS=class extends Phaser.GameObjects.Container{scene;missionName;currentReward;score;title;label;objects;circleLight;cometTwinkle;starWhiteTwinkle;rewardAnimation;circleLightAnimation;requireObjectsAnimation;constructor(e){super(e),this.scene=e,this.createTitle(),this.createLabel(),this.createScore(),this.createGroup(),this.createCircleLight(),this.createCircleLightAnimation(),this.createEffects(),this.scene.add.existing(this)}showRequesting(e){this.label.setVisible(e),this.objects&&this.objects.killGroup()}updateInfo(e){const{name:t,require:s,process:n}=e;this.showRequesting(!1),this.createRequireObjects(s,n),this.alignRequireObjects(),this.missionName!==t&&(this.missionName=t,this.runRequireObjectsAnimation())}createRequireObjects(e,t){this.scene.tweens.killTweensOf(this.objects.getChildren());const s=Object.keys(e);let n=0;s.forEach(a=>{const r=this.getIconObjectByType(a);if(r===null)return;n=e[a]-t[a],n=n<0?0:n;const c=this.objects.getMatching("type",a);if(c.length>0){const l=c[0];l.revive(),l.setAlpha(1),l.setScale(1),l.updateCount(n);return}const o=new LS(this.scene,a,{icon:r,require:n});this.add(o),this.objects.add(o)})}alignRequireObjects(){this.objects.setY(3);const e=this.getActiveObjects(),{length:t}=e,s=30,n=-(s*((t-1)/2));Phaser.Actions.SetX(e,n,s)}getIconObjectByType(e){switch(e){case it.RED:return st.TILE_RED;case it.BLUE:return st.TILE_BLUE;case it.GREEN:return st.TILE_GREEN;case it.PINK:return st.TILE_PINK;case it.YELLOW:return st.TILE_YELLOW;case it.PAINT:return st.ITEM_PAINT;case it.HAMMER:return st.ITEM_HAMMER;case it.SHUFFLE:return st.ITEM_SHUFFLE;default:return null}}getActiveObjects(){return this.objects.getMatching("active",!0)}runRequireObjectsAnimation(){const e=this.getActiveObjects();this.scene.tweens.killTweensOf(e),this.requireObjectsAnimation?.remove(),this.requireObjectsAnimation=new yi({targets:e,duration:1e3,delay:this.scene.tweens.stagger(50,{}),ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],props:{scale:{start:.8,to:1}}}),this.requireObjectsAnimation.play()}runRewardAnimation(e){if(this.rewardAnimation?.tween?.isPlaying()){this.currentReward+=e,this.score.setText(`${this.currentReward}`);return}this.currentReward=e,this.score.setText(`${this.currentReward}`),this.score.setAlpha(1),this.score.setScale(1),this.score.setVisible(!0),this.resetScorePosition();const{objects:t}=this.scene.layoutManager,{currentScoreBar:s}=t.header.topBar,{x:n,y:a}=s.getWorldPosition(),{x:r,y:c}=this.score,o={x:r,y:c},l={x:n,y:a},h=30,d=40;this.rewardAnimation?.remove(),this.rewardAnimation=new Yc({targets:[this.score],duration:Phaser.Math.RND.between(1e3,2500),curve:[[o.x,o.y],[o.x+Phaser.Math.RND.between(0,h),o.y+Phaser.Math.RND.between(d,d*2)],[l.x,l.y]],props:{scale:{start:1,to:.5}},onComplete:()=>{this.scene?.eatScore(this.currentReward),this.currentReward=0,this.score.setVisible(!1),this.runStarTouchAnimation()},onCurveUpdate:u=>{const m=u.x+Phaser.Math.RND.between(-10,10),g=u.y+Phaser.Math.RND.between(-10,10);this.cometTwinkle.explode(1,m,g),this.scene.audio.playSound(K.MISSION_REWARD,{volume:.6})}}),this.rewardAnimation.play()}runStarTouchAnimation(){const{x:e,y:t}=this.score,{objects:s}=this.scene.layoutManager,{currentScoreBar:n}=s.header.topBar,{width:a,height:r}=n,c=t+2;this.circleLight.setPosition(e,c),this.circleLightAnimation.play(),this.starWhiteTwinkle.run(1,e,c,a,r)}runTimeOutAnimation(){const e=this.getActiveObjects();this.scene.tweens.killTweensOf(e),this.scene.tweens.add({targets:e,yoyo:!0,repeat:3,duration:400,ease:Phaser.Math.Easing.Quadratic.InOut,props:{alpha:0}})}createTitle(){this.title=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(16),text:this.scene.lang.Text.MISSION,origin:{x:.5,y:.5}}),this.add(this.title),Phaser.Display.Align.In.Center(this.title,this,0,-18)}createLabel(){this.label=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(12),text:this.scene.lang.Text.REQUESTING,origin:{x:.5,y:.5}}),this.label.setTint(1095418),this.add(this.label),new ut({targets:[this.label],yoyo:!0,repeat:-1,props:{alpha:{start:.8,to:.2}}}).play()}createScore(){this.score=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(32),visible:!1,alpha:.9,depth:Y.EFFECT,origin:{x:.5,y:.5}})}resetScorePosition(){const e=this.getWorldTransformMatrix(),{translateX:t,translateY:s}=e.decomposeMatrix();this.score.setPosition(t,s)}createGroup(){this.objects=this.scene.add.group()}createCircleLight(){const{KEY:e,FRAME:t}=D.EFFECTS;this.circleLight=this.scene.make.image({key:e,frame:t.FX_CIRCLE_LIGHT}),this.circleLight.setWorldSize(75.5,75),this.circleLight.kill()}createCircleLightAnimation(){this.circleLightAnimation=new zn({targets:[this.circleLight],duration:800,ease:Phaser.Math.Easing.Cubic.Out,props:{scale:2.5,alpha:0},onActive:()=>{this.circleLight.revive()},completeDelay:300,onComplete:()=>{this.circleLight.kill(),this.starWhiteTwinkle.stop()}})}createEffects(){this.cometTwinkle=new Vc(this.scene),this.cometTwinkle.setDepth(Y.PRIORITY),this.starWhiteTwinkle=new DS(this.scene),this.starWhiteTwinkle.setDepth(Y.PRIORITY)}};const{KEY:NS,FRAME:kS}=D.GAMEPLAY;class GS extends ee{scene;constructor(e,t,s){super(e,NS,kS.BUTTON_SETTING,t,s),this.scene=e,this.useSound=!1,this.setName("Pause"),this.onClick=this.handlePauseGame}handlePauseGame=()=>{const{tileManager:e,layoutManager:t}=this.scene;e.isSelectable&&t.showPauseScreen()}}class ul extends Phaser.GameObjects.Container{payload;process;minProcess;maxProcess;progressBoxLeft;progressBoxBg;progressBoxRight;progressBarLeft;progressBarBg;progressBarRight;progressAnimation;constructor(e,t){super(e),this.payload=t;const s=t.width,n=16;this.setSize(s,n),this.process=0,this.minProcess=0,this.maxProcess=1,this.createProgressBox(),this.createProgressBar(),this.createContainer()}setProcess(e,t=!1){if(this.process=this.getCorrectValue(e),!this.scene||t){this.updateProcess();return}this.runProcessAnimation(e)}updateProcess(){const{displayHeight:e}=this.progressBarBg,t=this.getDisplayWidthByProcess(this.process);this.progressBarBg.setWorldSize(t,e);const{x:s}=this.progressBarBg;this.progressBarRight.setX(s+t)}getCorrectValue(e){let t=e;return isFinite(t)||(t=0),t<this.minProcess&&(t=this.minProcess),t>this.maxProcess&&(t=this.maxProcess),t}getDisplayWidthByProcess(e){const{width:t}=this;return(t-17)*e}runProcessAnimation(e){this.progressAnimation?.stop(1),this.progressAnimation=this.scene.add.tween({targets:[this.progressBarBg],duration:300,ease:Phaser.Math.Easing.Quadratic.InOut,props:{displayWidth:()=>{const t=this.getCorrectValue(e);return this.getDisplayWidthByProcess(t)}},onStart:()=>{const{displayHeight:t}=this.progressBarBg,s=this.getDisplayWidthByProcess(this.process);this.progressBarBg.setWorldSize(s,t)},onUpdate:()=>{const{x:t,displayWidth:s}=this.progressBarBg;this.progressBarRight.setX(t+s)},onComplete:()=>{this.updateProcess()}})}createProgressBox(){const{key:e,frames:t}=this.payload;this.progressBoxLeft=this.scene.make.image({key:e,frame:t.PROGRESS_BG_LEFT}),this.progressBoxLeft.setOrigin(0,.5),this.progressBoxLeft.setWorldSize(11,16),this.progressBoxRight=this.scene.make.image({key:e,frame:t.PROGRESS_BG_RIGHT}),this.progressBoxRight.setOrigin(0,.5),this.progressBoxRight.setWorldSize(11,16),this.progressBoxBg=this.scene.make.image({key:e,frame:t.PROGRESS_BG_MID}),this.progressBoxBg.setOrigin(0,.5),this.progressBoxBg.setWorldSize(11,16);const{displayHeight:s}=this.progressBoxBg,{displayWidth:n}=this,{displayWidth:a}=this.progressBoxLeft,{displayWidth:r}=this.progressBoxRight;this.progressBoxLeft.setWorldSize(a,s),this.progressBoxRight.setWorldSize(r,s),this.progressBoxBg.setWorldSize(n-(a+r),s),Phaser.Display.Align.In.Center(this.progressBoxBg,this,0,0),Phaser.Display.Align.In.LeftCenter(this.progressBoxLeft,this,0,0),Phaser.Display.Align.In.RightCenter(this.progressBoxRight,this,0,0)}createProgressBar(){const{key:e,frames:t}=this.payload;this.progressBarLeft=this.scene.make.image({key:e,frame:t.PROGRESS_BAR_LEFT}),this.progressBarLeft.setOrigin(0,.5),this.progressBarLeft.setWorldSize(11,16),this.progressBarRight=this.scene.make.image({key:e,frame:t.PROGRESS_BAR_RIGHT}),this.progressBarRight.setOrigin(0,.5),this.progressBarRight.setWorldSize(11,16),this.progressBarBg=this.scene.make.image({key:e,frame:t.PROGRESS_BAR_MID}),this.progressBarBg.setOrigin(0,.5),this.progressBarBg.setWorldSize(11,16);const s=-1,n=-5.8;Phaser.Display.Align.In.LeftCenter(this.progressBarBg,this,n),Phaser.Display.Align.In.LeftCenter(this.progressBarLeft,this,s),Phaser.Display.Align.In.LeftCenter(this.progressBarRight,this,s),this.setProcess(0,!0)}createContainer(){this.add([this.progressBoxBg,this.progressBoxLeft,this.progressBoxRight,this.progressBarBg,this.progressBarLeft,this.progressBarRight]),this.scene.add.existing(this)}}const{KEY:BS,FRAME:US}=D.GAMEPLAY;class FS extends Phaser.GameObjects.Container{scene;progressBar;scoreText;constructor(e){super(e),this.scene=e,this.createProgressBar(),this.createScore(),this.scene.add.existing(this)}setScore(e){let t=`${e}`;e>99999&&(t=`${Math.floor(e/1e3)}k`),this.scoreText.setText(`${this.scene.lang.Text.TARGET}: ${t}`)}setProcess(e){this.progressBar.setProcess(e,!0)}createProgressBar(){this.progressBar=new ul(this.scene,{width:90,key:BS,frames:US}),this.add(this.progressBar),Phaser.Display.Align.In.Center(this.progressBar,this,0,10)}createScore(){this.scoreText=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(16),origin:{x:.5,y:.5}}),Phaser.Display.Align.In.TopCenter(this.scoreText,this.progressBar,0,10),this.add(this.scoreText),this.setScore(0)}}const{KEY:YS,FRAME:HS}=D.GAMEPLAY;class VS extends Phaser.GameObjects.Container{scene;background;targetScoreBar;currentScoreBar;missionBlock;constructor(e){super(e),this.scene=e,this.createBackground(),this.createSettingButton(),this.createTargetScoreBar(),this.createCurrentScoreBar(),this.createMissionBlock(),this.scene.add.existing(this)}createBackground(){this.background=this.scene.make.image({key:YS,frame:HS.BIG_TOP,origin:{x:.5,y:.5}}),this.background.setWorldSize(364,80),this.setSize(364,80),this.add(this.background)}createSettingButton(){const e=new GS(this.scene,35,35);this.add(e),Phaser.Display.Align.In.LeftCenter(e,this.background,-5,-15)}createTargetScoreBar(){this.targetScoreBar=new FS(this.scene),this.add(this.targetScoreBar),Phaser.Display.Align.In.Center(this.targetScoreBar,this.background,-90,-15)}createCurrentScoreBar(){this.currentScoreBar=new RS(this.scene),this.add(this.currentScoreBar),Phaser.Display.Align.In.Center(this.currentScoreBar,this.background)}createMissionBlock(){this.missionBlock=new xS(this.scene),this.add(this.missionBlock),Phaser.Display.Align.In.Center(this.missionBlock,this.background,110,-8)}}class WS extends Phaser.GameObjects.Container{scene;topBar;constructor(e){super(e),this.scene=e,this.createTopBar();const{width:t,height:s}=this.topBar;this.setSize(t,s),e.add.existing(this)}createTopBar(){this.topBar=new VS(this.scene),this.topBar.setDepth(Y.ITEM),this.add(this.topBar)}}const{KEY:KS,FRAME:ar}=D.DEFAULT;class jS extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitter;constructor(e){super(e,KS,ar.ICON_DIAMOND),this.createEmitters(),this.setActive(!1),this.setVisible(!1),this.scene.add.existing(this)}createEmitters(){const e=1/this.scene.world.getPixelRatio();this.emitter=this.createEmitter({on:!1,frame:ar.ICON_DIAMOND,gravityY:160,angle:{min:-180,max:0},speed:{min:50,max:200},scale:{min:e*.3,max:e*1},alpha:{start:1,end:0,ease:Phaser.Math.Easing.Expo.In},lifespan:1500})}explode(e,t,s){this.setActive(!0),this.setVisible(!0),this.emitter.explode(e,t,s)}}const{ID:Zi}=re.GIFT,{FRAME:zS}=D.GAMEPLAY,{Gameplay:Ji}=GameCore.Configs;class $S extends Si{scene;giftTime;timer;customField="lastReceiveGift";messageReceived;showMessageAnimation;constructor(e){super(e,zS.ITEM_GIFT,31,32),this.scene=e,this.giftTime=Ji.GiftTime*1e3,this.onClick=()=>{const{tileManager:t}=this.scene;t.isUseableItem&&(t.removeSuggestionsTiles(),this.useGiftItem(),this.deactivateItem())},this.createMessageReceived()}activeItem(){super.activeItem(),this.icon.setVisible(!1)}deactivateItem(){super.deactivateItem(),this.icon.setVisible(!1),this.bar.setVisible(!0),this.diamond.setVisible(!0)}checkUseable(){const{player:e}=this.scene,t=Date.now(),s=e.getCustomData(this.customField);let n=0;if(GameCore.Utils.Valid.isNumber(s)&&(n=s),t-n<this.giftTime){this.disableItem(),this.startCountdown(n);return}this.enableItem()}enableItem(){this.setLabel(this.scene.lang.Text.GIFT),this.setInteractive(),this.bubbleAnimation?.play()}disableItem(){this.disableInteractive(),this.bubbleAnimation?.stop()}startCountdown(e){this.stopCountdown(),this.setLabel(this.scene.lang.Text.GIFT),this.timer=this.scene.time.addEvent({loop:!0,delay:1e3,startAt:1e3,callback:()=>{const s=Date.now()-e,n=this.giftTime-s;if(n<=0){this.enableItem();return}const a=to(n,!0);this.setLabel(a)}})}stopCountdown(){this.timer?.remove()}setLabel(e){this.icon.setVisible(!1),this.diamond.setCenterAlign(),this.diamond.setText(e),Phaser.Display.Align.In.Center(this.diamond,this.bar)}useGiftItem(){const{itemManager:e}=this.scene;if(this.isActive){e.deactivateItem(Zi);return}e.activeItem(Zi),this.useItem()}useItem(){return this.isActive?(this.scene.screen.events.once(Ga.OPEN,e=>{e.onReward=this.handleReceiveGift}),this.scene.screen.events.once(Ga.CLOSE,this.handleGameSceneResume),this.scene.layoutManager.showRewardScreen(Ji.AwardDiamonds),!0):!1}handleReceiveGift=async e=>{const{player:t,gameZone:s}=this.scene,{width:n,height:a}=s,r=Date.now();this.scene.eatDiamond(e);const c=new jS(this.scene);c.setDepth(Y.PRIORITY),c.explode(20,n/2,a/2),this.runShowMessage(),await t.setCustomData(this.customField,r),this.checkUseable()};handleGameSceneResume=()=>{const{itemManager:e}=this.scene;e.deactivateItem(Zi)};createMessageReceived(){this.messageReceived=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(24),visible:!1,text:this.scene.lang.getText({key:"YOU_RECEIVED_X_DIAMONDS",variables:[Ji.AwardDiamonds]}),origin:{x:.5,y:.5}}),this.messageReceived.setCenterAlign(),this.messageReceived.setDepth(Y.MESSAGE)}runShowMessage(){this.messageReceived.revive(),Phaser.Display.Align.In.TopCenter(this.messageReceived,this.scene.gameZone,0,-150),this.showMessageAnimation||(this.showMessageAnimation=new yi({targets:[this.messageReceived],delay:500,duration:800,completeDelay:1500,onComplete:()=>{this.messageReceived.kill()}})),this.showMessageAnimation.play()}}const{ID:Qi}=re.SHUFFLE,{FRAME:XS}=D.GAMEPLAY;class qS extends Si{scene;isRunning=!1;costTimer;constructor(e){super(e,XS.ITEM_SHUFFLE,28,28.5),this.scene=e,this.setDiamond(25),this.onClick=this.handleUseItem}handleUseItem=()=>{if(this.isRunning)return;const{itemManager:e}=this.scene;if(this.isActive){e.deactivateItem(Qi);return}if(!e.activeItem(Qi)){this.scene.audio.playSound(K.MOVE_WRONG),this.shakeAnimation.play();return}this.scene.useDiamond(this.value),this.useItem()};useItem=(e=3)=>{const{tileManager:t,itemManager:s,animationManager:n}=this.scene;if(this.isRunning=!0,t.isSelectable=!1,t.isUseableItem=!1,e<1&&t.isCanMove()){this.isRunning=!1,s.deactivateItem(Qi),t.isSelectable=!0,t.isUseableItem=!0,t.updateFreezeTiles(),t.suggestionsEatableTiles();return}this.scene.audio.playSound(K.USE_SHUFFLE),t.removeSuggestionsTiles(),this.costTimer?.remove(),this.costTimer=this.scene.time.delayedCall(n.moveDuration+100,()=>{this.useItem(e-1)}),this.runShuffle()};runShuffle=()=>{const e=this.getTilesAlive(),t=this.shuffleTiles();this.shuffleAnimation(e,t),this.updateTilesPosition(e,t)};getTilesAlive(){const{tileManager:e}=this.scene,t=e.getTiles(),s=[];return t.forEach(n=>{n.isCaptured()||n instanceof ot||s.push(n)}),s}shuffleTiles(){const e=this.getTilesAlive();GameCore.Utils.Array.unique(e);const t=[];return e.forEach(({row:s,column:n})=>{t.push({row:s,column:n})}),GameCore.Utils.Array.shuffle(t),t}shuffleAnimation(e,t){const{animationManager:s}=this.scene;e.forEach((n,a)=>{const{row:r,column:c}=n,{row:o,column:l}=t[a];r!==o&&s.moveRows({tile:n,fromRow:r,toRow:o}),c!==l&&s.moveColumns({tile:n,fromColumn:c,toColumn:l})})}updateTilesPosition(e,t){const{boardManager:s}=this.scene;e.forEach((n,a)=>{const{row:r,column:c}=n,{row:o,column:l}=t[a];r===o&&c===l||s.tileSwap({fromRow:r,toRow:o,fromColumn:c,toColumn:l})})}}const ZS={targets:[],duration:600,ease:Phaser.Math.Easing.Back.Out,props:{}};class ct extends Ee{constructor(e){super(ZS,e)}}const{KEY:JS,FRAME:QS}=D.DEFAULT;class eA extends Phaser.GameObjects.Container{cat;constructor(e){super(e),this.createEffect(),this.createCat(),this.runCatAnimation(),this.scene.add.existing(this)}createCat(){this.cat=this.scene.make.image({key:JS,frame:QS.SAD_CAT,origin:{x:.5,y:1}}),this.cat.setWorldSize(100,117),this.cat.setY(this.cat.height/2),this.add(this.cat)}createEffect(){}runCatAnimation(){new qe({targets:[this.cat],duration:1e3,props:{scale:"-=0.02"}}).play()}}class tA extends Phaser.GameObjects.Container{scene;sadCat;board;titleText;descriptionText;boardAnimation;theCatAnimation;textsAnimation;existAnimation;constructor(e){super(e),this.scene=e,this.setVisible(!1),this.createBoard(),this.createTitleText(),this.createDescriptionText(),this.createTheCat(),this.scene.add.existing(this)}runAnimation=()=>{this.scene.tweens.killTweensOf(this.getAll()),this.setVisible(!0),this.runBoardAnimation(),this.runCatAnimation(),this.runTextsAnimation()};createBoard(){this.board=new Je(this.scene,0,0,600,102),this.board.setDepth(Y.BACKGROUND),this.add(this.board)}createTheCat(){this.sadCat=new eA(this.scene),this.sadCat.setDepth(Y.LOGO),this.add(this.sadCat),Phaser.Display.Align.In.Center(this.sadCat,this.board,-140,-19)}createTitleText(){this.titleText=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(22),depth:Y.TEXT,origin:{x:.5,y:.5},text:this.scene.lang.Text.LEVEL_FAILED}),this.add(this.titleText),this.titleText.setTint(12010469),Phaser.Display.Align.In.Center(this.titleText,this.board,35,-20)}createDescriptionText(){this.descriptionText=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(20),depth:Y.TEXT,origin:{x:.5,y:.5},text:this.scene.lang.Text.YOU_DID_NOT_REACH}),this.add(this.descriptionText),this.descriptionText.setTint(11632977),Phaser.Display.Align.In.Center(this.descriptionText,this.board,35,10)}runBoardAnimation(){if(!this.boardAnimation){const e=this.board.y;this.boardAnimation=new ct({targets:[this.board],duration:300,props:{y:{start:e+80,to:e},alpha:{start:0,from:0,to:1}}})}this.boardAnimation.play()}runCatAnimation(){if(!this.theCatAnimation){const e=this.sadCat.x;this.theCatAnimation=new ct({targets:[this.sadCat],ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.6,1],delay:150,duration:800,props:{alpha:{start:0,from:0,to:1},scale:{start:.3,to:1},x:{start:e-80,to:e}}})}this.theCatAnimation.play()}runTextsAnimation(){this.titleText.setAlpha(0),this.descriptionText.setAlpha(0),this.textsAnimation||(this.textsAnimation=new ct({targets:[this.titleText,this.descriptionText],duration:500,delay:this.scene.tweens.stagger(200,{start:200}),props:{y:{getEnd:e=>e.y},alpha:{start:0,from:0,to:1}},completeDelay:1e3,onComplete:this.runExistAnimation})),this.textsAnimation.play()}runExistAnimation=()=>{if(!this.existAnimation){const t=this.getAll();this.existAnimation=new ct({targets:t,duration:400,ease:Phaser.Math.Easing.Cubic.In,props:{y:{getStart:s=>s.y,getEnd:s=>s.y+150},alpha:{value:0,delay:250,duration:150}},onComplete:()=>{Phaser.Actions.IncY(t,-150),this.setVisible(!1)}})}this.existAnimation.play()}}const{KEY:sA,FRAME:iA}=D.DEFAULT;class Ai extends Phaser.GameObjects.Image{anim;constructor(e){super(e,0,0,sA,iA.PRELOADER),this.runAnimation(),this.setWorldSize(113,113),this.scene.add.existing(this)}runAnimation(){this.anim?.remove(),this.anim=new ol({targets:[this],repeat:-1,duration:1200}),this.anim.play()}setVisible(e){return super.setVisible(e),e?this.runAnimation():this.anim.stop(),this}}class Ti extends Phaser.GameObjects.Container{payload;loading;photo;avtFrame;background;loadPhotoTimer;constructor(e,t){super(e),this.scene.add.existing(this),this.payload=t,this.setSize(t.width,t.height),this.createBackground(),this.createLoading(),this.createPhoto(),this.createFrame();const{id:s,url:n,radius:a}=this.payload;s&&n&&this.loadPhoto(s,n,a),this.addDefaultListeners()}setFrame(e){this.avtFrame.setFrame(e),this.avtFrame.setVisible(!0)}setBackground(e){this.background.setFrame(e)}getPhotoId(){const{id:e,radius:t=0}=this.payload;if(!e)return fe.AVATAR.KEY;const s=`${e}_bordered_${t}`;return t>0?s:e}loadPhoto(e,t,s=0){if(this.payload.id=e,this.payload.url=t,this.payload.radius=s,this.loadPhotoTimer?.remove(),!e||!t){this.setPhoto(fe.AVATAR.KEY);return}const n=this.scene.textures.get(e);if(n&&n.key===e){this.handleLoadComplete(e);return}this.showLoading(!0);const a=this.payload.loadDelay||0;this.loadPhotoTimer=this.scene.time.delayedCall(a,this.handleLoadPhotoAfterDelay(e,t))}handleLoadPhotoAfterDelay=(e,t)=>()=>{const s=this.scene.textures.get(e);if(s&&s.key===e){this.handleLoadComplete(e);return}this.scene.load.once(`filecomplete-image-${e}`,this.handleLoadComplete),this.scene.load.image(e,t),this.scene.load.start()};addDefaultListeners(){this.scene.load.on(Phaser.Loader.Events.FILE_LOAD_ERROR,this.handleLoadPhotoFailed),this.on(Phaser.GameObjects.Events.DESTROY,()=>{this.loadPhotoTimer?.remove(),this.scene.load.off(Phaser.Loader.Events.FILE_LOAD_ERROR,this.handleLoadPhotoFailed)})}handleLoadComplete=e=>{if(!this.scene)return;const{id:t,radius:s=0}=this.payload;if(!t||t!==e)return;const n=this.getPhotoId(),a=this.scene.textures.get(n);if(a&&a.key===n){this.setPhoto(a.key);return}if(s!=0&&s<100){if(!GameCore.Utils.Image.drawBorder({scene:this.scene,key:t,newKey:n,radius:s})){this.showLoading(!1);return}this.setPhoto(n)}else if(s==100){if(!GameCore.Utils.Image.drawCircle({scene:this.scene,key:t,newKey:n})){this.showLoading(!1);return}this.setPhoto(n)}else this.setPhoto(t)};handleLoadPhotoFailed=e=>{e.key===this.payload.id&&this.setDefaultAvatar(e.key)};setDefaultAvatar(e){this.loadPhoto(e,fe.AVATAR.FILE,this.payload.radius)}createBackground(){const{key:e,background:t}=this.payload;this.background=this.scene.make.image({key:e,frame:t}),this.background.setWorldSize(this.width,this.height),this.add(this.background)}createLoading(){this.loading=new Ai(this.scene),this.loading.setWorldSize(this.width*.75,this.height*.75),this.loading.setVisible(!1),this.add(this.loading)}createPhoto(){this.photo=this.scene.make.image({x:0,y:0,origin:{x:.5,y:.5},visible:!1}),this.add(this.photo)}createFrame(){const{key:e,frame:t,width:s,height:n}=this.payload;t?(this.avtFrame=this.scene.make.image({key:e,frame:t}),this.avtFrame.setWorldSize(s,n)):this.avtFrame=this.scene.make.image({x:0,y:0,origin:{x:.5,y:.5},visible:!1}),this.add(this.avtFrame)}showLoading(e){this.photo.setVisible(!e),this.loading.setVisible(e)}setPhoto(e){this.showLoading(!1),this.photo.setTexture(e),this.photo.setFrame(0);const t=Math.max(this.width,this.height)-7;this.photo.setWorldSize(t,t),Phaser.Display.Align.In.Center(this.photo,this.background)}}const{KEY:en,FRAME:$s}=D.GAMEPLAY;class nA extends Phaser.GameObjects.Container{scene;avatar;cup;background;playerName;playerScore;waitingText;constructor(e){super(e),this.scene=e,this.createBackground(),this.createAvatar(),this.createPlayerName(),this.createPlayerScore(),this.createWaitingText(),this.createCup(),this.scene.add.existing(this)}setScore(e){this.playerScore.setText(`${e}`)}updateInfo(e,t,s,n){this.playerName.setText(t),this.avatar.loadPhoto(e,s,50),n?(this.setScore(n),this.playerScore.setVisible(!0),this.waitingText.setVisible(!1)):(this.playerScore.setVisible(!1),this.waitingText.setVisible(!0))}createBackground(){this.background=this.scene.make.image({key:en,frame:$s.BIG_PLAYER}),this.background.setWorldSize(107,44.5),this.add(this.background)}createAvatar(){this.avatar=new Ti(this.scene,{key:en,frame:$s.AVATAR_BLUE_FRAME,background:$s.AVATAR_BLUE_BG,width:38,height:39.5}),this.add(this.avatar),Phaser.Display.Align.In.LeftCenter(this.avatar,this.background,-5)}createPlayerName(){this.playerName=this.scene.make.text({style:{fontFamily:k.FONT_FAMILY,fontSize:`${this.scene.fontSize(24)}px`},alpha:.8,origin:{x:.5,y:.5}}),this.playerName.setHighQuality(),Phaser.Display.Align.In.Center(this.playerName,this.background,20,-10),this.add(this.playerName)}createPlayerScore(){this.playerScore=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(14),origin:{x:0,y:.5}}),this.add(this.playerScore),Phaser.Display.Align.In.Center(this.playerScore,this.background,8,8)}createWaitingText(){this.waitingText=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(12),origin:{x:0,y:.5},text:this.scene.lang.Text.WAITING}),this.waitingText.setAlpha(.6),this.add(this.waitingText),Phaser.Display.Align.In.Center(this.waitingText,this.background,24,8)}createCup(){this.cup=this.scene.make.image({key:en,frame:$s.ICON_CUP_SUPERMINI}),this.cup.setWorldSize(11.5,12.5),this.add(this.cup),Phaser.Display.Align.In.Center(this.cup,this.background,-2,8)}}const aA={targets:[],duration:200,repeat:5,props:{alpha:{start:1,to:.1}}};class rA extends Ee{constructor(e){super(aA,e)}}class oA extends Phaser.GameObjects.BitmapText{scene;flickerAnimation;constructor(e){super(e,0,0,k.PRIMARY.KEY),this.scene=e;const t=this.scene.fontSize(14);this.setFontSize(t),this.setOrigin(.5,.5),this.setNotifyText(this.scene.lang.Text.LOADING_INTER_AD),this.setVisible(!1),this.scene.add.existing(this)}show(){this.setVisible(!0),this.runTextAnimation()}setNotifyText(e){this.setText(e)}runTextAnimation(){this.flickerAnimation||(this.flickerAnimation=new rA({targets:[this],yoyo:!0,duration:300,repeat:3,ease:"Sine.easeInOut",onStart:()=>{this.setVisible(!0)},onComplete:()=>{this.setVisible(!1)}})),this.flickerAnimation?.play()}}const{KEY:cA,FRAME:rr}=D.EFFECTS;class dl extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitZone;emitter;constructor(e){super(e,cA,rr.FX_STAR_YELLOW),this.createEmitZone(),this.scene.add.existing(this)}createEmitZone(){this.emitZone=new Phaser.Geom.Rectangle}createEmitters(){const e=1/this.scene.world.getPixelRatio();this.emitter=this.createEmitter({on:!1,frame:rr.FX_STAR_YELLOW,emitZone:{source:this.emitZone,type:"random"},timeScale:1,frequency:100,alpha:{start:1,end:0,ease:Phaser.Math.Easing.Expo.Out},scale:{start:e*1,end:0,ease:Phaser.Math.Easing.Expo.Out},lifespan:{min:800,max:1500}})}run(e,t,s,n,a){this.stop(),this.reset(),this.emitZone.setSize(n,a),this.emitZone.setPosition(t-n/2,s-a/2),this.emitter.setQuantity(e),this.emitter.start()}stop(){this.emitter?.killAll(),this.emitter?.stop()}reset(){this.createEmitters()}}const{KEY:lA,FRAME:hA}=D.DEFAULT;class qn extends Phaser.GameObjects.Container{cat;effect;constructor(e){super(e),this.createEffect(),this.createCat(),this.runCatAnimation(),this.scene.add.existing(this)}runStarTwinkle=()=>{const{x:e,y:t,displayWidth:s,displayHeight:n}=this.cat,a=t-20;this.effect.run(1,e,a,s,n)};createCat(){this.cat=this.scene.make.image({key:lA,frame:hA.THE_CAT,origin:{x:.5,y:1}}),this.cat.setWorldSize(204.5,112.5),this.cat.setY(this.cat.height/2),this.add(this.cat)}createEffect(){this.effect=new dl(this.scene),this.add(this.effect)}runCatAnimation(){new qe({targets:[this.cat],duration:1e3,props:{scale:"+=0.02"}}).play()}}class uA extends Phaser.GameObjects.Container{scene;theCat;board;levelText;scoreTargetText;boardAnimation;theCatAnimation;textsAnimation;existAnimation;constructor(e){super(e),this.scene=e,this.createBoard(),this.createLevelText(),this.createTargetText(),this.createTheCat(),this.scene.add.existing(this)}setLevel(e){this.levelText.setText(`${this.scene.lang.Text.MILESTONE} ${e}`)}setScoreTarget(e){this.scoreTargetText.setText(`${this.scene.lang.Text.TARGET}: ${e}`)}runAnimation=()=>{this.scene.tweens.killTweensOf(this.getAll()),this.setVisible(!0),this.runBoardAnimation(),this.runCatAnimation(),this.runTextsAnimation()};createBoard(){this.board=new Je(this.scene,0,0,600,102),this.board.setDepth(Y.BACKGROUND),this.add(this.board)}createTheCat(){this.theCat=new qn(this.scene),this.theCat.setDepth(Y.LOGO),this.add(this.theCat),Phaser.Display.Align.In.Center(this.theCat,this.board,-140,-17)}createLevelText(){this.levelText=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(22),depth:Y.TEXT,origin:{x:.5,y:.5}}),this.add(this.levelText),this.levelText.setTint(12010469),Phaser.Display.Align.In.Center(this.levelText,this.board,25,-20)}createTargetText(){this.scoreTargetText=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(26),depth:Y.TEXT,origin:{x:.5,y:.5}}),this.add(this.scoreTargetText),this.scoreTargetText.setTint(11632977),Phaser.Display.Align.In.Center(this.scoreTargetText,this.board,25,10)}runBoardAnimation(){if(!this.boardAnimation){const e=this.board.y;this.boardAnimation=new ct({targets:[this.board],duration:300,props:{y:{start:e+80,to:e}}})}this.boardAnimation.play()}runCatAnimation(){if(!this.theCatAnimation){const e=this.theCat.x,t=-80;this.theCatAnimation=new ct({targets:[this.theCat],ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.75],delay:150,duration:600,props:{alpha:{start:0,from:0,to:1},scale:{start:.3,to:1},x:{start:e+t,to:e}}})}this.theCatAnimation.play()}runTextsAnimation(){this.levelText.setAlpha(0),this.scoreTargetText.setAlpha(0),this.textsAnimation||(this.textsAnimation=new ct({targets:[this.levelText,this.scoreTargetText],duration:500,delay:this.scene.tweens.stagger(100,{start:200}),props:{x:{start:-200,to:20},alpha:{start:0,from:0,to:1}},completeDelay:600,onComplete:this.runExistAnimation})),this.textsAnimation.play()}runExistAnimation=()=>{if(!this.existAnimation){const t=this.getAll();this.existAnimation=new ct({targets:t,duration:300,ease:Phaser.Math.Easing.Back.In,props:{y:{getStart:s=>s.y,getEnd:s=>s.y+-150}},onComplete:()=>{Phaser.Actions.IncY(t,150),this.setVisible(!1)}})}this.existAnimation.play()}}const{KEY:or,FRAME:cr}=D.GAMEPLAY;class dA{scene;header;opponentInfo;showAdNotify;gameOverBoard;startLevelBoard;giftItem;paintItem;hammerItem;shuffleItem;gameOverTool;nextLevelTool;group;constructor(e){this.scene=e,this.createGroup(),this.createObjects()}getAll(){return this.group.getChildren()}createGroup(){this.group=this.scene.add.group()}createObjects(){this.createHeader(),this.createOpponentInfo(),this.createShowAdNotify(),this.createGameOverBoard(),this.createStartLevelBoard(),this.createGiftItem(),this.createPaintItem(),this.createHammerItem(),this.createShuffleItem(),this.createDevTools()}createHeader(){this.header=new WS(this.scene),this.group.add(this.header)}createOpponentInfo(){this.opponentInfo=new nA(this.scene),this.group.add(this.opponentInfo),this.opponentInfo.setDepth(Y.ITEM),this.opponentInfo.kill()}createShowAdNotify(){this.showAdNotify=new oA(this.scene),this.group.add(this.showAdNotify)}createGameOverBoard(){this.gameOverBoard=new tA(this.scene),this.group.add(this.gameOverBoard),this.gameOverBoard.setDepth(Y.POPUP)}createStartLevelBoard(){this.startLevelBoard=new uA(this.scene),this.group.add(this.startLevelBoard),this.startLevelBoard.setDepth(Y.POPUP)}createGiftItem(){this.giftItem=new $S(this.scene),this.group.add(this.giftItem)}createPaintItem(){this.paintItem=new ll(this.scene),this.group.add(this.paintItem)}createHammerItem(){this.hammerItem=new cl(this.scene),this.group.add(this.hammerItem)}createShuffleItem(){this.shuffleItem=new qS(this.scene),this.group.add(this.shuffleItem)}createDevTools(){GameCore.Utils.Valid.isDebugger()&&(this.createGameOverButton(),this.createNextLevelButton())}createGameOverButton(){this.gameOverTool=new ee(this.scene,or,cr.BUTTON_SETTING),this.group.add(this.gameOverTool),this.gameOverTool.setAlpha(.02),this.gameOverTool.setName("GameOver"),this.gameOverTool.button.setTint(6291256)}createNextLevelButton(){this.nextLevelTool=new ee(this.scene,or,cr.BUTTON_PLUS),this.group.add(this.nextLevelTool),this.nextLevelTool.setAlpha(.02),this.nextLevelTool.setName("NextLevel"),this.nextLevelTool.button.setTint(6291256)}}class pA{scene;objects;allUI;groups;constructor(e){this.scene=e,this.objects=null,this.createGroups()}setUIObjects(e){this.objects=e,this.allUI.addMultiple(this.objects.getAll())}createGroups(){this.groups={},this.allUI=this.scene.add.group(),this.groups.allUI=this.allUI}killAllUI(){this.allUI.killGroup()}reviveAllUI(){this.allUI.reviveGroup()}}class pl extends pA{guideUI;alignUI(){if(this.objects===null)return;const{gameZone:e}=this.scene;Phaser.Display.Align.In.TopCenter(this.objects.header,e),Phaser.Display.Align.In.TopCenter(this.objects.opponentInfo,e,0,-115),Phaser.Display.Align.In.TopCenter(this.objects.showAdNotify,e,0,-200),Phaser.Display.Align.In.Center(this.objects.gameOverBoard,e,0,25),Phaser.Display.Align.In.Center(this.objects.startLevelBoard,e,0,25),GameCore.Utils.Valid.isDebugger()&&(Phaser.Display.Align.In.TopCenter(this.objects.gameOverTool,e,-80,-100),Phaser.Display.Align.In.TopCenter(this.objects.nextLevelTool,e,80,-100)),Phaser.Display.Align.In.TopCenter(this.objects.giftItem,e,-148,-50),Phaser.Display.Align.In.TopCenter(this.objects.paintItem,e,-148,-130),Phaser.Display.Align.In.TopCenter(this.objects.hammerItem,e,148,-50),Phaser.Display.Align.In.TopCenter(this.objects.shuffleItem,e,148,-130)}createGroups(){super.createGroups(),this.guideUI=this.scene.add.group(),this.groups.guideUI=this.guideUI}setUIObjects(e){super.setUIObjects(e),this.addUIObjectsToGroups()}addUIObjectsToGroups(){this.objects!==null&&this.addObjectForGuideUI()}addObjectForGuideUI(){this.objects}}class mA extends pl{alignUI(){if(super.alignUI(),this.objects===null)return;const{gameZone:e}=this.scene;GameCore.Utils.Valid.isDebugger()&&(Phaser.Display.Align.In.TopCenter(this.objects.gameOverTool,e,-80,-100),Phaser.Display.Align.In.TopCenter(this.objects.nextLevelTool,e,80,-100)),Phaser.Display.Align.In.TopLeft(this.objects.giftItem,this.objects.header,65,0),Phaser.Display.Align.In.TopLeft(this.objects.paintItem,this.objects.header,65,-80),Phaser.Display.Align.In.TopRight(this.objects.hammerItem,this.objects.header,65,0),Phaser.Display.Align.In.TopRight(this.objects.shuffleItem,this.objects.header,65,-80)}}const{STATUS:tn}=is;class gA extends dt{scene;layout;objects;constructor(e){super(e),this.scene=e,this.createObjects(),this.createLayouts()}createObjects(){this.objects=new dA(this.scene)}createLayouts(){this.scene.world.isLandscape()?this.layout=new mA(this.scene):this.layout=new pl(this.scene),this.layout.setUIObjects(this.objects)}init(){this.initUILogic(),this.layout.alignUI(),this.objects.opponentInfo.kill(),this.setState(tn.READY)}start(){this.isRunning()||(this.updateUIState(),this.setState(tn.RUNNING))}stop(){this.isRunning()&&this.setState(tn.STOPPED)}initUILogic(){GameCore.Utils.Valid.isDebugger()&&(this.objects.gameOverTool.onClick=()=>{this.scene.die()},this.objects.nextLevelTool.onClick=()=>{const{targetScore:e}=this.scene.levelHandler;this.scene.setScore(e),this.scene.levelUp()})}updateUIState(){this.objects.giftItem.checkUseable(),this.scene.gameplayMode===Ge&&this.showAvatarInChallengeMode()}showAvatarInChallengeMode(){const{storage:e,player:t,layoutManager:s}=this.scene,n=e.getState(),{objects:a}=s,{_id:r,whitePlayerId:c,whitePlayerScore:o,blackPlayerScore:l,whitePlayerFinish:h,blackPlayerFinish:d}=Ns(n);if(!r){a.opponentInfo.kill;return}const p=t.getPlayerId()===c,m=p?d:h,g=_t(n);console.log("Get opponent info: ",g);const y=p?l:o;a.opponentInfo.revive(),a.opponentInfo.updateInfo(g.playerId,g.name,g.photo,m&&y)}showPauseScreen(){const{screen:e}=this.scene;let t=e.get(U.PAUSE_SCREEN);t||(t=e.add(U.PAUSE_SCREEN,CS)),e.open(U.PAUSE_SCREEN)}showRewardScreen(e){const{screen:t}=this.scene;let s=t.get(U.REWARD_SCREEN);s||(s=t.add(U.REWARD_SCREEN,Kc)),t.open(U.REWARD_SCREEN,{awardDiamonds:e})}showRescueScreen(){const{screen:e}=this.scene;let t=e.get(U.RESCUE_SCREEN);t||(t=e.add(U.RESCUE_SCREEN,vS)),e.open(U.RESCUE_SCREEN)}}const{ApiHost:Ii}=GameCore.Configs,fA=async i=>(await Xt("matches",{opponentPlayerId:i},{},Ii))?.data||{},EA=async i=>{const e=`matches/${i}/join`;return(await Xt(e,{},{},Ii))?.data||{}},yA=async i=>{const e=`matches/${i}`;return(await $t(e,{},Ii))?.data||{}},SA=async(i,e,t,s)=>{const n=`matches/${i}/finish`;return(await Xt(n,{matchId:i,score:e,level:t,extraData:s},{},Ii))?.data||{}};class me extends Error{constructor(e,t){super(e,t),this.name="InvalidMatchId",this.message=e||"Invalid match id",this.payload=t}}class bi extends Error{constructor(e,t){super(e,t),this.name="InvalidMatchStatus",this.message=e||"The match status is not valid",this.payload=t}}let ml=class extends Error{constructor(e,t){super(e,t),this.name="InvalidOpponentId",this.message=e||"Invalid opponent id",this.payload=t}};class AA extends Error{constructor(e,t){super(e,t),this.name="InvalidBlackPlayerId",this.message=e||"Invalid black player id",this.payload=t}}class gl extends Error{constructor(e,t){super(e,t),this.name="InvalidRequestedMatchId",this.message=e||"The matchId in match data not matched with requested matchId",this.payload=t}}class TA extends Error{constructor(e,t){super(e,t),this.name="InvalidScore",this.message=e||"The score is not valid",this.payload=t}}class IA extends Error{constructor(e,t){super(e,t),this.name="InvalidWhitePlayerId",this.message=e||"Invalid white player id",this.payload=t}}const bA=i=>{const{matchId:e,score:t}=i;if(e===""||typeof e!="string")throw new me(null,{matchId:e});if(typeof t!="number")throw new TA(null,{score:t})},wA=i=>{const{matchId:e,currentMatchId:t}=i;if(e===""||typeof e!="string")throw new me(null,{matchId:e});if(t===""||typeof t!="string")throw new me(null,{currentMatchId:t});if(e!==t)throw new gl(null,{matchId:e,currentMatchId:t})},CA=i=>{const{matchId:e,currentMatchId:t}=i;if(e===""||typeof e!="string")throw new me(null,{matchId:e});if(t===""||typeof t!="string")throw new me(null,{currentMatchId:t});if(e!==t)throw new gl(null,{matchId:e,currentMatchId:t})},Zn=i=>{const{playerId:e,match:t}=i,{_id:s,playerId:n,status:a}=t;if(s===""||typeof s!="string")throw new me(null,{matchId:s});if(a==="finished"||typeof a!="string")throw new bi("This match is finished",{status:a});if(n!==e)throw new Yn(null,{playerId:n,currentPlayerId:e})},vA=i=>{const{opponentId:e}=i;if(e===""||typeof e!="string")throw new ml(null,{opponentId:e})},wi=i=>{const{matchId:e}=i;if(e===""||typeof e!="string")throw new me(null,{matchId:e})},Ci=i=>{const{match:e}=i,{_id:t,whitePlayerId:s,blackPlayerId:n}=e;if(t===""||typeof t!="string")throw new me(null,{matchId:t});if(s===""||typeof s!="string")throw new IA(null,{whitePlayerId:s});if(n===""||typeof n!="string")throw new AA(null,{blackPlayerId:n})},{Match:Kt}=GameCore.Configs,fl=i=>{try{return GameCore.Utils.Hash.stringToHash(JSON.stringify(i))}catch{return""}},_A=i=>{try{return JSON.parse(GameCore.Utils.Hash.hashToString(i))}catch{return""}},El=()=>async i=>{try{const{player:e,globalScene:t}=window.game;t.screen.open(U.NOTIFY_SCREEN,{message:t.lang.Text.LOADING,loading:!0}),i({type:tc,payload:{}});const s=e.getPlayerId(),n={...Kt.LocalSingleMatchDefault,status:"active",playerId:s,startedAt:Date.now()};Zn({playerId:s,match:n}),i(jt(n)),zt(Kt.SingleMatchStore,n)}catch(e){if(i(jt(null)),e instanceof me||e instanceof bi)return;j(e)}},OA=()=>i=>{try{const{player:e}=window.game;i({type:sc,payload:{}});const t=e.getPlayerId(),s=vn(Kt.SingleMatchStore)||{},{data:n}=s;s.data=_A(n),Zn({playerId:t,match:s}),i(jt(s))}catch(e){if(i(jt(null)),e instanceof me||e instanceof Yn||e instanceof bi)return;j(e)}},lr=(i,e)=>(t,s)=>{try{bA({matchId:i,...e});const n=s(),a=Wt(n);wA({matchId:i,currentMatchId:a}),t({type:ic,payload:{match:e}});const{data:r}=e;e.data=fl(r),zt(Kt.SingleMatchStore,e)}catch(n){if(n instanceof me)return;j(n)}},RA=i=>async(e,t)=>{try{const{player:s}=window.game;wi({matchId:i});const n=t(),a=Wt(n),r=s.getPlayerId();CA({matchId:i,currentMatchId:a}),e({type:qp,payload:{matchId:i}});const c=FE(n);Zn({playerId:r,match:c});const o={...Kt.LocalSingleMatchDefault,...c,_id:i,status:"finished",playerId:r,finishAt:Date.now()};e(jt(o));const{data:l}=o,h={...o};h.data=fl(l),zt(Kt.SingleMatchStore,h)}catch(s){if(e(jt(null)),s instanceof me||s instanceof bi)return;j(s)}},jt=i=>({type:nc,payload:{match:i}}),vi=()=>({type:ac,payload:{}}),PA=i=>async e=>{try{const{profile:t,globalScene:s}=window.game;s.screen.open(U.NOTIFY_SCREEN,{message:s.lang.Text.LOADING,loading:!0});const{playerId:n}=i;vA({opponentId:n}),e({type:oc,payload:{opponentInfo:i}});const a=await fA(n);Ci({match:a}),await t.requestProfiles([n]),e(lt(a))}catch(t){if(e(lt(null)),t instanceof me||t instanceof ml)return;j(t)}},DA=i=>async e=>{try{const{player:t,profile:s,globalScene:n}=window.game;n.screen.open(U.NOTIFY_SCREEN,{message:n.lang.Text.LOADING,loading:!0}),wi({matchId:i}),e({type:rc,payload:{matchId:i}});const a=await EA(i);Ci({match:a});const{status:r,whitePlayerId:c,blackPlayerId:o}=a;if(r===Vt){const d=t.getPlayerId()===c?o:c;await s.requestProfiles([d])}e(lt(a))}catch(t){if(e(lt(null)),t instanceof me)return;j(t)}},MA=(i,e)=>async t=>{try{const{player:s,globalScene:n}=window.game;n.screen.open(U.NOTIFY_SCREEN,{message:n.lang.Text.LOADING,loading:!0}),wi({matchId:i}),t({type:lc,payload:{matchId:i,opponentInfo:e}});const a=await yA(i);Ci({match:a});const{whitePlayerId:r,whitePlayerScore:c,blackPlayerScore:o}=a,l=s.getPlayerId(),{score:h}=s.getPlayerData();t(lt(a,{score:l===r?c:o,bestScore:h}))}catch(s){if(t(lt(null)),s instanceof me)return;j(s)}},LA=(i,e,t)=>async s=>{try{const{globalScene:n}=window.game;n.screen.open(U.NOTIFY_SCREEN,{message:n.lang.Text.LOADING,loading:!0}),wi({matchId:i}),s({type:cc,payload:{matchId:i,score:e,extraData:t}});const{level:a}=t,r=await SA(i,e,a,t);Ci({match:r}),await s(lt(r))}catch(n){if(s(lt(null)),n instanceof me)return;j(n)}},lt=(i,e,t=null)=>({type:Bn,payload:{match:i,opponentInfo:e,current:t}}),xA=()=>({type:hc,payload:{}}),NA=i=>({type:uc,payload:{opponentInfo:i}}),kA=()=>({type:dc,payload:{}}),GA=()=>async i=>{const{player:e}=window.game,{playerId:t,name:s,photo:n}=e.getPlayer();i({type:pc,payload:{playerId:t}});const a={};new Array(20).fill(null).map((r,c)=>{const o=`0${c+1}`;a[o]={playerId:o,name:`MPlayer ${o}`,photo:"./assets/images/others/avatar.png"}}),a[t]={playerId:t,name:s,photo:n},i(BA("mock",a))},BA=(i,e)=>({type:Un,payload:{matchId:i,players:e}}),yl=i=>({type:Jo,payload:{playerId:i}}),Jn=(i,e)=>({type:Qo,payload:{playerId:i,stats:e}}),Ds=i=>({type:ec,payload:{stats:i}});class UA extends Phaser.GameObjects.Zone{constructor(e,t,s){super(e,0,0,t,s),this.setOrigin(0,0)}}class ns extends Phaser.Scene{unsubscribeList;gameZone;background;handleOpenScene=()=>{this.logPageviewOnOpen(),this.logEventOpen()};constructor(){super({visible:!1})}create(){this.events.on("wake",this.handleOpenScene),this.events.on("resume",this.handleOpenScene),this.events.on("create",this.handleOpenScene),this.scaleGame(),this.createGameZone()}scaleGame(){const e=this.getCamera("main"),t=this.world.getZoomRatio(),{width:s,height:n}=this.world.getWorldSize();e.setZoom(t),e.centerOn(s/2,n/2)}createGameZone(){const{width:e,height:t}=this.world.getWorldSize();this.gameZone=new UA(this,e,t)}getCamera(e){return e==="main"?this.cameras.main:this.cameras.getCamera(e)}createMask(e=1){this.getCamera("main").setBackgroundColor(`rgba(0, 0, 0, ${e})`)}fontSize(e){let t=2.4;return this.lang.getCurrentLanguage()==="ja"&&(t=1.4),e/t}createBackground(e,t,s,n){this.background?(this.background.setTexture(e),t&&this.background.setFrame(t)):this.background=this.make.image({key:e,frame:t}),this.background.setName(e);const{displayWidth:a,displayHeight:r}=this.gameZone;this.background.setDisplaySize(a,r),GameCore.Utils.Valid.isNumber(s)&&this.background.setAlpha(s),GameCore.Utils.Valid.isNumber(n)&&this.background.setTint(n),Phaser.Display.Align.In.Center(this.background,this.gameZone)}handleStateChange(e){this.unsubscribeList=[],e.forEach(t=>{const{selector:s,callback:n}=t,a=this.storage.watch(s,n);this.unsubscribeList.push(a)}),this.events.once("sleep",this.removeStateChange),this.events.once("destroy",this.removeStateChange),this.events.once("shutdown",this.removeStateChange)}removeStateChange=()=>{this.unsubscribeList.forEach(e=>e())};logPageviewOnOpen(){this.analytics.pageview(this.scene.key)}logEventOpen(){this.analytics.event(z.SCREEN_OPEN,{screen_name:this.getSceneName()})}getSceneName(){return GameCore.Utils.String.toUpperCamelCase(this.scene.key.toLowerCase())}}const{Match:sn,Gameplay:gt,Ads:FA}=GameCore.Configs;class YA extends ns{prevScore=0;gameplayMode;currentScore=0;currentDiamond=0;prevTargetScore=0;isReachTargetScore=!1;fireworks;bonusScoreAnimation;totalScoreAnimation;encouragingAnimation;levelHandler;tileManager;modeManager;itemManager;boardManager;layoutManager;tutorialManager;missionsManager;animationManager;saveTimer;preload(){this.events.on(Phaser.Scenes.Events.WAKE,this.run),this.events.on(Phaser.Scenes.Events.CREATE,this.run)}create=()=>{super.create(),this.createBackground(fe.BACKGROUND.KEY),this.createHandler(),this.createManager(),this.fireworks=this.add.group(),this.createAnimations(),this.listenEvents(),this.addGlobalMethodsForGlance()};addGlobalMethodsForGlance=()=>{const e=()=>{this.screen.get(U.PAUSE_SCREEN)?.visible&&this.screen.close(U.PAUSE_SCREEN)},t=()=>{this.screen.get(U.REWARD_SCREEN)?.visible&&this.screen.close(U.REWARD_SCREEN)};window.pauseEvent=()=>{this.screen.get(U.PAUSE_SCREEN)?.visible||this.layoutManager.showPauseScreen()},window.resumeEvent=()=>{e()},window.replayGameEvent=async()=>{e(),t(),this.player.updateBestScore(this.currentScore),this.analytics.levelFail(this.levelHandler.level),await this.storage.dispatch(ta()),this.replay()},window.nextLevelEvent=()=>{e(),t(),this.levelUp()},window.gotoHomeEvent=()=>{e(),t(),this.player.updateBestScore(this.currentScore),this.analytics.levelFail(this.levelHandler.level),this.scene.switch($.DASHBOARD_SCENE)},window.gotoLevel=s=>{console.warn("gotoLevel: method is not implemented")}};createHandler(){this.levelHandler=new _y(this)}initHandler(){this.levelHandler.init()}createManager(){this.layoutManager=new gA(this),this.tileManager=new dS(this),this.modeManager=new By(this),this.itemManager=new hy(this),this.boardManager=new JE(this),this.tutorialManager=new bS(this),this.missionsManager=new Gy(this),this.animationManager=new _E(this)}initManager(){this.boardManager.init(),this.tileManager.init(),this.modeManager.init(),this.itemManager.init(),this.tutorialManager.init(),this.missionsManager.init(),this.animationManager.init(),this.layoutManager.init()}stopManager(){this.boardManager.stop(),this.tileManager.stop(),this.modeManager.stop(),this.itemManager.stop(),this.tutorialManager.stop(),this.missionsManager.stop(),this.animationManager.stop(),this.layoutManager.stop()}startManager(){this.tutorialManager.start(),this.boardManager.start(),this.tileManager.start(),this.modeManager.start(),this.itemManager.start(),this.missionsManager.start(),this.animationManager.start(),this.layoutManager.start()}listenEvents(){X.on(li.RESCUE,this.rescued),X.on(li.REPLAY,this.replay)}run=()=>{this.startGame(),this.checkAndAddShortcut()};startGame(){const e=this.storage.getState();this.gameplayMode=vt(e),this.prevScore=gt.StartScore,this.prevTargetScore=0,this.initHandler(),this.initManager();const t=this.player.getDiamond();let s=gt.StartDiamonds;if(typeof t=="number"&&t>gt.StartDiamonds&&(s=t),this.gameplayMode===Ye&&sn.ContinueSingleMatchEnabled){const n=nl(e),a=YE(e);if(n&&a>0){const r=il(e),c=HE(e);this.prevScore=r,s=c>s?s:c,this.levelHandler.level=a,this.levelHandler.setConfig(a)}}this.setDiamond(s),this.setScore(this.prevScore),this.runStartLevelAnimation(),this.audio.playSound(K.START_GAME),this.time.addEvent({delay:gt.DelayStart,callback:()=>{this.startManager();const{level:n}=this.levelHandler;this.analytics.levelStart(n,this.currentScore),this.checkContinueSingleMatch()}})}checkContinueSingleMatch(){this.gameplayMode===Ye&&(this.tileManager.isCanMove()||this.tileManager.updateFreezeTiles(!0))}createAnimations(){this.bonusScoreAnimation=new Gg(this),this.totalScoreAnimation=new Fg(this),this.encouragingAnimation=new Ug(this)}runStartLevelAnimation(){const{targetScore:e,level:t}=this.levelHandler,{startLevelBoard:s}=this.layoutManager.objects;s.setLevel(t),s.setScoreTarget(e),t>1&&this.audio.playSound(K.START_LEVEL),s.runAnimation()}runGameOverAnimation(){this.audio.playSound(K.YOU_LOSE);const{objects:e}=this.layoutManager;e.gameOverBoard.runAnimation()}runBonusScoreAnimation(e){this.bonusScoreAnimation.setBonusScore(e),this.bonusScoreAnimation.runAnimation()}runTotalScoreAnimation(e,t,s){this.totalScoreAnimation.setTotalScore(e),this.totalScoreAnimation.runAnimation(t,s),X.emit(ue.REACH_SCORE.EVENTS.ADD_SCORE,{type:"score",value:e})}runEncouragingAnimation(e){this.encouragingAnimation.runAnimation(e),this.fireFireworks()}createFirework(){const e=new Nc(this);return this.fireworks.add(e),e}fireFireworks(){const{objects:e}=this.layoutManager,{topBar:t}=e.header;this.tweens.addCounter({duration:300,repeat:Phaser.Math.RND.between(3,6),onRepeat:()=>{const s=this.fireworks.getMatching("visible",!1);let n=s[0];s.length<1&&(n=this.createFirework()),n.randomColor();const a=Phaser.Math.RND.between(50,this.gameZone.width-50);n.fire(a,this.gameZone.height,t.y+100)}})}setScore(e){const{objects:t}=this.layoutManager,{currentScoreBar:s,targetScoreBar:n}=t.header.topBar;s.setScore(e),this.currentScore=e,this.updateScore();const{targetScore:a}=this.levelHandler;this.isReachTargetScore=this.currentScore>=a;const r=Phaser.Math.Percent(this.currentScore,this.prevTargetScore,a);n.setProcess(r)}useDiamond(e){const t=this.currentDiamond-e,s=t<0?0:t;this.setDiamond(s)}eatDiamond=e=>{X.emit(ue.COLLECT_DIAMONDS.EVENTS.COLLECT_DIAMONDS,{type:"diamond",value:e}),this.setDiamond(this.currentDiamond+e)};setDiamond(e){this.currentDiamond=e,console.log("Current diamonds",this.currentDiamond),this.player.setCustomData("diamond",e),this.storage.dispatch(Ds({diamond:e}))}setTargetScore(e){const{objects:t}=this.layoutManager,{targetScoreBar:s}=t.header.topBar;s.setScore(e)}eatScore=e=>{this.currentScore+=e;const{targetScore:t}=this.levelHandler;this.currentScore>=t&&!this.isReachTargetScore&&(this.runEncouragingAnimation(xe.CONGRATULATION),this.audio.playSound(K.CONGRATULATION)),this.setScore(this.currentScore),this.updateMove()};die=()=>{this.tileManager.isSelectable=!1,this.tileManager.isUseableItem=!1,this.clearMove(),this.runGameOverAnimation();const e=this.storage.getState(),t=sg(e);this.time.addEvent({delay:gt.DelayFinishGame,callback:()=>{if(t<sn.MaxRescueCount&&FA.Enabled){this.analytics.gameLifeEnd(1,0,this.currentScore),this.layoutManager.showRescueScreen();return}this.endGame()}})};rescued=()=>{this.setScore(this.prevScore),this.runStartLevelAnimation(),this.initManager(),this.time.addEvent({delay:gt.DelayStart,callback:()=>{this.startManager(),this.updateMove()}})};replay=()=>{this.startGame()};endGame(){this.analytics.levelFail(this.levelHandler.level,this.currentScore),this.clearMove(),this.prevTargetScore=0,this.storage.dispatch(In())}levelUp=()=>{this.stopManager();const{targetScore:e,level:t}=this.levelHandler;if(!this.levelHandler.up(this.currentScore)){this.die();return}X.emit(ue.PASS_LEVELS.EVENTS.PASS_LEVEL,{type:"level",value:1}),this.analytics.levelComplete(t,this.currentScore),this.analytics.gameMilestone("reach_milestone",{milestone:t+1},0,this.currentScore),this.clearMove(),this.prevTargetScore=e,this.prevScore=this.currentScore,this.setScore(this.currentScore),this.fireFireworks(),this.runStartLevelAnimation(),this.time.addEvent({delay:gt.DelayLevelUp,callback:this.handleNextLevel})};handleNextLevel=async()=>{await this.handleShowAdWhenNextLevel(),this.initManager(),this.startManager(),this.updateMove();const{level:e}=this.levelHandler;this.analytics.levelStart(e,this.currentScore)};handleShowAdWhenNextLevel=async()=>{if(this.audio.pauseMusic(),this.audio.muteAll(),this.ads.canbeShowInterstitialAd()){this.game.globalScene.screen.open(U.NOTIFY_SCREEN,{message:this.lang.Text.LOADING_ADS,duration:0,loading:!0});try{await this.ads.showInterstitialAdAsync()}catch(t){console.log("Show ad error",t)}this.ads.preloadInterstitialAdAsync().catch(()=>{}),this.game.globalScene.screen.close(U.NOTIFY_SCREEN)}this.audio.unmuteAll(),this.audio.playMusic();const{objects:e}=this.layoutManager;e.showAdNotify.setVisible(!1)};updateScore=hi(()=>{this.storage.dispatch(Ds({score:this.currentScore,level:this.levelHandler.level}))},1e3);updateMove=()=>{sn.ContinueSingleMatchEnabled&&this.gameplayMode===Ye&&(this.saveTimer?.remove(),this.saveTimer=this.time.addEvent({delay:1500,callback:()=>{if(!this.tileManager.isCanMove())return;const e=this.boardManager.tileMap,t=GameCore.Utils.Hash.encodeMap(e,W.HASH),s=this.storage.getState(),n=Wt(s),{level:a}=this.levelHandler;this.storage.dispatch(lr(n,{level:a,score:this.currentScore,data:{fen:t,diamond:this.currentDiamond},updateAt:Date.now()}))}}))};clearMove=()=>{const e=this.storage.getState(),t=Wt(e),{level:s}=this.levelHandler;this.storage.dispatch(lr(t,{level:s,score:this.currentScore,data:{fen:"",diamond:this.currentDiamond},updateAt:Date.now()}))};checkAndAddShortcut(){if(this.game.player.getPlayer().isUserNew)return;const t=this.storage.getState();Mc(t)!=Xe&&this.facebook.attemptToAddShortcut()}}const Tt=YA,It="global",Yt="friend",{ApiHost:HA,OtherHost:Qn,LeadersBoard:VA}=GameCore.Configs,{Prefix:Sl,LeaderboardId:Ot,Name:ea}=VA,WA=`${Sl}/${Ot}/leaders`,KA=`${Sl}/${Ot}/players`,Al=i=>{let e="";return Ot&&(i===It?e=WA:i===Yt&&(e=KA)),e},Tl=async i=>{const e=i.map(r=>r.playerId),t=GameCore.Utils.Object.keyBy(i,"playerId"),s=GameCore.Utils.String.params({playerIds:e});return(await $t(`players?${s}`,{},HA)).data.map(r=>{const c=t[r.playerId];return{...r,score:c.score,rank:c.rank,getScore:()=>c.score,getFormattedScore:()=>"",getTimestamp:()=>new Date().valueOf(),getRank:()=>c.rank,getExtraData:()=>c.extraData,getPlayer:()=>({getName:()=>r.name,getPhoto:()=>r.photo,getID:()=>r.playerId})}})},jA=async(i={})=>Ot!=""?zA(i):$A(i),zA=async(i={})=>{let e=[];const t=Al(It);if(!t)return e;const s=GameCore.Utils.String.params(i),a=(await $t(`${t}?${s}`,{},Qn))?.data||[];return a.length<1?e:(e=a,Tl(e))},$A=async(i={})=>{const{limit:e,offset:t}=i;return await(await window.GameSDK.getLeaderboardAsync(ea)).getEntriesAsync(e,t)},XA=async(i={})=>Ot!=""?qA(i):ZA(i),qA=async(i={})=>{let e=[];const t=Al(Yt);if(!t)return e;const s=GameCore.Utils.String.params(i),a=(await $t(`${t}?${s}`,{},Qn))?.data||[];return a.length<1?e:(e=a,Tl(e))},ZA=async(i={})=>{const{limit:e,offset:t}=i;return await(await window.GameSDK.getLeaderboardAsync(ea)).getConnectedPlayerEntriesAsync(e,t)},JA=async(i,e)=>Ot!=""?QA(i,e):eT(e),QA=async(i,e)=>(await Xt(`leaderboards/${Ot}/players/${i}`,{score:e},{},Qn))?.data||{},eT=async i=>await(await window.GameSDK.getLeaderboardAsync(ea)).setScoreAsync(i);class tT extends Error{constructor(e,t){super(e,t),this.name="NewScoreIsBad",this.message=e||"The new score is bad",this.payload=t}}class sT extends Error{constructor(e,t){super(e,t),this.name="InvalidOpponentId",this.message=e||"This opponentId is not valid",this.payload=t}}class Il extends Error{constructor(e,t){super(e,t),this.name="WideFrameRenderFail",this.message=e||"Wide frame render fail",this.payload=t}}const iT=i=>de(i).stats.data,nT=i=>de(i).stats.current,as=V([iT],i=>i),Rt=V([nT],i=>i),aT=i=>i.messages.data,rT=(i,e)=>e.opponentId,bl=V([aT],i=>i),oT=V([bl,rT],(i,e)=>!GameCore.Utils.Valid.isString(e)||!GameCore.Utils.Object.hasOwn(i,e)?!1:i[e].sent),cT=i=>{if(typeof i!="string"||!i)throw new Il(null,{imageShare:i})},hr=async i=>{const{player:e,globalScene:t}=window.game,s=as(i),{playerId:n,photo:a}=e.getPlayer(),{score:r}=s[n]||{},c=lT({playerId:n,playerPhoto:a,playerScore:r});if(!c){console.warn("getRenderOptionsCurrentScore");return}const o={name:"share-current-score",width:952,height:492,renderOptions:c};return await t.frameCapture.capture(o)},lT=i=>{const{playerId:e="10",playerPhoto:t="",playerScore:s=0}=i;return typeof e!="string"||typeof t!="string"||typeof s!="number"?null:{avatar:{name:`${e}`,type:"image",x:634,y:118,image:t,width:240,height:240,fallbackWithImage:fe.AVATAR.KEY},wideFrame:{name:"wide-frame-message-win",type:"image",x:0,y:0,image:"./assets/wideframes/wide-frame-message-win.png",width:952,height:492},playerScoreShadow:{type:"text",x:760,y:454,font:"600 70px",fillStyle:"#c4683f",text:`${s}`,textAlign:"center"},playerScore:{type:"text",x:760,y:450,font:"600 70px",fillStyle:"#f2a62e",text:`${s}`,textAlign:"center"}}},hT=()=>async(i,e)=>{const{player:t,analytics:s,facebook:n,globalScene:a}=window.game;try{a.screen.open(U.NOTIFY_SCREEN,{message:a.lang.Text.LOADING,loading:!0});const r=e(),c=await Gs(r);cT(c);const{playerId:o,name:l,photo:h}=t.getPlayer();await n.shareAsync({text:"Pheww, a great match!",intent:"SHARE",image:c||"",data:{playerId:o,playerName:l,playerPhoto:h,type:Hn}}),s.event(z.SHARE,{share_content_type:"MatchResult",success:!0})}catch(r){s.event(z.SHARE,{share_content_type:"MatchResult",success:!1}),j(r)}finally{a.screen.close(U.NOTIFY_SCREEN)}},Gs=async i=>{const{player:e,globalScene:t}=window.game,s=as(i),{photo:n,playerId:a}=e.getPlayer(),{playerId:r,photo:c}=_t(i),o=$n(i,{playerId:a}),l=al(i,{opponentId:r}),{score:h}=s[a]||{},{score:d}=s[r]||{},u=wl({playerId:a,playerPhoto:n,playerScore:h,opponentId:r,opponentPhoto:c,opponentScore:d,isPlayerFinished:o,isOpponentFinished:l});if(!u){console.warn("getRenderOptionsLeaderboard");return}const p={name:"share-game-result",width:952,height:492,renderOptions:u};return await t.frameCapture.capture(p)},uT=async i=>{const{player:e,globalScene:t}=window.game,s=as(i),{photo:n,playerId:a}=e.getPlayer(),{playerId:r,photo:c,score:o}=rl(i),{score:l}=s[a]||{},h=wl({playerId:a,playerPhoto:n,playerScore:l,opponentId:r,opponentPhoto:c,opponentScore:o});if(!h){console.warn("getRenderOptionsGroupResult");return}const d={name:"share-group-match-result",width:952,height:492,renderOptions:h};return await t.frameCapture.capture(d)},wl=i=>{const{playerId:e="10",playerPhoto:t="",playerScore:s=0,opponentId:n="20",opponentPhoto:a="",opponentScore:r=0,isPlayerFinished:c,isOpponentFinished:o}=i;if(typeof e!="string"||typeof t!="string"||typeof s!="number"||typeof n!="string"||typeof a!="string"||typeof r!="number"||typeof c!="boolean"||typeof o!="boolean")return null;const l=s===r,h=s>r,d=c||o,u=c&&o,p={leftPhoto:{name:`${e}`,type:"image",x:56,y:140,image:t,width:220,height:220,fallbackWithImage:fe.AVATAR.KEY},rightPhoto:{name:`${n}`,type:"image",x:690,y:140,image:a,width:220,height:220,fallbackWithImage:fe.AVATAR.KEY},wideFrame:{name:"wide-frame-game-result",type:"image",x:0,y:0,image:"./assets/wideframes/wide-frame-game-result.png",width:952,height:492}};return d&&(p.leftScoreShadow={type:"text",x:162,y:444,font:`600 ${70}px`,fillStyle:"#c4683f",text:c?`${s}`:"???",textAlign:"center"},p.leftScore={type:"text",x:162,y:440,font:`600 ${70}px`,fillStyle:"#f2a62e",text:c?`${s}`:"???",textAlign:"center"},p.rightScoreShadow={type:"text",x:796,y:444,font:`600 ${70}px`,fillStyle:"#c4683f",text:o?`${r}`:"???",textAlign:"center"},p.rightScore={type:"text",x:796,y:440,font:`600 ${70}px`,fillStyle:"#f2a62e",text:o?`${r}`:"???",textAlign:"center"}),!l&&u&&(h?p.leftCrown={name:"crown-icon",type:"image",x:112,y:72,image:"./assets/images/others/crown-icon.png",width:106,height:78}:p.rightCrown={name:"crown-icon",type:"image",x:750,y:72,image:"./assets/images/others/crown-icon.png",width:106,height:78}),p},Bs=i=>{const{contextId:e}=i;if(e===""||typeof e!="string")throw new ss(null,{contextId:e})},dT=i=>{const{opponentId:e,contextId:t}=i;if(e===""||typeof e!="string")throw new sT(null,{opponentId:e});if(t===""||typeof t!="string")throw new ss(null,{contextId:t})},Us=i=>{const{imageShare:e}=i;if(e===null)throw new Il},_i=(i,e=!0)=>(t,s)=>{const n=s(),a=bl(n);if(e){if(a[i]?.sent)return;t(pT(i))}a[i]?.sent&&t(mT(i))},pT=i=>({type:Go,payload:{opponentId:i}}),mT=i=>({type:Bo,payload:{opponentId:i}}),Oi=async(i,e)=>{try{const{facebook:t}=window.game;dT({opponentId:i,contextId:e});const s=FBInstant.context.getID();if(s===e&&e!=="")return s;if(i==="10"&&e!=="")return e;if(e)return await t.switchAsync(e),FBInstant.context.getID()}catch(t){j(t)}return""},gT=(i,e)=>async(t,s)=>{const{player:n,analytics:a,facebook:r}=window.game;try{const{matchId:c,contextId:o}=e,l=await Oi(i,o);Bs({contextId:l});const h=s(),d=await Gs(h);Us({imageShare:d});const{name:u,playerId:p}=n.getPlayer();await r.sendMessage({cta:{default:"Play",localizations:{en_US:"Play",vi_VN:"Chơi ngay"}},text:{default:`${u} challenges you`,localizations:{en_US:`${u} challenges you`,vi_VN:`${u} thử thách bạn trong trận đấu này. Chơi ngay!`}},image:d||"",template:"challenge",data:{type:Jt,matchId:c,playerId:p,opponentId:i,status:Vt}}),t(_i(i)),a.event(z.MESSAGE,{message_content_type:"Invite",success:!0})}catch(c){a.event(z.MESSAGE,{message_content_type:"Invite",success:!1}),j(c)}},fT=(i,e)=>async(t,s)=>{const{player:n,analytics:a,facebook:r}=window.game;try{const{matchId:c,contextId:o}=e,l=await Oi(i,o);Bs({contextId:l});const h=s(),d=await Gs(h);Us({imageShare:d});const{name:u,playerId:p}=n.getPlayer();await r.sendMessage({cta:{default:"See result",localizations:{en_US:"See result",vi_VN:"Xem kết quả"}},text:{default:`${u} just finished. Check them now.`,localizations:{en_US:`${u} just finished. Check them now.`,vi_VN:`${u} vừa hoàn thành màn chơi. Nhấn để xem kết quả trận đấu.`}},image:d||"",template:"finished",data:{type:Jt,matchId:c,playerId:p,opponentId:i,status:Ps}}),t(_i(i)),a.event(z.MESSAGE,{message_content_type:"FinishMatch",success:!0})}catch(c){a.event(z.MESSAGE,{message_content_type:"FinishMatch",success:!1}),j(c)}},ET=(i,e)=>async(t,s)=>{const{player:n,analytics:a,facebook:r}=window.game;try{const{matchId:c,contextId:o}=e,l=await Oi(i,o);Bs({contextId:l});const h=s(),d=await Gs(h);Us({imageShare:d});const{name:u,playerId:p}=n.getPlayer(),m=as(h),{score:g=0}=m[p]||{};await r.sendMessage({cta:{default:"See result",localizations:{en_US:"See result",vi_VN:"Xem kết quả"}},text:{default:`${u} beat your high score. Their score: ${g}`,localizations:{en_US:`${u} beat your high score. Their score: ${g}`,vi_VN:`${u} đã vượt qua điểm số của bạn, với ${g} điểm!`}},image:d||"",template:"pass_score",data:{type:Jt,matchId:c,playerId:p,opponentId:i,status:Ps}}),t(_i(i)),a.event(z.MESSAGE,{message_content_type:"BestScore",success:!0})}catch(c){a.event(z.MESSAGE,{message_content_type:"BestScore",success:!1}),j(c)}},yT=(i,e)=>async(t,s)=>{const{player:n,analytics:a,facebook:r}=window.game;try{const{matchId:c,contextId:o,score:l}=e,h=await Oi(i,o);Bs({contextId:h});const d=s(),u=await Gs(d);Us({imageShare:u});const{name:p,playerId:m}=n.getPlayer();await r.sendMessage({cta:{default:"Play",localizations:{en_US:"Play",vi_VN:"Chơi ngay"}},text:{default:`${p} got ${l} scores. So easy! Can you?`,localizations:{en_US:`${p} got ${l} scores. So easy! Can you?`,vi_VN:`${p} đã đạt ${l} điểm! Nhấn Chơi để so tài!`}},image:u||"",template:"play_turn",data:{type:Jt,matchId:c,playerId:m,opponentId:i,status:Vt}}),t(_i(i)),a.event(z.MESSAGE,{message_content_type:"FinishTurn",success:!0})}catch(c){if(a.event(z.MESSAGE,{message_content_type:"FinishTurn",success:!1}),c instanceof ss)return;j(c)}},ST=()=>async(i,e)=>{const{analytics:t}=window.game;try{const s=FBInstant.context.getID();Bs({contextId:s});const n=e(),a=rl(n),{playerId:r,score:c}=a,{score:o}=Rt(n);let l;r&&r!==Re.playerId?o>c?(l=await uT(n),await AT(l,n)):(l=await hr(n),await ur(l,n)):(l=await hr(n),await ur(l,n)),Us({imageShare:l}),t.event(z.MESSAGE,{message_content_type:"InviteGroup",success:!0})}catch(s){t.event(z.MESSAGE,{message_content_type:"InviteGroup",success:!0}),j(s)}},AT=async(i,e)=>{try{const{player:t,facebook:s}=window.game,{playerId:n,name:a,photo:r}=t.getPlayer(),{score:c}=Rt(e),o={type:Vn,playerId:n,playerName:a,playerPhoto:r,playerScore:c};await s.sendMessage({cta:{default:"Play",localizations:{en_US:"Play",vi_VN:"Chơi"}},text:{default:`${a} beats your high score. Their score: ${c}.`,localizations:{en_US:`${a} beats your high score. Their score: ${c}.`,vi_VN:`${a} vừa vượt điểm số cao nhất của bạn! Chơi lần nữa chứ?`}},image:i||"",template:"play_turn",data:o})}catch(t){j(t)}},ur=async(i,e)=>{const{player:t,facebook:s}=window.game;try{const{playerId:n,name:a,photo:r}=t.getPlayer(),{score:c}=Rt(e),o={type:Vn,playerId:n,playerName:a,playerPhoto:r,playerScore:c};await s.sendMessage({cta:{default:"Play",localizations:{en_US:"Play",vi_VN:"Chơi ngay"}},text:{default:`${a} got ${c} scores. So easy! Can you?`,localizations:{en_US:`${a} got ${c} scores. So easy! Can you?`,vi_VN:`${a} đã đạt ${c} điểm! Quá dễ luôn. Chơi lại nào!`}},image:i||"",template:"play_turn",data:o})}catch(n){j(n)}},Cl=i=>{const{contextId:e}=i;if(e===""||typeof e!="string")throw new ss(null,{contextId:e})};let dr=null;const rs=i=>{clearTimeout(dr),dr=setTimeout(()=>{window.game.globalScene.screen.close(U.NOTIFY_SCREEN)},i)},TT=()=>({type:jo,payload:{}}),IT=()=>i=>{try{i(vi()),i(Fs(Xe))}catch(e){j(e)}},vl=()=>i=>{try{i(vi()),i(Fs(Ye))}catch(e){j(e)}},ta=()=>async(i,e)=>{try{const{globalScene:t}=window.game;t.screen.open(U.NOTIFY_SCREEN,{message:t.lang.Text.LOADING,loading:!0});const s=e(),n=vt(s),a=xc(s);[Ye,Xe].indexOf(n)>=0&&(i(vi()),i(El()));let r=null;n===Ge&&(r=_t(s),i(xA())),i(yl()),await i(Fs(n,r)),i(Rl(a))}catch(t){j(t)}finally{rs(300)}},_l=(i="10",e=!1)=>t=>{try{t(Ol("reset",i,e))}catch(s){j(s)}},Ol=(i,e="10",t=!1)=>async s=>{try{const{player:n,facebook:a,globalScene:r}=window.game;r.screen.open(U.NOTIFY_SCREEN,{message:r.lang.Text.LOADING,loading:!0});let c=i,o=a.contextType;if(!e){const f=GameCore.Configs.PlayerIdMock,E=GameCore.Configs.PlayerIdMock2;e=n.getPlayerId()===f?E:f}if(i){if(e&&e!==Re.playerId){if(c=await a.createAsync(e),c===!1){t&&r.events.emit(ke.SWITCH,$.DASHBOARD_SCENE);return}!c&&i!=="reset"&&(c=i)}o=a.contextType,s(An(c,o))}else if(c=await a.chooseAsync(),c===!1){t&&r.events.emit(ke.SWITCH,$.DASHBOARD_SCENE);return}Cl({contextId:c});const l=n.getPlayerId(),h=n.getConnectedPlayers(),d=await a.getContextPlayers(l);let u=Re;e!==u.playerId&&h[e]?u=h[e]:d.length===1&&(u=d[0]),s(yl());const{playerId:p,name:m,photo:g}=u;await s(Fs(Ge,{playerId:p,name:m,photo:g})),s(An(c,o))}catch(n){if(n instanceof ss||n?.code==="USER_INPUT"||n?.code==="INVALID_OPERATION")return;j(n)}finally{rs(1e3)}},bT=i=>async e=>{try{const{facebook:t,globalScene:s,analytics:n}=window.game;s.screen.open(U.NOTIFY_SCREEN,{message:s.lang.Text.LOADING,loading:!0});const a=t.getContextID();Cl({contextId:a}),n.event(z.JOIN_GROUP,{group_id:a}),await e(Fs($e,i))}catch(t){if(t instanceof ss||t?.code==="INVALID_OPERATION")return;j(t)}finally{rs(1e3)}},pr=(i,e)=>async(t,s)=>{try{const{player:n,profile:a,facebook:r,globalScene:c}=window.game;c.screen.open(U.NOTIFY_SCREEN,{message:c.lang.Text.LOADING,loading:!0});let o=s();const l=n.getPlayerId(o),h=n.getConnectedPlayers(o);if(h.length>0&&!h[e]){c.events.emit(ke.SWITCH,$.DASHBOARD_SCENE);return}let d=Re;const u=await r.getContextPlayers(l);if(e!==l&&e!==d.playerId&&h[e])d=h[e];else if(u.length===1)d=u[0];else{await a.requestProfiles([e]);const S=a.getProfiles();S[e]&&(d=S[e])}await t(MA(i,d)),o=s();let p=Va(o,{playerId:l});if(p===Re.playerId&&await t(DA(i)),o=s(),p=Va(o,{playerId:l}),p!==l&&h[e]){t(_l(e,!0));return}if(Ei(o)!==i){c.events.emit(ke.SWITCH,$.DASHBOARD_SCENE);return}const g=VE(o),y=$n(o,{playerId:l});t(vT({mode:Ge,status:g}));const f=r.getContextID(),E=r.contextType;if(t(An(f,E)),y){await n.requestConnectedPlayers(),c.events.emit(ke.SWITCH,$.GAME_OVER_SCENE);return}c.events.emit(ke.SWITCH,$.GAME_SCENE)}catch(n){j(n)}finally{rs(1e3)}},In=()=>async(i,e)=>{try{const{analytics:t,facebook:s,globalScene:n}=window.game;n.screen.open(U.NOTIFY_SCREEN,{message:n.lang.Text.LOADING,loading:!0});let a=e();const r=vt(a),{score:c=0,level:o=0}=Rt(a);i(wT(c)),await i(CT(r,{score:c})),a=e();const l=ig(a),h=ng(a),d=Math.floor((h-l)/1e3);t.event(z.MATCH_END,{game_mode:GameCore.Utils.String.toUpperCamelCase(r),level:o,level_name:`level_${o}`,time_played:d});const u=s.getContextID();if(r===$e&&u&&i(ST()),u&&r===Ge){const{playerId:p}=_t(a);if(!p||p===Re.playerId)return;const m=as(a),{score:g=0}=m[p]||{},y=Ns(a),{_id:f,whitePlayerFinish:E,blackPlayerFinish:S}=y;!E||!S?i(yT(p,{matchId:f,contextId:u,score:c})):c>g?i(ET(p,{matchId:f,contextId:u})):i(fT(p,{matchId:f,contextId:u}))}}catch(t){j(t)}finally{rs(300)}},wT=i=>e=>{try{const{player:t,notification:s}=window.game,n=t.getPlayerId();JA(n,i).catch(h=>{j(new Error(h))}),window.leaderboard_callback=async()=>{const h=window.game.scene.getScene($.GAME_SCENE);h instanceof Tt&&await h.handleShowAdWhenNextLevel().catch(d=>{}),window.replayGameEvent()};const a=t.getDiamond(),r=t.getPlayerData(),{score:c=0,level:o}=r;c<i&&t.setScore(i),s.updateData({gameProgress:{currentLevel:o},gameStatistics:{highScore:c<i?i:c},currencyBalance:{diamond:a}}),s.sendRequest();const l={score:i,level:o};e(Jn(n,l)),e(Ds(l))}catch(t){if(t instanceof tT)return;j(t)}},Fs=(i,e=null)=>async(t,s)=>{try{const{player:n,analytics:a,facebook:r,globalScene:c}=window.game;let o=r.getContextID(),l=0,h=s();if(a.event(z.MATCH_START,{game_mode:GameCore.Utils.String.toUpperCamelCase(i),level:1,level_name:"level_1"}),t(TT()),[Ye,Xe].indexOf(i)&&(await t(OA()),h=s(),Wt(h)||await t(El()),l=il(h)),i===$e&&t(NA(e)),i===Ge){await t(PA(e)),h=s();const u=Ei(h),{playerId:p}=_t(h);o||(o=window.FBInstant.context.getID());const m=oT(h,{opponentId:p});o&&p&&!m&&t(gT(p,{contextId:o,matchId:u}))}i===Mm&&t(GA());const{score:d=0}=n.getPlayerData(h);t(Ds({score:l,bestScore:d})),t({type:zo,payload:{mode:i,contextId:o}}),t(Lc(i)),c.events.emit(ke.SWITCH,$.GAME_SCENE)}catch(n){if(n instanceof me){const{globalScene:a}=window.game;a.screen.open(U.NOTIFY_SCREEN,{message:`Sorry!, you can now
create this match!`,duration:2500,loading:!1});return}j(n)}finally{rs(0)}},CT=(i,e)=>async(t,s)=>{const{player:n,globalScene:a}=window.game,{score:r=0,level:c=0}=e,o=s();if([Ye,Xe].indexOf(i)>=0){const l=Wt(o);await t(RA(l))}if(i===$e){t(kA());const l=n.getPlayerId();t(Jn(l,e))}if(i===Ge){const l=Ei(o);await t(LA(l,r,{level:c}))}t({type:$o,payload:{mode:i}}),a.events.emit(ke.SWITCH,$.GAME_OVER_SCENE)},vT=i=>e=>{const{mode:t,status:s}=i;e({type:Xo,payload:{mode:t,status:s}}),ui("game-mode",t)},_T=()=>(i,e)=>{const t=e(),{level:s=0}=Rt(t),n=vt(t);window.game.analytics.event(z.MATCH_RESCUE,{game_mode:GameCore.Utils.String.toUpperCamelCase(n),level:s,level_name:`level_${s}`}),i({type:qo,payload:{}})},Rl=i=>({type:Zo,payload:{type:i}});class sa extends ee{label;constructor(e,t,s,n,a){super(e,t,s),n&&a&&this.button.setWorldSize(n,a),this.createLabel()}setLabel(e){this.label.setText(e)}createLabel(){this.label=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(18),origin:{x:.5,y:.5}}),this.label.setAlpha(.45),this.add(this.label),Phaser.Display.Align.In.BottomCenter(this.label,this.button,0,12)}}const OT=i=>i[xs]?.tasks,RT=i=>i[xs]?.process,PT=i=>i[xs]?.isRequesting,DT=i=>i[xs]?.isNotice,Pl=V([OT],i=>i),Dl=V([RT],i=>i),MT=V([PT],i=>i),LT=V([DT],i=>i),{KEY:mr,FRAME:gr}=D.DEFAULT;class xT extends sa{noticeIcon;constructor(e){super(e,mr,gr.ICON_DAILY,60,60),this.setName(this.scene.lang.Text.DAILY),this.useSound=!1,this.setLabel(this.scene.lang.Text.DAILY),this.drawNoticeIcon()}checkNotice=()=>{const e=this.scene.storage.getState(),t=LT(e)||!1;this.noticeIcon.setVisible(t)};drawNoticeIcon(){this.noticeIcon=this.scene.make.image({key:mr,frame:gr.ICON_DOT}),this.noticeIcon.setWorldSize(15,16),this.add(this.noticeIcon),Phaser.Display.Align.In.TopRight(this.noticeIcon,this.button,4,4)}}const{KEY:NT,FRAME:kT}=D.DEFAULT;class GT extends sa{constructor(e){super(e,NT,kT.ICON_GIFT,60,60),this.setName(this.scene.lang.Text.GIFT),this.setLabel(this.scene.lang.Text.GIFT)}checkUseable=()=>{}}const{KEY:BT,FRAME:UT}=D.DEFAULT;class FT extends sa{constructor(e){super(e,BT,UT.ICON_SETTING,60,60),this.setName("Setting"),this.useSound=!1,this.setLabel(this.scene.lang.Text.SETTINGS)}}const{KEY:nn,FRAME:an}=D.DEFAULT;class YT extends Phaser.GameObjects.Container{giftIcon;dailyIcon;settingIcon;buttons;lines;background;constructor(e){super(e),this.createBackground(),this.createLines(),this.createButtons(),this.createHorizontalLine(),this.alignLines(),this.alignButtons(),this.scene.add.existing(this)}alignLines(){const s=-(125*((this.lines.getLength()-1)/2));this.lines.setX(s,125)}alignButtons(){const s=-(125*((this.buttons.getLength()-1)/2));this.buttons.setX(s,125),this.buttons.setY(-55)}createBackground(){this.background=this.scene.make.image({key:nn,frame:an.BOTTOM_BG,origin:{x:.5,y:1}}),this.background.setY(86),this.background.setDepth(Y.BACKGROUND),this.background.setWorldSize(375,171),this.add(this.background)}createLines(){this.lines=this.scene.make.group({key:nn,frame:an.BOTTOM_LINE,repeat:1,setOrigin:{x:.5,y:1}});const e=this.lines.getChildren();e.forEach(t=>{t.setWorldSize(1,85)}),this.add(e)}createHorizontalLine(){const e=this.scene.make.image({key:nn,frame:an.BOTTOM_LINE,origin:{x:.5,y:1}});e.setWorldSize(375,1),this.add(e)}createButtons(){this.buttons=this.scene.add.group(),this.createDailyButton(),this.createGiftButton(),this.createSettingsButton()}createDailyButton(){this.dailyIcon=new xT(this.scene),this.add(this.dailyIcon),this.buttons.add(this.dailyIcon)}createGiftButton(){this.giftIcon=new GT(this.scene),this.add(this.giftIcon),this.buttons.add(this.giftIcon)}createSettingsButton(){this.settingIcon=new FT(this.scene),this.add(this.settingIcon),this.buttons.add(this.settingIcon)}}class Ml extends Phaser.GameObjects.Container{maxValue;key;frames;bar;icon;button;value;constructor(e,t,s){super(e),this.key=t,this.frames=s,this.maxValue=1e4,this.createBar(),this.createValue(),this.createIcon(),this.createButton(),this.alignObject(),this.scene.add.existing(this)}set onClick(e){this.scene.ads.enabled&&(this.setInteractive({useHandCursor:!0}),this.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,()=>{this.logButtonEvent(),e(),this.scene.audio.playSound(K.BUTTON_CLICK)}))}setValue(e){let t=`${e}`;e>=this.maxValue&&(t=`${Math.floor(e/1e3)}k`),this.value.setText(t)}alignObject(){const{width:e,height:t}=this.bar;this.setSize(e,t),Phaser.Display.Align.In.Center(this.value,this.bar,2,-2),Phaser.Display.Align.In.LeftCenter(this.icon,this.bar),this.button&&Phaser.Display.Align.In.RightCenter(this.button,this.bar)}createBar(){this.bar=this.scene.add.image(0,0,this.key,this.frames.background),this.bar.setY(4),this.add(this.bar)}createValue(){this.value=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(20),origin:{x:.5,y:.5}}),this.setValue(0),this.add(this.value)}createIcon(){this.icon=this.scene.add.image(0,0,this.key,this.frames.icon),this.add(this.icon)}createButton(){!this.frames.button||!this.scene.ads.enabled||(this.button=this.scene.add.image(0,0,this.key,this.frames.button),this.add(this.button))}logButtonEvent(){const e=this.getParentName(),t=this.name;this.scene.analytics.event(z.BUTTON_CLICK,{button_name:t,screen_name:e})}getParentName(){let e=this.parentContainer;for(;e;){if(e instanceof GameCore.Screen)return e.getScreenName();e=e.parentContainer}return this.scene.getSceneName()}}const{KEY:HT,FRAME:rn}=D.DEFAULT;class VT extends Ml{constructor(e){super(e,HT,{background:rn.TOP_BG_LONG,icon:rn.ICON_DIAMOND,button:rn.ICON_PLUS}),this.setName("DiamondBar"),this.bar.setWorldSize(105,39),this.icon.setWorldSize(25,24),this.button?.setWorldSize(18.5,20),this.alignObject()}}const{KEY:WT,FRAME:fr}=D.DEFAULT;class KT extends Ml{constructor(e){super(e,WT,{background:fr.TOP_BG_LONG,icon:fr.ICON_CUP}),this.setName("ScoreBar"),this.maxValue=1e6,this.bar.setWorldSize(105,39),this.icon.setWorldSize(34,28),this.alignObject()}}class jT extends Phaser.GameObjects.Container{scoreBar;diamondBar;constructor(e){super(e);const{width:t}=this.scene.gameZone;this.setSize(t,50),this.createScoreBar(),this.createDiamondBar(),this.scene.add.existing(this)}createScoreBar(){this.scoreBar=new KT(this.scene),this.add(this.scoreBar),Phaser.Display.Align.In.LeftCenter(this.scoreBar,this,-10)}createDiamondBar(){this.diamondBar=new VT(this.scene),this.add(this.diamondBar),Phaser.Display.Align.In.RightCenter(this.diamondBar,this,-10)}}const{KEY:Er,FRAME:zT}=D.DEFAULT;class $T extends Phaser.GameObjects.Container{logo;gems;logoAnimation;gemsAnimation;constructor(e,t,s){super(e,t,s),this.drawGems(),this.drawLogo(),this.setDepth(Y.LOGO),this.runAnimations(),e.add.existing(this)}drawLogo(){const e=this.scene.lang.getCurrentLanguage();this.logo=this.scene.add.image(0,0,Er,this.scene.lang.Texture.LOGO),e==="ja"?this.logo.setWorldSize(232,226):e==="id"?this.logo.setWorldSize(229.5,226):this.logo.setWorldSize(210,231),this.add(this.logo)}drawGems(){this.gems=this.scene.add.image(0,0,Er,zT.GEMS),this.gems.setOrigin(.5,.8),this.gems.setWorldSize(233,84.5),this.add(this.gems)}runAnimations(){this.runLogoAnimation(),this.runGemsAnimation()}runLogoAnimation(){this.logoAnimation||(this.logoAnimation=new qe({targets:[this.logo],duration:1400,repeatDelay:200,props:{scale:"+=0.03"}})),this.logoAnimation.play()}runGemsAnimation(){this.gemsAnimation||(this.gemsAnimation=new qe({targets:[this.gems],duration:1500,repeatDelay:200,props:{scale:"+=0.1"}})),this.gemsAnimation.play()}}const{KEY:XT,FRAME:qT}=D.DEFAULT;class ZT extends ee{constructor(e){super(e,XT,qT.BUTTON_BLUE_SHORT),this.button.setWorldSize(170,70.5),this.setName("PlaySingle"),this.createText()}createText(){const e=this.scene.lang.getCurrentLanguage(),t=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(e==="id"?21:26),text:this.scene.lang.Text.PLAY_NOW,origin:{x:.5,y:.5}});this.add(t)}}class JT extends Phaser.GameObjects.Container{logo;playSingleButton;constructor(e){super(e),this.createLogo(),this.createPlaySingleButton(),this.scene.add.existing(this)}createLogo(){this.logo=new $T(this.scene,0,0),this.add(this.logo),Phaser.Display.Align.In.Center(this.logo,this,0,-110)}createPlaySingleButton(){this.playSingleButton=new ZT(this.scene),this.add(this.playSingleButton),Phaser.Display.Align.In.Center(this.playSingleButton,this,0,90)}}const QT=[{id:"pass-levels",title:"Pass 10 Levels",require:{level:10},reward:{diamond:100}},{id:"collect-diamonds",title:"Collect 300 diamonds",require:{diamond:300},reward:{diamond:100}},{id:"reach-score",title:"Reach Total Scores",require:{score:1e5},reward:{diamond:200}}],eI=async()=>QT,{DailyTasks:tI}=GameCore.Configs,sI=()=>async(i,e)=>{const t=e();if(MT(t))return;i({type:bc,payload:{}});const n=await eI(),a=window.game.globalScene.lang;for(let r=0;r<n.length;r++){const c=n[r];c.id==="pass-levels"?n[r].title=a.Text.PASS_10_LEVELS:c.id==="collect-diamonds"?n[r].title=a.Text.COLLECT_300:c.id==="invite-friends"?n[r].title=a.Text.INVITE_2:c.id==="reach-score"&&(n[r].title=a.Text.REACH_TOTAL)}i(iI(n))},iI=i=>e=>{e({type:wc,payload:{tasks:i}});const{player:t}=window.game,s=t.getCustomData("dailyTasks"),{startedTime:n=0,logTasks:a={}}=s||{},c=(Date.now()-n)/1e3>tI.Duration;e(c?Ll(i):xl(a))},Ll=i=>e=>{const t={};i.forEach(n=>{const{id:a,require:r}=n;t[a]={},Object.keys(r).forEach(c=>{t[a]={[c]:0,rewarded:!1}})});const{player:s}=window.game;s.setCustomData("dailyTasks",{logTasks:t,startedTime:Date.now()}),e(xl(t)),X.emit(ue.EVENTS.TASKS_RESET)},xl=i=>({type:Cc,payload:{process:i}}),yr=()=>i=>{i({type:Oc,payload:{}}),X.emit(ue.EVENTS.NOTICE_UPDATE)},Nl=()=>{const{player:i}=window.game,e=i.getCustomData("dailyTasks"),{logTasks:t}=e||{};return GameCore.Utils.Json.clone(t)},nI=(i,e,t)=>s=>{const n=Nl();if(!GameCore.Utils.Valid.isObject(n))return;const a=n;if(!GameCore.Utils.Object.hasOwn(a,i)||a[i].rewarded)return;a[i][e]+=t;const{player:r}=window.game;r.setCustomData("dailyTasks",{logTasks:a}),s({type:vc,payload:{id:i,type:e,value:t}})},aI=i=>e=>{const t=Nl();if(!GameCore.Utils.Valid.isObject(t))return;const s=t;if(!GameCore.Utils.Object.hasOwn(s,i))return;s[i].rewarded=!0;const{player:n}=window.game;n.setCustomData("dailyTasks",{logTasks:s}),e({type:_c,payload:{id:i}})},rI=i=>e=>{e({type:Rc,payload:{id:i}}),X.emit(ue.EVENTS.NOTICE_UPDATE)},{KEY:gs,FRAME:fs}=D.DEFAULT;class Sr extends Phaser.GameObjects.Container{payload;process;isCompleted;background;titleText;processText;progressBar;claimButton;rewardedIcon;constructor(e,t,s){super(e),this.payload=t,this.process=s,this.setName(`Task: ${t.id}`),this.createBackground(),this.updateSize(),this.createTitle(),this.createProcessBar(),this.createProcessStatus(),this.createClaimButton(),this.updateData()}setProcess(e){this.process=e,this.updateData()}getId(){return this.payload.id}set onClaim(e){this.claimButton.onClick=this.handleOnClaim(e),this.updateData()}handleOnClaim=e=>()=>{this.updateClaimButton();const{id:t,reward:s}=this.payload;this.scene.storage.dispatch(aI(t)),Object.keys(s).forEach(a=>{const r=s[a];e(a,r)})};getProcessValue(){const{require:e}=this.payload,t=Object.keys(e);let s=0,n=0;return t.forEach(a=>{s=e[a]||0;const r=this.process[a];n=typeof r=="number"?r:0}),{current:n,target:s}}updateData=()=>{const{current:e,target:t}=this.getProcessValue(),s=e/t;this.progressBar.setProcess(s,!0),this.setProcessText(e,t),this.isCompleted=e>=t&&!this.process?.rewarded,this.claimButton.setDisabled(!this.isCompleted),this.process?.rewarded&&this.updateClaimButton()};setProcessText(e,t){this.processText.setText(`${e} / ${t}`)}updateClaimButton=()=>{this.rewardedIcon=this.scene.make.image({key:gs,frame:fs.ICON_CHECK}),this.rewardedIcon.setWorldSize(25.5,26),this.add(this.rewardedIcon),Phaser.Display.Align.In.Center(this.rewardedIcon,this.claimButton),this.claimButton.kill()};createBackground(){this.background=this.scene.make.image({key:gs,frame:fs.MISSION_BLOCK_BG}),this.background.setWorldSize(262,55),this.add(this.background)}updateSize(){const{width:e,height:t}=this.background;this.setSize(e,t)}createTitle(){const{title:e}=this.payload;this.titleText=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(15),text:e,origin:{x:0,y:.5}}),this.titleText.setTint(11436629),this.add(this.titleText),Phaser.Display.Align.In.LeftCenter(this.titleText,this,-10,-10)}createProcessBar(){this.progressBar=new ul(this.scene,{width:170,key:gs,frames:fs}),this.add(this.progressBar),Phaser.Display.Align.In.LeftCenter(this.progressBar,this,-10,10)}createProcessStatus(){this.processText=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(15),origin:{x:.5,y:.5}}),this.add(this.processText),Phaser.Display.Align.In.Center(this.processText,this.progressBar,0,0)}createClaimButton(){this.claimButton=new ee(this.scene,gs,fs.BUTTON_GREEN_MINOR,62.5,38.5);const t=`Claim:${GameCore.Utils.String.toUpperCamelCase(this.payload.id)}`;this.claimButton.setName(t),this.createRewardIcon(),this.createRewardValue(),this.add(this.claimButton),Phaser.Display.Align.In.RightCenter(this.claimButton,this,-6)}createRewardIcon(){const e=this.scene.make.image({key:gs,frame:fs.ICON_DIAMOND_SMALL});e.setWorldSize(19,18),this.claimButton.add(e),Phaser.Display.Align.In.Center(e,this.claimButton,-15)}createRewardValue(){const{reward:e}=this.payload,t=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(16),text:`${e.diamond}`,origin:{x:0,y:.5}});this.claimButton.add(t),Phaser.Display.Align.In.Center(t,this.claimButton,10,-1)}}const{KEY:Es,FRAME:ys}=D.DEFAULT,{DailyTasks:oI}=GameCore.Configs;class cI extends GameCore.Screen{onReward;missionsData;missionProcess;startedTime;popup;missionBlocks;countdownTimer;countdownText;countdownContainer;backgroundFadeInAnimation;popupShowUpAnimation;popupExitsAnimation;contentShowUpAnimation;constructor(e,t,s,n){super(e,t,s,n),this.createPopup(),this.createPopupContents(),this.createDebugTools(),this.setDepth(ht.POPUP),this.background.setAlpha(.8)}open(e){super.open(e),this.scene.storage.dispatch(yr()),this.updateTasksData(),this.createCountdownTimer(),this.createMissionBlocks(),this.runOpenAnimation()}handleClosePopup=()=>{this.scene.storage.dispatch(yr()),this.runCloseAnimation()};handleOnClaim=(e,t)=>{this.claimReward(e,t)};claimReward(e,t){typeof this.onReward=="function"&&(this.onReward(e,t),this.updateTasksData(),this.updateMissionBlocks(),this.scene.audio.playSound(K.DAILY_REWARD))}resetTaskData=async()=>{this.startedTime=Date.now(),await this.scene.storage.dispatch(Ll(this.missionsData)),this.updateTasksData(),this.createMissionBlocks()};updateTasksData=()=>{const{player:e,storage:t}=this.scene,s=t.getState(),n=Pl(s)||[],a=Dl(s)||{},r=e.getCustomData("dailyTasks"),{startedTime:c=0}=r||{};this.missionsData=n,this.missionProcess=a,this.startedTime=c};runOpenAnimation(){this.setVisible(!0),this.scene.audio.playSound(K.POPUP_SHOW),this.runBackgroundEntrancesAnimation(0,300),this.runPopupEntrancesAnimation(200,500),this.runPopupContentEntrancesAnimation(400,400)}runCloseAnimation(){this.scene.audio.playSound(K.POPUP_OFF,{volume:.6}),this.runPopupExitsAnimation(0,200)}runBackgroundEntrancesAnimation(e,t){this.backgroundFadeInAnimation||(this.backgroundFadeInAnimation=new es({targets:[this.background],delay:e,duration:t,props:{alpha:{start:0,from:0,to:.8}}})),this.backgroundFadeInAnimation?.play()}runPopupEntrancesAnimation(e,t){if(!this.popupShowUpAnimation){this.popupShowUpAnimation=new ks({targets:[this.popup],delay:e,duration:t,props:{y:{from:350,to:this.popup.y},scale:{start:0,from:0,to:1},alpha:{start:1,from:1,to:1}}}),this.popupShowUpAnimation?.play();return}this.popupShowUpAnimation?.play()}runPopupContentEntrancesAnimation(e,t){const s=this.missionBlocks.getChildren();s.length<1||(this.missionBlocks.setAlpha(0),this.contentShowUpAnimation?.remove(),this.contentShowUpAnimation=new ts({targets:s,duration:t,delay:this.scene.tweens.stagger(80,{start:e}),props:{alpha:{from:0,to:1}}}),this.contentShowUpAnimation?.play())}runPopupExitsAnimation(e,t){if(!this.popupExitsAnimation){this.popupExitsAnimation=new ut({targets:[this.popup],delay:e,duration:t,props:{y:250,scale:0},onComplete:()=>{this.scene.screen.close(this.name)}}),this.popupExitsAnimation?.play();return}this.popupExitsAnimation?.play()}createDebugTools(){if(!GameCore.Utils.Valid.isDebugger())return;const e=new ee(this.scene,Es,ys.ICON_CANCEL);e.button.setSize(21,23),e.button.setDisplaySize(21,23),e.setName("Reset"),e.onClick=this.resetTaskData,this.add(e),Phaser.Display.Align.In.TopLeft(e,this.zone,-60,-90)}createPopup(){this.popup=new Je(this.scene,0,0,284,440),this.add(this.popup),Phaser.Display.Align.In.Center(this.popup,this.zone,0,15)}createPopupContents(){this.createCat(),this.createTitle(),this.createCountdown()}createCat(){const e=new qn(this.scene);this.popup.add(e),Phaser.Display.Align.In.TopCenter(e,this.popup,0,35)}createTitle(){const e=this.scene.add.container(),t=this.scene.make.image({key:Es,frame:ys.RIBBON_LONG});t.setWorldSize(341,79.5);const s=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(30),text:this.scene.lang.Text.DAILY_MISSIONS});Phaser.Display.Align.In.Center(s,t,0,-10);const n=new ee(this.scene,Es,ys.BUTTON_CLOSE);n.button.setWorldSize(37.5,37.5),n.setName("Close"),n.useSound=!1,n.onClick=this.handleClosePopup,Phaser.Display.Align.In.RightCenter(n,t,-5,-5),e.add([t,s,n]),this.popup.add(e),Phaser.Display.Align.In.TopCenter(e,this.popup,0,-55)}createCountdown(){this.countdownContainer=this.scene.add.container();const e=this.scene.make.image({key:Es,frame:ys.MISSION_CLOCK_BG});e.setWorldSize(96,27);const t=this.scene.make.image({key:Es,frame:ys.ICON_CLOCK});t.setWorldSize(26,28),Phaser.Display.Align.In.LeftCenter(t,e,6),this.countdownText=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(20),text:"00:00:00"}),this.countdownText.setTint(11436629),Phaser.Display.Align.In.Center(this.countdownText,e,10,-1.3),this.countdownContainer.add([e,t,this.countdownText]),this.popup.add(this.countdownContainer),Phaser.Display.Align.In.TopCenter(this.countdownContainer,this.popup,0,-98)}createCountdownTimer(){this.countdownTimer?.destroy(),this.countdownTimer=this.scene.time.addEvent({loop:!0,delay:1e3,startAt:1e3,callback:this.updateCountdown})}updateCountdown=async()=>{if(!this.startedTime)return;const t=Date.now()-this.startedTime;let s=oI.Duration*1e3-t;s<0&&(s=0,await this.resetTaskData()),this.countdownText.setText(`${to(s,!0)}`)};createMissionBlocks(){this.missionBlocks?.destroy(!0);const e=this.missionsData.length,t=new Array(e).fill(null);this.missionBlocks=this.scene.add.group({maxSize:e}),t.forEach((s,n)=>{const a=this.creatMissionBlock(n);a!==null&&this.missionBlocks.add(a)}),this.missionBlocks.setX(0),this.missionBlocks.setY(-50,58)}creatMissionBlock(e){const{id:t}=this.missionsData[e];if(!GameCore.Utils.Object.hasOwn(this.missionProcess,t))return null;const s=this.missionProcess[t];if(!GameCore.Utils.Valid.isObject(s))return null;const n=new Sr(this.scene,this.missionsData[e],s);return n.onClaim=this.handleOnClaim,this.popup.add(n),n}updateMissionBlocks(){this.missionBlocks.getChildren().forEach(e=>{if(e instanceof Sr){const t=e.getId();if(!GameCore.Utils.Object.hasOwn(this.missionProcess,t))return;const s=this.missionProcess[t];if(!GameCore.Utils.Valid.isObject(s))return;e.setProcess(s)}})}}const lI=[{id:1,type:"diamond",value:50},{id:2,type:"diamond",value:75},{id:3,type:"diamond",value:100},{id:4,type:"diamond",value:125},{id:5,type:"diamond",value:150},{id:6,type:"diamond",value:200}],hI=async()=>lI,At={REWARDED:"rewarded",SKIPPED:"skipped",READY:"ready",WAITING:"waiting"},uI=i=>i[Fn]?.rewards,dI=i=>i[Fn]?.isRequesting,pI=V([uI],i=>i),mI=V([dI],i=>i),{DailyRewards:Ar}=GameCore.Configs,gI=()=>async(i,e)=>{const t=e();if(mI(t))return;i({type:Pc,payload:{}});const n=await hI();i(fI(n))},fI=i=>e=>{const{player:t}=window.game,s=t.getCustomData("dailyRewarded"),{logDays:n=[],lastRewarded:a=0}=s||{},r=new Date,c=new Date(a),o=new Date(c.toDateString()),l=Math.abs(r.valueOf()-o.valueOf()),d=Math.floor(l/864e5)>1,p=Ar.CheckInterrupt&&d||n.length>=Ar.MaxDays,m=p?[!1]:[...n,!1];kl(m);const g=i.map((y,f)=>{const E=f<m.length,S=m.length===f+1,I=m[f]===!1;let T=At.WAITING;return S?T=At.READY:p?T=At.WAITING:E&&I?T=At.SKIPPED:E&&(T=At.REWARDED),{...y,status:T}});e({type:Dc,payload:{rewards:g}})},kl=(i,e=!1)=>{const{player:t}=window.game;t.setCustomData("dailyRewarded",{logDays:i,lastRewarded:e?0:Date.now()})},{KEY:xt,FRAME:le}=D.DEFAULT;class EI extends Phaser.GameObjects.Container{payload;background;blockBg;titleBg;titleText;iconStatus;currencyIcon;currencyText;label;starTwinkleUp;constructor(e,t){super(e),this.payload=t,this.setName(`Day: ${t.day}`),this.draw(),this.setStatus()}setStatus(){const{status:e}=this.payload,{READY:t,REWARDED:s,SKIPPED:n}=At;switch(e){case t:this.setStatusReady(),this.runAnimations();break;case n:this.setStatusSkipped();break;case s:this.setStatusRewarded();break;default:this.setStatusWaiting()}}setStatusReady(){this.blockBg.setVisible(!1),this.titleBg.setFrame(le.DAILY_DAY_TITLE_ORANGE),this.setCurrentIconByDay(this.payload.day)}setStatusRewarded(){this.iconStatus.setVisible(!0),this.blockBg.setFrame(le.DAILY_DAY_BG_OPEN),this.titleBg.setFrame(le.DAILY_DAY_TITLE_GREEN),this.iconStatus.setFrame(le.ICON_CHECK),this.setCurrentIconByDay(this.payload.day)}setStatusSkipped(){this.iconStatus.setVisible(!0),this.blockBg.setFrame(le.DAILY_DAY_BG_OPEN),this.titleBg.setFrame(le.DAILY_DAY_TITLE_GREEN),this.iconStatus.setFrame(le.ICON_CANCEL),this.setCurrentIconByDay(this.payload.day)}setStatusWaiting(){this.setCurrentIconByDay(this.payload.day)}setCurrentIconByDay(e){let t=le.ICON_DIAMOND_LIGHT;switch(e){case 1:t=le.ICON_DIAMOND_LIGHT,this.currencyIcon.setFrame(t),this.currencyIcon.setWorldSize(38.5,36.5);break;case 2:t=le.LOGO_DIAMONDS_LIGHT_2,this.currencyIcon.setFrame(t),this.currencyIcon.setWorldSize(52,38);break;case 3:t=le.LOGO_DIAMONDS_LIGHT_3,this.currencyIcon.setFrame(t),this.currencyIcon.setWorldSize(60,40.5);break;case 4:t=le.LOGO_DIAMONDS_LIGHT_4,this.currencyIcon.setFrame(t),this.currencyIcon.setWorldSize(55,53.5);break;case 5:t=le.LOGO_DIAMONDS_LIGHT_5,this.currencyIcon.setFrame(t),this.currencyIcon.setWorldSize(62.5,54);break;case 6:t=le.LOGO_DIAMONDS_LIGHT_6,this.currencyIcon.setFrame(t),this.currencyIcon.setWorldSize(64,53);break}}draw(){this.createBackground(),this.updateBlockSize(),this.createBlockBG(),this.createTitleBg(),this.createTitleText(),this.createLabel(),this.createCurrencyText(),this.createCurrencyIcon(),this.createIconStatus()}createBackground(){this.background=this.scene.make.image({key:xt,frame:le.DAILY_DAY_BG}),this.background.setWorldSize(82,102),this.add(this.background)}updateBlockSize(){const{width:e,height:t}=this.background;this.setSize(e,t)}createBlockBG(){this.blockBg=this.scene.make.image({key:xt,frame:le.DAILY_DAY_BG_WAIT}),this.blockBg.setWorldSize(76,69),this.add(this.blockBg),Phaser.Display.Align.In.BottomCenter(this.blockBg,this.background,0,-4)}createTitleBg(){this.titleBg=this.scene.make.image({key:xt,frame:le.DAILY_DAY_TITLE_GREY}),this.titleBg.setWorldSize(68,25),this.add(this.titleBg),Phaser.Display.Align.In.TopCenter(this.titleBg,this,0,-1)}createTitleText(){const{day:e}=this.payload;this.titleText=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(16),text:this.scene.lang.getText({key:"DAY_X",variables:[e]}),origin:{x:.5,y:.5}}),this.add(this.titleText),Phaser.Display.Align.In.Center(this.titleText,this.titleBg)}createCurrencyIcon(){this.currencyIcon=this.scene.make.image({key:xt,frame:le.ICON_DIAMOND_GREY}),this.currencyIcon.setWorldSize(38.5,36.5),this.add(this.currencyIcon),Phaser.Display.Align.In.Center(this.currencyIcon,this.background)}createIconStatus(){this.iconStatus=this.scene.make.image({key:xt,frame:le.ICON_DOT}),this.iconStatus.setVisible(!1),this.iconStatus.setWorldSize(15,16),this.add(this.iconStatus),Phaser.Display.Align.In.Center(this.iconStatus,this.currencyIcon,20,10)}createLabel(){this.label=this.scene.make.image({key:xt,frame:le.DAILY_DAY_LABEL}),this.label.setWorldSize(73,19),this.add(this.label),Phaser.Display.Align.In.BottomCenter(this.label,this.background,0,-5)}createCurrencyText(){const{value:e}=this.payload;this.currencyText=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(14),text:`+${e}`,origin:{x:.5,y:.5}}),this.add(this.currencyText),Phaser.Display.Align.In.Center(this.currencyText,this.label,-2,-1)}runAnimations(){this.runSparksIdle()}runSparksIdle(){this.starTwinkleUp||(this.starTwinkleUp=new Wc(this.scene),this.starTwinkleUp.emitter.setFrequency(100),this.add(this.starTwinkleUp));const{x:e,y:t,width:s,height:n}=this.currencyIcon;this.starTwinkleUp.run(1,e,t,s,n)}}const{KEY:Ss,FRAME:As}=D.DEFAULT,{DailyRewards:Xs}=GameCore.Configs,yI={id:0,type:"diamond",value:0};class SI extends GameCore.Screen{onReward;onSkipAd;onNoAd;logDays;rewardsData;popup;loading;dayBlocks;claimButton;claimButton2X;backgroundFadeInAnimation;popupShowUpAnimation;popupExitsAnimation;contentShowUpAnimation;adsTimer;constructor(e,t,s,n){super(e,t,s,n),this.rewardsData=[],this.createPopup(),this.createPopupContents(),this.setDepth(ht.POPUP),this.background.setAlpha(.8)}async open(){await this.checkOpenable()&&(super.open(),await this.updateRewardsData(),this.createDayBlocks(),this.runOpenAnimation())}handleClosePopup=()=>{this.runCloseAnimation()};handleOnClaim=()=>{const e=this.getCurrentRewardValue();this.claimReward(e)};handleOnClaimX2=async()=>{try{const{audio:e,game:t}=this.scene;this.claimButton.setDisabled(!0),this.claimButton2X.setDisabled(!0),t.globalScene.screen.open(U.NOTIFY_SCREEN,{message:this.scene.lang.Text.LOADING,duration:0,loading:!0}),e.pauseMusic(),e.muteAll(),await this.scene.ads.showRewardedVideoAsync(),t.globalScene.screen.close(U.NOTIFY_SCREEN);const s=this.getCurrentRewardValue();this.claimReward(s*2)}catch(e){if(e instanceof Object&&GameCore.Utils.Object.hasOwn(e,"code")&&e.code==="USER_INPUT"){this.onSkipAd();return}this.onNoAd()}finally{this.scene.ads.preloadRewardedVideoAsync().catch(e=>{}),this.adsTimer?.destroy(),this.scene.audio.unmuteAll(),this.scene.audio.playMusic(),this.claimButton.setDisabled(!1),this.claimButton2X.setDisabled(!1)}};claimReward(e){typeof this.onReward=="function"&&(this.logDays?.length<1||(this.logDays[this.logDays.length-1]=!0,kl(this.logDays),this.onReward(e),this.scene.audio.playSound(K.DAILY_REWARD),this.runCloseAnimation()))}updateRewardsData=async()=>{const{storage:e,player:t}=this.scene;await e.dispatch(gI());const s=e.getState(),n=pI(s)||[];if(n?.length<1)return;this.rewardsData=n;const a=t.getCustomData("dailyRewarded"),{logDays:r=[]}=a||{};this.logDays=[...r]};getCurrentRewardValue(){return this.rewardsData.find(({status:t})=>t===At.READY)?.value||0}getRewardByDay(e){return this.rewardsData.find(t=>t.id===e)||yI}checkOpenable=async()=>{const{player:e}=this.scene,t=e.getCustomData("dailyRewarded"),{logDays:s=[],lastRewarded:n=0}=t||{};return s.length>Xs.MaxDays||Xs.MockTime>0&&Date.now()-n>=Xs.MockTime*1e3?!0:!hn(n)};runOpenAnimation(){this.setVisible(!0),this.scene.audio.playSound(K.POPUP_SHOW),this.runBackgroundEntrancesAnimation(0,300),this.runPopupEntrancesAnimation(150,400),this.runPopupContentEntrancesAnimation(300,300)}runCloseAnimation(){this.scene.audio.playSound(K.POPUP_OFF,{volume:.6}),this.runPopupExitsAnimation(0,200)}runBackgroundEntrancesAnimation(e,t){this.backgroundFadeInAnimation||(this.backgroundFadeInAnimation=new es({targets:[this.background],delay:e,duration:t,props:{alpha:{getStart:()=>0,getEnd:()=>.8}}})),this.backgroundFadeInAnimation.play()}runPopupEntrancesAnimation(e,t){this.popupShowUpAnimation||(this.popupShowUpAnimation=new ks({targets:[this.popup],delay:e,duration:t,props:{scale:{start:0,from:0,to:1},alpha:{start:1,from:1,to:1}}})),this.popupShowUpAnimation.play()}runPopupContentEntrancesAnimation(e,t){const s=this.dayBlocks.getChildren();s.length<1||(this.contentShowUpAnimation?.remove(),this.contentShowUpAnimation=new ts({targets:s,duration:t,delay:this.scene.tweens.stagger(150,{start:e}),props:{alpha:{start:0,from:0,to:1}}}),this.contentShowUpAnimation.play())}runPopupExitsAnimation(e,t){this.popupExitsAnimation||(this.popupExitsAnimation=new ut({targets:[this.popup],delay:e,duration:t,props:{y:250,scale:0},onComplete:()=>{this.scene.screen.close(this.name)}})),this.dayBlocks.destroy(!0,!0),this.popupExitsAnimation.play()}createPopup(){this.popup=new Je(this.scene,0,0,310,390),this.add(this.popup),Phaser.Display.Align.In.Center(this.popup,this.zone)}createPopupContents(){this.createTitle(),this.createLoading(),this.createClaimButton(),this.createClaimX2Button()}createTitle(){const e=this.scene.add.container(),t=this.scene.make.image({key:Ss,frame:As.RIBBON_SHORT});t.setWorldSize(271,81);const s=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(30),text:this.scene.lang.Text.DAILY_REWARDS});Phaser.Display.Align.In.Center(s,t,0,-10);const n=new ee(this.scene,Ss,As.BUTTON_CLOSE,38,38);n.setName("Close"),n.useSound=!1,n.onClick=this.handleClosePopup,Phaser.Display.Align.In.RightCenter(n,t,-5,-5),e.add([t,s,n]),this.popup.add(e),Phaser.Display.Align.In.TopCenter(e,this.popup)}createLoading(){this.loading=new Ai(this.scene),this.loading.setVisible(!1),this.loading.setTint(12237498),this.popup.add(this.loading),Phaser.Display.Align.In.Center(this.loading,this.popup)}createDayBlocks(){this.dayBlocks?.destroy(!0,!0);const e=2,t=3,s=Xs.MaxDays,n=12,a=80,r=100,c=a+n,o=r+n;this.dayBlocks=this.scene.make.group({maxSize:s}),new Array(s).fill(null).forEach((h,d)=>{const u=this.createDayBlock(d+1);this.dayBlocks.add(u)}),Phaser.Actions.GridAlign(this.dayBlocks.getChildren(),{width:t,height:e,cellWidth:c,cellHeight:o,x:-88,y:-75})}createDayBlock(e){const{type:t,value:s,status:n=""}=this.getRewardByDay(e),a=new EI(this.scene,{day:e,type:t,value:s,status:n});return a.setAlpha(0),this.popup.add(a),a}createClaimButton(){this.claimButton=new ee(this.scene,Ss,As.BUTTON_BLUE_CIRCLE,79,68),this.claimButton.setName("Claim");const e=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(22),text:this.scene.lang.Text.CLAIM,origin:{x:.5,y:.5}});this.claimButton.add(e),Phaser.Display.Align.In.Center(e,this.claimButton,0,-3),this.popup.add(this.claimButton),Phaser.Display.Align.In.BottomCenter(this.claimButton,this.popup,-86,-30),this.claimButton.onClick=this.handleOnClaim}createClaimX2Button(){this.claimButton2X=new ee(this.scene,Ss,As.BUTTON_GREEN_SHORT,161,68),this.claimButton2X.setName("ClaimX2");const e=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(22),text:this.scene.lang.Text.CLAIM_X2,origin:{x:0,y:.5}}),t=this.scene.make.image({key:Ss,frame:As.ICON_ADS});t.setWorldSize(37,34),Phaser.Display.Align.In.Center(t,this.claimButton2X,-38,-2),Phaser.Display.Align.In.Center(e,this.claimButton2X,24,-3),this.claimButton2X.add([e,t]),this.popup.add(this.claimButton2X),Phaser.Display.Align.In.BottomCenter(this.claimButton2X,this.popup,52,-30),this.claimButton2X.onClick=this.handleOnClaimX2}}const{KEY:Tr,FRAME:Te}=D.DEFAULT;class AI extends GameCore.Screen{popup;title;buttonClose;contents;settingMusic;settingSound;settingVibrate;popupShowUpAnimation;popupFadeOutAnimation;contentShowUpAnimation;constructor(e,t,s,n){super(e,t,s,n),this.createPopup(),this.createTitle(),this.createButtons(),this.addItem(),this.arrangeItems(),this.createInput(),this.setDepth(ht.POPUP),this.background.setAlpha(.8)}open(){super.open();const{player:e}=this.scene,t=e.getPlayerSettings(),{music:s,sound:n,vibrate:a}=t;if(this.settingMusic.updateStatus(s),this.settingSound.updateStatus(n),this.settingVibrate.updateStatus(a),!Xn()){this.settingVibrate.setVisible(!1);const r=65;Phaser.Display.Align.In.Center(this.settingMusic,this.popup,-r,5),Phaser.Display.Align.In.Center(this.settingSound,this.popup,r,5)}this.runOpenAnimation()}createInput(){this.buttonClose.useSound=!1,this.buttonClose.onClick=this.handleClose,this.settingMusic.onClick=this.handleMusicSetting,this.settingSound.onClick=this.handleSoundSetting,this.settingVibrate.onClick=this.handleVibrateSetting}handleClose=()=>{this.runCloseAnimation()};handleMusicSetting=e=>{this.scene.player.setSetting("music",e),e?this.scene.audio.playMusic():this.scene.audio.pauseMusic()};handleSoundSetting=e=>{this.scene.player.setSetting("sound",e)};handleVibrateSetting=e=>{this.scene.player.setSetting("vibrate",e)};createPopup(){this.popup=new Je(this.scene,0,0,310,180),this.add(this.popup),Phaser.Display.Align.In.Center(this.popup,this.zone)}createTitle(){this.title=this.scene.add.container();const e=this.scene.make.image({key:Tr,frame:Te.RIBBON_SHORT});e.setWorldSize(271,81);const t=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(30),text:this.scene.lang.Text.SETTINGS,origin:{x:.5,y:.5}});Phaser.Display.Align.In.Center(t,e,0,-10),this.buttonClose=new ee(this.scene,Tr,Te.BUTTON_CLOSE,38,38),this.buttonClose.setName("Close"),Phaser.Display.Align.In.RightCenter(this.buttonClose,e,-5,-5),this.title.add([e,t,this.buttonClose])}createButtons(){const{music:e,sound:t,vibrate:s}=this.scene.player.getPlayerSettings();this.createMusicButton(e),this.createVibrateButton(s),this.createSoundButton(t)}createMusicButton(e){this.settingMusic=new Ft(this.scene,{enable:e,frameOn:Te.ICON_MUSIC_ON,frameOff:Te.ICON_MUSIC_OFF,backgroundOn:Te.BUTTON_GREEN_CIRCLE,backgroundOff:Te.BUTTON_GREEN_CIRCLE}),this.settingMusic.setName("Music"),this.settingMusic.icon.setWorldSize(43,43),this.settingMusic.button.setWorldSize(70,70)}createVibrateButton(e){this.settingVibrate=new Ft(this.scene,{enable:e,frameOn:Te.ICON_VIB_ON,frameOff:Te.ICON_VIB_OFF,backgroundOn:Te.BUTTON_GREEN_CIRCLE,backgroundOff:Te.BUTTON_GREEN_CIRCLE}),this.settingVibrate.setName("Vibrate"),this.settingVibrate.icon.setWorldSize(43,43),this.settingVibrate.button.setWorldSize(70,70)}createSoundButton(e){this.settingSound=new Ft(this.scene,{enable:e,frameOn:Te.ICON_SOUND_ON,frameOff:Te.ICON_SOUND_OFF,backgroundOn:Te.BUTTON_GREEN_CIRCLE,backgroundOff:Te.BUTTON_GREEN_CIRCLE}),this.settingSound.setName("Sound"),this.settingSound.icon.setWorldSize(43,43),this.settingSound.button.setWorldSize(70,70)}addItem(){this.popup.add([this.title,this.settingVibrate,this.settingMusic,this.settingSound]),this.contents=this.scene.add.group(),this.contents.addMultiple([this.settingVibrate,this.settingMusic,this.settingSound])}arrangeItems(){Phaser.Display.Align.In.TopCenter(this.title,this.popup);const e=5,t=90;Phaser.Display.Align.In.Center(this.settingVibrate,this.popup,0,e),Phaser.Display.Align.In.Center(this.settingSound,this.popup,-t,e),Phaser.Display.Align.In.Center(this.settingMusic,this.popup,t,e)}runOpenAnimation(){this.popupShowUpAnimation?.tween?.isPlaying()||(this.scene.audio.playSound(K.POPUP_SHOW),this.runPopupEntrancesAnimation(0,400),this.runPopupContentEntrancesAnimation(200,300))}runCloseAnimation(){this.popupFadeOutAnimation?.tween?.isPlaying()||(this.scene.audio.playSound(K.POPUP_OFF,{volume:.6}),this.runPopupExitsAnimation(0,200))}runPopupEntrancesAnimation(e,t){if(!this.popupShowUpAnimation){const{y:s,scale:n}=this.popup;this.popupShowUpAnimation=new ks({targets:[this.popup],delay:e,duration:t,props:{y:{from:350,to:s},alpha:{start:1,from:1,to:1},scale:{start:0,from:0,to:n}}})}this.popupShowUpAnimation.play()}runPopupContentEntrancesAnimation(e,t){this.contentShowUpAnimation?.remove(),this.contentShowUpAnimation=new ts({targets:this.contents.getChildren(),duration:t,delay:e,props:{alpha:{start:0,from:0,to:1}}}),this.contentShowUpAnimation.play()}runPopupExitsAnimation(e,t){this.popupFadeOutAnimation||(this.popupFadeOutAnimation=new ut({targets:[this.popup],delay:e,duration:t,props:{y:250,scale:0},onComplete:()=>{this.popup.setY(0),this.scene.screen.close(this.name)}})),this.popupFadeOutAnimation.play()}}const{Gameplay:Ir}=GameCore.Configs;class TI extends ns{main;header;footer;rewardScreen;dailyMissionScreen;dailyRewardsScreen;fireworks;currentDiamond;timerDailyRewards;run=()=>{this.currentDiamond=0,this.footer.giftIcon?.checkUseable(),this.footer.dailyIcon?.checkNotice(),X.off(ue.EVENTS.NOTICE_UPDATE,this.footer.dailyIcon.checkNotice),X.on(ue.EVENTS.NOTICE_UPDATE,this.footer.dailyIcon.checkNotice),this.updateCurrentBestScore(),this.updateCurrentDiamond(),this.timerDailyRewards?.remove(),this.timerDailyRewards=this.time.delayedCall(300,()=>{this.screen.open(U.DAILY_REWARD_SCREEN)}),this.facebook.attemptToAddShortcut()};updateCurrentBestScore(){const e=this.player.getBestScore(),t=this.storage.getState(),{bestScore:s=0}=Rt(t),n=e>s?e:s;this.header.scoreBar.setValue(n)}updateCurrentDiamond(){const e=this.player.getDiamond();this.setDiamond(e)}preload(){this.events.on("wake",this.run),this.events.on("resume",this.run),this.events.on("create",this.run),this.events.on(Phaser.Scenes.Events.PAUSE,()=>{this.timerDailyRewards?.remove()})}create(){super.create(),this.createBackground(fe.BACKGROUND.KEY),this.createSettingsScreen(),this.createRewardScreen(),this.createDailyMissionScreen(),this.createDailyRewardsScreen(),this.createHeaderBar(),this.createMainContent(),this.createFooterBar(),this.fireworks=this.add.group(),this.fireFireworks()}eatDiamond=e=>{this.createDiamondsEffect(10,e),X.emit(ue.COLLECT_DIAMONDS.EVENTS.COLLECT_DIAMONDS,{type:"diamond",value:e})};createDiamondsEffect(e,t){const{x:n,y:a}=this.header.diamondBar.getWorldPosition(),{x:r,y:c}=this.main.logo.getWorldPosition();let o=0;this.tweens.addCounter({duration:1e3/e,repeat:e,repeatDelay:30,onRepeat:()=>{const l=Phaser.Math.RND.between(r-60,r+60),h=new dg(this,{from:{x:l,y:c-80},to:{x:n-40,y:a+7}});h.setDepth(Y.ON_TOP),h.onUpdate=()=>{this.header.setDepth(Y.ON_TOP)},h.onComplete=()=>{const d=this.currentDiamond+Math.floor(t/e);this.setDiamond(d),o++,o>=e&&(this.header.setDepth(Y.ITEM),this.player.setCustomData("diamond",this.currentDiamond))},h.run()}})}setDiamond(e){const t=e<0?0:e;this.currentDiamond=t,this.header.diamondBar.setValue(t)}createSettingsScreen(){this.screen.add(U.SETTINGS_SCREEN,AI)}createRewardScreen(){this.rewardScreen=this.screen.add(U.REWARD_SCREEN,Kc)}createDailyMissionScreen(){this.dailyMissionScreen=this.screen.add(U.DAILY_MISSIONS_SCREEN,cI),this.dailyMissionScreen.onReward=(e,t)=>{e==="diamond"&&this.eatDiamond(t)}}createDailyRewardsScreen(){this.dailyRewardsScreen=this.screen.add(U.DAILY_REWARD_SCREEN,SI),this.dailyRewardsScreen.onNoAd=this.showNotifyNoAds,this.dailyRewardsScreen.onSkipAd=this.showNotifySkipAds,this.dailyRewardsScreen.onReward=e=>{this.eatDiamond(e)}}showNotifyNoAds=()=>{const{globalScene:e}=this.game;e.screen.open(U.NOTIFY_SCREEN,{message:this.lang.Text.NO_ADS,duration:1200,loading:!1})};showNotifySkipAds=()=>{const{globalScene:e}=this.game;e.screen.open(U.NOTIFY_SCREEN,{message:this.lang.Text.CANCELLED_AD,duration:1500,loading:!1})};createHeaderBar(){this.header=new jT(this),this.header.setDepth(Y.BUTTON),this.header.diamondBar.onClick=this.handleDiamondBarClick,Phaser.Display.Align.In.TopCenter(this.header,this.gameZone)}createMainContent(){this.main=new JT(this),this.main.setDepth(Y.LOGO),this.main.playSingleButton.onClick=this.handlePlaySingle,Phaser.Display.Align.In.Center(this.main,this.gameZone)}createFooterBar(){this.footer=new YT(this),this.footer.setDepth(Y.BUTTON),this.footer.dailyIcon.onClick=this.handleDailyIconClick,this.footer.giftIcon.onClick=this.handleGiftIconClick,this.footer.settingIcon.onClick=this.handleSettingClick;const e=this.ads.getBannerHeight();Phaser.Display.Align.In.BottomCenter(this.footer,this.gameZone,0,-e)}createFirework(){const e=new Nc(this);return this.fireworks.add(e),e}fireFireworks=()=>{const{width:t,height:s}=this.gameZone,{y:n}=this.main.logo.getWorldPosition();this.tweens.addCounter({duration:300,repeat:Phaser.Math.RND.between(2,4),onRepeat:()=>{const a=this.fireworks.getMatching("visible",!1);let r=a[0];a.length<1&&(r=this.createFirework()),r.randomColor();const c=Phaser.Math.RND.between(20,t-20);r.fire(c,s,n)},completeDelay:1e3,onComplete:this.fireFireworks})};handlePlaySingle=()=>{this.storage.dispatch(vl()),this.storage.dispatch(Rl("endless"))};handleSettingClick=()=>{this.screen.open(U.SETTINGS_SCREEN)};handleDailyIconClick=()=>{this.screen.open(U.DAILY_MISSIONS_SCREEN)};handleGiftIconClick=()=>{this.rewardScreen.onReward=async e=>{this.eatDiamond(e),await this.player.setCustomData("lastReceiveGift",Date.now()),this.footer.giftIcon.checkUseable()},this.screen.open(U.REWARD_SCREEN,{awardDiamonds:Ir.AwardDiamonds})};handleDiamondBarClick=()=>{this.rewardScreen.onReward=this.eatDiamond,this.screen.open(U.REWARD_SCREEN,{awardDiamonds:Ir.AwardDiamonds})}}const{KEY:II,FRAME:br}=D.EFFECTS;class wr extends Phaser.GameObjects.Particles.ParticleEmitterManager{config;emitter;constructor(e,t){super(e,II,br.FX_CONFETTI_SMALL_1),this.config=t||{},this.scene.add.existing(this)}createEmitters(){const{FX_CONFETTI_SMALL_1:e,FX_CONFETTI_SMALL_2:t,FX_CONFETTI_SMALL_3:s,FX_CONFETTI_SMALL_4:n}=br,a=1/this.scene.world.getPixelRatio(),r={on:!1,particleBringToTop:!0,frame:[e,t,s,n],tint:[14223402,1021804,5420529,16702052],timeScale:1,frequency:300,maxParticles:120,gravityY:-10,speedX:{min:-100,max:100},speedY:{min:80,max:250},alpha:{start:1,end:.8},rotate:{start:0,end:360*3},scale:{min:a*.8,max:a*2},angle:{min:20,max:160},lifespan:{min:8e3,max:12e3}},c=Ce(r,this.config);this.emitter=this.createEmitter(c)}run(e,t,s){this.stop(),this.emitter.setQuantity(e),this.emitter.setPosition(t,s),this.emitter.start()}explode(e,t,s){this.emitter||this.createEmitters(),this.emitter.explode(e,t,s)}stop(){this.emitter?.killAll(),this.emitter?.stop(),this.emitter?.remove(),this.createEmitters()}}const bI={targets:[],duration:600,ease:Phaser.Math.Easing.Back.Out,props:{y:{from:500,to:0}}};class wI extends Ee{constructor(e){super(bI,e)}}const{KEY:Cr,FRAME:vr}=D.DEFAULT;let CI=class extends ee{scene;constructor(e){super(e,Cr,vr.BUTTON_YELLOW_CIRCLE,100.05,78.2),this.setName("Home"),this.scene=e,this.createIcon()}createIcon(){const e=this.scene.make.image({key:Cr,frame:vr.ICON_FLAT_HOME});e.setSize(43,43).setDisplaySize(43,43),Phaser.Display.Align.In.Center(e,this.button),this.add(e)}},vI=class extends Phaser.GameObjects.Container{scene;homeButton;entrancesAnimation;constructor(e){super(e),this.scene=e,this.setName("FooterBar"),this.createHomeButton(),this.createEntrancesAnimation(),this.alignIcons(),this.scene.add.existing(this)}runAnimation=()=>{this.entrancesAnimation.play()};createEntrancesAnimation(){this.entrancesAnimation=new wI({targets:[this],delay:800,props:{y:"-=5",alpha:{start:0,from:0,to:1}}})}alignIcons(){Phaser.Display.Align.In.Center(this.homeButton,this,0,-6)}createHomeButton(){this.homeButton=new CI(this.scene),this.add(this.homeButton)}};const{KEY:_I,FRAME:OI}=D.DEFAULT;class RI extends Phaser.GameObjects.Container{bestScore;payload;theCat;popup;ribbon;yourScoreText;bestScoreText;currentScoreText;entrancesAnimation;scoreAnimation;counterAnimation;constructor(e){super(e),this.scene=e,this.bestScore=0,this.createPopup(),this.createTheCat(),this.createRibbon(),this.createYourScoreText(),this.createCurrentScore(),this.createBestScore(),this.createScoreAnimation(),this.createEntrancesAnimation(),this.scene.add.existing(this)}updateData(e){this.payload=e;const{bestScore:t,currentScore:s}=e;if(s<=t){this.setBestScore(t),this.setCurrentScore(s),this.runScoreAnimation();return}this.runAnimation()}runAnimation(){this.runScoreCounter(),this.scene.time.delayedCall(1300,()=>{this.entrancesAnimation.play(),this.scene.audio.playSound(K.SCORE_COUNTER)})}runScoreCounter(){const{bestScore:e,currentScore:t}=this.payload;this.counterAnimation?.remove(),this.counterAnimation=this.scene.tweens.addCounter({from:0,to:t,delay:500,duration:2e3,completeDelay:300,onUpdate:s=>{const n=Math.floor(s.getValue());this.runScoreAnimation(),this.setCurrentScore(n)},onComplete:()=>{this.bestScore=e,this.setBestScore(e),this.setCurrentScore(t),this.counterAnimation.remove()}})}runScoreAnimation(){this.scoreAnimation.play()}setBestScore(e){this.bestScoreText.setText(`${this.scene.lang.Text.BEST_SCORE}: ${e}`)}setCurrentScore(e){this.currentScoreText.setText(`${e}`)}createPopup(){this.popup=new Je(this.scene,0,0,284,240),this.add(this.popup)}createTheCat(){this.theCat=new qn(this.scene),Phaser.Display.Align.In.TopCenter(this.theCat,this.popup),this.add(this.theCat)}createRibbon(){this.ribbon=this.scene.make.image({key:_I,frame:OI.RIBBON_LONG}),this.ribbon.setSize(341,80).setDisplaySize(341,80),Phaser.Display.Align.In.Center(this.ribbon,this.theCat,0,93),this.add(this.ribbon)}createYourScoreText(){this.yourScoreText=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(30),origin:{x:.5,y:.5},text:this.scene.lang.Text.YOUR_SCORE}),Phaser.Display.Align.In.Center(this.yourScoreText,this.ribbon,0,-10),this.add(this.yourScoreText)}createCurrentScore(){this.currentScoreText=new fi(this.scene,{font:k.PRIMARY.KEY,size:this.scene.fontSize(60)}),this.currentScoreText.setTintText(15779090,15779090,15704623,15704623),this.currentScoreText.setDropShadow(0,2,8804140),Phaser.Display.Align.In.Center(this.currentScoreText,this.popup,0,30),this.add(this.currentScoreText)}createBestScore(){this.bestScoreText=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(24),origin:{x:.5,y:.5},text:`${this.scene.lang.Text.BEST_SCORE}: ${this.bestScore}`}),this.bestScoreText.setTint(10494183),Phaser.Display.Align.In.BottomCenter(this.bestScoreText,this.popup,0,-25),this.add(this.bestScoreText)}createEntrancesAnimation(){this.entrancesAnimation=new qe({targets:[this],repeat:0,duration:200,props:{scale:"+=0.03"}})}createScoreAnimation(){this.scoreAnimation=new jn({targets:[this.currentScoreText],props:{scale:{from:1,to:1.3}}})}}let PI=class extends Phaser.GameObjects.Container{scene;bestScoreBlock;constructor(e){super(e),this.scene=e,this.createBestScoreBlock(),this.scene.add.existing(this)}createBestScoreBlock(){this.bestScoreBlock=new RI(this.scene),this.add(this.bestScoreBlock)}};const{KEY:_r,FRAME:Or}=D.EFFECTS;class DI extends Phaser.GameObjects.Container{halo;star;constructor(e){super(e),this.createStar(),this.createHalo(),this.scene.add.existing(this)}run(){this.runStarAnimation(),this.runHaloAnimation()}createStar(){this.star=this.scene.make.image({key:_r,frame:Or.FX_STAR_YELLOW,visible:!1}),this.star.setWorldSize(35,35),this.add(this.star)}createHalo(){this.halo=this.scene.make.image({key:_r,frame:Or.FX_CIRCLE,visible:!1}),this.halo.setWorldSize(162,162),this.add(this.halo)}runStarAnimation(){this.scene.tweens.killTweensOf(this.star),this.star.setVisible(!0);const e=1/this.scene.world.getPixelRatio();this.scene.tweens.add({targets:[this.star],duration:400,ease:Phaser.Math.Easing.Quintic.Out,props:{scaleX:{start:e*16,to:0},scaleY:{start:e*10,to:0}},onComplete:()=>{this.star.setVisible(!1)}})}runHaloAnimation(){this.scene.tweens.killTweensOf(this.halo),this.halo.setScale(0),this.halo.setVisible(!0),this.scene.tweens.add({targets:[this.halo],duration:200,ease:Phaser.Math.Easing.Cubic.Out,props:{scale:{from:0,to:8},alpha:{from:1,to:0}},onComplete:()=>{this.halo.setVisible(!1)}})}}const{KEY:on,FRAME:qs}=D.DEFAULT;class MI extends GameCore.Screen{avatar;scoreText;bigStarExplosive;constructor(e,t,s,n){super(e,t,s,n),this.setDepth(ht.POPUP),this.background.setAlpha(.8),this.createObjects()}open=e=>{super.open(e);const t=this.getData("bestScore");this.setBestScore(t);const s=this.scene.player.getPlayer();this.avatar.loadPhoto(s.playerId,""),this.runOpenAnimation(),this.scene.audio.playSound(K.CONGRATULATION)};createObjects(){this.createTitle(),this.createClose(),this.createBestScoreTitle(),this.createPlayerAvatar(),this.createGlowEffect(),this.createBestScoreNumber(),this.createStarTwinkleEffect(),this.createBigStarExplosive()}setBestScore(e){this.scoreText.setText(`${e}`)}createTitle(){const e=this.scene.make.image({key:on,frame:qs.RIBBON_SMALL});e.setSize(162,36).setDisplaySize(162,36);let t=-90;Phaser.Display.Align.In.TopCenter(e,this.zone,0,t);const s=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(17),text:this.scene.lang.Text.TODAY_RECORD});t=-5,Phaser.Display.Align.In.Center(s,e,0,t),this.add([e,s])}createClose(){const e=new ee(this.scene,on,qs.BUTTON_CLOSE,38,38);e.setName("Close"),this.add(e),Phaser.Display.Align.In.TopRight(e,this.zone,-60,-50),e.onClick=this.handleClose}handleClose=()=>{this.scene.screen.close(this.name)};createBestScoreTitle(){const e=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:22,text:this.scene.lang.Text.BEST_SCORE});this.add(e),e.setTint(13256697),Phaser.Display.Align.In.TopCenter(e,this.zone,0,-130)}createBestScoreNumber(){this.scoreText=new fi(this.scene,{font:k.PRIMARY.KEY,size:40}),this.add(this.scoreText),this.scoreText.setTintText(15911443,15911443,15902254,15902254),this.scoreText.setDropShadow(0,2,12871743),Phaser.Display.Align.In.TopCenter(this.scoreText,this.zone,0,-230)}createPlayerAvatar(){this.avatar=new Ti(this.scene,{key:on,frame:qs.AVATAR_FRAME_YELLOW_BIG,background:qs.AVATAR_BG_YELLOW_BIG,width:95,height:95}),this.add(this.avatar),Phaser.Display.Align.In.Center(this.avatar,this.zone,0,30)}createGlowEffect(){const{KEY:e,FRAME:t}=D.EFFECTS,s=this.scene.make.image({key:e,frame:t.FX_GLOW_LIGHT});s.setWorldSize(246,246),this.add(s),this.moveDown(s),Phaser.Display.Align.In.Center(s,this.avatar),this.scene.tweens.add({targets:[s],duration:6e3,repeat:-1,props:{angle:360,scale:{value:"+=0.01",yoyo:!0,duration:800,ease:Phaser.Math.Easing.Sine.InOut}}})}createStarTwinkleEffect(){const e=new dl(this.scene),{x:t,y:s}=this.scoreText,n=300,a=120;e.run(2,t,s,n,a)}createBigStarExplosive(){this.bigStarExplosive=new DI(this.scene)}runOpenAnimation(){this.runBigStarExplosive(),this.runScoreEntrancesAnimation(),this.runAvatarEntrancesAnimation()}runBigStarExplosive=()=>{Phaser.Display.Align.In.Center(this.bigStarExplosive,this.scoreText),this.bigStarExplosive.run()};runScoreEntrancesAnimation(){this.scene.tweens.killTweensOf(this.scoreText),new ks({targets:[this.scoreText],duration:300,props:{y:{from:0,to:this.scoreText.y}}}).play()}runAvatarEntrancesAnimation(){this.scene.tweens.killTweensOf(this.avatar);const{scale:e}=this.avatar;new zn({targets:[this.avatar],duration:400,props:{scale:{from:0,to:e}}}).play()}}class LI extends ns{bestScore;currentScore;footerBar;main;confettiLeftEffect;confettiRightEffect;preload(){this.events.on("resume",()=>{this.updateScore()}),this.events.on("sleep",()=>{this.storage.dispatch(vi())}),this.events.on("wake",this.run),this.events.on("create",this.run)}create(){super.create(),this.createBackground(fe.BACKGROUND.KEY);const e=this.player.getBestScore();this.bestScore=e,this.currentScore=0,this.createMain(),this.createFooterBar(),this.createBestScoreScreen(),this.createConfettiSmallAnimation()}run=()=>{this.updateScore(),this.explodeConfettiEffect(),this.main.bestScoreBlock.counterAnimation&&this.main.bestScoreBlock.counterAnimation.state!==Phaser.Tweens.REMOVED?this.main.bestScoreBlock.counterAnimation.on(Phaser.Tweens.Events.TWEEN_COMPLETE,()=>{this.handleShowBestScorePopup(),this.handleShowResultChallengePopup()}):this.time.delayedCall(800,()=>{this.handleShowBestScorePopup(),this.handleShowResultChallengePopup()}),this.footerBar.setAlpha(0),this.footerBar.runAnimation(),this.audio.pauseMusic(),this.audio.playSound(K.GAME_OVER_SCENE)};updateScore(){const e=this.storage.getState(),{score:t=0,bestScore:s=0}=Rt(e);this.bestScore=s<this.bestScore?this.bestScore:s,this.currentScore=t,this.main.bestScoreBlock.updateData({bestScore:this.bestScore,currentScore:this.currentScore})}runConfettiEffect=()=>{const{displayWidth:e}=this.gameZone,t=0,s=-100,n=e;this.confettiLeftEffect.stop(),this.confettiRightEffect.stop(),this.children.bringToTop(this.confettiLeftEffect),this.children.bringToTop(this.confettiRightEffect),this.confettiLeftEffect.run(1,t,s),this.confettiRightEffect.run(1,t+n,s),this.tweens.addCounter({delay:1e4,from:100,to:0,ease:Phaser.Math.Easing.Cubic.Out,duration:400,onUpdate:a=>{const r=a.getValue()/100;this.confettiLeftEffect.emitter?.setAlpha(r),this.confettiRightEffect.emitter?.setAlpha(r)},onComplete:()=>{this.confettiLeftEffect.emitter?.setAlpha(1),this.confettiRightEffect.emitter?.setAlpha(1),this.confettiLeftEffect.stop(),this.confettiRightEffect.stop()}})};explodeConfettiEffect=()=>{const{displayWidth:e}=this.gameZone,t=0,s=-100,n=e;this.tweens.addCounter({repeat:3,duration:500,onStart:()=>{this.confettiLeftEffect.explode(6,t,s),this.confettiRightEffect.explode(6,t+n,s)},onRepeat:()=>{this.confettiLeftEffect.explode(6,t,s),this.confettiRightEffect.explode(6,t+n,s)},completeDelay:7e3,onComplete:()=>{this.tweens.addCounter({from:100,to:0,ease:Phaser.Math.Easing.Cubic.Out,duration:400,onUpdate:a=>{const r=a.getValue()/100;this.confettiLeftEffect.emitter?.setAlpha(r),this.confettiRightEffect.emitter?.setAlpha(r)},onComplete:()=>{this.confettiLeftEffect.emitter?.setAlpha(1),this.confettiRightEffect.emitter?.setAlpha(1),this.confettiLeftEffect.stop(),this.confettiRightEffect.stop()}})}})};createMain(){this.bestScore=0,this.main=new PI(this),Phaser.Display.Align.In.TopCenter(this.main,this.gameZone,0,-230),this.main.bestScoreBlock.theCat.runStarTwinkle()}createFooterBar(){this.footerBar=new vI(this),Phaser.Display.Align.In.BottomCenter(this.footerBar,this.gameZone,0,-110),this.footerBar.homeButton.onClick=this.handleHomeClick}createBestScoreScreen(){this.screen.add(U.BEST_SCORE_SCREEN,MI)}createConfettiSmallAnimation(){this.confettiLeftEffect=new wr(this,{speedX:{min:-20,max:100},rotate:{start:-360*3,end:0}}),this.confettiRightEffect=new wr(this,{speedX:{min:20,max:-100},rotate:{start:0,end:360*3}}),this.confettiLeftEffect.setDepth(Y.EFFECT),this.confettiRightEffect.setDepth(Y.EFFECT)}handleHomeClick=()=>{this.audio.stopSound(K.GAME_OVER_SCENE),this.audio.playMusic(),this.scene.switch($.DASHBOARD_SCENE)};handleShowBestScorePopup(){this.currentScore>this.bestScore&&this.storage.dispatch(Ds({bestScore:this.currentScore}));const e=this.storage.getState(),t=vt(e),s=[Ye,Xe].indexOf(t)>=0;this.currentScore>this.bestScore&&s&&(this.screen.open(U.BEST_SCORE_SCREEN,{bestScore:this.currentScore}),this.runConfettiEffect())}handleShowResultChallengePopup(){const e=this.storage.getState(),t=vt(e);if([Ge,$e].indexOf(t)===-1||!Ei(e))return;const n=_t(e),{playerId:a}=n;t===$e&&a===Re.playerId||(this.scene.pause($.GAME_OVER_SCENE),this.scene.launch($.RESULT_MATCH_SCENE))}}const Gl=i=>({type:Uo,payload:{sceneKey:i}}),xI=i=>i.scene.currentSceneKey,NI=V([xI],i=>i),{KEY:kI,FRAME:GI}=D.DEFAULT;class BI extends Phaser.GameObjects.Container{fps=0;fpsString="FPS: %1";fpsText;background;lastUpdate;constructor(e){super(e,0,0),this.createFps(),this.setDepth(Y.DEBUG),this.scene.add.existing(this),this.scene.events.on(Phaser.Scenes.Events.UPDATE,this.update)}update=e=>{if(e-this.lastUpdate<800)return;this.lastUpdate=e;const t=Math.floor(this.scene.game.loop.actualFps);this.setFps(t)};setFps(e){this.fps=e;const t=Phaser.Utils.String.Format(this.fpsString,[e]);this.fpsText.setText(t)}createFps(){this.background=this.scene.make.image({key:kI,frame:GI.BLANK}),this.background.setName("BG"),this.background.setTint(13801480),this.background.setWorldSize(45,25),this.fpsText=this.scene.make.bitmapText({size:this.scene.fontSize(14),text:this.fpsString,font:k.PRIMARY.KEY,origin:{x:.5,y:.5}}),this.fpsText.setName("FPS Meter"),Phaser.Display.Align.In.Center(this.fpsText,this.background),this.add([this.background,this.fpsText]),this.setFps(0)}}class UI extends Phaser.GameObjects.Container{performance;memory=0;maxMemoryLimit;maxPercentThreshold;normalColor=3459162;warningColor=16768343;alarmColor=15812200;memoryString="Memory: %1MB / %2MB";memoryText;lastUpdate;constructor(e){if(super(e,0,0),this.performance=window.performance,this.createMemory(),this.setDepth(Y.DEBUG),this.scene.add.existing(this),!this.isSupport()){this.memoryText.setText("Memory: not supported!");return}const{jsHeapSizeLimit:t}=this.performance.memory;this.maxPercentThreshold=90,this.setMaxMemory(t/1048576),this.scene.events.on(Phaser.Scenes.Events.UPDATE,this.update)}update=e=>{if(e-this.lastUpdate<1e3)return;this.lastUpdate=e;const{usedJSHeapSize:t}=this.performance.memory,s=this.maxMemoryLimit*1048576,n=Math.round(t/1048576);this.setMemory(n),this.memoryText.setTint(this.normalColor),t>this.maxPercentThreshold/100*s&&this.memoryText.setTint(this.warningColor),t>s&&this.memoryText.setTint(this.alarmColor)};isSupport(){return this.performance&&!!this.performance?.memory}setMaxMemory(e){this.maxMemoryLimit=Math.round(e)}setMemory(e){this.memory=e;const t=Phaser.Utils.String.Format(this.memoryString,[e,this.maxMemoryLimit]);this.memoryText.setText(t)}createMemory(){this.memoryText=this.scene.make.bitmapText({size:this.scene.fontSize(14),text:this.memoryString,font:k.PRIMARY.KEY,depth:2e3}),this.memoryText.setName("Memory Meter"),this.add(this.memoryText),this.setMemory(0)}}class FI extends GameCore.Screen{loadingIcon;messageText;openAnimation;closeTimerEvent;constructor(e,t,s,n){super(e,t,s,n),this.addLoadingIcon(),this.addMessageText(),this.setDepth(ht.PRIORITY),this.background.setAlpha(.8)}open(e){super.open(e);const[t="",s=0,n=!1]=this.getData(["message","duration","loading"]);this.setMessage(t),this.showLoading(n),this.closeTimerEvent?.remove(),s>0&&(this.closeTimerEvent=this.scene.time.addEvent({delay:s,callback:()=>{this.visible&&this.scene.screen.close(this.name)}})),this.runOpenAnimation()}addLoadingIcon(){this.loadingIcon=new Ai(this.scene),this.add(this.loadingIcon),Phaser.Display.Align.In.Center(this.loadingIcon,this.zone)}addMessageText(){this.messageText=this.scene.make.bitmapText({size:this.scene.fontSize(30),font:k.PRIMARY.KEY,origin:{x:.5,y:.5}}),this.messageText.setCenterAlign(),this.add(this.messageText)}setMessage(e){this.messageText.setText(e)}showLoading(e){this.loadingIcon.setVisible(e);const t=e===!1?20:80;Phaser.Display.Align.In.Center(this.messageText,this.zone,0,t)}runOpenAnimation(){this.openAnimation?.stop(),this.openAnimation?.remove(),this.openAnimation=new ts({targets:[this.messageText,this.loadingIcon],props:{scale:{getStart:e=>e.scale-.3,getEnd:e=>e.scale}}}),this.openAnimation.play()}logPageviewOnOpen(){}logPageviewOnClose(){}}const{KEY:YI,FRAME:HI}=D.DEFAULT;class ia extends ns{mask;fadeInAnim;fadeOutAnim;fpsMeter;memoryMeter;init(){this.listenScenesEvents(),this.game.globalScene=this}setup(){this.scaleGame(),this.addMask(),this.addNotifyScreen(),this.addFPS(),this.addMemory()}addNotifyScreen(){const e=this.screen.add(U.NOTIFY_SCREEN,FI);Phaser.Display.Align.In.Center(e,this.gameZone)}addMask(){this.mask=this.make.image({key:YI,frame:HI.BLANK});const{width:e,height:t}=this.gameZone;this.mask.setAlpha(0),this.mask.setOrigin(0,0),this.mask.setTint(0),this.mask.setWorldSize(e,t)}addFPS(){const{ShowFPSInGame:e}=GameCore.Configs.Statistics;e&&(this.fpsMeter=new BI(this),Phaser.Display.Align.In.TopLeft(this.fpsMeter,this.gameZone,-20,-10))}addMemory(){const{ShowMemoryInGame:e}=GameCore.Configs.Statistics;e&&(this.memoryMeter=new UI(this),Phaser.Display.Align.In.TopLeft(this.memoryMeter,this.gameZone,-45,-3))}updateSceneState(){this.setGlobalSceneOnTop()}setGlobalSceneOnTop(){this.scene.bringToTop(this)}runMaskFadeInAnimation(){this.mask&&GameCore.Configs.EnableEffectSceneTransition&&(this.fadeInAnim?.remove(),this.fadeOutAnim?.remove(),this.fadeInAnim=new es({targets:[this.mask],duration:400,ease:Phaser.Math.Easing.Cubic.In,props:{alpha:{start:0,from:0,to:.6}}}),this.mask.setAlpha(0),this.fadeInAnim.play())}runMaskFadeOutAnimation(){this.mask&&GameCore.Configs.EnableEffectSceneTransition&&(this.fadeInAnim?.remove(),this.fadeOutAnim?.remove(),this.fadeOutAnim=new ut({targets:[this.mask],duration:400,ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:{start:.6,from:.6,to:0}}}),this.mask.setAlpha(1),this.fadeOutAnim.play())}listenScenesEvents(){this.scene.manager.getScenes(!1).forEach(t=>{t.events.on(Phaser.Scenes.Events.CREATE,this.emitGameEventStartScene),t.events.on(Phaser.Scenes.Events.SLEEP,this.emitGameEventSleepScene),t.events.on(Phaser.Scenes.Events.WAKE,this.emitGameEventWakeScene),t.events.on(Phaser.Scenes.Events.PAUSE,this.emitGameEventPauseScene),t.events.on(Phaser.Scenes.Events.RESUME,this.emitGameEventResumeScene),t.events.on(Phaser.Scenes.Events.SHUTDOWN,this.emitGameEventShutdownScene)}),this.events.on(ke.SWITCH,this.switchScene)}getActiveScene(){return this.scene.manager.getScenes(!0)[0]}getCurrentScene(){return this.currentScene}get currentScene(){const e=this.storage.getState(),t=NI(e);let s;return t?s=this.scene.manager.getScene(t):s=this.getActiveScene(),s.scene}switchScene=e=>{this.currentScene.switch(e)};updateActiveSceneKey(e){e!==$.GLOBAL_SCENE&&this.storage.dispatch(Gl(e))}emitGameEventStartScene=e=>{const{key:t}=e.scene;console.info("%cScene start","color: #D27D2D",t),this.updateSceneState(),this.runMaskFadeOutAnimation(),this.updateActiveSceneKey(t),this.game.events.emit(Phaser.Scenes.Events.START,t),ui("scene",`Start scene: ${t}`)};emitGameEventSleepScene=e=>{const{key:t}=e.scene.scene;console.info("%cScene sleep","color: #D27D2D",t),t!==$.LOAD_SCENE&&(this.runMaskFadeInAnimation(),this.game.events.emit(Phaser.Scenes.Events.SLEEP,t))};emitGameEventWakeScene=e=>{const{key:t}=e.scene.scene;console.info("%cScene wake","color: #D27D2D",t),t!==$.LOAD_SCENE&&(this.updateSceneState(),this.runMaskFadeOutAnimation(),this.updateActiveSceneKey(t),this.game.events.emit(Phaser.Scenes.Events.WAKE,t))};emitGameEventPauseScene=e=>{const{key:t}=e.scene.scene;console.info("%cScene pause","color: #D27D2D",t),this.game.events.emit(Phaser.Scenes.Events.PAUSE,t)};emitGameEventResumeScene=e=>{const{key:t}=e.scene;console.info("%cScene resume","color: #D27D2D",t),this.game.events.emit(Phaser.Scenes.Events.RESUME,t)};emitGameEventShutdownScene=e=>{const{key:t}=e.scene.scene;console.info("%cScene shutdown","color: #D27D2D",t),this.game.events.emit(Phaser.Scenes.Events.SHUTDOWN,t)};logEventOpen(){}logPageviewOnOpen(){}}const{UseMock:VI,Limit:WI}=GameCore.Configs.LeadersBoard,Zs=(i,e,t=WI,s=0)=>async n=>{try{const{player:a}=window.game,r=a.getPlayerId();if(n(clearLeaderboardData()),n({type:fc,payload:{leaderboardId:i,type:e,limit:t,offset:s}}),VI){await wn(1e3);const l=new Array(t).fill(null).map((h,d)=>{const u=(d+1)*(s+1);return{playerId:`0${u}`,name:`Player ${u}`,photo:"https://picsum.photos/80",rank:u,score:Math.floor(1e5/u)}});n(cn(l,e));return}let c=[];if(e===It)c=await jA({limit:t,offset:s});else if(e===Yt){const l=a.getConnectedPlayerIds(t,s);l.push(r);const h=GameCore.Utils.Array.unique(l);c=await XA({playerIds:h,limit:h.length}),h.forEach(d=>{const u=c.filter(p=>p.playerId===d);(!u||u.length===0)&&c.push({playerId:d,score:0})})}const o={};for(const l of c){const h=l.getPlayer(),d=h.getPhoto(),u=h.getName(),p=h.getID(),m=l.getScore(),g=l.getRank();o[p]={playerId:p,name:u,photo:d,score:m,rank:g}}n(cn(o,e))}catch(a){n(cn([],e)),j(a)}},cn=(i,e)=>({type:Ec,payload:{leaders:i,type:e}}),Bl=i=>i[gc],KI=i=>Bl(i).leaders,jI=i=>Bl(i).isRequesting,zI=V([KI],i=>i),$I=V([jI],i=>i),{KEY:Rr,FRAME:Pr}=D.DEFAULT;class XI extends ee{scene;constructor(e){super(e,Rr,Pr.BUTTON_YELLOW_CIRCLE),this.scene=e,this.button.setSize(87,68).setDisplaySize(87,68),this.setName("Home"),this.createIcon()}createIcon(){const e=this.scene.add.image(0,0,Rr,Pr.ICON_FLAT_HOME);e.setSize(43,43).setDisplaySize(43,43),this.add(e),Phaser.Display.Align.In.Center(e,this)}}class qI extends Phaser.GameObjects.Container{scene;homeButton;shareButton;constructor(e){super(e),this.scene=e,this.setName("FooterBar"),this.createButtons(),this.alignButtons(),this.scene.add.existing(this)}alignButtons(){Phaser.Display.Align.In.Center(this.homeButton,this)}createButtons(){this.createHomeButton()}createHomeButton(){this.homeButton=new XI(this.scene),this.add(this.homeButton)}}class ZI extends Phaser.GameObjects.Container{config;isEnable;maxHeight;isScrolling;boundTop;boundBottom;maskGraphics;objects;_value=0;velocity=0;isScrollingSmooth;lastScrollY;isScrollingBack;scrollingBackTo;lastScrollYCount=0;onScrollEvents=[];get marginTop(){return this.config.marginTop}get marginBottom(){return this.config.marginBottom}get acceleration(){return this.config.acceleration}get maxScrollOver(){return this.config.maxScrollOver}get scrollSmooth(){return this.config.scrollSmooth}get scrollingBackRate(){return this.config.scrollingBackRate}constructor(e,t){super(e),this.config={marginTop:0,marginBottom:0,acceleration:1400,maxScrollOver:.15,scrollSmooth:40,scrollingBackRate:5,...t};const{width:s,height:n}=t;this.isEnable=!1,this.maxHeight=0,this.lastScrollY=new Array(3).fill(0),this.setSize(s,n),this.createGroup(),this.createInput(),this.createEvents(),this.scene.add.existing(this)}onScroll(e){this.onScrollEvents.push(e)}get value(){return this._value}set value(e){const t=e-this._value;this._value=e,this.updateObject(t)}gotoTop(){this.value=this.config.marginTop}reset(){this.maxHeight=0,this.isScrolling=!1,this.isScrollingBack=!1,this.isScrollingSmooth=!1,this.gotoTop(),this.setEnable(!1)}createDebug(){const e=this.drawDebugBox(16711680,.8);console.log(e?.x,e?.y,e?.displayWidth,e?.displayHeight)}setEnable(e){this.isEnable=e,e?this.setInteractive({draggable:!0,useHandCursor:!0}):this.disableInteractive()}addItem(e){this.addAt(e),this.objects.add(e);const{y:t,height:s}=e,n=t+s+this.marginBottom-this.height/2;this.maxHeight=Math.max(this.maxHeight,n,0),this.updateObjectVisible()}addItems(e){this.addAt(e),this.objects.addMultiple(e);const t=e.map(s=>s.y+s.height+this.marginBottom-this.height/2);this.maxHeight=Math.max(this.maxHeight,Math.max(...t),0),this.updateObjectVisible()}clearItem(){this.objects.clear(!0,!0),this.reset()}getChildren(){return this.objects.getChildren().filter(e=>e.active)}createBound(e,t,s,n){this.boundTop=this.scene.make.image({key:e,frame:t}),this.boundBottom=this.scene.make.image({key:e,frame:t}),this.boundTop.setTint(n),this.boundBottom.setTint(n),this.boundTop.setAlpha(1,1,0,0),this.boundBottom.setAlpha(0,0,1,1),this.boundTop.setDepth(Y.PRIORITY),this.boundBottom.setDepth(Y.PRIORITY);const a=this.width,r=s,{x:c,y:o}=this.getWorldPosition();this.boundTop.setDisplaySize(a,r),this.boundBottom.setDisplaySize(a,r),this.boundTop.setY(-this.displayHeight/2+r/2+o-this.y-1),this.boundBottom.setY(this.displayHeight/2-r/2+o-this.y+1),this.boundTop.setX(c-this.x),this.boundBottom.setX(c-this.x),this.add([this.boundTop,this.boundBottom])}createMask(){this.maskGraphics?.destroy(),this.maskGraphics=this.scene.make.graphics({fillStyle:{color:255,alpha:1},visible:!0}),this.maskGraphics.setName("MaskGraphics");const e=this.width,t=this.height;this.maskGraphics.fillRoundedRect(0-e/2,0-t/2,e,t,0),this.setMask(this.maskGraphics.createGeometryMask()),this.scene.events.off(Phaser.Scenes.Events.UPDATE,this.updateMask,this),this.scene.events.on(Phaser.Scenes.Events.UPDATE,this.updateMask,this)}updateMask(){const{x:e,y:t}=this.getWorldPosition();this.maskGraphics.setPosition(e,t)}createGroup(){this.objects=this.scene.make.group({})}updateObject(e){this.objects.incY(e),this.updateObjectVisible()}updateObjectVisible(){const e=this.objects.getChildren();for(let t=0;t<e.length;t++){const s=e[t];s.y+s.height<-this.height/2||s.y-s.height>this.height/2?s.setVisible(!1):s.setVisible(!0)}}createInput(){this.setInteractive({draggable:!0,useHandCursor:!0}),this.on(Phaser.Input.Events.POINTER_WHEEL,this.onMouseScroll),this.on(Phaser.Input.Events.GAMEOBJECT_DRAG,this.onTouchScroll),this.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onTouchDown),this.scene.input.on(Phaser.Input.Events.POINTER_UP,this.onTouchEnd,this)}createEvents(){this.scene.events.on(Phaser.Scenes.Events.UPDATE,this.update)}update=(e,t)=>{this.isScrollingSmooth&&this.velocity&&this.scrollingSmooth(t),this.isScrollingBack&&this.scrollingBack(t)};callOnScrollEvents(e,t){for(const s of this.onScrollEvents)s(this,e,t)}scrollingBack(e){const t=(this.scrollingBackTo-this.value)*e*this.scrollingBackRate/1e3;this.value+=t,Math.abs(this.scrollingBackTo-this.value)<.5&&(this.value=this.scrollingBackTo,this.stopScrollingBack()),this.callOnScrollEvents(this.value,t)}startScrollingBack(e){this.isScrollingBack=!0,this.scrollingBackTo=e}stopScrollingBack(){this.isScrollingBack=!1}scrollingSmooth(e){const t=this.velocity*e/1e3;this.value+=t;const s=Math.abs(this.velocity)/this.velocity;this.velocity-=s*this.acceleration*e/1e3,Math.abs(this.velocity)<this.acceleration*e/1e3&&this.stopScrollSmooth(),this.isReachTop()&&(this.startScrollingBack(this.marginTop),this.stopScrollSmooth()),this.isReachBottom()&&(this.startScrollingBack(-this.maxHeight),this.stopScrollSmooth()),this.callOnScrollEvents(this.value,t)}startScrollSmooth(e){this.isScrollingSmooth=!0,e&&(e*this.velocity>0?this.velocity+=e:this.velocity=e)}stopScrollSmooth(){this.isScrollingSmooth=!1,this.isScrolling=!1,this.velocity=0}isReachTop(){return this.value>this.marginTop}isReachBottom(){return-this.value>this.maxHeight}checkReachBound=()=>this.isReachTop()||this.isReachBottom();onMouseScroll=hi((e,t,s)=>{if(!this.isEnable)return;if(this.isScrolling=!0,this.checkReachBound()){this.lastScrollY=this.lastScrollY.map(()=>0),this.isScrolling=!1;return}this.stopScrollingBack(),this.startScrollSmooth(-s*this.scrollSmooth/15)},100,{isImmediate:!0,maxWait:100});onTouchScroll=e=>{if(!this.isEnable)return;this.velocity&&this.stopScrollSmooth(),this.stopScrollingBack(),this.isScrolling=!0;const t=this.scene.game.world.getZoomRatio(),{position:s,prevPosition:n}=e,a=(s.y-n.y)/t,r=this.height*this.maxScrollOver;let c=1;if(this.lastScrollY[++this.lastScrollYCount%this.lastScrollY.length]=a,this.isReachTop()&&a>=0){const h=(r-(this.value-this.marginTop))/r;c=Math.min(c,h)}if(this.isReachBottom()&&a<=0){const h=(r-(-this.maxHeight-this.value))/r;c=Math.min(c,h)}const o=a*c,l=this.maxScrollOver*this.height;this.value+o>this.marginTop+l?this.value=this.marginTop+l:this.value+o<-this.maxHeight-l?this.value=-this.maxHeight-l:this.value+=o,this.callOnScrollEvents(this.value,o)};onTouchDown=()=>{this.isEnable&&(this.velocity&&this.stopScrollSmooth(),this.stopScrollingBack())};onTouchEnd=()=>{if(this.isReachTop()&&(this.startScrollingBack(this.marginTop),this.stopScrollSmooth()),this.isReachBottom()&&(this.startScrollingBack(-this.maxHeight),this.stopScrollSmooth()),!this.isScrolling)return;const e=this.lastScrollY.reduce((t,s)=>t+s)/this.lastScrollY.length;this.startScrollSmooth(e*this.scrollSmooth),this.lastScrollY=this.lastScrollY.map(()=>0)}}class sw extends Phaser.GameObjects.GameObject{constructor(e){super(e,"UpdateAbleObject")}updateInfo}class JI extends ZI{classType;listConfigs;padding;startObjectIndex;endObjectIndex;listObjects;constructor(e,t){super(e,t),this.classType=t.classType,this.listConfigs=t.listConfigs,this.padding=t.padding?t.padding:0,this.objects.classType=this.classType,this.updateConfig(this.listConfigs)}reset(){super.reset(),this.killAndHideAll()}getChildren(){return this.listObjects.filter(e=>e!=null&&e.active)}get objHeight(){const e=this.objects.getChildren();return e.length==0?this.maxHeight=0:e[0].height}updateConfig(e){this.reset(),this.listConfigs=e,this.listObjects=new Array(e.length).fill(void 0),this.addObjectIndex(0,0);const t=this.getEndObjectIndex();this.addObjectIndex(1,t),this.startObjectIndex=this.getStartObjectIndex(),this.endObjectIndex=this.getEndObjectIndex(),this.updateMaxHeight(),this.value=this.marginTop}killAndHideAll(){this.listObjects instanceof Array&&this.listObjects.map(e=>{e!==void 0&&this.objects.killAndHide(e)})}setItemPosition(e,t){const s=e.height;e.setPosition(0,s/2+(s+this.padding)*t-this.height/2)}updateMaxHeight(){return this.maxHeight=Math.max(this.listConfigs.length*(this.objHeight+this.padding)-this.padding+this.marginBottom-this.height,0)}updateObject(e){this.objects.incY(e);const t=this.getStartObjectIndex(),s=this.getEndObjectIndex();t!=this.startObjectIndex&&(t>this.startObjectIndex?this.killObjectIndex(this.startObjectIndex,t-1):this.addObjectIndex(t,this.startObjectIndex-1),this.startObjectIndex=t),s!=this.endObjectIndex&&(s<this.endObjectIndex?this.killObjectIndex(s+1,this.endObjectIndex):this.addObjectIndex(this.endObjectIndex+1,s),this.endObjectIndex=s)}killObjectIndex(e,t){for(let s=e;s<=t;s++){const n=this.listObjects[s];n&&(this.objects.killAndHide(n),this.listObjects[s]=void 0)}}addObjectIndex(e,t){for(let s=e;s<=t;s++){const{padding:n,listConfigs:a}=this;if(s>=a.length)return;const r=this.objects.getFirstDead(!0),c=r.height,o=c/2+(c+n)*s+this.value-this.height/2;r.updateInfo(a[s]),r.setPosition(0,o),r.setActive(!0),r.setVisible(!0),this.addAt(r),this.listObjects[s]=r}}getStartObjectIndex(){const{objHeight:e,padding:t}=this;return Math.max(Math.floor((0-this.value)/(e+t)),0)}getEndObjectIndex(){const{objHeight:e,padding:t,listConfigs:s}=this,n=e+t;return Math.min(Math.floor((this.height-this.value)/n),s.length)}}const QI={targets:[],props:{alpha:{start:0,to:1,duration:500,ease:Phaser.Math.Easing.Cubic.Out},scale:{start:.8,to:1,duration:1e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45]},y:{start:0,to:0,duration:500,ease:Phaser.Math.Easing.Back.Out}},delay:0};class eb extends Ee{constructor(e){super(QI,e)}}const{KEY:Ts,FRAME:we}=D.DEFAULT;class tb extends Phaser.GameObjects.Container{button;avatar;rankIcon;rankText;username;score;scoreText;background;showPopUp;showItems;payload;constructor(e,t){super(e),this.createBackground(),this.updateSize(),this.createAvatar(),this.createRank(),this.createUsername(),this.createScore(),this.createButton(),t&&this.updateInfo(t),this.scene.add.existing(this)}updateInfo(e){this.payload={scoreRight:!0,isHighlight:!1,useChallenge:!1,...e},this.updateBackground(),this.updateAvatar(),this.updateRank(),this.updateUsername(),this.updateScore(),this.updatePosition()}updatePosition(){const e=this.payload.scoreRight,t=this.payload.useChallenge;this.button.setVisible(!!t),e?Phaser.Display.Align.To.RightCenter(this.score,this.avatar,120):Phaser.Display.Align.To.RightCenter(this.score,this.avatar,80)}createBackground(){this.background=this.scene.make.image({key:Ts,frame:we.LEADERBOARD_BG_LIGHT}),this.background.setWorldSize(264,56),this.add(this.background)}updateBackground(){const e=this.payload.isHighlight;let t="";e?t=we.LEADERBOARD_BG_LIGHT:t=we.LEADERBOARD_BG_DARK,this.background.setFrame(t),this.background.setWorldSize(264,56)}updateSize(){const{width:e,height:t}=this.background;this.setSize(e,t)}createAvatar(){this.avatar=new Ti(this.scene,{key:Ts,frame:we.AVATAR_FRAME_YELLOW_SMALL,background:we.AVATAR_BG_YELLOW_SMALL,width:47.5,height:49.5}),this.add(this.avatar),Phaser.Display.Align.In.LeftCenter(this.avatar,this,-10)}updateAvatar(){const{playerId:e}=this.payload;this.avatar.loadPhoto(e,"")}createRank(){this.createRankIcon(1),this.createRankText(1)}updateRank(){const e=this.payload.rank;this.updateRankIcon(e),this.updateRankText(e)}getRankIconFrame(e){let t=we.ICON_FLAG;switch(e){case 1:t=we.ICON_CUP_GOLD;break;case 2:t=we.ICON_CUP_SILVER;break;case 3:t=we.ICON_CUP_COPPER;break}return t}createRankIcon(e){const t=this.getRankIconFrame(e);this.rankIcon=this.scene.make.image({key:Ts,frame:t}),t!=we.ICON_FLAG?this.rankIcon.setWorldSize(46,30):this.rankIcon.setWorldSize(27,27),this.add(this.rankIcon);const s=e<=3?13:16;Phaser.Display.Align.In.Center(this.rankIcon,this.avatar,0,s)}updateRankIcon(e){const t=this.getRankIconFrame(e);this.rankIcon.setFrame(t),t!=we.ICON_FLAG?this.rankIcon.setWorldSize(46,30):this.rankIcon.setWorldSize(27,27)}createRankText(e){this.rankText=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(15),text:`${e}`,origin:{x:.5,y:.5}}),this.add(this.rankText),Phaser.Display.Align.In.Center(this.rankText,this.rankIcon,0,-2)}updateRankText(e){this.rankText.setText(`${e}`)}getShortName(e){return e.substring(0,14)}createUsername(){const e="FRIEND NAME";this.username=this.scene.make.text({text:this.getShortName(e),style:{fontFamily:k.FONT_FAMILY,fontSize:"15px",fontStyle:"bold"}}),this.username.setTint(10317116),this.username.setHighQuality(),Phaser.Display.Align.In.LeftCenter(this.username,this.avatar,-53),this.add(this.username)}updateUsername(){const e=this.payload.rank;this.username.setText(`RANK #${e}`)}createScore(){const e="132500";this.score=this.scene.add.container(),this.scoreText=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(18),text:e,origin:{x:.5,y:.5}}),this.scoreText.setTint(6565e3);const t=this.scene.make.image({key:Ts,frame:we.ICON_CUP_MINI});t.setWorldSize(17,18),this.score.add([this.scoreText,t]);let s=-20;Phaser.Display.Align.In.LeftCenter(this.scoreText,t,s),this.add(this.score),s=10,Phaser.Display.Align.In.Center(this.score,this,s)}updateScore(){const e=this.payload.score;this.scoreText.setText(e)}createButton(){this.button=new ee(this.scene,Ts,we.BUTTON_GREEN_MINOR_MINI,54,34.5),this.button.setName("ChallengeFriend");const e=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(18),text:this.scene.lang.Text.PLAY});Phaser.Display.Align.In.Center(e,this.button,0,-2),this.button.add(e),Phaser.Display.Align.In.RightCenter(this.button,this,-2),this.add(this.button),this.button.onClick=this.handleChallengeFriend}handleChallengeFriend=()=>{const{playerId:e}=this.payload;this.scene.storage.dispatch(_l(e))};runShowPopUpAnimation(e,t){this.scene.tweens.killTweensOf(this),this.showPopUp=new eb({targets:[this],delay:e,duration:t,props:{y:{start:this.y+70,to:this.y}}}),this.showPopUp.play()}runShowItemAnimation(e,t){const s=this.getAll();this.scene.tweens.killTweensOf(s),this.showItems=new yi({targets:s,duration:t,delay:this.scene.tweens.stagger(50,{start:e+50}),props:{scale:{duration:1e3,getStart:n=>n.scale*.8,getEnd:n=>n.scale,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45]}}}),this.showItems.play()}runShowUpAnimation(e=0,t=300){const s=e*100;this.runShowPopUpAnimation(s,t),this.runShowItemAnimation(s,t)}}class sb extends Phaser.GameObjects.Container{scene;currentPlayerId;scroller;constructor(e){super(e),this.scene=e;const{player:t}=this.scene;this.currentPlayerId=t.getPlayerId(),this.createReuseScroller(),this.scene.add.existing(this)}createReuseScroller(){this.scroller=new JI(this.scene,{classType:tb,listConfigs:[],width:310-30,height:360,padding:10,marginTop:10,marginBottom:10}),this.scene.renderer instanceof Phaser.Renderer.WebGL.WebGLRenderer&&this.scroller.createBound(D.DEFAULT.KEY,D.DEFAULT.FRAME.BLANK,40,16643027),this.scroller.createMask(),this.scroller.setPosition(0,0),this.add(this.scroller)}updateData(e){const t=Object.values(e)||[];if(t.length<1){this.scene.isSwitchable=!0,this.scene.board.showMessage(!0,this.scene.lang.Text.LB_IS_EMPTY);return}const s=t.sort((a,r)=>+r.score-+a.score),n=[];for(const a of s){const{playerId:r,photo:c,score:o,name:l,rank:h}=a;if(!r)continue;const d=this.currentPlayerId===r,u=this.scene.tabId===It,p=!1;//!isPlayer && this.scene.tabId === LEADERBOARD_TYPE_FRIEND
const m={playerId:r,photo:c,name:l,rank:h,score:o,scoreRight:u,useChallenge:p,isHighlight:d};n.push(m)}this.scroller.updateConfig(n),this.showLeaders()}removeLeaders(){this.scroller.updateConfig([])}getLeaders(){return this.scroller.getChildren()}showLeaders(){const e=this.getLeaders();if(e.length<1){this.scene.isSwitchable=!0,this.scene.board.showMessage(!0,this.scene.lang.Text.LB_IS_EMPTY);return}const t=Math.min(e.length,6),s=300;for(let a=0;a<t;a++){const r=e[a];r&&(r.setVisible(!0),r.runShowUpAnimation(a,s))}const n=s+t*100+50*5;this.scene.time.delayedCall(n,()=>{this.scene.isSwitchable=!0,this.scroller.setEnable(!0)})}}const{KEY:Dr,FRAME:Nt}=D.DEFAULT;class ib extends Phaser.GameObjects.Container{scene;tabWorld;tabFriends;constructor(e){super(e),this.scene=e,this.createTabFriends(),this.createTabWorld()}selectTabFriends(){this.tabFriends.button.setFrame(Nt.LEADERBOARD_TAB_ON),this.tabWorld.button.setFrame(Nt.LEADERBOARD_TAB_OFF)}selectTabWorld(){this.tabFriends.button.setFrame(Nt.LEADERBOARD_TAB_OFF),this.tabWorld.button.setFrame(Nt.LEADERBOARD_TAB_ON)}createTabFriends(){this.tabFriends=new ee(this.scene,Dr,Nt.LEADERBOARD_TAB_OFF),this.tabFriends.button.setSize(85,33).setDisplaySize(85,33),this.tabFriends.setName("FriendsTab");const e=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:9,text:this.scene.lang.Text.FRIENDS,origin:{x:.5,y:.55}});this.tabFriends.add(e),Phaser.Display.Align.In.Center(this.tabFriends,this,-55),this.add(this.tabFriends)}createTabWorld(){this.tabWorld=new ee(this.scene,Dr,Nt.LEADERBOARD_TAB_OFF),this.tabWorld.button.setSize(85,33).setDisplaySize(85,33),this.tabWorld.setName("WorldTab");const e=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:9,text:this.scene.lang.Text.WORLD,origin:{x:.5,y:.55}});this.tabWorld.add(e),Phaser.Display.Align.In.Center(this.tabWorld,this,55),this.add(this.tabWorld)}}const{KEY:nb,FRAME:ab}=D.DEFAULT;class rb extends Phaser.GameObjects.Container{scene;background;tabs;leaders;loading;message;messageAnimation;constructor(e){super(e),this.scene=e,this.setSize(310,430),this.createBackground(),this.createLoading(),this.createMessage(),this.createContents(),this.createAnimation(),this.scene.add.existing(this)}showLoading(e){this.loading.setVisible(e),this.showMessage(!1)}showMessage(e,t){this.message.setVisible(e),t&&(this.message.setText(t),this.messageAnimation.play())}createBackground(){this.background=new Je(this.scene,0,0,310,430),this.add(this.background)}createLoading(){this.loading=new Ai(this.scene),this.loading.setTint(12237498),this.loading.setWorldSize(113,113),this.add(this.loading),Phaser.Display.Align.In.Center(this.loading,this.background)}createMessage(){this.message=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(18),origin:{x:.5,y:.5}}),this.message.setTint(10317116),this.add(this.message),Phaser.Display.Align.In.Center(this.message,this.background)}createContents(){this.createLeaders(),this.createTitle(),this.createTabs()}createLeaders(){this.leaders=new sb(this.scene),this.add(this.leaders),Phaser.Display.Align.In.Center(this.leaders,this.background,0,0)}createTitle(){const e=this.scene.add.container(),t=this.scene.make.image({key:nb,frame:ab.RIBBON_SHORT});t.setWorldSize(271,81);const s=this.scene.lang.getCurrentLanguage(),n=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(s==="id"?25:30),text:this.scene.lang.Text.LEADERBOARDS});Phaser.Display.Align.In.Center(n,t,0,-10),e.add([t,n]),Phaser.Display.Align.In.TopCenter(e,this.background,0,5),this.add(e)}createTabs(){this.tabs=new ib(this.scene),this.add(this.tabs),Phaser.Display.Align.In.TopCenter(this.tabs,this.background,0,-55),this.tabs.setVisible(!1)}createAnimation(){this.messageAnimation=new Wn({targets:[this.message],duration:60,repeat:2})}}const{LeadersBoard:Ue}=GameCore.Configs;class ob extends ns{board;footerBar;tabId;offset;isRequesting;isSwitchable;run=()=>{this.isRequesting=!1;const e=[{selector:$I,callback:t=>{if(this.isRequesting=t,this.board.showLoading(t),t===!1){const s=this.game.storage.getState(),n=zI(s);this.board.leaders.updateData(n)}}}];this.handleStateChange(e),this.selectWorldTab()};preload(){this.events.on("wake",this.run),this.events.on("create",this.run)}create(){super.create(),this.gameZone.setPosition(0,0),this.createBackground(fe.BACKGROUND.KEY,"0"),this.scene.bringToTop(),this.createBoard(),this.createFooterBar()}selectFriendTab(){this.tabId=Yt,this.offset=0,this.board.showLoading(!0),this.board.leaders.removeLeaders(),this.board.tabs.selectTabFriends(),this.storage.dispatch(Zs(Ue.LeaderboardId,Yt,Ue.Limit,this.offset))}selectWorldTab(){this.tabId=It,this.offset=0,this.board.showLoading(!0),this.board.leaders.removeLeaders(),this.board.tabs.selectTabWorld(),this.storage.dispatch(Zs(Ue.LeaderboardId,It,Ue.Limit,this.offset))}loadMoreTabFriend(){this.isRequesting||(this.offset+=Ue.Limit,this.storage.dispatch(Zs(Ue.LeaderboardId,Yt,Ue.Limit,this.offset)))}loadMoreTabWorld(){this.isRequesting||(this.offset+=Ue.Limit,this.storage.dispatch(Zs(Ue.LeaderboardId,It,Ue.Limit,this.offset)))}createBoard(){this.board=new rb(this),Phaser.Display.Align.In.Center(this.board,this.gameZone,0,-40)}createFooterBar(){this.footerBar=new qI(this),Phaser.Display.Align.In.BottomCenter(this.footerBar,this.gameZone,0,-120),this.footerBar.homeButton.onClick=this.handleHomeClick}handleHomeClick=()=>{this.scene.switch($.DASHBOARD_SCENE)}}class cb extends Error{constructor(e,t){super(e,t),this.name="LoadResourceFail",this.message=e||"Load resource fail",this.payload=t}}let na=class{game;id;taskData;requireTypes;constructor(e,t){this.game=e,this.id=t,this.init()}init(){const e=this.game.storage.getState(),t=Pl(e)||[];if(t?.length<1)return;const s=t?.find(n=>n.id===this.id);s&&(this.taskData=s,this.requireTypes=Object.keys(this.taskData.require),this.initEvents())}getDataByType(e){const t=this.game.storage.getState(),s=Dl(t),n={value:0,target:0};if(!s||!GameCore.Utils.Object.hasOwn(s,this.taskData.id))return n;const a=s[this.taskData.id];if(GameCore.Utils.Valid.isObject(a)&&GameCore.Utils.Object.hasOwn(a,e)){const r=a[e];typeof r=="number"&&(n.value=r)}return n.target=this.taskData.require[e]||0,n}getCorrectValue(e,t){const{value:s,target:n}=this.getDataByType(e);let a=t;return s+t>n&&(a=n-s),Math.round(a)}isPassRequiredTarget(e){const{value:t,target:s}=this.getDataByType(e);return t>=s}isTaskFinished(e){const{value:t,target:s}=this.getDataByType(e);return t>=s}process=e=>{let{type:t,value:s}=e;if(s<1||this.requireTypes.indexOf(t)===-1||this.isPassRequiredTarget(t)||!this.processMore(e))return;({type:t,value:s}=e);const a=this.getCorrectValue(t,s);this.game.storage.dispatch(nI(this.id,t,a)),this.isTaskFinished(t)&&this.game.storage.dispatch(rI(this.id))}};const{ID:lb,EVENTS:Mr}=ue.COLLECT_DIAMONDS;class hb extends na{constructor(e){super(e,lb)}initEvents(){X.off(Mr.COLLECT_DIAMONDS,this.process),X.on(Mr.COLLECT_DIAMONDS,this.process)}processMore(){return!0}}const{ID:ub,EVENTS:Lr}=ue.PASS_LEVELS;class db extends na{constructor(e){super(e,ub)}initEvents(){X.off(Lr.PASS_LEVEL,this.process),X.on(Lr.PASS_LEVEL,this.process)}processMore(){return!0}}const{ID:pb,EVENTS:xr}=ue.REACH_SCORE;class mb extends na{totalScore;lastUpdate;constructor(e){super(e,pb),this.totalScore=0,this.lastUpdate=Date.now()}initEvents(){X.off(xr.ADD_SCORE,this.process),X.on(xr.ADD_SCORE,this.process)}processMore(e){const{value:t}=e,s=Date.now();return s-this.lastUpdate<3e3?(this.totalScore+=t,!1):(e.value+=this.totalScore,this.totalScore=0,this.lastUpdate=s,!0)}}class gb{game;eventsListener;constructor(e){this.game=e,this.init()}getEventListener(e){return this.eventsListener[e]}init=async()=>{this.eventsListener={},await this.initData(),this.initEvents()};initData=async()=>{await this.game.storage.dispatch(sI())};initEvents(){this.eventsListener[ue.PASS_LEVELS.ID]=new db(this.game),this.eventsListener[ue.REACH_SCORE.ID]=new mb(this.game),this.eventsListener[ue.COLLECT_DIAMONDS.ID]=new hb(this.game)}}const fb=[{name:"collect-red-gems",id:"collect-gems",require:{red:5},reward:50},{name:"collect-blue-gems",id:"collect-gems",require:{blue:5},reward:50},{name:"collect-pink-gems",id:"collect-gems",require:{pink:5},reward:50},{name:"collect-green-gems",id:"collect-gems",require:{green:5},reward:50},{name:"collect-yellow-gems",id:"collect-gems",require:{yellow:5},reward:50},{name:"collect-red-blue-gems",id:"collect-gems",require:{red:5,blue:5},reward:120},{name:"collect-red-pink-gems",id:"collect-gems",require:{red:5,pink:5},reward:120},{name:"collect-red-green-gems",id:"collect-gems",require:{red:5,green:5},reward:120},{name:"collect-red-yellow-gems",id:"collect-gems",require:{red:5,yellow:5},reward:120},{name:"collect-blue-pink-gems",id:"collect-gems",require:{blue:5,pink:5},reward:120},{name:"collect-blue-green-gems",id:"collect-gems",require:{blue:5,green:5},reward:120},{name:"collect-blue-yellow-gems",id:"collect-gems",require:{blue:5,yellow:5},reward:120},{name:"collect-pink-green-gems",id:"collect-gems",require:{pink:5,green:5},reward:120},{name:"collect-pink-yellow-gems",id:"collect-gems",require:{pink:5,yellow:5},reward:120},{name:"collect-green-yellow-gems",id:"collect-gems",require:{green:5,yellow:5},reward:120},{name:"collect-red-blue-pink-gems",id:"collect-gems",require:{red:5,blue:5,pink:5},reward:210},{name:"collect-red-blue-green-gems",id:"collect-gems",require:{red:5,blue:5,green:5},reward:210},{name:"collect-red-blue-yellow-gems",id:"collect-gems",require:{red:5,blue:5,yellow:5},reward:210},{name:"collect-red-pink-green-gems",id:"collect-gems",require:{red:5,pink:5,green:5},reward:210},{name:"collect-red-pink-yellow-gems",id:"collect-gems",require:{red:5,pink:5,yellow:5},reward:210},{name:"collect-red-green-yellow-gems",id:"collect-gems",require:{red:5,green:5,yellow:5},reward:210},{name:"collect-blue-pink-green-gems",id:"collect-gems",require:{blue:5,pink:5,green:5},reward:210},{name:"collect-blue-pink-yellow-gems",id:"collect-gems",require:{blue:5,pink:5,yellow:5},reward:210},{name:"collect-blue-green-yellow-gems",id:"collect-gems",require:{blue:5,green:5,yellow:5},reward:210},{name:"collect-pink-green-yellow-gems",id:"collect-gems",require:{pink:5,green:5,yellow:5},reward:210}],Eb=async()=>fb,yb=()=>async(i,e)=>{const t=e();if(xy(t))return;i({type:yc,payload:{}});const n=await Eb();i(Sb(n))},Sb=i=>({type:Sc,payload:{missions:i}});class aa{game;id;name;reward;constructor(e,t,s){this.id=t,this.name=s,this.game=e}start(){const e=this.game.storage.getState(),t=ci(e);t&&t.name===this.name&&(this.reward=t.reward,this.initEvents())}getMissionData(){const e=this.game.storage.getState(),t=ci(e);return!t||t.name!==this.name?null:t}getDataByType(e){const t=this.getMissionData();if(!t)return null;const s=t.require[e];return{value:t.process[e],target:s}}isTypeRequired(e){const t=this.getDataByType(e);return t?t.target>0:!1}isMissionComplete(){const e=this.getMissionData();if(!e)return!0;const{require:t,process:s}=e;let n=!0;return Object.keys(t).forEach(a=>{if(!n)return;const r=t[a];s[a]<r&&(n=!1)}),n}process=e=>{const{id:t,type:s,value:n}=e;n<1||this.id!==t||!this.isTypeRequired(s)||!this.processMore(e)||(this.game.storage.dispatch(Ry(this.name,s,n)),this.isMissionComplete()&&(X.emit(he.EVENTS.MISSION_COMPLETED,{name:this.name,reward:this.reward}),this.game.storage.dispatch(Py(this.name))))}}const{EVENTS:Nr,TYPES:Ab}=he;class Tb extends aa{constructor(e,t){super(e,Ab.COLLECT_GEMS,t)}initEvents(){X.off(Nr.MISSION_UPDATE,this.process),X.on(Nr.MISSION_UPDATE,this.process)}processMore(){return!0}}const{EVENTS:kr,TYPES:Ib}=he;class bb extends aa{constructor(e,t){super(e,Ib.COMBO,t)}initEvents(){X.off(kr.MISSION_UPDATE,this.process),X.on(kr.MISSION_UPDATE,this.process)}processMore(e){const t=this.getMissionData();if(!t)return!1;const{type:s,value:n}=e;return n>=t.require[s]}}const{EVENTS:Gr,TYPES:wb}=he;class Cb extends aa{constructor(e,t){super(e,wb.USE_ITEM,t)}initEvents(){X.off(Gr.MISSION_UPDATE,this.process),X.on(Gr.MISSION_UPDATE,this.process)}processMore(e){return console.log("UseItem",{payload:e}),!0}}class vb{game;listener;constructor(e){this.game=e,this.init()}init=async()=>{await this.initData(),this.initListeners(),this.initEvents()};initData=async()=>{await this.game.storage.dispatch(yb())};initListeners(){this.listener={};const e=this.game.storage.getState(),t=hl(e);t&&Object.keys(t).forEach(s=>{const{id:n}=t[s];switch(n){case he.TYPES.COLLECT_GEMS:this.listener[s]=new Tb(this.game,s);break;case he.TYPES.COMBO:this.listener[s]=new bb(this.game,s);break;case he.TYPES.USE_ITEM:this.listener[s]=new Cb(this.game,s);break}})}initEvents(){X.off(he.EVENTS.MISSION_START,this.startListener),X.on(he.EVENTS.MISSION_START,this.startListener)}startListener=e=>{this.listener[e]&&this.listener[e].start()}}const{AppId:nw,OtherHost:aw,LeadersBoard:rw}=GameCore.Configs,{UseLeaderboard:ow}=GameCore.Configs.Tournament,_b=i=>({type:mc,payload:{tournamentId:i}}),Ob=()=>(i,e)=>{const{player:t,analytics:s,globalScene:n}=window.game;try{const a=e(),r=Qt(a),c=Mc(a),o=t.getPlayer(),{entryPointData:l}=r,{type:h}=l||{};if(o.isUserNew&&s.event(z.NEW_USER),c===Xe){i(Rb());return}if(c===Ge){if(h===Hn){i(Pb());return}if(h===Jt){i(Db());return}}if(c===$e){i(Mb());return}if(o.isUserNew){i(Lb());return}n.events.emit(ke.SWITCH,$.DASHBOARD_SCENE)}catch(a){n.events.emit(ke.SWITCH,$.DASHBOARD_SCENE),console.warn(a)}},Ul=i=>{try{const e=Qt(i),{player:t}=window.game,{entryPointData:s}=e,{playerId:n,playerName:a,playerPhoto:r}=s||{};return t.getPlayer().playerId===n?Re:new Ht(n,a,r).toObject()}catch(e){return console.warn(e),Re}},Rb=()=>i=>{try{const{facebook:e}=window.game;e.getTournamentAsync().then(t=>{const s=t.getID().toString();i(_b(s))}).catch(t=>{console.warn(t)}),i(IT())}catch(e){console.warn(e)}},Pb=()=>(i,e)=>{try{const t=e(),s=Qt(t),{player:n}=window.game,a=n.getPlayer(),{contextId:r,entryPointData:c}=s,{playerId:o}=c||{},l=a.playerId===o,h=Ul(t);l||n.updateConnectedPlayers([h]);const{playerId:d}=h;i(Ol(r,d,!0))}catch(t){throw new Error("processInviteMode: "+t)}},Db=()=>(i,e)=>{try{const t=e(),s=Qt(t),{player:n}=window.game,a=n.getPlayer(),{entryPointData:r}=s,{matchId:c,opponentId:o,playerId:l}=r||{},h=a.playerId===l;i(h?pr(c,o):pr(c,l))}catch(t){throw new Error("processChallengeFriendMode: "+t)}},Mb=()=>(i,e)=>{try{const t=e(),s=Qt(t),{entryPointData:n}=s,{playerId:a,playerScore:r}=n||{};i(Jn(a,{score:r,level:0}));const l={...Ul(t),score:r};i(bT(l))}catch(t){throw new Error("processMatchingGroupMode: "+t)}},Lb=()=>i=>{try{i(vl())}catch(e){throw new Error("processNewUserMode: "+e)}},Ke={BACKGROUND:{KEY:"background",FILE:"./assets/music/bg_music.ogg"},EFFECTS:{KEY:"effects",FILE:"./assets/sounds/effects.ogg",JSON:"./assets/sounds/effects.json"}},{Rollbar:xb}=GameCore.Configs;class Nb extends Phaser.Scene{loadingPercent=0;preload(){window.getLoadingPerc=()=>this.loadingPercent,this.facebook.progressLoading.loadingProgressFbLoadScene(),this.analytics.event(z.SCREEN_OPEN,{screen_name:"LoadScene"});const e=s=>{this.loadingPercent=Math.max(this.loadingPercent,s*100),s===1&&this.load.off("progress",e),this.facebook.progressLoading.onProgress(s)};this.load.on("progress",e),this.load.on(Phaser.Loader.Events.FILE_LOAD_ERROR,s=>{const n=new cb("Load resources at LoadScene failed.");this.rollbar.sendException(n,{file:s?.url})});const t=this.lang.getCurrentLanguage();this.load.bitmapFont(k.PRIMARY.KEY,k.PRIMARY.TEXTURE[t],k.PRIMARY.DATA[t]),this.load.image(fe.AVATAR.KEY,fe.AVATAR.FILE),this.load.image(fe.BACKGROUND.KEY,fe.BACKGROUND.FILE),this.load.atlas({key:D.DEFAULT.KEY,textureURL:D.DEFAULT.TEXTURE,atlasURL:D.DEFAULT.JSON}),this.load.atlas({key:D.GAMEPLAY.KEY,textureURL:D.GAMEPLAY.TEXTURE,atlasURL:D.GAMEPLAY.JSON}),this.load.multiatlas({key:D.EFFECTS.KEY,path:D.EFFECTS.PATH,atlasURL:D.EFFECTS.JSON}),this.load.atlas({key:D.TUTORIAL.KEY,textureURL:D.TUTORIAL.TEXTURE,atlasURL:D.TUTORIAL.JSON}),this.player.updateData().then(this.handleUpdateNotificationData).catch(s=>{console.warn("LoadScene: player.updateData() failed",s)})}create(){this.analytics.event(z.LOAD_COMPLETE),this.facebook.on("startgame",this.handleFBInstantGameStarted),this.facebook.gameStarted(),this.initModules(),this.setupGlobalScene(),this.lazyLoadResource(),this.logGlanceNewUserToRollbar(),this.startGame()}handleFBInstantGameStarted=()=>{window.__fbGameReady=!0,this.player.requestConnectedPlayers()};handleUpdateNotificationData=()=>{const e=this.player.getPlayer(),{playerId:t,name:s,locale:n,data:a}=e,r=this.player.getCustomData("levelProgress");this.notification.updateData({playerId:t,name:s,photo:"",locale:n,friendIds:this.player.getConnectedPlayerIds(10,0),gameSettings:this.player.getPlayerSettings(),gameProgress:{currentLevel:r},gameStatistics:{highScore:a.score}}),this.notification.sendRequest()};setupGlobalScene(){const e=this.scene.get($.GLOBAL_SCENE);e instanceof ia&&e.setup()}startGame=()=>{this.showStickyBannerAd(),this.preloadAds(),this.analytics.event(z.APP_READY),this.storage.dispatch(Gl($.LOAD_SCENE)),this.storage.dispatch(Ob())};showStickyBannerAd=()=>{this.ads.showBannerAdAsync().catch(e=>{console.warn(e)})};preloadAds=()=>{this.ads.preloadRewardedVideoAsync().catch(e=>{}),this.ads.preloadInterstitialAdAsync().catch(e=>{})};initModules(){new vb(this.game),new gb(this.game)}lazyLoadResource(){setTimeout(()=>{this.scene.wake(),this.loadSounds(),this.load.once(Phaser.Loader.Events.COMPLETE,()=>{this.scene.sleep()})},1500)}loadSounds(){const{FILE_KEY_COMPLETE:e}=Phaser.Loader.Events;this.load.once(`${e}audio-${Ke.EFFECTS.KEY}`,this.handleLoadSoundCompleted),this.load.once(`${e}audio-${Ke.BACKGROUND.KEY}`,this.handleLoadMusicCompleted),this.load.audio(Ke.BACKGROUND.KEY,Ke.BACKGROUND.FILE),this.load.audioSprite(Ke.EFFECTS.KEY,Ke.EFFECTS.JSON,Ke.EFFECTS.FILE),this.load.start()}handleLoadSoundCompleted=()=>{this.audio.initSound(Ke.EFFECTS.KEY)};handleLoadMusicCompleted=()=>{this.audio.initMusic(Ke.BACKGROUND.KEY),this.audio.playMusic()};logGlanceNewUserToRollbar(){if(!xb.Enable)return;this.player.getPlayer().isUserNew&&"__GLANCE_ENV"in window&&this.rollbar.sendException(new Error("Glance new user"))}}class Br extends ee{payload;constructor(e,t,s,n){super(e,t.key,t.button,s,n),this.payload=t,this.createIcon(),this.createText()}createIcon(){const e=this.scene.add.image(0,0,this.payload.key,this.payload.icon);e.setWorldSize(43,43),this.add(e),Phaser.Display.Align.In.LeftCenter(e,this,-25)}createText(){const{text:e}=this.payload,t=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(24),text:e,origin:{x:.2,y:.5}});this.add(t)}}const{KEY:Ur,FRAME:ft}=D.DEFAULT;class Fr extends Phaser.GameObjects.Container{scene;avatar;crown;playerName;playerScore;constructor(e){super(e),this.scene=e,this.createAvatar(),this.updateSize(),this.createWinCrown(),this.createPlayerName(),this.createPlayerScore(),this.scene.add.existing(this)}showCrown(e){this.crown.setVisible(e),e?(this.avatar.setFrame(ft.AVATAR_FRAME_YELLOW_BIG),this.avatar.setBackground(ft.AVATAR_BG_YELLOW_BIG)):(this.avatar.setFrame(ft.AVATAR_FRAME_BLUE_BIG),this.avatar.setBackground(ft.AVATAR_BG_BLUE_BIG))}setPlayerName(e){this.playerName.setText(e)}setPlayerScore(e){this.playerScore.setText(`${e}`)}loadPhoto(e,t){this.avatar.loadPhoto(e,t,60)}updateSize(){const{width:e,height:t}=this.avatar;this.setSize(e,t)}createAvatar(){this.avatar=new Ti(this.scene,{key:Ur,frame:ft.AVATAR_FRAME_BLUE_BIG,background:ft.AVATAR_BG_BLUE_BIG,width:89,height:89,radius:60}),this.add(this.avatar)}createWinCrown(){this.crown=this.scene.make.image({key:Ur,frame:ft.ICON_CROWN}),this.crown.setWorldSize(52,36),Phaser.Display.Align.In.TopCenter(this.crown,this.avatar,0,25),this.add(this.crown)}createPlayerName(){this.playerName=this.scene.make.text({style:{fontFamily:k.FONT_FAMILY,fontSize:`${this.scene.fontSize(42)}px`,fontStyle:"bold"},origin:{x:.5,y:.5}}),this.playerName.setTint(11632207),this.playerName.setHighQuality(),Phaser.Display.Align.In.BottomCenter(this.playerName,this.avatar,0,25),this.add(this.playerName)}createPlayerScore(){this.playerScore=this.scene.make.bitmapText({size:this.scene.fontSize(30),font:k.PRIMARY.KEY,origin:{x:.5,y:.5}}),this.playerScore.setTint(6762627),Phaser.Display.Align.In.BottomCenter(this.playerScore,this.playerName,0,25),this.add(this.playerScore)}}const{KEY:Js,FRAME:kt}=D.DEFAULT;class kb extends Phaser.GameObjects.Container{scene;board;titleText;playerScore;opponentScore;buttonClose;buttonRestart;buttonShare;constructor(e){super(e),this.scene=e,this.createBoard(),this.createTitle(),this.createVSText(),this.createPlayers(),this.createRestartButton(),this.createShareButton(),this.scene.add.existing(this)}createBoard(){this.board=new Je(this.scene,0,0,600,340),this.board.setDepth(Y.BACKGROUND),this.add(this.board),Phaser.Display.Align.In.Center(this.board,this)}createTitle(){const e=this.scene.add.container(),t=this.scene.make.image({key:Js,frame:kt.RIBBON_FULL});t.setWorldSize(340,75),this.titleText=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(32),origin:{x:.5,y:.5}}),Phaser.Display.Align.In.Center(this.titleText,t,0,-10),this.buttonClose=new ee(this.scene,Js,kt.BUTTON_CLOSE,41.8,41.8),this.buttonClose.setName("Close"),Phaser.Display.Align.In.RightCenter(this.buttonClose,t,0,-3),e.setDepth(Y.TILE),e.add([t,this.titleText,this.buttonClose]),this.add(e),Phaser.Display.Align.In.Center(e,this.board,0,-170)}createVSText(){const e=this.scene.make.bitmapText({font:k.PRIMARY.KEY,size:this.scene.fontSize(70),text:"VS",origin:{x:.5,y:.5}});e.setTint(11632207),e.setDepth(Y.TEXT),this.add(e),Phaser.Display.Align.In.Center(e,this.board,0,-45)}createPlayers(){this.playerScore=new Fr(this.scene),this.playerScore.setDepth(Y.ITEM),this.add(this.playerScore),Phaser.Display.Align.In.Center(this.playerScore,this.board,-100,-50),this.opponentScore=new Fr(this.scene),this.opponentScore.setDepth(Y.ITEM),this.add(this.opponentScore),Phaser.Display.Align.In.Center(this.opponentScore,this.board,100,-50)}createRestartButton(){this.buttonRestart=new Br(this.scene,{key:Js,button:kt.BUTTON_GREEN,icon:kt.ICON_RESUME,text:"Restart"},170,72),this.buttonRestart.setName("Restart"),this.buttonRestart.setDepth(Y.BUTTON),this.add(this.buttonRestart),Phaser.Display.Align.In.Center(this.buttonRestart,this.opponentScore,0,155)}createShareButton(){this.buttonShare=new Br(this.scene,{key:Js,button:kt.BUTTON_BLUE,icon:kt.ICON_FLAT_SHARE,text:this.scene.lang.Text.SHARE},153,72),this.buttonShare.setName("Restart"),this.buttonShare.setDepth(Y.BUTTON),this.add(this.buttonShare),Phaser.Display.Align.In.Center(this.buttonShare,this.playerScore,0,155)}}class Gb extends ns{main;run=()=>{this.getResultInfo()};preload(){this.events.on("wake",this.run),this.events.on("create",this.run)}create(){super.create(),this.createMask(.8),this.createMain(),this.createInput()}getResultInfo(){const e=this.storage.getState(),t=as(e),s=vt(e),{photo:n,name:a,playerId:r}=this.player.getPlayer(),{playerId:c,name:o,photo:l}=_t(e),{score:h=0}=t[r]||{},{score:d=0}=t[c]||{};let u=$n(e,{playerId:r}),p=al(e,{opponentId:c});s===$e&&(u=!0,p=!0);const m=u&&p;this.main.playerScore.loadPhoto(r,n),this.main.opponentScore.loadPhoto(c,l),this.main.playerScore.setPlayerName(a),this.main.opponentScore.setPlayerName(o),this.main.playerScore.setPlayerScore(h),this.main.opponentScore.setPlayerScore(d),this.main.playerScore.showCrown(m&&h>d),this.main.opponentScore.showCrown(m&&d>h),!u||!p?this.main.titleText.setText(this.lang.Text.WAITING_OPPONENT):h===d?this.main.titleText.setText(this.lang.Text.DRAW):h>d?this.main.titleText.setText(this.lang.Text.YOU_WIN):h<d&&this.main.titleText.setText(this.lang.Text.YOU_LOSE),!u||!p||h===d||(h>d?this.audio.playSound(K.YOU_WIN):h<d&&this.audio.playSound(K.YOU_LOSE))}createMain(){this.main=new kb(this),Phaser.Display.Align.In.Center(this.main,this.gameZone,0,13)}createInput(){this.main.buttonClose.onClick=this.handleClose,this.main.buttonRestart.onClick=this.handleRestartMatch,this.main.buttonShare.onClick=this.handleShareScore}handleClose=()=>{this.scene.sleep($.RESULT_MATCH_SCENE),this.scene.run($.GAME_OVER_SCENE)};handleShareScore=()=>{this.storage.dispatch(hT())};handleRestartMatch=()=>{this.storage.dispatch(ta()),this.scene.sleep($.RESULT_MATCH_SCENE),this.scene.sleep($.GAME_OVER_SCENE)}}const{Valid:Yr}=GameCore.Utils;class Bb{currencies;constructor(e){this.initDefaultValues(),Yr.isObject(e)&&Object.keys(e).forEach(t=>{Object.hasOwn(e,t)&&Yr.isNumber(e[t])&&(this.currencies[t]=e[t])})}initDefaultValues(){this.currencies={}}toObject(){return{...this.currencies}}}const{Object:Et,Valid:nt}=GameCore.Utils;class Ub{currentLevel;itemsCollected;levelsCompleted;constructor(e){this.initDefaultValues(),nt.isObject(e)&&(Et.hasOwn(e,"currentLevel")&&nt.isNumber(e.currentLevel)&&(this.currentLevel=e.currentLevel),Et.hasOwn(e,"itemsCollected")&&Array.isArray(e.itemsCollected)&&(this.itemsCollected=e.itemsCollected.filter(t=>!(!nt.isObject(t)||!Et.hasOwn(t,"itemId")||!nt.isString(t.itemId)||!Et.hasOwn(t,"quantity")||!nt.isNumber(t.quantity)))),Et.hasOwn(e,"levelsCompleted")&&Array.isArray(e.levelsCompleted)&&(this.levelsCompleted=e.levelsCompleted.filter(t=>!(!nt.isObject(t)||!Et.hasOwn(t,"score")||!nt.isNumber(t.score)||!Et.hasOwn(t,"levelId")||!nt.isString(t.levelId)))))}initDefaultValues(){this.currentLevel=0,this.levelsCompleted=[],this.itemsCollected=[]}toObject(){return{currentLevel:this.currentLevel,itemsCollected:this.itemsCollected,levelsCompleted:this.levelsCompleted}}}const{Object:Qs,Valid:Is}=GameCore.Utils;class Fb{highScore;timePlayed;totalGamesWon;totalGamesLose;constructor(e){this.initDefaultValues(),Is.isObject(e)&&(Qs.hasOwn(e,"highScore")&&Is.isNumber(e.highScore)&&(this.highScore=e.highScore),Qs.hasOwn(e,"timePlayed")&&Is.isNumber(e.timePlayed)&&(this.timePlayed=e.timePlayed),Qs.hasOwn(e,"totalGamesWon")&&Is.isNumber(e.totalGamesWon)&&(this.totalGamesWon=e.totalGamesWon),Qs.hasOwn(e,"totalGamesLose")&&Is.isNumber(e.totalGamesLose)&&(this.totalGamesLose=e.totalGamesLose))}initDefaultValues(){this.highScore=0,this.timePlayed=0,this.totalGamesWon=0,this.totalGamesLose=0}toObject(){return{highScore:this.highScore,timePlayed:this.timePlayed,totalGamesWon:this.totalGamesWon,totalGamesLose:this.totalGamesLose}}}const{settings:Yb}=Rn,{Object:Oe,Valid:at}=GameCore.Utils;class Hb{gpId;appId;glanceId;playerId;name;photo;locale;friendIds;gameProgress;gameSettings;gameStatistics;currencyBalance;constructor(e){this.initDefaultValues(),at.isObject(e)&&(Oe.hasOwn(e,"gpId")&&at.isString(e.gpId)&&(this.gpId=e.gpId),Oe.hasOwn(e,"appId")&&at.isString(e.appId)&&(this.appId=e.appId),Oe.hasOwn(e,"glanceId")&&at.isString(e.glanceId)&&(this.glanceId=e.glanceId),Oe.hasOwn(e,"playerId")&&at.isString(e.playerId)&&(this.playerId=e.playerId),Oe.hasOwn(e,"name")&&at.isString(e.name)&&(this.name=e.name),Oe.hasOwn(e,"photo")&&at.isString(e.photo)&&(this.photo=e.photo),Oe.hasOwn(e,"locale")&&at.isString(e.locale)&&(this.locale=e.locale),Oe.hasOwn(e,"friendIds")&&Array.isArray(e.friendIds)&&(this.friendIds=e.friendIds),Oe.hasOwn(e,"gameProgress")&&(this.gameProgress=new Ub(e.gameProgress).toObject()),Oe.hasOwn(e,"gameStatistics")&&(this.gameStatistics=new Fb(e.gameStatistics).toObject()),Oe.hasOwn(e,"currencyBalance")&&(this.currencyBalance=new Bb(e.currencyBalance).toObject()),Oe.hasOwn(e,"gameSettings")&&(this.gameSettings=new Ao(e.gameSettings).toObject()))}initDefaultValues(){this.gpId="",this.appId="",this.glanceId="",this.playerId="",this.name="",this.photo="",this.locale="en_US",this.friendIds=[],this.gameProgress={currentLevel:0,itemsCollected:[],levelsCompleted:[]},this.gameSettings={...Yb},this.gameStatistics={highScore:0,timePlayed:0,totalGamesWon:0,totalGamesLose:0},this.currencyBalance={}}toObject(){return{gpId:this.gpId,appId:this.appId,glanceId:this.glanceId,playerId:this.playerId,name:this.name,photo:this.photo,locale:this.locale,friendIds:this.friendIds,gameProgress:this.gameProgress,gameSettings:this.gameSettings,gameStatistics:this.gameStatistics,currencyBalance:this.currencyBalance}}}class Vb extends Phaser.Plugins.BasePlugin{data;endpoint;enabled;async setup(e,t){this.enabled=!0,this.endpoint=e,console.log("NotificationPlugin: configure",e,t),this.updateData(t)}updateData=async e=>{if(!this.enabled)return;const t=Ce(this.data,e);this.data=new Hb(t).toObject(),console.log("NotificationPlugin: updatePayload",this.data)};sendRequest=async()=>{try{if(!this.enabled)return;const{playerId:e}=this.data,t={...this.data};console.log("NotificationPlugin: sendRequest",t);const n=(await Xt(`players/${e}`,t,{},this.endpoint,10))?.data||{};this.updateData(n)}catch(e){console.warn("NotificationPlugin: sendRequest",e)}}}class Hr extends GameCore.Ads.AdInstance{instance;placementId;constructor(e,t){super(e),this.instance=null,this.placementId=t}static setGame(e){self.game=e}async loadAsync(){if(console.log("loadAsync",this.type,this.status),this.status===GameCore.Ads.Status.IDLE)try{if(this.status=GameCore.Ads.Status.LOADING,this.instance=await this.createInstanceByType(this.type),this.instance===null)throw new GameCore.Ads.AdError("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");await this.instance.loadAsync(),this.status=GameCore.Ads.Status.FILLED}catch(e){throw this.status=GameCore.Ads.Status.IDLE,this.instance=null,e}}async showAsync(){const e=this.getSceneName();try{if(console.log("showAsync",this.type,this.status),this.status===GameCore.Ads.Status.LOADING)throw new GameCore.Ads.AdError("AD_ARE_LOADING","Ads are loading.");if(this.status!==GameCore.Ads.Status.FILLED)throw new GameCore.Ads.AdError("AD_NOT_FILLED","Ads no fill.");if(this.status=GameCore.Ads.Status.SHOWING,this.instance===null)throw new GameCore.Ads.AdError("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");await this.instance.showAsync(),this.type===GameCore.Ads.Types.INTERSTITIAL&&self.game.analytics.showInterstitialAd(e),this.type===GameCore.Ads.Types.REWARDED&&self.game.analytics.showRewardedVideoAd(e),this.status=GameCore.Ads.Status.IDLE,this.instance=null}catch(t){if(console.warn("showAsync error",t),this.status=GameCore.Ads.Status.IDLE,this.instance=null,t instanceof Object&&GameCore.Utils.Object.hasOwn(t,"code")){if(t.code==="AD_ARE_LOADING"&&this.type===GameCore.Ads.Types.REWARDED){self.game.analytics.showAdFail(this.type,e,t);return}if(t.code==="AD_NOT_FILLED"&&this.type===GameCore.Ads.Types.REWARDED){self.game.analytics.showAdFail(this.type,e,t);return}}throw self.game.analytics.showAdFail(this.type,e,t),t}}getStatus(){return this.status}async createInstanceByType(e){const{facebook:t}=self.game;switch(e){case GameCore.Ads.Types.REWARDED:return await t.getRewardedVideoAsync(this.placementId);case GameCore.Ads.Types.INTERSTITIAL:return await t.getInterstitialAdAsync(this.placementId);default:return null}}getSceneName(){try{const{globalScene:e}=self.game;return e instanceof ia?e.getCurrentScene().scene.getSceneName():"unknown"}catch{return"unknown"}}}const{Object:Vr,Valid:je}=GameCore.Utils;class Wb extends Phaser.Game{constructor(e){super(e)}async boot(){super.boot(),this.addExtraGameObjectMethods(),this.addExtraFBInstantFunctions(),this.addPlugins(),await this.addDevPlugins(),await this.initAdsAsync(),this.addScenes(),this.addDevScenes(),this.initWorld(),this.initStorage(),this.initLanguage(),this.initUtils(),this.initRollbar(),this.initConsole(),this.initDebugger(),this.initStatistics(),this.initParticleEditor(),this.initNotificationPlugin(),this.initAdaptivePerformance(),this.initProfilerPlugin(),this.handleShowInterAdWhenStartGame(),this.addGlanceGlobalMethods()}start(){super.start()}addExtraGameObjectMethods(){const e=new Nu;e.addKillRevive(),e.addKillReviveGroup(),e.addDrawDebugBox(),e.addSetWorldSize(),e.addSetWorldSizeForContainer(),e.addGetWorldPosition(),e.addHighQuality()}addExtraFBInstantFunctions(){const e=new Lu(this.facebook);this.facebook.getLocale=e.getLocale,this.facebook.shareAsync=e.shareAsync,this.facebook.inviteAsync=e.inviteAsync,this.facebook.switchAsync=e.switchAsync,this.facebook.chooseAsync=e.chooseAsync,this.facebook.createAsync=e.createAsync,this.facebook.sendMessage=e.sendMessage,this.facebook.getContextID=e.getContextID,this.facebook.getPlayerToken=e.getPlayerToken,this.facebook.matchPlayerAsync=e.matchPlayerAsync,this.facebook.getContextPlayers=e.getContextPlayers,this.facebook.setLoadingProgress=e.setLoadingProgress,this.facebook.attemptToAddShortcut=e.attemptToAddShortcut,this.facebook.attemptToSubscribeBot=e.attemptToSubscribeBot,this.facebook.postSessionScoreAsync=e.postSessionScoreAsync,this.facebook.getRewardedVideoAsync=e.getRewardedVideoAsync,this.facebook.sendNotificationAsync=e.sendNotificationAsync,this.facebook.getInterstitialAdAsync=e.getInterstitialAdAsync,e.injectTournament(),this.facebook.progressLoading=new xu(this)}addPlugins(){this.plugins.install("Storage",Cm,!0,"storage"),this.plugins.install("Rollbar",op,!0,"rollbar"),this.plugins.install("AdsManager",Gu,!0,"ads"),this.plugins.install("AuthManager",Qu,!0,"auth"),this.plugins.install("AudioManager",Fu,!0,"audio"),this.plugins.install("WorldManager",Pm,!0,"world"),this.plugins.install("PlayerManager",Hd,!0,"player"),this.plugins.install("LanguageManager",qm,!0,"lang"),this.plugins.install("ProfileManager",qd,!0,"profile"),this.plugins.install("AnalyticsManager",Uu,!0,"analytics"),this.plugins.install("NotificationPlugin",Vb,!0,"notification"),this.plugins.install("AdaptivePerformance",ad,!0,"performance"),this.plugins.installScenePlugin("textStyler",Rm,"textStyler"),this.plugins.installScenePlugin("ScreenManager",hp,"screen"),this.plugins.installScenePlugin("FrameCapture",id,"frameCapture"),window.SpinePlugin&&this.plugins.installScenePlugin("SpinePlugin",SpinePlugin,"spine"),this.storage=this.plugins.get("Storage"),this.rollbar=this.plugins.get("Rollbar"),this.ads=this.plugins.get("AdsManager"),this.auth=this.plugins.get("AuthManager"),this.audio=this.plugins.get("AudioManager"),this.world=this.plugins.get("WorldManager"),this.player=this.plugins.get("PlayerManager"),this.lang=this.plugins.get("LanguageManager"),this.profile=this.plugins.get("ProfileManager"),this.analytics=this.plugins.get("AnalyticsManager"),this.notification=this.plugins.get("NotificationPlugin"),this.performance=this.plugins.get("AdaptivePerformance")}async addDevPlugins(){if(!je.isDebugger())return;const e=(await ls(()=>import("./devtool.js").then(n=>n.i),[],import.meta.url)).default,t=(await ls(()=>import("./devtool.js").then(n=>n.a),[],import.meta.url)).default,s=(await ls(()=>import("./devtool.js").then(n=>n.b),[],import.meta.url)).default;this.plugins.install("Console",e,!0,"console"),this.plugins.install("Profiler",s,!0,"profiler"),this.plugins.install("Statistics",t,!0,"statistics"),this.eruda=this.plugins.get("Console"),this.profiler=this.plugins.get("Profiler"),this.statistics=this.plugins.get("Statistics")}addScenes(){this.scene.add($.BOOT_SCENE,rg,!0),this.scene.add($.LOAD_SCENE,Nb,!1),this.scene.add($.GAME_SCENE,Tt,!1),this.scene.add($.GAME_OVER_SCENE,LI,!1),this.scene.add($.DASHBOARD_SCENE,TI,!1),this.scene.add($.LEADERBOARD_SCENE,ob,!1),this.scene.add($.RESULT_MATCH_SCENE,Gb,!1),this.scene.add($.GLOBAL_SCENE,ia,!1)}async addDevScenes(){if(!je.isDebugger())return;const e=(await ls(()=>import("./devscene.js").then(s=>s.T),[],import.meta.url)).default,t=(await ls(()=>import("./devscene.js").then(s=>s.i),[],import.meta.url)).default;this.scene.add($.TEST_SCENE,e,!1),this.scene.add($.ANIMATIONS_SCENE,t,!1)}async initAdsAsync(){const{Ads:e}=GameCore.Configs;Hr.setGame(this);const t=Hr,s={...e.InterstitialAdOptions},n=window.GlanceGamingAdInterface!=null&&window.isAdSDKLoaded;s.showWhenStartGame&&(s.secondsFirstTime=0),this.ads.configure(t,{enabled:e.Enabled&&n,calculateSafeAreaBottom:e.CalculateSafeAreaBottom,enableRewardVideoResetInterstitial:e.EnableRewardVideoResetInterstitial,interstitialAdOptions:s,rewardAdOptions:e.RewardAdOptions,bannerAdOptions:e.BannerAdOptions})}initWorld(){const{Game:e}=GameCore.Configs,{AutoResize:t,PortraitRatio:s,PortraitWidth:n,PortraitHeight:a,LandscapeRatio:r,LandscapeWidth:c,LandscapeHeight:o,DisableLandscape:l,FullSizeOnLandscape:h}=e,d=t,u=l,p=h,m=s,g=n,y=a,f=r,E=c,S=o;this.world.configure({autoResize:d,portraitRatio:m,portraitWidth:g,portraitHeight:y,landscapeRatio:f,landscapeWidth:E,landscapeHeight:S,disableLandscape:u,fullSizeOnLandscape:p}),this.world.resize(e.ForcePixelRatio)}initStorage(){const e=new Bm(this);this.storage.setInitiator(e)}initLanguage(){const e=this.facebook.getLocale();this.lang.configure({locale:e,upperCaseText:!0})}initUtils(){this.handlePauseAudio(),this.removeUnusedPipelines()}initConsole(){if(!je.isDebugger())return;const{ShowConsole:e}=GameCore.Configs.Debugger;e&&this.eruda.configure({tool:["console","info"],defaults:{theme:"Dark"}})}initDebugger(){if(!je.isDebugger())return;const{ShowInspector:e,ShowMonitoring:t}=GameCore.Configs.Debugger;!e&&!t||this.debugger&&this.debugger.configure(GameCore.Configs.Debugger)}initStatistics(){if(!je.isDebugger())return;const{Enable:e}=GameCore.Configs.Statistics;e&&this.statistics&&this.statistics.configure(GameCore.Configs.Statistics)}initParticleEditor(){if(!je.isDebugger())return;const{Enable:e}=GameCore.Configs.ParticleEditor;e&&this.particleEditor&&this.particleEditor.configure(GameCore.Configs.ParticleEditor)}initProfilerPlugin(){if(!je.isDebugger())return;const{Enable:e}=GameCore.Configs.ProfilerPlugin;e&&this.profiler&&this.profiler.configure()}initNotificationPlugin(){const{AppId:e}=GameCore.Configs,{Enable:t,ApiUrl:s}=GameCore.Configs.Notification;if(!t)return;let n=null;if(Vr.hasOwn(window.__glancePlayerData,"glanceId")&&je.isString(window.__glancePlayerData.glanceId)&&(n=window.__glancePlayerData.glanceId),!n)return;let a=null;if(Vr.hasOwn(window.__glancePlayerData,"gpID")&&je.isString(window.__glancePlayerData.gpID)&&(a=window.__glancePlayerData.gpID),!a)return;const r={gpId:a,appId:e,glanceId:n};this.notification.setup(s,r)}addGlanceGlobalMethods(){window.enableSound=e=>{this.player.setSetting("music",e),this.player.setSetting("sound",e),e?this.audio.playMusic():this.audio.pauseMusic()}}initAdaptivePerformance(){const{Enable:e,...t}=GameCore.Configs.Performance;if(!e)return;const s=this.world.getPixelRatio();this.performance.configure({pixelRatio:s,...t}),this.performance.active()}initRollbar(){const{Enable:e}=GameCore.Configs.Rollbar;console.warn({isRollbarEnabled:e}),e&&this.rollbar.setup()}handlePauseAudio(){this.sound.pauseOnBlur=!1,document.addEventListener("visibilitychange",()=>{if(document.hidden){this.audio.pauseMusic();return}this.audio.playMusic()})}removeUnusedPipelines(){const e=this.renderer;if(!(e instanceof Phaser.Renderer.WebGL.WebGLRenderer))return;const{pipelines:t}=e,s=Phaser.Renderer.WebGL.Pipelines;if(!s)return;[s.ROPE_PIPELINE,s.LIGHT_PIPELINE,s.POSTFX_PIPELINE,s.POINTLIGHT_PIPELINE,s.BITMAPMASK_PIPELINE].forEach(a=>{t.get(a)?.destroy(),t.remove(a)})}async handleShowInterAdWhenStartGame(){const{InterstitialAdOptions:e}=GameCore.Configs.Ads;if(e.showWhenStartGame)try{this.audio.stopMusic(),this.audio.muteAll(),await this.ads.preloadInterstitialAdAsync(),await this.ads.showInterstitialAdAsync()}catch(t){j(t)}finally{this.audio.unmuteAll(),this.audio.playMusic()}}}const{ShowInspector:Kb}=GameCore.Configs.Debugger,jb={parent:"app",type:Phaser.AUTO,width:0,height:0,scale:{autoRound:!0},dom:{createContainer:!1},loader:{maxParallelDownloads:6,crossOrigin:"no-cros"},audio:{},input:{gamepad:!1,keyboard:Kb,touch:{capture:!0},smoothFactor:1,activePointers:1,windowEvents:!1},disableContextMenu:!0,render:{pixelArt:!1,antialias:!0,antialiasGL:!0,transparent:!0,desynchronized:!1,powerPreference:"high-performance",clearBeforeRender:!1,roundPixels:!1},plugins:{global:[]}};bu();const zb=()=>{try{const i=new Wb(jb);window.game=i}catch(i){j(i)}},$b=()=>{const i=setInterval(()=>{if(!window.__analyticsInitiated||!window.FBInstant)return;//! temporarily fix for not use adapter
window.GameSDK=window.FBInstant,window.__fbGameReady=!1,clearInterval(i),clearInterval(window.__fbInstantLoadingTimer),GameSDK.setLoadingProgress(30),"gtag"in window&&gtag("event","app_initialize",{send_to:["GA"]}),zb()},50)};$b();export{ns as B,wr as C,Y as D,k as F,Br as I,D as S,K as a,wI as b,_o as c,dl as d,jS as e,xg as f,Zd as g,Wc as h,DS as i,Vc as j,DI as k,Wn as l,Ce as m,Yc as n,zn as o,ee as p,ZI as q};
